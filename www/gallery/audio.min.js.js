(function e$$0(p,u,e){function d(b,g){if(!u[b]){if(!p[b]){var c="function"==typeof require&&require;if(!g&&c)return c(b,!0);if(w)return w(b,!0);c=Error("Cannot find module '"+b+"'");throw c.code="MODULE_NOT_FOUND",c;}c=u[b]={exports:{}};p[b][0].call(c.exports,function(g){var c=p[b][1][g];return d(c?c:g)},c,c.exports,e$$0,p,u,e)}return u[b].exports}for(var w="function"==typeof require&&require,n=0;n<e.length;n++)d(e[n]);return d})({1:[function(f,p,u){var e=f("../regl")({pixelRatio:1}),d=f("gl-mat4/perspective"),
w=f("gl-mat4/lookAt");f("resl")({manifest:{song:{type:"audio",src:"assets/8bitpeoples-bamboo-cactus.mp3",stream:!0}},onDone:function(n){n=n.song;var b=new AudioContext,g=b.createMediaElementSource(n),c=b.createAnalyser();g.connect(c);g.connect(b.destination);n.play();var t=e.texture({data:(new Uint8Array(65536)).fill(128),radius:256,channels:1,min:"linear",mag:"linear",wrap:"repeat"}),f=e.texture({width:64,height:1,channels:4,min:"linear",mag:"linear",wrap:"repeat"}),p=e({vert:"\n      precision highp float;\n\n      #define N float(256)\n      #define WEIGHT1 vec4(-1.0, 8.0, -8.0, 1.0)\n      #define WEIGHT2 vec4(-1.0, 16.0, 16.0, -1.0)\n\n      attribute vec2 vertId;\n\n      uniform float t;\n      uniform mat4 projection, view;\n      uniform vec3 lightPosition;\n      uniform float offsetRow;\n      uniform sampler2D terrain, color;\n\n      varying vec3 grad, fragColor, eyeDir, lightDir;\n      varying float curvature;\n\n      float f(vec2 x) {\n        return 0.025 * pow(texture2D(terrain, x).r, 2.0) *\n          (1.0 + 2.5 * pow(texture2D(color, vec2(x.y, 0.0)).a, 3.0));\n      }\n\n      vec4 stencil(vec2 x, vec2 d) {\n        return vec4(\n          f(x - 2.0 * d),\n          f(x - d),\n          f(x + d),\n          f(x + 2.0 * d));\n      }\n\n      void main () {\n        vec2 uv = (vertId + vec2(0.0, offsetRow)) / N;\n\n        float h0 = f(uv);\n        vec4 hx = stencil(uv, vec2(1.0 / N, 0.0));\n        vec4 hy = stencil(uv, vec2(0.0, 1.0 / N));\n\n        grad = normalize(vec3(\n          dot(WEIGHT1, hx),\n          dot(WEIGHT1, hy),\n          0.025));\n\n        curvature =\n          max(max((dot(WEIGHT2, hx) - 30.0 * h0),\n              (dot(WEIGHT2, hy) - 30.0 * h0)), 0.0);\n\n        vec3 pos = vec3(vertId / N, h0 + 0.4);\n        lightDir = lightPosition - pos;\n\n        vec4 viewPos = view * vec4(pos, 1);\n        gl_Position = projection * viewPos;\n        eyeDir = viewPos.xyz / viewPos.w;\n\n        vec3 audioColor = texture2D(color, vec2(uv.y, 0)).rgb;\n        float minC = 0.9 * min(min(audioColor.r, audioColor.g), audioColor.b);\n        float maxC = max(max(audioColor.r, audioColor.g), audioColor.b);\n        fragColor = (audioColor - minC) / (maxC - minC);\n      }",
frag:"\n      precision highp float;\n\n      varying vec3 grad, fragColor, eyeDir, lightDir;\n      varying float curvature;\n\n      void main () {\n        vec3 N = normalize(grad);\n        vec3 V = normalize(eyeDir);\n        vec3 L = normalize(lightDir);\n\n        vec3 H = normalize(V + L);\n\n        float ao = 1.0 - curvature;\n        float diffuse = max(dot(L, N), 0.0);\n        float fresnel = 0.1 + 0.5 * pow(1.0 - max(dot(H, V), 0.0), 5.0);\n        float light = 0.25 * ao + 0.8 * diffuse + fresnel;\n        gl_FragColor = vec4(light * fragColor, 1);\n      }",
attributes:{vertId:Array(262144).fill().map(function(b,g){var c=.5*Math.floor(g/512),e=g%512*.5;return[c,e,c+.5,e,c,e+.5,c,e+.5,c+.5,e+.5,c+.5,e]})},uniforms:{offsetRow:function(b){return b.tick%256},terrain:t,projection:function(b){return d([],Math.PI/8,b.viewportWidth/b.viewportHeight,.01,1E3)},view:function(b){b=b.tick;return w([],[.5+.2*Math.cos(.001*b),1,.7+.2*Math.cos(.003*b+2.4)],[.5,0,0],[0,0,1])},lightPosition:function(b){b=b.tick;return[.5+Math.sin(.01*b),1+Math.cos(.01*b),1+.6*Math.cos(.04*
b)]},color:f,t:function(b){return.01*b.tick}},elements:null,instances:-1,count:1572864}),x={width:256,height:1,data:new Uint8Array(256)},h=new Uint8Array(256);e.frame(function(b){b=b.tick%256;e.clear({color:[0,0,0,1],depth:1});c.getByteTimeDomainData(x.data);t.subimage(x,0,b);c.getByteFrequencyData(h);f.subimage(h);p()})}})},{"../regl":37,"gl-mat4/lookAt":34,"gl-mat4/perspective":35,resl:36}],2:[function(f,p,u){function e(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=
!1;this.type=5126;this.divisor=this.stride=this.offset=0}p.exports=function(d,w,n,b,g){d=n.maxAttributes;w=Array(d);for(n=0;n<d;++n)w[n]=new e;return{Record:e,scope:{},state:w}}},{}],3:[function(f,p,u){function e(b){return N[Object.prototype.toString.call(b)]|0}function d(b,c){for(var g=0;g<c.length;++g)b[g]=c[g]}function w(b,g,c,e,d,h,n){for(var w=0,a=0;a<c;++a)for(var t=0;t<e;++t)b[w++]=g[d*a+h*t+n]}function n(b,g,c){for(var e=0,d=0;d<g.length;++d)for(var h=g[d],n=0;n<c;++n)b[e++]=h[n]}var b=f("./util/is-typed-array"),
g=f("./util/is-ndarray"),c=f("./util/values"),t=f("./util/pool"),N=f("./constants/arraytypes.json"),z=f("./constants/dtypes.json"),x=f("./constants/usage.json"),h=[];h[5120]=1;h[5122]=2;h[5124]=4;h[5121]=1;h[5123]=2;h[5125]=4;h[5126]=4;p.exports=function(v,f,B){function m(a){this.id=H++;this.buffer=v.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;B.profile&&(this.stats={size:0})}function y(a,b,g){a.byteLength=b.byteLength;v.bufferData(a.type,b,g)}function p(a,
c,h,m,f){a.usage=h;if(Array.isArray(c))a.dtype=m||5126,0<c.length&&(Array.isArray(c[0])?(a.dimension=c[0].length,m=t.allocType(a.dtype,c.length*a.dimension),n(m,c,a.dimension),y(a,m,h),t.freeType(m)):"number"===typeof c[0]?(a.dimension=f,m=t.allocType(a.dtype,c.length),d(m,c),y(a,m,h),t.freeType(m)):b(c[0])&&(a.dimension=c[0].length,a.dtype=m||e(c[0])||5126,m=t.allocType(a.dtype,c.length*a.dimension),n(m,c,a.dimension),y(a,m,h),t.freeType(m)));else if(b(c))a.dtype=m||e(c),a.dimension=f,y(a,c,h);else if(g(c)){var v=
c.shape,B=c.stride;f=c.offset;var r=0,H=0,J=0,G=0;1===v.length?(r=v[0],H=1,J=B[0],G=0):2===v.length&&(r=v[0],H=v[1],J=B[0],G=B[1]);a.dtype=m||e(c.data)||5126;a.dimension=H;m=t.allocType(a.dtype,r*H);w(m,c.data,r,H,J,G,f);y(a,m,h);t.freeType(m)}}function N(b){f.bufferCount--;v.deleteBuffer(b.buffer);b.buffer=null;delete a[b.id]}var H=0,a={};m.prototype.bind=function(){v.bindBuffer(this.type,this.buffer)};m.prototype.destroy=function(){N(this)};var J=[];B.profile&&(f.getTotalBufferSize=function(){var b=
0;Object.keys(a).forEach(function(c){b+=a[c].stats.size});return b});return{create:function(c,H,y){function J(a){var c=35044,e=null,d=0,m=0,n=1;Array.isArray(a)||b(a)||g(a)?e=a:"number"===typeof a?d=a|0:a&&("data"in a&&(e=a.data),"usage"in a&&(c=x[a.usage]),"type"in a&&(m=z[a.type]),"dimension"in a&&(n=a.dimension|0),"length"in a&&(d=a.length|0));C.bind();e?p(C,e,c,m,n):(v.bufferData(C.type,d,c),C.dtype=m||5121,C.usage=c,C.dimension=n,C.byteLength=d);B.profile&&(C.stats.size=C.byteLength*h[C.dtype]);
return J}f.bufferCount++;var C=new m(H);a[C.id]=C;y||J(c);J._reglType="buffer";J._buffer=C;J.subdata=function(a,c){var m=(c||0)|0;C.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var h=t.allocType(C.dtype,a.length);d(h,a);v.bufferSubData(C.type,m,h);t.freeType(h)}else if(Array.isArray(a[0])||b(a[0])){var h=a[0].length,f=t.allocType(C.dtype,a.length*h);n(f,a,h);v.bufferSubData(C.type,m,f);t.freeType(f)}}else if(b(a))v.bufferSubData(C.type,m,a);else if(g(a)){var G=a.shape,H=a.stride,
y=f=h=0,B=0;1===G.length?(h=G[0],f=1,y=H[0],B=0):2===G.length&&(h=G[0],f=G[1],y=H[0],B=H[1]);G=Array.isArray(a.data)?C.dtype:e(a.data);G=t.allocType(G,h*f);w(G,a.data,h,f,y,B,a.offset);v.bufferSubData(C.type,m,G);t.freeType(G)}return J};B.profile&&(J.stats=C.stats);J.destroy=function(){N(C)};return J},createStream:function(a,b){var c=J.pop();c||(c=new m(a));c.bind();p(c,b,35040,0,1);return c},destroyStream:function(a){J.push(a)},clear:function(){c(a).forEach(N);J.forEach(N)},getBuffer:function(a){return a&&
a._buffer instanceof m?a._buffer:null},_initBuffer:p}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],4:[function(f,p,u){p.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,
"[object ArrayBuffer]":5121}},{}],5:[function(f,p,u){p.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(f,p,u){p.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(f,p,u){p.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(f,p,u){function e(b){return Array.isArray(b)||N(b)||z(b)}function d(b){return b.sort(function(a,
b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function w(b,a,c,g){this.thisDep=b;this.contextDep=a;this.propDep=c;this.append=g}function n(b){return b&&!(b.thisDep||b.contextDep||b.propDep)}function b(b){return new w(!1,!1,!1,b)}function g(b,a){var c=b.type;return 0===c?(c=b.data.length,new w(!0,1<=c,2<=c,a)):new w(3===c,2===c,1===c,a)}var c=f("./util/codegen"),t=f("./util/loop"),N=f("./util/is-typed-array"),z=f("./util/is-ndarray"),x=f("./util/is-array-like"),h=f("./constants/primitives.json"),
v=f("./constants/dtypes.json"),I=["x","y","z","w"],B={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},m={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,
"!=":517,"!==":517,gequal:518,">=":518,always:519},y={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},T={cw:2304,ccw:2305},L=new w(!1,!1,!1,function(){});p.exports=function(f,a,J,p,z,N,u,C,ca,E,r,V,wa,G,Z){function W(a){return a.replace(".","_")}function P(a,D,b){var c=W(a);F.push(a);l[c]=X[c]=!!b;A[c]=D}function M(a,D,b){var c=W(a);F.push(a);Array.isArray(b)?(X[c]=b.slice(),l[c]=b.slice()):X[c]=l[c]=b;ra[c]=D}function O(){var k=
c(),D=k.link,b=k.global;k.id=Ka++;k.batchId="0";var l=D(Ia),g=k.shared={props:"a0"};Object.keys(Ia).forEach(function(q){g[q]=b.def(l,".",q)});var e=k.next={},d=k.current={};Object.keys(ra).forEach(function(q){Array.isArray(X[q])&&(e[q]=b.def(g.next,".",q),d[q]=b.def(g.current,".",q))});var q=k.constants={};Object.keys(Ca).forEach(function(a){q[a]=b.def(JSON.stringify(Ca[a]))});k.invoke=function(q,a){switch(a.type){case 0:var b=["this",g.context,g.props,k.batchId];return q.def(D(a.data),".call(",b.slice(0,
Math.max(a.data.length+1,4)),")");case 1:return q.def(g.props,a.data);case 2:return q.def(g.context,a.data);case 3:return q.def("this",a.data)}};k.attribCache={};var Ga={};k.scopeAttrib=function(q){q=a.id(q);if(q in Ga)return Ga[q];var k=E.scope[q];k||(k=E.scope[q]=new ma);return Ga[q]=D(k)};return k}function Q(a){var D=a["static"];a=a.dynamic;var c;if("profile"in D){var l=!!D.profile;c=b(function(a,k){return l});c.enable=l}else if("profile"in a){var e=a.profile;c=g(e,function(a,k){return a.invoke(k,
e)})}return c}function ha(a){var D=a["static"];a=a.dynamic;if("framebuffer"in D){var c=D.framebuffer;return c?(c=C.getFramebuffer(c),b(function(a,k){var b=a.link(c),q=a.shared;k.set(q.framebuffer,".next",b);q=q.context;k.set(q,".framebufferWidth",b+".width");k.set(q,".framebufferHeight",b+".height");return b})):b(function(a,k){var b=a.shared;k.set(b.framebuffer,".next","null");b=b.context;k.set(b,".framebufferWidth",b+".drawingBufferWidth");k.set(b,".framebufferHeight",b+".drawingBufferHeight");return"null"})}if("framebuffer"in
a){var l=a.framebuffer;return g(l,function(a,k){var b=a.invoke(k,l),q=a.shared,c=q.framebuffer,b=k.def(c,".getFramebuffer(",b,")");k.set(c,".next",b);q=q.context;k.set(q,".framebufferWidth",b+"?"+b+".width:"+q+".drawingBufferWidth");k.set(q,".framebufferHeight",b+"?"+b+".height:"+q+".drawingBufferHeight");return b})}return null}function sa(a,b){function c(a){if(a in l){var k=l[a];a=!0;var Ja=k.x|0,d=k.y|0,qa,h;"width"in k?qa=k.width|0:a=!1;"height"in k?h=k.height|0:a=!1;return new w(!a&&b&&b.thisDep,
!a&&b&&b.contextDep,!a&&b&&b.propDep,function(a,q){var b=a.shared.context,c=qa;"width"in k||(c=q.def(b,".","framebufferWidth","-",Ja));var l=h;"height"in k||(l=q.def(b,".","framebufferHeight","-",d));return[Ja,d,c,l]})}if(a in e){var da=e[a];a=g(da,function(a,q){var k=a.invoke(q,da),b=a.shared.context,c=q.def(k,".x|0"),l=q.def(k,".y|0"),D=q.def('"width" in ',k,"?",k,".width|0:","(",b,".","framebufferWidth","-",c,")"),k=q.def('"height" in ',k,"?",k,".height|0:","(",b,".","framebufferHeight","-",l,
")");return[c,l,D,k]});b&&(a.thisDep=a.thisDep||b.thisDep,a.contextDep=a.contextDep||b.contextDep,a.propDep=a.propDep||b.propDep);return a}return b?new w(b.thisDep,b.contextDep,b.propDep,function(a,q){var k=a.shared.context;return[0,0,q.def(k,".","framebufferWidth"),q.def(k,".","framebufferHeight")]}):null}var l=a["static"],e=a.dynamic,d=c("viewport");if(d)var h=d,d=new w(d.thisDep,d.contextDep,d.propDep,function(a,k){var b=h.append(a,k),c=a.shared.context;k.set(c,".viewportWidth",b[2]);k.set(c,".viewportHeight",
b[3]);return b});return{viewport:d,scissor_box:c("scissor.box")}}function xa(k){function c(q){if(q in l){var k=a.id(l[q]);q=b(function(){return k});q.id=k;return q}if(q in e){var D=e[q];return g(D,function(a,q){var k=a.invoke(q,D);return q.def(a.shared.strings,".id(",k,")")})}return null}var l=k["static"],e=k.dynamic,d=c("frag"),h=c("vert"),m=null;n(d)&&n(h)?(m=r.program(h.id,d.id),k=b(function(a,k){return a.link(m)})):k=new w(d&&d.thisDep||h&&h.thisDep,d&&d.contextDep||h&&h.contextDep,d&&d.propDep||
h&&h.propDep,function(a,k){var b=a.shared.shader,c;c=d?d.append(a,k):k.def(b,".","frag");var l;l=h?h.append(a,k):k.def(b,".","vert");return k.def(b+".program("+l+","+c+")")});return{frag:d,vert:h,progVar:k,program:m}}function ia(a){function c(a,k){if(a in l){var D=l[a]|0;return b(function(a,b){k&&(a.OFFSET=D);return D})}if(a in d){var e=d[a];return g(e,function(a,b){var c=a.invoke(b,e);k&&(a.OFFSET=c);return c})}return k&&m?b(function(a,k){a.OFFSET="0";return 0}):null}var l=a["static"],d=a.dynamic,
m=function(){if("elements"in l){var a=l.elements;e(a)?a=N.getElements(N.create(a)):a&&(a=N.getElements(a));var k=b(function(k,b){if(a){var q=k.link(a);return k.ELEMENTS=q}return k.ELEMENTS=null});k.value=a;return k}if("elements"in d){var c=d.elements;return g(c,function(a,k){var b=a.shared,q=b.isBufferArgs,b=b.elements,l=a.invoke(k,c),D=k.def("null"),q=k.def(q,"(",l,")"),l=a.cond(q).then(D,"=",b,".createStream(",l,");")["else"](D,"=",b,".getElements(",l,");");k.entry(l);k.exit(a.cond(q).then(b,".destroyStream(",
D,");"));return a.ELEMENTS=D})}return null}(),da=c("offset",!0);return{elements:m,primitive:function(){if("primitive"in l){var a=l.primitive;return b(function(k,b){return h[a]})}if("primitive"in d){var k=d.primitive;return g(k,function(a,b){var c=a.constants.primTypes,l=a.invoke(b,k);return b.def(c,"[",l,"]")})}return m?n(m)?m.value?b(function(a,k){return k.def(a.ELEMENTS,".primType")}):b(function(){return 4}):new w(m.thisDep,m.contextDep,m.propDep,function(a,k){var b=a.ELEMENTS;return k.def(b,"?",
b,".primType:",4)}):null}(),count:function(){if("count"in l){var a=l.count|0;return b(function(){return a})}if("count"in d){var k=d.count;return g(k,function(a,b){return a.invoke(b,k)})}return m?n(m)?m?da?new w(da.thisDep,da.contextDep,da.propDep,function(a,k){return k.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):b(function(a,k){return k.def(a.ELEMENTS,".vertCount")}):b(function(){return-1}):new w(m.thisDep||da.thisDep,m.contextDep||da.contextDep,m.propDep||da.propDep,function(a,k){var b=a.ELEMENTS;return a.OFFSET?
k.def(b,"?",b,".vertCount-",a.OFFSET,":-1"):k.def(b,"?",b,".vertCount:-1")}):null}(),instances:c("instances",!1),offset:da}}function ta(a){var c=a["static"],l=a.dynamic,d={};F.forEach(function(a){function k(q,h){if(a in c){var m=q(c[a]);d[e]=b(function(){return m})}else if(a in l){var A=l[a];d[e]=g(A,function(a,k){return h(a,k,a.invoke(k,A))})}}var e=W(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return k(function(a){return a},
function(a,k,b){return b});case "depth.func":return k(function(a){return m[a]},function(a,k,b){return k.def(a.constants.compareFuncs,"[",b,"]")});case "depth.range":return k(function(a){return a},function(a,k,b){a=k.def("+",b,"[0]");k=k.def("+",b,"[1]");return[a,k]});case "blend.func":return k(function(a){return[B["srcRGB"in a?a.srcRGB:a.src],B["dstRGB"in a?a.dstRGB:a.dst],B["srcAlpha"in a?a.srcAlpha:a.src],B["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,k,b){function c(a,q){var D=k.def('"',a,q,'" in ',
b,"?",b,".",a,q,":",b,".",a);return k.def(l,"[",D,"]")}var l=a.constants.blendFuncs;a=c("src","RGB");var D=c("src","Alpha"),d=c("dst","RGB"),e=c("dst","Alpha");return[a,d,D,e]});case "blend.equation":return k(function(a){if("string"===typeof a)return[na[a],na[a]];if("object"===typeof a)return[na[a.rgb],na[a.alpha]]},function(a,k,b){var c=a.constants.blendEquations,l=k.def(),D=k.def();a=a.cond("typeof ",b,'==="string"');a.then(l,"=",D,"=",c,"[",b,"];");a["else"](l,"=",c,"[",b,".rgb];",D,"=",c,"[",
b,".alpha];");k(a);return[l,D]});case "blend.color":return k(function(a){return t(4,function(k){return+a[k]})},function(a,k,b){return t(4,function(a){return k.def("+",b,"[",a,"]")})});case "stencil.mask":return k(function(a){return a|0},function(a,k,b){return k.def(b,"|0")});case "stencil.func":return k(function(a){return[m[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,k,b){a=k.def('"cmp" in ',b,"?",a.constants.compareFuncs,"[",b,".cmp]",":",7680);var c=k.def(b,".ref|0");k=k.def('"mask" in ',
b,"?",b,".mask|0:-1");return[a,c,k]});case "stencil.opFront":case "stencil.opBack":return k(function(k){return["stencil.opBack"===a?1029:1028,y[k.fail||"keep"],y[k.zfail||"keep"],y[k.pass||"keep"]]},function(k,b,c){function l(a){return b.def('"',a,'" in ',c,"?",D,"[",c,".",a,"]:",7680)}var D=k.constants.stencilOps;return["stencil.opBack"===a?1029:1028,l("fail"),l("zfail"),l("pass")]});case "polygonOffset.offset":return k(function(a){return[a.factor|0,a.units|0]},function(a,k,b){a=k.def(b,".factor|0");
k=k.def(b,".units|0");return[a,k]});case "cull.face":return k(function(a){var k=0;"front"===a?k=1028:"back"===a&&(k=1029);return k},function(a,k,b){return k.def(b,'==="front"?',1028,":",1029)});case "lineWidth":return k(function(a){return a},function(a,k,b){return b});case "frontFace":return k(function(a){return T[a]},function(a,k,b){return k.def(b+'==="cw"?2304:2305')});case "colorMask":return k(function(a){return a.map(function(a){return!!a})},function(a,k,b){return t(4,function(a){return"!!"+b+
"["+a+"]"})});case "sample.coverage":return k(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,k,b){a=k.def('"value" in ',b,"?+",b,".value:1");k=k.def("!!",b,".invert");return[a,k]})}});return d}function ja(a){var c=a["static"],l=a.dynamic,d={};Object.keys(c).forEach(function(a){var k=c[a],l;"number"===typeof k||"boolean"===typeof k?l=b(function(){return k}):"function"!==typeof k||"texture2d"!==k._reglType&&"textureCube"!==k._reglType?x(k)&&(l=b(function(a){return a.global.def("[",
t(k.length,function(a){return k[a]}),"]")})):l=b(function(a){return a.link(k)});l.value=k;d[a]=l});Object.keys(l).forEach(function(a){var k=l[a];d[a]=g(k,function(a,b){return a.invoke(b,k)})});return d}function aa(k){var c=k["static"],l=k.dynamic,d={};Object.keys(c).forEach(function(k){var l=c[k],g=a.id(k),q=new ma;if(e(l))q.state=1,q.buffer=z.getBuffer(z.create(l,34962,!1)),q.type=q.buffer.dtype;else{var h=z.getBuffer(l);if(h)q.state=1,q.buffer=h,q.type=h.dtype;else if(l.constant){var m=l.constant;
q.state=2;"number"===typeof m?q.x=m:I.forEach(function(a,k){k<m.length&&(q[a]=m[k])})}else{var h=z.getBuffer(l.buffer),qa=l.offset|0,A=l.stride|0,n=l.size|0,r=!!l.normalized,F=0;"type"in l&&(F=v[l.type]);l=l.divisor|0;q.buffer=h;q.state=1;q.size=n;q.normalized=r;q.type=F||h.dtype;q.offset=qa;q.stride=A;q.divisor=l}}d[k]=b(function(a,k){var b=a.attribCache;if(g in b)return b[g];var l={isStream:!1};Object.keys(q).forEach(function(a){l[a]=q[a]});q.buffer&&(l.buffer=a.link(q.buffer));return b[g]=l})});
Object.keys(l).forEach(function(a){var k=l[a];d[a]=g(k,function(a,b){function l(a){b(e[a],"=",c,".",a,"|0;")}var c=a.invoke(b,k),D=a.shared,d=D.isBufferArgs,g=D.buffer,e={isStream:b.def(!1)},h=new ma;h.state=1;Object.keys(h).forEach(function(a){e[a]=b.def(""+h[a])});var m=e.buffer,qa=e.type;b("if(",d,"(",c,")){",e.isStream,"=true;",m,"=",g,".createStream(",34962,",",c,");",qa,"=",m,".dtype;","}else{",m,"=",g,".getBuffer(",c,");","if(",m,"){",qa,"=",m,".dtype;","}else if(",c,".constant){",e.state,
"=",2,";",I.map(function(a,k){return e[a]+"="+c+".length>="+k+"?"+c+"["+k+"]:0;"}).join(""),"}else{",m,"=",g,".getBuffer(",c,".buffer);",qa,'="type" in ',c,"?",D.glTypes,"[",c,".type]:",m,".dtype;",e.normalized,"=!!",c,".normalized;");l("size");l("offset");l("stride");l("divisor");b("}}");b.exit("if(",e.isStream,"){",g,".destroyStream(",m,");","}");return e})});return d}function ua(a){var l=a["static"],c=a.dynamic,d={};Object.keys(l).forEach(function(a){var k=l[a];d[a]=b(function(a,b){return"number"===
typeof k||"boolean"===typeof k?""+k:a.link(k)})});Object.keys(c).forEach(function(a){var k=c[a];d[a]=g(k,function(a,b){return a.invoke(b,k)})});return d}function R(a,b,l){var c=a.shared.context,d=a.scope();Object.keys(l).forEach(function(e){b.save(c,"."+e);d(c,".",e,"=",l[e].append(a,b),";")});b(d)}function K(a,b,l){var c=a.shared,d=c.gl,e=c.framebuffer,g;va&&(g=b.def(c.extensions,".webgl_draw_buffers"));var q=a.constants,c=q.drawBuffer,q=q.backBuffer;a=l?l.append(a,b):b.def(e,".next");b("if(",e,
".dirty||",a,"!==",e,".cur){","if(",a,"){",d,".bindFramebuffer(",36160,",",a,".framebuffer);");va&&b(g,".drawBuffersWEBGL(",c,"[",a,".colorAttachments.length]);");b("}else{",d,".bindFramebuffer(",36160,",null);");va&&b(g,".drawBuffersWEBGL(",q,");");b("}",e,".cur=",a,";",e,".dirty=false;","}")}function Y(a,b,c){var l=a.shared,d=l.gl,e=a.current,g=a.next,q=l.current,m=l.next,h=a.cond(q,".dirty");F.forEach(function(b){b=W(b);if(!(b in c.state)){var l,D;if(b in g){l=g[b];D=e[b];var n=t(X[b].length,function(a){return h.def(l,
"[",a,"]")});h(a.cond(n.map(function(a,k){return a+"!=="+D+"["+k+"]"}).join("||")).then(d,".",ra[b],"(",n,");",n.map(function(a,k){return D+"["+k+"]="+a}).join(";"),";"))}else l=h.def(m,".",b),n=a.cond(l,"!==",q,".",b),h(n),b in A?n(a.cond(l).then(d,".enable(",A[b],");")["else"](d,".disable(",A[b],");"),q,".",b,"=",l,";"):n(d,".",ra[b],"(",l,");",q,".",b,"=",l,";")}});0===Object.keys(c.state).length&&h(q,".dirty=false;");b(h)}function ea(a,b,l,c){var e=a.shared,g=a.current,h=e.current,q=e.gl;d(Object.keys(l)).forEach(function(d){var e=
l[d];if(!c||c(e)){var m=e.append(a,b);if(A[d]){var r=A[d];n(e)?m?b(q,".enable(",r,");"):b(q,".disable(",r,");"):b(a.cond(m).then(q,".enable(",r,");")["else"](q,".disable(",r,");"));b(h,".",d,"=",m,";")}else if(x(m)){var F=g[d];b(q,".",ra[d],"(",m,");",m.map(function(a,k){return F+"["+k+"]="+a}).join(";"),";")}else b(q,".",ra[d],"(",m,");",h,".",d,"=",m,";")}})}function S(a,b){ba&&!a.instancing&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function ya(a,b,l,c,d){function e(){return"undefined"===
typeof performance?"Date.now()":"performance.now()"}function g(a){f=b.def();a(f,"=",e(),";");"string"===typeof d?a(A,".count+=",d,";"):a(A,".count++;");G&&(c?(y=b.def(),a(y,"=",F,".getNumPendingQueries();")):a(F,".beginQuery(",A,");"))}function q(a){a(A,".cpuTime+=",e(),"-",f,";");G&&(c?a(F,".pushScopeStats(",y,",",F,".getNumPendingQueries(),",A,");"):a(F,".endQuery();"))}function m(a){var k=b.def(r,".profile");b(r,".profile=",a,";");b.exit(r,".profile=",k,";")}var h=a.shared,A=a.stats,r=h.current,
F=h.timer;l=l.profile;var f,y;if(l){if(n(l)){l.enable?(g(b),q(b.exit),m("true")):m("false");return}l=l.append(a,b);m(l)}else l=b.def(r,".profile");h=a.block();g(h);b("if(",l,"){",h,"}");a=a.block();q(a);b.exit("if(",l,"){",a,"}")}function za(a,b,l,c,d){function e(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function g(l,c,d){function e(){b("if(!",n,".pointer){",m,".enableVertexAttribArray(",
A,");",n,".pointer=true;}");var l=d.type,g;g=d.size?b.def(d.size,"||",c):c;b("if(",n,".type!==",l,"||",n,".size!==",g,"||",f.map(function(a){return n+"."+a+"!=="+d[a]}).join("||"),"){",m,".bindBuffer(",34962,",",r,".buffer);",m,".vertexAttribPointer(",[A,g,l,d.normalized,d.stride,d.offset],");",n,".type=",l,";",n,".size=",g,";",f.map(function(a){return n+"."+a+"="+d[a]+";"}).join(""),"}");ba&&(l=d.divisor,b("if(",n,".divisor!==",l,"){",a.instancing,".vertexAttribDivisorANGLE(",[A,l],");",n,".divisor=",
l,";}"))}function h(){b("if(",n,".pointer){",m,".disableVertexAttribArray(",A,");",n,".pointer=false;","}if(",I.map(function(a,b){return n+"."+a+"!=="+F[b]}).join("||"),"){",m,".vertexAttrib4f(",A,",",F,");",I.map(function(a,b){return n+"."+a+"="+F[b]+";"}).join(""),"}")}var m=q.gl,A=b.def(l,".location"),n=b.def(q.attributes,"[",A,"]");l=d.state;var r=d.buffer,F=[d.x,d.y,d.z,d.w],f=["buffer","normalized","offset","stride"];1===l?e():2===l?h():(b("if(",l,"===",1,"){"),e(),b("}else{"),h(),b("}"))}var q=
a.shared;c.forEach(function(c){var q=c.name,m=l.attributes[q],h;if(m){if(!d(m))return;h=m.append(a,b)}else{if(!d(L))return;var n=a.scopeAttrib(q);h={};Object.keys(new ma).forEach(function(a){h[a]=b.def(n,".",a)})}g(a.link(c),e(c.info.type),h)})}function Aa(b,l,c,d,e){for(var g=b.shared,m=g.gl,q,h=0;h<d.length;++h){var A=d[h],r=A.name,F=A.info.type,f=c.uniforms[r],A=b.link(A)+".location",G;if(f){if(!e(f))continue;if(n(f)){r=f.value;if(35678===F||35680===F)F=b.link(r._texture),l(m,".uniform1i(",A,",",
F+".bind());"),l.exit(F,".unbind();");else if(35674===F||35675===F||35676===F)r=b.global.def("new Float32Array(["+Array.prototype.slice.call(r)+"])"),f=2,35675===F?f=3:35676===F&&(f=4),l(m,".uniformMatrix",f,"fv(",A,",false,",r,");");else{switch(F){case 5126:q="1f";break;case 35664:q="2f";break;case 35665:q="3f";break;case 35666:q="4f";break;case 35670:q="1i";break;case 5124:q="1i";break;case 35671:q="2i";break;case 35667:q="2i";break;case 35672:q="3i";break;case 35668:q="3i";break;case 35673:q="4i";
break;case 35669:q="4i"}l(m,".uniform",q,"(",A,",",x(r)?Array.prototype.slice.call(r):r,");")}continue}else G=f.append(b,l)}else{if(!e(L))continue;G=l.def(g.uniforms,"[",a.id(r),"]")}r=1;switch(F){case 35678:case 35680:F=l.def(G,"._texture");l(m,".uniform1i(",A,",",F,".bind());");l.exit(F,".unbind();");continue;case 5124:case 35670:q="1i";break;case 35667:case 35671:q="2i";r=2;break;case 35668:case 35672:q="3i";r=3;break;case 35669:case 35673:q="4i";r=4;break;case 5126:q="1f";break;case 35664:q="2f";
r=2;break;case 35665:q="3f";r=3;break;case 35666:q="4f";r=4;break;case 35674:q="Matrix2fv";break;case 35675:q="Matrix3fv";break;case 35676:q="Matrix4fv"}l(m,".uniform",q,"(",A,",");if("M"===q.charAt(0)){var A=Math.pow(F-35674+2,2),y=b.global.def("new Float32Array(",A,")");l("false,(Array.isArray(",G,")||",G," instanceof Float32Array)?",G,":(",t(A,function(a){return y+"["+a+"]="+G+"["+a+"]"}),",",y,")")}else 1<r?l(t(r,function(a){return G+"["+a+"]"})):l(G);l(");")}}function fa(a,b,l,c){function d(e){var g=
r[e];return g?g.contextDep&&c.contextDynamic||g.propDep?g.append(a,l):g.append(a,b):b.def(A,".",e)}function e(){function a(){l(B,".drawElementsInstancedANGLE(",[f,y,w,G+"<<(("+w+"-5121)>>1)",t],");")}function b(){l(B,".drawArraysInstancedANGLE(",[f,G,y,t],");")}F?v?a():(l("if(",F,"){"),a(),l("}else{"),b(),l("}")):b()}function g(){function a(){l(h+".drawElements("+[f,y,w,G+"<<(("+w+"-5121)>>1)"]+");")}function b(){l(h+".drawArrays("+[f,G,y]+");")}F?v?a():(l("if(",F,"){"),a(),l("}else{"),b(),l("}")):
b()}var m=a.shared,h=m.gl,A=m.draw,r=c.draw,F=function(){var d=r.elements,e=b;if(d){if(d.contextDep&&c.contextDynamic||d.propDep)e=l;d=d.append(a,e)}else d=e.def(A,".","elements");d&&e("if("+d+")"+h+".bindBuffer(34963,"+d+".buffer.buffer);");return d}(),f=d("primitive"),G=d("offset"),y=function(){var d=r.count,e=b;if(d){if(d.contextDep&&c.contextDynamic||d.propDep)e=l;d=d.append(a,e)}else d=e.def(A,".","count");return d}();if("number"===typeof y){if(0===y)return}else l("if(",y,"){"),l.exit("}");var t,
B;ba&&(t=d("instances"),B=a.instancing);var w=F+".type",v=r.elements&&n(r.elements);ba&&("number"!==typeof t||0<=t)?"string"===typeof t?(l("if(",t,">0){"),e(),l("}else if(",t,"<0){"),g(),l("}")):e():g()}function ga(a,b,l,c,d){b=O();d=b.proc("body",d);ba&&(b.instancing=d.def(b.shared.extensions,".angle_instanced_arrays"));a(b,d,l,c);return b.compile().body}function ka(a,b,l,c){S(a,b);za(a,b,l,c.attributes,function(){return!0});Aa(a,b,l,c.uniforms,function(){return!0});fa(a,b,b,l)}function Ha(a,b){var l=
a.proc("draw",1);S(a,l);R(a,l,b.context);K(a,l,b.framebuffer);Y(a,l,b);ea(a,l,b.state);ya(a,l,b,!1,!0);var c=b.shader.progVar.append(a,l);l(a.shared.gl,".useProgram(",c,".program);");if(b.shader.program)ka(a,l,b,b.shader.program);else{var d=a.global.def("{}"),e=l.def(c,".id"),g=l.def(d,"[",e,"]");l(a.cond(g).then(g,".call(this,a0);")["else"](g,"=",d,"[",e,"]=",a.link(function(l){return ga(ka,a,b,l,1)}),"(",c,");",g,".call(this,a0);"))}0<Object.keys(b.state).length&&l(a.shared.current,".dirty=true;")}
function Da(a,b,l,c){function d(){return!0}a.batchId="a1";S(a,b);za(a,b,l,c.attributes,d);Aa(a,b,l,c.uniforms,d);fa(a,b,b,l)}function Ba(a,b,l,c){function d(a){return a.contextDep&&g||a.propDep}function e(a){return!d(a)}S(a,b);var g=l.contextDep,m=b.def(),h=b.def();a.shared.props=h;a.batchId=m;var A=a.scope(),r=a.scope();b(A.entry,"for(",m,"=0;",m,"<","a1",";++",m,"){",h,"=","a0","[",m,"];",r,"}",A.exit);l.needsContext&&R(a,r,l.context);l.needsFramebuffer&&K(a,r,l.framebuffer);ea(a,r,l.state,d);l.profile&&
d(l.profile)&&ya(a,r,l,!1,!0);c?(za(a,A,l,c.attributes,e),za(a,r,l,c.attributes,d),Aa(a,A,l,c.uniforms,e),Aa(a,r,l,c.uniforms,d),fa(a,A,r,l)):(b=a.global.def("{}"),c=l.shader.progVar.append(a,r),h=r.def(c,".id"),A=r.def(b,"[",h,"]"),r(a.shared.gl,".useProgram(",c,".program);","if(!",A,"){",A,"=",b,"[",h,"]=",a.link(function(b){return ga(Da,a,l,b,2)}),"(",c,");}",A,".call(this,a0[",m,"],",m,");"))}function Ea(a,b){function l(a){return a.contextDep&&d||a.propDep}var c=a.proc("batch",2);a.batchId="0";
S(a,c);var d=!1,e=!0;Object.keys(b.context).forEach(function(a){d=d||b.context[a].propDep});d||(R(a,c,b.context),e=!1);var g=b.framebuffer,m=!1;g?(g.propDep?d=m=!0:g.contextDep&&d&&(m=!0),m||K(a,c,g)):K(a,c,null);b.state.viewport&&b.state.viewport.propDep&&(d=!0);Y(a,c,b);ea(a,c,b.state,function(a){return!l(a)});b.profile&&l(b.profile)||ya(a,c,b,!1,"a1");b.contextDep=d;b.needsContext=e;b.needsFramebuffer=m;e=b.shader.progVar;if(e.contextDep&&d||e.propDep)Ba(a,c,b,null);else if(e=e.append(a,c),c(a.shared.gl,
".useProgram(",e,".program);"),b.shader.program)Ba(a,c,b,b.shader.program);else{var g=a.global.def("{}"),m=c.def(e,".id"),h=c.def(g,"[",m,"]");c(a.cond(h).then(h,".call(this,a0,a1);")["else"](h,"=",g,"[",m,"]=",a.link(function(l){return ga(Ba,a,b,l,2)}),"(",e,");",h,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Fa(b,l){function c(a){var d=l.shader[a];d&&e.set(g.shader,"."+a,d.append(b,e))}var e=b.proc("scope",3);b.batchId="a2";var g=b.shared,m=g.current;
R(b,e,l.context);l.framebuffer&&l.framebuffer.append(b,e);d(Object.keys(l.state)).forEach(function(a){var c=l.state[a].append(b,e);x(c)?c.forEach(function(l,c){e.set(b.next[a],"["+c+"]",l)}):e.set(g.next,"."+a,c)});ya(b,e,l,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(a){var c=l.draw[a];c&&e.set(g.draw,"."+a,""+c.append(b,e))});Object.keys(l.uniforms).forEach(function(c){e.set(g.uniforms,"["+a.id(c)+"]",l.uniforms[c].append(b,e))});Object.keys(l.attributes).forEach(function(a){var c=
l.attributes[a].append(b,e),d=b.scopeAttrib(a);Object.keys(new ma).forEach(function(a){e.set(d,"."+a,c[a])})});c("vert");c("frag");0<Object.keys(l.state).length&&(e(m,".dirty=true;"),e.exit(m,".dirty=true;"));e("a1(",b.shared.context,",a0,0);")}var ma=E.Record,na={add:32774,subtract:32778,"reverse subtract":32779};J.ext_blend_minmax&&(na.min=32775,na.max=32776);var ba=J.angle_instanced_arrays,va=J.webgl_draw_buffers,X={dirty:!0,profile:Z.profile},l={},F=[],A={},ra={};P("dither",3024);P("blend.enable",
3042);M("blend.color","blendColor",[0,0,0,0]);M("blend.equation","blendEquationSeparate",[32774,32774]);M("blend.func","blendFuncSeparate",[1,0,1,0]);P("depth.enable",2929,!0);M("depth.func","depthFunc",513);M("depth.range","depthRange",[0,1]);M("depth.mask","depthMask",!0);M("colorMask","colorMask",[!0,!0,!0,!0]);P("cull.enable",2884);M("cull.face","cullFace",1029);M("frontFace","frontFace",2305);M("lineWidth","lineWidth",1);P("polygonOffset.enable",32823);M("polygonOffset.offset","polygonOffset",
[0,0]);P("sample.alpha",32926);P("sample.enable",32928);M("sample.coverage","sampleCoverage",[1,!1]);P("stencil.enable",2960);M("stencil.mask","stencilMask",-1);M("stencil.func","stencilFunc",[519,0,-1]);M("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);M("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);P("scissor.enable",3089);M("scissor.box","scissor",[0,0,f.drawingBufferWidth,f.drawingBufferHeight]);M("viewport","viewport",[0,0,f.drawingBufferWidth,f.drawingBufferHeight]);
var Ia={gl:f,context:wa,strings:a,next:l,current:X,draw:V,elements:N,buffer:z,shader:r,attributes:E.state,uniforms:ca,framebuffer:C,extensions:J,timer:G,isBufferArgs:e},Ca={primTypes:h,compareFuncs:m,blendFuncs:B,blendEquations:na,stencilOps:y,glTypes:v,orientationType:T};va&&(Ca.backBuffer=[1029],Ca.drawBuffer=t(p.maxDrawbuffers,function(a){return 0===a?[0]:t(a,function(a){return 36064+a})}));var Ka=0;return{next:l,current:X,procs:function(){var a=O(),b=a.proc("poll"),l=a.proc("refresh"),c=a.block();
b(c);l(c);var d=a.shared,e=d.gl,g=d.next,m=d.current;c(m,".dirty=false;");K(a,b);l(d.framebuffer,".dirty=true;");K(a,l);Object.keys(A).forEach(function(d){var h=A[d],r=c.def(g,".",d),F=a.block();F("if(",r,"){",e,".enable(",h,")}else{",e,".disable(",h,")}",m,".",d,"=",r,";");l(F);b("if(",r,"!==",m,".",d,"){",F,"}")});Object.keys(ra).forEach(function(d){var h=ra[d],r=X[d],A,F,n=a.block();n(e,".",h,"(");x(r)?(h=r.length,A=a.global.def(g,".",d),F=a.global.def(m,".",d),n(t(h,function(a){return A+"["+a+
"]"}),");",t(h,function(a){return F+"["+a+"]="+A+"["+a+"];"}).join("")),b("if(",t(h,function(a){return A+"["+a+"]!=="+F+"["+a+"]"}).join("||"),"){",n,"}")):(A=c.def(g,".",d),F=c.def(m,".",d),n(A,");",m,".",d,"=",A,";"),b("if(",A,"!==",F,"){",n,"}"));l(n)});return a.compile()}(),compile:function(a,b,l,c,d){var e=O();e.stats=e.link(d);d=ha(a);var g=sa(a,d),m=ia(a),h=ta(a),r=xa(a),A=g.viewport;A&&(h.viewport=A);A=W("scissor.box");(g=g[A])&&(h[A]=g);g=0<Object.keys(h).length;d={framebuffer:d,draw:m,shader:r,
state:h,dirty:g};d.profile=Q(a);d.uniforms=ja(l);d.attributes=aa(b);d.context=ua(c);Ha(e,d);Fa(e,d);Ea(e,d);return e.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],9:[function(f,p,u){function e(b,d){this.id=n++;this.type=b;this.data=d}function d(b){if(0===b.length)return[];var e=b.charAt(0),c=b.charAt(b.length-1);if(1<b.length&&e===c&&('"'===e||"'"===e))return['"'+
b.substr(1,b.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(e=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return d(b.substr(0,e.index)).concat(d(e[1])).concat(d(b.substr(e.index+e[0].length)));e=b.split(".");if(1===e.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(c=0;c<e.length;++c)b=b.concat(d(e[c]));return b}function w(b){return"["+d(b).join("][")+"]"}var n=0;p.exports={define:function(b,d){return new e(b,w(d+""))},isDynamic:function(b){return"function"===
typeof b&&!b._reglType||b instanceof e},unbox:function(b,d){return"function"===typeof b?new e(0,b):b},accessor:w}},{}],10:[function(f,p,u){var e=f("./util/is-typed-array"),d=f("./util/is-ndarray"),w=f("./util/values"),n=f("./constants/primitives.json"),b=f("./constants/usage.json");p.exports=function(g,c,f,p){function z(b){this.id=I++;v[this.id]=this;this.buffer=b;this.primType=4;this.type=this.vertCount=0}function x(b,g,m,h,a,n,w){(n=w)||e(g)&&(!d(g)||e(g.data))||(n=c.oes_element_index_uint?5125:
5123);b.buffer.bind();f._initBuffer(b.buffer,g,m,n,3);g=w;if(!w){switch(b.buffer.dtype){case 5121:case 5120:g=5121;break;case 5123:case 5122:g=5123;break;case 5125:case 5124:g=5125}b.buffer.dtype=g}b.type=g;0>a&&(a=b.buffer.byteLength,5123===g?a>>=1:5125===g&&(a>>=2));b.vertCount=a;a=h;0>h&&(a=4,h=b.buffer.dimension,1===h&&(a=0),2===h&&(a=1),3===h&&(a=4));b.primType=a}function h(b){p.elementsCount--;delete v[b.id];b.buffer.destroy();b.buffer=null}var v={},I=0,B={uint8:5121,uint16:5123};c.oes_element_index_uint&&
(B.uint32=5125);z.prototype.bind=function(){this.buffer.bind()};var m=[];return{create:function(c){function m(a){if(a)if("number"===typeof a)w(a),v.primType=4,v.vertCount=a|0,v.type=5121;else{var c=null,h=35044,f=-1,t=-1,y=0,p=0;Array.isArray(a)||e(a)||d(a)?c=a:("data"in a&&(c=a.data),"usage"in a&&(h=b[a.usage]),"primitive"in a&&(f=n[a.primitive]),"count"in a&&(t=a.count|0),"length"in a&&(y=a.length|0),"type"in a&&(p=B[a.type]));c?x(v,c,h,f,t,y,p):(a=v.buffer,a.bind(),g.bufferData(34963,y,h),a.dtype=
p||5121,a.usage=h,a.dimension=3,a.byteLength=y,v.primType=0>f?4:f,v.vertCount=0>t?0:t,v.type=a.dtype)}else w(),v.primType=4,v.vertCount=0,v.type=5121;return m}var w=f.create(null,34963,!0),v=new z(w._buffer);p.elementsCount++;m(c);m._reglType="elements";m._elements=v;m.subdata=function(a,b){w.subdata(a,b);return m};m.destroy=function(){h(v)};return m},createStream:function(b){var c=m.pop();c||(c=new z(f.create(null,34963,!0)._buffer));x(c,b,35040,-1,-1,0,0);return c},destroyStream:function(b){m.push(b)},
getElements:function(b){return"function"===typeof b&&b._elements instanceof z?b._elements:null},clear:function(){w(v).forEach(h)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],11:[function(f,p,u){p.exports=function(e,d){function f(b){b=b.toLowerCase();if(b in n)return!0;var d;try{d=n[b]=e.getExtension(b)}catch(g){}return!!d}for(var n={},b=0;b<d.extensions.length;++b){var g=d.extensions[b];if(!f(g))return d.onDestroy(),
d.onDone('"'+g+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}d.optionalExtensions.forEach(f);return{extensions:n,refresh:function(){d.extensions.forEach(f);d.optionalExtensions.forEach(f)}}}},{}],12:[function(f,p,u){var e=f("./util/values"),d=f("./util/extend"),w=[];w[6408]=4;var n=[];n[5121]=1;n[5126]=4;n[36193]=2;p.exports=function(b,g,c,f,p,z){function x(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var d=a=0;b?(a=
b.width,d=b.height):c&&(a=c.width,d=c.height);this.width=a;this.height=d}function h(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function v(a,b,c){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function I(a,c){c?c.texture?b.framebufferTexture2D(36160,a,c.target,c.texture._texture.texture,0):b.framebufferRenderbuffer(36160,a,36161,c.renderbuffer._renderbuffer.renderbuffer):b.framebufferTexture2D(36160,a,
3553,null,0)}function B(a){var b=3553,c=null,d=null,e=a;"object"===typeof a&&(e=a.data,"target"in a&&(b=a.target|0));a=e._reglType;"texture2d"===a?c=e:"textureCube"===a?c=e:"renderbuffer"===a&&(d=e,b=36161);return new x(b,c,d)}function m(a,b,c,d,e){if(c)return a=f.create2D({width:a,height:b,format:d,type:e}),a._texture.refCount=0,new x(3553,a,null);a=p.create({width:a,height:b,format:d});a._renderbuffer.refCount=0;return new x(36161,null,a)}function y(a){return a&&(a.texture||a.renderbuffer)}function u(a,
b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function L(){this.id=ca++;E[this.id]=this;this.framebuffer=b.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function H(a){a.colorAttachments.forEach(h);h(a.depthAttachment);h(a.stencilAttachment);h(a.depthStencilAttachment)}function a(a){b.deleteFramebuffer(a.framebuffer);a.framebuffer=null;z.framebufferCount--;delete E[a.id]}
function J(a){var d;b.bindFramebuffer(36160,a.framebuffer);var e=a.colorAttachments;for(d=0;d<e.length;++d)I(36064+d,e[d]);for(d=e.length;d<c.maxColorAttachments;++d)I(36064+d,null);I(36096,a.depthAttachment);I(36128,a.stencilAttachment);I(33306,a.depthStencilAttachment);b.checkFramebufferStatus(36160);b.bindFramebuffer(36160,oa.next);oa.current=oa.next}function la(b,c){function e(a,b){var c,d=0,f=0,r=!0,t=!0;c=null;var p=!0,x="rgba",z="uint8",C=1,N=null,I=null,la=null,u=!1;if("number"===typeof a)d=
a|0,f=b|0||d;else if(a){"shape"in a?(f=a.shape,d=f[0],f=f[1]):("radius"in a&&(d=f=a.radius),"width"in a&&(d=a.width),"height"in a&&(f=a.height));if("color"in a||"colors"in a)c=a.color||a.colors,Array.isArray(c);c||("colorCount"in a&&(C=a.colorCount|0),"colorTexture"in a&&(p=!!a.colorTexture,x="rgba4"),"colorType"in a&&(z=a.colorType,p||("half float"===z?g.ext_color_buffer_half_float&&(x="rgba16f"):"float"===z&&g.webgl_color_buffer_float&&(x="rgba32f"))),"colorFormat"in a&&(x=a.colorFormat,0<=pa.indexOf(x)?
p=!0:0<=U.indexOf(x)&&(p=!1)));if("depthTexture"in a||"depthStencilTexture"in a)u=!(!a.depthTexture&&!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?r=a.depth:(N=a.depth,t=!1));"stencil"in a&&("boolean"===typeof a.stencil?t=a.stencil:(I=a.stencil,r=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?r=t=a.depthStencil:(la=a.depthStencil,t=r=!1))}else d=f=1;var E=null,L=null,ea=null,S=null;if(Array.isArray(c))E=c.map(B);else if(c)E=[B(c)];else for(E=Array(C),c=0;c<C;++c)E[c]=
m(d,f,p,x,z);d=d||E[0].width;f=f||E[0].height;N?L=B(N):r&&!t&&(L=m(d,f,u,"depth","uint32"));I?ea=B(I):t&&!r&&(ea=m(d,f,!1,"stencil","uint8"));la?S=B(la):!N&&!I&&t&&r&&(S=m(d,f,u,"depth stencil","depth stencil"));r=null;for(c=0;c<E.length;++c)v(E[c],d,f),E[c]&&E[c].texture&&(t=w[E[c].texture._texture.format]*n[E[c].texture._texture.type],null===r&&(r=t));v(L,d,f);v(ea,d,f);v(S,d,f);H(h);h.width=d;h.height=f;h.colorAttachments=E;h.depthAttachment=L;h.stencilAttachment=ea;h.depthStencilAttachment=S;
e.color=E.map(y);e.depth=y(L);e.stencil=y(ea);e.depthStencil=y(S);e.width=h.width;e.height=h.height;J(h);return e}var h=new L;z.framebufferCount++;e(b,c);return d(e,{resize:function(a,b){var c=a|0,d=b|0||c;if(c===h.width&&d===h.height)return e;for(var g=h.colorAttachments,m=0;m<g.length;++m)u(g[m],c,d);u(h.depthAttachment,c,d);u(h.stencilAttachment,c,d);u(h.depthStencilAttachment,c,d);h.width=e.width=c;h.height=e.height=d;J(h);return e},_reglType:"framebuffer",_framebuffer:h,destroy:function(){a(h);
H(h)}})}var oa={current:null,next:null,dirty:!1},pa=["rgba"],U=["rgba4","rgb565","rgb5 a1"];g.ext_srgb&&U.push("srgba");g.ext_color_buffer_half_float&&U.push("rgba16f","rgb16f");g.webgl_color_buffer_float&&U.push("rgba32f");var C=["uint8"];g.oes_texture_half_float&&C.push("half float");g.oes_texture_float&&C.push("float");var ca=0,E={};return d(oa,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof L)?a:null},create:la,createCube:function(a){function b(a){var e=
{color:null},h=0,g=null,m="rgba",n="uint8",v=1;if("number"===typeof a)h=a|0;else if(a){"shape"in a?h=a.shape[0]:("radius"in a&&(h=a.radius|0),"width"in a?h=a.width|0:"height"in a&&(h=a.height|0));if("color"in a||"colors"in a)g=a.color||a.colors,Array.isArray(g);g||("colorCount"in a&&(v=a.colorCount|0),"colorType"in a&&(n=a.colorType),"colorFormat"in a&&(m=a.colorFormat));"depth"in a&&(e.depth=a.depth);"stencil"in a&&(e.stencil=a.stencil);"depthStencil"in a&&(e.depthStencil=a.depthStencil)}else h=
1;var r;if(g)if(Array.isArray(g))for(a=0;a<g.length;++a);else r=[g];else for(r=Array(v),g={radius:h,format:m,type:n},a=0;a<v;++a)r[a]=f.createCube(g);e.color=Array(r.length);for(a=0;a<r.length;++a)v=r[a],h=h||v.width,e.color[a]={target:34069,data:r[a]};for(a=0;6>a;++a){for(v=0;v<r.length;++v)e.color[v].target=34069+a;0<a&&(e.depth=c[0].depth,e.stencil=c[0].stencil,e.depthStencil=c[0].depthStencil);if(c[a])c[a](e);else c[a]=la(e)}return d(b,{width:h,height:h,color:r})}var c=Array(6);b(a);return d(b,
{faces:c,resize:function(a){for(var d=0;6>d;++d)c[d].resize(a);return b},_reglType:"framebufferCube",destroy:function(){c.forEach(function(a){a.destroy()})}})},clear:function(){e(E).forEach(a)}})}},{"./util/extend":23,"./util/values":31}],13:[function(f,p,u){p.exports=function(e,d){var f=1;d.ext_texture_filter_anisotropic&&(f=e.getParameter(34047));var n=1,b=1;d.webgl_draw_buffers&&(n=e.getParameter(34852),b=e.getParameter(36063));return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),
e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(d).filter(function(b){return!!d[b]}),maxAnisotropic:f,maxDrawbuffers:n,maxColorAttachments:b,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),
maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}}},{}],14:[function(f,p,u){var e=f("./util/is-typed-array");p.exports=function(d,f,n,b,g){return function(c){var g=0,f=0,w=b.framebufferWidth,x=b.framebufferHeight,
h=null;e(c)?h=c:c&&(g=c.x|0,f=c.y|0,w=(c.width||b.framebufferWidth-g)|0,x=(c.height||b.framebufferHeight-f)|0,h=c.data||null);n();h=h||new Uint8Array(w*x*4);d.pixelStorei(3333,4);d.readPixels(g,f,w,x,6408,5121,h);return h}}},{"./util/is-typed-array":26}],15:[function(f,p,u){var e=f("./util/values"),d=[];d[32854]=2;d[32855]=2;d[36194]=2;d[33189]=2;d[36168]=1;d[34041]=4;d[35907]=4;d[34836]=16;d[34842]=8;d[34843]=6;p.exports=function(f,n,b,g,c){function t(b){this.id=x++;this.refCount=1;this.renderbuffer=
b;this.format=32854;this.height=this.width=0;c.profile&&(this.stats={size:0})}function p(b){var c=b.renderbuffer;f.bindRenderbuffer(36161,null);f.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete h[b.id];g.renderbufferCount--}var z={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};n.ext_srgb&&(z.srgba=35907);n.ext_color_buffer_half_float&&(z.rgba16f=34842,z.rgb16f=34843);n.webgl_color_buffer_float&&(z.rgba32f=34836);var x=0,h={};t.prototype.decRef=
function(){0>=--this.refCount&&p(this)};c.profile&&(g.getTotalRenderbufferSize=function(){var b=0;Object.keys(h).forEach(function(c){b+=h[c].stats.size});return b});return{create:function(b,e){function n(b,e){var h=0,g=0,a=32854;"object"===typeof b&&b?("shape"in b?(g=b.shape,h=g[0]|0,g=g[1]|0):("radius"in b&&(h=g=b.radius|0),"width"in b&&(h=b.width|0),"height"in b&&(g=b.height|0)),"format"in b&&(a=z[b.format])):"number"===typeof b?(h=b|0,g="number"===typeof e?e|0:h):b||(h=g=1);if(h!==m.width||g!==
m.height||a!==m.format)return n.width=m.width=h,n.height=m.height=g,m.format=a,f.bindRenderbuffer(36161,m.renderbuffer),f.renderbufferStorage(36161,a,h,g),c.profile&&(m.stats.size=d[m.format]*m.width*m.height),n}var m=new t(f.createRenderbuffer());h[m.id]=m;g.renderbufferCount++;n(b,e);n.resize=function(b,e){var h=b|0,g=e|0||h;if(h===m.width&&g===m.height)return n;n.width=m.width=h;n.height=m.height=g;f.bindRenderbuffer(36161,m.renderbuffer);f.renderbufferStorage(36161,m.format,h,g);c.profile&&(m.stats.size=
d[m.format]*m.width*m.height);return n};n._reglType="renderbuffer";n._renderbuffer=m;c.profile&&(n.stats=m.stats);n.destroy=function(){m.decRef()};return n},clear:function(){e(h).forEach(p)}}}},{"./util/values":31}],16:[function(f,p,u){var e=f("./util/values");p.exports=function(d,f,n,b){function g(b,c,d,e){this.name=b;this.id=c;this.location=d;this.info=e}function c(b,c){for(var d=0;d<b.length;++d)if(b[d].id===c.id){b[d].location=c.location;return}b.push(c)}function t(b,c,e){e=35632===b?z:x;var h=
e[c];if(!h){var g=f.str(c),h=d.createShader(b);d.shaderSource(h,g);d.compileShader(h);e[c]=h}return h}function p(c,d){this.id=I++;this.fragId=c;this.vertId=d;this.program=null;this.uniforms=[];this.attributes=[];b.profile&&(this.stats={uniformsCount:0,attributesCount:0})}var z={},x={},h={},v=[],I=0;b.profile&&(n.getMaxUniformsCount=function(){var b=0;v.forEach(function(c){c.stats.uniformsCount>b&&(b=c.stats.uniformsCount)});return b},n.getMaxAttributesCount=function(){var b=0;v.forEach(function(c){c.stats.attributesCount>
b&&(b=c.stats.attributesCount)});return b});return{clear:function(){var b=d.deleteShader.bind(d);e(z).forEach(b);z={};e(x).forEach(b);x={};v.forEach(function(b){d.deleteProgram(b.program)});v.length=0;h={};n.shaderCount=0},program:function(e,m,x){n.shaderCount++;(x=h[m])||(x=h[m]={});var z=x[e];if(!z){var I=z=new p(m,e),u,a;u=t(35632,I.fragId);a=t(35633,I.vertId);m=I.program=d.createProgram();d.attachShader(m,u);d.attachShader(m,a);d.linkProgram(m);var J=d.getProgramParameter(m,35718);b.profile&&
(I.stats.uniformsCount=J);var la=I.uniforms;for(u=0;u<J;++u)if(a=d.getActiveUniform(m,u))if(1<a.size)for(var oa=0;oa<a.size;++oa){var pa=a.name.replace("[0]","["+oa+"]");c(la,new g(pa,f.id(pa),d.getUniformLocation(m,pa),a))}else c(la,new g(a.name,f.id(a.name),d.getUniformLocation(m,a.name),a));J=d.getProgramParameter(m,35721);b.profile&&(I.stats.attributesCount=J);I=I.attributes;for(u=0;u<J;++u)(a=d.getActiveAttrib(m,u))&&c(I,new g(a.name,f.id(a.name),d.getAttribLocation(m,a.name),a));x[e]=z;v.push(z)}return z},
shader:t,frag:null,vert:null}}},{"./util/values":31}],17:[function(f,p,u){p.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(f,p,u){p.exports=function(){var e={"":0},d=[""];return{id:function(f){var n=e[f];if(n)return n;n=e[f]=d.length;d.push(f);return n},str:function(e){return d[e]}}}},{}],19:[function(f,p,u){function e(a){return Array.isArray(a)&&(0===a.length||"number"===
typeof a[0])}function d(a){return Array.isArray(a)&&0!==a.length&&v(a[0])?!0:!1}function w(a){return Object.prototype.toString.call(a)}function n(a){if(!a)return!1;var b=w(a);return 0<=T.indexOf(b)?!0:e(a)||d(a)||z(a)}function b(a,b){36193===a.type?(a.data=h(b),x.freeType(b)):a.data=b}function g(a,b,c,d,e,h){a="undefined"!==typeof H[a]?H[a]:y[a]*L[b];h&&(a*=6);if(e){for(d=0;1<=c;)d+=a*c*c,c/=2;return d}return a*c*d}var c=f("./util/extend"),t=f("./util/values"),N=f("./util/is-typed-array"),z=f("./util/is-ndarray"),
x=f("./util/pool"),h=f("./util/to-half-float"),v=f("./util/is-array-like");u=f("./constants/arraytypes.json");var I=f("./constants/arraytypes.json"),B=[9984,9986,9985,9987],m=[0,6409,6410,6407,6408],y={};y[6409]=y[6406]=y[6402]=1;y[34041]=y[6410]=2;y[6407]=y[35904]=3;y[6408]=y[35906]=4;var T=Object.keys(u).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),L=[];L[5121]=1;L[5126]=4;L[36193]=2;L[5123]=2;L[5125]=4;var H=
[];H[32854]=2;H[32855]=2;H[36194]=2;H[34041]=4;H[33776]=.5;H[33777]=.5;H[33778]=1;H[33779]=1;H[35986]=.5;H[35987]=1;H[34798]=1;H[35840]=.5;H[35841]=.25;H[35842]=.5;H[35843]=.25;H[36196]=.5;p.exports=function(a,f,p,u,H,U,C){function ca(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function E(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;
a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function r(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=Aa[b.colorSpace]);"type"in b&&(a.type=fa[b.type]);var c=a.width,d=a.height,e=a.channels,
h=!1;"shape"in b?(c=b.shape[0],d=b.shape[1],3===b.shape.length&&(e=b.shape[2],h=!0)):("radius"in b&&(c=d=b.radius),"width"in b&&(c=b.width),"height"in b&&(d=b.height),"channels"in b&&(e=b.channels,h=!0));a.width=c|0;a.height=d|0;a.channels=e|0;c=!1;"format"in b&&(c=b.format,d=a.internalformat=ga[c],a.format=Ba[d],c in fa&&!("type"in b)&&(a.type=fa[c]),c in ka&&(a.compressed=!0),c=!0);!h&&c?a.channels=y[a.format]:h&&!c&&a.channels!==m[a.format]&&(a.format=a.internalformat=m[a.channels])}}function V(b){a.pixelStorei(37440,
b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function L(){ca.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function G(a,c){var g=null;n(c)?g=c:c&&(r(a,c),"x"in c&&(a.xOffset=c.x|0),"y"in c&&(a.yOffset=c.y|0),n(c.data)&&(g=c.data));if(c.copy){var f=H.viewportWidth,t=H.viewportHeight;a.width=a.width||f-a.xOffset;a.height=a.height||t-a.yOffset;a.needsCopy=!0}else if(!g)a.width=
a.width||1,a.height=a.height||1;else if(N(g))a.data=g,"type"in c||5121!==a.type||(a.type=I[Object.prototype.toString.call(g)]|0);else if(e(g)){f=g;t=a.width*a.height*a.channels;switch(a.type){case 5121:case 5123:case 5125:case 5126:t=x.allocType(a.type,t);t.set(f);a.data=t;break;case 36193:a.data=h(f)}a.alignment=1;a.needsFree=!0}else if(z(g)){f=g.data;Array.isArray(f)||5121!==a.type||(a.type=I[Object.prototype.toString.call(f)]|0);var t=g.shape,p=g.stride,C,k,D,B;3===t.length?(D=t[2],B=p[2]):B=D=
1;C=t[0];k=t[1];t=p[0];p=p[1];a.alignment=1;a.width=C;a.height=k;a.channels=D;a.format=a.internalformat=m[D];a.needsFree=!0;C=B;g=g.offset;D=a.width;B=a.height;k=a.channels;for(var y=x.allocType(36193===a.type?5126:a.type,D*B*k),u=0,J=0;J<B;++J)for(var E=0;E<D;++E)for(var q=0;q<k;++q)y[u++]=f[t*E+p*J+C*q+g];b(a,y)}else if("[object HTMLCanvasElement]"===w(g)||"[object CanvasRenderingContext2D]"===w(g))"[object HTMLCanvasElement]"===w(g)?a.element=g:a.element=g.canvas,a.width=a.element.width,a.height=
a.element.height;else if("[object HTMLImageElement]"===w(g))a.element=g,a.width=g.naturalWidth,a.height=g.naturalHeight;else if("[object HTMLVideoElement]"===w(g))a.element=g,a.width=g.videoWidth,a.height=g.videoHeight,a.needsPoll=!0;else if(d(g)){f=g[0].length;t=g.length;p=1;if(v(g[0][0])){C=p=g[0][0].length;D=x.allocType(36193===a.type?5126:a.type,f*t*C);for(k=B=0;k<t;++k)for(y=g[k],u=0;u<f;++u)for(J=y[u],E=0;E<C;++E)D[B++]=J[E];b(a,D)}else{C=x.allocType(36193===a.type?5126:a.type,f*t);for(B=D=
0;B<t;++B)for(k=g[B],y=0;y<f;++y)C[D++]=k[y];b(a,C)}a.alignment=1;a.width=f;a.height=t;a.channels=p;a.format=a.internalformat=m[p];a.needsFree=!0}}function T(b,c,d,e,g){var h=b.element,m=b.data,k=b.internalformat,f=b.format,n=b.type,t=b.width,r=b.height;V(b);h?a.texSubImage2D(c,g,d,e,f,n,h):b.compressed?a.compressedTexSubImage2D(c,g,d,e,k,t,r,m):b.needsCopy?(u(),a.copyTexSubImage2D(c,g,d,e,b.xOffset,b.yOffset,t,r)):a.texSubImage2D(c,g,d,e,t,r,f,n,m)}function W(){return Ea.pop()||new L}function P(a){a.needsFree&&
x.freeType(a.data);L.call(a);Ea.push(a)}function M(){ca.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function O(a,b,c){var d=a.images[0]=W();a.mipmask=1;d.width=a.width=b;d.height=a.height=c}function Q(a,b){var c=null;if(n(b))c=a.images[0]=W(),E(c,a),G(c,b),a.mipmask=1;else if(r(a,b),Array.isArray(b.mipmap))for(var d=b.mipmap,e=0;e<d.length;++e)c=a.images[e]=W(),E(c,a),c.width>>=e,c.height>>=e,G(c,d[e]),a.mipmask|=1<<e;else c=a.images[0]=W(),E(c,a),G(c,b),
a.mipmask=1;E(a,a.images[0])}function ha(b,c){for(var d=b.images,e=0;e<d.length&&d[e];++e){var g=d[e],h=c,m=e,k=g.element,f=g.data,n=g.internalformat,t=g.format,r=g.type,v=g.width,p=g.height;V(g);k?a.texImage2D(h,m,t,t,r,k):g.compressed?a.compressedTexImage2D(h,m,n,v,p,0,f):g.needsCopy?(u(),a.copyTexImage2D(h,m,t,g.xOffset,g.yOffset,v,p,0)):a.texImage2D(h,m,t,v,p,0,t,r,f)}}function sa(){var a=Fa.pop()||new M;ca.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function xa(a){for(var b=
a.images,c=0;c<b.length;++c)b[c]&&P(b[c]),b[c]=null;Fa.push(a)}function ia(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ta(a,b){"min"in b&&(a.minFilter=za[b.min],0<=B.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=ya[b.mag]);var c=a.wrapS,d=a.wrapT;if("wrap"in b){var e=b.wrap;"string"===typeof e?c=d=S[e]:Array.isArray(e)&&(c=S[e[0]],d=S[e[1]])}else"wrapS"in b&&(c=S[b.wrapS]),"wrapT"in b&&(d=S[b.wrapT]);
a.wrapS=c;a.wrapT=d;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=ea[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function ja(b,c){a.texParameteri(c,10241,b.minFilter);a.texParameteri(c,10240,b.magFilter);a.texParameteri(c,10242,b.wrapS);a.texParameteri(c,10243,b.wrapT);f.ext_texture_filter_anisotropic&&a.texParameteri(c,
34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(c))}function aa(){var a=ma.pop()||new ia;ia.call(a);return a}function ua(b){ca.call(this);this.mipmask=0;this.internalformat=6408;this.id=na++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;C.profile&&(this.stats={size:0})}function R(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function K(){var b=X[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}
function Y(b){var c=b.texture,d=b.unit,e=b.target;0<=d&&(a.activeTexture(33984+d),a.bindTexture(e,null),X[d]=null);a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete ba[b.id];U.textureCount--}var ea={"don't care":4352,"dont care":4352,nice:4354,fast:4353},S={repeat:10497,clamp:33071,mirror:33648},ya={nearest:9728,linear:9729},za=c({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ya),Aa=
{none:0,browser:37444},fa={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},ga={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ka={};f.ext_srgb&&(ga.srgb=35904,ga.srgba=35906);f.oes_texture_float&&(fa["float"]=5126);f.oes_texture_half_float&&(fa.float16=fa["half float"]=36193);f.webgl_depth_texture&&(c(ga,{depth:6402,"depth stencil":34041}),c(fa,{uint16:5123,uint32:5125,"depth stencil":34042}));f.webgl_compressed_texture_s3tc&&c(ka,
{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});f.webgl_compressed_texture_atc&&c(ka,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});f.webgl_compressed_texture_pvrtc&&c(ka,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});f.webgl_compressed_texture_etc1&&(ka["rgb etc1"]=36196);var Ha=Array.prototype.slice.call(a.getParameter(34467));Object.keys(ka).forEach(function(a){var b=
ka[a];0<=Ha.indexOf(b)&&(ga[a]=b)});var Da=Object.keys(ga);p.textureFormats=Da;var Ba=Da.reduce(function(a,b){var c=ga[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),Ea=[],Fa=[],ma=[],na=0,ba={},va=p.maxTextureUnits,X=Array(va).map(function(){return null});c(ua.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<va;++c){var d=X[c];if(d){if(0<d.bindCount)continue;d.unit=-1}X[c]=this;
b=c;break}C.profile&&U.maxTextureUnits<b+1&&(U.maxTextureUnits=b+1);this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&Y(this)}});C.profile&&(U.getTotalTextureSize=function(){var a=0;Object.keys(ba).forEach(function(b){a+=ba[b].stats.size});return a});return{create2D:function(b,c){function d(a,b){var c=aa(),h=sa();"number"===typeof a?"number"===typeof b?O(h,a|0,b|0):O(h,a|0,a|0):a?(ta(c,a),
Q(h,a)):O(h,1,1);c.genMipmaps&&(h.mipmask=(h.width<<1)-1);e.mipmask=h.mipmask;E(e,h);e.internalformat=h.internalformat;d.width=h.width;d.height=h.height;R(e);ha(h,3553);ja(c,3553);K();ma.push(c);xa(h);C.profile&&(e.stats.size=g(e.internalformat,e.type,h.width,h.height,c.genMipmaps,!1));return d}var e=new ua(3553);ba[e.id]=e;U.textureCount++;d(b,c);d.subimage=function(a,b,c,g){b|=0;c|=0;g|=0;var h=W();E(h,e);h.width>>=g;h.height>>=g;h.width-=b;h.height-=c;G(h,a);R(e);T(h,3553,b,c,g);K();P(h);return d};
d.resize=function(b,c){var h=b|0,k=c|0||h;if(h===e.width&&k===e.height)return d;d.width=e.width=h;d.height=e.height=k;R(e);a.texImage2D(3553,0,e.format,h,k,0,e.format,e.type,null);K();C.profile&&(e.stats.size=g(e.internalformat,e.type,h,k,!1,!1));return d};d._reglType="texture2d";d._texture=e;C.profile&&(d.stats=e.stats);d.destroy=function(){e.decRef()};return d},createCube:function(b,c,d,e,h,m){function f(a,b,c,d,e,h){var l,m=aa();for(l=0;6>l;++l)n[l]=sa();if("number"===typeof a||!a)for(a=a|0||1,
l=0;6>l;++l)O(n[l],a,a);else if("object"===typeof a)if(b)Q(n[0],a),Q(n[1],b),Q(n[2],c),Q(n[3],d),Q(n[4],e),Q(n[5],h);else if(ta(m,a),r(k,a),"faces"in a)for(a=a.faces,l=0;6>l;++l)E(n[l],k),Q(n[l],a[l]);else for(l=0;6>l;++l)Q(n[l],a);E(k,n[0]);k.mipmask=m.genMipmaps?(n[0].width<<1)-1:n[0].mipmask;k.internalformat=n[0].internalformat;f.width=n[0].width;f.height=n[0].height;R(k);for(l=0;6>l;++l)ha(n[l],34069+l);ja(m,34067);K();C.profile&&(k.stats.size=g(k.internalformat,k.type,f.width,f.height,m.genMipmaps,
!0));ma.push(m);for(l=0;6>l;++l)xa(n[l]);return f}var k=new ua(34067);ba[k.id]=k;U.cubeCount++;var n=Array(6);f(b,c,d,e,h,m);f.subimage=function(a,b,c,d,e){c|=0;d|=0;e|=0;var h=W();E(h,k);h.width>>=e;h.height>>=e;h.width-=c;h.height-=d;G(h,b);R(k);T(h,34069+a,c,d,e);K();P(h);return f};f.resize=function(b){b|=0;if(b!==k.width){f.width=k.width=b;f.height=k.height=b;R(k);for(var c=0;6>c;++c)a.texImage2D(34069+c,0,k.format,b,b,0,k.format,k.type,null);K();C.profile&&(k.stats.size=g(k.internalformat,k.type,
f.width,f.height,!1,!0));return f}};f._reglType="textureCube";f._texture=k;C.profile&&(f.stats=k.stats);f.destroy=function(){k.decRef()};return f},clear:function(){for(var b=0;b<va;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),X[b]=null;t(ba).forEach(Y);U.cubeCount=0;U.textureCount=0},getTexture:function(a){return null}}}},{"./constants/arraytypes.json":4,"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/to-half-float":30,
"./util/values":31}],20:[function(f,p,u){p.exports=function(e,d){function f(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function n(b,c,d){var e=t.pop()||new f;e.startQueryIndex=b;e.endQueryIndex=c;e.sum=0;e.stats=d;p.push(e)}var b=d.ext_disjoint_timer_query;if(!b)return null;var g=[],c=[],t=[],p=[],z=[],x=[];return{beginQuery:function(d){var e=g.pop()||b.createQueryEXT();b.beginQueryEXT(35007,e);c.push(e);n(c.length-1,c.length,d)},endQuery:function(){b.endQueryEXT(35007)},
pushScopeStats:n,update:function(){var d,e;d=c.length;if(0!==d){x.length=Math.max(x.length,d+1);z.length=Math.max(z.length,d+1);z[0]=0;var f=x[0]=0;for(e=d=0;e<c.length;++e){var n=c[e];b.getQueryObjectEXT(n,34919)?(f+=b.getQueryObjectEXT(n,34918),g.push(n)):c[d++]=n;z[e+1]=f;x[e+1]=d}c.length=d;for(e=d=0;e<p.length;++e){var f=p[e],m=f.startQueryIndex,n=f.endQueryIndex;f.sum+=z[n]-z[m];m=x[m];n=x[n];n===m?(f.stats.gpuTime+=f.sum/1E6,t.push(f)):(f.startQueryIndex=m,f.endQueryIndex=n,p[d++]=f)}p.length=
d}},getNumPendingQueries:function(){return c.length},clear:function(){g.push.apply(g,c);for(var d=0;d<g.length;d++)b.deleteQueryEXT(g[d]);c.length=0;g.length=0}}}},{}],21:[function(f,p,u){p.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(f,p,u){function e(d){return Array.prototype.slice.call(d)}function d(d){return e(d).join("")}var w=f("./extend");p.exports=function(){function f(){var b=[],c=[];return w(function(){b.push.apply(b,
e(arguments))},{def:function(){var d="v"+g++;c.push(d);0<arguments.length&&(b.push(d,"="),b.push.apply(b,e(arguments)),b.push(";"));return d},toString:function(){return d([0<c.length?"var "+c+";":"",d(b)])}})}function b(){function b(e,g){d(e,g,"=",c.def(e,g),";")}var c=f(),d=f(),g=c.toString,t=d.toString;return w(function(){c.apply(c,e(arguments))},{def:c.def,entry:c,exit:d,save:b,set:function(d,e,g){b(d,e);c(d,e,"=",g,";")},toString:function(){return g()+t()}})}var g=0,c=[],t=[],p=f(),z={};return{global:p,
link:function(b){for(var d=0;d<t.length;++d)if(t[d]===b)return c[d];d="g"+g++;c.push(d);t.push(b);return d},block:f,proc:function(c,e){function g(){var b="a"+f.length;f.push(b);return b}var f=[];e=e||0;for(var n=0;n<e;++n)g();var n=b(),m=n.toString;return z[c]=w(n,{arg:g,toString:function(){return d(["function(",f.join(),"){",m(),"}"])}})},scope:b,cond:function(){var c=d(arguments),g=b(),f=b(),n=g.toString,t=f.toString;return w(g,{then:function(){g.apply(g,e(arguments));return this},"else":function(){f.apply(f,
e(arguments));return this},toString:function(){var b=t();b&&(b="else{"+b+"}");return d(["if(",c,"){",n(),"}",b])}})},compile:function(){var b=['"use strict";',p,"return {"];Object.keys(z).forEach(function(c){b.push('"',c,'":',z[c].toString(),",")});b.push("}");var e=d(b).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,c.concat(e)).apply(null,t)}}}},{"./extend":23}],23:[function(f,p,u){p.exports=function(e,d){for(var f=Object.keys(d),n=0;n<f.length;++n)e[f[n]]=
d[f[n]];return e}},{}],24:[function(f,p,u){var e=f("./is-typed-array");p.exports=function(d){return Array.isArray(d)||e(d)}},{"./is-typed-array":26}],25:[function(f,p,u){var e=f("./is-typed-array");p.exports=function(d){return!!d&&"object"===typeof d&&Array.isArray(d.shape)&&Array.isArray(d.stride)&&"number"===typeof d.offset&&d.shape.length===d.stride.length&&(Array.isArray(d.data)||e(d.data))}},{"./is-typed-array":26}],26:[function(f,p,u){var e=f("../constants/arraytypes.json");p.exports=function(d){return Object.prototype.toString.call(d)in
e}},{"../constants/arraytypes.json":4}],27:[function(f,p,u){p.exports=function(e,d){for(var f=Array(e),n=0;n<e;++n)f[n]=d(n);return f}},{}],28:[function(f,p,u){function e(b){var d,c;d=(65535<b)<<4;b>>>=d;c=(255<b)<<3;b>>>=c;d|=c;c=(15<b)<<2;b>>>=c;d|=c;c=(3<b)<<1;return d|c|b>>>c>>1}function d(b){a:{for(var d=16;268435456>=d;d*=16)if(b<=d){b=d;break a}b=0}d=n[e(b)>>2];return 0<d.length?d.pop():new ArrayBuffer(b)}function w(b){n[e(b.byteLength)>>2].push(b)}var n=f("./loop")(8,function(){return[]});
p.exports={alloc:d,free:w,allocType:function(b,e){var c=null;switch(b){case 5120:c=new Int8Array(d(e),0,e);break;case 5121:c=new Uint8Array(d(e),0,e);break;case 5122:c=new Int16Array(d(2*e),0,e);break;case 5123:c=new Uint16Array(d(2*e),0,e);break;case 5124:c=new Int32Array(d(4*e),0,e);break;case 5125:c=new Uint32Array(d(4*e),0,e);break;case 5126:c=new Float32Array(d(4*e),0,e);break;default:return null}return c.length!==e?c.subarray(0,e):c},freeType:function(b){w(b.buffer)}}},{"./loop":27}],29:[function(f,
p,u){p.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:{next:function(e){return setTimeout(e,16)},cancel:clearTimeout}},{}],30:[function(f,p,u){var e=f("./pool"),d=new Float32Array(1),w=new Uint32Array(d.buffer);p.exports=function(f){for(var b=e.allocType(5123,f.length),g=0;g<f.length;++g)if(isNaN(f[g]))b[g]=65535;else if(Infinity===f[g])b[g]=31744;else if(-Infinity===
f[g])b[g]=64512;else{d[0]=f[g];var c=w[0],t=c>>>31<<15,p=(c<<1>>>24)-127,c=c>>13&1023;b[g]=-24>p?t:-14>p?t+(c+1024>>-14-p):15<p?t+31744:t+(p+15<<10)+c}return b}},{"./pool":28}],31:[function(f,p,u){p.exports=function(e){return Object.keys(e).map(function(d){return e[d]})}},{}],32:[function(f,p,u){function e(d,c,e){function f(){var c=window.innerWidth,h=window.innerHeight;d!==document.body&&(h=d.getBoundingClientRect(),c=h.right-h.left,h=h.top-h.bottom);n.width=e*c;n.height=e*h;b(n.style,{width:c+"px",
height:h+"px"})}var n=document.createElement("canvas");b(n.style,{border:0,margin:0,padding:0,top:0,left:0});d.appendChild(n);d===document.body&&(n.style.position="absolute",b(d.style,{margin:0,padding:0}));window.addEventListener("resize",f,!1);f();return{canvas:n,onDestroy:function(){window.removeEventListener("resize",f);d.removeChild(n)}}}function d(b,c){function d(e){try{return b.getContext(e,c)}catch(f){return null}}return d("webgl")||d("experimental-webgl")||d("webgl-experimental")}function w(b){return"string"===
typeof b?b.split():b}function n(b){return"string"===typeof b?document.querySelector(b):b}var b=f("./util/extend");p.exports=function(b){var c=b||{},f,p,z,x;b={};var h=[],v=[],u="undefined"===typeof window?1:window.devicePixelRatio,B=!1,m=function(b){},y=function(){};"string"===typeof c?f=document.querySelector(c):"object"===typeof c&&("string"===typeof c.nodeName&&"function"===typeof c.appendChild&&"function"===typeof c.getBoundingClientRect?f=c:"function"===typeof c.drawArrays||"function"===typeof c.drawElements?
(x=c,z=x.canvas):("gl"in c?x=c.gl:"canvas"in c?z=n(c.canvas):"container"in c&&(p=n(c.container)),"attributes"in c&&(b=c.attributes),"extensions"in c&&(h=w(c.extensions)),"optionalExtensions"in c&&(v=w(c.optionalExtensions)),"onDone"in c&&(m=c.onDone),"profile"in c&&(B=!!c.profile),"pixelRatio"in c&&(u=+c.pixelRatio)));f&&("canvas"===f.nodeName.toLowerCase()?z=f:p=f);if(!x){if(!z){f=e(p||document.body,m,u);if(!f)return null;z=f.canvas;y=f.onDestroy}x=d(z,b)}return x?{gl:x,canvas:z,container:p,extensions:h,
optionalExtensions:v,pixelRatio:u,profile:B,onDone:m,onDestroy:y}:(y(),m("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/extend":23}],33:[function(f,p,u){p.exports=function(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}},{}],34:[function(f,p,u){var e=f("./identity");p.exports=function(d,f,n,b){var g,c,p,u,z,x,h,v,I=f[0],B=f[1];f=f[2];p=b[0];u=b[1];c=b[2];
h=n[0];b=n[1];g=n[2];if(1E-6>Math.abs(I-h)&&1E-6>Math.abs(B-b)&&1E-6>Math.abs(f-g))return e(d);n=I-h;b=B-b;h=f-g;v=1/Math.sqrt(n*n+b*b+h*h);n*=v;b*=v;h*=v;g=u*h-c*b;c=c*n-p*h;p=p*b-u*n;(v=Math.sqrt(g*g+c*c+p*p))?(v=1/v,g*=v,c*=v,p*=v):p=c=g=0;u=b*p-h*c;z=h*g-n*p;x=n*c-b*g;(v=Math.sqrt(u*u+z*z+x*x))?(v=1/v,u*=v,z*=v,x*=v):x=z=u=0;d[0]=g;d[1]=u;d[2]=n;d[3]=0;d[4]=c;d[5]=z;d[6]=b;d[7]=0;d[8]=p;d[9]=x;d[10]=h;d[11]=0;d[12]=-(g*I+c*B+p*f);d[13]=-(u*I+z*B+x*f);d[14]=-(n*I+b*B+h*f);d[15]=1;return d}},{"./identity":33}],
35:[function(f,p,u){p.exports=function(e,d,f,n,b){d=1/Math.tan(d/2);var g=1/(n-b);e[0]=d/f;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=d;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=(b+n)*g;e[11]=-1;e[12]=0;e[13]=0;e[14]=2*b*n*g;e[15]=0;return e}},{}],36:[function(f,p,u){function e(b){throw Error("resl: "+b);}function d(b,d,f){Object.keys(b).forEach(function(b){0>d.indexOf(b)&&e('invalid parameter "'+b+'" in '+f)})}function w(b,d){this.state=0;this.ready=!1;this.progress=0;this.name=b;this.cancel=d}var n=["manifest","onDone",
"onProgress","onError"],b=["type","src","stream","credentials","parser"],g=["onData","onDone"];p.exports=function(c){function f(a,b){if(a in c){var d=c[a];"function"!==typeof d&&e('invalid callback "'+a+'"');return d}return null}function p(a){function b(){if(!(2>g.readyState||1===n.state||-1===n.state)){if(200!==g.status)return x('error loading resource "'+a.name+'"');if(2<g.readyState&&0===n.state){var d;d="binary"===a.type?g.response:g.responseText;if(f.data)try{m=f.data(d)}catch(e){return x(e)}else m=
d}if(3<g.readyState&&0===n.state){if(f.done)try{m=f.done()}catch(e){return x(e)}n.state=1}y[c]=m;n.progress=.75*n.progress+.25;n.ready=a.stream&&!!m||1===n.state;h()}}var c=a.name,d=a.stream,e="binary"===a.type,f=a.parser,g=new XMLHttpRequest,m=null,n=new w(c,function(){1!==n.state&&-1!==n.state&&(g.onreadystatechange=null,g.abort(),n.state=-1)});g.onreadystatechange=d?b:function(){4===g.readyState&&b()};e&&(g.responseType="arraybuffer");a.credentials&&(g.withCredentials=!0);g.open("GET",a.src,!0);
g.send();return n}function u(a,b){function c(){if(0===p.state)if(n.data)try{t=n.data(b)}catch(a){return x(a)}else t=b}function d(b){c();y[m]=t;p.progress=b.lengthComputable?Math.max(p.progress,b.loaded/b.total):.75*p.progress+.25;p.ready=a.stream;h(m)}function e(){c();if(0===p.state){if(n.done)try{t=n.done()}catch(a){return x(a)}p.state=1}p.progress=1;p.ready=!0;y[m]=t;g();h("finish "+m)}function f(){x('error loading asset "'+m+'"')}function g(){a.stream&&b.removeEventListener("progress",d);"image"===
a.type?b.addEventListener("load",e):b.addEventListener("canplay",e);b.removeEventListener("error",f)}var m=a.name,n=a.parser,p=new w(m,function(){1!==p.state&&-1!==p.state&&(p.state=-1,g(),b.src="")}),t=b;a.stream&&b.addEventListener("progress",d);"image"===a.type?b.addEventListener("load",e):b.addEventListener("canplay",e);b.addEventListener("error",f);b.crossOrigin=a.credentials?"use-credentials":"anonymous";b.src=a.src;return p}function x(a){-1!==T&&1!==T&&(T=-1,H.forEach(function(a){a.cancel()}),
m?"string"===typeof a?m(Error("resl: "+a)):m(a):console.error("resl error:",a))}function h(a){if(-1!==T&&1!==T){var b=0,c=0;H.forEach(function(a){a.ready&&(c+=1);b+=a.progress});c===H.length?(T=1,I(y)):B&&B(b/H.length,a)}}"object"===typeof c&&c||e("invalid or missing configuration");d(c,n,"config");var v=c.manifest;"object"===typeof v&&v||e("missing manifest");var I=f("onDone");I||e("missing onDone() callback");var B=f("onProgress"),m=f("onError"),y={},T=0,L={text:p,binary:function(a){return p(a)},
image:function(a){return u(a,document.createElement("img"))},video:function(a){return u(a,document.createElement("video"))},audio:function(a){return u(a,document.createElement("audio"))}},H=Object.keys(v).map(function(a){function c(a,b){if(a in f.parser){var d=f.parser[a];"function"!==typeof d&&e("invalid parser callback "+a+' for asset "'+a+'"');return d}return b}var f=v[a];"string"===typeof f?f={src:f}:"object"===typeof f&&f||e('invalid asset definition "'+a+'"');d(f,b,'asset "'+a+'"');var h={};
"parser"in f&&("function"===typeof f.parser?h={data:f.parser}:"object"===typeof f.parser&&f.parser?(d(h,g,'parser for asset "'+a+'"'),"onData"in h||e('missing onData callback for parser in asset "'+a+'"'),h={data:c("onData"),done:c("onDone")}):e('invalid parser for asset "'+a+'"'));return{name:a,type:function(b,c,d){b in f&&(d=f[b]);0>c.indexOf(d)&&e("invalid "+b+' "'+d+'" for asset "'+a+'", possible values: '+c);return d}("type",Object.keys(L),"text"),stream:!!f.stream,credentials:!!f.credentials,
src:function(b,c,d){b in f?d=f[b]:c&&e("missing "+b+' for asset "'+a+'"');"string"!==typeof d&&e("invalid "+b+' for asset "'+a+'", must be a string');return d}("src",!0,""),parser:h}}).map(function(a){return L[a.type](a)})}},{}],37:[function(f,p,u){function e(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var d=f("./lib/util/extend"),w=f("./lib/dynamic"),n=f("./lib/util/raf"),b=f("./lib/util/clock"),g=f("./lib/strings"),c=f("./lib/webgl"),t=f("./lib/extension"),N=f("./lib/limits"),
z=f("./lib/buffer"),x=f("./lib/elements"),h=f("./lib/texture"),v=f("./lib/renderbuffer"),I=f("./lib/framebuffer"),B=f("./lib/attribute"),m=f("./lib/shader"),y=f("./lib/read"),T=f("./lib/core"),L=f("./lib/stats"),H=f("./lib/timer");p.exports=function(a){function f(){if(0===K.length)Z&&Z.update(),Y=null;else{Y=n.next(f);C();for(var a=K.length-1;0<=a;--a){var b=K[a];b&&b(O,null,0)}r.flush();Z&&Z.update()}}function p(a){}function u(a){}function pa(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=
a[b];w.isDynamic(e)?d[b]=w.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;r.length<a;)r.push(null);return r}var e=b(a.context||{}),f=b(a.uniforms||{}),g=b(a.attributes||{}),h=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=d({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,
count:0};var e=aa.compile(h,g,f,e,a),m=e.draw,n=e.batch,p=e.scope,r=[];return d(function(a,b){var d;if("function"===typeof a)return p.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)p.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)p.call(this,a[d],b,d);else return p.call(this,a,b,0);else if("number"===typeof a){if(0<a)return n.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return n.call(this,a,a.length)}else return m.call(this,
a)},{stats:a})}function U(){var a=ua.viewport,b=ua.scissor_box;a[0]=a[1]=b[0]=b[1]=0;O.viewportWidth=O.framebufferWidth=O.drawingBufferWidth=a[2]=b[2]=r.drawingBufferWidth;O.viewportHeight=O.framebufferHeight=O.drawingBufferHeight=a[3]=b[3]=r.drawingBufferHeight}function C(){O.tick+=1;O.time=(b()-W)/1E3;U();aa.procs.poll()}function ca(){U();aa.procs.refresh();Z&&Z.update()}var E=c(a);if(!E)return null;var r=E.gl;a=r.getContextAttributes();var V=t(r,E);if(!V)return null;var wa=g(),G=L(),V=V.extensions,
Z=H(r,V),W=b(),P=r.drawingBufferWidth,M=r.drawingBufferHeight,O={tick:0,time:0,viewportWidth:P,viewportHeight:M,framebufferWidth:P,framebufferHeight:M,drawingBufferWidth:P,drawingBufferHeight:M,pixelRatio:E.pixelRatio},Q=N(r,V),ha=z(r,G,E),sa=x(r,V,ha,G),P=B(r,V,Q,ha,wa),xa=m(r,wa,G,E),ia=h(r,V,Q,function(){aa.procs.poll()},O,G,E),ta=v(r,V,Q,G,E),ja=I(r,V,Q,ia,ta,G),aa=T(r,wa,V,Q,ha,sa,ia,ja,{},P,xa,{elements:null,primitive:4,count:-1,offset:0,instances:-1},O,Z,E),wa=y(r,ja,aa.procs.poll,O,a),ua=
aa.next,R=r.canvas,K=[],Y=null;R&&(R.addEventListener("webglcontextlost",p,!1),R.addEventListener("webglcontextrestored",u,!1));ca();a=d(pa,{clear:function(a){var b=0;aa.procs.poll();var c=a.color;c&&(r.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(r.clearDepth(+a.depth),b|=256);"stencil"in a&&(r.clearStencil(a.stencil|0),b|=1024);r.clear(b)},prop:w.define.bind(null,1),context:w.define.bind(null,2),"this":w.define.bind(null,3),draw:pa({}),buffer:function(a){return ha.create(a,
34962)},elements:sa.create,texture:ia.create2D,cube:ia.createCube,renderbuffer:ta.create,framebuffer:ja.create,framebufferCube:ja.createCube,attributes:a,frame:function(a){K.push(a);!Y&&0<K.length&&(Y=n.next(f));return{cancel:function(){function b(){var a=e(K,b);K[a]=K[K.length-1];--K.length;0>=K.length&&Y&&(n.cancel(f),Y=null)}var c=e(K,a);K[c]=b}}},limits:Q,hasExtension:function(a){return 0<=Q.extensions.indexOf(a.toLowerCase())},read:wa,destroy:function(){K.length=0;Y&&(n.cancel(f),Y=null);R&&
(R.removeEventListener("webglcontextlost",p),R.removeEventListener("webglcontextrestored",u));xa.clear();ja.clear();ta.clear();ia.clear();sa.clear();ha.clear();Z&&Z.clear();E.onDestroy()},_gl:r,_refresh:ca,poll:function(){C();Z&&Z.update()},stats:G});E.onDone(null,a);return a}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,
"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},{},[1]);
