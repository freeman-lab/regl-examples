<!DOCTYPE html>
      <html>
        <head>
          <title>example/batch.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(g,m,b){function q(a,d){if(!m[a]){if(!g[a]){var k="function"==typeof require&&require;if(!d&&k)return k(a,!0);if(e)return e(a,!0);k=Error("Cannot find module '"+a+"'");throw k.code="MODULE_NOT_FOUND",k;}k=m[a]={exports:{}};g[a][0].call(k.exports,function(b){var d=g[a][1][b];return q(d?d:b)},k,k.exports,e$$0,g,m,b)}return m[a].exports}for(var e="function"==typeof require&&require,a=0;a<b.length;a++)q(b[a]);return q})({1:[function(c,g,m){var b=c("../regl")(),q=b({frag:"\n    precision mediump float;\n    uniform vec4 color;\n    void main() {\n      gl_FragColor = color;\n    }",
vert:"\n    precision mediump float;\n    attribute vec2 position;\n    uniform float angle;\n    uniform vec2 offset;\n    void main() {\n      gl_Position = vec4(\n        cos(angle) * position.x + sin(angle) * position.y + offset.x,\n        -sin(angle) * position.x + cos(angle) * position.y + offset.y, 0, 1);\n    }",attributes:{position:b.buffer([.5,0,0,.5,1,1])},uniforms:{color:function(b,a,l){b=l.count;return[Math.sin((.1+Math.sin(a))*b+3*a),Math.cos(.02*b+.1*a),Math.sin((.3+Math.cos(2*a))*
b+.8*a),1]},angle:function(b,a,l){return.01*l.count},offset:b.prop("offset")},depth:{enable:!1},count:3});b.frame(function(e){b.clear({color:[0,0,0,1]});q([{offset:[-1,-1]},{offset:[-1,0]},{offset:[-1,1]},{offset:[0,-1]},{offset:[0,0]},{offset:[0,1]},{offset:[1,-1]},{offset:[1,0]},{offset:[1,1]}])})},{"../regl":34}],2:[function(c,g,m){function b(){this.pointer=!1;this.w=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}var q=
c("./constants/dtypes.json"),e=c("./extend");e(b.prototype,{equals:function(a,b){return this.pointer?a.pointer&&this.buffer===a.buffer&&this.size===b&&this.normalized===a.normalized&&this.type===a.type&&this.offset===a.offset&&this.stride===a.stride&&this.divisor===a.divisor:!a.pointer&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},set:function(a,b){(this.pointer=a.pointer)?(this.buffer=a.buffer,this.size=b,this.normalized=a.normalized,this.type=a.type,this.offset=a.offset,this.stride=a.stride,
this.divisor=a.divisor):(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w)}});g.exports=function(a,l,d,k,c){function Q(){for(var a=Array(16),l=0;16>l;++l)a[l]=new b;this.records=a;this.top=0}function g(a){for(var l=a.records,d=a.top;l.length-1<=d;)l.push(new b);return l[++a.top]}var A={};d=d.maxAttributes;for(var t=Array(d),n=0;n<d;++n)t[n]=new b;e(Q.prototype,{pushVec:function(a,b,l,d){var e=g(this);e.pointer=!1;e.x=a;e.y=b;e.z=l;e.w=d},pushPtr:function(a,b,l,d,e,t,q){var k=g(this);k.pointer=!0;k.buffer=
a;k.size=b;k.offset=l;k.stride=d;k.divisor=e;k.normalized=t;k.type=q},pushDyn:function(a){if("number"===typeof a)this.pushVec(a,0,0,0);else if(Array.isArray(a))this.pushVec(a[0],a[1],a[2],a[3]);else{var b=k.getBuffer(a),l=0,d=0,e=0,t=0,n=!1,c=5126;b?c=b.dtype:(b=k.getBuffer(a.buffer),l=a.size||0,d=a.stride||0,e=a.offset||0,t=a.divisor||0,n=a.normalized||!1,c=b.dtype,"type"in a&&(c=q[a.type]));this.pushPtr(b,l,e,d,t,n,c)}},pop:function(){--this.top}});return{bindings:t,bind:function(b,d,e,t){t=e.size||
t;if(!d.equals(e,t)){if(e.pointer){d.pointer||a.enableVertexAttribArray(b);d.buffer!==e.buffer&&e.buffer.bind();a.vertexAttribPointer(b,t,e.type,e.normalized,e.stride,e.offset);var k=l.angle_instanced_arrays;k&&k.vertexAttribDivisorANGLE(b,e.divisor)}else d.pointer&&a.disableVertexAttribArray(b),a.vertexAttrib4f(b,e.x,e.y,e.z,e.w);d.set(e,t)}},def:function(a){a=c.id(a);var b=A[a];b||(b=A[a]=new Q);return b}}}},{"./constants/dtypes.json":9,"./extend":15}],3:[function(c,g,m){function b(a,b){switch(a){case 5121:return new Uint8Array(b);
case 5123:return new Uint16Array(b);case 5125:return new Uint32Array(b);case 5120:return new Int8Array(b);case 5122:return new Int16Array(b);case 5124:return new Int32Array(b);case 5126:return new Float32Array(b);default:return null}}var q=c("./check"),e=c("./is-typed-array"),a=c("./is-ndarray"),l=c("./constants/arraytypes.json"),d=c("./constants/dtypes.json"),k=c("./values"),P={"static":35044,dynamic:35048,stream:35040};g.exports=function(c){function g(a,b){this.id=n++;this.buffer=a;this.type=b;
this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function A(a){c.isBuffer(a.buffer)||(a.buffer=c.createBuffer());a.bind();c.bufferData(a.type,a.data||a.byteLength,a.usage)}function t(a){var b=a.buffer;q(b,"buffer must not be deleted already");c.isBuffer(b)&&c.deleteBuffer(b);a.buffer=null;delete z[a.id]}var n=0,z={};g.prototype.bind=function(){c.bindBuffer(this.type,this.buffer)};return{create:function(h,k,n){function u(t){var h=t||{};if(Array.isArray(h)||e(h)||a(h))h=
{data:h};else if("number"===typeof h)h={length:h|0};else if(null===h||void 0===h)h={};q.type(h,"object","buffer arguments must be an object, a number or an array");"usage"in h?(q.parameter(h.usage,P,"invalid buffer usage"),m.usage=P[h.usage]):m.usage=35044;t=0;"type"in h&&(q.parameter(h.type,d,"invalid buffer type"),t=d[h.type]);var k=h.dimension|0||1,c=0,n=null;if("data"in h)if(n=h.data,null===n)c=h.length|0;else{if(a(n)){var k=n.shape,c=n.stride,h=n.offset,M=0,g=0,z=0,x=0;1===k.length?(M=k[0],g=
1,z=c[0],x=0):2===k.length?(M=k[0],g=k[1],z=c[0],x=c[1]):q.raise("invalid shape");t=t||l[Object.prototype.toString.call(n)]|0||5126;for(var k=g,c=b(t,M*g),n=n.data,Q=0,ma=0;ma<M;++ma)for(var X=0;X<g;++X)c[Q++]=n[z*ma+x*X+h];n=c}else if(Array.isArray(n))if(0<n.length&&Array.isArray(n[0])){k=n[0].length;t=t||5126;h=b(t,n.length*k);c=n;n=k;for(M=x=0;M<c.length;++M)for(z=c[M],g=0;g<n;++g)h[x++]=z[g];n=h}else t=t||5126,n=b(t,n);else q.isTypedArray(n,"invalid data type buffer data"),t=t||l[Object.prototype.toString.call(n)]|
0;c=n.byteLength}else"length"in h&&(c=h.length|0,q.nni(c,"buffer length must be a nonnegative integer"));m.data=n;m.dtype=t||5121;m.byteLength=c;m.dimension=k;A(m);return u}var ea=c.createBuffer(),m=new g(ea,k);z[m.id]=m;n||u(h);u._reglType="buffer";u._buffer=m;u.destroy=function(){t(m)};return u},clear:function(){k(z).forEach(t)},refresh:function(){k(z).forEach(A)},getBuffer:function(a){return a&&a._buffer instanceof g?a._buffer:null}}}},{"./check":4,"./constants/arraytypes.json":8,"./constants/dtypes.json":9,
"./is-ndarray":18,"./is-typed-array":19,"./values":33}],4:[function(c,g,m){function b(a){a=Error("(regl) "+a);console.error(a);throw a;}function q(a,l){a||b(l)}var e=c("./is-typed-array");c=c("./extend");g.exports=c(q,{raise:b,parameter:function(a,l,d){a in l||b("unknown parameter ("+a+")"+(d?": "+d:"")+". possible values: "+Object.keys(l).join())},type:function(a,l,d){typeof a!==l&&b("invalid parameter type"+(d?": "+d:"")+". expected "+l+", got "+typeof a)},isTypedArray:function(a,l){e(a)||b("invalid parameter type"+
(l?": "+l:"")+". must be a typed array")},nni:function(a,l){0<=a&&(a|0)===a||b("invalid parameter type, ("+a+")"+(l?": "+l:"")+". must be a nonnegative integer")},oneOf:function(a,l,d){0>l.indexOf(a)&&b("invalid value"+(d?": "+d:"")+". must be one of: "+l)},shaderError:function(a,b,d,e){a.getShaderParameter(b,a.COMPILE_STATUS)||(a=a.getShaderInfoLog(b),q.raise("Error compiling shader:\n"+a))},linkError:function(a,b){if(!a.getProgramParameter(b,a.LINK_STATUS)){var d=a.getProgramInfoLog(b);q.raise("Error linking program:\n"+
d)}}})},{"./extend":15,"./is-typed-array":19}],5:[function(c,g,m){g.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],6:[function(c,g,m){var b=c("./extend");g.exports=function(){function c(){var a=[],d=[];return b(function(){a.push.apply(a,Array.prototype.slice.call(arguments))},{def:function(){var b="v"+e++;d.push(b);0<arguments.length&&(a.push(b,"="),a.push.apply(a,Array.prototype.slice.call(arguments)),a.push(";"));return b},
toString:function(){return[0<d.length?"var "+d+";":"",a.join("")].join("")}})}var e=0,a=[],l=[],d={};return{link:function(b){var d="g"+e++;a.push(d);l.push(b);return d},block:c,proc:function(a){var l=[],g=c(),m=g.toString;return d[a]=b(g,{arg:function(){var a="a"+e++;l.push(a);return a},toString:function(){return["function(",l.join(),"){",m(),"}"].join("")}})},compile:function(){var b=['"use strict";return {'];Object.keys(d).forEach(function(a){b.push('"',a,'":',d[a].toString(),",")});b.push("}");
return Function.apply(null,a.concat([b.join("")])).apply(null,l)}}}},{"./extend":15}],7:[function(c,g,m){function b(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function q(a,b,d,e){var c,k=",";switch(b){case 5126:c="1f";break;case 35664:c="2fv";break;case 35665:c="3fv";break;case 35666:c="4fv";break;case 35670:case 5124:c="1i";break;case 35671:case 35667:c="2iv";break;case 35672:case 35668:c=
"3iv";break;case 35673:case 35669:c="4iv";break;case 35674:c="Matrix2fv";k=",false,";break;case 35675:c="Matrix3fv";k=",false,";break;case 35676:c="Matrix4fv";k=",false,";break;default:l.raise("unsupported uniform type")}return a+".uniform"+c+"("+d+k+e+");"}function e(a){return a+"["+a+".length-1]"}function a(a,b){return"framebuffer"===a||a<b?-1:a>b?1:0}var l=c("./check"),d=c("./codegen"),k=c("./constants/primitives.json"),P=c("./constants/dtypes.json"),Q={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,
"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},O={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},A={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,
"increment wrap":34055,"decrement wrap":34056,invert:5386};g.exports=function(c,n,g,h,M,x,m,ea,W,fa,ga,T,ca,ka,oa){function ha(h,n,M,P,m){function u(a){var b=pa[a];return b?b:b=pa[a]=v(la[a])}function U(a){var b=a.id,w=S[b];if(w)return w;w=a.func?p.def(v(a.data),"(",ra,",",F,",",H,")"):p.def(ra,".",a.data);return S[b]=w}function Y(a,b){return a.find(function(a){return a.name===b})}function K(a){return na&&!(a in n||a in m)}var I=d(),v=I.link,p=I.proc("batch"),C=I.block(),r=p.def,aa=p.arg,f=v(c),G=
v(h.program),E=v(ga.bind),H=v(ka),ja=v(ea),B=v(ca.count),N=v(ca.offset),ta=v(ca.instances),V=v(ca.primitive),pa={},da=v(x.elements),B=r(e(B)),N=r(e(N)),V=r(e(V)),da=r(e(da)),y,L,J=g.angle_instanced_arrays;J&&(y=r(e(ta)),L=v(J));var na="elements"in n,ta=aa(),aa=aa(),ra=r(),F=r(),S={};p(f,".useProgram(",G,");");h.uniforms.forEach(function(a){if(!(a.name in M)){var b=v(a.location),w=v(fa.def(a.name)),w=w+"["+w+".length-1]";a=a.info.type;35678===a||35680===a?(a=r(w+"._texture"),p(q(f,5124,b,a+".bind()")),
C(a,".unbind();")):p(q(f,a,b,w))}});h.attributes.forEach(function(a){if(!(P.name in P)){var f=v(ga.def(a.name));p(E,"(",a.location,",",v(ga.bindings[a.location]),",",f,".records[",f,".top]",",",b(a.info.type),");")}});na||p("if(",da,"){",f,".bindBuffer(",34963,",",da,".buffer.buffer);","}else{",f,".bindBuffer(",34963,",null);","}");p("for(",F,"=0;",F,"<",ta,";++",F,"){",ra,"=",aa,"[",F,"];");Object.keys(n).sort(a).forEach(function(a){function b(a){p("if(",w,"){",f,".enable(",a,");}else{",f,".disable(",
a,");}")}var w=U(n[a]);switch(a){case "framebuffer":a=u("viewport");var d=u("scissor.box");p("if(",ja,".push(",w,"&&",w,"._framebuffer)){",ja,".poll();",a,".setDirty();",d,".setDirty();","}");break;case "cull.enable":b(2884);break;case "blend.enable":b(3042);break;case "dither":b(3024);break;case "stencil.enable":b(2960);break;case "depth.enable":b(2929);break;case "scissor.enable":b(3089);break;case "polygonOffset.enable":b(32823);break;case "sample.alpha":b(32926);break;case "sample.enable":b(32928);
break;case "depth.mask":p(f,".depthMask(",w,");");break;case "depth.func":a=v(O);p(f,".depthFunc(",a,"[",w,"]);");break;case "depth.range":p(f,".depthRange(",w,"[0],",w,"[1]);");break;case "blend.color":p(f,".blendColor(",w,"[0],",w,"[1],",w,"[2],",w,"[3]);");break;case "blend.equation":a=v(D);p("if(typeof ",w,'==="string"){',f,".blendEquation(",a,"[",w,"]);","}else{",f,".blendEquationSeparate(",a,"[",w,".rgb],",a,"[",w,".alpha]);","}");break;case "blend.func":a=v(Q);p(f,".blendFuncSeparate(",a,'["srcRGB" in ',
w,"?",w,".srcRGB:",w,".src],",a,'["dstRGB" in ',w,"?",w,".dstRGB:",w,".dst],",a,'["srcAlpha" in ',w,"?",w,".srcAlpha:",w,".src],",a,'["dstAlpha" in ',w,"?",w,".dstAlpha:",w,".dst]);");break;case "stencil.mask":p(f,".stencilMask(",w,");");break;case "stencil.func":a=v(O);p(f,".stencilFunc(",a,"[",w,'.cmp||"always"],',w,".ref|0,",'"mask" in ',w,"?",w,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":d=v(A);p(f,".stencilOpSeparate(","stencil.opFront"===a?1028:1029,",",d,"[",w,'.fail||"keep"],',
d,"[",w,'.zfail||"keep"],',d,"[",w,'.pass||"keep"]);');break;case "polygonOffset.offset":p(f,".polygonOffset(",w,".factor||0,",w,".units||0);");break;case "cull.face":p(f,".cullFace(",w,'==="front"?',1028,":",1029,");");break;case "lineWidth":p(f,".lineWidth(",w,");");break;case "frontFace":p(f,".frontFace(",w,'==="cw"?',2304,":",2305,");");break;case "colorMask":p(f,".colorMask(",w,"[0],",w,"[1],",w,"[2],",w,"[3]);");break;case "sample.coverage":p(f,".sampleCoverage(",w,".value,",w,".invert);");
break;case "scissor.box":case "viewport":a=u(a);p(a,".push(",w,".x||0,",w,".y||0,",w,".w||-1,",w,".h||-1);");break;case "primitives":case "offset":case "count":case "elements":break;default:l.raise("unsupported option for batch",a)}});("viewport"in n||"framebuffer"in n)&&p(u("viewport"),".poll();");("scissor.box"in n||"framebuffer"in n)&&p(u("scissor.box"),".poll();");"framebuffer"in n&&p(ja,".pop();");var T=h.uniforms,W=[];Object.keys(M).forEach(function(a){var b=Y(T,a);if(b){var w=b.info.type,d=
v(b.location);a=U(M[a]);35678===b.info.type||35680===b.info.type?(b=r(a+"._texture"),W.push(b),p(q(f,5124,d,b+".bind()"))):p(q(f,w,d,a))}});W.forEach(function(a){p(a,".unbind();")});var ha=h.attributes;Object.keys(P).forEach(function(a){var f=Y(ha,a);f&&p(E,"(",f.location,",",v(a.bindings[f.location]),",",U(P[a]),",",b(f.info.type),");")});n.count?p(B,"=",U(n.count),";"):K("count")||p("if(",B,"){");n.offset&&p(N,"=",U(n.offset),";");n.primitive&&(h=v(k),p(V,"=",h,"[",U(n.primitive),"];"));na&&(h=
U(n.elements),p(da,"=",h,"?",h,"._elements:null;"));K("offset")&&p(N,"=0;");p("if(",da,"){");K("count")&&p(B,"=",da,".vertCount;","if(",B,">0){");K("primitive")&&p(V,"=",da,".primType;");na&&p(f,".bindBuffer(",34963,",",da,".buffer.buffer);");J&&(n.instances&&p(y,"=",U(n.instances),";"),p("if(",y,">0){",L,".drawElementsInstancedANGLE(",V,",",B,",",da,".type,",N,",",y,");}else{"));p(f,".drawElements(",V,",",B,",",da,".type,",N,");");J&&p("}");K("count")&&p("}");p("}else{");K("count")||(K("primitive")&&
p(V,"=",4,";"),J&&p("if(",y,">0){",L,".drawArraysInstancedANGLE(",V,",",N,",",B,",",y,");}else{"),p(f,".drawArrays(",V,",",N,",",B,");}"),J&&p("}"));p("}}",C);return I.compile().batch}var la=W.contextState,D={add:32774,subtract:32778,"reverse subtract":32779};g.ext_blend_minmax&&(D.min=32775,D.max=32776);var J=0;return{draw:function(a){var l=d(),h=l.link,n=l.proc("draw"),k=n.def,M=h(c),P=h(a.program),Q=h(ga.bind),K=h(ca.count),I=h(ca.offset),v=h(ca.instances),p=h(ca.primitive),C=h(x.elements),r=[];
n(M,".useProgram(",P,");");a.attributes.forEach(function(a){var f=h(ga.def(a.name));n(Q,"(",a.location,",",h(ga.bindings[a.location]),",",f,".records[",f,".top]",",",b(a.info.type),");")});a.uniforms.forEach(function(a){var b=h(a.location),d=h(fa.def(a.name)),d=d+"["+d+".length-1]";a=a.info.type;35678===a||35680===a?(a=k(d+"._texture"),r.push(a),n(q(M,5124,b,a+".bind()"))):n(q(M,a,b,d))});r.forEach(function(a){n(a,".unbind();")});a=k(e(p));K=k(e(K));I=k(e(I));C=k(e(C));n("if(",K,"){");(P=g.angle_instanced_arrays)?
(v=k(e(v)),P=h(P),n("if(",C,"){",C,".bind();","if(",v,">0){",P,".drawElementsInstancedANGLE(",a,",",K,",",C,".type,",I,",",v,");}else{",M,".drawElements(",a,",",K,",",C,".type,",I,");}","}else if(",v,">0){",P,".drawArraysInstancedANGLE(",a,",",I,",",K,",",v,");}else{",M,".drawArrays(",a,",",I,",",K,");}}")):n("if(",C,"){",M,".drawElements(",a,",",K,",",C,".type,",I,");}","}else{",M,".drawArrays(",a,",",I,",",K,");}");return l.compile().draw},command:function(b,c,t,q,g,z,m){function u(a){var b=da[a];
return b?b:b=da[a]=p(la[a])}function K(a,b){var f=u(a);y(f,".push(",b,");");L(f,".pop();")}function I(a){var b=a.id,f=va[b];if(f)return f;f=a.func?F.def(p(a.data),"(",sa,",0,",W,")"):F.def(sa,".",a.data);return va[b]=f}var v=d(),p=v.link,C=v.block,r=v.proc,aa=J++,f=p(oa);p(n);var G=p(T.fragShaders),E=p(T.vertShaders),H=p(T.programs),ja=p(ea),B={count:p(ca.count),offset:p(ca.offset),instances:p(ca.instances),primitive:p(ca.primitive)},N=p(x.elements),ta=p(k),V=p(O),pa=p(A),da={},y=C(),L=C(),ua=!1;
Object.keys(b).sort(a).forEach(function(a){var f=b[a];switch(a){case "frag":ua=!0;y(G,".push(",p(n.id(f)),");");L(G,".pop();");break;case "vert":ua=!0;y(E,".push(",p(n.id(f)),");");L(E,".pop();");break;case "framebuffer":a=ea.getFramebuffer(f);l(null===f||a,"invalid framebuffer object");a=u("viewport");var d=u("scissor.box");y("if(",ja,".push(",p(f&&f._framebuffer),")){",a,".setDirty();",d,".setDirty();","}");L("if(",ja,".pop()){",a,".setDirty();",d,".setDirty();","}");break;case "count":case "offset":case "instances":l.nni(f,
a);y(B[a],".push(",f,");");L(B[a],".pop();");break;case "primitive":l.parameter(f,k,"not a valid drawing primitive");y(B.primitive,".push(",k[f],");");L(B.primitive,".pop();");break;case "elements":d=x.getElements(f);f=!("primitive"in b);a=!("count"in b);d?(d=p(d),y(N,".push(",d,");"),f&&y(B.primitive,".push(",d,".primType);"),a&&y(B.count,".push(",d,".vertCount);")):(y(N,".push(null);"),f&&y(B.primitive,".push(",4,");"),a&&y(B.count,".push(0);"));f&&L(B.primitive,".pop();");a&&L(B.count,".pop();");
"offset"in b||(y(B.offset,".push(0);"),L(B.offset,".pop();"));L(N,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":l.type(f,"boolean",a);K(a,f);break;case "depth.func":l.parameter(f,O,a);K(a,O[f]);break;case "depth.range":l(Array.isArray(f)&&2===f.length&&f[0]<=f[1],"depth range is 2d array");a=u(a);y(a,".push(",f[0],",",f[1],");");
L(a,".pop();");break;case "blend.func":a=u(a);l.type(f,"object","blend func must be an object");var d="srcRGB"in f?f.srcRGB:f.src,e="srcAlpha"in f?f.srcAlpha:f.src,c="dstRGB"in f?f.dstRGB:f.dst,f="dstAlpha"in f?f.dstAlpha:f.dst;l.parameter(d,Q);l.parameter(e,Q);l.parameter(c,Q);l.parameter(f,Q);y(a,".push(",Q[d],",",Q[c],",",Q[e],",",Q[f],");");L(a,".pop();");break;case "blend.equation":a=u(a);"string"===typeof f?(l.parameter(f,D,"invalid blend equation"),y(a,".push(",D[f],",",D[f],");")):"object"===
typeof f?(l.parameter(f.rgb,D,"invalid blend equation rgb"),l.parameter(f.alpha,D,"invalid blend equation alpha"),y(a,".push(",D[f.rgb],",",D[f.alpha],");")):l.raise("invalid blend equation");L(a,".pop();");break;case "blend.color":l(Array.isArray(f)&&4===f.length,"blend color is a 4d array");a=u(a);y(a,".push(",f[0],",",f[1],",",f[2],",",f[3],");");L(a,".pop();");break;case "stencil.mask":l.type(f,"number","stencil mask must be an integer");a=u(a);y(a,".push(",f,");");L(a,".pop();");break;case "stencil.func":l.type(f,
"object","stencil func must be an object");d=f.cmp||"keep";e=f.ref||0;f="mask"in f?f.mask:-1;l.parameter(d,O,"invalid stencil func cmp");l.type(e,"number","stencil func ref");l.type(f,"number","stencil func mask");a=u(a);y(a,".push(",O[d],",",e,",",f,");");L(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":l.type(f,"object",a);d=f.fail||"keep";e=f.zfail||"keep";f=f.pass||"keep";l.parameter(d,A,a);l.parameter(e,A,a);l.parameter(f,A,a);a=u(a);y(a,".push(",A[d],",",A[e],",",A[f],");");
L(a,".pop();");break;case "polygonOffset.offset":l.type(f,"object",a);d=f.factor||0;f=f.units||0;l.type(d,"number","offset.factor");l.type(f,"number","offset.units");a=u(a);y(a,".push(",d,",",f,");");L(a,".pop();");break;case "cull.face":d=0;"front"===f?d=1028:"back"===f&&(d=1029);l(!!d,"cull.face");f=u(a);y(f,".push(",d,");");L(f,".pop();");break;case "lineWidth":d=h.lineWidthDims;l("number"===typeof f&&f>=d[0]&&f<=d[1],"invalid line width, must positive number between "+d[0]+" and "+d[1]);K(a,f);
break;case "frontFace":d=0;"cw"===f?d=2304:"ccw"===f&&(d=2305);l(!!d,"frontFace");f=u(a);y(f,".push(",d,");");L(f,".pop();");break;case "colorMask":l(Array.isArray(f)&&4===f.length,"color mask must be length 4 array");a=u(a);y(a,".push(",f.map(function(a){return!!a}).join(),");");L(a,".pop();");break;case "sample.coverage":l.type(f,"object",a);d="value"in f?f.value:1;f=!!f.invert;l("number"===typeof d&&0<=d&&1>=d,"sample value");a=u(a);y(a,".push(",d,",",f,");");L(a,".pop();");break;case "viewport":case "scissor.box":l("object"===
typeof f&&f,a+" is an object");var d=f.x||0,e=f.y||0,H=c=-1;l("number"===typeof d&&0<=d,a+".x must be a positive int");l("number"===typeof e&&0<=e,a+".y must be a positive int");"w"in f&&(c=f.w,l("number"===typeof c&&0<=c,a+".w must be a positive int"));"h"in f&&(H=f.h,l("number"===typeof H&&0<=H,a+".h must be a positive int"));f=u(a);y(f,".push(",d,",",e,",",c,",",H,");");L(f,".pop();");break;default:l.raise("unsupported parameter "+a)}});if(ua){if(b.frag&&b.vert)C=b.frag,y(H,".push(",p(T.create(n.id(b.vert),
n.id(C))),");");else{var C=y.def(G,"[",G,".length-1]"),na=y.def(E,"[",E,".length-1]"),ra=p(T.create);y(H,".push(",ra,"(",na,",",C,"));")}L(H,".pop();")}Object.keys(c).forEach(function(a){var f=p(fa.def(a));a=c[a];a="function"===typeof a&&a._reglType?p(a):Array.isArray(a)?p(a.slice()):+a;y(f,".push(",a,");");L(f,".pop();")});Object.keys(t).forEach(function(a){var f=p(ga.def(a)),b=t[a];if("number"===typeof b)y(f,".pushVec(",+b,",0,0,0);");else if(l(!!b,"invalid attribute: "+a),Array.isArray(b))y(f,
".pushVec(",[b[0]||0,b[1]||0,b[2]||0,b[3]||0],");");else{var d=M.getBuffer(b),e=0,E=0,h=0,c=0,n=!1,H=5126;d?H=d.dtype:(l.type(b,"object",'invalid attribute "'+a+'"'),d=M.getBuffer(b.buffer),e=b.size||0,E=b.stride||0,h=b.offset||0,c=b.divisor||0,n=b.normalized||!1,l(!!d,"invalid attribute "+a+".buffer"),H=d.dtype,"type"in b&&(l.parameter(b.type,P,"attribute type"),H=P[b.type]));l(!!d,"invalid attribute "+a+".buffer");l.nni(E,a+".stride");l.nni(h,a+".offset");l.nni(c,a+".divisor");l.type(n,"boolean",
a+".normalized");l.oneOf(e,[0,1,2,3,4],a+".size");y(f,".pushPtr(",[p(d),e,h,E,c,n,H].join(),");")}L(f,".pop();")});var F=v.block(),S=v.block(),W,sa;m&&(W=p(ka),sa=y.def());var va={};Object.keys(q).sort(a).forEach(function(a){var f=I(q[a]);switch(a){case "framebuffer":a=u("viewport");var d=u("scissor.box");F("if(",ja,".push(",f,"&&",f,"._framebuffer)){",a,".setDirty();",d,".setDirty();","}");S("if(",ja,".pop()){",a,".setDirty();",d,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=
u(a);F(a,".push(",f,");");S(a,".pop();");break;case "count":case "offset":case "instances":a=B[a];F(a,".push(",f,");");S(a,".pop();");break;case "primitive":a=B.primitive;F(a,".push(",ta,"[",f,"]);");S(a,".pop();");break;case "depth.func":a=u(a);F(a,".push(",V,"[",f,"]);");S(a,".pop();");break;case "blend.func":a=u(a);d=p(Q);F(a,".push(",d,'["srcRGB" in ',f,"?",f,".srcRGB:",f,".src],",d,'["dstRGB" in ',f,"?",f,".dstRGB:",f,".dst],",d,'["srcAlpha" in ',f,"?",f,".srcAlpha:",f,".src],",d,'["dstAlpha" in ',
f,"?",f,".dstAlpha:",f,".dst]);");S(a,".pop();");break;case "blend.equation":a=u(a);d=p(D);F("if(typeof ",f,'==="string"){',a,".push(",d,"[",f,"],",d,"[",f,"]);","}else{",a,".push(",d,"[",f,".rgb],",d,"[",f,".alpha]);","}");S(a,".pop();");break;case "blend.color":a=u(a);F(a,".push(",f,"[0],",f,"[1],",f,"[2],",f,"[3]);");S(a,".pop();");break;case "stencil.mask":a=u(a);F(a,".push(",f,");");S(a,".pop();");break;case "stencil.func":a=u(a);F(a,".push(",V,"[",f,".cmp],",f,".ref|0,",'"mask" in ',f,"?",f,
".mask:-1);");S(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=u(a);F(a,".push(",pa,"[",f,'.fail||"keep"],',pa,"[",f,'.zfail||"keep"],',pa,"[",f,'.pass||"keep"]);');S(a,".pop();");break;case "polygonOffset.offset":a=u(a);F(a,".push(",f,".factor||0,",f,".units||0);");S(a,".pop();");break;case "cull.face":a=u(a);F(a,".push(",f,'==="front"?',1028,":",1029,");");S(a,".pop();");break;case "frontFace":a=u(a);F(a,".push(",f,'==="cw"?',2304,":",2305,");");S(a,".pop();");break;case "colorMask":a=
u(a);F(a,".push(",f,"[0],",f,"[1],",f,"[2],",f,"[3]);");S(a,".pop();");break;case "sample.coverage":a=u(a);F(a,".push(",f,".value,",f,".invert);");S(a,".pop();");break;case "scissor.box":case "viewport":a=u(a);F(a,".push(",f,".x||0,",f,".y||0,",'"w" in ',f,"?",f,".w:-1,",'"h" in ',f,"?",f,".h:-1);");S(a,".pop();");break;case "elements":a=!("primitive"in q)&&!("primitive"in b);var d=!("count"in q)&&!("count"in b),e=!("offset"in q)&&!("offset"in b),E=F.def();F("if(",f,"){",E,"=",f,"._elements;",N,".push(",
E,");",a?B.primitive+".push("+E+".primType);":"",d?B.count+".push("+E+".vertCount);":"",e?B.offset+".push("+E+".offset);":"","}else{",N,".push(null);","}");S(N,".pop();","if(",f,"){",a?B.primitive+".pop();":"",d?B.count+".pop();":"",e?B.offset+".pop();":"","}");break;default:l.raise("unsupported dynamic option: "+a)}});Object.keys(g).forEach(function(a){var f=p(fa.def(a));a=I(g[a]);F(f,".push(",a,");");S(f,".pop();")});Object.keys(z).forEach(function(a){var f=p(ga.def(a));a=I(z[a]);F(f,".pushDyn(",
a,");");S(f,".pop();")});C=r("scope");na=C.arg();ra=C.arg();C(y);m&&C(sa,"=",na,";",F);C(ra,"();",m?S:"",L);C=r("draw");C(y);m&&C(sa,"=",C.arg(),";",F);na=e(H);C(f,"();","if(",na,")",na,".draw(",m?sa:"",");",m?S:"",L);var qa=r("batch");qa(y);m=qa.def(e(H));r=p(function(a,f,d){var e=a.batchCache[aa];e||(e=a.batchCache[aa]=ha(a,q,g,z,b));return e(f,d)});qa("if(",m,"){",f,"();",r,"(",m,",",qa.arg(),",",qa.arg(),");");Object.keys(q).forEach(function(a){(a=da[a])&&qa(a,".setDirty();")});qa("}",L);return v.compile()}}}},
{"./check":4,"./codegen":6,"./constants/dtypes.json":9,"./constants/primitives.json":10}],8:[function(c,g,m){g.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],9:[function(c,g,m){g.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,
"float":5126}},{}],10:[function(c,g,m){g.exports={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],11:[function(c,g,m){function b(b,d){function e(){var d=window.innerWidth,n=window.innerHeight;b!==document.body&&(n=b.getBoundingClientRect(),d=n.right-n.left,n=n.top-n.bottom);c.width=m*d;c.height=m*n;a(c.style,{width:d+"px",height:n+"px"})}var c=document.createElement("canvas"),g=q(c,d);a(c.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(c);
b===document.body&&(c.style.position="absolute",a(b.style,{margin:0,padding:0}));var m=+g.options.pixelRatio;window.addEventListener("resize",e,!1);var A=g.options.onDestroy;g.options=a(a({},g.options),{onDestroy:function(){window.removeEventListener("resize",e);b.removeChild(c);A&&A()}});e();return g}function q(b,d){function c(a){try{return b.getContext(a,q)}catch(d){return null}}var q=d.glOptions||{},g=c("webgl")||c("experimental-webgl")||c("webgl-experimental");e(g,"webgl not supported");return{gl:g,
options:a({pixelRatio:window.devicePixelRatio},d)}}var e=c("./check"),a=c("./extend");g.exports=function(e){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:e[0],options:e[1]||{}};var d=document.body,c=e[1]||{};if("string"===typeof e[0])d=document.querySelector(e[0])||document.body;else if("object"===typeof e[0])if(e[0]instanceof HTMLElement)d=e[0];else{if(e[0]instanceof WebGLRenderingContext)return{gl:e[0],options:a({pixelRatio:1},c)};c=e[0]}return d.nodeName&&"CANVAS"===
d.nodeName.toUpperCase()?q(d,c):b(d,c)}},{"./check":4,"./extend":15}],12:[function(c,g,m){g.exports=function(b){return{primitive:[4],count:[0],offset:[0],instances:[0]}}},{}],13:[function(c,g,m){function b(a,b){this.id=e++;this.func=a;this.data=b}function q(a,e){switch(typeof a){case "boolean":case "number":case "string":return new b(!1,a);case "function":return new b(!0,a);default:return q}}var e=0;g.exports={define:q,isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof b},
unbox:function(a,e){return a instanceof b?a:"function"===typeof a&&a!==q?new b(!0,a):new b(!1,e)}}},{}],14:[function(c,g,m){var b=c("./check"),q=c("./is-typed-array"),e=c("./is-ndarray"),a=c("./constants/primitives.json");g.exports=function(c,d,k){function g(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}g.prototype.bind=function(){this.buffer.bind()};return{create:function(c){function l(c){var k=d.oes_element_index_uint;if(c)if("number"===typeof c)t(c);else{var h=null,g="static",x=
0;Array.isArray(c)||q(c)||e(c)?h=c:(b.type(c,"object","invalid arguments for elements"),"data"in c&&(h=c.data),"usage"in c&&(g=c.usage),"length"in c&&(x=c.length));Array.isArray(h)||e(h)&&"array"===h.dtype||"type"in c?t({type:c.type||(k?"uint32":"uint16"),usage:g,data:h,length:x}):t({usage:g,data:h,length:x});if(Array.isArray(h)||q(h))t.dimension=3}else t();h=m.buffer.byteLength;g=0;switch(m.buffer.dtype){case 5121:case 5120:g=5121;break;case 5123:case 5122:g=5123;h>>=1;break;case 5125:case 5124:b(k,
"32 bit element buffers not supported");g=5125;h>>=2;break;default:b.raise("invalid element buffer type")}k=4;x=m.buffer.dimension;1===x&&(k=0);2===x&&(k=1);3===x&&(k=4);"object"===typeof c&&("primitive"in c&&(k=c.primitive,b.parameter(k,a),k=a[k]),"count"in c&&(h=c.vertCount|0));m.primType=k;m.vertCount=h;m.type=g;return l}var m=new g,t=k.create(null,34963,!0);m.buffer=t._buffer;l(c);l._reglType="elements";l._elements=m;l.destroy=function(){b(null!==m.buffer,"must not double destroy elements");t.destroy();
m.buffer=null};return l},elements:[null],getElements:function(a){return a&&a._elements instanceof g?a._elements:null}}}},{"./check":4,"./constants/primitives.json":10,"./is-ndarray":18,"./is-typed-array":19}],15:[function(c,g,m){g.exports=function(b,c){for(var e=Object.keys(c),a=0;a<e.length;++a)b[e[a]]=c[e[a]];return b}},{}],16:[function(c,g,m){g.exports=function(b){function c(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{e[a]=
b.getExtension(a)}catch(c){}})}var e={};c();return{extensions:e,refresh:c}}},{}],17:[function(c,g,m){var b=c("./check"),q=c("./values"),e=c("./extend"),a=[1029];g.exports=function(c,d,k,g,m){function O(a,b,d,c){this.target=a;this.level=b;this.texture=d;this.renderbuffer=c}function A(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function t(a,d,c){if(a.texture)b.oneOf(a.texture._texture.params.internalformat,d,"unsupported texture format for attachment");
else b.oneOf(a.renderbuffer._renderbuffer.format,c,"unsupported renderbuffer format for attachment")}function n(a,d){var c=d.width,e=d.height;if(a.texture){var h=a.texture._texture,l=Math.max(1,h.params.width>>a.level),n=Math.max(1,h.params.height>>a.level),c=c||l,e=e||n;b(l===c&&n===e,"inconsistent width/height for supplied texture");b(0>h.pollId,"polling fbo textures not supported")}else h=a.renderbuffer._renderbuffer,c=c||h.width,e=e||h.height,b(h.width===c&&h.height===e,"inconsistent width/height for renderbuffer"),
b(0<=X.indexOf(h.format),"renderbuffer format not compatible with color channels");h.refCount+=1;d.width=c;d.height=e}function z(a,b){b?b.texture?c.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):c.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):c.framebufferTexture2D(36160,a,3553,null,0)}function h(a){var d=3553,c=0,e=null,h=null,l=a;"object"===typeof a&&(l=a.data,"level"in a&&(c=a.level|0),"target"in a&&(d=a.target|0));b.type(l,"function",
"invalid attachment data");l=a._reglType;"texture"===l?(e=a,34067===e._texture.target?b(34069<=d&&34075>d,"invalid cube map target"):b(3553===d)):"renderbuffer"===l?(h=a,d=36161,c=0):b.raise("invalid regl object for attachment");return new O(d,c,e,h)}function M(a){return a&&(a.texture||a.renderbuffer)}function x(){this.id=R++;Z[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=
this.ownsColor=!1}function u(a){c.isFramebuffer(a.framebuffer)||(a.framebuffer=c.createFramebuffer());Y=!0;c.bindFramebuffer(36160,a.framebuffer);for(var e=a.colorAttachments,h=0;h<e.length;++h)z(36064+h,e[h]);for(h=e.length;h<k.maxColorAttachments;++h)z(36064+h,null);z(36096,a.depthAttachment);z(36128,a.stencilAttachment);z(33306,a.depthStencilAttachment);d.webgl_draw_buffers&&d.webgl_draw_buffers.drawBuffersWEBGL(ba[e.length]);a=c.checkFramebufferStatus(36160);36053!==a&&b.raise("framebuffer configuration not supported, status = "+
fa[a])}function ea(a){a=a.framebuffer;b(a,"must not double destroy framebuffer");c.isFramebuffer(a)&&c.deleteFramebuffer(a)}function W(){return U[U.length-1]}var fa={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},ga={rgba:6408},T={rgba4:32854,rgb565:36194,"rgb5 a1":32855};d.ext_srgb&&(T.srgba=35907);d.ext_color_buffer_half_float&&(T.rgba16f=34842,T.rgb16f=34843);d.webgl_color_buffer_float&&(T.rgba32f=34836);
var ca=[33189],ka=[36168],oa=[34041],ha=[],la=[],D=[];d.webgl_depth_texture&&(ha.push(6402),D.push(34041));var J=e(e({},ga),T),ma=q(ga),X=q(T),T=5121,ia={uint8:5121};d.oes_texture_half_float&&(T=ia["half float"]=36193);d.oes_texture_float&&(T=ia["float"]=5126);ia.best=T;var ba=function(){for(var a=Array(k.maxDrawbuffers),b=0;b<=k.maxDrawbuffers;++b)for(var d=a[b]=Array(b),c=0;c<b;++c)d[c]=36064+c;return a}(),R=0,Z={},U=[null],Y=!0;return{top:W,dirty:function(){return Y},push:function(a){a=a||null;
Y=Y||a!==W();U.push(a);return Y},pop:function(){var a=W();U.pop();return Y=Y||a!==W()},getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof x)?a:null},poll:function(){if(Y){var b=U[U.length-1],e=d.webgl_draw_buffers;b?(c.bindFramebuffer(36160,b.framebuffer),e&&e.drawBuffersWEBGL(ba[b.colorAttachments.length])):(c.bindFramebuffer(36160,null),e&&e.drawBuffersWEBGL(a));Y=!1}},create:function(a){function e(a){var q,r=a||{};q=d.webgl_draw_buffers;
var x=0,f=0;"shape"in r?(a=r.shape,b(Array.isArray(a)&&2<=a.length,"invalid shape for framebuffer"),x=a[0],f=a[1]):("radius"in r&&(x=f=r.radius),"width"in r&&(x=r.width),"height"in r&&(f=r.height));var G=null;a=!1;if("colorBuffers"in r||"colorBuffer"in r){G=r.colorBuffers||r.colorBuffer;Array.isArray(G)||(G=[G]);k.width=x;k.height=f;1<G.length&&b(q,"multiple render targets not supported");b(0<=G.length,"must specify at least one color attachment");G=G.map(h);for(q=0;q<G.length;++q)x=G[q],t(x,ma,X),
n(x,k);x=k.width;f=k.height}else{var E=!0,H="rgba",ja="uint8",B=1;a=!0;k.width=x||c.drawingBufferWidth;k.height=f||c.drawingBufferHeight;"format"in r&&(H=r.format,b.parameter(H,J,"invalid color format"),E=H in ga);"type"in r&&(b(E,"colorType can not be set for renderbuffer targets"),ja=r.type,b.parameter(ja,ia,"invalid color type"));"colorCount"in r&&(B=r.colorCount|0,b(0<=B,"color count must be positive"));if(k.ownsColor)for(G=k.colorAttachments;G.length>B;)A(G.pop());else G=[];for(q=0;q<G.length;++q){var N;
a:{N=G[q];var z=E,V=H,pa=x,da=f;if(N.texture){var y=N.texture;if(z){y({format:V,type:ja,width:pa,height:da});y._texture.refCount+=1;N=!0;break a}}else if(y=N.renderbuffer,!z){y({format:V,width:pa,height:da});y._renderbuffer.refCount+=1;N=!0;break a}A(N);N=!1}N||(G[q--]=G[G.length-1],G.pop())}for(;G.length<B;)E?G.push(new O(3553,0,g.create({format:H,type:ja,width:x,height:f},3553),null)):G.push(new O(36161,0,null,m.create({format:H,width:x,height:f})))}b(0<G.length,"must specify at least one color buffer");
k.width=x;k.height=f;H=E=q=null;ja=!1;B=0;"depthBuffer"in r&&(q=h(r.depthBuffer),t(q,ha,ca),B+=1);"stencilBuffer"in r&&(E=h(r.stencilBuffer),t(E,la,ka),B+=1);"depthStencilBuffer"in r&&(H=h(r.depthStencilBuffer),t(H,D,oa),B+=1);if(q||E||H)b(1===B,"can specify only one of depth, stencil or depthStencil attachment"),n(q||E||H,k);else if(B=!0,z=N=!1,"depth"in r&&(B=!!r.depth),"stencil"in r&&(N=!!r.stencil),"depthTexture"in r&&(z=!!r.depthTexture),r=k.depthAttachment||k.stencilAttachment||k.depthStencilAttachment,
V=null,B||N)ja=!0,z?(b(d.webgl_depth_texture,"depth texture extension not supported"),b(B,"stencil only textures not supported"),z=N?"depth stencil":"depth",k.ownsDepthStencil&&r.texture?(r.texture({format:z,width:x,height:f}),r.texture._texture.refCount+=1,V=r):V=new O(3553,0,g.create({format:z,width:x,height:f},3553),null)):(z=B?N?"depth stencil":"depth":"stencil",k.ownsDepthStencil&&r.renderbuffer?(r.renderbuffer({format:z,width:x,height:f}),r.renderbuffer._renderbuffer.refCount+=1,V=r):V=new O(36161,
0,null,m.create({format:z,width:x,height:f}))),B?N?H=V:q=V:E=V;x=k;x.colorAttachments.forEach(A);A(x.depthAttachment);A(x.stencilAttachment);A(x.depthStencilAttachment);k.colorAttachments=G;k.depthAttachment=q;k.stencilAttachment=E;k.depthStencilAttachment=H;k.ownsColor=a;k.ownsDepthStencil=ja;e.color=G.map(M);e.depth=M(q);e.stencil=M(E);e.depthStencil=M(H);u(k);e.width=k.width;e.height=k.height;return e}var k=new x;e(a);e._reglType="framebuffer";e._framebuffer=k;e._destroy=function(){ea(k)};return e},
clear:function(){q(Z).forEach(ea)},refresh:function(){q(Z).forEach(u)}}}},{"./check":4,"./extend":15,"./values":33}],18:[function(c,g,m){var b=c("./is-typed-array");g.exports=function(c){return"object"===typeof c&&Array.isArray(c.shape)&&Array.isArray(c.stride)&&"number"===typeof c.offset&&c.shape.length===c.stride.length&&(Array.isArray(c.data)||b(c.data))}},{"./is-typed-array":19}],19:[function(c,g,m){var b=c("./constants/arraytypes.json");g.exports=function(c){return Object.prototype.toString.call(c)in
b}},{"./constants/arraytypes.json":8}],20:[function(c,g,m){g.exports=function(b,c){var e=1;c.ext_texture_filter_anisotropic&&(e=b.getParameter(34047));var a=1,l=1;c.webgl_draw_buffers&&(a=b.getParameter(34852),l=b.getParameter(36063));return{colorBits:[b.getParameter(3410),b.getParameter(3411),b.getParameter(3412),b.getParameter(3413)],depthBits:b.getParameter(3414),stencilBits:b.getParameter(3415),subpixelBits:b.getParameter(3408),extensions:Object.keys(c).filter(function(a){return!!c[a]}),maxAnisotropic:e,
maxDrawbuffers:a,maxColorAttachments:l,pointSizeDims:b.getParameter(33901),lineWidthDims:b.getParameter(33902),maxViewportDims:b.getParameter(3386),maxCombinedTextureUnits:b.getParameter(35661),maxCubeMapSize:b.getParameter(34076),maxRenderbufferSize:b.getParameter(34024),maxTextureUnits:b.getParameter(34930),maxTextureSize:b.getParameter(3379),maxAttributes:b.getParameter(34921),maxVertexUniforms:b.getParameter(36347),maxVertexTextureUnits:b.getParameter(35660),maxVaryingVectors:b.getParameter(36348),
maxFragmentUniforms:b.getParameter(36349),glsl:b.getParameter(35724),renderer:b.getParameter(7937),vendor:b.getParameter(7936),version:b.getParameter(7938)}}},{}],21:[function(c,g,m){g.exports=function(b,c){if("undefined"!==typeof document){var e;e=(e=/\.(\w+)(\?.*)?$/.exec(b))&&e[1]?e[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(e))return e=document.createElement("video"),e.autoplay=!0,e.loop=!0,c&&(e.crossOrigin=c),e.src=
b,e;if(0<=["dds"].indexOf(e))return e=new XMLHttpRequest,e.responseType="arraybuffer",e.open("GET",b,!0),e.send(),e;e=new Image;c&&(e.crossOrigin=c);e.src=b;return e}return null}},{}],22:[function(c,g,m){var b=c("./check");g.exports=function(c){function g(a){for(var b=X,d=ia,e=0;e<Y;++e){var h=Math.max(1,b+3>>2)*Math.max(1,d+3>>2)*Z;I.pixels.push({target:a,miplevel:e,width:b,height:d,data:new Uint8Array(c,K,h)});K+=h;b>>=1;d>>=1}}var m=new Int32Array(c);b(m[0]===q,"invalid magic number for dds header");
var ma=m[fa];b(ma&z,"unsupported dds format");var X=m[T],ia=m[ga],ba=O,R=0,Z=0,U=4;switch(m[oa]){case M:Z=8;ma&h?(U=3,R=l):R=d;break;case x:Z=16;R=k;break;case u:Z=16;R=P;break;case ea:Z=8;R=Q;break;default:b.raise("unsupported dds texture format")}var Y=1;m[ka]&A&&(Y=Math.max(1,m[ca]));var K=m[W]+4,I={width:X,height:ia,channels:U,format:R,type:ba,compressed:!0,cube:!1,pixels:[]},m=m[ha];if(m&t)for(b((m&n)===n,"missing cubemap faces"),I.cube=!0,m=0;6>m;++m)g(a+m);else g(e);return I};var q=542327876,
e=3553,a=34069,l=33776,d=33777,k=33778,P=33779,Q=36196,O=5121,A=131072,t=512,n=64512,z=4,h=64,M=827611204,x=861165636,u=894720068,ea=826496069,W=1,fa=2,ga=3,T=4,ca=7,ka=20,oa=21,ha=28},{"./check":4}],23:[function(c,g,m){g.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(b){return requestAnimationFrame(b)},cancel:function(b){return cancelAnimationFrame(b)}}:{next:function(b){setTimeout(b,30)},cancel:clearTimeout}},{}],24:[function(c,g,m){var b=
c("./check"),q=c("./is-typed-array");g.exports=function(c,a,l){return function(d){var k=d||{};q(d)?k={data:k}:2===arguments.length?k={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof d&&(k={});a();var g=k.x||0,m=k.y||0,O=k.width||l.width,A=k.height||l.height,t=O*A*4,k=k.data||new Uint8Array(t);b.isTypedArray(k);b(k.byteLength>=t,"data buffer too small");c.pixelStorei(3333,4);c.readPixels(g,m,O,A,6408,5121,k);return k}}},{"./check":4,"./is-typed-array":19}],25:[function(c,g,m){var b=c("./check"),
q=c("./values");g.exports=function(c,a,l){function d(){this.id=O++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function k(a){c.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=c.createRenderbuffer());c.bindRenderbuffer(36161,a.renderbuffer);c.renderbufferStorage(36161,a.format,a.width,a.height)}function g(a){var d=a.renderbuffer;b(d,"must not double destroy renderbuffer");c.bindRenderbuffer(36161,null);c.isRenderbuffer(d)&&c.deleteRenderbuffer(d);a.renderbuffer=
null;a.refCount=0;delete A[a.id]}var m={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};a.ext_srgb&&(m.srgba=35907);a.ext_color_buffer_half_float&&(m.rgba16f=34842,m.rgb16f=34843);a.webgl_color_buffer_float&&(m.rgba32f=34836);var O=0,A={};d.prototype.decRef=function(){0===--this.refCount&&g(this)};return{create:function(a){function c(a){a=a||{};var d=0,g=0;"shape"in a?(g=a.shape,b(Array.isArray(g)&&2<=g.length,"invalid renderbuffer shape"),d=g[0]|0,g=g[1]|
0):("radius"in a&&(d=g=a.radius|0),"width"in a&&(d=a.width|0),"height"in a&&(g=a.height|0));var q=l.maxRenderbufferSize;b(0<=d&&0<=g&&d<=q&&g<=q,"invalid renderbuffer size");c.width=e.width=Math.max(d,1);c.height=e.height=Math.max(g,1);e.format=32854;"format"in a&&(a=a.format,b.parameter(a,m,"invalid render buffer format"),e.format=m[a]);k(e);return c}var e=new d;A[e.id]=e;c(a);c._reglType="renderbuffer";c._renderbuffer=e;c.destroy=function(){e.decRef()};return c},refresh:function(){q(A).forEach(k)},
clear:function(){q(A).forEach(g)}}}},{"./check":4,"./values":33}],26:[function(c,g,m){function b(a,b,d){this.name=a;this.location=b;this.info=d}var q=c("./check"),e=c("./values");g.exports=function(a,c,d,k,g){function m(b,d){var c=35632===b?t:n,e=c[d];if(!e){var h=g.str(d),e=a.createShader(b);a.shaderSource(e,h);a.compileShader(e);q.shaderError(a,e,h,b);c[d]=e}return e}function O(a,b){this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];this.draw=function(){};this.batchCache=
{}}function A(e){var h,g;h=m(35632,e.fragId);g=m(35633,e.vertId);var n=e.program=a.createProgram();a.attachShader(n,h);a.attachShader(n,g);a.linkProgram(n);q.linkError(a,n);var t=a.getProgramParameter(n,35718),z=e.uniforms=[];for(h=0;h<t;++h)if(g=a.getActiveUniform(n,h))if(1<g.size)for(var P=0;P<g.size;++P){var A=g.name.replace("[0]","["+P+"]");d.def(A);z.push(new b(A,a.getUniformLocation(n,A),g))}else d.def(g.name),z.push(new b(g.name,a.getUniformLocation(n,g.name),g));t=a.getProgramParameter(n,
35721);z=e.attributes=[];for(h=0;h<t;++h)if(g=a.getActiveAttrib(n,h))c.def(g.name),z.push(new b(g.name,a.getAttribLocation(n,g.name),g));e.draw=k(e);e.batchCache={}}var t={},n={},z={},h=[];return{create:function(a,b){var d=z[b];d||(d=z[b]={});var c=d[a];c||(c=new O(b,a),A(c),d[a]=c,h.push(c));return c},clear:function(){var b=a.deleteShader.bind(a);e(t).forEach(b);t={};e(n).forEach(b);n={};h.forEach(function(b){a.deleteProgram(b.program)});h.length=0;z={}},refresh:function(){t={};n={};h.forEach(A)},
programs:[null],fragShaders:[g.id("void main(){gl_FragColor=vec4(0,0,0,0);}")],vertShaders:[g.id("void main(){gl_Position=vec4(0,0,0,0);}")]}}},{"./check":4,"./values":33}],27:[function(c,g,m){g.exports=function(b,c){var e=b.length,a=b.slice(),g=b.slice(),d=!1,k=!0;return{push:function(){d=!1;for(var b=0;b<e;++b){var c=arguments[b];d=d||c!==g[b];a.push(c)}},pop:function(){d=!1;a.length-=e;for(var b=0;b<e;++b)d=d||a[a.length-e+b]!==g[b]},poll:function(){var b=a.length-e;if(d||k){switch(e){case 1:c(a[b]);
break;case 2:c(a[b],a[b+1]);break;case 3:c(a[b],a[b+1],a[b+2]);break;case 4:c(a[b],a[b+1],a[b+2],a[b+3]);break;case 5:c(a[b],a[b+1],a[b+2],a[b+3],a[b+4]);break;case 6:c(a[b],a[b+1],a[b+2],a[b+3],a[b+4],a[b+5]);break;default:c.apply(null,a.slice(b,a.length))}for(var m=0;m<e;++m)g[m]=a[b+m];k=d=!1}},setDirty:function(){k=!0}}}},{}],28:[function(c,g,m){var b=c("./stack"),q=c("./codegen");g.exports=function(c,a,g){function d(a,d){var g=b([!!d],function(b){b?c.enable(a):c.disable(a)});g.flag=a;return g}
var k={dither:d(3024),"blend.enable":d(3042),"blend.color":b([0,0,0,0],function(a,b,d,h){c.blendColor(a,b,d,h)}),"blend.equation":b([32774,32774],function(a,b){c.blendEquationSeparate(a,b)}),"blend.func":b([1,0,1,0],function(a,b,d,h){c.blendFuncSeparate(a,b,d,h)}),"depth.enable":d(2929,!0),"depth.func":b([513],function(a){c.depthFunc(a)}),"depth.range":b([0,1],function(a,b){c.depthRange(a,b)}),"depth.mask":b([!0],function(a){c.depthMask(a)}),"cull.enable":d(2884),"cull.face":b([1029],function(a){c.cullFace(a)}),
frontFace:b([2305],function(a){c.frontFace(a)}),colorMask:b([!0,!0,!0,!0],function(a,b,d,h){c.colorMask(a,b,d,h)}),lineWidth:b([1],function(a){c.lineWidth(a)}),"polygonOffset.enable":d(32823),"polygonOffset.offset":b([0,0],function(a,b){c.polygonOffset(a,b)}),"sample.alpha":d(32926),"sample.enable":d(32928),"sample.coverage":b([1,!1],function(a,b){c.sampleCoverage(a,b)}),"stencil.enable":d(2960),"stencil.mask":b([-1],function(a){c.stencilMask(a)}),"stencil.func":b([519,0,-1],function(a,b,d){c.stencilFunc(a,
b,d)}),"stencil.opFront":b([7680,7680,7680],function(a,b,d){c.stencilOpSeparate(1028,a,b,d)}),"stencil.opBack":b([7680,7680,7680],function(a,b,d){c.stencilOpSeparate(1029,a,b,d)}),"scissor.enable":d(3089),"scissor.box":b([0,0,-1,-1],function(b,d,g,h){var k=g,l=a.top();0>g&&(k=l?l.width-b:c.drawingBufferWidth-b);g=h;0>h&&(g=l?l.height-d:c.drawingBufferHeight-d);c.scissor(b,d,k,g)}),viewport:b([0,0,-1,-1],function(b,d,k,h){var m=k,q=a.top();0>k&&(m=q?q.width-b:c.drawingBufferWidth-b);k=h;0>h&&(k=q?
q.height-d:c.drawingBufferHeight-d);c.viewport(b,d,m,k);g.width=m;g.height=k})},m=q(),Q=m.proc("poll"),O=m.proc("refresh");Object.keys(k).forEach(function(a){a=m.link(k[a]);Q(a,".poll();");O(a,".setDirty();")});var A=m.compile();return{contextState:k,viewport:g,poll:A.poll,refresh:A.refresh,notifyViewportChanged:function(){k.viewport.setDirty();k["scissor.box"].setDirty()}}}},{"./codegen":6,"./stack":27}],29:[function(c,g,m){g.exports=function(){var b={},c=[""];return{id:function(e){var a=b[e];if(a)return a;
a=b[e]=c.length;c.push(e);return a},str:function(b){return c[b]}}}},{}],30:[function(c,g,m){function b(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function q(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,d=1;d<b;++d)if(!Array.isArray(a[d])||a[d].length!==c)return!1;return!0}function e(a){return Object.prototype.toString.call(a)}function a(a){return"[object HTMLCanvasElement]"===e(a)}function l(a){return"[object CanvasRenderingContext2D]"===
e(a)}var d=c("./check"),k=c("./extend"),P=c("./values"),Q=c("./is-typed-array"),O=c("./is-ndarray"),A=c("./load-texture"),t=c("./to-half-float"),n=c("./parse-dds"),z=[9984,9986,9985,9987];g.exports=function(c,g,m,u,ea){function W(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=this.miplevel=
0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function fa(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ga(a,b){var c,e,k=0,l=0,h=0,m=0,n=0,q=0,p=!1,r=!1,t=!1,u=0,v=[0,0,0,0,0,0],A=0,F=!1;for(c=0;c<b.length;++c){e=b[c];var m=m||e.width<<e.miplevel,
n=n||e.height<<e.miplevel,k=k||e.type,l=l||e.format,h=h||e.internalformat,q=q||e.channels,r=r||e.needsPoll,t=t||e.needsListeners,p=p||e.compressed,x=e.miplevel;e=e.target;F=F||0<x;3553===e?u|=1<<x:(e-=34069,v[e]|=1<<x,A|=1<<e)}a.needsPoll=r;a.needsListeners=t;a.width=m;a.height=n;a.format=l;a.internalformat=h;a.type=k;r=F?(m<<1)-1:1;if(3553===a.target)d(0===A,"pixmap type must not contain cubemap faces"),d(u===r,"missing mip map data");else for(d(63===A,"missing cubemap faces"),c=0;6>c;++c)d(v[c]===
r,"missing mip map data");c=0<=z.indexOf(a.minFilter);a.genMipmaps=!F&&(a.genMipmaps||c);F=F||a.genMipmaps;a.minFilter?d(F===c,"min filter inconsistent with mipmap data"):a.minFilter=F?9987:9728;F&&d(m===n&&!(m&m-1)&&!!m,"must be a square power of 2 to support mipmaps");a.genMipmaps&&d(!p,"mipmap generation not supported for compressed textures");a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;33071===a.wrapS&&33071===a.wrapT||d(!(m&m-1)&&!!m&&!(n&n-1)&&!!n&&!A,"incompatible size for wrap mode, image must be a power of 2");
(5126===k&&!g.oes_texture_float_linear||36193===k&&!g.oes_texture_half_float_linear)&&d(9728===this.magFilter&&9728===this.minFilter,"unsupported filter mode for float texture");for(c=0;c<b.length;++c)e=b[c],p=e.miplevel,e.width&&d(e.width<<p===m,"inconsistent width"),e.height&&d(e.height<<p===n,"inconsistent width"),e.channels?d(e.channels===q,"inconsistent channels"):e.channels=q,e.format?d(e.format===l,"inconsistent format"):e.format=l,e.internalformat?d(e.internalformat===h,"inconsistent internalformat"):
e.internalformat=h,e.type?d(e.type===k,"inconsistent type"):e.type=k,e.copy&&d(5121===e.type&&6408===e.internalformat,"incompatible format/type for copyTexImage2D")}function T(a){this.id=v++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new fa(a);this.pixels=[]}function ca(a,b){function c(a,f){var d=f.mipmap,e;if(Array.isArray(d))for(var g=0;g<d.length;++g)e=new W(a),e.parseFlags(b),e.parseFlags(f),e.parse(d[g],g),k.push(e);
else e=new W(a),e.parseFlags(b),e.parse(f,0),k.push(e)}var e;ha(a);var g=a.params;fa.call(g,a.target);var k=a.pixels;k.length=0;g.parse(b);if(3553===a.target)c(3553,b);else{var l=b.faces||b;if(Array.isArray(l))for(d(6===l.length,"invalid number of faces in cube map"),e=0;6>e;++e)c(34069+e,l[e]);else if("string"!==typeof l)for(e=0;6>e;++e)c(34069+e,{})}ga(g,k);g.needsListeners&&oa(a);g.needsPoll&&(a.pollId=C.length,C.push(a));ka(a)}function ka(a){c.isTexture(a.texture)||(a.texture=c.createTexture());
var b=a.target,d=a.unit;0<=d?(c.activeTexture(33984+d),I=d):c.bindTexture(b,a.texture);for(var b=a.pixels,e=a.params,g=0;g<b.length;++g)b[g].upload(e);e.upload();0>d&&((d=aa[I])?c.bindTexture(d.target,d.texture):(a.unit=I,aa[I]=a))}function oa(a){function b(c,e,k){var l=n(k);d(l.format in K,"unsupported dds texture format");l.cube?(d(34067===a.target),d.raise("cube map DDS not yet implemented")):d(3553===a.target);e&&d(1===l.pixels.length,"number of mip levels inconsistent");l.pixels.forEach(function(a){var b=
new W(l.cube?a.target:c);b.channels=l.channels;b.compressed=l.compressed;b.type=l.type;b.internalformat=l.format;b.format=K[l.format];b.width=a.width;b.height=a.height;b.miplevel=a.miplevel||e;b.data=a.data;g.push(b)})}function c(){for(var d=0;d<g.length;++d){var k=g[d],l=k.image,h=k.video,E=k.xhr;l&&l.complete?(k.width=l.naturalWidth,k.height=l.naturalHeight):h&&2<h.readyState?(k.width=h.width,k.height=h.height):E&&4===E.readyState&&(g[d]=g[g.length-1],g.pop(),E.removeEventListener("readystatechange",
ka),b(k.target,k.miplevel,E.response))}ga(e,g);ka(a)}var e=a.params,g=a.pixels;g.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){g.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function ha(a){var b=
a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((C[b]=C[C.length-1]).id=b,C.pop(),a.pollId=-1)}function la(a){var b=a.texture;d(b,"must not double destroy texture");var e=a.unit,g=a.target;0<=e&&(c.activeTexture(33984+e),I=e,c.bindTexture(g,null),aa[e]=null);ha(a);c.isTexture(b)&&c.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete p[a.id]}var D={"don't care":4352,"dont care":4352,nice:4354,fast:4353},J={repeat:10497,clamp:33071,mirror:33648},ma={nearest:9728,
linear:9729},X=k({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ma),ia={none:0,browser:37444},ba={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},R={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Z={};g.ext_srgb&&(R.srgb=35904,R.srgba=35906);g.oes_texture_float&&(ba["float"]=5126);g.oes_texture_half_float&&(ba["half float"]=36193);g.webgl_depth_texture&&
(k(R,{depth:6402,"depth stencil":34041}),k(ba,{uint16:5123,uint32:5125,"depth stencil":34042}));g.webgl_compressed_texture_s3tc&&k(Z,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});g.webgl_compressed_texture_atc&&k(Z,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});g.webgl_compressed_texture_pvrtc&&k(Z,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});g.webgl_compressed_texture_etc1&&
(Z["rgb etc1"]=36196);var U=Array.prototype.slice.call(c.getParameter(34467));Object.keys(Z).forEach(function(a){var b=Z[a];0<=U.indexOf(b)&&(R[a]=b)});var Y=Object.keys(R);m.textureFormats=Y;var K=Y.reduce(function(a,b){var c=R[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});k(W.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in a&&(d.type(a.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),
this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(d.type(a.flipY,"boolean","invalid texture flip"),this.flipY=a.flipY);"alignment"in a&&(d.oneOf(a.alignment,[1,2,4,8],"invalid texture unpack alignment"),this.unpackAlignment=a.alignment);"colorSpace"in a&&(d.parameter(a.colorSpace,ia,"invalid colorSpace"),this.colorSpace=ia[a.colorSpace]);if("format"in a){var b=a.format;d.parameter(b,R,"invalid texture format");this.internalformat=R[b];b in ba&&(this.type=ba[b]);b in Z&&(this.compressed=!0)}"type"in
a&&(b=a.type,d.parameter(b,ba,"invalid texture type"),this.type=ba[b]);var b=this.width,c=this.height,e=this.channels;"shape"in a?(d(Array.isArray(a.shape)&&2<=a.shape.length,"shape must be an array"),b=a.shape[0],c=a.shape[1],3===a.shape.length&&(e=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),"height"in a&&(c=a.height),"channels"in a&&(e=a.channels));this.width=b|0;this.height=c|0;this.channels=e|0;"stride"in a?(b=a.stride,d(Array.isArray(b)&&2<=b.length,"invalid stride vector"),
this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*e,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(c,k){this.miplevel=k;this.width>>=k;this.height>>=k;var h=c;switch(typeof c){case "string":break;case "object":if(!c)return;this.parseFlags(c);var m=c.data;if("string"===typeof m||m&&(Q(m)||b(m)||O(m)||a(m)||
l(m)||"[object HTMLImageElement]"===e(m)||"[object HTMLVideoElement]"===e(m)||q(m)))h=c.data;break;case "undefined":return;default:d.raise("invalid pixel data type")}"string"===typeof h&&(h=A(h,this.crossOrigin));var m=null,n=!1;this.compressed&&d(h instanceof Uint8Array||"[object XMLHttpRequest]"===e(h),"compressed texture data must be stored in a uint8array");if(null!==h)if(Q(h))this.data=h;else if(b(h))m=h,n=!0;else if(O(h)){Array.isArray(h.data)?(m=h.data,n=!0):this.data=h.data;var p=h.shape;
this.width=p[0];this.height=p[1];this.channels=3===p.length?p[2]:1;p=h.stride;this.strideX=h.stride[0];this.strideY=h.stride[1];this.strideC=3===p.length?h.stride[2]:1;this.offset=h.offset;this.needsTranspose=!0}else if(a(h)||l(h))a(h)?this.canvas=h:this.canvas=h.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===e(h))this.image=h,h.complete?(this.width=h.naturalWidth,this.height=h.naturalHeight):(this.width=this.width||
h.naturalWidth,this.height=this.height||h.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();else if("[object HTMLVideoElement]"===e(h))this.video=h,1<h.readyState?(this.width=h.width,this.height=h.height):(this.width=this.width||h.width,this.height=this.height||h.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===e(h))this.xhr=h,this.needsListeners=!0;else if(q(h)){var n=h.length,p=h[0].length,r=1,u,v,x,z;if(Array.isArray(h[0][0]))for(r=
h[0][0].length,d(0<=r&&4>=r,"invalid number of channels for image data"),m=Array(n*p*r),v=z=0;v<p;++v)for(u=0;u<n;++u)for(x=0;x<r;++x)m[z++]=h[u][v][x];else for(m=Array(n*p),v=z=0;v<p;++v)for(u=0;u<n;++u)m[z++]=h[u][v];this.width=n;this.height=p;this.channels=r;n=!0}else c.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||ea.width)|0,this.height=(this.height||ea.height)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:
this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=[6409,6410,6407,6408][(this.channels=this.channels||4)-1],d(this.internalformat,"invalid number of channels"));p=this.internalformat;if(6402===p||34041===p)d(g.webgl_depth_texture,"depth/stencil texture not supported"),6402===p&&d(5123===this.type||5125,"depth texture type must be uint16 or uint32"),34041===p&&d(34042===this.type,"depth stencil texture format must match type"),
d(!this.data&&!m&&!this.image&&!this.video&&!this.canvas,"depth/stencil textures are for rendering only");h=this.format=K[p];if(!this.channels)switch(h){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}h=this.type;5126===h?d(g.oes_texture_float,"float texture not supported"):36193===h?d(g.oes_texture_half_float,"half float texture not supported"):h||(h=6402===p?5125:5121);this.type=h;if(n)switch(h){case 5121:this.data=
new Uint8Array(m);break;case 5123:this.data=new Uint16Array(m);break;case 5125:this.data=new Uint32Array(m);break;case 5126:this.data=new Float32Array(m);break;case 36193:this.data=t(m);break;case 33635:case 32820:case 32819:case 34042:d.raise("unsupported format for automatic conversion");break;default:d.raise("unsupported type conversion")}if(this.data){if(this.needsTranspose){m=this.data;n=this.width;p=this.height;r=this.channels;u=this.strideX;v=this.strideY;x=this.strideC;z=this.offset;for(var y=
new m.constructor(n*p*r),D=0,C=0;C<p;++C)for(var I=0;I<n;++I)for(var J=0;J<r;++J)y[D++]=m[v*C+u*I+x*J+z];this.data=y}switch(h){case 5121:d(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray,"incompatible pixel type");break;case 33635:case 32820:case 32819:case 5123:case 36193:d(this.data instanceof Uint16Array,"incompatible pixel type");break;case 5125:d(this.data instanceof Uint32Array,"incompatible pixel type");break;case 5126:d(this.data instanceof Float32Array,"incompatible pixel type");
break;default:d.raise("bad or missing pixel type")}}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){c.pixelStorei(37440,this.flipY);c.pixelStorei(37441,this.premultiplyAlpha);c.pixelStorei(37443,this.colorSpace);c.pixelStorei(3317,this.unpackAlignment);var b=this.target,d=this.miplevel,e=this.image,g=this.canvas,k=this.video,l=this.data,m=this.internalformat,n=this.format,p=this.type,q=this.width||
Math.max(1,a.width>>d);a=this.height||Math.max(1,a.height>>d);k&&2<k.readyState?c.texImage2D(b,d,n,n,p,k):e&&e.complete?c.texImage2D(b,d,n,n,p,e):g?c.texImage2D(b,d,n,n,p,g):this.compressed?c.compressedTexImage2D(b,d,m,q,a,0,l):this.copy?(u(),c.copyTexImage2D(b,d,n,this.x,this.y,q,a,0)):l?c.texImage2D(b,d,n,q,a,0,n,p,l):c.texImage2D(b,d,n,q||1,a||1,0,n,p,null)}});k(fa.prototype,{parse:function(a){if("object"===typeof a&&a){if("min"in a){var b=a.min;d.parameter(b,X);this.minFilter=X[b]}"mag"in a&&
(b=a.mag,d.parameter(b,ma),this.magFilter=ma[b]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var e=a.wrap;"string"===typeof e?(d.parameter(e,J),b=c=J[e]):Array.isArray(e)&&(d.parameter(e[0],J),d.parameter(e[1],J),b=J[e[0]],c=J[e[1]])}else"wrapS"in a&&(b=a.wrapS,d.parameter(b,J),b=J[b]),"wrapT"in a&&(c=a.wrapT,d.parameter(c,J),c=J[c]);this.wrapS=b;this.wrapT=c;"anisotropic"in a&&(b=a.anisotropic,d("number"===typeof b&&1<=b&&b<=m.maxAnisotropic,"aniso samples must be between 1 and "),this.anisotropic=
a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":d.parameter(a,D,"invalid mipmap hint");this.mipmapHint=D[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a;break;case "object":break;default:d.raise("invalid mipmap type")}}},upload:function(){var a=this.target;c.texParameteri(a,10241,this.minFilter);c.texParameteri(a,10240,this.magFilter);c.texParameteri(a,10242,this.wrapS);c.texParameteri(a,10243,this.wrapT);g.ext_texture_filter_anisotropic&&c.texParameteri(a,
34046,this.anisotropic);this.genMipmaps&&(c.hint(33170,this.mipmapHint),c.generateMipmap(a))}});var I=0,v=0,p={},C=[],r=m.maxTextureUnits,aa=Array(r).map(function(){return null});k(T.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<r;++b){var e=aa[b];if(e){if(0<e.bindCount)continue;e.unit=-1}aa[b]=this;a=b;break}a>=r&&d.raise("insufficient number of texture units");this.unit=a;c.activeTexture(33984+a);c.bindTexture(this.target,this.texture);I=a}return a},unbind:function(){--this.bindCount},
decRef:function(){0===--this.refCount&&la(this)}});return{create:function(a,b){function c(a,e,f,g,h,k){var l=a||{};34067===b&&6===arguments.length&&(l=[a,e,f,g,h,k]);ca(d,l);c.width=d.params.width;c.height=d.params.height;return c}var d=new T(b);p[d.id]=d;c(a);c._reglType="texture";c._texture=d;c.destroy=function(){d.decRef()};return c},refresh:function(){P(p).forEach(ka);for(var a=0;a<r;++a)aa[a]=null;I=0;c.activeTexture(33984)},clear:function(){for(var a=0;a<r;++a)c.activeTexture(33984+a),c.bindTexture(3553,
null),aa[a]=null;c.activeTexture(33984);I=0;P(p).forEach(la)},poll:function(){C.forEach(ka)},getTexture:function(a){return null}}}},{"./check":4,"./extend":15,"./is-ndarray":18,"./is-typed-array":19,"./load-texture":21,"./parse-dds":22,"./to-half-float":31,"./values":33}],31:[function(c,g,m){g.exports=function(b){for(var c=new Float32Array(b),c=new Uint32Array(c.buffer),e=new Uint16Array(b.length),a=0;a<b.length;++a)if(isNaN(b[a]))e[a]=65535;else if(Infinity===b[a])e[a]=31744;else if(-Infinity===
b[a])e[a]=64512;else{var g=c[a],d=g>>>31<<15,k=(g<<1>>>24)-127,g=g>>13&1023;e[a]=-24>k?d:-14>k?d+(g+1024>>-14-k):15<k?d+31744:d+(k+15<<10)+g}return e}},{}],32:[function(c,g,m){g.exports=function(b){var c={};return{def:function(e){e=b.id(e);var a=c[e];a||(a=c[e]=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]);return a}}}},{}],33:[function(c,g,m){g.exports=function(b){return Object.keys(b).map(function(c){return b[c]})}},{}],34:[function(c,g,m){var b=c("./lib/check"),q=c("./lib/extend"),e=c("./lib/context"),a=
c("./lib/strings"),l=c("./lib/extension"),d=c("./lib/limits"),k=c("./lib/buffer"),P=c("./lib/elements"),Q=c("./lib/texture"),O=c("./lib/renderbuffer"),A=c("./lib/framebuffer"),t=c("./lib/uniform"),n=c("./lib/attribute"),z=c("./lib/shader"),h=c("./lib/draw"),M=c("./lib/state"),x=c("./lib/compile"),u=c("./lib/read"),ea=c("./lib/dynamic"),W=c("./lib/raf"),fa=c("./lib/clock");g.exports=function(){function c(){H=W.next(c);r.count+=1;if(r.width!==D.drawingBufferWidth||r.height!==D.drawingBufferHeight)r.width=
D.drawingBufferWidth,r.height=D.drawingBufferHeight,aa.notifyViewportChanged();var a=fa();r.dt=a-r.t;r.t=a;v.poll();for(var b=0;b<E.length;++b)(0,E[b])(r.count,r.t,r.dt);r.renderTime=fa()-a}function g(){H&&(W.cancel(c),H=0)}function m(a){g();a.preventDefault();if(J.onContextLost)J.onContextLost()}function ka(a){D.getError();ma.refresh();R.refresh();v.refresh();p.refresh();C.refresh();K.refresh();aa.refresh();if(J.onContextRestored)J.onContextRestored();c()}function oa(a){function c(a){var b={},e=
{};Object.keys(a).forEach(function(c){var f=a[c];ea.isDynamic(f)?(d=!0,e[c]=ea.unbox(f,c)):b[c]=f});return{dynamic:e,"static":b}}b(!!a,"invalid args to regl({...})");b.type(a,"object","invalid args to regl({...})");var d=!1,e=c(a.uniforms||{}),g=c(a.attributes||{});a=c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=q({},a);delete c.uniforms;delete c.attributes;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");
b("sample");return c}(a));var e=f.command(a["static"],e["static"],g["static"],a.dynamic,e.dynamic,g.dynamic,d),h=e.draw,k=e.batch,m=e.scope,l=[];return function(a,b){if("number"===typeof a){for(var c=a|0;l.length<c;)l.push(null);return k(a|0,l)}return Array.isArray(a)?k(a.length,a):"function"===typeof a?m(null,a):"function"===typeof b?m(a,b):h(a)}}function ha(){C.poll();aa.poll()}var la=e(Array.prototype.slice.call(arguments)),D=la.gl,J=la.options,la=a(),ma=l(D),X=ma.extensions,ia={width:D.drawingBufferWidth,
height:D.drawingBufferHeight},ba=d(D,X),R=k(D),Z=P(D,X,R),U=t(la),Y=n(D,X,ba,R,la),K=z(D,Y,U,function(a){return f.draw(a)},la),I=h(D,X,R),v=Q(D,X,ba,ha,ia),p=O(D,X,ba),C=A(D,X,ba,v,p),r={count:0,start:fa(),dt:0,t:fa(),renderTime:0,width:D.drawingBufferWidth,height:D.drawingBufferHeight,pixelRatio:J.pixelRatio},aa=M(D,C,ia),ia=u(D,ha,ia),f=x(D,la,X,ba,R,Z,v,C,aa,U,Y,K,I,r,ha),G=D.canvas,E=[],H=0;G&&(G.addEventListener("webglcontextlost",m,!1),G.addEventListener("webglcontextrestored",ka,!1));return q(oa,
{clear:function(a){var c=0;ha();var d=a.color;d&&(D.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in a&&(D.clearDepth(+a.depth),c|=256);"stencil"in a&&(D.clearStencil(a.stencil|0),c|=1024);b(!!c,"called regl.clear with no buffer specified");D.clear(c)},prop:ea.define,draw:oa({}),elements:function(a){return Z.create(a)},buffer:function(a){return R.create(a,34962)},texture:function(a){return v.create(a,3553)},cube:function(a){return 6===arguments.length?v.create(Array.prototype.slice.call(arguments),
34067):v.create(a,34067)},renderbuffer:function(a){return p.create(a)},framebuffer:function(a){return C.create(a)},framebufferCube:function(a){b.raise("framebuffer cube not yet implemented")},frame:function(a){E.push(a);!H&&0<E.length&&c();return{cancel:function(){var b=E.find(function(b){return b===a});0>b||(E.splice(b,1),0>=E.length&&g())}}},stats:r,limits:ba,read:ia,destroy:function(){g();G&&(G.removeEventListener("webglcontextlost",m),G.removeEventListener("webglcontextrestored",ka));K.clear();
C.clear();p.clear();v.clear();R.clear();if(J.onDestroy)J.onDestroy()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/check":4,"./lib/clock":5,"./lib/compile":7,"./lib/context":11,"./lib/draw":12,"./lib/dynamic":13,"./lib/elements":14,"./lib/extend":15,"./lib/extension":16,"./lib/framebuffer":17,"./lib/limits":20,"./lib/raf":23,"./lib/read":24,"./lib/renderbuffer":25,"./lib/shader":26,"./lib/state":28,"./lib/strings":29,"./lib/texture":30,"./lib/uniform":32}]},{},[1]);

        </script>
        </body>
      </html>