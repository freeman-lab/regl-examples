<!DOCTYPE html>
      <html>
        <head>
          <title>example/batch.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(m,p,n){function f(b,d){if(!p[b]){if(!m[b]){var l="function"==typeof require&&require;if(!d&&l)return l(b,!0);if(t)return t(b,!0);l=Error("Cannot find module '"+b+"'");throw l.code="MODULE_NOT_FOUND",l;}l=p[b]={exports:{}};m[b][0].call(l.exports,function(d){var l=m[b][1][d];return f(l?l:d)},l,l.exports,e$$0,m,p,n)}return p[b].exports}for(var t="function"==typeof require&&require,l=0;l<n.length;l++)f(n[l]);return f})({1:[function(e,m,p){var n=e("../regl")(),f=n({frag:"\n    precision mediump float;\n    uniform vec4 color;\n    void main() {\n      gl_FragColor = color;\n    }",
vert:"\n    precision mediump float;\n    attribute vec2 position;\n    uniform float angle;\n    uniform vec2 offset;\n    void main() {\n      gl_Position = vec4(\n        cos(angle) * position.x + sin(angle) * position.y + offset.x,\n        -sin(angle) * position.x + cos(angle) * position.y + offset.y, 0, 1);\n    }",attributes:{position:[.5,0,0,.5,1,1]},uniforms:{color:function(f,l,b){f=f.count;return[Math.sin(.02*((.1+Math.sin(b))*f+3*b)),Math.cos(.02*(.02*f+.1*b)),Math.sin(.02*((.3+Math.cos(2*
b))*f+.8*b)),1]},angle:function(f){return.01*f.count},offset:n.prop("offset")},depth:{enable:!1},count:3});n.frame(function(){n.clear({color:[0,0,0,1]});f([{offset:[-1,-1]},{offset:[-1,0]},{offset:[-1,1]},{offset:[0,-1]},{offset:[0,0]},{offset:[0,1]},{offset:[1,-1]},{offset:[1,0]},{offset:[1,1]}])})},{"../regl":30}],2:[function(e,m,p){function n(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}m.exports=
function(f,t,l,b,d){f=l.maxAttributes;t=Array(f);for(l=0;l<f;++l)t[l]=new n;return{Record:n,scope:{},state:t}}},{}],3:[function(e,m,p){function n(b){return H[Object.prototype.toString.call(b)]|0}function f(b,d){for(var f=0;f<d.length;++f)b[f]=d[f]}function t(b,d,f,l,n,a,t){for(var e=0,U=0;U<f;++U)for(var la=0;la<l;++la)b[e++]=d[n*U+a*la+t]}function l(b,d,f){for(var l=0,n=0;n<d.length;++n)for(var a=d[n],t=0;t<f;++t)b[l++]=a[t]}var b=e("./util/is-typed-array"),d=e("./util/is-ndarray"),z=e("./util/values"),
A=e("./util/pool"),H=e("./constants/arraytypes.json"),E=e("./constants/dtypes.json"),u=e("./constants/usage.json");m.exports=function(x){function e(b){this.id=a++;this.buffer=x.createBuffer();this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121}function C(b,d,f){b.byteLength=d.byteLength;x.bufferData(b.type,d,f)}function q(a,k,x,e,q){a.usage=x;if(Array.isArray(k))a.dtype=e||5126,0<k.length&&(Array.isArray(k[0])?(a.dimension=k[0].length,e=A.allocType(a.dtype,k.length*a.dimension),
l(e,k,a.dimension),C(a,e,x),A.freeType(e)):"number"===typeof k[0]?(a.dimension=q,e=A.allocType(a.dtype,k.length),f(e,k),C(a,e,x),A.freeType(e)):b(k[0])&&(a.dimension=k[0].length,a.dtype=e||n(k[0])||5126,e=A.allocType(a.dtype,k.length*a.dimension),l(e,k,a.dimension),C(a,e,x),A.freeType(e)));else if(b(k))a.dtype=e||n(k),a.dimension=q,C(a,k,x);else if(d(k)){var D=k.shape,z=k.stride;q=k.offset;var P=0,R=0,M=0,S=0;1===D.length?(P=D[0],R=1,M=z[0],S=0):2===D.length&&(P=D[0],R=D[1],M=z[0],S=z[1]);a.dtype=
e||n(k.data)||5126;a.dimension=R;e=A.allocType(a.dtype,P*R);t(e,k.data,P,R,M,S,q);C(a,e,x);A.freeType(e)}}function k(b){var d=b.buffer;x.isBuffer(d)&&x.deleteBuffer(d);b.buffer=null;delete V[b.id]}var a=0,V={};e.prototype.bind=function(){x.bindBuffer(this.type,this.buffer)};var m=[];return{create:function(a,C,z){function m(a){var f=35044,l=null,k=0,n=0,e=1;Array.isArray(a)||b(a)||d(a)?l=a:"number"===typeof a?k=a|0:a&&("data"in a&&(l=a.data),"usage"in a&&(f=u[a.usage]),"type"in a&&(n=E[a.type]),"dimension"in
a&&(e=a.dimension|0),"length"in a&&(k=a.length|0));B.bind();l?q(B,l,f,n,e):(x.bufferData(B.type,k,f),B.dtype=n||5121,B.usage=f,B.dimension=e,B.byteLength=k);return m}var B=new e(C);V[B.id]=B;z||m(a);m._reglType="buffer";m._buffer=B;m.subdata=function(a,k){var e=(k||0)|0;B.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var q=A.allocType(B.dtype,a.length);f(q,a);x.bufferSubData(B.type,e,q);A.freeType(q)}else if(Array.isArray(a[0])||b(a[0])){var q=a[0].length,C=A.allocType(B.dtype,
a.length*q);l(C,a,q);x.bufferSubData(B.type,e,C);A.freeType(C)}}else if(b(a))x.bufferSubData(B.type,e,a);else if(d(a)){var z=a.shape,M=a.stride,V=C=q=0,u=0;1===z.length?(q=z[0],C=1,V=M[0],u=0):2===z.length&&(q=z[0],C=z[1],V=M[0],u=M[1]);z=Array.isArray(a.data)?B.dtype:n(a.data);z=A.allocType(z,q*C);t(z,a.data,q,C,V,u,a.offset);x.bufferSubData(B.type,e,z);A.freeType(z)}return m};m.destroy=function(){k(B)};return m},createStream:function(a,b){var d=m.pop();d||(d=new e(a),d.buffer=x.createBuffer());
d.bind();q(d,b,35040,0,1);return d},destroyStream:function(a){m.push(a)},clear:function(){z(V).forEach(k)},getBuffer:function(a){return a&&a._buffer instanceof e?a._buffer:null},_initBuffer:q}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/pool":25,"./util/values":28}],4:[function(e,m,p){m.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,
"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(e,m,p){m.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(e,m,p){m.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(e,m,p){m.exports={"static":35044,
dynamic:35048,stream:35040}},{}],8:[function(e,m,p){function n(a){return Array.isArray(a)||H(a)||E(a)}function f(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function t(a,b,d,f){this.thisDep=a;this.contextDep=b;this.propDep=d;this.append=f}function l(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function b(a){return new t(!1,!1,!1,a)}function d(a,b){var d=a.type;return 0===d?(d=a.data.length,new t(!0,1<=d,2<=d,b)):new t(3===d,2===d,1===d,b)}var z=e("./util/codegen"),
A=e("./util/loop"),H=e("./util/is-typed-array"),E=e("./util/is-ndarray"),u=e("./constants/primitives.json"),x=e("./constants/dtypes.json"),M=["x","y","z","w"],C={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},q={never:512,
less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},k={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},a={cw:2304,ccw:2305},V=new t(!1,!1,!1,function(){});m.exports=function(e,m,E,p,G,N,D,ha,P,R,Y,S,ia){function K(c){return c.replace(".","_")}function I(c,a,b){var d=K(c);y.push(c);r[d]=g[d]=!!b;ma[d]=a}function J(c,a,b){var d=
K(c);y.push(c);Array.isArray(b)?(g[d]=b.slice(),r[d]=b.slice()):g[d]=r[d]=b;na[d]=a}function ja(){var c=z(),a=c.link,b=c.global;c.id=X++;c.batchId="0";var d=a(Fa),F=c.shared={props:"a0"};Object.keys(Fa).forEach(function(h){F[h]=b.def(d,".",h)});var w=c.next={},Ha=c.current={};Object.keys(na).forEach(function(h){Array.isArray(g[h])&&(w[h]=b.def(F.next,".",h),Ha[h]=b.def(F.current,".",h))});var h=c.constants={};Object.keys(Aa).forEach(function(c){h[c]=b.def(JSON.stringify(Aa[c]))});c.invoke=function(h,
g){switch(g.type){case 0:var ya=["this",F.context,F.props,c.batchId];return h.def(a(g.data),".call(",ya.slice(0,Math.max(g.data.length+1,4)),")");case 1:return h.def(F.props,g.data);case 2:return h.def(F.context,g.data);case 3:return h.def("this",g.data)}};c.attribCache={};var ya={};c.scopeAttrib=function(h){h=m.id(h);if(h in ya)return ya[h];var c=R.scope[h];c||(c=R.scope[h]=new sa);return ya[h]=a(c)};return c}function fa(c){var g=c["static"];c=c.dynamic;if("framebuffer"in g){var a=g.framebuffer;
return a?(a=ha.getFramebuffer(a),b(function(c,g){var v=c.link(a),h=c.shared;g.set(h.framebuffer,".next",v);h=h.context;g.set(h,".framebufferWidth",v+".width");g.set(h,".framebufferHeight",v+".height");return v})):b(function(c,g){var a=c.shared;g.set(a.framebuffer,".next","null");a=a.context;g.set(a,".framebufferWidth",a+".drawingBufferWidth");g.set(a,".framebufferHeight",a+".drawingBufferHeight");return null})}if("framebuffer"in c){var f=c.framebuffer;return d(f,function(c,g){var a=c.invoke(g,f),
h=c.shared,v=h.framebuffer,a=g.def(v,".getFramebuffer(",a,")");g.set(v,".next",a);h=h.context;g.set(h,".framebufferWidth",a+"?"+a+".width:"+h+".drawingBufferWidth");g.set(h,".framebufferHeight",a+"?"+a+".height:"+h+".drawingBufferHeight");return a})}return null}function oa(c,g){function a(h){if(h in b){var c=b[h];h=!0;var Ga=c.x|0,w=c.y|0,f,ra;"w"in c?f=c.w|0:h=!1;"h"in c?ra=c.h|0:h=!1;return new t(h&&g&&g.thisDep,h&&g&&g.contextDep,h&&g&&g.propDep,function(h,g){var a=h.shared.context,v=f;"w"in c||
(v=g.def(a,".","framebufferWidth","-",Ga));var b=ra;"h"in c||(b=g.def(a,".","framebufferHeight","-",w));return[Ga,w,v,b]})}if(h in F){var k=F[h];h=d(k,function(h,c){var g=h.invoke(c,k),a=h.shared.context,v=c.def(g,".x|0"),b=c.def(g,".y|0"),d=c.def('"w" in ',g,"?",g,".w|0:","(",a,".","framebufferWidth","-",v,")"),g=c.def('"h" in ',g,"?",g,".h|0:","(",a,".","framebufferHeight","-",b,")");return[v,b,d,g]});g&&(h.thisDep=h.thisDep||g.thisDep,h.contextDep=h.contextDep||g.contextDep,h.propDep=h.propDep||
g.prpoDep);return h}return g?new t(g.thisDep,g.contextDep,g.propDep,function(h,c){var g=h.shared.context;return[0,0,c.def(g,".","framebufferWidth"),c.def(g,".","framebufferHeight")]}):null}var b=c["static"],F=c.dynamic,w=a("viewport");if(w)var f=w,w=new t(w.thisDep,w.contextDep,w.propDep,function(h,c){var g=f.append(h,c),a=h.shared.context;c.set(a,".viewportWidth",g[2]);c.set(a,".viewportHeight",g[3]);return g});return{viewport:w,scissor_box:a("scissor.box")}}function L(c){function g(h){if(h in a){var c=
m.id(a[h]);h=b(function(){return c});h.id=c;return h}if(h in f){var v=f[h];return d(v,function(h,c){var g=h.invoke(c,v);return c.def(h.shared.strings,".id(",g,")")})}return null}var a=c["static"],f=c.dynamic,F=g("frag"),w=g("vert"),k=null;l(F)&&l(w)?(k=Y.program(w.id,F.id),c=b(function(h,c){return h.link(k)})):c=new t(F&&F.thisDep||w&&w.thisDep,F&&F.contextDep||w&&w.contextDep,F&&F.propDep||w&&w.propDep,function(h,c){var g=h.shared.shader,a;a=F?F.append(h,c):c.def(g,".","frag");var v;v=w?w.append(h,
c):c.def(g,".","vert");return c.def(g+".program("+v+","+a+")")});return{frag:F,vert:w,progVar:c,program:k}}function ua(c){function g(c,h){if(c in a){var v=a[c]|0;return b(function(c,g){h&&(c.OFFSET=v);return v})}if(c in f){var w=f[c];return d(w,function(c,g){var a=c.invoke(g,w);h&&(c.OFFSET=a);return a})}return h&&F?b(function(h,c){h.OFFSET="0";return 0}):null}var a=c["static"],f=c.dynamic,F=function(){if("elements"in a){var c=a.elements;n(c)?c=N.getElements(N.create(c)):c&&(c=N.getElements(c));var h=
b(function(h,g){if(c){var a=h.link(c);return h.ELEMENTS=a}return h.ELEMENTS=null});h.value=c;return h}if("elements"in f){var g=f.elements;return d(g,function(h,c){var a=h.shared,v=a.isBufferArgs,a=a.elements,b=h.invoke(c,g),d=c.def("null"),v=c.def(v,"(",b,")"),b=h.cond(v).then(d,"=",a,".createStream(",b,");")["else"](d,"=",a,".getElements(",b,");");c.entry(b);c.exit(h.cond(v).then(a,".destroyStream(",d,");"));return h.ELEMENTS=d})}return null}(),w=g("offset",!0);return{elements:F,primitive:function(){if("primitive"in
a){var c=a.primitive;return b(function(h,g){return u[c]})}if("primitive"in f){var h=f.primitive;return d(h,function(c,g){var a=c.constants.primTypes,v=c.invoke(g,h);return g.def(a,"[",v,"]")})}return F?l(F)?F.value?b(function(h,c){return c.def(h.ELEMENTS,".primType")}):b(function(){return 4}):new t(F.thisDep,F.contextDep,F.propDep,function(h,c){var g=h.ELEMENTS;return c.def(g,"?",g,".primType:",4)}):null}(),count:function(){if("count"in a){var c=a.count|0;return b(function(){return c})}if("count"in
f){var h=f.count;return d(h,function(c,g){return c.invoke(g,h)})}return F?l(F)?F?w?new t(w.thisDep,w.contextDep,w.propDep,function(h,c){return c.def(h.ELEMENTS,".vertCount-",h.OFFSET)}):b(function(h,c){return c.def(h.ELEMENTS,".vertCount")}):b(function(){return-1}):new t(F.thisDep||w.thisDep,F.contextDep||w.contextDep,F.propDep||w.propDep,function(h,c){var g=h.ELEMENTS;return h.OFFSET?c.def(g,"?",g,".vertCount-",h.OFFSET,":-1"):c.def(g,"?",g,".vertCount:-1")}):null}(),instances:g("instances",!1),
offset:w}}function Q(c){var g=c["static"],f=c.dynamic,l={};y.forEach(function(c){function w(h,a){if(c in g){var w=h(g[c]);l[y]=b(function(){return w})}else if(c in f){var k=f[c];l[y]=d(k,function(h,c){return a(h,c,h.invoke(c,k))})}}var y=K(c);switch(c){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return w(function(h){return h},function(h,c,
g){return g});case "depth.func":return w(function(h){return q[h]},function(h,c,g){return c.def(h.constants.compareFuncs,"[",g,"]")});case "depth.range":return w(function(h){return h},function(h,c,g){h=c.def("+",g,"[0]");c=c.def("+",g,"[1]");return[h,c]});case "blend.func":return w(function(c){return[C["srcRGB"in c?c.srcRGB:c.src],C["dstRGB"in c?c.dstRGB:c.dst],C["srcAlpha"in c?c.srcAlpha:c.src],C["dstAlpha"in c?c.dstAlpha:c.dst]]},function(c,g,a){function v(c,h){var d=g.def('"',c,h,'" in ',a,"?",
a,".",c,h,":",a,".",c);return g.def(b,"[",d,"]")}var b=c.constants.blendFuncs;c=v("src","RGB");var d=v("src","Alpha"),w=v("dst","RGB"),f=v("dst","Alpha");return[c,w,d,f]});case "blend.equation":return w(function(c){if("string"===typeof c)return[Z[c],Z[c]];if("object"===typeof c)return[Z[c.rgb],Z[c.alpha]]},function(c,g,a){var v=c.constants.blendEquations,b=g.def(),d=g.def();c=c.cond("typeof ",a,'==="string"');c.then(b,"=",d,"=",v,"[",a,"];");c["else"](b,"=",v,"[",a,".rgb];",d,"=",v,"[",a,".alpha];");
g(c);return[b,d]});case "blend.color":return w(function(c){return A(4,function(g){return+c[g]})},function(c,g,a){return A(4,function(c){return g.def("+",a,"[",c,"]")})});case "stencil.mask":return w(function(c){return c|0},function(c,g,a){return g.def(a,"|0")});case "stencil.func":return w(function(c){return[q[c.cmp||"keep"],c.ref||0,"mask"in c?c.mask:-1]},function(c,g,a){c=g.def('"cmp" in ',a,"?",c.constants.compareFuncs,"[",a,".cmp]",":",7680);var v=g.def(a,".ref|0");g=g.def('"mask" in ',a,"?",
a,".mask|0:-1");return[c,v,g]});case "stencil.opFront":case "stencil.opBack":return w(function(g){return["stencil.opBack"===c?1029:1028,k[g.fail||"keep"],k[g.zfail||"keep"],k[g.pass||"keep"]]},function(g,a,v){function b(c){return a.def('"',c,'" in ',v,"?",d,"[",v,".",c,"]:",7680)}var d=g.constants.stencilOps;return["stencil.opBack"===c?1029:1028,b("fail"),b("zfail"),b("pass")]});case "polygonOffset.offset":return w(function(c){return[c.factor|0,c.units|0]},function(c,g,a){c=g.def(a,".factor|0");g=
g.def(a,".units|0");return[c,g]});case "cull.face":return w(function(c){var g=0;"front"===c?g=1028:"back"===c&&(g=1029);return g},function(c,g,a){return g.def(a,'==="front"?',1028,":",1029)});case "lineWidth":return w(function(c){return c},function(c,g,a){return a});case "frontFace":return w(function(c){return a[c]},function(c,g,a){return g.def(a+'==="cw"?2304:2305')});case "colorMask":return w(function(c){return c.map(function(c){return!!c})},function(c,g,a){return A(4,function(c){return"!!"+a+"["+
c+"]"})});case "sample.coverage":return w(function(c){return["value"in c?c.value:1,!!c.invert]},function(c,g,a){c=g.def('"value" in ',a,"?+",a,".value:1");g=g.def("!!",a,".invert");return[c,g]})}});return l}function pa(c){var g=c["static"],a=c.dynamic,f={};Object.keys(g).forEach(function(c){var a=g[c],d;if("number"===typeof a||"boolean"===typeof a)d=b(function(){return a});else if("function"===typeof a&&("texture2d"===a._reglType||"textureCube"===a._reglTYpe))d=b(function(c){return c.link(a)});else if(Array.isArray(a)||
H(a))d=b(function(c){return c.global.def("[",A(a.length,function(c){return a[c]}),"]")});d.value=a;f[c]=d});Object.keys(a).forEach(function(c){var g=a[c];f[c]=d(g,function(c,a){return c.invoke(a,g)})});return f}function T(c){var g=c["static"],a=c.dynamic,f={};Object.keys(g).forEach(function(c){var a=g[c],d=m.id(c),h=new sa;if(n(a))h.state=1,h.buffer=G.getBuffer(G.create(a,34962,!1)),h.type=h.buffer.dtype;else{var k=G.getBuffer(a);if(k)h.state=1,h.buffer=k,h.type=k.dtype;else if(a.constant){var l=
a.constant;h.state=2;"number"===typeof l?h.x=l:M.forEach(function(c,g){g<l.length&&(h[c]=l[g])})}else{var k=G.getBuffer(a.buffer),y=a.offset|0,r=a.stride|0,e=a.size|0,ra=!!a.normalized,t=0;"type"in a&&(t=x[a.type]);a=a.divisor|0;h.buffer=k;h.state=1;h.size=e;h.normalized=ra;h.type=t||k.dtype;h.offset=y;h.stride=r;h.divisor=a}}f[c]=b(function(c,g){var a=c.attribCache;if(d in a)return a[d];var b={isStream:!1};Object.keys(h).forEach(function(c){b[c]=h[c]});h.buffer&&(b.buffer=c.link(h.buffer));return a[d]=
b})});Object.keys(a).forEach(function(c){var g=a[c];f[c]=d(g,function(c,a){function b(c){a(l[c],"=",v,".",c,"|0;")}var v=c.invoke(a,g),d=c.shared,f=d.isBufferArgs,k=d.buffer,l={isStream:a.def(!1)},y=new sa;y.state=1;Object.keys(y).forEach(function(c){l[c]=a.def(""+y[c])});var r=l.buffer,e=l.type;a("if(",f,"(",v,")){",l.isStream,"=true;",r,"=",k,".createStream(",34962,",",v,");",e,"=",r,".dtype;","}else{",r,"=",k,".getBuffer(",v,");","if(",r,"){",e,"=",r,".dtype;","}else if(",v,".constant){",l.state,
"=",2,";",M.map(function(c,g){return l[c]+"="+v+".length>="+g+"?"+v+"["+g+"]:0;"}).join(""),"}else{",r,"=",k,".getBuffer(",v,".buffer);",e,'="type" in ',v,"?",d.glTypes,"[",v,".type]:",r,".dtype;",l.normalized,"=!!",v,".normalized;");b("size");b("offset");b("stride");b("divisor");a("}}");return l})});return f}function O(c){var g=c["static"],a=c.dynamic,f={};Object.keys(g).forEach(function(c){var a=g[c];f[c]=b(function(c,g){return"number"===typeof a||"boolean"===typeof a?""+a:c.link(a)})});Object.keys(a).forEach(function(c){var g=
a[c];f[c]=d(g,function(c,a){return c.invoke(a,g)})});return f}function W(c,g,a){var b=c.shared.context,d=c.scope();Object.keys(a).forEach(function(f){g.save(b,"."+f);d(b,".",f,"=",a[f].append(c,g),";")});g(d)}function ba(c,g,a){var b=c.shared,d=b.gl,f=b.framebuffer,k;ga&&(k=g.def(b.extensions,".webgl_draw_buffers"));var h=c.constants,b=h.drawBuffer,h=h.backBuffer;c=a?a.append(c,g):g.def(f,".next");g("if(",f,".dirty||",c,"!==",f,".cur){","if(",c,"){",d,".bindFramebuffer(",36160,",",c,".framebuffer);");
ga&&g(k,".drawBuffersWEBGL(",b,"[",c,".colorAttachments.length]);");g("}else{",d,".bindFramebuffer(",36160,",null);");ga&&g(k,".drawBuffersWEBGL(",h,");");g("}",f,".cur=",c,";",f,".dirty=false;","}")}function qa(c,a,b){var d=c.shared,f=d.gl,k=c.current,l=c.next,h=d.current,r=d.next,e=c.cond(h,".dirty");y.forEach(function(a){a=K(a);if(!(a in b.state)){var d,v;if(a in l){d=l[a];v=k[a];var y=A(g[a].length,function(c){return e.def(d,"[",c,"]")});e(c.cond(y.map(function(c,g){return c+"==="+v+"["+g+"]"}).join("&&")).then(f,
".",na[a],"(",y,");",y.map(function(c,g){return v+"["+g+"]="+c}).join(";"),";"))}else d=e.def(r,".",a),y=c.cond(d,"!==",h,".",a),e(y),a in ma?y(c.cond(d).then(f,".enable(",ma[a],");")["else"](f,".disable(",ma[a],");"),h,".",a,"=",d,";"):y(f,".",na[a],"(",d,");",h,".",a,"=",d,";")}});0===Object.keys(b.state).length&&e(h,".dirty=false;");a(e)}function va(c,g,a,b){var d=c.shared,k=c.current,y=d.current,h=d.gl;f(Object.keys(a)).forEach(function(d){var f=a[d];if(!b||b(f)){var e=f.append(c,g);if(ma[d]){var r=
ma[d];l(f)?e?g(h,".enable(",r,");"):g(h,".disable(",r,");"):g(c.cond(e).then(h,".enable(",r,");")["else"](h,".disable(",r,");"));g(y,".",d,"=",e,";")}else if(Array.isArray(e)){var n=k[d];g(h,".",na[d],"(",e,");",e.map(function(c,g){return n+"["+g+"]="+c}).join(";"),";")}else g(h,".",na[d],"(",e,");",y,".",d,"=",e,";")}})}function ta(c,g){ka&&!c.instancing&&(c.instancing=g.def(c.shared.extensions,".angle_instanced_arrays"))}function wa(c,g,a,d,b){function f(c){switch(c){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function k(a,d,b){function f(){g("if(!",r,".pointer){",e,".enableVertexAttribArray(",y,");",r,".pointer=true;}");var a=b.type,h;h=b.size?g.def(b.size,"||",d):d;g("if(",r,".type!==",a,"||",r,".size!==",h,"||",ra.map(function(c){return r+"."+c+"!=="+b[c]}).join("||"),"){",e,".bindBuffer(",34962,",",n,".buffer);",e,".vertexAttribPointer(",[y,h,a,b.normalized,b.stride,b.offset],");",r,".type=",a,";",
r,".size=",h,";",ra.map(function(c){return r+"."+c+"="+b[c]+";"}).join(""),"}");ka&&(a=b.divisor,g("if(",r,".divisor!==",a,"){",c.instancing,".vertexAttribDivisorANGLE(",[y,a],");",r,".divisor=",a,";}"))}function l(){g("if(",r,".pointer){",e,".disableVertexAttribArray(",y,");",r,".pointer=false;","}if(",M.map(function(c,g){return r+"."+c+"!=="+w[g]}).join("||"),"){",e,".vertexAttrib4f(",y,",",w,");",M.map(function(c,g){return r+"."+c+"="+w[g]+";"}).join(""),"}")}var e=h.gl,y=g.def(a,".location"),
r=g.def(h.attributes,"[",y,"]");a=b.state;var n=b.buffer,w=[b.x,b.y,b.z,b.w],ra=["buffer","normalized","offset","stride"];1===a?f():2===a?l():(g("if(",a,"===",1,"){"),f(),g("}else{"),l(),g("}"))}var h=c.shared;d.forEach(function(h){var d=h.name,r=a.attributes[d],l;if(r){if(!b(r))return;l=r.append(c,g)}else{if(!b(V))return;var e=c.scopeAttrib(d);l={};Object.keys(new sa).forEach(function(c){l[c]=g.def(e,".",c)})}k(c.link(h),f(h.info.type),l)})}function aa(c,g,a,b,d){for(var f=c.shared,k=f.gl,h,r=0;r<
b.length;++r){var l=b[r],e=l.name,y=l.info.type,n=a.uniforms[e],l=c.link(l)+".location";if(n){if(!d(n))continue;if(n["static"]){e=n.value;if(35678===y||35680===y)y=c.link(e._texture),g(k,".uniform1i(",l,y+".bind());"),g.exit(y,".unbind()");else if(35674===y||35675===y||35676===y)e=c.global.def("["+e+"]"),n=2,35675===y?n=3:35676===y&&(n=4),g(k,".uniformMatrix",n,"fv(",l,",false,",e,");");else{switch(y){case 5126:h="1f";break;case 35664:h="2f";break;case 35665:h="3f";break;case 35666:h="4f";break;case 35670:h=
"1i";break;case 5124:h="1i";break;case 35671:h="2i";break;case 35667:h="2i";break;case 35672:h="3i";break;case 35668:h="3i";break;case 35673:h="4i";break;case 35669:h="4i"}g(k,".uniform",h,"(",l,",",e,");")}continue}else e=n.append(c,g)}else{if(!d(V))continue;e=g.def(f.uniforms,"[",m.id(e),"]")}n=",";switch(y){case 35678:case 35680:y=g.def(e,"._texture");g(k,".uniform1i(",l,",",y,".bind());");g.exit(y,".unbind();");continue;case 5124:case 35670:h="1i";break;case 35667:case 35671:h="2iv";break;case 35668:case 35672:h=
"3iv";break;case 35669:case 35673:h="4iv";break;case 5126:h="1f";break;case 35664:h="2fv";break;case 35665:h="3fv";break;case 35666:h="4fv";break;case 35674:h="Matrix2fv";n=",false,";break;case 35675:h="Matrix3fv";n=",false,";break;case 35676:h="Matrix4fv",n=",false,"}g(k,".uniform",h,"(",l,n,e,");")}}function ca(c,g,a,b){function d(h){var b=r[h];return b?b.batchStatic?b.append(c,g):b.append(c,a):g.def(e,".",h)}function f(){function c(){a(D,".drawElementsInstancedANGLE(",[x,q,C,t+"<<(("+C+"-5121)>>1)",
z],");")}function g(){a(D,".drawArraysInstancedANGLE(",[x,t,q,z],");")}n?m?c():(a("if(",n,"){"),c(),a("}else{"),g(),a("}")):g()}function k(){function c(){a(y+".drawElements("+[x,q,C,t+"<<(("+C+"-5121)>>1)"]+");")}function g(){a(y+".drawArrays("+[x,t,q]+");")}n?m?c():(a("if(",n,"){"),c(),a("}else{"),g(),a("}")):g()}var h=c.shared,y=h.gl,e=h.draw,r=b.draw,n=function(){var h=r.elements,b=g;h?(h.batchStatic||(b=a),h=h.append(c,b)):h=b.def(e,".","elements");h&&b("if("+h+")"+y+".bindBuffer(34963,"+h+".buffer.buffer);");
return h}(),x=d("primitive"),t=d("offset"),q=function(){var h=r.count,b=g;h?(h.batchStatic||(b=a),h=h.append(c,b)):h=b.def(e,".","count");return h}();if("number"===typeof q){if(0===q)return}else a("if(",q,"){"),a.exit("}");var z,D;ka&&(z=d("instances"),D=c.instancing);var C=n+".type",m=r.elements&&l(r.elements);ka&&("number"!==typeof z||0<=z)?"string"===typeof z?(a("if(",z,">0){"),f(),a("}else if(",z,"<0){"),k(),a("}")):f():k()}function da(c,g,a,b,d){g=ja();d=g.proc("body",d);ka&&(g.instancing=d.def(g.shared.extensions,
".angle_instanced_arrays"));c(g,d,a,b);return g.compile().body}function Ba(c,g,a,b){ta(c,g);wa(c,g,a,b.attributes,function(){return!0});aa(c,g,a,b.uniforms,function(){return!0});ca(c,g,g,a)}function Ca(c,g){var a=c.proc("draw",1);ta(c,a);W(c,a,g.context);ba(c,a,g.framebuffer);qa(c,a,g);va(c,a,g.state);var b=g.shader.progVar.append(c,a);a(c.shared.gl,".useProgram(",b,".program);");if(g.shader.program)Ba(c,a,g,g.shader.program);else{var d=c.global.def("{}"),f=a.def(b,".id"),k=a.def(d,"[",f,"]");a(c.cond(k).then(k,
".call(this,a0);")["else"](k,"=",d,"[",f,"]=",c.link(function(a){return da(Ba,c,g,a,1)}),"(",b,");",k,".call(this,a0);"))}0<Object.keys(g.state).length&&a(c.shared.current,".dirty=true;")}function Ea(c,g,a,b){function d(){return!0}c.batchId="a1";ta(c,g);wa(c,g,a,b.attributes,d);aa(c,g,a,b.uniforms,d);ca(c,g,g,a)}function xa(c,g,a,b){function d(c){return c.contextDep&&k||c.propDep}function f(c){return!d(c)}ta(c,g);var k=a.contextDynamic,h=g.def(),y=g.def();c.shared.props=y;c.batchId=h;var e=c.scope(),
r=c.scope();g(e.entry,"for(",h,"=0;",h,"<","a1",";++",h,"){",y,"=","a0","[",h,"];",r,"}",e.exit);a.needsContext&&W(c,r,a.context);a.needsFramebuffer&&ba(c,r,a.framebuffer);va(c,r,a.state,d);b?(wa(c,e,a,b.attributes,f),wa(c,r,a,b.attributes,d),aa(c,e,a,b.uniforms,f),aa(c,r,a,b.uniforms,d),ca(c,e,r,a)):(g=c.global.def("{}"),b=a.shader.progVar.append(c,r),y=r.def(b,".id"),e=r.def(g,"[",y,"]"),r(c.shared.gl,".useProgram(",b,".program);","if(!",e,"){",e,"=",g,"[",y,"]=",c.link(function(g){return da(Ea,
c,a,g,2)}),"(",b,");}",e,".call(this,a0[",h,"],",h,");"))}function Da(c,g){var a=c.proc("batch",2);c.batchId="0";ta(c,a);var b=!1,d=!0;Object.keys(g.context).forEach(function(c){b=b||g.context[c].propDep});b||(W(c,a,g.context),d=!1);var f=g.framebuffer,r=!1;f&&(f.propDep?b=r=!0:f.contextDep&&b&&(r=!0),r||ba(c,a,f));g.state.viewport&&g.state.viewport.propDynamic&&(b=!0);qa(c,a,g);va(c,a,g.state,function(c){return!(c.contextDep&&b||c.propDep)});g.contextDep=b;g.needsContext=d;g.needsFramebuffer=r;d=
g.shader.progVar;if(d.contextDep&&b||d.propDep)xa(c,a,g,null);else if(d=d.append(c,a),a(c.shared.gl,".useProgram(",d,".program);"),g.shader.program)xa(c,a,g,g.shader.program);else{var f=c.global.def("{}"),r=a.def(d,".id"),h=a.def(f,"[",r,"]");a(c.cond(h).then(h,".call(this,a0,a1);")["else"](h,"=",f,"[",r,"]=",c.link(function(a){return da(xa,c,g,a,2)}),"(",d,");",h,".call(this,a0,a1);"))}0<Object.keys(g.state).length&&a(c.shared.current,".dirty=true;")}function za(c,g){function a(f){var h=g.shader[f];
h&&b.set(d.shader,"."+f,h.append(c,b))}var b=c.proc("scope",3);c.batchId="a2";var d=c.shared,r=d.current;W(c,b,g.context);g.framebuffer&&g.framebuffer.append(c,b);f(Object.keys(g.state)).forEach(function(a){var h=g.state[a].append(c,b);Array.isArray(h)?h.forEach(function(g,h){b.set(c.next[a],"["+h+"]",g)}):b.set(d.next,"."+a,h)});["elements","offset","count","instances","primitive"].forEach(function(a){var h=g.draw[a];h&&b.set(d.draw,"."+a,""+h.append(c,b))});Object.keys(g.uniforms).forEach(function(a){b.set(d.uniforms,
"["+m.id(a)+"]",g.uniforms[a].append(c,b))});Object.keys(g.attributes).forEach(function(a){var h=g.attributes[a].append(c,b),d=c.scopeAttrib(a);Object.keys(new sa).forEach(function(c){b.set(d,"."+c,h[c])})});a("vert");a("frag");0<Object.keys(g.state).length&&(b(r,".dirty=true;"),b.exit(r,".dirty=true;"));b("a1(",c.shared.context,",a0,0);")}var sa=R.Record,Z={add:32774,subtract:32778,"reverse subtract":32779};E.ext_blend_minmax&&(Z.min=32775,Z.max=32776);var ka=E.angle_instanced_arrays,ga=E.webgl_draw_buffers,
g={dirty:!0},r={},y=[],ma={},na={};I("dither",3024);I("blend.enable",3042);J("blend.color","blendColor",[0,0,0,0]);J("blend.equation","blendEquationSeparate",[32774,32774]);J("blend.func","blendFuncSeparate",[1,0,1,0]);I("depth.enable",2929,!0);J("depth.func","depthFunc",513);J("depth.range","depthRange",[0,1]);J("depth.mask","depthMask",!0);J("colorMask","colorMask",[!0,!0,!0,!0]);I("cull.enable",2884);J("cull.face","cullFace",1029);J("frontFace","frontFace",2305);J("lineWidth","lineWidth",1);I("polygonOffset.enable",
32823);J("polygonOffset.offset","polygonOffset",[0,0]);I("sample.alpha",32926);I("sample.enable",32928);J("sample.coverage","sampleCoverage",[1,!1]);I("stencil.enable",2960);J("stencil.mask","stencilMask",-1);J("stencil.func","stencilFunc",[519,0,-1]);J("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);J("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);I("scissor.enable",3089);J("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);J("viewport","viewport",
[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var Fa={gl:e,context:ia,strings:m,next:r,current:g,draw:S,elements:N,buffer:G,shader:Y,attributes:R.state,uniforms:P,framebuffer:ha,extensions:E,isBufferArgs:n},Aa={primTypes:u,compareFuncs:q,blendFuncs:C,blendEquations:Z,stencilOps:k,glTypes:x,orientationType:a};ga&&(Aa.backBuffer=[1029],Aa.drawBuffer=A(p.maxDrawbuffers,function(c){return 0===c?[0]:A(c,function(c){return 36064+c})}));var X=0;return{next:r,current:g,procs:function(){var c=ja(),a=c.proc("poll"),
b=c.proc("refresh"),d=c.block();a(d);b(d);var f=c.shared,r=f.gl,e=f.next,h=f.current;d(h,".dirty=false;");ba(c,a);b(f.framebuffer,".dirty=true;");ba(c,b);Object.keys(ma).forEach(function(g){var f=ma[g],k=d.def(e,".",g),y=c.block();y("if(",k,"){",r,".enable(",f,")}else{",r,".disable(",f,")}",h,".",g,"=",k,";");b(y);a("if(",k,"!==",h,".",g,"){",y,"}")});Object.keys(na).forEach(function(f){var k=na[f],y=g[f],l,n,x=c.block();x(r,".",k,"(");Array.isArray(y)?(k=y.length,l=c.global.def(e,".",f),n=c.global.def(h,
".",f),x(A(k,function(c){return l+"["+c+"]"}),");",A(k,function(c){return n+"["+c+"]="+l+"["+c+"];"}).join("")),a("if(",A(k,function(c){return l+"["+c+"]!=="+n+"["+c+"]"}).join("||"),"){",x,"}")):(l=d.def(e,".",f),n=d.def(h,".",f),x(l,");",h,".",f,"=",l,";"),a("if(",l,"!==",n,"){",x,"}"));b(x)});return c.compile()}(),compile:function(c,g,a,b){var d=ja(),f;f=fa(c);var r=oa(c,f),h=ua(c),k=Q(c);c=L(c);var e=r.viewport;e&&(k.viewport=e);e=K("scissor.box");(r=r[e])&&(k[e]=r);r=0<Object.keys(k).length;
f={framebuffer:f,draw:h,shader:c,state:k,dirty:r};f.uniforms=pa(a);f.attributes=T(g);f.context=O(b);Ca(d,f);za(d,f);Da(d,f);return d.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":20,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/loop":24}],9:[function(e,m,p){function n(b,d){this.id=l++;this.type=b;this.data=d}function f(b){if(0===b.length)return[];var d=b.charAt(0),e=b.charAt(b.length-1);if(1<b.length&&d===e&&('"'===d||"'"===d))return['"'+b.substr(1,
b.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(d=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return f(b.substr(0,d.index)).concat(f(d[1])).concat(f(b.substr(d.index+d[0].length)));d=b.split(".");if(1===d.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(e=0;e<d.length;++e)b=b.concat(f(d[e]));return b}function t(b){return"["+f(b).join("][")+"]"}var l=0;m.exports={define:function(b,d){switch(typeof d){case "boolean":case "number":case "string":return new n(b,
t(d+""));case "undefined":return new n(b|128,null)}},isDynamic:function(b){return"function"===typeof b&&!b._reglType||b instanceof n},unbox:function(b,d){if(b instanceof n){if(b.type&128)return new n(b.type&-129,t(d))}else if("function"===typeof b)return new n(0,b);return b},accessor:t}},{}],10:[function(e,m,p){var n=e("./util/is-typed-array"),f=e("./util/is-ndarray"),t=e("./constants/primitives.json"),l=e("./constants/usage.json");m.exports=function(b,d,e){function m(b){this.buffer=b;this.primType=
4;this.type=this.vertCount=0}function H(b,l,t,q,k,a,m){(a=m)||n(l)&&(!f(l)||n(l.data))||(a=d.oes_element_index_uint?5125:5123);b.buffer.bind();e._initBuffer(b.buffer,l,t,a,3);l=m;if(!m){switch(b.buffer.dtype){case 5121:case 5120:l=5121;break;case 5123:case 5122:l=5123;break;case 5125:case 5124:l=5125}b.buffer.dtype=l}b.type=l;0>k&&(k=b.buffer.byteLength,5123===l?k>>=1:5125===l&&(k>>=2));b.vertCount=k;k=q;0>q&&(k=4,q=b.buffer.dimension,1===q&&(k=0),2===q&&(k=1),3===q&&(k=4));b.primType=k}var E={uint8:5121,
uint16:5123};d.oes_element_index_uint&&(E.uint32=5125);m.prototype.bind=function(){this.buffer.bind()};var u=[];return{create:function(d){function u(d){if(d)if("number"===typeof d)C(d),q.primType=4,q.vertCount=d|0,q.type=5121;else{var a=null,e=35044,x=-1,m=-1,z=0,A=0;Array.isArray(d)||n(d)||f(d)?a=d:("data"in d&&(a=d.data),"usage"in d&&(e=l[d.usage]),"primitive"in d&&(x=t[d.primitive]),"count"in d&&(m=d.count|0),"length"in d&&(z=d.length|0),"type"in d&&(A=E[d.type]));a?H(q,a,e,x,m,z,A):(d=q.buffer,
d.bind(),b.bufferData(34963,z,e),d.dtype=A||5121,d.usage=e,d.dimension=3,d.byteLength=z,q.primType=0>x?4:x,q.vertCount=0>m?0:m,q.type=d.dtype)}else C(),q.primType=4,q.vertCount=0,q.type=5121;return u}var C=e.create(null,34963,!0),q=new m(C._buffer);u(d);u._reglType="elements";u._elements=q;u.subdata=function(b,a){C.subdata(b,a);return u};u.destroy=function(){C.destroy();q.buffer=null};return u},createStream:function(b){var d=u.pop();d||(d=new m(e.create(null,34963,!0)._buffer));H(d,b,35040,-1,-1,
0,0);return d},destroyStream:function(b){u.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof m?b._elements:null}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":22,"./util/is-typed-array":23}],11:[function(e,m,p){m.exports=function(e){function f(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(f){try{t[f]=
e.getExtension(f)}catch(b){}})}var t={};f();return{extensions:t,refresh:f}}},{}],12:[function(e,m,p){var n=e("./util/values"),f=e("./util/extend");m.exports=function(e,l,b,d,m){function A(a,b,d,f){this.target=a;this.level=b;this.texture=d;this.renderbuffer=f}function H(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function E(a,b){var d=b.width,f=b.height;if(a.texture)var e=a.texture._texture,l=Math.max(1,e.params.width>>a.level),k=Math.max(1,
e.params.height>>a.level),d=d||l,f=f||k;else e=a.renderbuffer._renderbuffer,d=d||e.width,f=f||e.height;e.refCount+=1;b.width=d;b.height=f}function u(a,b){b?b.texture?e.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):e.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):e.framebufferTexture2D(36160,a,3553,null,0)}function x(a){var b=3553,d=0,f=null,e=null;"object"===typeof a&&("level"in a&&(d=a.level|0),"target"in a&&(b=a.target|0));var l=a._reglType;
"texture"===l?f=a:"renderbuffer"===l&&(e=a,b=36161,d=0);return new A(b,d,f,e)}function M(a){return a&&(a.texture||a.renderbuffer)}function C(){this.id=G++;N[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function q(d){e.isFramebuffer(d.framebuffer)||(d.framebuffer=e.createFramebuffer());a.dirty=!0;e.bindFramebuffer(36160,d.framebuffer);for(var f=
d.colorAttachments,k=0;k<f.length;++k)u(36064+k,f[k]);for(k=f.length;k<b.maxColorAttachments;++k)u(36064+k,null);u(36096,d.depthAttachment);u(36128,d.stencilAttachment);u(33306,d.depthStencilAttachment);l.webgl_draw_buffers&&l.webgl_draw_buffers.drawBuffersWEBGL(ea[f.length]);e.checkFramebufferStatus(36160)}function k(a){a=a.framebuffer;e.isFramebuffer(a)&&e.deleteFramebuffer(a)}var a={current:null,next:null,dirty:!1},V={rgba:6408},B={rgba4:32854,rgb565:36194,"rgb5 a1":32855};l.ext_srgb&&(B.srgba=
35907);l.ext_color_buffer_half_float&&(B.rgba16f=34842,B.rgb16f=34843);l.webgl_color_buffer_float&&(B.rgba32f=34836);var p=[],la=[];l.webgl_depth_texture&&(p.push(6402),la.push(34041));f(f({},V),B);n(V);n(B);B=5121;p={uint8:5121};l.oes_texture_half_float&&(B=p["half float"]=36193);l.oes_texture_float&&(B=p["float"]=5126);p.best=B;var ea=function(){for(var a=Array(b.maxDrawbuffers),d=0;d<=b.maxDrawbuffers;++d)for(var f=a[d]=Array(d),e=0;e<d;++e)f[e]=36064+e;return a}(),G=0,N={};return f(a,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof C)?a:null},create:function(a){function b(a){var l,k=a||{},n=a=0;if("shape"in k){var C=k.shape;a=C[0];n=C[1]}else"radius"in k&&(a=n=k.radius),"width"in k&&(a=k.width),"height"in k&&(n=k.height);var u=null,C=!1;if("colorBuffers"in k||"colorBuffer"in k){u=k.colorBuffers||k.colorBuffer;Array.isArray(u)||(u=[u]);f.width=a;f.height=n;u=u.map(x);for(l=0;l<u.length;++l)E(u[l],f);a=f.width;n=f.height}else{var p=!0,B="rgba",D="uint8",G=1,
C=!0;f.width=a=a||e.drawingBufferWidth;f.height=n=n||e.drawingBufferHeight;"format"in k&&(B=k.format,p=B in V);"type"in k&&(D=k.type);"colorCount"in k&&(G=k.colorCount|0);if(f.ownsColor)for(u=f.colorAttachments;u.length>G;)H(u.pop());else u=[];for(l=0;l<u.length;++l){var L;a:{L=u[l];var U=p,Q=B,N=a,T=n;if(L.texture){var O=L.texture;if(U){O({format:Q,type:D,width:N,height:T});O._texture.refCount+=1;L=!0;break a}}else if(O=L.renderbuffer,!U){O({format:Q,width:N,height:T});O._renderbuffer.refCount+=
1;L=!0;break a}H(L);L=!1}L||(u[l--]=u[u.length-1],u.pop())}for(;u.length<G;)p?u.push(new A(3553,0,d.create2D({format:B,type:D,width:a,height:n},3553),null)):u.push(new A(36161,0,null,m.create({format:B,width:a,height:n})))}f.width=a;f.height=n;B=p=l=null;D=!1;"depthBuffer"in k&&(l=x(k.depthBuffer));"stencilBuffer"in k&&(p=x(k.stencilBuffer));"depthStencilBuffer"in k&&(B=x(k.depthStencilBuffer));if(l||p||B)E(l||p||B,f);else if(G=!0,U=L=!1,"depth"in k&&(G=!!k.depth),"stencil"in k&&(L=!!k.stencil),"depthTexture"in
k&&(U=!!k.depthTexture),k=f.depthAttachment||f.stencilAttachment||f.depthStencilAttachment,Q=null,G||L)D=!0,U?(U=L?"depth stencil":"depth",f.ownsDepthStencil&&k.texture?(k.texture({format:U,width:a,height:n}),k.texture._texture.refCount+=1,Q=k):Q=new A(3553,0,d.create({format:U,width:a,height:n},3553),null)):(U=G?L?"depth stencil":"depth":"stencil",f.ownsDepthStencil&&k.renderbuffer?(k.renderbuffer({format:U,width:a,height:n}),k.renderbuffer._renderbuffer.refCount+=1,Q=k):Q=new A(36161,0,null,m.create({format:U,
width:a,height:n}))),G?L?B=Q:l=Q:p=Q;a=f;a.colorAttachments.forEach(H);H(a.depthAttachment);H(a.stencilAttachment);H(a.depthStencilAttachment);f.colorAttachments=u;f.depthAttachment=l;f.stencilAttachment=p;f.depthStencilAttachment=B;f.ownsColor=C;f.ownsDepthStencil=D;b.color=u.map(M);b.depth=M(l);b.stencil=M(p);b.depthStencil=M(B);q(f);b.width=f.width;b.height=f.height;return b}var f=new C;b(a);b._reglType="framebuffer";b._framebuffer=f;b._destroy=function(){k(f)};return b},clear:function(){n(N).forEach(k)},
refresh:function(){n(N).forEach(q)}})}},{"./util/extend":21,"./util/values":28}],13:[function(e,m,p){m.exports=function(e,f){var m=1;f.ext_texture_filter_anisotropic&&(m=e.getParameter(34047));var l=1,b=1;f.webgl_draw_buffers&&(l=e.getParameter(34852),b=e.getParameter(36063));return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(f).filter(function(b){return!!f[b]}),
maxAnisotropic:m,maxDrawbuffers:l,maxColorAttachments:b,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),
maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}}},{}],14:[function(e,m,p){var n=e("./util/is-typed-array");m.exports=function(f,e,l){return function(b){var d=b||{};n(b)?d={data:d}:2===arguments.length?d={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof b&&(d={});e();var m=d.x||0,A=d.y||0,p=d.width||l.viewportWidth,E=d.height||l.viewportHeight,d=d.data||new Uint8Array(p*E*4);f.pixelStorei(3333,
4);f.readPixels(m,A,p,E,6408,5121,d);return d}}},{"./util/is-typed-array":23}],15:[function(e,m,p){var n=e("./util/values");m.exports=function(f,e,l){function b(){this.id=p++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function d(b){f.isRenderbuffer(b.renderbuffer)||(b.renderbuffer=f.createRenderbuffer());f.bindRenderbuffer(36161,b.renderbuffer);f.renderbufferStorage(36161,b.format,b.width,b.height)}function m(b){var d=b.renderbuffer;f.bindRenderbuffer(36161,
null);f.isRenderbuffer(d)&&f.deleteRenderbuffer(d);b.renderbuffer=null;b.refCount=0;delete E[b.id]}var A={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};e.ext_srgb&&(A.srgba=35907);e.ext_color_buffer_half_float&&(A.rgba16f=34842,A.rgb16f=34843);e.webgl_color_buffer_float&&(A.rgba32f=34836);var p=0,E={};b.prototype.decRef=function(){0===--this.refCount&&m(this)};return{create:function(f){function e(b){b=b||{};var f=0,k=0;"shape"in b?(k=b.shape,f=k[0]|0,k=
k[1]|0):("radius"in b&&(f=k=b.radius|0),"width"in b&&(f=b.width|0),"height"in b&&(k=b.height|0));e.width=l.width=Math.max(f,1);e.height=l.height=Math.max(k,1);l.format=32854;"format"in b&&(l.format=A[b.format]);d(l);return e}var l=new b;E[l.id]=l;e(f);e._reglType="renderbuffer";e._renderbuffer=l;e.destroy=function(){l.decRef()};return e},refresh:function(){n(E).forEach(d)},clear:function(){n(E).forEach(m)}}}},{"./util/values":28}],16:[function(e,m,p){var n=e("./util/values");m.exports=function(f,
e){function l(b,d,f,a){this.name=b;this.id=d;this.location=f;this.info=a}function b(b,d){for(var f=0;f<b.length;++f)if(b[f].id===d.id){b[f].location=d.location;return}b.push(d)}function d(b,d,l){l=35632===b?p:E;var a=l[d];if(!a){var n=e.str(d),a=f.createShader(b);f.shaderSource(a,n);f.compileShader(a);l[d]=a}return a}function m(b,d){this.id=M++;this.fragId=b;this.vertId=d;this.program=null;this.uniforms=[];this.attributes=[]}function A(n,m){var k,a;k=d(35632,n.fragId);a=d(35633,n.vertId);var x=n.program=
f.createProgram();f.attachShader(x,k);f.attachShader(x,a);f.linkProgram(x);var u=f.getProgramParameter(x,35718),z=n.uniforms;for(k=0;k<u;++k)if(a=f.getActiveUniform(x,k))if(1<a.size)for(var A=0;A<a.size;++A){var p=a.name.replace("[0]","["+A+"]");b(z,new l(p,e.id(p),f.getUniformLocation(x,p),a))}else b(z,new l(a.name,e.id(a.name),f.getUniformLocation(x,a.name),a));u=f.getProgramParameter(x,35721);z=n.attributes;for(k=0;k<u;++k)(a=f.getActiveAttrib(x,k))&&b(z,new l(a.name,e.id(a.name),f.getAttribLocation(x,
a.name),a))}var p={},E={},u={},x=[],M=0;return{clear:function(){var b=f.deleteShader.bind(f);n(p).forEach(b);p={};n(E).forEach(b);E={};x.forEach(function(b){f.deleteProgram(b.program)});x.length=0;u={}},refresh:function(){p={};E={};x.forEach(A)},program:function(b,d,f){var a=u[d];a||(a=u[d]={});var e=a[b];e||(e=new m(d,b),A(e,f),a[b]=e,x.push(e));return e},shader:d,frag:null,vert:null}}},{"./util/values":28}],17:[function(e,m,p){m.exports=function(){var e={"":0},f=[""];return{id:function(m){var l=
e[m];if(l)return l;l=e[m]=f.length;f.push(m);return l},str:function(e){return f[e]}}}},{}],18:[function(e,m,p){function n(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function f(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var d=a[0].length,f=1;f<b;++f)if(!Array.isArray(a[f])||a[f].length!==d)return!1;return!0}function t(a){return Object.prototype.toString.call(a)}function l(a){if(!a)return!1;var b=t(a);return 0<=k.indexOf(b)?!0:
n(a)||f(a)||H(a)}function b(a,b){36193===a.type?(a.data=u(b),E.freeType(b)):a.data=b}var d=e("./util/extend"),z=e("./util/values"),A=e("./util/is-typed-array"),H=e("./util/is-ndarray"),E=e("./util/pool"),u=e("./util/to-half-float");p=e("./constants/arraytypes.json");var x=e("./constants/arraytypes.json"),M=[9984,9986,9985,9987],C=[0,6409,6410,6407,6408],q={};q[6409]=q[6406]=q[6402]=1;q[34041]=q[6410]=2;q[6407]=3;q[6408]=4;var k=Object.keys(p).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]",
"[object HTMLImageElement]","[object HTMLVideoElement]"]);m.exports=function(a,e,k,m,p){function ea(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function G(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;
a.width=b.width;a.height=b.height;a.channels=b.channels}function N(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=wa[b.colorSpace]);"type"in b&&(a.type=aa[b.type]);var d=a.width,f=a.height,e=a.channels,l=!1;"shape"in b?(d=b.shape[0],f=b.shape[1],3===b.shape.length&&(e=b.shape[2],l=!0)):("radius"in b&&(d=f=b.radius),"width"in b&&(d=b.width),
"height"in b&&(f=b.height),"channels"in b&&(e=b.channels,l=!0));a.width=d|0;a.height=f|0;a.channels=e|0;d=!1;"format"in b&&(d=b.format,f=a.internalformat=ca[d],a.format=Ea[f],d in aa&&!("type"in b)&&(a.type=aa[d]),d in da&&(a.compressed=!0),d=!0);!l&&d?a.channels=q[a.format]:l&&!d&&a.channels!==C[a.format]&&(a.format=a.internalformat=C[a.channels])}}function D(g){a.pixelStorei(37440,g.flipY);a.pixelStorei(37441,g.premultiplyAlpha);a.pixelStorei(37443,g.colorSpace);a.pixelStorei(3317,g.unpackAlignment)}
function ha(){ea.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function P(a,d){var e=null;l(d)?e=d:d&&(N(a,d),"x"in d&&(a.xOffset=d.x|0),"y"in d&&(a.yOffset=d.y|0),l(d.data)&&(e=d.data));if(d.copy){var k=p.viewportWidth,m=p.viewportHeight;a.width=a.width||k-a.xOffset;a.height=a.height||m-a.yOffset;a.needsCopy=!0}else if(!e)a.width=a.width||1,a.height=a.height||1;else if(A(e))a.data=e,"type"in d||5121!==a.type||(a.type=x[Object.prototype.toString.call(e)]|
0);else if(n(e)){k=e;m=a.width*a.height*a.channels;switch(a.type){case 5121:case 5123:case 5125:case 5126:m=E.allocType(a.type,m);m.set(k);a.data=m;break;case 36193:a.data=u(k)}a.alignment=1;a.needsFree=!0}else if(H(e)){k=e.data;Array.isArray(k)||5121!==a.type||(a.type=x[Object.prototype.toString.call(k)]|0);var m=e.shape,z=e.stride,q,X,c,v;3===m.length?(c=m[2],v=z[2]):v=c=1;q=m[0];X=m[1];m=z[0];z=z[1];a.alignment=1;a.width=q;a.height=X;a.channels=c;a.format=a.internalformat=C[c];a.needsFree=!0;q=
v;e=e.offset;c=a.width;v=a.height;X=a.channels;for(var B=E.allocType(36193===a.type?5126:a.type,c*v*X),D=0,F=0;F<v;++F)for(var w=0;w<c;++w)for(var ba=0;ba<X;++ba)B[D++]=k[m*w+z*F+q*ba+e];b(a,B)}else if("[object HTMLCanvasElement]"===t(e)||"[object CanvasRenderingContext2D]"===t(e))"[object HTMLCanvasElement]"===t(e)?a.element=e:a.element=e.canvas,a.width=a.element.width,a.height=a.element.height;else if("[object HTMLImageElement]"===t(e))a.element=e,a.width=e.naturalWidth,a.height=e.naturalHeight;
else if("[object HTMLVideoElement]"===t(e))a.element=e,a.width=e.videoWidth,a.height=e.videoHeight,a.needsPoll=!0;else if(f(e)){k=e[0].length;m=e.length;z=1;if(Array.isArray(e[0][0])){q=z=e[0][0].length;c=E.allocType(36193===a.type?5126:a.type,k*m*q);for(X=v=0;X<m;++X)for(B=e[X],D=0;D<k;++D)for(F=B[D],w=0;w<q;++w)c[v++]=F[w];b(a,c)}else{q=E.allocType(36193===a.type?5126:a.type,k*m);for(v=c=0;v<m;++v)for(X=e[v],B=0;B<k;++B)q[c++]=X[B];b(a,q)}a.alignment=1;a.width=k;a.height=m;a.channels=z;a.format=
a.internalformat=C[z];a.needsFree=!0}}function R(b,d,e,f,l){var k=b.element,n=b.data,x=b.internalformat,c=b.format,z=b.type,u=b.width,q=b.height;D(b);k?a.texSubImage2D(d,l,e,f,c,z,k):b.compressed?a.compressedTexSubImage2D(d,l,e,f,x,u,q,n):b.needsCopy?(m(),a.copyTexSubImage2D(d,l,e,f,b.xOffset,b.yOffset,u,q)):a.texSubImage2D(d,l,e,f,u,q,c,z,n)}function Y(){return xa.pop()||new ha}function S(a){a.needsFree&&E.freeType(a.data);ha.call(a);xa.push(a)}function ia(){ea.call(this);this.genMipmaps=!1;this.mipmapHint=
4352;this.mipmask=0;this.images=Array(16)}function K(a,b,d){var e=a.images[0]=Y();a.mipmask=1;e.width=a.width=b;e.height=a.height=d}function I(a,b){var d=null;if(l(b))d=a.images[0]=Y(),P(d,b),a.mipmask=1;else if(N(a,b),Array.isArray(b.mipmap))for(var e=b.mipmap,f=0;f<e.length;++f)d=a.images[f]=Y(),G(d,a),d.width>>=f,d.height>>=f,P(d,e[f]),a.mipmask|=1<<f;else d=a.images[0]=Y(),G(d,a),P(d,b),a.mipmask=1;G(a,a.images[0])}function J(b,d){for(var e=b.images,f=0;f<e.length&&e[f];++f){var l=e[f],k=d,n=
f,x=l.element,c=l.data,z=l.internalformat,u=l.format,q=l.type,t=l.width,w=l.height;D(l);x?a.texImage2D(k,n,u,u,q,x):l.compressed?a.compressedTexImage2D(k,n,z,t,w,0,c):l.needsCopy?(m(),a.copyTexImage2D(k,n,u,l.xOffset,l.yOffset,t,w,0)):a.texImage2D(k,n,u,t,w,0,u,q,c)}}function ja(){var a=Da.pop()||new ia;ea.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function fa(a){for(var b=a.images,d=0;d<b.length;++d)b[d]&&S(b[d]),b[d]=null;Da.push(a)}function oa(){this.magFilter=this.minFilter=
9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function L(a,b){"min"in b&&(a.minFilter=ta[b.min],0<=M.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=va[b.mag]);var d=a.wrapS,e=a.wrapT;if("wrap"in b){var f=b.wrap;"string"===typeof f?d=e=qa[f]:Array.isArray(f)&&(d=qa[f[0]],e=qa[f[1]])}else"wrapS"in b&&(d=qa[b.wrapS]),"wrapT"in b&&(e=qa[b.wrapT]);a.wrapS=d;a.wrapT=e;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){d=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=
ba[b.mipmap];d=a.genMipmaps=!0;break;case "boolean":d=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,d=!0}!d||"min"in b||(a.minFilter=9984)}}function ua(b,d){a.texParameteri(d,10241,b.minFilter);a.texParameteri(d,10240,b.magFilter);a.texParameteri(d,10242,b.wrapS);a.texParameteri(d,10243,b.wrapT);e.ext_texture_filter_anisotropic&&a.texParameteri(d,34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(d))}function Q(){var a=za.pop()||new oa;oa.call(a);return a}
function pa(b){ea.call(this);this.mipmask=0;this.id=sa++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0}function T(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function O(){var b=ga[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function W(b){var d=b.texture,e=b.unit,f=b.target;0<=e&&(a.activeTexture(33984+e),a.bindTexture(f,null),ga[e]=null);a.deleteTexture(d);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete Z[b.id]}
var ba={"don't care":4352,"dont care":4352,nice:4354,fast:4353},qa={repeat:10497,clamp:33071,mirror:33648},va={nearest:9728,linear:9729},ta=d({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},va),wa={none:0,browser:37444},aa={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},ca={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},da={};e.ext_srgb&&(ca.srgb=35904,
ca.srgba=35906);e.oes_texture_float&&(aa["float"]=5126);e.oes_texture_half_float&&(aa.float16=aa["half float"]=36193);e.webgl_depth_texture&&(d(ca,{depth:6402,"depth stencil":34041}),d(aa,{uint16:5123,uint32:5125,"depth stencil":34042}));e.webgl_compressed_texture_s3tc&&d(da,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});e.webgl_compressed_texture_atc&&d(da,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});e.webgl_compressed_texture_pvrtc&&
d(da,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});e.webgl_compressed_texture_etc1&&(da["rgb etc1"]=36196);var Ba=Array.prototype.slice.call(a.getParameter(34467));Object.keys(da).forEach(function(a){var b=da[a];0<=Ba.indexOf(b)&&(ca[a]=b)});var Ca=Object.keys(ca);k.textureFormats=Ca;var Ea=Ca.reduce(function(a,b){var d=ca[b];6409===d||6406===d||6409===d||6410===d||6402===d||34041===d?a[d]=d:32855===d||0<=b.indexOf("rgba")?a[d]=6408:a[d]=
6407;return a},{}),xa=[],Da=[],za=[],sa=0,Z={},ka=k.maxTextureUnits,ga=Array(ka).map(function(){return null});d(pa.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var d=0;d<ka;++d){var e=ga[d];if(e){if(0<e.bindCount)continue;e.unit=-1}ga[d]=this;b=d;break}this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&W(this)}});return{create2D:function(a,b){function d(a,b){var f=
Q(),g=ja();"number"===typeof a?"number"===typeof b?K(g,a|0,b|0):K(g,a|0,a|0):a?(L(f,a),I(g,a)):K(g,1,1);f.genMipmaps&&(g.mipmask=(g.width<<1)-1);e.mipmask=g.mipmask;G(e,g);d.width=g.width;d.height=g.height;T(e);J(g,3553);ua(f,3553);O();za.push(f);fa(g);return d}var e=new pa(3553);Z[e.id]=e;d(a,b);d.subimage=function(a,b,f,g){b|=0;f|=0;g|=0;var c=Y();G(c,e);c.width>>=g;c.height>>=g;c.width-=b;c.height-=f;P(c,a);T(e);R(c,3553,b,f,g);O();S(c);return d};d._reglType="texture2d";d._texture=e;d.destroy=
function(){e.decRef()};return d},createCube:function(a,b,d,e,f,l){function k(a,b,d,e,f,g){var h,l=Q();for(h=0;6>h;++h)c[h]=ja();if("number"===typeof a||!a)for(a=a|0||1,h=0;6>h;++h)K(c[h],a,a);else if("object"===typeof a)if(b)I(c[0],a),I(c[1],b),I(c[2],d),I(c[3],e),I(c[4],f),I(c[5],g);else if(L(l,a),N(n,a),"faces"in a)for(a=a.faces,h=0;6>h;++h)G(c[h],n),I(c[h],a[h]);else for(h=0;6>h;++h)I(c[h],a);G(n,c[0]);n.mipmask=l.genMipmaps?(c[0].width<<1)-1:c[0].mipmask;k.width=c[0].width;k.height=c[0].height;
T(n);for(h=0;6>h;++h)J(c[h],34069+h);ua(l,34067);O();za.push(l);for(h=0;6>h;++h)fa(c[h]);return k}var n=new pa(34067);Z[n.id]=n;var c=Array(6);k(a,b,d,e,f,l);k.subimage=function(a,b,c,d,e){c|=0;d|=0;e|=0;var f=Y();G(f,n);f.width>>=e;f.height>>=e;f.width-=c;f.height-=d;P(f,b);T(n);R(f,34069+a,c,d,e);O();S(f);return k};k._reglType="textureCube";k._texture=n;k.destroy=function(){n.decRef()};return k},clear:function(){for(var b=0;b<ka;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),ga[b]=null;z(Z).forEach(W)},
getTexture:function(a){return null}}}},{"./constants/arraytypes.json":4,"./util/extend":21,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/pool":25,"./util/to-half-float":27,"./util/values":28}],19:[function(e,m,p){m.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],20:[function(e,m,p){function n(e){return Array.prototype.slice.call(e)}function f(e){return n(e).join("")}var t=e("./extend");m.exports=function(){function e(){var b=
[],l=[];return t(function(){b.push.apply(b,n(arguments))},{def:function(){var e="v"+d++;l.push(e);0<arguments.length&&(b.push(e,"="),b.push.apply(b,n(arguments)),b.push(";"));return e},toString:function(){return f([0<l.length?"var "+l+";":"",f(b)])}})}function b(){function b(e,a){f(e,a,"=",d.def(e,a),";")}var d=e(),f=e(),n=d.toString,m=f.toString;return t(d,{entry:d,exit:f,save:b,set:function(e,a,f){b(e,a);d(e,a,"=",f,";")},toString:function(){return n()+m()}})}var d=0,m=[],p=[],H=e(),E={};return{global:H,
link:function(b){for(var e=0;e<p.length;++e)if(p[e]===b)return m[e];e="g"+d++;m.push(e);p.push(b);return e},block:e,proc:function(d,e){function l(){var a="a"+n.length;n.push(a);return a}var n=[];e=e||0;for(var m=0;m<e;++m)l();var m=b(),k=m.toString;return E[d]=t(m,{arg:l,toString:function(){return f(["function(",n.join(),"){",k(),"}"])}})},scope:b,cond:function(){var d=f(arguments),e=b(),l=b(),m=e.toString,z=l.toString;return t(e,{then:function(){e.apply(e,n(arguments));return this},"else":function(){l.apply(l,
n(arguments));return this},toString:function(){var b=z();b&&(b="else{"+b+"}");return f(["if(",d,"){",m(),"}",b])}})},compile:function(){var b=['"use strict";',H,"return {"];Object.keys(E).forEach(function(d){b.push('"',d,'":',E[d].toString(),",")});b.push("}");var d=f(b).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,m.concat(d)).apply(null,p)}}}},{"./extend":21}],21:[function(e,m,p){m.exports=function(e,f){for(var m=Object.keys(f),l=0;l<m.length;++l)e[m[l]]=
f[m[l]];return e}},{}],22:[function(e,m,p){var n=e("./is-typed-array");m.exports=function(e){return!!e&&"object"===typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"===typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||n(e.data))}},{"./is-typed-array":23}],23:[function(e,m,p){var n=e("../constants/arraytypes.json");m.exports=function(e){return Object.prototype.toString.call(e)in n}},{"../constants/arraytypes.json":4}],24:[function(e,m,p){m.exports=function(e,
f){for(var m=Array(e),l=0;l<e;++l)m[l]=f(l);return m}},{}],25:[function(e,m,p){function n(b){var d,e;d=(65535<b)<<4;b>>>=d;e=(255<b)<<3;b>>>=e;d|=e;e=(15<b)<<2;b>>>=e;d|=e;e=(3<b)<<1;return d|e|b>>>e>>1}function f(b){a:{for(var d=16;268435456>=d;d*=16)if(b<=d){b=d;break a}b=0}d=l[n(b)>>2];return 0<d.length?d.pop():new ArrayBuffer(b)}function t(b){l[n(b.byteLength)>>2].push(b)}var l=e("./loop")(8,function(){return[]});m.exports={alloc:f,free:t,allocType:function(b,d){var e=null;switch(b){case 5120:e=
new Int8Array(f(d),0,d);break;case 5121:e=new Uint8Array(f(d),0,d);break;case 5122:e=new Int16Array(f(2*d),0,d);break;case 5123:e=new Uint16Array(f(2*d),0,d);break;case 5124:e=new Int32Array(f(4*d),0,d);break;case 5125:e=new Uint32Array(f(4*d),0,d);break;case 5126:e=new Float32Array(f(4*d),0,d);break;default:return null}return e.length!==d?e.subarray(0,d):e},freeType:function(b){t(b.buffer)}}},{"./loop":24}],26:[function(e,m,p){m.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?
{next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:{next:function(e){setTimeout(e,30)},cancel:clearTimeout}},{}],27:[function(e,m,p){var n=e("./pool"),f=new Float32Array(1),t=new Uint32Array(f.buffer);m.exports=function(e){for(var b=n.allocType(5123,e.length),d=0;d<e.length;++d)if(isNaN(e[d]))b[d]=65535;else if(Infinity===e[d])b[d]=31744;else if(-Infinity===e[d])b[d]=64512;else{f[0]=e[d];var m=t[0],p=m>>>31<<15,H=(m<<1>>>24)-127,m=m>>13&1023;b[d]=
-24>H?p:-14>H?p+(m+1024>>-14-H):15<H?p+31744:p+(H+15<<10)+m}return b}},{"./pool":25}],28:[function(e,m,p){m.exports=function(e){return Object.keys(e).map(function(f){return e[f]})}},{}],29:[function(e,m,p){function n(e,b){function d(){var b=window.innerWidth,d=window.innerHeight;e!==document.body&&(d=e.getBoundingClientRect(),b=d.right-d.left,d=d.top-d.bottom);m.width=p*b;m.height=p*d;t(m.style,{width:b+"px",height:d+"px"})}var m=document.createElement("canvas"),n=f(m,b);t(m.style,{border:0,margin:0,
padding:0,top:0,left:0});e.appendChild(m);e===document.body&&(m.style.position="absolute",t(e.style,{margin:0,padding:0}));var p=+n.options.pixelRatio;window.addEventListener("resize",d,!1);var E=n.options.onDestroy;n.options=t(t({},n.options),{onDestroy:function(){window.removeEventListener("resize",d);e.removeChild(m);E&&E()}});d();return n}function f(e,b){function d(b){try{return e.getContext(b,f)}catch(d){return null}}var f=b.glOptions||{};return{gl:d("webgl")||d("experimental-webgl")||d("webgl-experimental"),
options:t({pixelRatio:window.devicePixelRatio},b)}}var t=e("./util/extend");m.exports=function(e){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:e[0],options:e[1]||{}};var b=document.body,d=e[1]||{};if("string"===typeof e[0])b=document.querySelector(e[0])||document.body;else if("object"===typeof e[0])if(e[0]instanceof HTMLElement)b=e[0];else{if(e[0]instanceof WebGLRenderingContext)return{gl:e[0],options:t({pixelRatio:1},d)};d=e[0]}return b.nodeName&&"CANVAS"===b.nodeName.toUpperCase()?
f(b,d):n(b,d)}},{"./util/extend":21}],30:[function(e,m,p){var n=e("./lib/util/extend"),f=e("./lib/dynamic"),t=e("./lib/util/raf"),l=e("./lib/util/clock"),b=e("./lib/strings"),d=e("./lib/webgl"),z=e("./lib/extension"),A=e("./lib/limits"),H=e("./lib/buffer"),E=e("./lib/elements"),u=e("./lib/texture"),x=e("./lib/renderbuffer"),M=e("./lib/framebuffer"),C=e("./lib/attribute"),q=e("./lib/shader"),k=e("./lib/read"),a=e("./lib/core");m.exports=function(){function e(){W=t.next(e);K.count+=1;var a=l();K.deltaTime=
(a-Y)/1E3;K.time=(a-R)/1E3;Y=a;G();for(a=0;a<O.length;++a)(0,O[a])(K,null,0)}function m(a){}function p(a){}function la(a){function b(a){var d={},e={};Object.keys(a).forEach(function(b){var k=a[b];f.isDynamic(k)?e[b]=f.unbox(k,b):d[b]=k});return{dynamic:e,"static":d}}function d(a){for(;t.length<a;)t.push(null);return t}var e=b(a.context||{}),k=b(a.uniforms||{}),l=b(a.attributes||{});a=b(function(a){function b(a){if(a in d){var e=d[a];delete d[a];Object.keys(e).forEach(function(b){d[a+"."+b]=e[b]})}}
var d=n({},a);delete d.uniforms;delete d.attributes;delete d.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return d}(a));var e=Q.compile(a,l,k,e),m=e.draw,p=e.batch,q=e.scope,t=[];return function(a,b){var e;if("function"===typeof a)return q.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(e=0;e<a;++e)q.call(this,null,b,e);else if(Array.isArray(a))for(e=0;e<a.length;++e)q.call(this,a[e],b,e);else return q.call(this,a,b,0);else if("number"===
typeof a){if(0<a)return p.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return m.call(this,a)}}function ea(){Q.procs.poll()}function G(){var a=pa.viewport,b=pa.scissor_box;a[0]=a[1]=b[0]=b[1]=0;K.viewportWidth=K.frameBufferWidth=K.drawingBufferWidth=a[2]=b[2]=D.drawingBufferWidth;K.viewportHeight=K.frameBufferWidth=K.drawingBufferHeight=a[3]=b[3]=D.drawingBufferHeight;Q.procs.refresh()}var N=d(Array.prototype.slice.call(arguments)),D=N.gl,ha=N.options,
N=b(),P=z(D).extensions,R=l(),Y=R,S=D.drawingBufferWidth,ia=D.drawingBufferHeight,K={count:0,deltaTime:0,time:0,viewportWidth:S,viewportHeight:ia,framebufferWidth:S,framebufferHeight:ia,drawingBufferWidth:S,drawingBufferHeight:ia,pixelRatio:ha.pixelRatio},I=A(D,P),J=H(D),S=E(D,P,J),ia=C(D,P,I,J,N),ja=q(D,N),fa=u(D,P,I,ea,K),oa=x(D,P,I),L=M(D,P,I,fa,oa),ua=k(D,ea,K),Q=a(D,N,P,I,J,S,fa,L,{},ia,ja,{elements:null,primitive:4,count:-1,offset:0,instances:-1},K),pa=Q.next,T=D.canvas,O=[],W=0;T&&(T.addEventListener("webglcontextlost",
m,!1),T.addEventListener("webglcontextrestored",p,!1));G();return n(la,{clear:function(a){var b=0;ea();var d=a.color;d&&(D.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),b|=16384);"depth"in a&&(D.clearDepth(+a.depth),b|=256);"stencil"in a&&(D.clearStencil(a.stencil|0),b|=1024);D.clear(b)},prop:f.define.bind(null,1),context:f.define.bind(null,2),"this":f.define.bind(null,3),draw:la({}),buffer:function(a){return J.create(a,34962)},elements:S.create,texture:fa.create2D,cube:fa.createCube,renderbuffer:oa.create,
framebuffer:L.create,framebufferCube:function(a){},attributes:D.getContextAttributes(),frame:function(a){O.push(a);!W&&0<O.length&&e();return{cancel:function(){var b=O.find(function(b){return b===a});0>b||(O.splice(b,1),0>=O.length&&W&&(t.cancel(e),W=0))}}},limits:I,hasExtension:function(a){return 0<=I.extensions.indexOf(a.toLowerCase())},read:ua,destroy:function(){W&&(t.cancel(e),W=0);T&&(T.removeEventListener("webglcontextlost",m),T.removeEventListener("webglcontextrestored",p));ja.clear();L.clear();
oa.clear();fa.clear();J.clear();if(ha.onDestroy)ha.onDestroy()},_gl:D,_refresh:G})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/strings":17,"./lib/texture":18,"./lib/util/clock":19,"./lib/util/extend":21,"./lib/util/raf":26,"./lib/webgl":29}]},{},[1]);

        </script>
        </body>
      </html>