<!DOCTYPE html>
      <html>
        <head>
          <title>example/batch.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(h,k,b){function t(c,g){if(!k[c]){if(!h[c]){var p="function"==typeof require&&require;if(!g&&p)return p(c,!0);if(a)return a(c,!0);p=Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p;}p=k[c]={exports:{}};h[c][0].call(p.exports,function(a){var b=h[c][1][a];return t(b?b:a)},p,p.exports,e$$0,h,k,b)}return k[c].exports}for(var a="function"==typeof require&&require,c=0;c<b.length;c++)t(b[c]);return t})({1:[function(d,h,k){var b=d("../regl")(),t=b({frag:"\n    precision mediump float;\n    uniform vec4 color;\n    void main() {\n      gl_FragColor = color;\n    }",
vert:"\n    precision mediump float;\n    attribute vec2 position;\n    uniform float angle;\n    uniform vec2 offset;\n    void main() {\n      gl_Position = vec4(\n        cos(angle) * position.x + sin(angle) * position.y + offset.x,\n        -sin(angle) * position.x + cos(angle) * position.y + offset.y, 0, 1);\n    }",attributes:{position:b.buffer([.5,0,0,.5,1,1])},uniforms:{color:function(a,b,e){a=e.count;return[Math.sin((.1+Math.sin(b))*a+3*b),Math.cos(.02*a+.1*b),Math.sin((.3+Math.cos(2*b))*
a+.8*b),1]},angle:function(a,b,e){return.01*e.count},offset:b.prop("offset")},depth:{enable:!1},count:3});b.frame(function(a){b.clear({color:[0,0,0,1]});t([{offset:[-1,-1]},{offset:[-1,0]},{offset:[-1,1]},{offset:[0,-1]},{offset:[0,0]},{offset:[0,1]},{offset:[1,-1]},{offset:[1,0]},{offset:[1,1]}])})},{"../regl":32}],2:[function(d,h,k){function b(){this.pointer=!1;this.w=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}var t=
d("./constants/dtypes.json");Object.assign(b.prototype,{equals:function(a,b){return this.pointer?a.pointer&&this.buffer===a.buffer&&this.size===b&&this.normalized===a.normalized&&this.type===a.type&&this.offset===a.offset&&this.stride===a.stride&&this.divisor===a.divisor:!a.pointer&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},set:function(a,b){(this.pointer=a.pointer)?(this.buffer=a.buffer,this.size=b,this.normalized=a.normalized,this.type=a.type,this.offset=a.offset,this.stride=a.stride,
this.divisor=a.divisor):(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w)}});h.exports=function(a,c,e,g){function p(){for(var a=Array(16),c=0;16>c;++c)a[c]=new b;this.records=a;this.top=0}function d(a){for(var c=a.records,n=a.top;c.length-1<=n;)c.push(new b);return c[++a.top]}var C={};e=e.maxAttributes;for(var h=Array(e),J=0;J<e;++J)h[J]=new b;Object.assign(p.prototype,{pushVec:function(a,b,c,g){var e=d(this);e.pointer=!1;e.x=a;e.y=b;e.z=c;e.w=g},pushPtr:function(a,b,c,e,g,t,p){var C=d(this);C.pointer=
!0;C.buffer=a;C.size=b;C.offset=c;C.stride=e;C.divisor=g;C.normalized=t;C.type=p},pushDyn:function(a){if("number"===typeof a)this.pushVec(a,0,0,0);else if(Array.isArray(a))this.pushVec(a[0],a[1],a[2],a[3]);else{var b=g.getBuffer(a),c=0,e=0,z=0,p=0,d=!1,A=5126;b?A=b.dtype:(b=g.getBuffer(a.buffer),c=a.size||0,e=a.stride||0,z=a.offset||0,p=a.divisor||0,d=a.normalized||!1,A=b.dtype,"type"in a&&(A=t[a.type]));this.pushPtr(b,c,z,e,p,d,A)}},pop:function(){--this.top}});return{bindings:h,attributes:C,bind:function(b,
e,g,v){v=g.size||v;if(!e.equals(g,v)){if(g.pointer){e.pointer||a.enableVertexAttribArray(b);e.buffer!==g.buffer&&g.buffer.bind();a.vertexAttribPointer(b,v,g.type,g.normalized,g.stride,g.offset);var t=c.angle_instanced_arrays;t&&t.vertexAttribDivisorANGLE(b,g.divisor)}else e.pointer&&a.disableVertexAttribArray(b),a.vertexAttrib4f(b,g.x,g.y,g.z,g.w);e.set(g,v)}},def:function(a){a in C||(C[a]=new p)}}}},{"./constants/dtypes.json":9}],3:[function(d,h,k){function b(a,b){switch(a){case 5121:return new Uint8Array(b);
case 5123:return new Uint16Array(b);case 5125:return new Uint32Array(b);case 5120:return new Int8Array(b);case 5122:return new Int16Array(b);case 5124:return new Int32Array(b);case 5126:return new Float32Array(b);default:return null}}var t=d("./check"),a=d("./is-typed-array"),c=d("./is-ndarray"),e=d("./constants/arraytypes.json"),g=d("./constants/dtypes.json"),p=d("./values"),A={"static":35044,dynamic:35048,stream:35040};h.exports=function(d){function h(a,b){this.id=m++;this.buffer=a;this.type=b;
this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function J(a){d.isBuffer(a.buffer)||(a.buffer=d.createBuffer());a.bind();d.bufferData(a.type,a.data||a.byteLength,a.usage)}function q(a){var b=a.buffer;t(b,"buffer must not be deleted already");d.isBuffer(b)&&d.deleteBuffer(b);a.buffer=null;delete n[a.id]}var m=0,n={};h.prototype.bind=function(){d.bindBuffer(this.type,this.buffer)};return{create:function(p,m,D){function ba(n){var q=n||{};if(Array.isArray(q)||a(q)||
c(q))q={data:q};else if("number"===typeof q)q={length:q|0};else if(null===q||void 0===q)q={};t.type(q,"object","buffer arguments must be an object, a number or an array");"usage"in q?(t.parameter(q.usage,A,"invalid buffer usage"),S.usage=A[q.usage]):S.usage=35044;n=0;"type"in q&&(t.parameter(q.type,g,"invalid buffer type"),n=g[q.type]);var d=q.dimension|0||1,p=0,m=null;if("data"in q)if(m=q.data,null===m)p=q.length|0;else{if(c(m)){var d=m.shape,p=m.stride,q=m.offset,v=0,z=0,D=0,h=0;1===d.length?(v=
d[0],z=1,D=p[0],h=0):2===d.length?(v=d[0],z=d[1],D=p[0],h=p[1]):t.raise("invalid shape");n=n||e[Object.prototype.toString.call(m)]|0||5126;for(var d=z,p=b(n,v*z),m=m.data,C=0,ea=0;ea<v;++ea)for(var Z=0;Z<z;++Z)p[C++]=m[D*ea+h*Z+q];m=p}else if(Array.isArray(m))if(0<m.length&&Array.isArray(m[0])){d=m[0].length;n=n||5126;q=b(n,m.length*d);p=m;m=d;for(v=h=0;v<p.length;++v)for(D=p[v],z=0;z<m;++z)q[h++]=D[z];m=q}else n=n||5126,m=b(n,m);else t.isTypedArray(m,"invalid data type buffer data"),n=n||e[Object.prototype.toString.call(m)]|
0;p=m.byteLength}else"length"in q&&(p=q.length|0,t.nni(p,"buffer length must be a nonnegative integer"));S.data=m;S.dtype=n||5121;S.byteLength=p;S.dimension=d;J(S);return ba}var N=d.createBuffer(),S=new h(N,m);n[S.id]=S;D||ba(p);ba._reglType="buffer";ba._buffer=S;ba.destroy=function(){q(S)};return ba},clear:function(){p(n).forEach(q)},refresh:function(){p(n).forEach(J)},getBuffer:function(a){return a&&a._buffer instanceof h?a._buffer:null}}}},{"./check":4,"./constants/arraytypes.json":8,"./constants/dtypes.json":9,
"./is-ndarray":17,"./is-typed-array":18,"./values":31}],4:[function(d,h,k){function b(a){a=Error("(regl) "+a);console.error(a);throw a;}var t=d("./is-typed-array");h.exports=Object.assign(function(a,c){a||b(c)},{raise:b,parameter:function(a,c,e){a in c||b("unknown parameter ("+a+")"+(e?": "+e:"")+". possible values: "+Object.keys(c).join())},type:function(a,c,e){typeof a!==c&&b("invalid parameter type"+(e?": "+e:"")+". expected "+c+", got "+typeof a)},isTypedArray:function(a,c){t(a)||b("invalid parameter type"+
(c?": "+c:"")+". must be a typed array")},nni:function(a,c){0<=a&&(a|0)===a||b("invalid parameter type, ("+a+")"+(c?": "+c:"")+". must be a nonnegative integer")},oneOf:function(a,c,e){0>c.indexOf(a)&&b("invalid value"+(e?": "+e:"")+". must be one of: "+c)}})},{"./is-typed-array":18}],5:[function(d,h,k){h.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],6:[function(d,h,k){h.exports=function(){function b(){var a=[],b=[];
return Object.assign(function(){a.push.apply(a,Array.prototype.slice.call(arguments))},{def:function(){var c="v"+d++;b.push(c);0<arguments.length&&(a.push(c,"="),a.push.apply(a,Array.prototype.slice.call(arguments)),a.push(";"));return c},toString:function(){return[0<b.length?"var "+b+";":"",a.join("")].join("")}})}var d=0,a=[],c=[],e={};return{link:function(b){var e="g"+d++;a.push(e);c.push(b);return e},block:b,proc:function(a){var c=[],A=b(),h=A.toString;return e[a]=Object.assign(A,{arg:function(){var a=
"a"+d++;c.push(a);return a},toString:function(){return["function(",c.join(),"){",h(),"}"].join("")}})},compile:function(){var b=['"use strict";return {'];Object.keys(e).forEach(function(a){b.push('"',a,'":',e[a].toString(),",")});b.push("}");return Function.apply(null,a.concat([b.join("")])).apply(null,c)}}}},{}],7:[function(d,h,k){function b(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}
function t(a,b,c,g){var d,p=",";switch(b){case 5126:d="1f";break;case 35664:d="2fv";break;case 35665:d="3fv";break;case 35666:d="4fv";break;case 35670:case 5124:d="1i";break;case 35671:case 35667:d="2iv";break;case 35672:case 35668:d="3iv";break;case 35673:case 35669:d="4iv";break;case 35674:d="Matrix2fv";p=",false,";break;case 35675:d="Matrix3fv";p=",false,";break;case 35676:d="Matrix4fv";p=",false,";break;default:e.raise("unsupported uniform type")}return a+".uniform"+d+"("+c+p+g+");"}function a(a){return a+
"["+a+".length-1]"}function c(a,b){return"framebuffer"===a||a<b?-1:a>b?1:0}var e=d("./check"),g=d("./codegen"),p=d("./constants/primitives.json"),A=d("./constants/dtypes.json"),C={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},
Y={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},J={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};h.exports=function(d,m,n,v,h,D,ba,N,S,k,T,ca,ja,la){function W(n,v,D,A,N){function P(a){var f=ra[a];return f?f:f=ra[a]=x(H[a])}function Q(a){var f=a.id,y=V[f];if(y)return y;y=a.func?l.def(x(a.data),"(",T,
",",I,",",E,")"):l.def(T,".",a.data);return V[f]=y}function u(a,f){return a.find(function(a){return a.name===f})}function K(a){return na&&!(a in v||a in N)}var L=g(),x=L.link,l=L.proc("batch"),F=L.block(),R=l.def,aa=l.arg,f=x(d),G=x(n.program),r=x(k.bind),E=x(ja),ia=x(ba),B=x(ca.count),O=x(ca.offset),ga=x(ca.instances),X=x(ca.primitive),ra={},fa=x(h.elements),B=R(a(B)),O=R(a(O)),X=R(a(X)),fa=R(a(fa)),w,M,oa=m.angle_instanced_arrays;oa&&(w=R(a(ga)),M=x(oa));var na="elements"in v,ga=aa(),aa=aa(),T=
R(),I=R(),V={};l(f,".useProgram(",G,");");n.uniforms.forEach(function(a){if(!(a.name in D)){var b=x(a.location),y=x(S.uniforms[a.name]),y=y+"["+y+".length-1]";35678===a.info.type||35680===a.info.type?(a=R(y+"._texture"),l(t(f,5124,b,a+".bind()")),F(a,".unbind();")):l(t(f,a.info.type,b,y))}});n.attributes.forEach(function(a){if(!(A.name in A)){var f=x(k.attributes[a.name]);l(r,"(",a.location,",",x(k.bindings[a.location]),",",f,".records[",f,".top]",",",b(a.info.type),");")}});na||l("if(",fa,"){",f,
".bindBuffer(",34963,",",fa,".buffer.buffer);","}else{",f,".bindBuffer(",34963,",null);","}");l("for(",I,"=0;",I,"<",ga,";++",I,"){",T,"=",aa,"[",I,"];");Object.keys(v).sort(c).forEach(function(a){function b(a){l("if(",y,"){",f,".enable(",a,");}else{",f,".disable(",a,");}")}var y=Q(v[a]);switch(a){case "framebuffer":a=P("viewport");var r=P("scissor.box");l("if(",ia,".push(",y,"&&",y,"._framebuffer)){",ia,".poll();",a,".setDirty();",r,".setDirty();","}");break;case "cull.enable":b(2884);break;case "blend.enable":b(3042);
break;case "dither":b(3024);break;case "stencil.enable":b(2960);break;case "depth.enable":b(2929);break;case "scissor.enable":b(3089);break;case "polygonOffset.enable":b(32823);break;case "sample.alpha":b(32926);break;case "sample.enable":b(32928);break;case "depth.mask":l(f,".depthMask(",y,");");break;case "depth.func":a=x(Y);l(f,".depthFunc(",a,"[",y,"]);");break;case "depth.range":l(f,".depthRange(",y,"[0],",y,"[1]);");break;case "blend.color":l(f,".blendColor(",y,"[0],",y,"[1],",y,"[2],",y,"[3]);");
break;case "blend.equation":a=x(U);l("if(typeof ",y,'==="string"){',f,".blendEquation(",a,"[",y,"]);","}else{",f,".blendEquationSeparate(",a,"[",y,".rgb],",a,"[",y,".alpha]);","}");break;case "blend.func":a=x(C);l(f,".blendFuncSeparate(",a,'["srcRGB" in ',y,"?",y,".srcRGB:",y,".src],",a,'["dstRGB" in ',y,"?",y,".dstRGB:",y,".dst],",a,'["srcAlpha" in ',y,"?",y,".srcAlpha:",y,".src],",a,'["dstAlpha" in ',y,"?",y,".dstAlpha:",y,".dst]);");break;case "stencil.mask":l(f,".stencilMask(",y,");");break;case "stencil.func":a=
x(Y);l(f,".stencilFunc(",a,"[",y,'.cmp||"always"],',y,".ref|0,",'"mask" in ',y,"?",y,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":r=x(J);l(f,".stencilOpSeparate(","stencil.opFront"===a?1028:1029,",",r,"[",y,'.fail||"keep"],',r,"[",y,'.zfail||"keep"],',r,"[",y,'.pass||"keep"]);');break;case "polygonOffset.offset":l(f,".polygonOffset(",y,".factor||0,",y,".units||0);");break;case "cull.face":l(f,".cullFace(",y,'==="front"?',1028,":",1029,");");break;case "lineWidth":l(f,".lineWidth(",
y,");");break;case "frontFace":l(f,".frontFace(",y,'==="cw"?',2304,":",2305,");");break;case "colorMask":l(f,".colorMask(",y,"[0],",y,"[1],",y,"[2],",y,"[3]);");break;case "sample.coverage":l(f,".sampleCoverage(",y,".value,",y,".invert);");break;case "scissor.box":case "viewport":a=P(a);l(a,".push(",y,".x||0,",y,".y||0,",y,".w||-1,",y,".h||-1);");break;case "primitives":case "offset":case "count":case "elements":break;default:e.raise("unsupported option for batch",a)}});("viewport"in v||"framebuffer"in
v)&&l(P("viewport"),".poll();");("scissor.box"in v||"framebuffer"in v)&&l(P("scissor.box"),".poll();");"framebuffer"in v&&l(ia,".pop();");var W=n.uniforms,da=[];Object.keys(D).forEach(function(a){var b=u(W,a);if(b){var y=b.info.type,r=x(b.location);a=Q(D[a]);35678===b.info.type||35680===b.info.type?(b=R(a+"._texture"),da.push(b),l(t(f,5124,r,b+".bind()"))):l(t(f,y,r,a))}});da.forEach(function(a){l(a,".unbind();")});var la=n.attributes;Object.keys(A).forEach(function(a){var f=u(la,a);f&&l(r,"(",f.location,
",",x(a.bindings[f.location]),",",Q(A[a]),",",b(f.info.type),");")});v.count?l(B,"=",Q(v.count),";"):K("count")||l("if(",B,"){");v.offset&&l(O,"=",Q(v.offset),";");v.primitive&&(n=x(p),l(X,"=",n,"[",Q(v.primitive),"];"));na&&(n=Q(v.elements),l(fa,"=",n,"?",n,"._elements:null;"));K("offset")&&l(O,"=0;");l("if(",fa,"){");K("count")&&l(B,"=",fa,".vertCount;","if(",B,">0){");K("primitive")&&l(X,"=",fa,".primType;");na&&l(f,".bindBuffer(",34963,",",fa,".buffer.buffer);");oa&&(v.instances&&l(w,"=",Q(v.instances),
";"),l("if(",w,">0){",M,".drawElementsInstancedANGLE(",X,",",B,",",fa,".type,",O,",",w,");}else{"));l(f,".drawElements(",X,",",B,",",fa,".type,",O,");");oa&&l("}");K("count")&&l("}");l("}else{");K("count")||(K("primitive")&&l(X,"=",4,";"),oa&&l("if(",w,">0){",M,".drawArraysInstancedANGLE(",X,",",O,",",B,",",w,");}else{"),l(f,".drawArrays(",X,",",O,",",B,");}"),oa&&l("}"));l("}}",F);return L.compile().batch}var H=N.contextState,U={add:32774,subtract:32778,"reverse subtract":32779};m.ext_blend_minmax&&
(U.min=32775,U.max=32776);var da=0;return{draw:function(c){var e=g(),n=e.link,v=e.proc("draw"),p=v.def,A=n(d),D=n(c.program),C=n(k.bind),K=n(ca.count),L=n(ca.offset),x=n(ca.instances),l=n(ca.primitive),F=n(h.elements),R=[];v(A,".useProgram(",D,");");c.attributes.forEach(function(a){var f=n(k.attributes[a.name]);v(C,"(",a.location,",",n(k.bindings[a.location]),",",f,".records[",f,".top]",",",b(a.info.type),");")});c.uniforms.forEach(function(a){var f=n(a.location),b=n(S.uniforms[a.name]),b=b+"["+b+
".length-1]";35678===a.info.type||35680===a.info.type?(a=p(b+"._texture"),R.push(a),v(t(A,5124,f,a+".bind()"))):v(t(A,a.info.type,f,b))});R.forEach(function(a){v(a,".unbind();")});c=p(a(l));K=p(a(K));L=p(a(L));F=p(a(F));v("if(",K,"){");(D=m.angle_instanced_arrays)?(x=p(a(x)),D=n(D),v("if(",F,"){",F,".bind();","if(",x,">0){",D,".drawElementsInstancedANGLE(",c,",",K,",",F,".type,",L,",",x,");}else{",A,".drawElements(",c,",",K,",",F,".type,",L,");}","}else if(",x,">0){",D,".drawArraysInstancedANGLE(",
c,",",L,",",K,",",x,");}else{",A,".drawArrays(",c,",",L,",",K,");}}")):v("if(",F,"){",A,".drawElements(",c,",",K,",",F,".type,",L,");}","}else{",A,".drawArrays(",c,",",L,",",K,");}");return e.compile().draw},command:function(b,d,q,m,t,D,N){function u(a){var b=fa[a];return b?b:b=fa[a]=l(H[a])}function K(a,b){var f=u(a);w(f,".push(",b,");");M(f,".pop();")}function L(a){var b=a.id,f=va[b];if(f)return f;f=a.func?I.def(l(a.data),"(",sa,",0,",ua,")"):I.def(sa,".",a.data);return va[b]=f}var x=g(),l=x.link,
F=x.block,R=x.proc,aa=da++,f=l(la),G=l(T.fragShaders),r=l(T.vertShaders),E=l(T.programs),ia=l(ba),B={count:l(ca.count),offset:l(ca.offset),instances:l(ca.instances),primitive:l(ca.primitive)},O=l(h.elements),ga=l(p),X=l(Y),ra=l(J),fa={},w=F(),M=F(),oa=!1;Object.keys(b).sort(c).forEach(function(a){var f=b[a];switch(a){case "frag":oa=!0;w(G,".push(",l(f),");");M(G,".pop();");break;case "vert":oa=!0;w(r,".push(",l(f),");");M(r,".pop();");break;case "framebuffer":a=ba.getFramebuffer(f);e(null===f||a,
"invalid framebuffer object");a=u("viewport");var c=u("scissor.box");w("if(",ia,".push(",l(f&&f._framebuffer),")){",a,".setDirty();",c,".setDirty();","}");M("if(",ia,".pop()){",a,".setDirty();",c,".setDirty();","}");break;case "count":case "offset":case "instances":e.nni(f,a);w(B[a],".push(",f,");");M(B[a],".pop();");break;case "primitive":e.parameter(f,p,"not a valid drawing primitive");w(B.primitive,".push(",p[f],");");M(B.primitive,".pop();");break;case "elements":c=h.getElements(f);f=!("primitive"in
b);a=!("count"in b);c?(c=l(c),w(O,".push(",c,");"),f&&w(B.primitive,".push(",c,".primType);"),a&&w(B.count,".push(",c,".vertCount);")):(w(O,".push(null);"),f&&w(B.primitive,".push(",4,");"),a&&w(B.count,".push(0);"));f&&M(B.primitive,".pop();");a&&M(B.count,".pop();");"offset"in b||(w(B.offset,".push(0);"),M(B.offset,".pop();"));M(O,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":e.type(f,
"boolean",a);K(a,f);break;case "depth.func":e.parameter(f,Y,a);K(a,Y[f]);break;case "depth.range":e(Array.isArray(f)&&2===f.length&&f[0]<=f[1],"depth range is 2d array");a=u(a);w(a,".push(",f[0],",",f[1],");");M(a,".pop();");break;case "blend.func":a=u(a);e.type(f,"object","blend func must be an object");var c="srcRGB"in f?f.srcRGB:f.src,E="srcAlpha"in f?f.srcAlpha:f.src,g="dstRGB"in f?f.dstRGB:f.dst,f="dstAlpha"in f?f.dstAlpha:f.dst;e.parameter(c,C);e.parameter(E,C);e.parameter(g,C);e.parameter(f,
C);w(a,".push(",C[c],",",C[g],",",C[E],",",C[f],");");M(a,".pop();");break;case "blend.equation":a=u(a);"string"===typeof f?(e.parameter(f,U,"invalid blend equation"),w(a,".push(",U[f],",",U[f],");")):"object"===typeof f?(e.parameter(f.rgb,U,"invalid blend equation rgb"),e.parameter(f.alpha,U,"invalid blend equation alpha"),w(a,".push(",U[f.rgb],",",U[f.alpha],");")):e.raise("invalid blend equation");M(a,".pop();");break;case "blend.color":e(Array.isArray(f)&&4===f.length,"blend color is a 4d array");
a=u(a);w(a,".push(",f[0],",",f[1],",",f[2],",",f[3],");");M(a,".pop();");break;case "stencil.mask":e.type(f,"number","stencil mask must be an integer");a=u(a);w(a,".push(",f,");");M(a,".pop();");break;case "stencil.func":e.type(f,"object","stencil func must be an object");c=f.cmp||"keep";E=f.ref||0;f="mask"in f?f.mask:-1;e.parameter(c,Y,"invalid stencil func cmp");e.type(E,"number","stencil func ref");e.type(f,"number","stencil func mask");a=u(a);w(a,".push(",Y[c],",",E,",",f,");");M(a,".pop();");
break;case "stencil.opFront":case "stencil.opBack":e.type(f,"object",a);c=f.fail||"keep";E=f.zfail||"keep";f=f.pass||"keep";e.parameter(c,J,a);e.parameter(E,J,a);e.parameter(f,J,a);a=u(a);w(a,".push(",J[c],",",J[E],",",J[f],");");M(a,".pop();");break;case "polygonOffset.offset":e.type(f,"object",a);c=f.factor||0;f=f.units||0;e.type(c,"number","offset.factor");e.type(f,"number","offset.units");a=u(a);w(a,".push(",c,",",f,");");M(a,".pop();");break;case "cull.face":c=0;"front"===f?c=1028:"back"===f&&
(c=1029);e(!!c,"cull.face");f=u(a);w(f,".push(",c,");");M(f,".pop();");break;case "lineWidth":c=n.lineWidthDims;e("number"===typeof f&&f>=c[0]&&f<=c[1],"invalid line width, must positive number between "+c[0]+" and "+c[1]);K(a,f);break;case "frontFace":c=0;"cw"===f?c=2304:"ccw"===f&&(c=2305);e(!!c,"frontFace");f=u(a);w(f,".push(",c,");");M(f,".pop();");break;case "colorMask":e(Array.isArray(f)&&4===f.length,"color mask must be length 4 array");a=u(a);w(a,".push(",f.map(function(a){return!!a}).join(),
");");M(a,".pop();");break;case "sample.coverage":e.type(f,"object",a);c="value"in f?f.value:1;f=!!f.invert;e("number"===typeof c&&0<=c&&1>=c,"sample value");a=u(a);w(a,".push(",c,",",f,");");M(a,".pop();");break;case "viewport":case "scissor.box":e("object"===typeof f&&f,a+" is an object");var c=f.x||0,E=f.y||0,d=g=-1;e("number"===typeof c&&0<=c,a+".x must be a positive int");e("number"===typeof E&&0<=E,a+".y must be a positive int");"w"in f&&(g=f.w,e("number"===typeof g&&0<=g,a+".w must be a positive int"));
"h"in f&&(d=f.h,e("number"===typeof d&&0<=d,a+".h must be a positive int"));f=u(a);w(f,".push(",c,",",E,",",g,",",d,");");M(f,".pop();");break;default:e.raise("unsupported parameter "+a)}});if(oa){if(b.frag&&b.vert)w(E,".push(",l(T.create(b.vert,b.frag)),");");else{var F=w.def(G,"[",G,".length-1]"),na=w.def(r,"[",r,".length-1]"),ta=l(T.create);w(E,".push(",ta,"(",na,",",F,"));")}M(E,".pop();")}Object.keys(d).forEach(function(a){S.def(a);var f=l(S.uniforms[a]);a=d[a];a="function"===typeof a&&a._reglType?
l(a):Array.isArray(a)?l(a.slice()):+a;w(f,".push(",a,");");M(f,".pop();")});Object.keys(q).forEach(function(a){k.def(a);var f=l(k.attributes[a]),b=q[a];if("number"===typeof b)w(f,".pushVec(",+b,",0,0,0);");else if(e(!!b,"invalid attribute: "+a),Array.isArray(b))w(f,".pushVec(",[b[0]||0,b[1]||0,b[2]||0,b[3]||0],");");else{var c=v.getBuffer(b),r=0,E=0,n=0,g=0,d=!1,G=5126;c?G=c.dtype:(e.type(b,"object",'invalid attribute "'+a+'"'),c=v.getBuffer(b.buffer),r=b.size||0,E=b.stride||0,n=b.offset||0,g=b.divisor||
0,d=b.normalized||!1,e(!!c,"invalid attribute "+a+".buffer"),G=c.dtype,"type"in b&&(e.parameter(b.type,A,"attribute type"),G=A[b.type]));e(!!c,"invalid attribute "+a+".buffer");e.nni(E,a+".stride");e.nni(n,a+".offset");e.nni(g,a+".divisor");e.type(d,"boolean",a+".normalized");e.oneOf(r,[0,1,2,3,4],a+".size");w(f,".pushPtr(",[l(c),r,n,E,g,d,G].join(),");")}M(f,".pop();")});var I=x.block(),V=x.block(),ua,sa;N&&(ua=l(ja),sa=w.def());var va={};Object.keys(m).sort(c).forEach(function(a){var f=L(m[a]);
switch(a){case "framebuffer":a=u("viewport");var c=u("scissor.box");I("if(",ia,".push(",f,"&&",f,"._framebuffer)){",a,".setDirty();",c,".setDirty();","}");V("if(",ia,".pop()){",a,".setDirty();",c,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=u(a);I(a,".push(",f,");");V(a,".pop();");break;case "count":case "offset":case "instances":a=
B[a];I(a,".push(",f,");");V(a,".pop();");break;case "primitive":a=B.primitive;I(a,".push(",ga,"[",f,"]);");V(a,".pop();");break;case "depth.func":a=u(a);I(a,".push(",X,"[",f,"]);");V(a,".pop();");break;case "blend.func":a=u(a);c=l(C);I(a,".push(",c,'["srcRGB" in ',f,"?",f,".srcRGB:",f,".src],",c,'["dstRGB" in ',f,"?",f,".dstRGB:",f,".dst],",c,'["srcAlpha" in ',f,"?",f,".srcAlpha:",f,".src],",c,'["dstAlpha" in ',f,"?",f,".dstAlpha:",f,".dst]);");V(a,".pop();");break;case "blend.equation":a=u(a);c=
l(U);I("if(typeof ",f,'==="string"){',a,".push(",c,"[",f,"],",c,"[",f,"]);","}else{",a,".push(",c,"[",f,".rgb],",c,"[",f,".alpha]);","}");V(a,".pop();");break;case "blend.color":a=u(a);I(a,".push(",f,"[0],",f,"[1],",f,"[2],",f,"[3]);");V(a,".pop();");break;case "stencil.mask":a=u(a);I(a,".push(",f,");");V(a,".pop();");break;case "stencil.func":a=u(a);I(a,".push(",X,"[",f,".cmp],",f,".ref|0,",'"mask" in ',f,"?",f,".mask:-1);");V(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=u(a);
I(a,".push(",ra,"[",f,'.fail||"keep"],',ra,"[",f,'.zfail||"keep"],',ra,"[",f,'.pass||"keep"]);');V(a,".pop();");break;case "polygonOffset.offset":a=u(a);I(a,".push(",f,".factor||0,",f,".units||0);");V(a,".pop();");break;case "cull.face":a=u(a);I(a,".push(",f,'==="front"?',1028,":",1029,");");V(a,".pop();");break;case "frontFace":a=u(a);I(a,".push(",f,'==="cw"?',2304,":",2305,");");V(a,".pop();");break;case "colorMask":a=u(a);I(a,".push(",f,"[0],",f,"[1],",f,"[2],",f,"[3]);");V(a,".pop();");break;
case "sample.coverage":a=u(a);I(a,".push(",f,".value,",f,".invert);");V(a,".pop();");break;case "scissor.box":case "viewport":a=u(a);I(a,".push(",f,".x||0,",f,".y||0,",'"w" in ',f,"?",f,".w:-1,",'"h" in ',f,"?",f,".h:-1);");V(a,".pop();");break;case "elements":a=!("primitive"in m)&&!("primitive"in b);var c=!("count"in m)&&!("count"in b),r=!("offset"in m)&&!("offset"in b),E=I.def();I("if(",f,"){",E,"=",f,"._elements;",O,".push(",E,");",a?B.primitive+".push("+E+".primType);":"",c?B.count+".push("+E+
".vertCount);":"",r?B.offset+".push("+E+".offset);":"","}else{",O,".push(null);","}");V(O,".pop();","if(",f,"){",a?B.primitive+".pop();":"",c?B.count+".pop();":"",r?B.offset+".pop();":"","}");break;default:e.raise("unsupported dynamic option: "+a)}});Object.keys(t).forEach(function(a){S.def(a);var f=l(S.uniforms[a]);a=L(t[a]);I(f,".push(",a,");");V(f,".pop();")});Object.keys(D).forEach(function(a){k.def(a);var f=l(k.attributes[a]);a=L(D[a]);I(f,".pushDyn(",a,");");V(f,".pop();")});F=R("scope");na=
F.arg();ta=F.arg();F(w);N&&F(sa,"=",na,";",I);F(ta,"();",N?V:"",M);F=R("draw");F(w);N&&F(sa,"=",F.arg(),";",I);na=a(E);F(f,"();","if(",na,")",na,".draw(",N?sa:"",");",N?V:"",M);var qa=R("batch");qa(w);N=qa.def(a(E));R=l(function(a,f,c){var r=a.batchCache[aa];r||(r=a.batchCache[aa]=W(a,m,t,D,b));return r(f,c)});qa("if(",N,"){",f,"();",R,"(",N,",",qa.arg(),",",qa.arg(),");");Object.keys(m).forEach(function(a){(a=fa[a])&&qa(a,".setDirty();")});qa("}",M);return x.compile()}}}},{"./check":4,"./codegen":6,
"./constants/dtypes.json":9,"./constants/primitives.json":10}],8:[function(d,h,k){h.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],9:[function(d,h,k){h.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],10:[function(d,
h,k){h.exports={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],11:[function(d,h,k){function b(a,b){function g(){var b=window.innerWidth,e=window.innerHeight;a!==document.body&&(e=a.getBoundingClientRect(),b=e.right-e.left,e=e.top-e.bottom);d.width=h*b;d.height=h*e;Object.assign(d.style,{width:b+"px",height:e+"px"})}var d=document.createElement("canvas"),A=t(d,b);Object.assign(d.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(d);
a===document.body&&(d.style.position="absolute",Object.assign(a.style,{margin:0,padding:0}));var h=+A.options.pixelRatio;window.addEventListener("resize",g,!1);var k=A.options.onDestroy;A.options=Object.assign({},A.options,{onDestroy:function(){window.removeEventListener("resize",g);a.removeChild(d);k&&k()}});g();return A}function t(b,e){function g(a){try{return b.getContext(a,d)}catch(e){return null}}var d=e.glOptions||{},t=g("webgl")||g("experimental-webgl")||g("webgl-experimental");a(t,"webgl not supported");
return{gl:t,options:Object.assign({pixelRatio:window.devicePixelRatio},e)}}var a=d("./check");h.exports=function(a){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:a[0],options:a[1]||{}};var e=document.body,g=a[1]||{};if("string"===typeof a[0])e=document.querySelector(a[0])||document.body;else if("object"===typeof a[0])if(a[0]instanceof HTMLElement)e=a[0];else{if(a[0]instanceof WebGLRenderingContext)return{gl:a[0],options:Object.assign({pixelRatio:1},g)};g=a[0]}return e.nodeName&&
"CANVAS"===e.nodeName.toUpperCase()?t(e,g):b(e,g)}},{"./check":4}],12:[function(d,h,k){h.exports=function(b){return{primitive:[4],count:[0],offset:[0],instances:[0]}}},{}],13:[function(d,h,k){function b(b,e){this.id=a++;this.func=b;this.data=e}function t(a,e){switch(typeof a){case "boolean":case "number":case "string":return new b(!1,a);case "function":return new b(!0,a);default:return t}}var a=0;h.exports={define:t,isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof b},
unbox:function(a,e){return a instanceof b?a:"function"===typeof a&&a!==t?new b(!0,a):new b(!1,e)}}},{}],14:[function(d,h,k){var b=d("./check"),t=d("./is-typed-array"),a=d("./is-ndarray"),c=d("./constants/primitives.json");h.exports=function(e,g,d){function A(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}A.prototype.bind=function(){this.buffer.bind()};return{create:function(e){function h(e){var n=g.oes_element_index_uint;if(e)if("number"===typeof e)q(e);else{var d=null,p="static",D=
0;Array.isArray(e)||t(e)||a(e)?d=e:(b.type(e,"object","invalid arguments for elements"),"data"in e&&(d=e.data),"usage"in e&&(p=e.usage),"length"in e&&(D=e.length));Array.isArray(d)||a(d)&&"array"===d.dtype||"type"in e?q({type:e.type||(n?"uint32":"uint16"),usage:p,data:d,length:D}):q({usage:p,data:d,length:D});if(Array.isArray(d)||t(d))q.dimension=3}else q();d=k.buffer.byteLength;p=0;switch(k.buffer.dtype){case 5121:case 5120:p=5121;break;case 5123:case 5122:p=5123;d>>=1;break;case 5125:case 5124:b(n,
"32 bit element buffers not supported");p=5125;d>>=2;break;default:b.raise("invalid element buffer type")}n=4;D=k.buffer.dimension;1===D&&(n=0);2===D&&(n=1);3===D&&(n=4);"object"===typeof e&&("primitive"in e&&(n=e.primitive,b.parameter(n,c),n=c[n]),"count"in e&&(d=e.vertCount|0));k.primType=n;k.vertCount=d;k.type=p;return h}var k=new A,q=d.create(null,34963,!0);k.buffer=q._buffer;h(e);Object.assign(h,{_reglType:"elements",_elements:k,destroy:function(){b(null!==k.buffer,"must not double destroy elements");
q.destroy();k.buffer=null}});return h},elements:[null],getElements:function(a){return a&&a._elements instanceof A?a._elements:null}}}},{"./check":4,"./constants/primitives.json":10,"./is-ndarray":17,"./is-typed-array":18}],15:[function(d,h,k){h.exports=function(b){function d(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(c){try{a[c]=
b.getExtension(c)}catch(e){}})}var a={};d();return{extensions:a,refresh:d}}},{}],16:[function(d,h,k){var b=d("./check"),t=d("./values"),a=[1029];h.exports=function(c,e,d,p,h){function C(a,b,c,e){this.target=a;this.level=b;this.texture=c;this.renderbuffer=e}function k(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function J(a,c,e){if(a.texture)b.oneOf(a.texture._texture.params.internalformat,c,"unsupported texture format for attachment");else b.oneOf(a.renderbuffer._renderbuffer.format,
e,"unsupported renderbuffer format for attachment")}function q(a,c){var e=c.width,d=c.height;if(a.texture){var n=a.texture._texture,g=Math.max(1,n.params.width>>a.level),q=Math.max(1,n.params.height>>a.level),e=e||g,d=d||q;b(g===e&&q===d,"inconsistent width/height for supplied texture");b(0>n.pollId,"polling fbo textures not supported")}else n=a.renderbuffer._renderbuffer,e=e||n.width,d=d||n.height,b(n.width===e&&n.height===d,"inconsistent width/height for renderbuffer"),b(0<=ea.indexOf(n.format),
"renderbuffer format not compatible with color channels");n.refCount+=1;c.width=e;c.height=d}function m(a,b){b?b.texture?c.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):c.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):c.framebufferTexture2D(36160,a,3553,null,0)}function n(a){var c=3553,e=0,d=null,n=null,g=a;"object"===typeof a&&(g=a.data,"level"in a&&(e=a.level|0),"target"in a&&(c=a.target|0));b.type(g,"function","invalid attachment data");
g=a._reglType;"texture"===g?(d=a,34067===d._texture.target?b(34069<=c&&34075>c,"invalid cube map target"):b(3553===c)):"renderbuffer"===g?(n=a,c=36161,e=0):b.raise("invalid regl object for attachment");return new C(c,e,d,n)}function v(a){return a&&(a.texture||a.renderbuffer)}function z(){this.id=ka++;P[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=
!1}function D(a){c.isFramebuffer(a.framebuffer)||(a.framebuffer=c.createFramebuffer());u=!0;c.bindFramebuffer(36160,a.framebuffer);for(var n=a.colorAttachments,q=0;q<n.length;++q)m(36064+q,n[q]);for(q=n.length;q<d.maxColorAttachments;++q)m(36064+q,null);m(36096,a.depthAttachment);m(36128,a.stencilAttachment);m(33306,a.depthStencilAttachment);e.webgl_draw_buffers&&e.webgl_draw_buffers.drawBuffersWEBGL(ha[n.length]);a=c.checkFramebufferStatus(36160);36053!==a&&b.raise("framebuffer configuration not supported, status = "+
S[a])}function ba(a){a=a.framebuffer;b(a,"must not double destroy framebuffer");c.isFramebuffer(a)&&c.deleteFramebuffer(a)}function N(){return Q[Q.length-1]}var S={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},pa={rgba:6408},T={rgba4:32854,rgb565:36194,"rgb5 a1":32855};e.ext_srgb&&(T.srgba=35907);e.ext_color_buffer_half_float&&(T.rgba16f=34842,T.rgb16f=34843);e.webgl_color_buffer_float&&(T.rgba32f=34836);var ca=
[33189],ja=[36168],la=[34041],W=[],H=[],U=[];e.webgl_depth_texture&&(W.push(6402),U.push(34041));var da=Object.assign({},pa,T),ma=t(pa),ea=t(T),T=5121,Z={uint8:5121};e.oes_texture_half_float&&(T=Z["half float"]=36193);e.oes_texture_float&&(T=Z["float"]=5126);Z.best=T;var ha=function(){for(var a=Array(d.maxDrawbuffers),b=0;b<=d.maxDrawbuffers;++b)for(var c=a[b]=Array(b),e=0;e<b;++e)c[e]=36064+e;return a}(),ka=0,P={},Q=[null],u=!0;return{top:N,dirty:function(){return u},push:function(a){a=a||null;u=
u||a!==N();Q.push(a);return u},pop:function(){var a=N();Q.pop();return u=u||a!==N()},getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof z)?a:null},poll:function(){if(u){var b=Q[Q.length-1],d=e.webgl_draw_buffers;b?(c.bindFramebuffer(36160,b.framebuffer),d&&d.drawBuffersWEBGL(ha[b.colorAttachments.length])):(c.bindFramebuffer(36160,null),d&&d.drawBuffersWEBGL(a));u=!1}},create:function(a){function d(a){var t,m=a||{};t=e.webgl_draw_buffers;
var z=0,f=0;"shape"in m?(a=m.shape,b(Array.isArray(a)&&2<=a.length,"invalid shape for framebuffer"),z=a[0],f=a[1]):("radius"in m&&(z=f=m.radius),"width"in m&&(z=m.width),"height"in m&&(f=m.height));var G=null;a=!1;if("colorBuffers"in m||"colorBuffer"in m){G=m.colorBuffers||m.colorBuffer;Array.isArray(G)||(G=[G]);g.width=z;g.height=f;1<G.length&&b(t,"multiple render targets not supported");b(0<=G.length,"must specify at least one color attachment");G=G.map(n);for(t=0;t<G.length;++t)z=G[t],J(z,ma,ea),
q(z,g);z=g.width;f=g.height}else{var r=!0,E="rgba",ia="uint8",B=1;a=!0;g.width=z||c.drawingBufferWidth;g.height=f||c.drawingBufferHeight;"format"in m&&(E=m.format,b.parameter(E,da,"invalid color format"),r=E in pa);"type"in m&&(b(r,"colorType can not be set for renderbuffer targets"),ia=m.type,b.parameter(ia,Z,"invalid color type"));"colorCount"in m&&(B=m.colorCount|0,b(0<=B,"color count must be positive"));if(g.ownsColor)for(G=g.colorAttachments;G.length>B;)k(G.pop());else G=[];for(t=0;t<G.length;++t){var O;
a:{O=G[t];var ga=r,X=E,u=z,fa=f;if(O.texture){var w=O.texture;if(ga){w({format:X,type:ia,width:u,height:fa});w._texture.refCount+=1;O=!0;break a}}else if(w=O.renderbuffer,!ga){w({format:X,width:u,height:fa});w._renderbuffer.refCount+=1;O=!0;break a}k(O);O=!1}O||(G[t--]=G[G.length-1],G.pop())}for(;G.length<B;)r?G.push(new C(3553,0,p.create({format:E,type:ia,width:z,height:f},3553),null)):G.push(new C(36161,0,null,h.create({format:E,width:z,height:f})))}b(0<G.length,"must specify at least one color buffer");
g.width=z;g.height=f;E=r=t=null;ia=!1;B=0;"depthBuffer"in m&&(t=n(m.depthBuffer),J(t,W,ca),B+=1);"stencilBuffer"in m&&(r=n(m.stencilBuffer),J(r,H,ja),B+=1);"depthStencilBuffer"in m&&(E=n(m.depthStencilBuffer),J(E,U,la),B+=1);if(t||r||E)b(1===B,"can specify only one of depth, stencil or depthStencil attachment"),q(t||r||E,g);else if(B=!0,ga=O=!1,"depth"in m&&(B=!!m.depth),"stencil"in m&&(O=!!m.stencil),"depthTexture"in m&&(ga=!!m.depthTexture),m=g.depthAttachment||g.stencilAttachment||g.depthStencilAttachment,
X=null,B||O)ia=!0,ga?(b(e.webgl_depth_texture,"depth texture extension not supported"),b(B,"stencil only textures not supported"),ga=O?"depth stencil":"depth",g.ownsDepthStencil&&m.texture?(m.texture({format:ga,width:z,height:f}),m.texture._texture.refCount+=1,X=m):X=new C(3553,0,p.create({format:ga,width:z,height:f},3553),null)):(ga=B?O?"depth stencil":"depth":"stencil",g.ownsDepthStencil&&m.renderbuffer?(m.renderbuffer({format:ga,width:z,height:f}),m.renderbuffer._renderbuffer.refCount+=1,X=m):
X=new C(36161,0,null,h.create({format:ga,width:z,height:f}))),B?O?E=X:t=X:r=X;z=g;z.colorAttachments.forEach(k);k(z.depthAttachment);k(z.stencilAttachment);k(z.depthStencilAttachment);g.colorAttachments=G;g.depthAttachment=t;g.stencilAttachment=r;g.depthStencilAttachment=E;g.ownsColor=a;g.ownsDepthStencil=ia;d.color=G.map(v);d.depth=v(t);d.stencil=v(r);d.depthStencil=v(E);D(g);d.width=g.width;d.height=g.height;return d}var g=new z;d(a);Object.assign(d,{_reglType:"framebuffer",_framebuffer:g,destroy:function(){ba(g)}});
return d},clear:function(){t(P).forEach(ba)},refresh:function(){t(P).forEach(D)}}}},{"./check":4,"./values":31}],17:[function(d,h,k){var b=d("./is-typed-array");h.exports=function(d){return"object"===typeof d&&Array.isArray(d.shape)&&Array.isArray(d.stride)&&"number"===typeof d.offset&&d.shape.length===d.stride.length&&(Array.isArray(d.data)||b(d.data))}},{"./is-typed-array":18}],18:[function(d,h,k){var b=d("./constants/arraytypes.json");h.exports=function(d){return Object.prototype.toString.call(d)in
b}},{"./constants/arraytypes.json":8}],19:[function(d,h,k){h.exports=function(b,d){var a=1;d.ext_texture_filter_anisotropic&&(a=b.getParameter(34047));var c=1,e=1;d.webgl_draw_buffers&&(c=b.getParameter(34852),e=b.getParameter(36063));return{colorBits:[b.getParameter(3410),b.getParameter(3411),b.getParameter(3412),b.getParameter(3413)],depthBits:b.getParameter(3414),stencilBits:b.getParameter(3415),subpixelBits:b.getParameter(3408),extensions:Object.keys(d).filter(function(a){return!!d[a]}),maxAnisotropic:a,
maxDrawbuffers:c,maxColorAttachments:e,pointSizeDims:b.getParameter(33901),lineWidthDims:b.getParameter(33902),maxViewportDims:b.getParameter(3386),maxCombinedTextureUnits:b.getParameter(35661),maxCubeMapSize:b.getParameter(34076),maxRenderbufferSize:b.getParameter(34024),maxTextureUnits:b.getParameter(34930),maxTextureSize:b.getParameter(3379),maxAttributes:b.getParameter(34921),maxVertexUniforms:b.getParameter(36347),maxVertexTextureUnits:b.getParameter(35660),maxVaryingVectors:b.getParameter(36348),
maxFragmentUniforms:b.getParameter(36349),glsl:b.getParameter(35724),renderer:b.getParameter(7937),vendor:b.getParameter(7936),version:b.getParameter(7938)}}},{}],20:[function(d,h,k){h.exports=function(b,d){if("undefined"!==typeof document){var a;a=(a=/\.(\w+)(\?.*)?$/.exec(b))&&a[1]?a[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(a))return a=document.createElement("video"),a.autoplay=!0,a.loop=!0,d&&(a.crossOrigin=d),a.src=
b,a;if(0<=["dds"].indexOf(a))return a=new XMLHttpRequest,a.responseType="arraybuffer",a.open("GET",b,!0),a.send(),a;a=new Image;d&&(a.crossOrigin=d);a.src=b;return a}return null}},{}],21:[function(d,h,k){var b=d("./check");h.exports=function(d){function h(a){for(var b=Z,c=ha,e=0;e<K;++e){var f=Math.max(1,b+3>>2)*Math.max(1,c+3>>2)*Q;x.pixels.push({target:a,miplevel:e,width:b,height:c,data:new Uint8Array(d,L,f)});L+=f;b>>=1;c>>=1}}var k=new Int32Array(d);b(k[0]===t,"invalid magic number for dds header");
var ea=k[pa];b(ea&n,"unsupported dds format");var Z=k[ca],ha=k[T],ka=Y,P=0,Q=0,u=4;switch(k[W]){case z:Q=8;ea&v?(u=3,P=e):P=g;break;case D:Q=16;P=p;break;case ba:Q=16;P=A;break;case N:Q=8;P=C;break;default:b.raise("unsupported dds texture format")}var K=1;k[la]&J&&(K=Math.max(1,k[ja]));var L=k[S]+4,x={width:Z,height:ha,channels:u,format:P,type:ka,compressed:!0,cube:!1,pixels:[]},k=k[H];if(k&q)for(b((k&m)===m,"missing cubemap faces"),x.cube=!0,k=0;6>k;++k)h(c+k);else h(a);return x};var t=542327876,
a=3553,c=34069,e=33776,g=33777,p=33778,A=33779,C=36196,Y=5121,J=131072,q=512,m=64512,n=4,v=64,z=827611204,D=861165636,ba=894720068,N=826496069,S=1,pa=2,T=3,ca=4,ja=7,la=20,W=21,H=28},{"./check":4}],22:[function(d,h,k){h.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(b){return requestAnimationFrame(b)},cancel:function(b){return cancelAnimationFrame(b)}}:{next:function(b){setTimeout(b,30)},cancel:clearTimeout}},{}],23:[function(d,h,k){var b=
d("./check"),t=d("./is-typed-array");h.exports=function(a,c,d){return function(g){var p=g||{};t(g)?p={data:p}:2===arguments.length?p={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof g&&(p={});c();var h=p.x||0,k=p.y||0,Y=p.width||d.width,J=p.height||d.height,q=Y*J*4,p=p.data||new Uint8Array(q);b.isTypedArray(p);b(p.byteLength>=q,"data buffer too small");a.pixelStorei(3333,4);a.readPixels(h,k,Y,J,6408,5121,p);return p}}},{"./check":4,"./is-typed-array":18}],24:[function(d,h,k){var b=d("./check"),
t=d("./values");h.exports=function(a,c,d){function g(){this.id=Y++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function p(b){a.isRenderbuffer(b.renderbuffer)||(b.renderbuffer=a.createRenderbuffer());a.bindRenderbuffer(36161,b.renderbuffer);a.renderbufferStorage(36161,b.format,b.width,b.height)}function h(c){var d=c.renderbuffer;b(d,"must not double destroy renderbuffer");a.bindRenderbuffer(36161,null);a.isRenderbuffer(d)&&a.deleteRenderbuffer(d);c.renderbuffer=
null;c.refCount=0;delete J[c.id]}var k={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};c.ext_srgb&&(k.srgba=35907);c.ext_color_buffer_half_float&&(k.rgba16f=34842,k.rgb16f=34843);c.webgl_color_buffer_float&&(k.rgba32f=34836);var Y=0,J={};g.prototype.decRef=function(){0===--this.refCount&&h(this)};return{create:function(a){function c(a){a=a||{};var g=0,q=0;"shape"in a?(q=a.shape,b(Array.isArray(q)&&2<=q.length,"invalid renderbuffer shape"),g=q[0]|0,q=q[1]|
0):("radius"in a&&(g=q=a.radius|0),"width"in a&&(g=a.width|0),"height"in a&&(q=a.height|0));var h=d.maxRenderbufferSize;b(0<=g&&0<=q&&g<=h&&q<=h,"invalid renderbuffer size");c.width=n.width=Math.max(g,1);c.height=n.height=Math.max(q,1);n.format=32854;"format"in a&&(a=a.format,b.parameter(a,k,"invalid render buffer format"),n.format=k[a]);p(n);return c}var n=new g;J[n.id]=n;c(a);Object.assign(c,{_reglType:"renderbuffer",_renderbuffer:n,destroy:function(){n.decRef()}});return c},refresh:function(){t(J).forEach(p)},
clear:function(){t(J).forEach(h)}}}},{"./check":4,"./values":31}],25:[function(d,h,k){function b(a,b,d){this.name=a;this.location=b;this.info=d}var t=d("./check");h.exports=function(a,c,d,g){function p(b,c){var d=m[b],e=d[c];if(!e){e=a.createShader(b);a.shaderSource(e,c);a.compileShader(e);if(!a.getShaderParameter(e,a.COMPILE_STATUS)){var g=a.getShaderInfoLog(e);t.raise("Error compiling shader:\n"+g)}d[c]=e}return e}function h(){Object.keys(m).forEach(function(b){Object.keys(m[b]).forEach(function(c){a.deleteShader(m[b][c])})});
m[35632]={};m[35633]={}}function k(a,b){this.fragSrc=a;this.vertSrc=b;this.program=null;this.uniforms=[];this.attributes=[];this.draw=function(){};this.batchCache={}}function Y(){v.forEach(function(a){a.destroy()});v.length=0;n={}}function J(){v.forEach(function(a){a.link()})}function q(){h();Y()}var m={},n={},v=[];Object.assign(k.prototype,{link:function(){var n,m;n=p(a.FRAGMENT_SHADER,this.fragSrc);m=p(a.VERTEX_SHADER,this.vertSrc);var q=this.program=a.createProgram();a.attachShader(q,n);a.attachShader(q,
m);a.linkProgram(q);a.getProgramParameter(q,a.LINK_STATUS)||(n=a.getProgramInfoLog(q),t.raise("Error linking program:\n"+n));var h=a.getProgramParameter(q,a.ACTIVE_UNIFORMS),k=this.uniforms=[];for(n=0;n<h;++n)if(m=a.getActiveUniform(q,n))if(1<m.size)for(var v=0;v<m.size;++v){var A=m.name.replace("[0]","["+v+"]");k.push(new b(A,a.getUniformLocation(q,A),m));d.def(A)}else k.push(new b(m.name,a.getUniformLocation(q,m.name),m)),d.def(m.name);h=a.getProgramParameter(q,a.ACTIVE_ATTRIBUTES);k=this.attributes=
[];for(n=0;n<h;++n)if(m=a.getActiveAttrib(q,n))k.push(new b(m.name,a.getAttribLocation(q,m.name),m)),c.def(m.name);this.draw=g(this);this.batchCache={}},destroy:function(){a.deleteProgram(this.program)}});q();return{create:function(a,b){var c=n[b];c||(c=n[b]={});var d=c[a];d||(d=new k(b,a),d.link(),c[a]=d,v.push(d));return d},clear:q,refresh:function(){m[35632]={};m[35633]={};J()},programs:[null],fragShaders:["void main(){gl_FragColor=vec4(0,0,0,0);}"],vertShaders:["void main(){gl_Position=vec4(0,0,0,0);}"]}}},
{"./check":4}],26:[function(d,h,k){h.exports=function(b,d){var a=b.length,c=b.slice(),e=b.slice(),g=!1,h=!0;return{push:function(){g=!1;for(var b=0;b<a;++b){var d=arguments[b];g=g||d!==e[b];c.push(d)}},pop:function(){g=!1;c.length-=a;for(var b=0;b<a;++b)g=g||c[c.length-a+b]!==e[b]},poll:function(){var b=c.length-a;if(g||h){switch(a){case 1:d(c[b]);break;case 2:d(c[b],c[b+1]);break;case 3:d(c[b],c[b+1],c[b+2]);break;case 4:d(c[b],c[b+1],c[b+2],c[b+3]);break;case 5:d(c[b],c[b+1],c[b+2],c[b+3],c[b+4]);
break;case 6:d(c[b],c[b+1],c[b+2],c[b+3],c[b+4],c[b+5]);break;default:d.apply(null,c.slice(b,c.length))}for(var k=0;k<a;++k)e[k]=c[b+k];h=g=!1}},setDirty:function(){h=!0}}}},{}],27:[function(d,h,k){var b=d("./stack"),t=d("./codegen");h.exports=function(a,c,d){function g(c,d){var e=b([!!d],function(b){b?a.enable(c):a.disable(c)});e.flag=c;return e}var h={dither:g(3024),"blend.enable":g(3042),"blend.color":b([0,0,0,0],function(b,c,d,e){a.blendColor(b,c,d,e)}),"blend.equation":b([32774,32774],function(b,
c){a.blendEquationSeparate(b,c)}),"blend.func":b([1,0,1,0],function(b,c,d,e){a.blendFuncSeparate(b,c,d,e)}),"depth.enable":g(2929,!0),"depth.func":b([513],function(b){a.depthFunc(b)}),"depth.range":b([0,1],function(b,c){a.depthRange(b,c)}),"depth.mask":b([!0],function(b){a.depthMask(b)}),"cull.enable":g(2884),"cull.face":b([1029],function(b){a.cullFace(b)}),frontFace:b([2305],function(b){a.frontFace(b)}),colorMask:b([!0,!0,!0,!0],function(b,c,d,e){a.colorMask(b,c,d,e)}),lineWidth:b([1],function(b){a.lineWidth(b)}),
"polygonOffset.enable":g(32823),"polygonOffset.offset":b([0,0],function(b,c){a.polygonOffset(b,c)}),"sample.alpha":g(32926),"sample.enable":g(32928),"sample.coverage":b([1,!1],function(b,c){a.sampleCoverage(b,c)}),"stencil.enable":g(2960),"stencil.mask":b([-1],function(b){a.stencilMask(b)}),"stencil.func":b([519,0,-1],function(b,c,d){a.stencilFunc(b,c,d)}),"stencil.opFront":b([7680,7680,7680],function(b,c,d){a.stencilOpSeparate(1028,b,c,d)}),"stencil.opBack":b([7680,7680,7680],function(b,c,d){a.stencilOpSeparate(1029,
b,c,d)}),"scissor.enable":g(3089),"scissor.box":b([0,0,-1,-1],function(b,d,e,g){var h=e,k=c.top();0>e&&(h=k?k.width-b:a.drawingBufferWidth-b);e=g;0>g&&(e=k?k.height-d:a.drawingBufferHeight-d);a.scissor(b,d,h,e)}),viewport:b([0,0,-1,-1],function(b,g,n,h){var k=n,p=c.top();0>n&&(k=p?p.width-b:a.drawingBufferWidth-b);n=h;0>h&&(n=p?p.height-g:a.drawingBufferHeight-g);a.viewport(b,g,k,n);d.width=k;d.height=n})},k=t(),C=k.proc("poll"),Y=k.proc("refresh");Object.keys(h).forEach(function(a){a=k.link(h[a]);
C(a,".poll();");Y(a,".setDirty();")});var J=k.compile();return{contextState:h,viewport:d,poll:J.poll,refresh:J.refresh,notifyViewportChanged:function(){h.viewport.setDirty();h["scissor.box"].setDirty()}}}},{"./codegen":6,"./stack":26}],28:[function(d,h,k){function b(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function t(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,d=1;d<b;++d)if(!Array.isArray(a[d])||a[d].length!==
c)return!1;return!0}function a(a){return Object.prototype.toString.call(a)}function c(b){return"[object HTMLCanvasElement]"===a(b)}function e(b){return"[object CanvasRenderingContext2D]"===a(b)}var g=d("./check"),p=d("./values"),A=d("./is-typed-array"),C=d("./is-ndarray"),Y=d("./load-texture"),J=d("./to-half-float"),q=d("./parse-dds"),m=[9984,9986,9985,9987];h.exports=function(d,h,k,D,ba){function N(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=
this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=this.miplevel=0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function S(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=
4352}function pa(a,b){var d,c,e=0,n=0,k=0,l=0,p=0,t=0,q=!1,w=!1,u=!1,x=0,A=[0,0,0,0,0,0],C=0,I=!1;for(d=0;d<b.length;++d){c=b[d];var l=l||c.width<<c.miplevel,p=p||c.height<<c.miplevel,e=e||c.type,n=n||c.format,k=k||c.internalformat,t=t||c.channels,w=w||c.needsPoll,u=u||c.needsListeners,q=q||c.compressed,z=c.miplevel;c=c.target;I=I||0<z;3553===c?x|=1<<z:(c-=34069,A[c]|=1<<z,C|=1<<c)}a.needsPoll=w;a.needsListeners=u;a.width=l;a.height=p;a.format=n;a.internalformat=k;a.type=e;w=I?(l<<1)-1:1;if(3553===
a.target)g(0===C,"pixmap type must not contain cubemap faces"),g(x===w,"missing mip map data");else for(g(63===C,"missing cubemap faces"),d=0;6>d;++d)g(A[d]===w,"missing mip map data");d=0<=m.indexOf(a.minFilter);a.genMipmaps=!I&&(a.genMipmaps||d);I=I||a.genMipmaps;a.minFilter?g(I===d,"min filter inconsistent with mipmap data"):a.minFilter=I?9987:9728;I&&g(l===p&&!(l&l-1)&&!!l,"must be a square power of 2 to support mipmaps");a.genMipmaps&&g(!q,"mipmap generation not supported for compressed textures");
a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;33071===a.wrapS&&33071===a.wrapT||g(!(l&l-1)&&!!l&&!(p&p-1)&&!!p&&!C,"incompatible size for wrap mode, image must be a power of 2");(5126===e&&!h.oes_texture_float_linear||36193===e&&!h.oes_texture_half_float_linear)&&g(9728===this.magFilter&&9728===this.minFilter,"unsupported filter mode for float texture");for(d=0;d<b.length;++d)c=b[d],q=c.miplevel,c.width&&g(c.width<<q===l,"inconsistent width"),c.height&&g(c.height<<q===p,"inconsistent width"),c.channels?
g(c.channels===t,"inconsistent channels"):c.channels=t,c.format?g(c.format===n,"inconsistent format"):c.format=n,c.internalformat?g(c.internalformat===k,"inconsistent internalformat"):c.internalformat=k,c.type?g(c.type===e,"inconsistent type"):c.type=e,c.copy&&g(5121===c.type&&6408===c.internalformat,"incompatible format/type for copyTexImage2D")}function T(a){this.id=x++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=
new S(a);this.pixels=[]}function ca(a,b){function c(a,f){var d=f.mipmap,e;if(Array.isArray(d))for(var g=0;g<d.length;++g)e=new N(a),e.parseFlags(b),e.parseFlags(f),e.parse(d[g],g),h.push(e);else e=new N(a),e.parseFlags(b),e.parse(f,0),h.push(e)}var d;W(a);var e=a.params;S.call(e,a.target);var h=a.pixels;h.length=0;e.parse(b);if(3553===a.target)c(3553,b);else{var n=b.faces||b;if(Array.isArray(n))for(g(6===n.length,"invalid number of faces in cube map"),d=0;6>d;++d)c(34069+d,n[d]);else if("string"!==
typeof n)for(d=0;6>d;++d)c(34069+d,{})}pa(e,h);e.needsListeners&&la(a);e.needsPoll&&(a.pollId=F.length,F.push(a));ja(a)}function ja(a){d.isTexture(a.texture)||(a.texture=d.createTexture());var b=a.target,c=a.unit;0<=c?(d.activeTexture(33984+c),L=c):d.bindTexture(b,a.texture);for(var b=a.pixels,e=a.params,g=0;g<b.length;++g)b[g].upload(e);e.upload();0>c&&((c=aa[L])?d.bindTexture(c.target,c.texture):(a.unit=L,aa[L]=a))}function la(a){function b(d,c,r){var h=q(r);g(h.format in K,"unsupported dds texture format");
h.cube?(g(34067===a.target),g.raise("cube map DDS not yet implemented")):g(3553===a.target);c&&g(1===h.pixels.length,"number of mip levels inconsistent");h.pixels.forEach(function(a){var b=new N(h.cube?a.target:d);b.channels=h.channels;b.compressed=h.compressed;b.type=h.type;b.internalformat=h.format;b.format=K[h.format];b.width=a.width;b.height=a.height;b.miplevel=a.miplevel||c;b.data=a.data;e.push(b)})}function d(){for(var g=0;g<e.length;++g){var r=e[g],h=r.image,n=r.video,k=r.xhr;h&&h.complete?
(r.width=h.naturalWidth,r.height=h.naturalHeight):n&&2<n.readyState?(r.width=n.width,r.height=n.height):k&&4===k.readyState&&(e[g]=e[e.length-1],e.pop(),k.removeEventListener("readystatechange",ja),b(r.target,r.miplevel,k.response))}pa(c,e);ja(a)}var c=a.params,e=a.pixels;e.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",d):a.video&&1>a.readyState?a.video.addEventListener("progress",d):a.xhr&&a.xhr.addEventListener("readystatechange",d)});a.cancelPending=function(){e.forEach(function(a){a.image?
a.image.removeEventListener("load",d):a.video?a.video.removeEventListener("progress",d):a.xhr&&(a.xhr.removeEventListener("readystatechange",d),a.xhr.abort())})}}function W(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((F[b]=F[F.length-1]).id=b,F.pop(),a.pollId=-1)}function H(a){var b=a.texture;g(b,"must not double destroy texture");var c=a.unit,e=a.target;0<=c&&(d.activeTexture(33984+c),L=c,d.bindTexture(e,null),aa[c]=null);W(a);d.isTexture(b)&&d.deleteTexture(b);a.texture=
null;a.params=null;a.pixels=null;a.refCount=0;delete l[a.id]}var U={"don't care":4352,"dont care":4352,nice:4354,fast:4353},da={repeat:10497,clamp:33071,mirror:33648},ma={nearest:9728,linear:9729},ea=Object.assign({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ma),Z={none:0,browser:37444},ha={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},ka={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,
rgba4:32854,"rgb5 a1":32855,rgb565:36194},P={};h.ext_srgb&&(ka.srgb=35904,ka.srgba=35906);h.oes_texture_float&&(ha["float"]=5126);h.oes_texture_half_float&&(ha["half float"]=36193);h.webgl_depth_texture&&(Object.assign(ka,{depth:6402,"depth stencil":34041}),Object.assign(ha,{uint16:5123,uint32:5125,"depth stencil":34042}));h.webgl_compressed_texture_s3tc&&Object.assign(P,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});h.webgl_compressed_texture_atc&&Object.assign(P,
{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});h.webgl_compressed_texture_pvrtc&&Object.assign(P,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});h.webgl_compressed_texture_etc1&&(P["rgb etc1"]=36196);var Q=Array.prototype.slice.call(d.getParameter(34467));Object.keys(P).forEach(function(a){var b=P[a];0<=Q.indexOf(b)&&(ka[a]=b)});var u=Object.keys(ka);k.textureFormats=u;var K=u.reduce(function(a,b){var c=
ka[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});Object.assign(N.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in a&&(g.type(a.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(g.type(a.flipY,"boolean","invalid texture flip"),this.flipY=a.flipY);"alignment"in a&&(g.oneOf(a.alignment,[1,2,4,8],"invalid texture unpack alignment"),
this.unpackAlignment=a.alignment);"colorSpace"in a&&(g.parameter(a.colorSpace,Z,"invalid colorSpace"),this.colorSpace=Z[a.colorSpace]);if("format"in a){var b=a.format;g.parameter(b,ka,"invalid texture format");this.internalformat=ka[b];b in ha&&(this.type=ha[b]);b in P&&(this.compressed=!0)}"type"in a&&(b=a.type,g.parameter(b,ha,"invalid texture type"),this.type=ha[b]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(g(Array.isArray(a.shape)&&2<=a.shape.length,"shape must be an array"),
b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,g(Array.isArray(b)&&2<=b.length,"invalid stride vector"),this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|
0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(d,n){this.miplevel=n;this.width>>=n;this.height>>=n;var r=d;switch(typeof d){case "string":break;case "object":if(!d)return;this.parseFlags(d);var k=d.data;if("string"===typeof k||k&&(A(k)||b(k)||C(k)||c(k)||e(k)||"[object HTMLImageElement]"===a(k)||"[object HTMLVideoElement]"===a(k)||t(k)))r=d.data;break;case "undefined":return;default:g.raise("invalid pixel data type")}"string"===typeof r&&(r=Y(r,this.crossOrigin));
var k=null,l=!1;this.compressed&&g(r instanceof Uint8Array||"[object XMLHttpRequest]"===a(r),"compressed texture data must be stored in a uint8array");if(null!==r)if(A(r))this.data=r;else if(b(r))k=r,l=!0;else if(C(r)){Array.isArray(r.data)?(k=r.data,l=!0):this.data=r.data;var m=r.shape;this.width=m[0];this.height=m[1];this.channels=3===m.length?m[2]:1;m=r.stride;this.strideX=r.stride[0];this.strideY=r.stride[1];this.strideC=3===m.length?r.stride[2]:1;this.offset=r.offset;this.needsTranspose=!0}else if(c(r)||
e(r))c(r)?this.canvas=r:this.canvas=r.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===a(r))this.image=r,r.complete?(this.width=r.naturalWidth,this.height=r.naturalHeight):(this.width=this.width||r.naturalWidth,this.height=this.height||r.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();else if("[object HTMLVideoElement]"===a(r))this.video=r,1<r.readyState?(this.width=r.width,this.height=r.height):(this.width=
this.width||r.width,this.height=this.height||r.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===a(r))this.xhr=r,this.needsListeners=!0;else if(t(r)){var l=r.length,m=r[0].length,p=1,q,u,x,z;if(Array.isArray(r[0][0]))for(p=r[0][0].length,g(0<=p&&4>=p,"invalid number of channels for image data"),k=Array(l*m*p),u=z=0;u<m;++u)for(q=0;q<l;++q)for(x=0;x<p;++x)k[z++]=r[q][u][x];else for(k=Array(l*m),u=z=0;u<m;++u)for(q=0;q<l;++q)k[z++]=r[q][u];
this.width=l;this.height=m;this.channels=p;l=!0}else d.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||ba.width)|0,this.height=(this.height||ba.height)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=[6409,6410,6407,6408][(this.channels=this.channels||4)-1],g(this.internalformat,
"invalid number of channels"));m=this.internalformat;if(6402===m||34041===m)g(h.webgl_depth_texture,"depth/stencil texture not supported"),6402===m&&g(5123===this.type||5125,"depth texture type must be uint16 or uint32"),34041===m&&g(34042===this.type,"depth stencil texture format must match type"),g(!this.data&&!k&&!this.image&&!this.video&&!this.canvas,"depth/stencil textures are for rendering only");r=this.format=K[m];if(!this.channels)switch(r){case 6409:case 6406:case 6402:this.channels=1;break;
case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}r=this.type;5126===r?g(h.oes_texture_float,"float texture not supported"):36193===r?g(h.oes_texture_half_float,"half float texture not supported"):r||(r=6402===m?5125:5121);this.type=r;if(l)switch(r){case 5121:this.data=new Uint8Array(k);break;case 5123:this.data=new Uint16Array(k);break;case 5125:this.data=new Uint32Array(k);break;case 5126:this.data=new Float32Array(k);break;case 36193:this.data=J(k);
break;case 33635:case 32820:case 32819:case 34042:g.raise("unsupported format for automatic conversion");break;default:g.raise("unsupported type conversion")}if(this.data){if(this.needsTranspose){k=this.data;l=this.width;m=this.height;p=this.channels;q=this.strideX;u=this.strideY;x=this.strideC;z=this.offset;for(var w=new k.constructor(l*m*p),M=0,D=0;D<m;++D)for(var F=0;F<l;++F)for(var H=0;H<p;++H)w[M++]=k[u*D+q*F+x*H+z];this.data=w}switch(r){case 5121:g(this.data instanceof Uint8Array||this.data instanceof
Uint8ClampedArray,"incompatible pixel type");break;case 33635:case 32820:case 32819:case 5123:case 36193:g(this.data instanceof Uint16Array,"incompatible pixel type");break;case 5125:g(this.data instanceof Uint32Array,"incompatible pixel type");break;case 5126:g(this.data instanceof Float32Array,"incompatible pixel type");break;default:g.raise("bad or missing pixel type")}}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=
!1},upload:function(a){d.pixelStorei(37440,this.flipY);d.pixelStorei(37441,this.premultiplyAlpha);d.pixelStorei(37443,this.colorSpace);d.pixelStorei(3317,this.unpackAlignment);var b=this.target,c=this.miplevel,e=this.image,g=this.canvas,h=this.video,k=this.data,m=this.internalformat,l=this.format,p=this.type,q=this.width||Math.max(1,a.width>>c);a=this.height||Math.max(1,a.height>>c);h&&2<h.readyState?d.texImage2D(b,c,l,l,p,h):e&&e.complete?d.texImage2D(b,c,l,l,p,e):g?d.texImage2D(b,c,l,l,p,g):this.compressed?
d.compressedTexImage2D(b,c,m,q,a,0,k):this.copy?(D(),d.copyTexImage2D(b,c,l,this.x,this.y,q,a,0)):k?d.texImage2D(b,c,l,q,a,0,l,p,k):d.texImage2D(b,c,l,q||1,a||1,0,l,p,null)}});Object.assign(S.prototype,{parse:function(a){if("object"===typeof a&&a){if("min"in a){var b=a.min;g.parameter(b,ea);this.minFilter=ea[b]}"mag"in a&&(b=a.mag,g.parameter(b,ma),this.magFilter=ma[b]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var d=a.wrap;"string"===typeof d?(g.parameter(d,da),b=c=da[d]):Array.isArray(d)&&(g.parameter(d[0],
da),g.parameter(d[1],da),b=da[d[0]],c=da[d[1]])}else"wrapS"in a&&(b=a.wrapS,g.parameter(b,da),b=da[b]),"wrapT"in a&&(c=a.wrapT,g.parameter(c,da),c=da[c]);this.wrapS=b;this.wrapT=c;"anisotropic"in a&&(b=a.anisotropic,g("number"===typeof b&&1<=b&&b<=k.maxAnisotropic,"aniso samples must be between 1 and "),this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":g.parameter(a,U,"invalid mipmap hint");this.mipmapHint=U[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=
!!a;break;case "object":break;default:g.raise("invalid mipmap type")}}},upload:function(){var a=this.target;d.texParameteri(a,10241,this.minFilter);d.texParameteri(a,10240,this.magFilter);d.texParameteri(a,10242,this.wrapS);d.texParameteri(a,10243,this.wrapT);h.ext_texture_filter_anisotropic&&d.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(d.hint(33170,this.mipmapHint),d.generateMipmap(a))}});var L=0,x=0,l={},F=[],R=k.maxTextureUnits,aa=Array(R).map(function(){return null});Object.assign(T.prototype,
{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<R;++b){var c=aa[b];if(c){if(0<c.bindCount)continue;c.unit=-1}aa[b]=this;a=b;break}a>=R&&g.raise("insufficient number of texture units");this.unit=a;d.activeTexture(33984+a);d.bindTexture(this.target,this.texture);L=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&H(this)}});return{create:function(a,b){function c(a,f,e,g,h,k){var l=a||{};34067===b&&6===arguments.length&&(l=[a,f,e,g,h,k]);
ca(d,l);c.width=d.params.width;c.height=d.params.height;return c}var d=new T(b);l[d.id]=d;c(a);Object.assign(c,{_reglType:"texture",_texture:d,destroy:function(){d.decRef()}});return c},refresh:function(){p(l).forEach(ja);for(var a=0;a<R;++a)aa[a]=null;L=0;d.activeTexture(33984)},clear:function(){for(var a=0;a<R;++a)d.activeTexture(33984+a),d.bindTexture(3553,null),aa[a]=null;d.activeTexture(33984);L=0;p(l).forEach(H)},poll:function(){F.forEach(ja)},getTexture:function(a){return null}}}},{"./check":4,
"./is-ndarray":17,"./is-typed-array":18,"./load-texture":20,"./parse-dds":21,"./to-half-float":29,"./values":31}],29:[function(d,h,k){h.exports=function(b){for(var d=new Float32Array(b),d=new Uint32Array(d.buffer),a=new Uint16Array(b.length),c=0;c<b.length;++c)if(isNaN(b[c]))a[c]=65535;else if(Infinity===b[c])a[c]=31744;else if(-Infinity===b[c])a[c]=64512;else{var e=d[c],g=e>>>31<<15,h=(e<<1>>>24)-127,e=e>>13&1023;a[c]=-24>h?g:-14>h?g+(e+1024>>-14-h):15<h?g+31744:g+(h+15<<10)+e}return a}},{}],30:[function(d,
h,k){h.exports=function(){var b={};return{uniforms:b,def:function(d){d in b||(b[d]=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]])}}}},{}],31:[function(d,h,k){h.exports=function(b){return Object.keys(b).map(function(d){return b[d]})}},{}],32:[function(d,h,k){var b=d("./lib/check"),t=d("./lib/context"),a=d("./lib/extension"),c=d("./lib/limits"),e=d("./lib/buffer"),g=d("./lib/elements"),p=d("./lib/texture"),A=d("./lib/renderbuffer"),C=d("./lib/framebuffer"),Y=d("./lib/uniform"),J=d("./lib/attribute"),q=d("./lib/shader"),
m=d("./lib/draw"),n=d("./lib/state"),v=d("./lib/compile"),z=d("./lib/read"),D=d("./lib/dynamic"),ba=d("./lib/raf"),N=d("./lib/clock");h.exports=function(){function d(){G=ba.next(d);l.count+=1;if(l.width!==H.drawingBufferWidth||l.height!==H.drawingBufferHeight)l.width=H.drawingBufferWidth,l.height=H.drawingBufferHeight,F.notifyViewportChanged();var a=N();l.dt=a-l.t;l.t=a;K.poll();for(var b=0;b<f.length;++b)(0,f[b])(l.count,l.t,l.dt);l.renderTime=N()-a}function h(){G&&(ba.cancel(d),G=0)}function k(a){h();
a.preventDefault();if(U.onContextLost)U.onContextLost()}function ca(a){H.getError();da.refresh();Z.refresh();K.refresh();L.refresh();x.refresh();Q.refresh();F.refresh();if(U.onContextRestored)U.onContextRestored();d()}function ja(a){function c(a){var b={},e={};Object.keys(a).forEach(function(c){var f=a[c];D.isDynamic(f)?(d=!0,e[c]=D.unbox(f,c)):b[c]=f});return{dynamic:e,"static":b}}b(!!a,"invalid args to regl({...})");b.type(a,"object","invalid args to regl({...})");var d=!1,e=c(a.uniforms||{}),f=
c(a.attributes||{});a=c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=Object.assign({},a);delete c.uniforms;delete c.attributes;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var e=R.command(a["static"],e["static"],f["static"],a.dynamic,e.dynamic,f.dynamic,d),g=e.draw,h=e.batch,k=e.scope,l=[];return function(a,b){if("number"===typeof a){for(var c=a|0;l.length<c;)l.push(null);
return h(a|0,l)}return Array.isArray(a)?h(a.length,a):"function"===typeof a?k(null,a):"function"===typeof b?k(a,b):g(a)}}function la(){x.poll();F.poll()}var W=t(Array.prototype.slice.call(arguments)),H=W.gl,U=W.options,da=a(H),W=da.extensions,ma={width:H.drawingBufferWidth,height:H.drawingBufferHeight},ea=c(H,W),Z=e(H),ha=g(H,W,Z),ka=Y(),P=J(H,W,ea,Z),Q=q(H,P,ka,function(a){return R.draw(a)}),u=m(H,W,Z),K=p(H,W,ea,la,ma),L=A(H,W,ea),x=C(H,W,ea,K,L),l={count:0,start:N(),dt:0,t:N(),renderTime:0,width:H.drawingBufferWidth,
height:H.drawingBufferHeight,pixelRatio:U.pixelRatio},F=n(H,x,ma),ma=z(H,la,ma),R=v(H,W,ea,Z,ha,K,x,F,ka,P,Q,u,l,la),aa=H.canvas,f=[],G=0;aa&&(aa.addEventListener("webglcontextlost",k,!1),aa.addEventListener("webglcontextrestored",ca,!1));return Object.assign(ja,{clear:function(a){var c=0;la();var d=a.color;d&&(H.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in a&&(H.clearDepth(+a.depth),c|=256);"stencil"in a&&(H.clearStencil(a.stencil|0),c|=1024);b(!!c,"called regl.clear with no buffer specified");
H.clear(c)},prop:D.define,draw:ja({}),elements:function(a){return ha.create(a)},buffer:function(a){return Z.create(a,34962)},texture:function(a){return K.create(a,3553)},cube:function(a){return 6===arguments.length?K.create(Array.prototype.slice.call(arguments),34067):K.create(a,34067)},renderbuffer:function(a){return L.create(a)},framebuffer:function(a){return x.create(a)},framebufferCube:function(a){b.raise("framebuffer cube not yet implemented")},frame:function(a){f.push(a);!G&&0<f.length&&d();
return{cancel:function(){var b=f.find(function(b){return b===a});0>b||(f.splice(b,1),0>=f.length&&h())}}},stats:l,limits:ea,read:ma,destroy:function(){h();aa&&(aa.removeEventListener("webglcontextlost",k),aa.removeEventListener("webglcontextrestored",ca));Q.clear();x.clear();L.clear();K.clear();Z.clear();if(U.onDestroy)U.onDestroy()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/check":4,"./lib/clock":5,"./lib/compile":7,"./lib/context":11,"./lib/draw":12,"./lib/dynamic":13,"./lib/elements":14,
"./lib/extension":15,"./lib/framebuffer":16,"./lib/limits":19,"./lib/raf":22,"./lib/read":23,"./lib/renderbuffer":24,"./lib/shader":25,"./lib/state":27,"./lib/texture":28,"./lib/uniform":30}]},{},[1]);

        </script>
        </body>
      </html>