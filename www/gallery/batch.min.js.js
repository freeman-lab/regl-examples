(function e$$0(t,p,h){function e(c,f){if(!p[c]){if(!t[c]){var b="function"==typeof require&&require;if(!f&&b)return b(c,!0);if(x)return x(c,!0);b=Error("Cannot find module '"+c+"'");throw b.code="MODULE_NOT_FOUND",b;}b=p[c]={exports:{}};t[c][0].call(b.exports,function(f){var b=t[c][1][f];return e(b?b:f)},b,b.exports,e$$0,t,p,h)}return p[c].exports}for(var x="function"==typeof require&&require,n=0;n<h.length;n++)e(h[n]);return e})({1:[function(g,t,p){var h=g("../regl")(),e=h({frag:"\n    precision mediump float;\n    uniform vec4 color;\n    void main() {\n      gl_FragColor = color;\n    }",
vert:"\n    precision mediump float;\n    attribute vec2 position;\n    uniform float angle;\n    uniform vec2 offset;\n    void main() {\n      gl_Position = vec4(\n        cos(angle) * position.x + sin(angle) * position.y + offset.x,\n        -sin(angle) * position.x + cos(angle) * position.y + offset.y, 0, 1);\n    }",attributes:{position:[.5,0,0,.5,1,1]},uniforms:{color:function(e,h,c){e=e.tick;return[Math.sin(.02*((.1+Math.sin(c))*e+3*c)),Math.cos(.02*(.02*e+.1*c)),Math.sin(.02*((.3+Math.cos(2*
c))*e+.8*c)),1]},angle:function(e){return.01*e.tick},offset:h.prop("offset")},depth:{enable:!1},count:3});h.frame(function(){h.clear({color:[0,0,0,1]});e([{offset:[-1,-1]},{offset:[-1,0]},{offset:[-1,1]},{offset:[0,-1]},{offset:[0,0]},{offset:[0,1]},{offset:[1,-1]},{offset:[1,0]},{offset:[1,1]}])})},{"../regl":33}],2:[function(g,t,p){function h(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}t.exports=
function(e,x,n,c,f){e=n.maxAttributes;x=Array(e);for(n=0;n<e;++n)x[n]=new h;return{Record:h,scope:{},state:x}}},{}],3:[function(g,t,p){function h(c){return L[Object.prototype.toString.call(c)]|0}function e(c,f){for(var e=0;e<f.length;++e)c[e]=f[e]}function x(c,f,e,b,m,h,k){for(var x=0,a=0;a<e;++a)for(var N=0;N<b;++N)c[x++]=f[m*a+h*N+k]}function n(c,f,e){for(var b=0,h=0;h<f.length;++h)for(var k=f[h],x=0;x<e;++x)c[b++]=k[x]}var c=g("./util/is-typed-array"),f=g("./util/is-ndarray"),b=g("./util/values"),
z=g("./util/pool"),L=g("./constants/arraytypes.json"),E=g("./constants/dtypes.json"),A=g("./constants/usage.json"),k=[];k[5120]=1;k[5122]=2;k[5124]=4;k[5121]=1;k[5123]=2;k[5125]=4;k[5126]=4;t.exports=function(g,C,H){function l(c){this.id=G++;this.buffer=g.createBuffer();this.type=c;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;H.profile&&(this.stats={size:0})}function m(c,f,e){c.byteLength=f.byteLength;g.bufferData(c.type,f,e)}function t(a,b,l,k,g,N){a.usage=
l;if(Array.isArray(b))a.dtype=k||5126,0<b.length&&(Array.isArray(b[0])?(a.dimension=b[0].length,k=z.allocType(a.dtype,b.length*a.dimension),n(k,b,a.dimension),m(a,k,l),N?a.persistentData=k:z.freeType(k)):"number"===typeof b[0]?(a.dimension=g,k=z.allocType(a.dtype,b.length),e(k,b),m(a,k,l),N?a.persistentData=k:z.freeType(k)):c(b[0])&&(a.dimension=b[0].length,a.dtype=k||h(b[0])||5126,k=z.allocType(a.dtype,b.length*a.dimension),n(k,b,a.dimension),m(a,k,l),N?a.persistentData=k:z.freeType(k)));else if(c(b))a.dtype=
k||h(b),a.dimension=g,m(a,b,l),N&&(a.persistentData=new Uint8Array(new Uint8Array(b.buffer)));else if(f(b)){var F=b.shape,J=b.stride;g=b.offset;var B=0,G=0,r=0,U=0;1===F.length?(B=F[0],G=1,r=J[0],U=0):2===F.length&&(B=F[0],G=F[1],r=J[0],U=J[1]);a.dtype=k||h(b.data)||5126;a.dimension=G;k=z.allocType(a.dtype,B*G);x(k,b.data,B,G,r,U,g);m(a,k,l);N?a.persistentData=k:z.freeType(k)}}function B(c){C.bufferCount--;g.deleteBuffer(c.buffer);c.buffer=null;delete a[c.id]}var G=0,a={};l.prototype.bind=function(){g.bindBuffer(this.type,
this.buffer)};l.prototype.destroy=function(){B(this)};var N=[];H.profile&&(C.getTotalBufferSize=function(){var c=0;Object.keys(a).forEach(function(b){c+=a[b].stats.size});return c});return{create:function(b,m,N,G){function L(a){var b=35044,e=null,h=0,r=0,l=1;Array.isArray(a)||c(a)||f(a)?e=a:"number"===typeof a?h=a|0:a&&("data"in a&&(e=a.data),"usage"in a&&(b=A[a.usage]),"type"in a&&(r=E[a.type]),"dimension"in a&&(l=a.dimension|0),"length"in a&&(h=a.length|0));p.bind();e?t(p,e,b,r,l,G):(g.bufferData(p.type,
h,b),p.dtype=r||5121,p.usage=b,p.dimension=l,p.byteLength=h);H.profile&&(p.stats.size=p.byteLength*k[p.dtype]);return L}C.bufferCount++;var p=new l(m);a[p.id]=p;N||L(b);L._reglType="buffer";L._buffer=p;L.subdata=function(a,b){var k=(b||0)|0;p.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var l=z.allocType(p.dtype,a.length);e(l,a);g.bufferSubData(p.type,k,l);z.freeType(l)}else if(Array.isArray(a[0])||c(a[0])){var l=a[0].length,r=z.allocType(p.dtype,a.length*l);n(r,a,l);g.bufferSubData(p.type,
k,r);z.freeType(r)}}else if(c(a))g.bufferSubData(p.type,k,a);else if(f(a)){var m=a.shape,N=a.stride,G=r=l=0,B=0;1===m.length?(l=m[0],r=1,G=N[0],B=0):2===m.length&&(l=m[0],r=m[1],G=N[0],B=N[1]);m=Array.isArray(a.data)?p.dtype:h(a.data);m=z.allocType(m,l*r);x(m,a.data,l,r,G,B,a.offset);g.bufferSubData(p.type,k,m);z.freeType(m)}return L};H.profile&&(L.stats=p.stats);L.destroy=function(){B(p)};return L},createStream:function(a,c){var b=N.pop();b||(b=new l(a));b.bind();t(b,c,35040,0,1,!1);return b},destroyStream:function(a){N.push(a)},
clear:function(){b(a).forEach(B);N.forEach(B)},getBuffer:function(a){return a&&a._buffer instanceof l?a._buffer:null},restore:function(){b(a).forEach(function(a){a.buffer=g.createBuffer();g.bindBuffer(a.type,a.buffer);g.bufferData(a.type,a.persistentData||a.byteLength,a.usage)})},_initBuffer:t}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],4:[function(g,t,p){t.exports=
{"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(g,t,p){t.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(g,t,p){t.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,
triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(g,t,p){t.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(g,t,p){function h(a){return Array.isArray(a)||L(a)||E(a)}function e(a){return a.sort(function(a,c){return"viewport"===a?-1:"viewport"===c?1:a<c?-1:1})}function x(a,c,b,f){this.thisDep=a;this.contextDep=c;this.propDep=b;this.append=f}function n(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function c(a){return new x(!1,!1,!1,a)}function f(a,
c){var b=a.type;return 0===b?(b=a.data.length,new x(!0,1<=b,2<=b,c)):4===b?(b=a.data,new x(b.thisDep,b.contextDep,b.propDep,c)):new x(3===b,2===b,1===b,c)}var b=g("./util/codegen"),z=g("./util/loop"),L=g("./util/is-typed-array"),E=g("./util/is-ndarray"),A=g("./util/is-array-like"),k=g("./dynamic"),F=g("./constants/primitives.json"),C=g("./constants/dtypes.json"),H=["x","y","z","w"],l="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),
m={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},O={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},
B={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},G={cw:2304,ccw:2305},a=new x(!1,!1,!1,function(){});t.exports=function(g,t,p,L,E,P,Ba,Q,J,na,ta,r,U,ba,ja){function X(q){return q.replace(".","_")}function M(q,d,a){var b=X(q);Ha.push(q);Ca[b]=ua[b]=!!a;va[b]=d}function D(q,d,a){var b=X(q);Ha.push(q);Array.isArray(a)?(ua[b]=a.slice(),Ca[b]=a.slice()):ua[b]=Ca[b]=a;wa[b]=d}function xa(){var q=b(),a=q.link,d=q.global;q.id=Na++;
q.batchId="0";var c=a(Ma),f=q.shared={props:"a0"};Object.keys(Ma).forEach(function(w){f[w]=d.def(c,".",w)});var e=q.next={},S=q.current={};Object.keys(wa).forEach(function(w){Array.isArray(ua[w])&&(e[w]=d.def(f.next,".",w),S[w]=d.def(f.current,".",w))});var Oa=q.constants={};Object.keys(Ia).forEach(function(w){Oa[w]=d.def(JSON.stringify(Ia[w]))});q.invoke=function(w,d){switch(d.type){case 0:var b=["this",f.context,f.props,q.batchId];return w.def(a(d.data),".call(",b.slice(0,Math.max(d.data.length+
1,4)),")");case 1:return w.def(f.props,d.data);case 2:return w.def(f.context,d.data);case 3:return w.def("this",d.data);case 4:return d.data.append(q,w),d.data.ref}};q.attribCache={};var w={};q.scopeAttrib=function(d){d=t.id(d);if(d in w)return w[d];var q=na.scope[d];q||(q=na.scope[d]=new v);return w[d]=a(q)};return q}function oa(d){var a=d["static"];d=d.dynamic;var b;if("profile"in a){var e=!!a.profile;b=c(function(d,a){return e});b.enable=e}else if("profile"in d){var v=d.profile;b=f(v,function(d,
a){return d.invoke(a,v)})}return b}function ya(d,a){var b=d["static"],e=d.dynamic;if("framebuffer"in b){var v=b.framebuffer;return v?(v=Q.getFramebuffer(v),c(function(d,a){var w=d.link(v),q=d.shared;a.set(q.framebuffer,".next",w);q=q.context;a.set(q,".framebufferWidth",w+".width");a.set(q,".framebufferHeight",w+".height");return w})):c(function(d,a){var w=d.shared;a.set(w.framebuffer,".next","null");w=w.context;a.set(w,".framebufferWidth",w+".drawingBufferWidth");a.set(w,".framebufferHeight",w+".drawingBufferHeight");
return"null"})}if("framebuffer"in e){var u=e.framebuffer;return f(u,function(d,a){var w=d.invoke(a,u),q=d.shared,W=q.framebuffer,w=a.def(W,".getFramebuffer(",w,")");a.set(W,".next",w);q=q.context;a.set(q,".framebufferWidth",w+"?"+w+".width:"+q+".drawingBufferWidth");a.set(q,".framebufferHeight",w+"?"+w+".height:"+q+".drawingBufferHeight");return w})}return null}function T(d,a,b){function c(d){if(d in e){var w=e[d];d=!0;var q=w.x|0,W=w.y|0,b,S;"width"in w?b=w.width|0:d=!1;"height"in w?S=w.height|0:
d=!1;return new x(!d&&a&&a.thisDep,!d&&a&&a.contextDep,!d&&a&&a.propDep,function(d,a){var y=d.shared.context,c=b;"width"in w||(c=a.def(y,".","framebufferWidth","-",q));var f=S;"height"in w||(f=a.def(y,".","framebufferHeight","-",W));return[q,W,c,f]})}if(d in v){var u=v[d];d=f(u,function(d,a){var w=d.invoke(a,u),q=d.shared.context,W=a.def(w,".x|0"),b=a.def(w,".y|0"),y=a.def('"width" in ',w,"?",w,".width|0:","(",q,".","framebufferWidth","-",W,")"),w=a.def('"height" in ',w,"?",w,".height|0:","(",q,".",
"framebufferHeight","-",b,")");return[W,b,y,w]});a&&(d.thisDep=d.thisDep||a.thisDep,d.contextDep=d.contextDep||a.contextDep,d.propDep=d.propDep||a.propDep);return d}return a?new x(a.thisDep,a.contextDep,a.propDep,function(d,a){var w=d.shared.context;return[0,0,a.def(w,".","framebufferWidth"),a.def(w,".","framebufferHeight")]}):null}var e=d["static"],v=d.dynamic;if(d=c("viewport")){var S=d;d=new x(d.thisDep,d.contextDep,d.propDep,function(d,a){var q=S.append(d,a),W=d.shared.context;a.set(W,".viewportWidth",
q[2]);a.set(W,".viewportHeight",q[3]);return q})}return{viewport:d,scissor_box:c("scissor.box")}}function ea(d){function a(d){if(d in b){var w=t.id(b[d]);d=c(function(){return w});d.id=w;return d}if(d in e){var q=e[d];return f(q,function(d,a){var w=d.invoke(a,q);return a.def(d.shared.strings,".id(",w,")")})}return null}var b=d["static"],e=d.dynamic,v=a("frag"),u=a("vert"),S=null;n(v)&&n(u)?(S=ta.program(u.id,v.id),d=c(function(d,a){return d.link(S)})):d=new x(v&&v.thisDep||u&&u.thisDep,v&&v.contextDep||
u&&u.contextDep,v&&v.propDep||u&&u.propDep,function(d,a){var q=d.shared.shader,b;b=v?v.append(d,a):a.def(q,".","frag");var y;y=u?u.append(d,a):a.def(q,".","vert");return a.def(q+".program("+y+","+b+")")});return{frag:v,vert:u,progVar:d,program:S}}function fa(d,a){function b(d,a){if(d in e){var q=e[d]|0;return c(function(d,b){a&&(d.OFFSET=q);return q})}if(d in v){var W=v[d];return f(W,function(d,q){var b=d.invoke(q,W);a&&(d.OFFSET=b);return b})}return a&&u?c(function(d,a){d.OFFSET="0";return 0}):null}
var e=d["static"],v=d.dynamic,u=function(){if("elements"in e){var d=e.elements;h(d)?d=P.getElements(P.create(d,!0)):d&&(d=P.getElements(d));var a=c(function(a,w){if(d){var q=a.link(d);return a.ELEMENTS=q}return a.ELEMENTS=null});a.value=d;return a}if("elements"in v){var q=v.elements;return f(q,function(d,a){var w=d.shared,b=w.isBufferArgs,w=w.elements,y=d.invoke(a,q),c=a.def("null"),b=a.def(b,"(",y,")"),y=d.cond(b).then(c,"=",w,".createStream(",y,");")["else"](c,"=",w,".getElements(",y,");");a.entry(y);
a.exit(d.cond(b).then(w,".destroyStream(",c,");"));return d.ELEMENTS=c})}return null}(),S=b("offset",!0);return{elements:u,primitive:function(){if("primitive"in e){var d=e.primitive;return c(function(a,w){return F[d]})}if("primitive"in v){var a=v.primitive;return f(a,function(d,q){var b=d.constants.primTypes,y=d.invoke(q,a);return q.def(b,"[",y,"]")})}return u?n(u)?u.value?c(function(d,a){return a.def(d.ELEMENTS,".primType")}):c(function(){return 4}):new x(u.thisDep,u.contextDep,u.propDep,function(d,
a){var w=d.ELEMENTS;return a.def(w,"?",w,".primType:",4)}):null}(),count:function(){if("count"in e){var d=e.count|0;return c(function(){return d})}if("count"in v){var a=v.count;return f(a,function(d,q){return d.invoke(q,a)})}return u?n(u)?u?S?new x(S.thisDep,S.contextDep,S.propDep,function(d,a){return a.def(d.ELEMENTS,".vertCount-",d.OFFSET)}):c(function(d,a){return a.def(d.ELEMENTS,".vertCount")}):c(function(){return-1}):new x(u.thisDep||S.thisDep,u.contextDep||S.contextDep,u.propDep||S.propDep,
function(d,a){var w=d.ELEMENTS;return d.OFFSET?a.def(w,"?",w,".vertCount-",d.OFFSET,":-1"):a.def(w,"?",w,".vertCount:-1")}):null}(),instances:b("instances",!1),offset:S}}function qa(d,a){var b=d["static"],e=d.dynamic,v={};Ha.forEach(function(d){function a(w,y){if(d in b){var W=w(b[d]);v[q]=c(function(){return W})}else if(d in e){var u=e[d];v[q]=f(u,function(d,a){return y(d,a,d.invoke(a,u))})}}var q=X(d);switch(d){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return a(function(d){return d},
function(d,a,q){return q});case "depth.func":return a(function(d){return O[d]},function(d,a,q){return a.def(d.constants.compareFuncs,"[",q,"]")});case "depth.range":return a(function(d){return d},function(d,a,q){d=a.def("+",q,"[0]");a=a.def("+",q,"[1]");return[d,a]});case "blend.func":return a(function(d){return[m["srcRGB"in d?d.srcRGB:d.src],m["dstRGB"in d?d.dstRGB:d.dst],m["srcAlpha"in d?d.srcAlpha:d.src],m["dstAlpha"in d?d.dstAlpha:d.dst]]},function(d,a,q){function b(d,w){return a.def('"',d,w,
'" in ',q,"?",q,".",d,w,":",q,".",d)}d=d.constants.blendFuncs;var y=b("src","RGB"),c=b("dst","RGB"),y=a.def(d,"[",y,"]"),e=a.def(d,"[",b("src","Alpha"),"]"),c=a.def(d,"[",c,"]");d=a.def(d,"[",b("dst","Alpha"),"]");return[y,c,e,d]});case "blend.equation":return a(function(d){if("string"===typeof d)return[I[d],I[d]];if("object"===typeof d)return[I[d.rgb],I[d.alpha]]},function(d,a,q){var b=d.constants.blendEquations,y=a.def(),c=a.def();d=d.cond("typeof ",q,'==="string"');d.then(y,"=",c,"=",b,"[",q,"];");
d["else"](y,"=",b,"[",q,".rgb];",c,"=",b,"[",q,".alpha];");a(d);return[y,c]});case "blend.color":return a(function(d){return z(4,function(a){return+d[a]})},function(d,a,q){return z(4,function(d){return a.def("+",q,"[",d,"]")})});case "stencil.mask":return a(function(d){return d|0},function(d,a,q){return a.def(q,"|0")});case "stencil.func":return a(function(d){return[O[d.cmp||"keep"],d.ref||0,"mask"in d?d.mask:-1]},function(d,a,q){d=a.def('"cmp" in ',q,"?",d.constants.compareFuncs,"[",q,".cmp]",":",
7680);var b=a.def(q,".ref|0");a=a.def('"mask" in ',q,"?",q,".mask|0:-1");return[d,b,a]});case "stencil.opFront":case "stencil.opBack":return a(function(a){return["stencil.opBack"===d?1029:1028,B[a.fail||"keep"],B[a.zfail||"keep"],B[a.zpass||"keep"]]},function(a,q,b){function y(d){return q.def('"',d,'" in ',b,"?",c,"[",b,".",d,"]:",7680)}var c=a.constants.stencilOps;return["stencil.opBack"===d?1029:1028,y("fail"),y("zfail"),y("zpass")]});case "polygonOffset.offset":return a(function(d){return[d.factor|
0,d.units|0]},function(d,a,q){d=a.def(q,".factor|0");a=a.def(q,".units|0");return[d,a]});case "cull.face":return a(function(d){var a=0;"front"===d?a=1028:"back"===d&&(a=1029);return a},function(d,a,q){return a.def(q,'==="front"?',1028,":",1029)});case "lineWidth":return a(function(d){return d},function(d,a,q){return q});case "frontFace":return a(function(d){return G[d]},function(d,a,q){return a.def(q+'==="cw"?2304:2305')});case "colorMask":return a(function(d){return d.map(function(d){return!!d})},
function(d,a,q){return z(4,function(d){return"!!"+q+"["+d+"]"})});case "sample.coverage":return a(function(d){return["value"in d?d.value:1,!!d.invert]},function(d,a,q){d=a.def('"value" in ',q,"?+",q,".value:1");a=a.def("!!",q,".invert");return[d,a]})}});return v}function ga(d,a){var b=d["static"],e=d.dynamic,v={};Object.keys(b).forEach(function(d){var a=b[d],q;if("number"===typeof a||"boolean"===typeof a)q=c(function(){return a});else if("function"===typeof a){var y=a._reglType;if("texture2d"===y||
"textureCube"===y)q=c(function(d){return d.link(a)});else if("framebuffer"===y||"framebufferCube"===y)q=c(function(d){return d.link(a.color[0])})}else A(a)&&(q=c(function(d){return d.global.def("[",z(a.length,function(d){return a[d]}),"]")}));q.value=a;v[d]=q});Object.keys(e).forEach(function(d){var a=e[d];v[d]=f(a,function(d,q){return d.invoke(q,a)})});return v}function Y(d,a){var b=d["static"],e=d.dynamic,u={};Object.keys(b).forEach(function(d){var a=b[d],q=t.id(d),y=new v;if(h(a))y.state=1,y.buffer=
E.getBuffer(E.create(a,34962,!1,!0)),y.type=y.buffer.dtype;else{var e=E.getBuffer(a);if(e)y.state=1,y.buffer=e,y.type=e.dtype;else if(a.constant){var f=a.constant;y.buffer="null";y.state=2;"number"===typeof f?y.x=f:H.forEach(function(d,a){a<f.length&&(y[d]=f[a])})}else{var e=h(a.buffer)?E.getBuffer(E.create(a.buffer,34962,!1,!0)):E.getBuffer(a.buffer),k=a.offset|0,l=a.stride|0,r=a.size|0,m=!!a.normalized,g=0;"type"in a&&(g=C[a.type]);a=a.divisor|0;y.buffer=e;y.state=1;y.size=r;y.normalized=m;y.type=
g||e.dtype;y.offset=k;y.stride=l;y.divisor=a}}u[d]=c(function(d,a){var b=d.attribCache;if(q in b)return b[q];var c={isStream:!1};Object.keys(y).forEach(function(d){c[d]=y[d]});y.buffer&&(c.buffer=d.link(y.buffer));return b[q]=c})});Object.keys(e).forEach(function(d){var a=e[d];u[d]=f(a,function(d,q){function b(d){q(f[d],"=",y,".",d,"|0;")}var y=d.invoke(q,a),c=d.shared,e=c.isBufferArgs,u=c.buffer,f={isStream:q.def(!1)},k=new v;k.state=1;Object.keys(k).forEach(function(d){f[d]=q.def(""+k[d])});var l=
f.buffer,r=f.type;q("if(",e,"(",y,")){",f.isStream,"=true;",l,"=",u,".createStream(",34962,",",y,");",r,"=",l,".dtype;","}else{",l,"=",u,".getBuffer(",y,");","if(",l,"){",r,"=",l,".dtype;",'}else if("constant" in ',y,"){",f.state,"=",2,";","if(typeof "+y+'.constant === "number"){',f[H[0]],"=",y,".constant;",H.slice(1).map(function(d){return f[d]}).join("="),"=0;","}else{",H.map(function(d,a){return f[d]+"="+y+".constant.length>="+a+"?"+y+".constant["+a+"]:0;"}).join(""),"}}else{","if(",e,"(",y,".buffer)){",
l,"=",u,".createStream(",34962,",",y,".buffer);","}else{",l,"=",u,".getBuffer(",y,".buffer);","}",r,'="type" in ',y,"?",c.glTypes,"[",y,".type]:",l,".dtype;",f.normalized,"=!!",y,".normalized;");b("size");b("offset");b("stride");b("divisor");q("}}");q.exit("if(",f.isStream,"){",u,".destroyStream(",l,");","}");return f})});return u}function ra(d){var a=d["static"],b=d.dynamic,e={};Object.keys(a).forEach(function(d){var q=a[d];e[d]=c(function(d,a){return"number"===typeof q||"boolean"===typeof q?""+
q:d.link(q)})});Object.keys(b).forEach(function(d){var a=b[d];e[d]=f(a,function(d,q){return d.invoke(q,a)})});return e}function pa(d,a,b,c,e){var f=ya(d,e),u=T(d,f,e),v=fa(d,e),w=qa(d,e),l=ea(d,e),k=u.viewport;k&&(w.viewport=k);k=X("scissor.box");(u=u[k])&&(w[k]=u);u=0<Object.keys(w).length;f={framebuffer:f,draw:v,shader:l,state:w,dirty:u};f.profile=oa(d,e);f.uniforms=ga(b,e);f.attributes=Y(a,e);f.context=ra(c,e);return f}function K(d,a,b){var c=d.shared.context,e=d.scope();Object.keys(b).forEach(function(f){a.save(c,
"."+f);e(c,".",f,"=",b[f].append(d,a),";")});a(e)}function ha(d,a,b,c){var e=d.shared,f=e.gl,u=e.framebuffer,v;Ja&&(v=a.def(e.extensions,".webgl_draw_buffers"));var w=d.constants,e=w.drawBuffer,w=w.backBuffer;d=b?b.append(d,a):a.def(u,".next");c||a("if(",d,"!==",u,".cur){");a("if(",d,"){",f,".bindFramebuffer(",36160,",",d,".framebuffer);");Ja&&a(v,".drawBuffersWEBGL(",e,"[",d,".colorAttachments.length]);");a("}else{",f,".bindFramebuffer(",36160,",null);");Ja&&a(v,".drawBuffersWEBGL(",w,");");a("}",
u,".cur=",d,";");c||a("}")}function ka(d,a,b){var c=d.shared,e=c.gl,f=d.current,u=d.next,v=c.current,w=c.next,k=d.cond(v,".dirty");Ha.forEach(function(a){a=X(a);if(!(a in b.state)){var y,c;if(a in u){y=u[a];c=f[a];var l=z(ua[a].length,function(d){return k.def(y,"[",d,"]")});k(d.cond(l.map(function(d,a){return d+"!=="+c+"["+a+"]"}).join("||")).then(e,".",wa[a],"(",l,");",l.map(function(d,a){return c+"["+a+"]="+d}).join(";"),";"))}else y=k.def(w,".",a),l=d.cond(y,"!==",v,".",a),k(l),a in va?l(d.cond(y).then(e,
".enable(",va[a],");")["else"](e,".disable(",va[a],");"),v,".",a,"=",y,";"):l(e,".",wa[a],"(",y,");",v,".",a,"=",y,";")}});0===Object.keys(b.state).length&&k(v,".dirty=false;");a(k)}function R(d,a,b,c){var f=d.shared,u=d.current,v=f.current,k=f.gl;e(Object.keys(b)).forEach(function(e){var f=b[e];if(!c||c(f)){var l=f.append(d,a);if(va[e]){var r=va[e];n(f)?l?a(k,".enable(",r,");"):a(k,".disable(",r,");"):a(d.cond(l).then(k,".enable(",r,");")["else"](k,".disable(",r,");"));a(v,".",e,"=",l,";")}else if(A(l)){var m=
u[e];a(k,".",wa[e],"(",l,");",l.map(function(d,a){return m+"["+a+"]="+d}).join(";"),";")}else a(k,".",wa[e],"(",l,");",v,".",e,"=",l,";")}})}function V(d,a){Da&&!d.instancing&&(d.instancing=a.def(d.shared.extensions,".angle_instanced_arrays"))}function Z(d,a,b,c,e){function f(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function u(d){g=a.def();d(g,"=",f(),";");"string"===typeof e?d(r,".count+=",e,";"):d(r,".count++;");ba&&(c?(I=a.def(),d(I,"=",h,".getNumPendingQueries();")):
d(h,".beginQuery(",r,");"))}function v(d){d(r,".cpuTime+=",f(),"-",g,";");ba&&(c?d(h,".pushScopeStats(",I,",",h,".getNumPendingQueries(),",r,");"):d(h,".endQuery();"))}function l(d){var b=a.def(m,".profile");a(m,".profile=",d,";");a.exit(m,".profile=",b,";")}var k=d.shared,r=d.stats,m=k.current,h=k.timer;b=b.profile;var g,I;if(b){if(n(b)){b.enable?(u(a),v(a.exit),l("true")):l("false");return}b=b.append(d,a);l(b)}else b=a.def(m,".profile");k=d.block();u(k);a("if(",b,"){",k,"}");d=d.block();v(d);a.exit("if(",
b,"){",d,"}")}function aa(d,b,c,e,f){function u(d){switch(d){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function k(a,c,e){function f(){b("if(!",m,".buffer){",v,".enableVertexAttribArray(",r,");}");var a=e.type,u;u=e.size?b.def(e.size,"||",c):c;b("if(",m,".type!==",a,"||",m,".size!==",u,"||",I.map(function(d){return m+"."+d+"!=="+e[d]}).join("||"),"){",v,".bindBuffer(",34962,",",h,".buffer);",v,".vertexAttribPointer(",
[r,u,a,e.normalized,e.stride,e.offset],");",m,".type=",a,";",m,".size=",u,";",I.map(function(d){return m+"."+d+"="+e[d]+";"}).join(""),"}");Da&&(a=e.divisor,b("if(",m,".divisor!==",a,"){",d.instancing,".vertexAttribDivisorANGLE(",[r,a],");",m,".divisor=",a,";}"))}function u(){b("if(",m,".buffer){",v,".disableVertexAttribArray(",r,");","}if(",H.map(function(d,a){return m+"."+d+"!=="+g[a]}).join("||"),"){",v,".vertexAttrib4f(",r,",",g,");",H.map(function(d,a){return m+"."+d+"="+g[a]+";"}).join(""),
"}")}var v=l.gl,r=b.def(a,".location"),m=b.def(l.attributes,"[",r,"]");a=e.state;var h=e.buffer,g=[e.x,e.y,e.z,e.w],I=["buffer","normalized","offset","stride"];1===a?f():2===a?u():(b("if(",a,"===",1,"){"),f(),b("}else{"),u(),b("}"))}var l=d.shared;e.forEach(function(e){var l=e.name,r=c.attributes[l],m;if(r){if(!f(r))return;m=r.append(d,b)}else{if(!f(a))return;var h=d.scopeAttrib(l);m={};Object.keys(new v).forEach(function(d){m[d]=b.def(h,".",d)})}k(d.link(e),u(e.info.type),m)})}function ca(d,b,e,
c,f){for(var u=d.shared,v=u.gl,l,k=0;k<c.length;++k){var r=c[k],m=r.name,h=r.info.type,g=e.uniforms[m],r=d.link(r)+".location",I;if(g){if(!f(g))continue;if(n(g)){m=g.value;if(35678===h||35680===h)h=d.link(m._texture||m.color[0]._texture),b(v,".uniform1i(",r,",",h+".bind());"),b.exit(h,".unbind();");else if(35674===h||35675===h||35676===h)m=d.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])"),g=2,35675===h?g=3:35676===h&&(g=4),b(v,".uniformMatrix",g,"fv(",r,",false,",m,");");else{switch(h){case 5126:l=
"1f";break;case 35664:l="2f";break;case 35665:l="3f";break;case 35666:l="4f";break;case 35670:l="1i";break;case 5124:l="1i";break;case 35671:l="2i";break;case 35667:l="2i";break;case 35672:l="3i";break;case 35668:l="3i";break;case 35673:l="4i";break;case 35669:l="4i"}b(v,".uniform",l,"(",r,",",A(m)?Array.prototype.slice.call(m):m,");")}continue}else I=g.append(d,b)}else{if(!f(a))continue;I=b.def(u.uniforms,"[",t.id(m),"]")}35678===h?b("if(",I,"&&",I,'._reglType==="framebuffer"){',I,"=",I,".color[0];",
"}"):35680===h&&b("if(",I,"&&",I,'._reglType==="framebufferCube"){',I,"=",I,".color[0];","}");m=1;switch(h){case 35678:case 35680:h=b.def(I,"._texture");b(v,".uniform1i(",r,",",h,".bind());");b.exit(h,".unbind();");continue;case 5124:case 35670:l="1i";break;case 35667:case 35671:l="2i";m=2;break;case 35668:case 35672:l="3i";m=3;break;case 35669:case 35673:l="4i";m=4;break;case 5126:l="1f";break;case 35664:l="2f";m=2;break;case 35665:l="3f";m=3;break;case 35666:l="4f";m=4;break;case 35674:l="Matrix2fv";
break;case 35675:l="Matrix3fv";break;case 35676:l="Matrix4fv"}b(v,".uniform",l,"(",r,",");if("M"===l.charAt(0)){var r=Math.pow(h-35674+2,2),x=d.global.def("new Float32Array(",r,")");b("false,(Array.isArray(",I,")||",I," instanceof Float32Array)?",I,":(",z(r,function(d){return x+"["+d+"]="+I+"["+d+"]"}),",",x,")")}else 1<m?b(z(m,function(d){return I+"["+d+"]"})):b(I);b(");")}}function ia(d,a,b,e){function c(f){var u=m[f];return u?u.contextDep&&e.contextDynamic||u.propDep?u.append(d,b):u.append(d,a):
a.def(k,".",f)}function f(){function d(){b(U,".drawElementsInstancedANGLE(",[h,I,J,g+"<<(("+J+"-5121)>>1)",x],");")}function a(){b(U,".drawArraysInstancedANGLE(",[h,g,I,x],");")}r?z?d():(b("if(",r,"){"),d(),b("}else{"),a(),b("}")):a()}function u(){function d(){b(l+".drawElements("+[h,I,J,g+"<<(("+J+"-5121)>>1)"]+");")}function a(){b(l+".drawArrays("+[h,g,I]+");")}r?z?d():(b("if(",r,"){"),d(),b("}else{"),a(),b("}")):a()}var v=d.shared,l=v.gl,k=v.draw,m=e.draw,r=function(){var c=m.elements,f=a;if(c){if(c.contextDep&&
e.contextDynamic||c.propDep)f=b;c=c.append(d,f)}else c=f.def(k,".","elements");c&&f("if("+c+")"+l+".bindBuffer(34963,"+c+".buffer.buffer);");return c}(),h=c("primitive"),g=c("offset"),I=function(){var c=m.count,f=a;if(c){if(c.contextDep&&e.contextDynamic||c.propDep)f=b;c=c.append(d,f)}else c=f.def(k,".","count");return c}();if("number"===typeof I){if(0===I)return}else b("if(",I,"){"),b.exit("}");var x,U;Da&&(x=c("instances"),U=d.instancing);var J=r+".type",z=m.elements&&n(m.elements);Da&&("number"!==
typeof x||0<=x)?"string"===typeof x?(b("if(",x,">0){"),f(),b("}else if(",x,"<0){"),u(),b("}")):f():u()}function da(d,a,b,c,e){a=xa();e=a.proc("body",e);Da&&(a.instancing=e.def(a.shared.extensions,".angle_instanced_arrays"));d(a,e,b,c);return a.compile().body}function Ea(d,a,b,c){V(d,a);aa(d,a,b,c.attributes,function(){return!0});ca(d,a,b,c.uniforms,function(){return!0});ia(d,a,a,b)}function Ka(d,a){var b=d.proc("draw",1);V(d,b);K(d,b,a.context);ha(d,b,a.framebuffer);ka(d,b,a);R(d,b,a.state);Z(d,b,
a,!1,!0);var c=a.shader.progVar.append(d,b);b(d.shared.gl,".useProgram(",c,".program);");if(a.shader.program)Ea(d,b,a,a.shader.program);else{var e=d.global.def("{}"),f=b.def(c,".id"),u=b.def(e,"[",f,"]");b(d.cond(u).then(u,".call(this,a0);")["else"](u,"=",e,"[",f,"]=",d.link(function(b){return da(Ea,d,a,b,1)}),"(",c,");",u,".call(this,a0);"))}0<Object.keys(a.state).length&&b(d.shared.current,".dirty=true;")}function La(d,a,b,c){function e(){return!0}d.batchId="a1";V(d,a);aa(d,a,b,c.attributes,e);
ca(d,a,b,c.uniforms,e);ia(d,a,a,b)}function la(d,a,b,c){function e(d){return d.contextDep&&u||d.propDep}function f(d){return!e(d)}V(d,a);var u=b.contextDep,v=a.def(),l=a.def();d.shared.props=l;d.batchId=v;var m=d.scope(),k=d.scope();a(m.entry,"for(",v,"=0;",v,"<","a1",";++",v,"){",l,"=","a0","[",v,"];",k,"}",m.exit);b.needsContext&&K(d,k,b.context);b.needsFramebuffer&&ha(d,k,b.framebuffer);R(d,k,b.state,e);b.profile&&e(b.profile)&&Z(d,k,b,!1,!0);c?(aa(d,m,b,c.attributes,f),aa(d,k,b,c.attributes,e),
ca(d,m,b,c.uniforms,f),ca(d,k,b,c.uniforms,e),ia(d,m,k,b)):(a=d.global.def("{}"),c=b.shader.progVar.append(d,k),l=k.def(c,".id"),m=k.def(a,"[",l,"]"),k(d.shared.gl,".useProgram(",c,".program);","if(!",m,"){",m,"=",a,"[",l,"]=",d.link(function(a){return da(La,d,b,a,2)}),"(",c,");}",m,".call(this,a0[",v,"],",v,");"))}function Fa(d,a){function b(d){return d.contextDep&&e||d.propDep}var c=d.proc("batch",2);d.batchId="0";V(d,c);var e=!1,f=!0;Object.keys(a.context).forEach(function(d){e=e||a.context[d].propDep});
e||(K(d,c,a.context),f=!1);var u=a.framebuffer,v=!1;u?(u.propDep?e=v=!0:u.contextDep&&e&&(v=!0),v||ha(d,c,u)):ha(d,c,null);a.state.viewport&&a.state.viewport.propDep&&(e=!0);ka(d,c,a);R(d,c,a.state,function(d){return!b(d)});a.profile&&b(a.profile)||Z(d,c,a,!1,"a1");a.contextDep=e;a.needsContext=f;a.needsFramebuffer=v;f=a.shader.progVar;if(f.contextDep&&e||f.propDep)la(d,c,a,null);else if(f=f.append(d,c),c(d.shared.gl,".useProgram(",f,".program);"),a.shader.program)la(d,c,a,a.shader.program);else{var u=
d.global.def("{}"),v=c.def(f,".id"),l=c.def(u,"[",v,"]");c(d.cond(l).then(l,".call(this,a0,a1);")["else"](l,"=",u,"[",v,"]=",d.link(function(b){return da(la,d,a,b,2)}),"(",f,");",l,".call(this,a0,a1);"))}0<Object.keys(a.state).length&&c(d.shared.current,".dirty=true;")}function Aa(d,a){function b(e){var u=a.shader[e];u&&c.set(f.shader,"."+e,u.append(d,c))}var c=d.proc("scope",3);d.batchId="a2";var f=d.shared,u=f.current;K(d,c,a.context);a.framebuffer&&a.framebuffer.append(d,c);e(Object.keys(a.state)).forEach(function(b){var e=
a.state[b].append(d,c);A(e)?e.forEach(function(a,e){c.set(d.next[b],"["+e+"]",a)}):c.set(f.next,"."+b,e)});Z(d,c,a,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(b){var e=a.draw[b];e&&c.set(f.draw,"."+b,""+e.append(d,c))});Object.keys(a.uniforms).forEach(function(b){c.set(f.uniforms,"["+t.id(b)+"]",a.uniforms[b].append(d,c))});Object.keys(a.attributes).forEach(function(b){var e=a.attributes[b].append(d,c),f=d.scopeAttrib(b);Object.keys(new v).forEach(function(d){c.set(f,
"."+d,e[d])})});b("vert");b("frag");0<Object.keys(a.state).length&&(c(u,".dirty=true;"),c.exit(u,".dirty=true;"));c("a1(",d.shared.context,",a0,",d.batchId,");")}function d(d){if("object"===typeof d&&!A(d)){for(var a=Object.keys(d),b=0;b<a.length;++b)if(k.isDynamic(d[a[b]]))return!0;return!1}}function u(a,b,c){function e(d,a){l.forEach(function(b){var c=u[b];k.isDynamic(c)&&(c=d.invoke(a,c),a(g,".",b,"=",c,";"))})}var u=b["static"][c];if(u&&d(u)){var v=a.global,l=Object.keys(u),m=!1,r=!1,h=!1,g=a.global.def("{}");
l.forEach(function(d){var b=u[d];if(k.isDynamic(b))"function"===typeof b&&(b=u[d]=k.unbox(b)),d=f(b,null),m=m||d.thisDep,h=h||d.propDep,r=r||d.contextDep;else{v(g,".",d,"=");switch(typeof b){case "number":v(b);break;case "string":v('"',b,'"');break;case "object":Array.isArray(b)&&v("[",b.join(),"]");break;default:v(a.link(b))}v(";")}});b.dynamic[c]=new k.DynamicVariable(4,{thisDep:m,contextDep:r,propDep:h,ref:g,append:e});delete b["static"][c]}}var v=na.Record,I={add:32774,subtract:32778,"reverse subtract":32779};
p.ext_blend_minmax&&(I.min=32775,I.max=32776);var Da=p.angle_instanced_arrays,Ja=p.webgl_draw_buffers,ua={dirty:!0,profile:ja.profile},Ca={},Ha=[],va={},wa={};M("dither",3024);M("blend.enable",3042);D("blend.color","blendColor",[0,0,0,0]);D("blend.equation","blendEquationSeparate",[32774,32774]);D("blend.func","blendFuncSeparate",[1,0,1,0]);M("depth.enable",2929,!0);D("depth.func","depthFunc",513);D("depth.range","depthRange",[0,1]);D("depth.mask","depthMask",!0);D("colorMask","colorMask",[!0,!0,
!0,!0]);M("cull.enable",2884);D("cull.face","cullFace",1029);D("frontFace","frontFace",2305);D("lineWidth","lineWidth",1);M("polygonOffset.enable",32823);D("polygonOffset.offset","polygonOffset",[0,0]);M("sample.alpha",32926);M("sample.enable",32928);D("sample.coverage","sampleCoverage",[1,!1]);M("stencil.enable",2960);D("stencil.mask","stencilMask",-1);D("stencil.func","stencilFunc",[519,0,-1]);D("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);D("stencil.opBack","stencilOpSeparate",
[1029,7680,7680,7680]);M("scissor.enable",3089);D("scissor.box","scissor",[0,0,g.drawingBufferWidth,g.drawingBufferHeight]);D("viewport","viewport",[0,0,g.drawingBufferWidth,g.drawingBufferHeight]);var Ma={gl:g,context:U,strings:t,next:Ca,current:ua,draw:r,elements:P,buffer:E,shader:ta,attributes:na.state,uniforms:J,framebuffer:Q,extensions:p,timer:ba,isBufferArgs:h},Ia={primTypes:F,compareFuncs:O,blendFuncs:m,blendEquations:I,stencilOps:B,glTypes:C,orientationType:G};Ja&&(Ia.backBuffer=[1029],Ia.drawBuffer=
z(L.maxDrawbuffers,function(d){return 0===d?[0]:z(d,function(d){return 36064+d})}));var Na=0;return{next:Ca,current:ua,procs:function(){var d=xa(),a=d.proc("poll"),b=d.proc("refresh"),c=d.block();a(c);b(c);var e=d.shared,f=e.gl,u=e.next,v=e.current;c(v,".dirty=false;");ha(d,a);ha(d,b,null,!0);var l=g.getExtension("angle_instanced_arrays"),m;l&&(m=d.link(l));for(var k=0;k<L.maxAttributes;++k){var r=b.def(e.attributes,"[",k,"]"),h=d.cond(r,".buffer");h.then(f,".enableVertexAttribArray(",k,");",f,".bindBuffer(",
34962,",",r,".buffer.buffer);",f,".vertexAttribPointer(",k,",",r,".size,",r,".type,",r,".normalized,",r,".stride,",r,".offset);")["else"](f,".disableVertexAttribArray(",k,");",f,".vertexAttrib4f(",k,",",r,".x,",r,".y,",r,".z,",r,".w);",r,".buffer=null;");b(h);l&&b(m,".vertexAttribDivisorANGLE(",k,",",r,".divisor);")}Object.keys(va).forEach(function(e){var l=va[e],k=c.def(u,".",e),r=d.block();r("if(",k,"){",f,".enable(",l,")}else{",f,".disable(",l,")}",v,".",e,"=",k,";");b(r);a("if(",k,"!==",v,".",
e,"){",r,"}")});Object.keys(wa).forEach(function(e){var l=wa[e],k=ua[e],r,m,h=d.block();h(f,".",l,"(");A(k)?(l=k.length,r=d.global.def(u,".",e),m=d.global.def(v,".",e),h(z(l,function(d){return r+"["+d+"]"}),");",z(l,function(d){return m+"["+d+"]="+r+"["+d+"];"}).join("")),a("if(",z(l,function(d){return r+"["+d+"]!=="+m+"["+d+"]"}).join("||"),"){",h,"}")):(r=c.def(u,".",e),m=c.def(v,".",e),h(r,");",v,".",e,"=",r,";"),a("if(",r,"!==",m,"){",h,"}"));b(h)});return d.compile()}(),compile:function(d,a,
b,c,e){var f=xa();f.stats=f.link(e);Object.keys(a["static"]).forEach(function(d){u(f,a,d)});l.forEach(function(a){u(f,d,a)});b=pa(d,a,b,c,f);Ka(f,b);Aa(f,b);Fa(f,b);return f.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],9:[function(g,t,p){function h(c,e){this.id=n++;this.type=c;this.data=e}function e(c){if(0===c.length)return[];var f=c.charAt(0),
b=c.charAt(c.length-1);if(1<c.length&&f===b&&('"'===f||"'"===f))return['"'+c.substr(1,c.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(f=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(c))return e(c.substr(0,f.index)).concat(e(f[1])).concat(e(c.substr(f.index+f[0].length)));f=c.split(".");if(1===f.length)return['"'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];c=[];for(b=0;b<f.length;++b)c=c.concat(e(f[b]));return c}function x(c){return"["+e(c).join("][")+"]"}var n=0;t.exports={DynamicVariable:h,
define:function(c,e){return new h(c,x(e+""))},isDynamic:function(c){return"function"===typeof c&&!c._reglType||c instanceof h},unbox:function(c,e){return"function"===typeof c?new h(0,c):c},accessor:x}},{}],10:[function(g,t,p){var h=g("./util/is-typed-array"),e=g("./util/is-ndarray"),x=g("./util/values"),n=g("./constants/primitives.json"),c=g("./constants/usage.json");t.exports=function(f,b,g,t){function p(b){this.id=C++;F[this.id]=this;this.buffer=b;this.primType=4;this.type=this.vertCount=0}function A(c,
f,l,k,a,x,n){(x=n)||h(f)&&(!e(f)||h(f.data))||(x=b.oes_element_index_uint?5125:5123);c.buffer.bind();g._initBuffer(c.buffer,f,l,x,3);f=n;if(!n){switch(c.buffer.dtype){case 5121:case 5120:f=5121;break;case 5123:case 5122:f=5123;break;case 5125:case 5124:f=5125}c.buffer.dtype=f}c.type=f;0>a&&(a=c.buffer.byteLength,5123===f?a>>=1:5125===f&&(a>>=2));c.vertCount=a;a=k;0>k&&(a=4,k=c.buffer.dimension,1===k&&(a=0),2===k&&(a=1),3===k&&(a=4));c.primType=a}function k(b){t.elementsCount--;delete F[b.id];b.buffer.destroy();
b.buffer=null}var F={},C=0,H={uint8:5121,uint16:5123};b.oes_element_index_uint&&(H.uint32=5125);p.prototype.bind=function(){this.buffer.bind()};var l=[];return{create:function(b,l){function x(b){if(b)if("number"===typeof b)F(b),a.primType=4,a.vertCount=b|0,a.type=5121;else{var l=null,k=35044,m=-1,g=-1,z=0,t=0;Array.isArray(b)||h(b)||e(b)?l=b:("data"in b&&(l=b.data),"usage"in b&&(k=c[b.usage]),"primitive"in b&&(m=n[b.primitive]),"count"in b&&(g=b.count|0),"length"in b&&(z=b.length|0),"type"in b&&(t=
H[b.type]));l?A(a,l,k,m,g,z,t):(b=a.buffer,b.bind(),f.bufferData(34963,z,k),b.dtype=t||5121,b.usage=k,b.dimension=3,b.byteLength=z,a.primType=0>m?4:m,a.vertCount=0>g?0:g,a.type=b.dtype)}else F(),a.primType=4,a.vertCount=0,a.type=5121;return x}var F=g.create(null,34963,!0),a=new p(F._buffer);t.elementsCount++;x(b);x._reglType="elements";x._elements=a;x.subdata=function(a,b){F.subdata(a,b);return x};x.destroy=function(){k(a)};return x},createStream:function(b){var c=l.pop();c||(c=new p(g.create(null,
34963,!0,!1)._buffer));A(c,b,35040,-1,-1,0,0);return c},destroyStream:function(b){l.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof p?b._elements:null},clear:function(){x(F).forEach(k)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],11:[function(g,t,p){t.exports=function(h,e){function g(b){b=b.toLowerCase();var c;try{c=n[b]=h.getExtension(b)}catch(e){}return!!c}for(var n={},
c=0;c<e.extensions.length;++c){var f=e.extensions[c];if(!g(f))return e.onDestroy(),e.onDone('"'+f+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}e.optionalExtensions.forEach(g);return{extensions:n,restore:function(){Object.keys(n).forEach(function(b){if(!g(b))throw Error("(regl): error restoring extension "+b);})}}}},{}],12:[function(g,t,p){var h=g("./util/values"),e=g("./util/extend"),x=[];x[6408]=4;var n=[];n[5121]=1;n[5126]=4;
n[36193]=2;t.exports=function(c,f,b,g,t,p){function A(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var e=a=0;b?(a=b.width,e=b.height):c&&(a=c.width,e=c.height);this.width=a;this.height=e}function k(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function F(a,b,c){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function C(a,b){b?b.texture?c.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,
0):c.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):c.framebufferTexture2D(36160,a,3553,null,0)}function H(a){var b=3553,c=null,e=null,f=a;"object"===typeof a&&(f=a.data,"target"in a&&(b=a.target|0));a=f._reglType;"texture2d"===a?c=f:"textureCube"===a?c=f:"renderbuffer"===a&&(e=f,b=36161);return new A(b,c,e)}function l(a,b,c,e,f){if(c)return a=g.create2D({width:a,height:b,format:e,type:f}),a._texture.refCount=0,new A(3553,a,null);a=t.create({width:a,height:b,format:e});
a._renderbuffer.refCount=0;return new A(36161,null,a)}function m(a){return a&&(a.texture||a.renderbuffer)}function O(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function B(){this.id=Ba++;Q[this.id]=this;this.framebuffer=c.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function G(a){a.colorAttachments.forEach(k);k(a.depthAttachment);k(a.stencilAttachment);k(a.depthStencilAttachment)}
function a(a){c.deleteFramebuffer(a.framebuffer);a.framebuffer=null;p.framebufferCount--;delete Q[a.id]}function N(a){var e;c.bindFramebuffer(36160,a.framebuffer);var f=a.colorAttachments;for(e=0;e<f.length;++e)C(36064+e,f[e]);for(e=f.length;e<b.maxColorAttachments;++e)C(36064+e,null);C(36096,a.depthAttachment);C(36128,a.stencilAttachment);C(33306,a.depthStencilAttachment);c.checkFramebufferStatus(36160);c.bindFramebuffer(36160,ma.next);ma.cur=ma.next;c.getError()}function sa(b,c){function f(a,b){var c,
e=0,h=0,g=!0,z=!0;c=null;var t=!0,p="rgba",B="uint8",A=1,C=null,E=null,L=null,O=!1;if("number"===typeof a)e=a|0,h=b|0||e;else if(a){"shape"in a?(h=a.shape,e=h[0],h=h[1]):("radius"in a&&(e=h=a.radius),"width"in a&&(e=a.width),"height"in a&&(h=a.height));if("color"in a||"colors"in a)c=a.color||a.colors,Array.isArray(c);if(!c){"colorCount"in a&&(A=a.colorCount|0);"colorTexture"in a&&(t=!!a.colorTexture,p="rgba4");if("colorType"in a&&(B=a.colorType,!t))if("half float"===B||"float16"===B)p="rgba16f";else if("float"===
B||"float32"===B)p="rgba32f";"colorFormat"in a&&(p=a.colorFormat,0<=Ga.indexOf(p)?t=!0:0<=za.indexOf(p)&&(t=!1))}if("depthTexture"in a||"depthStencilTexture"in a)O=!(!a.depthTexture&&!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?g=a.depth:(C=a.depth,z=!1));"stencil"in a&&("boolean"===typeof a.stencil?z=a.stencil:(E=a.stencil,g=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?g=z=a.depthStencil:(L=a.depthStencil,z=g=!1))}else e=h=1;var J=null,sa=null,K=null,ma=null;if(Array.isArray(c))J=
c.map(H);else if(c)J=[H(c)];else for(J=Array(A),c=0;c<A;++c)J[c]=l(e,h,t,p,B);e=e||J[0].width;h=h||J[0].height;C?sa=H(C):g&&!z&&(sa=l(e,h,O,"depth","uint32"));E?K=H(E):z&&!g&&(K=l(e,h,!1,"stencil","uint8"));L?ma=H(L):!C&&!E&&z&&g&&(ma=l(e,h,O,"depth stencil","depth stencil"));g=null;for(c=0;c<J.length;++c)F(J[c],e,h),J[c]&&J[c].texture&&(z=x[J[c].texture._texture.format]*n[J[c].texture._texture.type],null===g&&(g=z));F(sa,e,h);F(K,e,h);F(ma,e,h);G(k);k.width=e;k.height=h;k.colorAttachments=J;k.depthAttachment=
sa;k.stencilAttachment=K;k.depthStencilAttachment=ma;f.color=J.map(m);f.depth=m(sa);f.stencil=m(K);f.depthStencil=m(ma);f.width=k.width;f.height=k.height;N(k);return f}var k=new B;p.framebufferCount++;f(b,c);return e(f,{resize:function(a,b){var c=a|0,e=b|0||c;if(c===k.width&&e===k.height)return f;for(var l=k.colorAttachments,h=0;h<l.length;++h)O(l[h],c,e);O(k.depthAttachment,c,e);O(k.stencilAttachment,c,e);O(k.depthStencilAttachment,c,e);k.width=f.width=c;k.height=f.height=e;N(k);return f},_reglType:"framebuffer",
_framebuffer:k,destroy:function(){a(k);G(k)}})}var ma={cur:null,next:null,dirty:!1},Ga=["rgba"],za=["rgba4","rgb565","rgb5 a1"];f.ext_srgb&&za.push("srgba");f.ext_color_buffer_half_float&&za.push("rgba16f","rgb16f");f.webgl_color_buffer_float&&za.push("rgba32f");var P=["uint8"];f.oes_texture_half_float&&P.push("half float","float16");f.oes_texture_float&&P.push("float","float32");var Ba=0,Q={};return e(ma,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,
a instanceof B)?a:null},create:sa,createCube:function(a){function b(a){var f,k={color:null},l=0,h=null;f="rgba";var m="uint8",x=1;if("number"===typeof a)l=a|0;else if(a){"shape"in a?l=a.shape[0]:("radius"in a&&(l=a.radius|0),"width"in a?l=a.width|0:"height"in a&&(l=a.height|0));if("color"in a||"colors"in a)h=a.color||a.colors,Array.isArray(h);h||("colorCount"in a&&(x=a.colorCount|0),"colorType"in a&&(m=a.colorType),"colorFormat"in a&&(f=a.colorFormat));"depth"in a&&(k.depth=a.depth);"stencil"in a&&
(k.stencil=a.stencil);"depthStencil"in a&&(k.depthStencil=a.depthStencil)}else l=1;if(h)if(Array.isArray(h))for(a=[],f=0;f<h.length;++f)a[f]=h[f];else a=[h];else for(a=Array(x),h={radius:l,format:f,type:m},f=0;f<x;++f)a[f]=g.createCube(h);k.color=Array(a.length);for(f=0;f<a.length;++f)x=a[f],l=l||x.width,k.color[f]={target:34069,data:a[f]};for(f=0;6>f;++f){for(x=0;x<a.length;++x)k.color[x].target=34069+f;0<f&&(k.depth=c[0].depth,k.stencil=c[0].stencil,k.depthStencil=c[0].depthStencil);if(c[f])c[f](k);
else c[f]=sa(k)}return e(b,{width:l,height:l,color:a})}var c=Array(6);b(a);return e(b,{faces:c,resize:function(a){var e=a|0;if(e===b.width)return b;var f=b.color;for(a=0;a<f.length;++a)f[a].resize(e);for(a=0;6>a;++a)c[a].resize(e);b.width=b.height=e;return b},_reglType:"framebufferCube",destroy:function(){c.forEach(function(a){a.destroy()})}})},clear:function(){h(Q).forEach(a)},restore:function(){h(Q).forEach(function(a){a.framebuffer=c.createFramebuffer();N(a)})}})}},{"./util/extend":23,"./util/values":31}],
13:[function(g,t,p){t.exports=function(h,e){var g=1;e.ext_texture_filter_anisotropic&&(g=h.getParameter(34047));var n=1,c=1;e.webgl_draw_buffers&&(n=h.getParameter(34852),c=h.getParameter(36063));return{colorBits:[h.getParameter(3410),h.getParameter(3411),h.getParameter(3412),h.getParameter(3413)],depthBits:h.getParameter(3414),stencilBits:h.getParameter(3415),subpixelBits:h.getParameter(3408),extensions:Object.keys(e).filter(function(c){return!!e[c]}),maxAnisotropic:g,maxDrawbuffers:n,maxColorAttachments:c,
pointSizeDims:h.getParameter(33901),lineWidthDims:h.getParameter(33902),maxViewportDims:h.getParameter(3386),maxCombinedTextureUnits:h.getParameter(35661),maxCubeMapSize:h.getParameter(34076),maxRenderbufferSize:h.getParameter(34024),maxTextureUnits:h.getParameter(34930),maxTextureSize:h.getParameter(3379),maxAttributes:h.getParameter(34921),maxVertexUniforms:h.getParameter(36347),maxVertexTextureUnits:h.getParameter(35660),maxVaryingVectors:h.getParameter(36348),maxFragmentUniforms:h.getParameter(36349),
glsl:h.getParameter(35724),renderer:h.getParameter(7937),vendor:h.getParameter(7936),version:h.getParameter(7938)}}},{}],14:[function(g,t,p){var h=g("./util/is-typed-array");t.exports=function(e,g,n,c,f,b){return function(b){var f;f=null===g.next?5121:g.next.colorAttachments[0].texture._texture.type;var t=0,p=0,k=c.framebufferWidth,F=c.framebufferHeight,C=null;h(b)?C=b:b&&(t=b.x|0,p=b.y|0,k=(b.width||c.framebufferWidth-t)|0,F=(b.height||c.framebufferHeight-p)|0,C=b.data||null);n();b=k*F*4;C||(5121===
f?C=new Uint8Array(b):5126===f&&(C=C||new Float32Array(b)));e.pixelStorei(3333,4);e.readPixels(t,p,k,F,6408,f,C);return C}}},{"./util/is-typed-array":26}],15:[function(g,t,p){var h=g("./util/values"),e=[];e[32854]=2;e[32855]=2;e[36194]=2;e[33189]=2;e[36168]=1;e[34041]=4;e[35907]=4;e[34836]=16;e[34842]=8;e[34843]=6;t.exports=function(g,n,c,f,b){function t(c){this.id=A++;this.refCount=1;this.renderbuffer=c;this.format=32854;this.height=this.width=0;b.profile&&(this.stats={size:0})}function p(b){var c=
b.renderbuffer;g.bindRenderbuffer(36161,null);g.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete k[b.id];f.renderbufferCount--}var E={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};n.ext_srgb&&(E.srgba=35907);n.ext_color_buffer_half_float&&(E.rgba16f=34842,E.rgb16f=34843);n.webgl_color_buffer_float&&(E.rgba32f=34836);var A=0,k={};t.prototype.decRef=function(){0>=--this.refCount&&p(this)};b.profile&&(f.getTotalRenderbufferSize=function(){var b=
0;Object.keys(k).forEach(function(c){b+=k[c].stats.size});return b});return{create:function(c,h){function n(c,f){var k=0,h=0,a=32854;"object"===typeof c&&c?("shape"in c?(h=c.shape,k=h[0]|0,h=h[1]|0):("radius"in c&&(k=h=c.radius|0),"width"in c&&(k=c.width|0),"height"in c&&(h=c.height|0)),"format"in c&&(a=E[c.format])):"number"===typeof c?(k=c|0,h="number"===typeof f?f|0:k):c||(k=h=1);if(k!==l.width||h!==l.height||a!==l.format)return n.width=l.width=k,n.height=l.height=h,l.format=a,g.bindRenderbuffer(36161,
l.renderbuffer),g.renderbufferStorage(36161,a,k,h),b.profile&&(l.stats.size=e[l.format]*l.width*l.height),n}var l=new t(g.createRenderbuffer());k[l.id]=l;f.renderbufferCount++;n(c,h);n.resize=function(c,f){var k=c|0,h=f|0||k;if(k===l.width&&h===l.height)return n;n.width=l.width=k;n.height=l.height=h;g.bindRenderbuffer(36161,l.renderbuffer);g.renderbufferStorage(36161,l.format,k,h);b.profile&&(l.stats.size=e[l.format]*l.width*l.height);return n};n._reglType="renderbuffer";n._renderbuffer=l;b.profile&&
(n.stats=l.stats);n.destroy=function(){l.decRef()};return n},clear:function(){h(k).forEach(p)},restore:function(){h(k).forEach(function(b){b.renderbuffer=g.createRenderbuffer();g.bindRenderbuffer(36161,b.renderbuffer);g.renderbufferStorage(36161,b.format,b.width,b.height)});g.bindRenderbuffer(36161,null)}}}},{"./util/values":31}],16:[function(g,t,p){var h=g("./util/values");t.exports=function(e,g,n,c){function f(b,c,e,f){this.name=b;this.id=c;this.location=e;this.info=f}function b(b,c){for(var e=
0;e<b.length;++e)if(b[e].id===c.id){b[e].location=c.location;return}b.push(c)}function t(b,c,f){f=35632===b?A:k;var h=f[c];if(!h){var n=g.str(c),h=e.createShader(b);e.shaderSource(h,n);e.compileShader(h);f[c]=h}return h}function p(b,e){this.id=H++;this.fragId=b;this.vertId=e;this.program=null;this.uniforms=[];this.attributes=[];c.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function E(k,h){var n,p;n=t(35632,k.fragId);p=t(35633,k.vertId);var A=k.program=e.createProgram();e.attachShader(A,
n);e.attachShader(A,p);e.linkProgram(A);var a=e.getProgramParameter(A,35718);c.profile&&(k.stats.uniformsCount=a);var F=k.uniforms;for(n=0;n<a;++n)if(p=e.getActiveUniform(A,n))if(1<p.size)for(var C=0;C<p.size;++C){var E=p.name.replace("[0]","["+C+"]");b(F,new f(E,g.id(E),e.getUniformLocation(A,E),p))}else b(F,new f(p.name,g.id(p.name),e.getUniformLocation(A,p.name),p));a=e.getProgramParameter(A,35721);c.profile&&(k.stats.attributesCount=a);F=k.attributes;for(n=0;n<a;++n)(p=e.getActiveAttrib(A,n))&&
b(F,new f(p.name,g.id(p.name),e.getAttribLocation(A,p.name),p))}var A={},k={},F={},C=[],H=0;c.profile&&(n.getMaxUniformsCount=function(){var b=0;C.forEach(function(c){c.stats.uniformsCount>b&&(b=c.stats.uniformsCount)});return b},n.getMaxAttributesCount=function(){var b=0;C.forEach(function(c){c.stats.attributesCount>b&&(b=c.stats.attributesCount)});return b});return{clear:function(){var b=e.deleteShader.bind(e);h(A).forEach(b);A={};h(k).forEach(b);k={};C.forEach(function(b){e.deleteProgram(b.program)});
C.length=0;F={};n.shaderCount=0},program:function(b,c,e){n.shaderCount++;var f=F[c];f||(f=F[c]={});var k=f[b];k||(k=new p(c,b),E(k,e),f[b]=k,C.push(k));return k},restore:function(){A={};k={};for(var b=0;b<C.length;++b)E(C[b])},shader:t,frag:-1,vert:-1}}},{"./util/values":31}],17:[function(g,t,p){t.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(g,t,p){t.exports=function(){var h=
{"":0},e=[""];return{id:function(g){var n=h[g];if(n)return n;n=h[g]=e.length;e.push(g);return n},str:function(h){return e[h]}}}},{}],19:[function(g,t,p){function h(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function e(a){return Array.isArray(a)&&0!==a.length&&F(a[0])?!0:!1}function x(a){return Object.prototype.toString.call(a)}function n(a){if(!a)return!1;var b=x(a);return 0<=O.indexOf(b)?!0:h(a)||e(a)||E(a)}function c(a,b){36193===a.type?(a.data=k(b),A.freeType(b)):a.data=
b}function f(a,b,c,e,f,k){a="undefined"!==typeof G[a]?G[a]:m[a]*B[b];k&&(a*=6);if(f){for(e=0;1<=c;)e+=a*c*c,c/=2;return e}return a*c*e}var b=g("./util/extend"),z=g("./util/values"),L=g("./util/is-typed-array"),E=g("./util/is-ndarray"),A=g("./util/pool"),k=g("./util/to-half-float"),F=g("./util/is-array-like");p=g("./constants/arraytypes.json");var C=g("./constants/arraytypes.json"),H=[9984,9986,9985,9987],l=[0,6409,6410,6407,6408],m={};m[6409]=m[6406]=m[6402]=1;m[34041]=m[6410]=2;m[6407]=m[35904]=
3;m[6408]=m[35906]=4;var O=Object.keys(p).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),B=[];B[5121]=1;B[5126]=4;B[36193]=2;B[5123]=2;B[5125]=4;var G=[];G[32854]=2;G[32855]=2;G[36194]=2;G[34041]=4;G[33776]=.5;G[33777]=.5;G[33778]=1;G[33779]=1;G[35986]=.5;G[35987]=1;G[34798]=1;G[35840]=.5;G[35841]=.25;G[35842]=.5;G[35843]=.25;G[36196]=.5;t.exports=function(a,g,p,t,G,B,P){function O(){this.format=this.internalformat=
6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function Q(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function J(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=
b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=R[b.colorSpace]);"type"in b&&(a.type=V[b.type]);var c=a.width,e=a.height,f=a.channels,k=!1;"shape"in b?(c=b.shape[0],e=b.shape[1],3===b.shape.length&&(f=b.shape[2],k=!0)):("radius"in b&&(c=e=b.radius),"width"in b&&(c=b.width),"height"in b&&(e=b.height),"channels"in b&&(f=b.channels,k=!0));a.width=c|0;a.height=e|0;a.channels=f|0;c=!1;"format"in b&&(c=b.format,e=a.internalformat=
Z[c],a.format=da[e],c in V&&!("type"in b)&&(a.type=V[c]),c in aa&&(a.compressed=!0),c=!0);!k&&c?a.channels=m[a.format]:k&&!c&&a.channels!==l[a.format]&&(a.format=a.internalformat=l[a.channels])}}function na(d){a.pixelStorei(37440,d.flipY);a.pixelStorei(37441,d.premultiplyAlpha);a.pixelStorei(37443,d.colorSpace);a.pixelStorei(3317,d.unpackAlignment)}function ta(){O.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function r(a,b){var f=null;
n(b)?f=b:b&&(J(a,b),"x"in b&&(a.xOffset=b.x|0),"y"in b&&(a.yOffset=b.y|0),n(b.data)&&(f=b.data));if(b.copy){var g=G.viewportWidth,m=G.viewportHeight;a.width=a.width||g-a.xOffset;a.height=a.height||m-a.yOffset;a.needsCopy=!0}else if(!f)a.width=a.width||1,a.height=a.height||1;else if(L(f))a.data=f,"type"in b||5121!==a.type||(a.type=C[Object.prototype.toString.call(f)]|0);else if(h(f)){g=f;m=a.width*a.height*a.channels;switch(a.type){case 5121:case 5123:case 5125:case 5126:m=A.allocType(a.type,m);m.set(g);
a.data=m;break;case 36193:a.data=k(g)}a.alignment=1;a.needsFree=!0}else if(E(f)){g=f.data;Array.isArray(g)||5121!==a.type||(a.type=C[Object.prototype.toString.call(g)]|0);var m=f.shape,r=f.stride,p,t,z,H;3===m.length?(z=m[2],H=r[2]):H=z=1;p=m[0];t=m[1];m=r[0];r=r[1];a.alignment=1;a.width=p;a.height=t;a.channels=z;a.format=a.internalformat=l[z];a.needsFree=!0;p=H;f=f.offset;z=a.width;H=a.height;t=a.channels;for(var B=A.allocType(36193===a.type?5126:a.type,z*H*t),ia=0,D=0;D<H;++D)for(var da=0;da<z;++da)for(var q=
0;q<t;++q)B[ia++]=g[m*da+r*D+p*q+f];c(a,B)}else if("[object HTMLCanvasElement]"===x(f)||"[object CanvasRenderingContext2D]"===x(f))"[object HTMLCanvasElement]"===x(f)?a.element=f:a.element=f.canvas,a.width=a.element.width,a.height=a.element.height;else if("[object HTMLImageElement]"===x(f))a.element=f,a.width=f.naturalWidth,a.height=f.naturalHeight;else if("[object HTMLVideoElement]"===x(f))a.element=f,a.width=f.videoWidth,a.height=f.videoHeight,a.needsPoll=!0;else if(e(f)){g=f[0].length;m=f.length;
r=1;if(F(f[0][0])){p=r=f[0][0].length;z=A.allocType(36193===a.type?5126:a.type,g*m*p);for(t=H=0;t<m;++t)for(B=f[t],ia=0;ia<g;++ia)for(D=B[ia],da=0;da<p;++da)z[H++]=D[da];c(a,z)}else{p=A.allocType(36193===a.type?5126:a.type,g*m);for(H=z=0;H<m;++H)for(t=f[H],B=0;B<g;++B)p[z++]=t[B];c(a,p)}a.alignment=1;a.width=g;a.height=m;a.channels=r;a.format=a.internalformat=l[r];a.needsFree=!0}}function U(d,b,c,f,e){var k=d.element,h=d.data,g=d.internalformat,l=d.format,m=d.type,r=d.width,n=d.height;na(d);k?a.texSubImage2D(b,
e,c,f,l,m,k):d.compressed?a.compressedTexSubImage2D(b,e,c,f,g,r,n,h):d.needsCopy?(t(),a.copyTexSubImage2D(b,e,c,f,d.xOffset,d.yOffset,r,n)):a.texSubImage2D(b,e,c,f,r,n,l,m,h)}function ba(){return Ea.pop()||new ta}function ja(a){a.needsFree&&A.freeType(a.data);ta.call(a);Ea.push(a)}function X(){O.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function M(a,b,c){var f=a.images[0]=ba();a.mipmask=1;f.width=a.width=b;f.height=a.height=c}function D(a,b){var c=null;
if(n(b))c=a.images[0]=ba(),Q(c,a),r(c,b),a.mipmask=1;else if(J(a,b),Array.isArray(b.mipmap))for(var f=b.mipmap,e=0;e<f.length;++e)c=a.images[e]=ba(),Q(c,a),c.width>>=e,c.height>>=e,r(c,f[e]),a.mipmask|=1<<e;else c=a.images[0]=ba(),Q(c,a),r(c,b),a.mipmask=1;Q(a,a.images[0])}function xa(d,b){for(var c=d.images,e=0;e<c.length&&c[e];++e){var f=c[e],k=b,h=e,g=f.element,l=f.data,m=f.internalformat,r=f.format,n=f.type,p=f.width,x=f.height;na(f);g?a.texImage2D(k,h,r,r,n,g):f.compressed?a.compressedTexImage2D(k,
h,m,p,x,0,l):f.needsCopy?(t(),a.copyTexImage2D(k,h,r,f.xOffset,f.yOffset,p,x,0)):a.texImage2D(k,h,r,p,x,0,r,n,l)}}function oa(){var a=Ka.pop()||new X;O.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function ya(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&ja(b[c]),b[c]=null;Ka.push(a)}function T(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ea(a,b){"min"in b&&(a.minFilter=ka[b.min],0<=H.indexOf(a.minFilter)&&
(a.genMipmaps=!0));"mag"in b&&(a.magFilter=ha[b.mag]);var c=a.wrapS,f=a.wrapT;if("wrap"in b){var e=b.wrap;"string"===typeof e?c=f=K[e]:Array.isArray(e)&&(c=K[e[0]],f=K[e[1]])}else"wrapS"in b&&(c=K[b.wrapS]),"wrapT"in b&&(f=K[b.wrapT]);a.wrapS=c;a.wrapT=f;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=pa[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in
b||(a.minFilter=9984)}}function fa(b,c){a.texParameteri(c,10241,b.minFilter);a.texParameteri(c,10240,b.magFilter);a.texParameteri(c,10242,b.wrapS);a.texParameteri(c,10243,b.wrapT);g.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(c))}function qa(b){O.call(this);this.mipmask=0;this.internalformat=6408;this.id=La++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=
new T;P.profile&&(this.stats={size:0})}function ga(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function Y(){var b=Aa[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function ra(b){var c=b.texture,f=b.unit,e=b.target;0<=f&&(a.activeTexture(33984+f),a.bindTexture(e,null),Aa[f]=null);a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete la[b.id];B.textureCount--}var pa={"don't care":4352,"dont care":4352,nice:4354,fast:4353},K={repeat:10497,
clamp:33071,mirror:33648},ha={nearest:9728,linear:9729},ka=b({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ha),R={none:0,browser:37444},V={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Z={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},aa={};g.ext_srgb&&(Z.srgb=35904,Z.srgba=35906);g.oes_texture_float&&(V.float32=V["float"]=5126);g.oes_texture_half_float&&
(V.float16=V["half float"]=36193);g.webgl_depth_texture&&(b(Z,{depth:6402,"depth stencil":34041}),b(V,{uint16:5123,uint32:5125,"depth stencil":34042}));g.webgl_compressed_texture_s3tc&&b(aa,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});g.webgl_compressed_texture_atc&&b(aa,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});g.webgl_compressed_texture_pvrtc&&b(aa,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});g.webgl_compressed_texture_etc1&&(aa["rgb etc1"]=36196);var ca=Array.prototype.slice.call(a.getParameter(34467));Object.keys(aa).forEach(function(a){var b=aa[a];0<=ca.indexOf(b)&&(Z[a]=b)});var ia=Object.keys(Z);p.textureFormats=ia;var da=ia.reduce(function(a,b){var c=Z[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),Ea=[],Ka=[],La=0,la={},Fa=p.maxTextureUnits,Aa=Array(Fa).map(function(){return null});
b(qa.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<Fa;++c){var f=Aa[c];if(f){if(0<f.bindCount)continue;f.unit=-1}Aa[c]=this;b=c;break}P.profile&&B.maxTextureUnits<b+1&&(B.maxTextureUnits=b+1);this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&ra(this)}});P.profile&&(B.getTotalTextureSize=function(){var a=0;Object.keys(la).forEach(function(b){a+=la[b].stats.size});
return a});return{create2D:function(b,c){function e(a,b){var d=k.texInfo;T.call(d);var c=oa();"number"===typeof a?"number"===typeof b?M(c,a|0,b|0):M(c,a|0,a|0):a?(ea(d,a),D(c,a)):M(c,1,1);d.genMipmaps&&(c.mipmask=(c.width<<1)-1);k.mipmask=c.mipmask;Q(k,c);k.internalformat=c.internalformat;e.width=c.width;e.height=c.height;ga(k);xa(c,3553);fa(d,3553);Y();ya(c);P.profile&&(k.stats.size=f(k.internalformat,k.type,c.width,c.height,d.genMipmaps,!1));return e}var k=new qa(3553);la[k.id]=k;B.textureCount++;
e(b,c);e.subimage=function(a,b,d,c){b|=0;d|=0;c|=0;var f=ba();Q(f,k);f.width>>=c;f.height>>=c;f.width-=b;f.height-=d;r(f,a);ga(k);U(f,3553,b,d,c);Y();ja(f);return e};e.resize=function(b,d){var c=b|0,h=d|0||c;if(c===k.width&&h===k.height)return e;e.width=k.width=c;e.height=k.height=h;ga(k);for(var g=0;k.mipmask>>g;++g)a.texImage2D(3553,g,k.format,c>>g,h>>g,0,k.format,k.type,null);Y();P.profile&&(k.stats.size=f(k.internalformat,k.type,c,h,!1,!1));return e};e._reglType="texture2d";e._texture=k;P.profile&&
(e.stats=k.stats);e.destroy=function(){k.decRef()};return e},createCube:function(b,c,e,k,h,g){function l(a,b,d,c,e,k){var h,g=m.texInfo;T.call(g);for(h=0;6>h;++h)n[h]=oa();if("number"===typeof a||!a)for(a=a|0||1,h=0;6>h;++h)M(n[h],a,a);else if("object"===typeof a)if(b)D(n[0],a),D(n[1],b),D(n[2],d),D(n[3],c),D(n[4],e),D(n[5],k);else if(ea(g,a),J(m,a),"faces"in a)for(a=a.faces,h=0;6>h;++h)Q(n[h],m),D(n[h],a[h]);else for(h=0;6>h;++h)D(n[h],a);Q(m,n[0]);m.mipmask=g.genMipmaps?(n[0].width<<1)-1:n[0].mipmask;
m.internalformat=n[0].internalformat;l.width=n[0].width;l.height=n[0].height;ga(m);for(h=0;6>h;++h)xa(n[h],34069+h);fa(g,34067);Y();P.profile&&(m.stats.size=f(m.internalformat,m.type,l.width,l.height,g.genMipmaps,!0));for(h=0;6>h;++h)ya(n[h]);return l}var m=new qa(34067);la[m.id]=m;B.cubeCount++;var n=Array(6);l(b,c,e,k,h,g);l.subimage=function(a,b,d,c,f){d|=0;c|=0;f|=0;var e=ba();Q(e,m);e.width>>=f;e.height>>=f;e.width-=d;e.height-=c;r(e,b);ga(m);U(e,34069+a,d,c,f);Y();ja(e);return l};l.resize=function(b){b|=
0;if(b!==m.width){l.width=m.width=b;l.height=m.height=b;ga(m);for(var d=0;6>d;++d)for(var c=0;m.mipmask>>c;++c)a.texImage2D(34069+d,c,m.format,b>>c,b>>c,0,m.format,m.type,null);Y();P.profile&&(m.stats.size=f(m.internalformat,m.type,l.width,l.height,!1,!0));return l}};l._reglType="textureCube";l._texture=m;P.profile&&(l.stats=m.stats);l.destroy=function(){m.decRef()};return l},clear:function(){for(var b=0;b<Fa;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),Aa[b]=null;z(la).forEach(ra);B.cubeCount=
0;B.textureCount=0},getTexture:function(a){return null},restore:function(){z(la).forEach(function(b){b.texture=a.createTexture();a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!==(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var e=0;6>e;++e)a.texImage2D(34069+e,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);fa(b.texInfo,b.target)})}}}},{"./constants/arraytypes.json":4,
"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/to-half-float":30,"./util/values":31}],20:[function(g,t,p){t.exports=function(h,e){function g(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function n(b,c,e){var f=p.pop()||new g;f.startQueryIndex=b;f.endQueryIndex=c;f.sum=0;f.stats=e;t.push(f)}var c=e.ext_disjoint_timer_query;if(!c)return null;var f=[],b=[],p=[],t=[],E=[],A=[];return{beginQuery:function(e){var h=
f.pop()||c.createQueryEXT();c.beginQueryEXT(35007,h);b.push(h);n(b.length-1,b.length,e)},endQuery:function(){c.endQueryEXT(35007)},pushScopeStats:n,update:function(){var e,h;e=b.length;if(0!==e){A.length=Math.max(A.length,e+1);E.length=Math.max(E.length,e+1);E[0]=0;var g=A[0]=0;for(h=e=0;h<b.length;++h){var n=b[h];c.getQueryObjectEXT(n,34919)?(g+=c.getQueryObjectEXT(n,34918),f.push(n)):b[e++]=n;E[h+1]=g;A[h+1]=e}b.length=e;for(h=e=0;h<t.length;++h){var g=t[h],l=g.startQueryIndex,n=g.endQueryIndex;
g.sum+=E[n]-E[l];l=A[l];n=A[n];n===l?(g.stats.gpuTime+=g.sum/1E6,p.push(g)):(g.startQueryIndex=l,g.endQueryIndex=n,t[e++]=g)}t.length=e}},getNumPendingQueries:function(){return b.length},clear:function(){f.push.apply(f,b);for(var e=0;e<f.length;e++)c.deleteQueryEXT(f[e]);b.length=0;f.length=0},restore:function(){b.length=0;f.length=0}}}},{}],21:[function(g,t,p){t.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(g,
t,p){function h(e){return Array.prototype.slice.call(e)}function e(e){return h(e).join("")}var x=g("./extend");t.exports=function(){function g(){var b=[],c=[];return x(function(){b.push.apply(b,h(arguments))},{def:function(){var e="v"+f++;c.push(e);0<arguments.length&&(b.push(e,"="),b.push.apply(b,h(arguments)),b.push(";"));return e},toString:function(){return e([0<c.length?"var "+c+";":"",e(b)])}})}function c(){function b(f,h){e(f,h,"=",c.def(f,h),";")}var c=g(),e=g(),f=c.toString,p=e.toString;return x(function(){c.apply(c,
h(arguments))},{def:c.def,entry:c,exit:e,save:b,set:function(e,f,h){b(e,f);c(e,f,"=",h,";")},toString:function(){return f()+p()}})}var f=0,b=[],p=[],t=g(),E={};return{global:t,link:function(c){for(var e=0;e<p.length;++e)if(p[e]===c)return b[e];e="g"+f++;b.push(e);p.push(c);return e},block:g,proc:function(b,f){function h(){var b="a"+g.length;g.push(b);return b}var g=[];f=f||0;for(var n=0;n<f;++n)h();var n=c(),l=n.toString;return E[b]=x(n,{arg:h,toString:function(){return e(["function(",g.join(),"){",
l(),"}"])}})},scope:c,cond:function(){var b=e(arguments),f=c(),g=c(),n=f.toString,p=g.toString;return x(f,{then:function(){f.apply(f,h(arguments));return this},"else":function(){g.apply(g,h(arguments));return this},toString:function(){var c=p();c&&(c="else{"+c+"}");return e(["if(",b,"){",n(),"}",c])}})},compile:function(){var c=['"use strict";',t,"return {"];Object.keys(E).forEach(function(b){c.push('"',b,'":',E[b].toString(),",")});c.push("}");var f=e(c).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,
"{\n");return Function.apply(null,b.concat(f)).apply(null,p)}}}},{"./extend":23}],23:[function(g,t,p){t.exports=function(h,e){for(var g=Object.keys(e),n=0;n<g.length;++n)h[g[n]]=e[g[n]];return h}},{}],24:[function(g,t,p){var h=g("./is-typed-array");t.exports=function(e){return Array.isArray(e)||h(e)}},{"./is-typed-array":26}],25:[function(g,t,p){var h=g("./is-typed-array");t.exports=function(e){return!!e&&"object"===typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"===typeof e.offset&&
e.shape.length===e.stride.length&&(Array.isArray(e.data)||h(e.data))}},{"./is-typed-array":26}],26:[function(g,t,p){var h=g("../constants/arraytypes.json");t.exports=function(e){return Object.prototype.toString.call(e)in h}},{"../constants/arraytypes.json":4}],27:[function(g,t,p){t.exports=function(h,e){for(var g=Array(h),n=0;n<h;++n)g[n]=e(n);return g}},{}],28:[function(g,t,p){function h(c){var e,b;e=(65535<c)<<4;c>>>=e;b=(255<c)<<3;c>>>=b;e|=b;b=(15<c)<<2;c>>>=b;e|=b;b=(3<c)<<1;return e|b|c>>>b>>
1}function e(c){a:{for(var e=16;268435456>=e;e*=16)if(c<=e){c=e;break a}c=0}e=n[h(c)>>2];return 0<e.length?e.pop():new ArrayBuffer(c)}function x(c){n[h(c.byteLength)>>2].push(c)}var n=g("./loop")(8,function(){return[]});t.exports={alloc:e,free:x,allocType:function(c,f){var b=null;switch(c){case 5120:b=new Int8Array(e(f),0,f);break;case 5121:b=new Uint8Array(e(f),0,f);break;case 5122:b=new Int16Array(e(2*f),0,f);break;case 5123:b=new Uint16Array(e(2*f),0,f);break;case 5124:b=new Int32Array(e(4*f),
0,f);break;case 5125:b=new Uint32Array(e(4*f),0,f);break;case 5126:b=new Float32Array(e(4*f),0,f);break;default:return null}return b.length!==f?b.subarray(0,f):b},freeType:function(c){x(c.buffer)}}},{"./loop":27}],29:[function(g,t,p){t.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(h){return requestAnimationFrame(h)},cancel:function(h){return cancelAnimationFrame(h)}}:{next:function(h){return setTimeout(h,16)},cancel:clearTimeout}},{}],30:[function(g,
t,p){var h=g("./pool"),e=new Float32Array(1),x=new Uint32Array(e.buffer);t.exports=function(g){for(var c=h.allocType(5123,g.length),f=0;f<g.length;++f)if(isNaN(g[f]))c[f]=65535;else if(Infinity===g[f])c[f]=31744;else if(-Infinity===g[f])c[f]=64512;else{e[0]=g[f];var b=x[0],p=b>>>31<<15,t=(b<<1>>>24)-127,b=b>>13&1023;c[f]=-24>t?p:-14>t?p+(b+1024>>-14-t):15<t?p+31744:p+(t+15<<10)+b}return c}},{"./pool":28}],31:[function(g,t,p){t.exports=function(h){return Object.keys(h).map(function(e){return h[e]})}},
{}],32:[function(g,t,p){function h(e,b,h){function g(){var b=window.innerWidth,k=window.innerHeight;e!==document.body&&(k=e.getBoundingClientRect(),b=k.right-k.left,k=k.top-k.bottom);n.width=h*b;n.height=h*k;c(n.style,{width:b+"px",height:k+"px"})}var n=document.createElement("canvas");c(n.style,{border:0,margin:0,padding:0,top:0,left:0});e.appendChild(n);e===document.body&&(n.style.position="absolute",c(e.style,{margin:0,padding:0}));window.addEventListener("resize",g,!1);g();return{canvas:n,onDestroy:function(){window.removeEventListener("resize",
g);e.removeChild(n)}}}function e(c,b){function e(h){try{return c.getContext(h,b)}catch(g){return null}}return e("webgl")||e("experimental-webgl")||e("webgl-experimental")}function x(c){return"string"===typeof c?c.split():c}function n(c){return"string"===typeof c?document.querySelector(c):c}var c=g("./util/extend");t.exports=function(c){var b=c||{},g,p,t,A;c={};var k=[],F=[],C="undefined"===typeof window?1:window.devicePixelRatio,H=!1,l=function(b){},m=function(){};"string"===typeof b?g=document.querySelector(b):
"object"===typeof b&&("string"===typeof b.nodeName&&"function"===typeof b.appendChild&&"function"===typeof b.getBoundingClientRect?g=b:"function"===typeof b.drawArrays||"function"===typeof b.drawElements?(A=b,t=A.canvas):("gl"in b?A=b.gl:"canvas"in b?t=n(b.canvas):"container"in b&&(p=n(b.container)),"attributes"in b&&(c=b.attributes),"extensions"in b&&(k=x(b.extensions)),"optionalExtensions"in b&&(F=x(b.optionalExtensions)),"onDone"in b&&(l=b.onDone),"profile"in b&&(H=!!b.profile),"pixelRatio"in b&&
(C=+b.pixelRatio)));g&&("canvas"===g.nodeName.toLowerCase()?t=g:p=g);if(!A){if(!t){g=h(p||document.body,l,C);if(!g)return null;t=g.canvas;m=g.onDestroy}A=e(t,c)}return A?{gl:A,canvas:t,container:p,extensions:k,optionalExtensions:F,pixelRatio:C,profile:H,onDone:l,onDestroy:m}:(m(),l("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/extend":23}],33:[function(g,t,p){function h(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var e=
g("./lib/util/extend"),x=g("./lib/dynamic"),n=g("./lib/util/raf"),c=g("./lib/util/clock"),f=g("./lib/strings"),b=g("./lib/webgl"),z=g("./lib/extension"),L=g("./lib/limits"),E=g("./lib/buffer"),A=g("./lib/elements"),k=g("./lib/texture"),F=g("./lib/renderbuffer"),C=g("./lib/framebuffer"),H=g("./lib/attribute"),l=g("./lib/shader"),m=g("./lib/read"),O=g("./lib/core"),B=g("./lib/stats"),G=g("./lib/timer");t.exports=function(a){function g(){if(0===R.length)D&&D.update(),ca=null;else{ca=n.next(g);J();for(var a=
R.length-1;0<=a;--a){var b=R[a];b&&b(T,null,0)}r.flush();D&&D.update()}}function p(){!ca&&0<R.length&&(ca=n.next(g))}function t(){ca&&(n.cancel(g),ca=null)}function Ga(a){a.preventDefault();t();V.forEach(function(a){a()})}function za(a){r.getError();ba.restore();ga.restore();fa.restore();Y.restore();ra.restore();pa.restore();D&&D.restore();K.procs.refresh();p();Z.forEach(function(a){a()})}function P(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];x.isDynamic(e)?d[b]=x.unbox(e,
b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;n.length<a;)n.push(null);return n}var f=b(a.context||{}),g=b(a.uniforms||{}),h=b(a.attributes||{}),k=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=e({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");
b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var f=K.compile(k,h,g,f,a),l=f.draw,d=f.batch,m=f.scope,n=[];return e(function(a,b){var e;if("function"===typeof a)return m.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(e=0;e<a;++e)m.call(this,null,b,e);else if(Array.isArray(a))for(e=0;e<a.length;++e)m.call(this,a[e],b,e);else return m.call(this,a,b,0);else if("number"===typeof a){if(0<a)return d.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return d.call(this,
a,a.length)}else return l.call(this,a)},{stats:a})}function Ba(a){R.push(a);p();return{cancel:function(){function b(){var a=h(R,b);R[a]=R[R.length-1];--R.length;0>=R.length&&t()}var c=h(R,a);R[c]=b}}}function Q(){var a=ha.viewport,b=ha.scissor_box;a[0]=a[1]=b[0]=b[1]=0;T.viewportWidth=T.framebufferWidth=T.drawingBufferWidth=a[2]=b[2]=r.drawingBufferWidth;T.viewportHeight=T.framebufferHeight=T.drawingBufferHeight=a[3]=b[3]=r.drawingBufferHeight}function J(){T.tick+=1;T.time=ta();Q();K.procs.poll()}
function na(){Q();K.procs.refresh();D&&D.update()}function ta(){return(c()-xa)/1E3}a=b(a);if(!a)return null;var r=a.gl,U=r.getContextAttributes();r.isContextLost();var ba=z(r,a);if(!ba)return null;var ja=f(),X=B(),M=ba.extensions,D=G(r,M),xa=c(),oa=r.drawingBufferWidth,ya=r.drawingBufferHeight,T={tick:0,time:0,viewportWidth:oa,viewportHeight:ya,framebufferWidth:oa,framebufferHeight:ya,drawingBufferWidth:oa,drawingBufferHeight:ya,pixelRatio:a.pixelRatio},ea=L(r,M),fa=E(r,X,a),qa=A(r,M,fa,X),oa=H(r,
M,ea,fa,ja),ga=l(r,ja,X,a),Y=k(r,M,ea,function(){K.procs.poll()},T,X,a),ra=F(r,M,ea,X,a),pa=C(r,M,ea,Y,ra,X),K=O(r,ja,M,ea,fa,qa,Y,pa,{},oa,ga,{elements:null,primitive:4,count:-1,offset:0,instances:-1},T,D,a),ja=m(r,pa,K.procs.poll,T,U,M),ha=K.next,ka=r.canvas,R=[],V=[],Z=[],aa=[a.onDestroy],ca=null;ka&&(ka.addEventListener("webglcontextlost",Ga,!1),ka.addEventListener("webglcontextrestored",za,!1));na();U=e(P,{clear:function(a){var b=0;K.procs.poll();var c=a.color;c&&(r.clearColor(+c[0]||0,+c[1]||
0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(r.clearDepth(+a.depth),b|=256);"stencil"in a&&(r.clearStencil(a.stencil|0),b|=1024);r.clear(b)},prop:x.define.bind(null,1),context:x.define.bind(null,2),"this":x.define.bind(null,3),draw:P({}),buffer:function(a){return fa.create(a,34962,!1,!1)},elements:function(a){return qa.create(a,!1)},texture:Y.create2D,cube:Y.createCube,renderbuffer:ra.create,framebuffer:pa.create,framebufferCube:pa.createCube,attributes:U,frame:Ba,on:function(a,b){var c;switch(a){case "frame":return Ba(b);
case "lost":c=V;break;case "restore":c=Z;break;case "destroy":c=aa}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:ea,hasExtension:function(a){return 0<=ea.extensions.indexOf(a.toLowerCase())},read:ja,destroy:function(){R.length=0;t();ka&&(ka.removeEventListener("webglcontextlost",Ga),ka.removeEventListener("webglcontextrestored",za));ga.clear();pa.clear();ra.clear();Y.clear();qa.clear();fa.clear();D&&D.clear();aa.forEach(function(a){a()})},
_gl:r,_refresh:na,poll:function(){J();D&&D.update()},now:ta,stats:X});a.onDone(null,U);return U}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},{},[1]);
