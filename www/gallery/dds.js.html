<!DOCTYPE html>
      <html>
        <head>
          <title>example/dds.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(m,u,g){function d(e,c){if(!u[e]){if(!m[e]){var b="function"==typeof require&&require;if(!c&&b)return b(e,!0);if(x)return x(e,!0);b=Error("Cannot find module '"+e+"'");throw b.code="MODULE_NOT_FOUND",b;}b=u[e]={exports:{}};m[e][0].call(b.exports,function(c){var b=m[e][1][c];return d(b?b:c)},b,b.exports,e$$0,m,u,g)}return u[e].exports}for(var x="function"==typeof require&&require,B=0;B<g.length;B++)d(g[B]);return d})({1:[function(h,m,u){var g=h("../regl")({extensions:"WEBGL_compressed_texture_s3tc"}),
d=h("parse-dds");h("resl")({manifest:{diffuse:{type:"binary",src:"assets/alpine_cliff_a.dds",parser:function(x){var B=d(x),e=B.images[0];return g.texture({format:"rgba s3tc "+B.format,shape:B.shape,mag:"linear",data:new Uint8Array(x,e.offset,e.length)})}},specular:{type:"image",src:"assets/alpine_cliff_a_spec.png",parser:function(d){return g.texture({mag:"linear",data:d})}},normals:{type:"image",src:"assets/alpine_cliff_a_norm.png",parser:function(d){return g.texture({mag:"linear",data:d})}}},onDone:function(d){var B=
g({frag:"\n      precision mediump float;\n      uniform sampler2D specular, normals, diffuse;\n      varying vec3 lightDir, eyeDir;\n      varying vec2 uv;\n      void main () {\n        float d = length(lightDir);\n        vec3 L = normalize(lightDir);\n        vec3 E = normalize(eyeDir);\n        vec3 N = normalize(2.0 * texture2D(normals, uv).rgb - 1.0);\n        N = vec3(-N.x, N.yz);\n        vec3 D = texture2D(diffuse, uv).rgb;\n        vec3 kD = D * (0.01 +\n          max(0.0, dot(L, N) * (0.6 + 0.8 / d) ));\n        vec3 S = texture2D(specular, uv).rgb;\n        vec3 kS = 2.0 * pow(max(0.0, dot(normalize(N + L), -E)), 10.0) * S;\n        gl_FragColor = vec4(kD + kS, 1);\n      }",
vert:"\n      precision mediump float;\n      attribute vec2 position;\n      uniform vec2 lightPosition;\n      varying vec3 lightDir, eyeDir;\n      varying vec2 uv;\n      void main () {\n        vec2 P = 1.0 - 2.0 * position;\n        uv = vec2(position.x, 1.0 - position.y);\n        eyeDir = -vec3(P, 1);\n        lightDir = vec3(lightPosition - P, 1);\n        gl_Position = vec4(P, 0, 1);\n      }",attributes:{position:[-2,0,0,-2,2,2]},uniforms:{specular:d.specular,normals:d.normals,diffuse:d.diffuse,
lightPosition:function(e){e=.025*e.tick;return[2*Math.cos(e),2*Math.sin(e)]}},count:3});g.frame(function(){B()})}})},{"../regl":35,"parse-dds":33,resl:34}],2:[function(h,m,u){function g(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}m.exports=function(d,x,B,e,c){d=B.maxAttributes;x=Array(d);for(B=0;B<d;++B)x[B]=new g;return{Record:g,scope:{},state:x}}},{}],3:[function(h,m,u){function g(c){return T[Object.prototype.toString.call(c)]|
0}function d(c,e){for(var b=0;b<e.length;++b)c[b]=e[b]}function x(c,e,b,d,g,l,q){for(var B=0,a=0;a<b;++a)for(var M=0;M<d;++M)c[B++]=e[g*a+l*M+q]}function B(c,e,b){for(var d=0,g=0;g<e.length;++g)for(var l=e[g],q=0;q<b;++q)c[d++]=l[q]}var e=h("./util/is-typed-array"),c=h("./util/is-ndarray"),b=h("./util/values"),q=h("./util/pool"),T=h("./constants/arraytypes.json"),F=h("./constants/dtypes.json"),C=h("./constants/usage.json"),l=[];l[5120]=1;l[5122]=2;l[5124]=4;l[5121]=1;l[5123]=2;l[5125]=4;l[5126]=4;
m.exports=function(z,h,y){function k(a){this.id=I++;this.buffer=z.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;y.profile&&(this.stats={size:0})}function r(a,c,e){a.byteLength=c.byteLength;z.bufferData(a.type,c,e)}function L(a,b,k,l,M){a.usage=k;if(Array.isArray(b))a.dtype=l||5126,0<b.length&&(Array.isArray(b[0])?(a.dimension=b[0].length,l=q.allocType(a.dtype,b.length*a.dimension),B(l,b,a.dimension),r(a,l,k),q.freeType(l)):"number"===typeof b[0]?(a.dimension=
M,l=q.allocType(a.dtype,b.length),d(l,b),r(a,l,k),q.freeType(l)):e(b[0])&&(a.dimension=b[0].length,a.dtype=l||g(b[0])||5126,l=q.allocType(a.dtype,b.length*a.dimension),B(l,b,a.dimension),r(a,l,k),q.freeType(l)));else if(e(b))a.dtype=l||g(b),a.dimension=M,r(a,b,k);else if(c(b)){var z=b.shape,y=b.stride;M=b.offset;var n=0,h=0,C=0,v=0;1===z.length?(n=z[0],h=1,C=y[0],v=0):2===z.length&&(n=z[0],h=z[1],C=y[0],v=y[1]);a.dtype=l||g(b.data)||5126;a.dimension=h;l=q.allocType(a.dtype,n*h);x(l,b.data,n,h,C,v,
M);r(a,l,k);q.freeType(l)}}function m(b){h.bufferCount--;z.deleteBuffer(b.buffer);b.buffer=null;delete a[b.id]}var I=0,a={};k.prototype.bind=function(){z.bindBuffer(this.type,this.buffer)};k.prototype.destroy=function(){m(this)};var M=[];y.profile&&(h.getTotalBufferSize=function(){var b=0;Object.keys(a).forEach(function(c){b+=a[c].stats.size});return b});return{create:function(b,r,M){function I(a){var b=35044,d=null,g=0,k=0,v=1;Array.isArray(a)||e(a)||c(a)?d=a:"number"===typeof a?g=a|0:a&&("data"in
a&&(d=a.data),"usage"in a&&(b=C[a.usage]),"type"in a&&(k=F[a.type]),"dimension"in a&&(v=a.dimension|0),"length"in a&&(g=a.length|0));D.bind();d?L(D,d,b,k,v):(z.bufferData(D.type,g,b),D.dtype=k||5121,D.usage=b,D.dimension=v,D.byteLength=g);y.profile&&(D.stats.size=D.byteLength*l[D.dtype]);return I}h.bufferCount++;var D=new k(r);a[D.id]=D;M||I(b);I._reglType="buffer";I._buffer=D;I.subdata=function(a,b){var l=(b||0)|0;D.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var k=q.allocType(D.dtype,
a.length);d(k,a);z.bufferSubData(D.type,l,k);q.freeType(k)}else if(Array.isArray(a[0])||e(a[0])){var k=a[0].length,r=q.allocType(D.dtype,a.length*k);B(r,a,k);z.bufferSubData(D.type,l,r);q.freeType(r)}}else if(e(a))z.bufferSubData(D.type,l,a);else if(c(a)){var v=a.shape,M=a.stride,h=r=k=0,y=0;1===v.length?(k=v[0],r=1,h=M[0],y=0):2===v.length&&(k=v[0],r=v[1],h=M[0],y=M[1]);v=Array.isArray(a.data)?D.dtype:g(a.data);v=q.allocType(v,k*r);x(v,a.data,k,r,h,y,a.offset);z.bufferSubData(D.type,l,v);q.freeType(v)}return I};
y.profile&&(I.stats=D.stats);I.destroy=function(){m(D)};return I},createStream:function(a,b){var c=M.pop();c||(c=new k(a));c.bind();L(c,b,35040,0,1);return c},destroyStream:function(a){M.push(a)},clear:function(){b(a).forEach(m);M.forEach(m)},getBuffer:function(a){return a&&a._buffer instanceof k?a._buffer:null},_initBuffer:L}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],
4:[function(h,m,u){m.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(h,m,u){m.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(h,m,u){m.exports={points:0,point:0,lines:1,
line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(h,m,u){m.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(h,m,u){function g(a){return Array.isArray(a)||T(a)||F(a)}function d(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function x(a,b,c,e){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=e}function B(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function e(a){return new x(!1,
!1,!1,a)}function c(a,b){var c=a.type;return 0===c?(c=a.data.length,new x(!0,1<=c,2<=c,b)):4===c?(c=a.data,new x(c.thisDep,c.contextDep,c.propDep,b)):new x(3===c,2===c,1===c,b)}var b=h("./util/codegen"),q=h("./util/loop"),T=h("./util/is-typed-array"),F=h("./util/is-ndarray"),C=h("./util/is-array-like"),l=h("./dynamic"),z=h("./constants/primitives.json"),E=h("./constants/dtypes.json"),y=["x","y","z","w"],k="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),
r={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},L={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},
H={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},I={cw:2304,ccw:2305},a=new x(!1,!1,!1,function(){});m.exports=function(h,m,F,T,V,D,u,K,n,R,ea,v,S,Y,fa){function ga(a){return a.replace(".","_")}function P(a,A,f){var b=ga(a);Ha.push(a);Aa[b]=ma[b]=!!f;na[b]=A}function N(a,f,b){var c=ga(a);Ha.push(a);Array.isArray(b)?(ma[c]=b.slice(),Aa[c]=b.slice()):ma[c]=Aa[c]=b;oa[c]=f}function Z(){var a=b(),A=a.link,c=a.global;a.id=Ra++;
a.batchId="0";var e=A(Pa),J=a.shared={props:"a0"};Object.keys(Pa).forEach(function(a){J[a]=c.def(e,".",a)});var O=a.next={},d=a.current={};Object.keys(oa).forEach(function(a){Array.isArray(ma[a])&&(O[a]=c.def(J.next,".",a),d[a]=c.def(J.current,".",a))});var p=a.constants={};Object.keys(Ja).forEach(function(a){p[a]=c.def(JSON.stringify(Ja[a]))});a.invoke=function(p,f){switch(f.type){case 0:var b=["this",J.context,J.props,a.batchId];return p.def(A(f.data),".call(",b.slice(0,Math.max(f.data.length+1,
4)),")");case 1:return p.def(J.props,f.data);case 2:return p.def(J.context,f.data);case 3:return p.def("this",f.data);case 4:return f.data.append(a,p),f.data.ref}};a.attribCache={};var Ba={};a.scopeAttrib=function(a){a=m.id(a);if(a in Ba)return Ba[a];var p=R.scope[a];p||(p=R.scope[a]=new f);return Ba[a]=A(p)};return a}function pa(a){var f=a["static"];a=a.dynamic;var b;if("profile"in f){var za=!!f.profile;b=e(function(a,f){return za});b.enable=za}else if("profile"in a){var J=a.profile;b=c(J,function(a,
f){return a.invoke(f,J)})}return b}function ua(a){var f=a["static"];a=a.dynamic;if("framebuffer"in f){var b=f.framebuffer;return b?(b=K.getFramebuffer(b),e(function(a,f){var A=a.link(b),p=a.shared;f.set(p.framebuffer,".next",A);p=p.context;f.set(p,".framebufferWidth",A+".width");f.set(p,".framebufferHeight",A+".height");return A})):e(function(a,f){var b=a.shared;f.set(b.framebuffer,".next","null");b=b.context;f.set(b,".framebufferWidth",b+".drawingBufferWidth");f.set(b,".framebufferHeight",b+".drawingBufferHeight");
return"null"})}if("framebuffer"in a){var za=a.framebuffer;return c(za,function(a,f){var b=a.invoke(f,za),p=a.shared,A=p.framebuffer,b=f.def(A,".getFramebuffer(",b,")");f.set(A,".next",b);p=p.context;f.set(p,".framebufferWidth",b+"?"+b+".width:"+p+".drawingBufferWidth");f.set(p,".framebufferHeight",b+"?"+b+".height:"+p+".drawingBufferHeight");return b})}return null}function ia(a,f){function b(a){if(a in e){var t=e[a];a=!0;var Ia=t.x|0,Qa=t.y|0,d,ha;"width"in t?d=t.width|0:a=!1;"height"in t?ha=t.height|
0:a=!1;return new x(!a&&f&&f.thisDep,!a&&f&&f.contextDep,!a&&f&&f.propDep,function(a,p){var f=a.shared.context,b=d;"width"in t||(b=p.def(f,".","framebufferWidth","-",Ia));var A=ha;"height"in t||(A=p.def(f,".","framebufferHeight","-",Qa));return[Ia,Qa,b,A]})}if(a in J){var O=J[a];a=c(O,function(a,p){var f=a.invoke(p,O),b=a.shared.context,t=p.def(f,".x|0"),A=p.def(f,".y|0"),c=p.def('"width" in ',f,"?",f,".width|0:","(",b,".","framebufferWidth","-",t,")"),f=p.def('"height" in ',f,"?",f,".height|0:",
"(",b,".","framebufferHeight","-",A,")");return[t,A,c,f]});f&&(a.thisDep=a.thisDep||f.thisDep,a.contextDep=a.contextDep||f.contextDep,a.propDep=a.propDep||f.propDep);return a}return f?new x(f.thisDep,f.contextDep,f.propDep,function(a,p){var f=a.shared.context;return[0,0,p.def(f,".","framebufferWidth"),p.def(f,".","framebufferHeight")]}):null}var e=a["static"],J=a.dynamic,O=b("viewport");if(O)var d=O,O=new x(O.thisDep,O.contextDep,O.propDep,function(a,f){var b=d.append(a,f),t=a.shared.context;f.set(t,
".viewportWidth",b[2]);f.set(t,".viewportHeight",b[3]);return b});return{viewport:O,scissor_box:b("scissor.box")}}function qa(a){function f(a){if(a in b){var t=m.id(b[a]);a=e(function(){return t});a.id=t;return a}if(a in d){var A=d[a];return c(A,function(a,f){var p=a.invoke(f,A);return f.def(a.shared.strings,".id(",p,")")})}return null}var b=a["static"],d=a.dynamic,J=f("frag"),O=f("vert"),g=null;B(J)&&B(O)?(g=ea.program(O.id,J.id),a=e(function(a,f){return a.link(g)})):a=new x(J&&J.thisDep||O&&O.thisDep,
J&&J.contextDep||O&&O.contextDep,J&&J.propDep||O&&O.propDep,function(a,f){var b=a.shared.shader,t;t=J?J.append(a,f):f.def(b,".","frag");var A;A=O?O.append(a,f):f.def(b,".","vert");return f.def(b+".program("+A+","+t+")")});return{frag:J,vert:O,progVar:a,program:g}}function ja(a){function f(a,p){if(a in b){var t=b[a]|0;return e(function(a,f){p&&(a.OFFSET=t);return t})}if(a in d){var A=d[a];return c(A,function(a,f){var b=a.invoke(f,A);p&&(a.OFFSET=b);return b})}return p&&J?e(function(a,f){a.OFFSET="0";
return 0}):null}var b=a["static"],d=a.dynamic,J=function(){if("elements"in b){var a=b.elements;g(a)?a=D.getElements(D.create(a)):a&&(a=D.getElements(a));var f=e(function(f,b){if(a){var p=f.link(a);return f.ELEMENTS=p}return f.ELEMENTS=null});f.value=a;return f}if("elements"in d){var t=d.elements;return c(t,function(a,f){var b=a.shared,p=b.isBufferArgs,b=b.elements,A=a.invoke(f,t),c=f.def("null"),p=f.def(p,"(",A,")"),A=a.cond(p).then(c,"=",b,".createStream(",A,");")["else"](c,"=",b,".getElements(",
A,");");f.entry(A);f.exit(a.cond(p).then(b,".destroyStream(",c,");"));return a.ELEMENTS=c})}return null}(),O=f("offset",!0);return{elements:J,primitive:function(){if("primitive"in b){var a=b.primitive;return e(function(f,b){return z[a]})}if("primitive"in d){var f=d.primitive;return c(f,function(a,b){var A=a.constants.primTypes,t=a.invoke(b,f);return b.def(A,"[",t,"]")})}return J?B(J)?J.value?e(function(a,f){return f.def(a.ELEMENTS,".primType")}):e(function(){return 4}):new x(J.thisDep,J.contextDep,
J.propDep,function(a,f){var b=a.ELEMENTS;return f.def(b,"?",b,".primType:",4)}):null}(),count:function(){if("count"in b){var a=b.count|0;return e(function(){return a})}if("count"in d){var f=d.count;return c(f,function(a,b){return a.invoke(b,f)})}return J?B(J)?J?O?new x(O.thisDep,O.contextDep,O.propDep,function(a,f){return f.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):e(function(a,f){return f.def(a.ELEMENTS,".vertCount")}):e(function(){return-1}):new x(J.thisDep||O.thisDep,J.contextDep||O.contextDep,
J.propDep||O.propDep,function(a,f){var b=a.ELEMENTS;return a.OFFSET?f.def(b,"?",b,".vertCount-",a.OFFSET,":-1"):f.def(b,"?",b,".vertCount:-1")}):null}(),instances:f("instances",!1),offset:O}}function aa(a){var f=a["static"],b=a.dynamic,d={};Ha.forEach(function(a){function t(p,Ba){if(a in f){var Ia=p(f[a]);d[g]=e(function(){return Ia})}else if(a in b){var O=b[a];d[g]=c(O,function(a,f){return Ba(a,f,a.invoke(f,O))})}}var g=ga(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return t(function(a){return a},
function(a,f,b){return b});case "depth.func":return t(function(a){return L[a]},function(a,f,b){return f.def(a.constants.compareFuncs,"[",b,"]")});case "depth.range":return t(function(a){return a},function(a,f,b){a=f.def("+",b,"[0]");f=f.def("+",b,"[1]");return[a,f]});case "blend.func":return t(function(a){return[r["srcRGB"in a?a.srcRGB:a.src],r["dstRGB"in a?a.dstRGB:a.dst],r["srcAlpha"in a?a.srcAlpha:a.src],r["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,f,b){function t(a,p){var c=f.def('"',a,p,'" in ',
b,"?",b,".",a,p,":",b,".",a);return f.def(A,"[",c,"]")}var A=a.constants.blendFuncs;a=t("src","RGB");var c=t("src","Alpha"),e=t("dst","RGB"),d=t("dst","Alpha");return[a,e,c,d]});case "blend.equation":return t(function(a){if("string"===typeof a)return[w[a],w[a]];if("object"===typeof a)return[w[a.rgb],w[a.alpha]]},function(a,f,b){var t=a.constants.blendEquations,A=f.def(),c=f.def();a=a.cond("typeof ",b,'==="string"');a.then(A,"=",c,"=",t,"[",b,"];");a["else"](A,"=",t,"[",b,".rgb];",c,"=",t,"[",b,".alpha];");
f(a);return[A,c]});case "blend.color":return t(function(a){return q(4,function(f){return+a[f]})},function(a,f,b){return q(4,function(a){return f.def("+",b,"[",a,"]")})});case "stencil.mask":return t(function(a){return a|0},function(a,f,b){return f.def(b,"|0")});case "stencil.func":return t(function(a){return[L[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,f,b){a=f.def('"cmp" in ',b,"?",a.constants.compareFuncs,"[",b,".cmp]",":",7680);var t=f.def(b,".ref|0");f=f.def('"mask" in ',b,"?",
b,".mask|0:-1");return[a,t,f]});case "stencil.opFront":case "stencil.opBack":return t(function(f){return["stencil.opBack"===a?1029:1028,H[f.fail||"keep"],H[f.zfail||"keep"],H[f.pass||"keep"]]},function(f,b,t){function A(a){return b.def('"',a,'" in ',t,"?",c,"[",t,".",a,"]:",7680)}var c=f.constants.stencilOps;return["stencil.opBack"===a?1029:1028,A("fail"),A("zfail"),A("pass")]});case "polygonOffset.offset":return t(function(a){return[a.factor|0,a.units|0]},function(a,f,b){a=f.def(b,".factor|0");f=
f.def(b,".units|0");return[a,f]});case "cull.face":return t(function(a){var f=0;"front"===a?f=1028:"back"===a&&(f=1029);return f},function(a,f,b){return f.def(b,'==="front"?',1028,":",1029)});case "lineWidth":return t(function(a){return a},function(a,f,b){return b});case "frontFace":return t(function(a){return I[a]},function(a,f,b){return f.def(b+'==="cw"?2304:2305')});case "colorMask":return t(function(a){return a.map(function(a){return!!a})},function(a,f,b){return q(4,function(a){return"!!"+b+"["+
a+"]"})});case "sample.coverage":return t(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,f,b){a=f.def('"value" in ',b,"?+",b,".value:1");f=f.def("!!",b,".invert");return[a,f]})}});return d}function ra(a){var f=a["static"],b=a.dynamic,d={};Object.keys(f).forEach(function(a){var b=f[a],t;if("number"===typeof b||"boolean"===typeof b)t=e(function(){return b});else if("function"===typeof b){var c=b._reglType;if("texture2d"===c||"textureCube"===c)t=e(function(a){return a.link(b)});else if("framebuffer"===
c||"framebufferCube"===c)t=e(function(a){return a.link(b.color[0])})}else C(b)&&(t=e(function(a){return a.global.def("[",q(b.length,function(a){return b[a]}),"]")}));t.value=b;d[a]=t});Object.keys(b).forEach(function(a){var f=b[a];d[a]=c(f,function(a,b){return a.invoke(b,f)})});return d}function U(a){var b=a["static"],d=a.dynamic,l={};Object.keys(b).forEach(function(a){var t=b[a],c=m.id(a),p=new f;if(g(t))p.state=1,p.buffer=V.getBuffer(V.create(t,34962,!1)),p.type=p.buffer.dtype;else{var d=V.getBuffer(t);
if(d)p.state=1,p.buffer=d,p.type=d.dtype;else if(t.constant){var ha=t.constant;p.buffer="null";p.state=2;"number"===typeof ha?p.x=ha:y.forEach(function(a,f){f<ha.length&&(p[a]=ha[f])})}else{var d=V.getBuffer(t.buffer),k=t.offset|0,G=t.stride|0,n=t.size|0,w=!!t.normalized,r=0;"type"in t&&(r=E[t.type]);t=t.divisor|0;p.buffer=d;p.state=1;p.size=n;p.normalized=w;p.type=r||d.dtype;p.offset=k;p.stride=G;p.divisor=t}}l[a]=e(function(a,f){var b=a.attribCache;if(c in b)return b[c];var t={isStream:!1};Object.keys(p).forEach(function(a){t[a]=
p[a]});p.buffer&&(t.buffer=a.link(p.buffer));return b[c]=t})});Object.keys(d).forEach(function(a){var b=d[a];l[a]=c(b,function(a,t){function c(a){t(l[a],"=",A,".",a,"|0;")}var A=a.invoke(t,b),d=a.shared,e=d.isBufferArgs,g=d.buffer,l={isStream:t.def(!1)},ha=new f;ha.state=1;Object.keys(ha).forEach(function(a){l[a]=t.def(""+ha[a])});var k=l.buffer,J=l.type;t("if(",e,"(",A,")){",l.isStream,"=true;",k,"=",g,".createStream(",34962,",",A,");",J,"=",k,".dtype;","}else{",k,"=",g,".getBuffer(",A,");","if(",
k,"){",J,"=",k,".dtype;",'}else if("constant" in ',A,"){",l.state,"=",2,";","if(typeof "+A+'.constant === "number"){',l[y[0]],"=",A,".constant;",y.slice(1).map(function(a){return l[a]}).join("="),"=0;","}else{",y.map(function(a,f){return l[a]+"="+A+".constant.length>="+f+"?"+A+".constant["+f+"]:0;"}).join(""),"}}else{",k,"=",g,".getBuffer(",A,".buffer);",J,'="type" in ',A,"?",d.glTypes,"[",A,".type]:",k,".dtype;",l.normalized,"=!!",A,".normalized;");c("size");c("offset");c("stride");c("divisor");
t("}}");t.exit("if(",l.isStream,"){",g,".destroyStream(",k,");","}");return l})});return l}function Q(a){var f=a["static"],b=a.dynamic,d={};Object.keys(f).forEach(function(a){var b=f[a];d[a]=e(function(a,f){return"number"===typeof b||"boolean"===typeof b?""+b:a.link(b)})});Object.keys(b).forEach(function(a){var f=b[a];d[a]=c(f,function(a,b){return a.invoke(b,f)})});return d}function W(a,f,b,c){var d;d=ua(a);var e=ia(a,d),l=ja(a),p=aa(a),g=qa(a),k=e.viewport;k&&(p.viewport=k);k=ga("scissor.box");(e=
e[k])&&(p[k]=e);e=0<Object.keys(p).length;d={framebuffer:d,draw:l,shader:g,state:p,dirty:e};d.profile=pa(a);d.uniforms=ra(b);d.attributes=U(f);d.context=Q(c);return d}function xa(a,f,b){var c=a.shared.context,d=a.scope();Object.keys(b).forEach(function(e){f.save(c,"."+e);d(c,".",e,"=",b[e].append(a,f),";")});f(d)}function ba(a,f,b,c){var d=a.shared,e=d.gl,l=d.framebuffer,p;Ka&&(p=f.def(d.extensions,".webgl_draw_buffers"));var g=a.constants,d=g.drawBuffer,g=g.backBuffer;a=b?b.append(a,f):f.def(l,".next");
c||f("if(",a,"!==",l,".cur){");f("if(",a,"){",e,".bindFramebuffer(",36160,",",a,".framebuffer);");Ka&&f(p,".drawBuffersWEBGL(",d,"[",a,".colorAttachments.length]);");f("}else{",e,".bindFramebuffer(",36160,",null);");Ka&&f(p,".drawBuffersWEBGL(",g,");");f("}",l,".cur=",a,";");c||f("}")}function Ca(a,f,b){var c=a.shared,d=c.gl,e=a.current,l=a.next,p=c.current,g=c.next,k=a.cond(p,".dirty");Ha.forEach(function(f){f=ga(f);if(!(f in b.state)){var c,A;if(f in l){c=l[f];A=e[f];var G=q(ma[f].length,function(a){return k.def(c,
"[",a,"]")});k(a.cond(G.map(function(a,f){return a+"!=="+A+"["+f+"]"}).join("||")).then(d,".",oa[f],"(",G,");",G.map(function(a,f){return A+"["+f+"]="+a}).join(";"),";"))}else c=k.def(g,".",f),G=a.cond(c,"!==",p,".",f),k(G),f in na?G(a.cond(c).then(d,".enable(",na[f],");")["else"](d,".disable(",na[f],");"),p,".",f,"=",c,";"):G(d,".",oa[f],"(",c,");",p,".",f,"=",c,";")}});0===Object.keys(b.state).length&&k(p,".dirty=false;");f(k)}function Da(a,f,b,c){var e=a.shared,l=a.current,g=e.current,p=e.gl;d(Object.keys(b)).forEach(function(d){var e=
b[d];if(!c||c(e)){var k=e.append(a,f);if(na[d]){var G=na[d];B(e)?k?f(p,".enable(",G,");"):f(p,".disable(",G,");"):f(a.cond(k).then(p,".enable(",G,");")["else"](p,".disable(",G,");"));f(g,".",d,"=",k,";")}else if(C(k)){var n=l[d];f(p,".",oa[d],"(",k,");",k.map(function(a,f){return n+"["+f+"]="+a}).join(";"),";")}else f(p,".",oa[d],"(",k,");",g,".",d,"=",k,";")}})}function va(a,f){G&&!a.instancing&&(a.instancing=f.def(a.shared.extensions,".angle_instanced_arrays"))}function X(a,f,b,c,d){function e(){return"undefined"===
typeof performance?"Date.now()":"performance.now()"}function k(a){r=f.def();a(r,"=",e(),";");"string"===typeof d?a(G,".count+=",d,";"):a(G,".count++;");Y&&(c?(v=f.def(),a(v,"=",w,".getNumPendingQueries();")):a(w,".beginQuery(",G,");"))}function p(a){a(G,".cpuTime+=",e(),"-",r,";");Y&&(c?a(w,".pushScopeStats(",v,",",w,".getNumPendingQueries(),",G,");"):a(w,".endQuery();"))}function l(a){var b=f.def(n,".profile");f(n,".profile=",a,";");f.exit(n,".profile=",b,";")}var g=a.shared,G=a.stats,n=g.current,
w=g.timer;b=b.profile;var r,v;if(b){if(B(b)){b.enable?(k(f),p(f.exit),l("true")):l("false");return}b=b.append(a,f);l(b)}else b=f.def(n,".profile");g=a.block();k(g);f("if(",b,"){",g,"}");a=a.block();p(a);f.exit("if(",b,"){",a,"}")}function ca(b,c,d,e,k){function g(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function l(a,f,d){function e(){c("if(!",w,".buffer){",g,".enableVertexAttribArray(",
n,");}");var a=d.type,k;k=d.size?c.def(d.size,"||",f):f;c("if(",w,".type!==",a,"||",w,".size!==",k,"||",h.map(function(a){return w+"."+a+"!=="+d[a]}).join("||"),"){",g,".bindBuffer(",34962,",",r,".buffer);",g,".vertexAttribPointer(",[n,k,a,d.normalized,d.stride,d.offset],");",w,".type=",a,";",w,".size=",k,";",h.map(function(a){return w+"."+a+"="+d[a]+";"}).join(""),"}");G&&(a=d.divisor,c("if(",w,".divisor!==",a,"){",b.instancing,".vertexAttribDivisorANGLE(",[n,a],");",w,".divisor=",a,";}"))}function k(){c("if(",
w,".buffer){",g,".disableVertexAttribArray(",n,");","}if(",y.map(function(a,f){return w+"."+a+"!=="+v[f]}).join("||"),"){",g,".vertexAttrib4f(",n,",",v,");",y.map(function(a,f){return w+"."+a+"="+v[f]+";"}).join(""),"}")}var g=p.gl,n=c.def(a,".location"),w=c.def(p.attributes,"[",n,"]");a=d.state;var r=d.buffer,v=[d.x,d.y,d.z,d.w],h=["buffer","normalized","offset","stride"];1===a?e():2===a?k():(c("if(",a,"===",1,"){"),e(),c("}else{"),k(),c("}"))}var p=b.shared;e.forEach(function(e){var p=e.name,G=
d.attributes[p],w;if(G){if(!k(G))return;w=G.append(b,c)}else{if(!k(a))return;var n=b.scopeAttrib(p);w={};Object.keys(new f).forEach(function(a){w[a]=c.def(n,".",a)})}l(b.link(e),g(e.info.type),w)})}function da(f,b,c,d,e){for(var k=f.shared,g=k.gl,p,l=0;l<d.length;++l){var G=d[l],w=G.name,n=G.info.type,r=c.uniforms[w],G=f.link(G)+".location",v;if(r){if(!e(r))continue;if(B(r)){w=r.value;if(35678===n||35680===n)n=f.link(w._texture||w.color[0]._texture),b(g,".uniform1i(",G,",",n+".bind());"),b.exit(n,
".unbind();");else if(35674===n||35675===n||35676===n)w=f.global.def("new Float32Array(["+Array.prototype.slice.call(w)+"])"),r=2,35675===n?r=3:35676===n&&(r=4),b(g,".uniformMatrix",r,"fv(",G,",false,",w,");");else{switch(n){case 5126:p="1f";break;case 35664:p="2f";break;case 35665:p="3f";break;case 35666:p="4f";break;case 35670:p="1i";break;case 5124:p="1i";break;case 35671:p="2i";break;case 35667:p="2i";break;case 35672:p="3i";break;case 35668:p="3i";break;case 35673:p="4i";break;case 35669:p="4i"}b(g,
".uniform",p,"(",G,",",C(w)?Array.prototype.slice.call(w):w,");")}continue}else v=r.append(f,b)}else{if(!e(a))continue;v=b.def(k.uniforms,"[",m.id(w),"]")}35678===n?b("if(",v,"&&",v,'._reglType==="framebuffer"){',v,"=",v,".color[0];","}"):35680===n&&b("if(",v,"&&",v,'._reglType==="framebufferCube"){',v,"=",v,".color[0];","}");w=1;switch(n){case 35678:case 35680:n=b.def(v,"._texture");b(g,".uniform1i(",G,",",n,".bind());");b.exit(n,".unbind();");continue;case 5124:case 35670:p="1i";break;case 35667:case 35671:p=
"2i";w=2;break;case 35668:case 35672:p="3i";w=3;break;case 35669:case 35673:p="4i";w=4;break;case 5126:p="1f";break;case 35664:p="2f";w=2;break;case 35665:p="3f";w=3;break;case 35666:p="4f";w=4;break;case 35674:p="Matrix2fv";break;case 35675:p="Matrix3fv";break;case 35676:p="Matrix4fv"}b(g,".uniform",p,"(",G,",");if("M"===p.charAt(0)){var G=Math.pow(n-35674+2,2),h=f.global.def("new Float32Array(",G,")");b("false,(Array.isArray(",v,")||",v," instanceof Float32Array)?",v,":(",q(G,function(a){return h+
"["+a+"]="+v+"["+a+"]"}),",",h,")")}else 1<w?b(q(w,function(a){return v+"["+a+"]"})):b(v);b(");")}}function Ea(a,f,b,c){function d(e){var k=n[e];return k?k.contextDep&&c.contextDynamic||k.propDep?k.append(a,b):k.append(a,f):f.def(w,".",e)}function e(){function a(){b(z,".drawElementsInstancedANGLE(",[r,q,x,h+"<<(("+x+"-5121)>>1)",y],");")}function f(){b(z,".drawArraysInstancedANGLE(",[r,h,q,y],");")}v?S?a():(b("if(",v,"){"),a(),b("}else{"),f(),b("}")):f()}function k(){function a(){b(l+".drawElements("+
[r,q,x,h+"<<(("+x+"-5121)>>1)"]+");")}function f(){b(l+".drawArrays("+[r,h,q]+");")}v?S?a():(b("if(",v,"){"),a(),b("}else{"),f(),b("}")):f()}var g=a.shared,l=g.gl,w=g.draw,n=c.draw,v=function(){var d=n.elements,e=f;if(d){if(d.contextDep&&c.contextDynamic||d.propDep)e=b;d=d.append(a,e)}else d=e.def(w,".","elements");d&&e("if("+d+")"+l+".bindBuffer(34963,"+d+".buffer.buffer);");return d}(),r=d("primitive"),h=d("offset"),q=function(){var d=n.count,e=f;if(d){if(d.contextDep&&c.contextDynamic||d.propDep)e=
b;d=d.append(a,e)}else d=e.def(w,".","count");return d}();if("number"===typeof q){if(0===q)return}else b("if(",q,"){"),b.exit("}");var y,z;G&&(y=d("instances"),z=a.instancing);var x=v+".type",S=n.elements&&B(n.elements);G&&("number"!==typeof y||0<=y)?"string"===typeof y?(b("if(",y,">0){"),e(),b("}else if(",y,"<0){"),k(),b("}")):e():k()}function ya(a,f,b,c,d){f=Z();d=f.proc("body",d);G&&(f.instancing=d.def(f.shared.extensions,".angle_instanced_arrays"));a(f,d,b,c);return f.compile().body}function La(a,
f,b,c){va(a,f);ca(a,f,b,c.attributes,function(){return!0});da(a,f,b,c.uniforms,function(){return!0});Ea(a,f,f,b)}function Ma(a,f){var b=a.proc("draw",1);va(a,b);xa(a,b,f.context);ba(a,b,f.framebuffer);Ca(a,b,f);Da(a,b,f.state);X(a,b,f,!1,!0);var c=f.shader.progVar.append(a,b);b(a.shared.gl,".useProgram(",c,".program);");if(f.shader.program)La(a,b,f,f.shader.program);else{var d=a.global.def("{}"),e=b.def(c,".id"),k=b.def(d,"[",e,"]");b(a.cond(k).then(k,".call(this,a0);")["else"](k,"=",d,"[",e,"]=",
a.link(function(b){return ya(La,a,f,b,1)}),"(",c,");",k,".call(this,a0);"))}0<Object.keys(f.state).length&&b(a.shared.current,".dirty=true;")}function Na(a,f,b,c){function d(){return!0}a.batchId="a1";va(a,f);ca(a,f,b,c.attributes,d);da(a,f,b,c.uniforms,d);Ea(a,f,f,b)}function wa(a,f,b,c){function d(a){return a.contextDep&&k||a.propDep}function e(a){return!d(a)}va(a,f);var k=b.contextDep,g=f.def(),l=f.def();a.shared.props=l;a.batchId=g;var w=a.scope(),n=a.scope();f(w.entry,"for(",g,"=0;",g,"<","a1",
";++",g,"){",l,"=","a0","[",g,"];",n,"}",w.exit);b.needsContext&&xa(a,n,b.context);b.needsFramebuffer&&ba(a,n,b.framebuffer);Da(a,n,b.state,d);b.profile&&d(b.profile)&&X(a,n,b,!1,!0);c?(ca(a,w,b,c.attributes,e),ca(a,n,b,c.attributes,d),da(a,w,b,c.uniforms,e),da(a,n,b,c.uniforms,d),Ea(a,w,n,b)):(f=a.global.def("{}"),c=b.shader.progVar.append(a,n),l=n.def(c,".id"),w=n.def(f,"[",l,"]"),n(a.shared.gl,".useProgram(",c,".program);","if(!",w,"){",w,"=",f,"[",l,"]=",a.link(function(f){return ya(Na,a,b,f,
2)}),"(",c,");}",w,".call(this,a0[",g,"],",g,");"))}function Oa(a,f){function b(a){return a.contextDep&&d||a.propDep}var c=a.proc("batch",2);a.batchId="0";va(a,c);var d=!1,e=!0;Object.keys(f.context).forEach(function(a){d=d||f.context[a].propDep});d||(xa(a,c,f.context),e=!1);var k=f.framebuffer,g=!1;k?(k.propDep?d=g=!0:k.contextDep&&d&&(g=!0),g||ba(a,c,k)):ba(a,c,null);f.state.viewport&&f.state.viewport.propDep&&(d=!0);Ca(a,c,f);Da(a,c,f.state,function(a){return!b(a)});f.profile&&b(f.profile)||X(a,
c,f,!1,"a1");f.contextDep=d;f.needsContext=e;f.needsFramebuffer=g;e=f.shader.progVar;if(e.contextDep&&d||e.propDep)wa(a,c,f,null);else if(e=e.append(a,c),c(a.shared.gl,".useProgram(",e,".program);"),f.shader.program)wa(a,c,f,f.shader.program);else{var k=a.global.def("{}"),g=c.def(e,".id"),w=c.def(k,"[",g,"]");c(a.cond(w).then(w,".call(this,a0,a1);")["else"](w,"=",k,"[",g,"]=",a.link(function(b){return ya(wa,a,f,b,2)}),"(",e,");",w,".call(this,a0,a1);"))}0<Object.keys(f.state).length&&c(a.shared.current,
".dirty=true;")}function sa(a,b){function c(f){var d=b.shader[f];d&&e.set(k.shader,"."+f,d.append(a,e))}var e=a.proc("scope",3);a.batchId="a2";var k=a.shared,g=k.current;xa(a,e,b.context);b.framebuffer&&b.framebuffer.append(a,e);d(Object.keys(b.state)).forEach(function(f){var c=b.state[f].append(a,e);C(c)?c.forEach(function(b,c){e.set(a.next[f],"["+c+"]",b)}):e.set(k.next,"."+f,c)});X(a,e,b,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(f){var c=b.draw[f];c&&e.set(k.draw,
"."+f,""+c.append(a,e))});Object.keys(b.uniforms).forEach(function(f){e.set(k.uniforms,"["+m.id(f)+"]",b.uniforms[f].append(a,e))});Object.keys(b.attributes).forEach(function(c){var d=b.attributes[c].append(a,e),k=a.scopeAttrib(c);Object.keys(new f).forEach(function(a){e.set(k,"."+a,d[a])})});c("vert");c("frag");0<Object.keys(b.state).length&&(e(g,".dirty=true;"),e.exit(g,".dirty=true;"));e("a1(",a.shared.context,",a0,",a.batchId,");")}function Fa(a){if("object"===typeof a&&!C(a)){for(var f=Object.keys(a),
b=0;b<f.length;++b)if(l.isDynamic(a[f[b]]))return!0;return!1}}function ta(a,f,b){function d(a,f){g.forEach(function(b){var c=e[b];l.isDynamic(c)&&(c=a.invoke(f,c),f(v,".",b,"=",c,";"))})}var e=f["static"][b];if(e&&Fa(e)){var k=a.global,g=Object.keys(e),w=!1,n=!1,G=!1,v=a.global.def("{}");g.forEach(function(f){var b=e[f];if(l.isDynamic(b))f=c(b,null),w=w||f.thisDep,G=G||f.propDep,n=n||f.contextDep;else{k(v,".",f,"=");switch(typeof b){case "number":k(b);break;case "string":k('"',b,'"');break;case "object":Array.isArray(b)&&
k("[",b.join(),"]");break;default:k(a.link(b))}k(";")}});f.dynamic[b]=new l.DynamicVariable(4,{thisDep:w,contextDep:n,propDep:G,ref:v,append:d});delete f["static"][b]}}var f=R.Record,w={add:32774,subtract:32778,"reverse subtract":32779};F.ext_blend_minmax&&(w.min=32775,w.max=32776);var G=F.angle_instanced_arrays,Ka=F.webgl_draw_buffers,ma={dirty:!0,profile:fa.profile},Aa={},Ha=[],na={},oa={};P("dither",3024);P("blend.enable",3042);N("blend.color","blendColor",[0,0,0,0]);N("blend.equation","blendEquationSeparate",
[32774,32774]);N("blend.func","blendFuncSeparate",[1,0,1,0]);P("depth.enable",2929,!0);N("depth.func","depthFunc",513);N("depth.range","depthRange",[0,1]);N("depth.mask","depthMask",!0);N("colorMask","colorMask",[!0,!0,!0,!0]);P("cull.enable",2884);N("cull.face","cullFace",1029);N("frontFace","frontFace",2305);N("lineWidth","lineWidth",1);P("polygonOffset.enable",32823);N("polygonOffset.offset","polygonOffset",[0,0]);P("sample.alpha",32926);P("sample.enable",32928);N("sample.coverage","sampleCoverage",
[1,!1]);P("stencil.enable",2960);N("stencil.mask","stencilMask",-1);N("stencil.func","stencilFunc",[519,0,-1]);N("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);N("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);P("scissor.enable",3089);N("scissor.box","scissor",[0,0,h.drawingBufferWidth,h.drawingBufferHeight]);N("viewport","viewport",[0,0,h.drawingBufferWidth,h.drawingBufferHeight]);var Pa={gl:h,context:S,strings:m,next:Aa,current:ma,draw:v,elements:D,buffer:V,shader:ea,attributes:R.state,
uniforms:n,framebuffer:K,extensions:F,timer:Y,isBufferArgs:g},Ja={primTypes:z,compareFuncs:L,blendFuncs:r,blendEquations:w,stencilOps:H,glTypes:E,orientationType:I};Ka&&(Ja.backBuffer=[1029],Ja.drawBuffer=q(T.maxDrawbuffers,function(a){return 0===a?[0]:q(a,function(a){return 36064+a})}));var Ra=0;return{next:Aa,current:ma,procs:function(){var a=Z(),f=a.proc("poll"),b=a.proc("refresh"),c=a.block();f(c);b(c);var d=a.shared,e=d.gl,k=d.next,g=d.current;c(g,".dirty=false;");ba(a,f);ba(a,b,null,!0);Object.keys(na).forEach(function(d){var w=
na[d],n=c.def(k,".",d),l=a.block();l("if(",n,"){",e,".enable(",w,")}else{",e,".disable(",w,")}",g,".",d,"=",n,";");b(l);f("if(",n,"!==",g,".",d,"){",l,"}")});Object.keys(oa).forEach(function(d){var w=oa[d],n=ma[d],l,G,v=a.block();v(e,".",w,"(");C(n)?(w=n.length,l=a.global.def(k,".",d),G=a.global.def(g,".",d),v(q(w,function(a){return l+"["+a+"]"}),");",q(w,function(a){return G+"["+a+"]="+l+"["+a+"];"}).join("")),f("if(",q(w,function(a){return l+"["+a+"]!=="+G+"["+a+"]"}).join("||"),"){",v,"}")):(l=
c.def(k,".",d),G=c.def(g,".",d),v(l,");",g,".",d,"=",l,";"),f("if(",l,"!==",G,"){",v,"}"));b(v)});return a.compile()}(),compile:function(a,f,b,c,d){var e=Z();e.stats=e.link(d);Object.keys(f["static"]).forEach(function(a){ta(e,f,a)});k.forEach(function(f){ta(e,a,f)});b=W(a,f,b,c);Ma(e,b);sa(e,b);Oa(e,b);return e.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],
9:[function(h,m,u){function g(d,c){this.id=B++;this.type=d;this.data=c}function d(e){if(0===e.length)return[];var c=e.charAt(0),b=e.charAt(e.length-1);if(1<e.length&&c===b&&('"'===c||"'"===c))return['"'+e.substr(1,e.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(c=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e))return d(e.substr(0,c.index)).concat(d(c[1])).concat(d(e.substr(c.index+c[0].length)));c=e.split(".");if(1===c.length)return['"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+
'"'];e=[];for(b=0;b<c.length;++b)e=e.concat(d(c[b]));return e}function x(e){return"["+d(e).join("][")+"]"}var B=0;m.exports={DynamicVariable:g,define:function(d,c){return new g(d,x(c+""))},isDynamic:function(d){return"function"===typeof d&&!d._reglType||d instanceof g},unbox:function(d,c){return"function"===typeof d?new g(0,d):d},accessor:x}},{}],10:[function(h,m,u){var g=h("./util/is-typed-array"),d=h("./util/is-ndarray"),x=h("./util/values"),B=h("./constants/primitives.json"),e=h("./constants/usage.json");
m.exports=function(c,b,h,m){function F(b){this.id=E++;z[this.id]=this;this.buffer=b;this.primType=4;this.type=this.vertCount=0}function C(c,e,k,l,a,y,z){(y=z)||g(e)&&(!d(e)||g(e.data))||(y=b.oes_element_index_uint?5125:5123);c.buffer.bind();h._initBuffer(c.buffer,e,k,y,3);e=z;if(!z){switch(c.buffer.dtype){case 5121:case 5120:e=5121;break;case 5123:case 5122:e=5123;break;case 5125:case 5124:e=5125}c.buffer.dtype=e}c.type=e;0>a&&(a=c.buffer.byteLength,5123===e?a>>=1:5125===e&&(a>>=2));c.vertCount=a;
a=l;0>l&&(a=4,l=c.buffer.dimension,1===l&&(a=0),2===l&&(a=1),3===l&&(a=4));c.primType=a}function l(b){m.elementsCount--;delete z[b.id];b.buffer.destroy();b.buffer=null}var z={},E=0,y={uint8:5121,uint16:5123};b.oes_element_index_uint&&(y.uint32=5125);F.prototype.bind=function(){this.buffer.bind()};var k=[];return{create:function(b){function k(a){if(a)if("number"===typeof a)z(a),x.primType=4,x.vertCount=a|0,x.type=5121;else{var b=null,l=35044,h=-1,r=-1,q=0,m=0;Array.isArray(a)||g(a)||d(a)?b=a:("data"in
a&&(b=a.data),"usage"in a&&(l=e[a.usage]),"primitive"in a&&(h=B[a.primitive]),"count"in a&&(r=a.count|0),"length"in a&&(q=a.length|0),"type"in a&&(m=y[a.type]));b?C(x,b,l,h,r,q,m):(a=x.buffer,a.bind(),c.bufferData(34963,q,l),a.dtype=m||5121,a.usage=l,a.dimension=3,a.byteLength=q,x.primType=0>h?4:h,x.vertCount=0>r?0:r,x.type=a.dtype)}else z(),x.primType=4,x.vertCount=0,x.type=5121;return k}var z=h.create(null,34963,!0),x=new F(z._buffer);m.elementsCount++;k(b);k._reglType="elements";k._elements=x;
k.subdata=function(a,b){z.subdata(a,b);return k};k.destroy=function(){l(x)};return k},createStream:function(b){var c=k.pop();c||(c=new F(h.create(null,34963,!0)._buffer));C(c,b,35040,-1,-1,0,0);return c},destroyStream:function(b){k.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof F?b._elements:null},clear:function(){x(z).forEach(l)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],
11:[function(h,m,u){m.exports=function(g,d){function h(b){b=b.toLowerCase();var c;try{c=B[b]=g.getExtension(b)}catch(d){}return!!c}for(var B={},e=0;e<d.extensions.length;++e){var c=d.extensions[e];if(!h(c))return d.onDestroy(),d.onDone('"'+c+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}d.optionalExtensions.forEach(h);return{extensions:B}}},{}],12:[function(h,m,u){var g=h("./util/values"),d=h("./util/extend"),x=[];x[6408]=4;var B=
[];B[5121]=1;B[5126]=4;B[36193]=2;m.exports=function(e,c,b,h,m,F){function C(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var d=a=0;b?(a=b.width,d=b.height):c&&(a=c.width,d=c.height);this.width=a;this.height=d}function l(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function z(a,b,c){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function E(a,b){b?b.texture?e.framebufferTexture2D(36160,a,b.target,
b.texture._texture.texture,0):e.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):e.framebufferTexture2D(36160,a,3553,null,0)}function y(a){var b=3553,c=null,d=null,e=a;"object"===typeof a&&(e=a.data,"target"in a&&(b=a.target|0));a=e._reglType;"texture2d"===a?c=e:"textureCube"===a?c=e:"renderbuffer"===a&&(d=e,b=36161);return new C(b,c,d)}function k(a,b,c,d,e){if(c)return a=h.create2D({width:a,height:b,format:d,type:e}),a._texture.refCount=0,new C(3553,a,null);a=m.create({width:a,
height:b,format:d});a._renderbuffer.refCount=0;return new C(36161,null,a)}function r(a){return a&&(a.texture||a.renderbuffer)}function L(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function H(){this.id=Ga++;K[this.id]=this;this.framebuffer=e.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function I(a){a.colorAttachments.forEach(l);l(a.depthAttachment);l(a.stencilAttachment);
l(a.depthStencilAttachment)}function a(a){e.deleteFramebuffer(a.framebuffer);a.framebuffer=null;F.framebufferCount--;delete K[a.id]}function M(a){var c;e.bindFramebuffer(36160,a.framebuffer);var d=a.colorAttachments;for(c=0;c<d.length;++c)E(36064+c,d[c]);for(c=d.length;c<b.maxColorAttachments;++c)E(36064+c,null);E(36096,a.depthAttachment);E(36128,a.stencilAttachment);E(33306,a.depthStencilAttachment);e.checkFramebufferStatus(36160);e.bindFramebuffer(36160,u.next);u.cur=u.next;e.getError()}function ka(b,
c){function e(a,b){var c,d=0,l=0,h=!0,n=!0;c=null;var q=!0,m="rgba",C="uint8",F=1,E=null,D=null,T=null,ka=!1;if("number"===typeof a)d=a|0,l=b|0||d;else if(a){"shape"in a?(l=a.shape,d=l[0],l=l[1]):("radius"in a&&(d=l=a.radius),"width"in a&&(d=a.width),"height"in a&&(l=a.height));if("color"in a||"colors"in a)c=a.color||a.colors,Array.isArray(c);if(!c){"colorCount"in a&&(F=a.colorCount|0);"colorTexture"in a&&(q=!!a.colorTexture,m="rgba4");if("colorType"in a&&(C=a.colorType,!q))if("half float"===C||"float16"===
C)m="rgba16f";else if("float"===C||"float32"===C)m="rgba32f";"colorFormat"in a&&(m=a.colorFormat,0<=la.indexOf(m)?q=!0:0<=V.indexOf(m)&&(q=!1))}if("depthTexture"in a||"depthStencilTexture"in a)ka=!(!a.depthTexture&&!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?h=a.depth:(E=a.depth,n=!1));"stencil"in a&&("boolean"===typeof a.stencil?n=a.stencil:(D=a.stencil,h=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?h=n=a.depthStencil:(T=a.depthStencil,n=h=!1))}else d=l=1;var H=
null,L=null,u=null,K=null;if(Array.isArray(c))H=c.map(y);else if(c)H=[y(c)];else for(H=Array(F),c=0;c<F;++c)H[c]=k(d,l,q,m,C);d=d||H[0].width;l=l||H[0].height;E?L=y(E):h&&!n&&(L=k(d,l,ka,"depth","uint32"));D?u=y(D):n&&!h&&(u=k(d,l,!1,"stencil","uint8"));T?K=y(T):!E&&!D&&n&&h&&(K=k(d,l,ka,"depth stencil","depth stencil"));h=null;for(c=0;c<H.length;++c)z(H[c],d,l),H[c]&&H[c].texture&&(n=x[H[c].texture._texture.format]*B[H[c].texture._texture.type],null===h&&(h=n));z(L,d,l);z(u,d,l);z(K,d,l);I(g);g.width=
d;g.height=l;g.colorAttachments=H;g.depthAttachment=L;g.stencilAttachment=u;g.depthStencilAttachment=K;e.color=H.map(r);e.depth=r(L);e.stencil=r(u);e.depthStencil=r(K);e.width=g.width;e.height=g.height;M(g);return e}var g=new H;F.framebufferCount++;e(b,c);return d(e,{resize:function(a,b){var c=a|0,d=b|0||c;if(c===g.width&&d===g.height)return e;for(var k=g.colorAttachments,l=0;l<k.length;++l)L(k[l],c,d);L(g.depthAttachment,c,d);L(g.stencilAttachment,c,d);L(g.depthStencilAttachment,c,d);g.width=e.width=
c;g.height=e.height=d;M(g);return e},_reglType:"framebuffer",_framebuffer:g,destroy:function(){a(g);I(g)}})}var u={cur:null,next:null,dirty:!1},la=["rgba"],V=["rgba4","rgb565","rgb5 a1"];c.ext_srgb&&V.push("srgba");c.ext_color_buffer_half_float&&V.push("rgba16f","rgb16f");c.webgl_color_buffer_float&&V.push("rgba32f");var D=["uint8"];c.oes_texture_half_float&&D.push("half float","float16");c.oes_texture_float&&D.push("float","float32");var Ga=0,K={};return d(u,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof H)?a:null},create:ka,createCube:function(a){function b(a){var e,k={color:null},g=0,l=null;e="rgba";var n="uint8",r=1;if("number"===typeof a)g=a|0;else if(a){"shape"in a?g=a.shape[0]:("radius"in a&&(g=a.radius|0),"width"in a?g=a.width|0:"height"in a&&(g=a.height|0));if("color"in a||"colors"in a)l=a.color||a.colors,Array.isArray(l);l||("colorCount"in a&&(r=a.colorCount|0),"colorType"in a&&(n=a.colorType),"colorFormat"in a&&(e=a.colorFormat));
"depth"in a&&(k.depth=a.depth);"stencil"in a&&(k.stencil=a.stencil);"depthStencil"in a&&(k.depthStencil=a.depthStencil)}else g=1;if(l)if(Array.isArray(l))for(a=[],e=0;e<l.length;++e)a[e]=l[e];else a=[l];else for(a=Array(r),l={radius:g,format:e,type:n},e=0;e<r;++e)a[e]=h.createCube(l);k.color=Array(a.length);for(e=0;e<a.length;++e)r=a[e],g=g||r.width,k.color[e]={target:34069,data:a[e]};for(e=0;6>e;++e){for(r=0;r<a.length;++r)k.color[r].target=34069+e;0<e&&(k.depth=c[0].depth,k.stencil=c[0].stencil,
k.depthStencil=c[0].depthStencil);if(c[e])c[e](k);else c[e]=ka(k)}return d(b,{width:g,height:g,color:a})}var c=Array(6);b(a);return d(b,{faces:c,resize:function(a){var d=a|0;if(d===b.width)return b;var e=b.color;for(a=0;a<e.length;++a)e[a].resize(d);for(a=0;6>a;++a)c[a].resize(d);b.width=b.height=d;return b},_reglType:"framebufferCube",destroy:function(){c.forEach(function(a){a.destroy()})}})},clear:function(){g(K).forEach(a)}})}},{"./util/extend":23,"./util/values":31}],13:[function(h,m,u){m.exports=
function(g,d){var h=1;d.ext_texture_filter_anisotropic&&(h=g.getParameter(34047));var B=1,e=1;d.webgl_draw_buffers&&(B=g.getParameter(34852),e=g.getParameter(36063));return{colorBits:[g.getParameter(3410),g.getParameter(3411),g.getParameter(3412),g.getParameter(3413)],depthBits:g.getParameter(3414),stencilBits:g.getParameter(3415),subpixelBits:g.getParameter(3408),extensions:Object.keys(d).filter(function(c){return!!d[c]}),maxAnisotropic:h,maxDrawbuffers:B,maxColorAttachments:e,pointSizeDims:g.getParameter(33901),
lineWidthDims:g.getParameter(33902),maxViewportDims:g.getParameter(3386),maxCombinedTextureUnits:g.getParameter(35661),maxCubeMapSize:g.getParameter(34076),maxRenderbufferSize:g.getParameter(34024),maxTextureUnits:g.getParameter(34930),maxTextureSize:g.getParameter(3379),maxAttributes:g.getParameter(34921),maxVertexUniforms:g.getParameter(36347),maxVertexTextureUnits:g.getParameter(35660),maxVaryingVectors:g.getParameter(36348),maxFragmentUniforms:g.getParameter(36349),glsl:g.getParameter(35724),
renderer:g.getParameter(7937),vendor:g.getParameter(7936),version:g.getParameter(7938)}}},{}],14:[function(h,m,u){var g=h("./util/is-typed-array");m.exports=function(d,h,B,e,c,b){return function(b){var c;c=null===h.next?5121:h.next.colorAttachments[0].texture._texture.type;var m=0,C=0,l=e.framebufferWidth,z=e.framebufferHeight,E=null;g(b)?E=b:b&&(m=b.x|0,C=b.y|0,l=(b.width||e.framebufferWidth-m)|0,z=(b.height||e.framebufferHeight-C)|0,E=b.data||null);B();b=l*z*4;E||(5121===c?E=new Uint8Array(b):5126===
c&&(E=E||new Float32Array(b)));d.pixelStorei(3333,4);d.readPixels(m,C,l,z,6408,c,E);return E}}},{"./util/is-typed-array":26}],15:[function(h,m,u){var g=h("./util/values"),d=[];d[32854]=2;d[32855]=2;d[36194]=2;d[33189]=2;d[36168]=1;d[34041]=4;d[35907]=4;d[34836]=16;d[34842]=8;d[34843]=6;m.exports=function(h,B,e,c,b){function q(c){this.id=C++;this.refCount=1;this.renderbuffer=c;this.format=32854;this.height=this.width=0;b.profile&&(this.stats={size:0})}function m(b){var d=b.renderbuffer;h.bindRenderbuffer(36161,
null);h.deleteRenderbuffer(d);b.renderbuffer=null;b.refCount=0;delete l[b.id];c.renderbufferCount--}var F={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};B.ext_srgb&&(F.srgba=35907);B.ext_color_buffer_half_float&&(F.rgba16f=34842,F.rgb16f=34843);B.webgl_color_buffer_float&&(F.rgba32f=34836);var C=0,l={};q.prototype.decRef=function(){0>=--this.refCount&&m(this)};b.profile&&(c.getTotalRenderbufferSize=function(){var b=0;Object.keys(l).forEach(function(c){b+=
l[c].stats.size});return b});return{create:function(e,g){function y(c,e){var g=0,l=0,a=32854;"object"===typeof c&&c?("shape"in c?(l=c.shape,g=l[0]|0,l=l[1]|0):("radius"in c&&(g=l=c.radius|0),"width"in c&&(g=c.width|0),"height"in c&&(l=c.height|0)),"format"in c&&(a=F[c.format])):"number"===typeof c?(g=c|0,l="number"===typeof e?e|0:g):c||(g=l=1);if(g!==k.width||l!==k.height||a!==k.format)return y.width=k.width=g,y.height=k.height=l,k.format=a,h.bindRenderbuffer(36161,k.renderbuffer),h.renderbufferStorage(36161,
a,g,l),b.profile&&(k.stats.size=d[k.format]*k.width*k.height),y}var k=new q(h.createRenderbuffer());l[k.id]=k;c.renderbufferCount++;y(e,g);y.resize=function(c,e){var g=c|0,l=e|0||g;if(g===k.width&&l===k.height)return y;y.width=k.width=g;y.height=k.height=l;h.bindRenderbuffer(36161,k.renderbuffer);h.renderbufferStorage(36161,k.format,g,l);b.profile&&(k.stats.size=d[k.format]*k.width*k.height);return y};y._reglType="renderbuffer";y._renderbuffer=k;b.profile&&(y.stats=k.stats);y.destroy=function(){k.decRef()};
return y},clear:function(){g(l).forEach(m)}}}},{"./util/values":31}],16:[function(h,m,u){var g=h("./util/values");m.exports=function(d,h,m,e){function c(b,c,d,e){this.name=b;this.id=c;this.location=d;this.info=e}function b(b,c){for(var d=0;d<b.length;++d)if(b[d].id===c.id){b[d].location=c.location;return}b.push(c)}function q(b,c,e){e=35632===b?F:C;var g=e[c];if(!g){var l=h.str(c),g=d.createShader(b);d.shaderSource(g,l);d.compileShader(g);e[c]=g}return g}function T(b,c){this.id=E++;this.fragId=b;this.vertId=
c;this.program=null;this.uniforms=[];this.attributes=[];e.profile&&(this.stats={uniformsCount:0,attributesCount:0})}var F={},C={},l={},z=[],E=0;e.profile&&(m.getMaxUniformsCount=function(){var b=0;z.forEach(function(c){c.stats.uniformsCount>b&&(b=c.stats.uniformsCount)});return b},m.getMaxAttributesCount=function(){var b=0;z.forEach(function(c){c.stats.attributesCount>b&&(b=c.stats.attributesCount)});return b});return{clear:function(){var b=d.deleteShader.bind(d);g(F).forEach(b);F={};g(C).forEach(b);
C={};z.forEach(function(b){d.deleteProgram(b.program)});z.length=0;l={};m.shaderCount=0},program:function(g,k,r){m.shaderCount++;(r=l[k])||(r=l[k]={});var C=r[g];if(!C){var F=C=new T(k,g),E,a;E=q(35632,F.fragId);a=q(35633,F.vertId);k=F.program=d.createProgram();d.attachShader(k,E);d.attachShader(k,a);d.linkProgram(k);var M=d.getProgramParameter(k,35718);e.profile&&(F.stats.uniformsCount=M);var ka=F.uniforms;for(E=0;E<M;++E)if(a=d.getActiveUniform(k,E))if(1<a.size)for(var u=0;u<a.size;++u){var la=
a.name.replace("[0]","["+u+"]");b(ka,new c(la,h.id(la),d.getUniformLocation(k,la),a))}else b(ka,new c(a.name,h.id(a.name),d.getUniformLocation(k,a.name),a));M=d.getProgramParameter(k,35721);e.profile&&(F.stats.attributesCount=M);F=F.attributes;for(E=0;E<M;++E)(a=d.getActiveAttrib(k,E))&&b(F,new c(a.name,h.id(a.name),d.getAttribLocation(k,a.name),a));r[g]=C;z.push(C)}return C},shader:q,frag:null,vert:null}}},{"./util/values":31}],17:[function(h,m,u){m.exports=function(){return{bufferCount:0,elementsCount:0,
framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(h,m,u){m.exports=function(){var g={"":0},d=[""];return{id:function(h){var m=g[h];if(m)return m;m=g[h]=d.length;d.push(h);return m},str:function(g){return d[g]}}}},{}],19:[function(h,m,u){function g(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function d(a){return Array.isArray(a)&&0!==a.length&&z(a[0])?!0:!1}function x(a){return Object.prototype.toString.call(a)}
function B(a){if(!a)return!1;var b=x(a);return 0<=L.indexOf(b)?!0:g(a)||d(a)||F(a)}function e(a,b){36193===a.type?(a.data=l(b),C.freeType(b)):a.data=b}function c(a,b,c,d,e,g){a="undefined"!==typeof I[a]?I[a]:r[a]*H[b];g&&(a*=6);if(e){for(d=0;1<=c;)d+=a*c*c,c/=2;return d}return a*c*d}var b=h("./util/extend"),q=h("./util/values"),T=h("./util/is-typed-array"),F=h("./util/is-ndarray"),C=h("./util/pool"),l=h("./util/to-half-float"),z=h("./util/is-array-like");u=h("./constants/arraytypes.json");var E=h("./constants/arraytypes.json"),
y=[9984,9986,9985,9987],k=[0,6409,6410,6407,6408],r={};r[6409]=r[6406]=r[6402]=1;r[34041]=r[6410]=2;r[6407]=r[35904]=3;r[6408]=r[35906]=4;var L=Object.keys(u).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),H=[];H[5121]=1;H[5126]=4;H[36193]=2;H[5123]=2;H[5125]=4;var I=[];I[32854]=2;I[32855]=2;I[36194]=2;I[34041]=4;I[33776]=.5;I[33777]=.5;I[33778]=1;I[33779]=1;I[35986]=.5;I[35987]=1;I[34798]=1;I[35840]=.5;I[35841]=.25;
I[35842]=.5;I[35843]=.25;I[36196]=.5;m.exports=function(a,h,m,u,I,H,D){function L(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function K(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;
a.height=b.height;a.channels=b.channels}function n(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=va[b.colorSpace]);"type"in b&&(a.type=X[b.type]);var c=a.width,d=a.height,e=a.channels,g=!1;"shape"in b?(c=b.shape[0],d=b.shape[1],3===b.shape.length&&(e=b.shape[2],g=!0)):("radius"in b&&(c=d=b.radius),"width"in b&&(c=b.width),"height"in b&&(d=
b.height),"channels"in b&&(e=b.channels,g=!0));a.width=c|0;a.height=d|0;a.channels=e|0;c=!1;"format"in b&&(c=b.format,d=a.internalformat=ca[c],a.format=La[d],c in X&&!("type"in b)&&(a.type=X[c]),c in da&&(a.compressed=!0),c=!0);!g&&c?a.channels=r[a.format]:g&&!c&&a.channels!==k[a.format]&&(a.format=a.internalformat=k[a.channels])}}function R(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function ea(){L.call(this);
this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function v(a,b){var c=null;B(b)?c=b:b&&(n(a,b),"x"in b&&(a.xOffset=b.x|0),"y"in b&&(a.yOffset=b.y|0),B(b.data)&&(c=b.data));if(b.copy){var h=I.viewportWidth,m=I.viewportHeight;a.width=a.width||h-a.xOffset;a.height=a.height||m-a.yOffset;a.needsCopy=!0}else if(!c)a.width=a.width||1,a.height=a.height||1;else if(T(c))a.data=c,"type"in b||5121!==a.type||(a.type=E[Object.prototype.toString.call(c)]|0);else if(g(c)){h=
c;m=a.width*a.height*a.channels;switch(a.type){case 5121:case 5123:case 5125:case 5126:m=C.allocType(a.type,m);m.set(h);a.data=m;break;case 36193:a.data=l(h)}a.alignment=1;a.needsFree=!0}else if(F(c)){h=c.data;Array.isArray(h)||5121!==a.type||(a.type=E[Object.prototype.toString.call(h)]|0);var m=c.shape,q=c.stride,r,y,D,v;3===m.length?(D=m[2],v=q[2]):v=D=1;r=m[0];y=m[1];m=q[0];q=q[1];a.alignment=1;a.width=r;a.height=y;a.channels=D;a.format=a.internalformat=k[D];a.needsFree=!0;r=v;c=c.offset;D=a.width;
v=a.height;y=a.channels;for(var M=C.allocType(36193===a.type?5126:a.type,D*v*y),u=0,t=0;t<v;++t)for(var A=0;A<D;++A)for(var K=0;K<y;++K)M[u++]=h[m*A+q*t+r*K+c];e(a,M)}else if("[object HTMLCanvasElement]"===x(c)||"[object CanvasRenderingContext2D]"===x(c))"[object HTMLCanvasElement]"===x(c)?a.element=c:a.element=c.canvas,a.width=a.element.width,a.height=a.element.height;else if("[object HTMLImageElement]"===x(c))a.element=c,a.width=c.naturalWidth,a.height=c.naturalHeight;else if("[object HTMLVideoElement]"===
x(c))a.element=c,a.width=c.videoWidth,a.height=c.videoHeight,a.needsPoll=!0;else if(d(c)){h=c[0].length;m=c.length;q=1;if(z(c[0][0])){r=q=c[0][0].length;D=C.allocType(36193===a.type?5126:a.type,h*m*r);for(y=v=0;y<m;++y)for(M=c[y],u=0;u<h;++u)for(t=M[u],A=0;A<r;++A)D[v++]=t[A];e(a,D)}else{r=C.allocType(36193===a.type?5126:a.type,h*m);for(v=D=0;v<m;++v)for(y=c[v],M=0;M<h;++M)r[D++]=y[M];e(a,r)}a.alignment=1;a.width=h;a.height=m;a.channels=q;a.format=a.internalformat=k[q];a.needsFree=!0}}function S(b,
c,d,e,g){var l=b.element,k=b.data,h=b.internalformat,m=b.format,n=b.type,q=b.width,r=b.height;R(b);l?a.texSubImage2D(c,g,d,e,m,n,l):b.compressed?a.compressedTexSubImage2D(c,g,d,e,h,q,r,k):b.needsCopy?(u(),a.copyTexSubImage2D(c,g,d,e,b.xOffset,b.yOffset,q,r)):a.texSubImage2D(c,g,d,e,q,r,m,n,k)}function Y(){return Ma.pop()||new ea}function fa(a){a.needsFree&&C.freeType(a.data);ea.call(a);Ma.push(a)}function ga(){L.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}
function P(a,b,c){var d=a.images[0]=Y();a.mipmask=1;d.width=a.width=b;d.height=a.height=c}function N(a,b){var c=null;if(B(b))c=a.images[0]=Y(),K(c,a),v(c,b),a.mipmask=1;else if(n(a,b),Array.isArray(b.mipmap))for(var d=b.mipmap,e=0;e<d.length;++e)c=a.images[e]=Y(),K(c,a),c.width>>=e,c.height>>=e,v(c,d[e]),a.mipmask|=1<<e;else c=a.images[0]=Y(),K(c,a),v(c,b),a.mipmask=1;K(a,a.images[0])}function Z(b,c){for(var d=b.images,e=0;e<d.length&&d[e];++e){var g=d[e],l=c,k=e,h=g.element,m=g.data,n=g.internalformat,
q=g.format,r=g.type,t=g.width,z=g.height;R(g);h?a.texImage2D(l,k,q,q,r,h):g.compressed?a.compressedTexImage2D(l,k,n,t,z,0,m):g.needsCopy?(u(),a.copyTexImage2D(l,k,q,g.xOffset,g.yOffset,t,z,0)):a.texImage2D(l,k,q,t,z,0,q,r,m)}}function pa(){var a=Na.pop()||new ga;L.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function ua(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&fa(b[c]),b[c]=null;Na.push(a)}function ia(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=
1;this.genMipmaps=!1;this.mipmapHint=4352}function qa(a,b){"min"in b&&(a.minFilter=Da[b.min],0<=y.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=Ca[b.mag]);var c=a.wrapS,d=a.wrapT;if("wrap"in b){var e=b.wrap;"string"===typeof e?c=d=ba[e]:Array.isArray(e)&&(c=ba[e[0]],d=ba[e[1]])}else"wrapS"in b&&(c=ba[b.wrapS]),"wrapT"in b&&(d=ba[b.wrapT]);a.wrapS=c;a.wrapT=d;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=
xa[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function ja(b,c){a.texParameteri(c,10241,b.minFilter);a.texParameteri(c,10240,b.magFilter);a.texParameteri(c,10242,b.wrapS);a.texParameteri(c,10243,b.wrapT);h.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(c))}function aa(){var a=wa.pop()||new ia;ia.call(a);return a}
function ra(b){L.call(this);this.mipmask=0;this.internalformat=6408;this.id=Oa++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;D.profile&&(this.stats={size:0})}function U(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function Q(){var b=ta[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function W(b){var c=b.texture,d=b.unit,e=b.target;0<=d&&(a.activeTexture(33984+d),a.bindTexture(e,null),ta[d]=null);a.deleteTexture(c);b.texture=
null;b.params=null;b.pixels=null;b.refCount=0;delete sa[b.id];H.textureCount--}var xa={"don't care":4352,"dont care":4352,nice:4354,fast:4353},ba={repeat:10497,clamp:33071,mirror:33648},Ca={nearest:9728,linear:9729},Da=b({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},Ca),va={none:0,browser:37444},X={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},ca={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,
rgba4:32854,"rgb5 a1":32855,rgb565:36194},da={};h.ext_srgb&&(ca.srgb=35904,ca.srgba=35906);h.oes_texture_float&&(X.float32=X["float"]=5126);h.oes_texture_half_float&&(X.float16=X["half float"]=36193);h.webgl_depth_texture&&(b(ca,{depth:6402,"depth stencil":34041}),b(X,{uint16:5123,uint32:5125,"depth stencil":34042}));h.webgl_compressed_texture_s3tc&&b(da,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});h.webgl_compressed_texture_atc&&b(da,{"rgb atc":35986,
"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});h.webgl_compressed_texture_pvrtc&&b(da,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});h.webgl_compressed_texture_etc1&&(da["rgb etc1"]=36196);var Ea=Array.prototype.slice.call(a.getParameter(34467));Object.keys(da).forEach(function(a){var b=da[a];0<=Ea.indexOf(b)&&(ca[a]=b)});var ya=Object.keys(ca);m.textureFormats=ya;var La=ya.reduce(function(a,b){var c=ca[b];6409===c||
6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),Ma=[],Na=[],wa=[],Oa=0,sa={},Fa=m.maxTextureUnits,ta=Array(Fa).map(function(){return null});b(ra.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<Fa;++c){var d=ta[c];if(d){if(0<d.bindCount)continue;d.unit=-1}ta[c]=this;b=c;break}D.profile&&H.maxTextureUnits<b+1&&(H.maxTextureUnits=b+1);this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,
this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&W(this)}});D.profile&&(H.getTotalTextureSize=function(){var a=0;Object.keys(sa).forEach(function(b){a+=sa[b].stats.size});return a});return{create2D:function(b,d){function e(a,b){var d=aa(),f=pa();"number"===typeof a?"number"===typeof b?P(f,a|0,b|0):P(f,a|0,a|0):a?(qa(d,a),N(f,a)):P(f,1,1);d.genMipmaps&&(f.mipmask=(f.width<<1)-1);g.mipmask=f.mipmask;K(g,f);g.internalformat=f.internalformat;e.width=f.width;
e.height=f.height;U(g);Z(f,3553);ja(d,3553);Q();wa.push(d);ua(f);D.profile&&(g.stats.size=c(g.internalformat,g.type,f.width,f.height,d.genMipmaps,!1));return e}var g=new ra(3553);sa[g.id]=g;H.textureCount++;e(b,d);e.subimage=function(a,b,c,d){b|=0;c|=0;d|=0;var f=Y();K(f,g);f.width>>=d;f.height>>=d;f.width-=b;f.height-=c;v(f,a);U(g);S(f,3553,b,c,d);Q();fa(f);return e};e.resize=function(b,d){var f=b|0,l=d|0||f;if(f===g.width&&l===g.height)return e;e.width=g.width=f;e.height=g.height=l;U(g);for(var k=
0;g.mipmask>>k;++k)a.texImage2D(3553,k,g.format,f>>k,l>>k,0,g.format,g.type,null);Q();D.profile&&(g.stats.size=c(g.internalformat,g.type,f,l,!1,!1));return e};e._reglType="texture2d";e._texture=g;D.profile&&(e.stats=g.stats);e.destroy=function(){g.decRef()};return e},createCube:function(b,d,e,g,l,k){function h(a,b,d,f,e,g){var l,k=aa();for(l=0;6>l;++l)q[l]=pa();if("number"===typeof a||!a)for(a=a|0||1,l=0;6>l;++l)P(q[l],a,a);else if("object"===typeof a)if(b)N(q[0],a),N(q[1],b),N(q[2],d),N(q[3],f),
N(q[4],e),N(q[5],g);else if(qa(k,a),n(m,a),"faces"in a)for(a=a.faces,l=0;6>l;++l)K(q[l],m),N(q[l],a[l]);else for(l=0;6>l;++l)N(q[l],a);K(m,q[0]);m.mipmask=k.genMipmaps?(q[0].width<<1)-1:q[0].mipmask;m.internalformat=q[0].internalformat;h.width=q[0].width;h.height=q[0].height;U(m);for(l=0;6>l;++l)Z(q[l],34069+l);ja(k,34067);Q();D.profile&&(m.stats.size=c(m.internalformat,m.type,h.width,h.height,k.genMipmaps,!0));wa.push(k);for(l=0;6>l;++l)ua(q[l]);return h}var m=new ra(34067);sa[m.id]=m;H.cubeCount++;
var q=Array(6);h(b,d,e,g,l,k);h.subimage=function(a,b,c,d,f){c|=0;d|=0;f|=0;var e=Y();K(e,m);e.width>>=f;e.height>>=f;e.width-=c;e.height-=d;v(e,b);U(m);S(e,34069+a,c,d,f);Q();fa(e);return h};h.resize=function(b){b|=0;if(b!==m.width){h.width=m.width=b;h.height=m.height=b;U(m);for(var d=0;6>d;++d)for(var f=0;m.mipmask>>f;++f)a.texImage2D(34069+d,f,m.format,b>>f,b>>f,0,m.format,m.type,null);Q();D.profile&&(m.stats.size=c(m.internalformat,m.type,h.width,h.height,!1,!0));return h}};h._reglType="textureCube";
h._texture=m;D.profile&&(h.stats=m.stats);h.destroy=function(){m.decRef()};return h},clear:function(){for(var b=0;b<Fa;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),ta[b]=null;q(sa).forEach(W);H.cubeCount=0;H.textureCount=0},getTexture:function(a){return null}}}},{"./constants/arraytypes.json":4,"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/to-half-float":30,"./util/values":31}],20:[function(h,m,u){m.exports=function(g,
d){function h(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function m(b,c,d){var e=q.pop()||new h;e.startQueryIndex=b;e.endQueryIndex=c;e.sum=0;e.stats=d;u.push(e)}var e=d.ext_disjoint_timer_query;if(!e)return null;var c=[],b=[],q=[],u=[],F=[],C=[];return{beginQuery:function(d){var g=c.pop()||e.createQueryEXT();e.beginQueryEXT(35007,g);b.push(g);m(b.length-1,b.length,d)},endQuery:function(){e.endQueryEXT(35007)},pushScopeStats:m,update:function(){var d,g;d=b.length;if(0!==
d){C.length=Math.max(C.length,d+1);F.length=Math.max(F.length,d+1);F[0]=0;var h=C[0]=0;for(g=d=0;g<b.length;++g){var m=b[g];e.getQueryObjectEXT(m,34919)?(h+=e.getQueryObjectEXT(m,34918),c.push(m)):b[d++]=m;F[g+1]=h;C[g+1]=d}b.length=d;for(g=d=0;g<u.length;++g){var h=u[g],k=h.startQueryIndex,m=h.endQueryIndex;h.sum+=F[m]-F[k];k=C[k];m=C[m];m===k?(h.stats.gpuTime+=h.sum/1E6,q.push(h)):(h.startQueryIndex=k,h.endQueryIndex=m,u[d++]=h)}u.length=d}},getNumPendingQueries:function(){return b.length},clear:function(){c.push.apply(c,
b);for(var d=0;d<c.length;d++)e.deleteQueryEXT(c[d]);b.length=0;c.length=0}}}},{}],21:[function(h,m,u){m.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(h,m,u){function g(d){return Array.prototype.slice.call(d)}function d(d){return g(d).join("")}var x=h("./extend");m.exports=function(){function h(){var b=[],e=[];return x(function(){b.push.apply(b,g(arguments))},{def:function(){var d="v"+c++;e.push(d);0<arguments.length&&
(b.push(d,"="),b.push.apply(b,g(arguments)),b.push(";"));return d},toString:function(){return d([0<e.length?"var "+e+";":"",d(b)])}})}function e(){function b(e,g){d(e,g,"=",c.def(e,g),";")}var c=h(),d=h(),e=c.toString,m=d.toString;return x(function(){c.apply(c,g(arguments))},{def:c.def,entry:c,exit:d,save:b,set:function(d,e,g){b(d,e);c(d,e,"=",g,";")},toString:function(){return e()+m()}})}var c=0,b=[],m=[],u=h(),F={};return{global:u,link:function(d){for(var e=0;e<m.length;++e)if(m[e]===d)return b[e];
e="g"+c++;b.push(e);m.push(d);return e},block:h,proc:function(b,c){function g(){var b="a"+h.length;h.push(b);return b}var h=[];c=c||0;for(var m=0;m<c;++m)g();var m=e(),k=m.toString;return F[b]=x(m,{arg:g,toString:function(){return d(["function(",h.join(),"){",k(),"}"])}})},scope:e,cond:function(){var b=d(arguments),c=e(),h=e(),m=c.toString,q=h.toString;return x(c,{then:function(){c.apply(c,g(arguments));return this},"else":function(){h.apply(h,g(arguments));return this},toString:function(){var c=
q();c&&(c="else{"+c+"}");return d(["if(",b,"){",m(),"}",c])}})},compile:function(){var c=['"use strict";',u,"return {"];Object.keys(F).forEach(function(b){c.push('"',b,'":',F[b].toString(),",")});c.push("}");var e=d(c).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,b.concat(e)).apply(null,m)}}}},{"./extend":23}],23:[function(h,m,u){m.exports=function(g,d){for(var h=Object.keys(d),m=0;m<h.length;++m)g[h[m]]=d[h[m]];return g}},{}],24:[function(h,m,u){var g=h("./is-typed-array");
m.exports=function(d){return Array.isArray(d)||g(d)}},{"./is-typed-array":26}],25:[function(h,m,u){var g=h("./is-typed-array");m.exports=function(d){return!!d&&"object"===typeof d&&Array.isArray(d.shape)&&Array.isArray(d.stride)&&"number"===typeof d.offset&&d.shape.length===d.stride.length&&(Array.isArray(d.data)||g(d.data))}},{"./is-typed-array":26}],26:[function(h,m,u){var g=h("../constants/arraytypes.json");m.exports=function(d){return Object.prototype.toString.call(d)in g}},{"../constants/arraytypes.json":4}],
27:[function(h,m,u){m.exports=function(g,d){for(var h=Array(g),m=0;m<g;++m)h[m]=d(m);return h}},{}],28:[function(h,m,u){function g(d){var c,b;c=(65535<d)<<4;d>>>=c;b=(255<d)<<3;d>>>=b;c|=b;b=(15<d)<<2;d>>>=b;c|=b;b=(3<d)<<1;return c|b|d>>>b>>1}function d(d){a:{for(var c=16;268435456>=c;c*=16)if(d<=c){d=c;break a}d=0}c=B[g(d)>>2];return 0<c.length?c.pop():new ArrayBuffer(d)}function x(d){B[g(d.byteLength)>>2].push(d)}var B=h("./loop")(8,function(){return[]});m.exports={alloc:d,free:x,allocType:function(e,
c){var b=null;switch(e){case 5120:b=new Int8Array(d(c),0,c);break;case 5121:b=new Uint8Array(d(c),0,c);break;case 5122:b=new Int16Array(d(2*c),0,c);break;case 5123:b=new Uint16Array(d(2*c),0,c);break;case 5124:b=new Int32Array(d(4*c),0,c);break;case 5125:b=new Uint32Array(d(4*c),0,c);break;case 5126:b=new Float32Array(d(4*c),0,c);break;default:return null}return b.length!==c?b.subarray(0,c):b},freeType:function(d){x(d.buffer)}}},{"./loop":27}],29:[function(h,m,u){m.exports="function"===typeof requestAnimationFrame&&
"function"===typeof cancelAnimationFrame?{next:function(g){return requestAnimationFrame(g)},cancel:function(g){return cancelAnimationFrame(g)}}:{next:function(g){return setTimeout(g,16)},cancel:clearTimeout}},{}],30:[function(h,m,u){var g=h("./pool"),d=new Float32Array(1),x=new Uint32Array(d.buffer);m.exports=function(h){for(var e=g.allocType(5123,h.length),c=0;c<h.length;++c)if(isNaN(h[c]))e[c]=65535;else if(Infinity===h[c])e[c]=31744;else if(-Infinity===h[c])e[c]=64512;else{d[0]=h[c];var b=x[0],
m=b>>>31<<15,u=(b<<1>>>24)-127,b=b>>13&1023;e[c]=-24>u?m:-14>u?m+(b+1024>>-14-u):15<u?m+31744:m+(u+15<<10)+b}return e}},{"./pool":28}],31:[function(h,m,u){m.exports=function(g){return Object.keys(g).map(function(d){return g[d]})}},{}],32:[function(h,m,u){function g(c,b,d){function g(){var b=window.innerWidth,l=window.innerHeight;c!==document.body&&(l=c.getBoundingClientRect(),b=l.right-l.left,l=l.top-l.bottom);h.width=d*b;h.height=d*l;e(h.style,{width:b+"px",height:l+"px"})}var h=document.createElement("canvas");
e(h.style,{border:0,margin:0,padding:0,top:0,left:0});c.appendChild(h);c===document.body&&(h.style.position="absolute",e(c.style,{margin:0,padding:0}));window.addEventListener("resize",g,!1);g();return{canvas:h,onDestroy:function(){window.removeEventListener("resize",g);c.removeChild(h)}}}function d(c,b){function d(e){try{return c.getContext(e,b)}catch(g){return null}}return d("webgl")||d("experimental-webgl")||d("webgl-experimental")}function x(c){return"string"===typeof c?c.split():c}function B(c){return"string"===
typeof c?document.querySelector(c):c}var e=h("./util/extend");m.exports=function(c){var b=c||{},e,h,m,u;c={};var l=[],z=[],E="undefined"===typeof window?1:window.devicePixelRatio,y=!1,k=function(b){},r=function(){};"string"===typeof b?e=document.querySelector(b):"object"===typeof b&&("string"===typeof b.nodeName&&"function"===typeof b.appendChild&&"function"===typeof b.getBoundingClientRect?e=b:"function"===typeof b.drawArrays||"function"===typeof b.drawElements?(u=b,m=u.canvas):("gl"in b?u=b.gl:
"canvas"in b?m=B(b.canvas):"container"in b&&(h=B(b.container)),"attributes"in b&&(c=b.attributes),"extensions"in b&&(l=x(b.extensions)),"optionalExtensions"in b&&(z=x(b.optionalExtensions)),"onDone"in b&&(k=b.onDone),"profile"in b&&(y=!!b.profile),"pixelRatio"in b&&(E=+b.pixelRatio)));e&&("canvas"===e.nodeName.toLowerCase()?m=e:h=e);if(!u){if(!m){e=g(h||document.body,k,E);if(!e)return null;m=e.canvas;r=e.onDestroy}u=d(m,c)}return u?{gl:u,canvas:m,container:h,extensions:l,optionalExtensions:z,pixelRatio:E,
profile:y,onDone:k,onDestroy:r}:(r(),k("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/extend":23}],33:[function(h,m,u){function g(c){return c.charCodeAt(0)+(c.charCodeAt(1)<<8)+(c.charCodeAt(2)<<16)+(c.charCodeAt(3)<<24)}var d=g("DXT1"),x=g("DXT3"),B=g("DXT5"),e=g("DX10");m.exports=function(c){var b=new Int32Array(c,0,31);if(542327876!==b[0])throw Error("Invalid magic number in DDS header");if(!b[20]&4)throw Error("Unsupported format, must contain a FourCC code");
var g,h=b[21];switch(h){case d:g=8;c="dxt1";break;case x:g=16;c="dxt3";break;case B:g=16;c="dxt5";break;case 116:c="rgba32f";break;case e:var m=new Uint32Array(c.slice(128,148));c=m[0];if(3===m[1]&&2===c)c="rgba32f";else throw Error("Unsupported DX10 texture format "+c);break;default:throw Error("Unsupported FourCC code: "+String.fromCharCode(h&255,h>>8&255,h>>16&255,h>>24&255));}var m=b[2],u=1;m&131072&&(u=Math.max(1,b[7]));var l=!1;b[28]&512&&(l=!0);var z=b[4],E=b[3],b=b[1]+4,y=z,k=E,r=[];h===e&&
(b+=20);if(l)for(g=0;6>g;g++){if("rgba32f"!==c)throw Error("Only RGBA32f cubemaps are supported");for(var z=y,E=k,L=Math.log(z)/Math.log(2)+1,H=0;H<L;H++)h=z*E*16,r.push({offset:b,length:h,shape:[z,E]}),H<u&&(b+=h),z=Math.floor(z/2),E=Math.floor(E/2)}else for(H=0;H<u;H++)h=Math.max(4,z)/4*Math.max(4,E)/4*g,r.push({offset:b,length:h,shape:[z,E]}),b+=h,z=Math.floor(z/2),E=Math.floor(E/2);return{shape:[y,k],images:r,format:c,flags:m,cubemap:l}}},{}],34:[function(h,m,u){function g(b){throw Error("resl: "+
b);}function d(b,c,d){Object.keys(b).forEach(function(b){0>c.indexOf(b)&&g('invalid parameter "'+b+'" in '+d)})}function x(b,c){this.state=0;this.ready=!1;this.progress=0;this.name=b;this.cancel=c}var B=["manifest","onDone","onProgress","onError"],e=["type","src","stream","credentials","parser"],c=["onData","onDone"];m.exports=function(b){function h(a,c){if(a in b){var d=b[a];"function"!==typeof d&&g('invalid callback "'+a+'"');return d}return null}function m(a){function b(){if(!(2>h.readyState||
1===q.state||-1===q.state)){if(200!==h.status)return C('error loading resource "'+a.name+'"');if(2<h.readyState&&0===q.state){var d;d="binary"===a.type?h.response:h.responseText;if(g.data)try{k=g.data(d)}catch(e){return C(e)}else k=d}if(3<h.readyState&&0===q.state){if(g.done)try{k=g.done()}catch(e){return C(e)}q.state=1}r[c]=k;q.progress=.75*q.progress+.25;q.ready=a.stream&&!!k||1===q.state;l()}}var c=a.name,d=a.stream,e="binary"===a.type,g=a.parser,h=new XMLHttpRequest,k=null,q=new x(c,function(){1!==
q.state&&-1!==q.state&&(h.onreadystatechange=null,h.abort(),q.state=-1)});h.onreadystatechange=d?b:function(){4===h.readyState&&b()};e&&(h.responseType="arraybuffer");a.credentials&&(h.withCredentials=!0);h.open("GET",a.src,!0);h.send();return q}function u(a,b){function c(){if(0===n.state)if(m.data)try{q=m.data(b)}catch(a){return C(a)}else q=b}function d(b){c();r[k]=q;n.progress=b.lengthComputable?Math.max(n.progress,b.loaded/b.total):.75*n.progress+.25;n.ready=a.stream;l(k)}function e(){c();if(0===
n.state){if(m.done)try{q=m.done()}catch(a){return C(a)}n.state=1}n.progress=1;n.ready=!0;r[k]=q;h();l("finish "+k)}function g(){C('error loading asset "'+k+'"')}function h(){a.stream&&b.removeEventListener("progress",d);"image"===a.type?b.addEventListener("load",e):b.addEventListener("canplay",e);b.removeEventListener("error",g)}var k=a.name,m=a.parser,n=new x(k,function(){1!==n.state&&-1!==n.state&&(n.state=-1,h(),b.src="")}),q=b;a.stream&&b.addEventListener("progress",d);"image"===a.type?b.addEventListener("load",
e):b.addEventListener("canplay",e);b.addEventListener("error",g);b.crossOrigin=a.credentials?"use-credentials":"anonymous";b.src=a.src;return n}function C(a){-1!==L&&1!==L&&(L=-1,I.forEach(function(a){a.cancel()}),k?"string"===typeof a?k(Error("resl: "+a)):k(a):console.error("resl error:",a))}function l(a){if(-1!==L&&1!==L){var b=0,c=0;I.forEach(function(a){a.ready&&(c+=1);b+=a.progress});c===I.length?(L=1,E(r)):y&&y(b/I.length,a)}}"object"===typeof b&&b||g("invalid or missing configuration");d(b,
B,"config");var z=b.manifest;"object"===typeof z&&z||g("missing manifest");var E=h("onDone");E||g("missing onDone() callback");var y=h("onProgress"),k=h("onError"),r={},L=0,H={text:m,binary:function(a){return m(a)},image:function(a){return u(a,document.createElement("img"))},video:function(a){return u(a,document.createElement("video"))},audio:function(a){return u(a,document.createElement("audio"))}},I=Object.keys(z).map(function(a){function b(a,c){if(a in h.parser){var d=h.parser[a];"function"!==
typeof d&&g("invalid parser callback "+a+' for asset "'+a+'"');return d}return c}var h=z[a];"string"===typeof h?h={src:h}:"object"===typeof h&&h||g('invalid asset definition "'+a+'"');d(h,e,'asset "'+a+'"');var k={};"parser"in h&&("function"===typeof h.parser?k={data:h.parser}:"object"===typeof h.parser&&h.parser?(d(k,c,'parser for asset "'+a+'"'),"onData"in k||g('missing onData callback for parser in asset "'+a+'"'),k={data:b("onData"),done:b("onDone")}):g('invalid parser for asset "'+a+'"'));return{name:a,
type:function(b,c,d){b in h&&(d=h[b]);0>c.indexOf(d)&&g("invalid "+b+' "'+d+'" for asset "'+a+'", possible values: '+c);return d}("type",Object.keys(H),"text"),stream:!!h.stream,credentials:!!h.credentials,src:function(b,c,d){b in h?d=h[b]:c&&g("missing "+b+' for asset "'+a+'"');"string"!==typeof d&&g("invalid "+b+' for asset "'+a+'", must be a string');return d}("src",!0,""),parser:k}}).map(function(a){return H[a.type](a)})}},{}],35:[function(h,m,u){function g(a,b){for(var c=0;c<a.length;++c)if(a[c]===
b)return c;return-1}var d=h("./lib/util/extend"),x=h("./lib/dynamic"),B=h("./lib/util/raf"),e=h("./lib/util/clock"),c=h("./lib/strings"),b=h("./lib/webgl"),q=h("./lib/extension"),T=h("./lib/limits"),F=h("./lib/buffer"),C=h("./lib/elements"),l=h("./lib/texture"),z=h("./lib/renderbuffer"),E=h("./lib/framebuffer"),y=h("./lib/attribute"),k=h("./lib/shader"),r=h("./lib/read"),L=h("./lib/core"),H=h("./lib/stats"),I=h("./lib/timer");m.exports=function(a){function h(){if(0===Q.length)S&&S.update(),W=null;
else{W=B.next(h);D();for(var a=Q.length-1;0<=a;--a){var b=Q[a];b&&b(P,null,0)}n.flush();S&&S.update()}}function m(a){}function u(a){}function la(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];x.isDynamic(e)?d[b]=x.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;q.length<a;)q.push(null);return q}var e=b(a.context||{}),g=b(a.uniforms||{}),h=b(a.attributes||{}),k=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+
"."+b]=d[b]})}}var c=d({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var e=aa.compile(k,h,g,e,a),l=e.draw,m=e.batch,n=e.scope,q=[];return d(function(a,b){var d;if("function"===typeof a)return n.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)n.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)n.call(this,
a[d],b,d);else return n.call(this,a,b,0);else if("number"===typeof a){if(0<a)return m.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return m.call(this,a,a.length)}else return l.call(this,a)},{stats:a})}function V(){var a=ra.viewport,b=ra.scissor_box;a[0]=a[1]=b[0]=b[1]=0;P.viewportWidth=P.framebufferWidth=P.drawingBufferWidth=a[2]=b[2]=n.drawingBufferWidth;P.viewportHeight=P.framebufferHeight=P.drawingBufferHeight=a[3]=b[3]=n.drawingBufferHeight}function D(){P.tick+=1;P.time=(e()-Y)/
1E3;V();aa.procs.poll()}function Ga(){V();aa.procs.refresh();S&&S.update()}var K=b(a);if(!K)return null;var n=K.gl;a=n.getContextAttributes();var R=q(n,K);if(!R)return null;var ea=c(),v=H(),R=R.extensions,S=I(n,R),Y=e(),fa=n.drawingBufferWidth,ga=n.drawingBufferHeight,P={tick:0,time:0,viewportWidth:fa,viewportHeight:ga,framebufferWidth:fa,framebufferHeight:ga,drawingBufferWidth:fa,drawingBufferHeight:ga,pixelRatio:K.pixelRatio},N=T(n,R),Z=F(n,v,K),pa=C(n,R,Z,v),fa=y(n,R,N,Z,ea),ua=k(n,ea,v,K),ia=
l(n,R,N,function(){aa.procs.poll()},P,v,K),qa=z(n,R,N,v,K),ja=E(n,R,N,ia,qa,v),aa=L(n,ea,R,N,Z,pa,ia,ja,{},fa,ua,{elements:null,primitive:4,count:-1,offset:0,instances:-1},P,S,K),ea=r(n,ja,aa.procs.poll,P,a,R),ra=aa.next,U=n.canvas,Q=[],W=null;U&&(U.addEventListener("webglcontextlost",m,!1),U.addEventListener("webglcontextrestored",u,!1));Ga();a=d(la,{clear:function(a){var b=0;aa.procs.poll();var c=a.color;c&&(n.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(n.clearDepth(+a.depth),
b|=256);"stencil"in a&&(n.clearStencil(a.stencil|0),b|=1024);n.clear(b)},prop:x.define.bind(null,1),context:x.define.bind(null,2),"this":x.define.bind(null,3),draw:la({}),buffer:function(a){return Z.create(a,34962)},elements:pa.create,texture:ia.create2D,cube:ia.createCube,renderbuffer:qa.create,framebuffer:ja.create,framebufferCube:ja.createCube,attributes:a,frame:function(a){Q.push(a);!W&&0<Q.length&&(W=B.next(h));return{cancel:function(){function b(){var a=g(Q,b);Q[a]=Q[Q.length-1];--Q.length;
0>=Q.length&&W&&(B.cancel(h),W=null)}var c=g(Q,a);Q[c]=b}}},limits:N,hasExtension:function(a){return 0<=N.extensions.indexOf(a.toLowerCase())},read:ea,destroy:function(){Q.length=0;W&&(B.cancel(h),W=null);U&&(U.removeEventListener("webglcontextlost",m),U.removeEventListener("webglcontextrestored",u));ua.clear();ja.clear();qa.clear();ia.clear();pa.clear();Z.clear();S&&S.clear();K.onDestroy()},_gl:n,_refresh:Ga,poll:function(){D();S&&S.update()},stats:v});K.onDone(null,a);return a}},{"./lib/attribute":2,
"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},{},[1]);

        </script>
        </body>
      </html>