<!DOCTYPE html>
      <html>
        <head>
          <title>example/dds.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(f,k,b){function n(a,e){if(!k[a]){if(!f[a]){var h="function"==typeof require&&require;if(!e&&h)return h(a,!0);if(d)return d(a,!0);h=Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h;}h=k[a]={exports:{}};f[a][0].call(h.exports,function(b){var e=f[a][1][b];return n(e?e:b)},h,h.exports,e$$0,f,k,b)}return k[a].exports}for(var d="function"==typeof require&&require,a=0;a<b.length;a++)n(b[a]);return n})({1:[function(c,f,k){c=c("../regl")();var b=c({frag:"\n  precision mediump float;\n  uniform sampler2D specular, normals, diffuse;\n  varying vec3 lightDir, eyeDir;\n  varying vec2 uv;\n  void main () {\n    float d = length(lightDir);\n    vec3 L = normalize(lightDir);\n    vec3 E = normalize(eyeDir);\n    vec3 N = normalize(2.0 * texture2D(normals, uv).rgb - 1.0);\n    N = vec3(-N.x, N.yz);\n    vec3 D = texture2D(diffuse, uv).rgb;\n    vec3 kD = D * (0.01 +\n      max(0.0, dot(L, N) * (0.6 + 0.8 / d) ));\n    vec3 S = texture2D(specular, uv).rgb;\n    vec3 kS = 2.0 * pow(max(0.0, dot(normalize(N + L), -E)), 10.0) * S;\n    gl_FragColor = vec4(kD + kS, 1);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  uniform vec2 lightPosition;\n  varying vec3 lightDir, eyeDir;\n  varying vec2 uv;\n  void main () {\n    vec2 P = 1.0 - 2.0 * position;\n    uv = vec2(position.x, 1.0 - position.y);\n    eyeDir = -vec3(P, 1);\n    lightDir = vec3(lightPosition - P, 1);\n    gl_Position = vec4(P, 0, 1);\n  }",attributes:{position:c.buffer([-2,0,0,-2,2,2])},uniforms:{specular:c.texture({mag:"linear",data:"assets/alpine_cliff_a_spec.png"}),normals:c.texture({mag:"linear",
data:"assets/alpine_cliff_a_norm.png"}),diffuse:c.texture("assets/alpine_cliff_a.dds"),lightPosition:function(b,d,a){b=.025*a.count;return[2*Math.cos(b),2*Math.sin(b)]}},count:3});c.frame(function(){b()})},{"../regl":34}],2:[function(c,f,k){function b(){this.pointer=!1;this.w=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}var n=c("./constants/dtypes.json"),d=c("./extend");d(b.prototype,{equals:function(a,b){return this.pointer?
a.pointer&&this.buffer===a.buffer&&this.size===b&&this.normalized===a.normalized&&this.type===a.type&&this.offset===a.offset&&this.stride===a.stride&&this.divisor===a.divisor:!a.pointer&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},set:function(a,b){(this.pointer=a.pointer)?(this.buffer=a.buffer,this.size=b,this.normalized=a.normalized,this.type=a.type,this.offset=a.offset,this.stride=a.stride,this.divisor=a.divisor):(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w)}});f.exports=function(a,
q,e,c,x){function H(){for(var a=Array(16),l=0;16>l;++l)a[l]=new b;this.records=a;this.top=0}function f(a){for(var l=a.records,q=a.top;l.length-1<=q;)l.push(new b);return l[++a.top]}var A={};e=e.maxAttributes;for(var m=Array(e),r=0;r<e;++r)m[r]=new b;d(H.prototype,{pushVec:function(a,b,q,e){var d=f(this);d.pointer=!1;d.x=a;d.y=b;d.z=q;d.w=e},pushPtr:function(a,b,q,e,d,m,c){var n=f(this);n.pointer=!0;n.buffer=a;n.size=b;n.offset=q;n.stride=e;n.divisor=d;n.normalized=m;n.type=c},pushDyn:function(a){if("number"===
typeof a)this.pushVec(a,0,0,0);else if(Array.isArray(a))this.pushVec(a[0],a[1],a[2],a[3]);else{var b=c.getBuffer(a),q=0,e=0,d=0,m=0,r=!1,x=5126;b?x=b.dtype:(b=c.getBuffer(a.buffer),q=a.size||0,e=a.stride||0,d=a.offset||0,m=a.divisor||0,r=a.normalized||!1,x=b.dtype,"type"in a&&(x=n[a.type]));this.pushPtr(b,q,d,e,m,r,x)}},pop:function(){--this.top}});return{bindings:m,bind:function(b,e,d,m){m=d.size||m;if(!e.equals(d,m)){if(d.pointer){e.pointer||a.enableVertexAttribArray(b);e.buffer!==d.buffer&&d.buffer.bind();
a.vertexAttribPointer(b,m,d.type,d.normalized,d.stride,d.offset);var n=q.angle_instanced_arrays;n&&n.vertexAttribDivisorANGLE(b,d.divisor)}else e.pointer&&a.disableVertexAttribArray(b),a.vertexAttrib4f(b,d.x,d.y,d.z,d.w);e.set(d,m)}},def:function(a){a=x.id(a);var b=A[a];b||(b=A[a]=new H);return b}}}},{"./constants/dtypes.json":9,"./extend":15}],3:[function(c,f,k){function b(a,b){switch(a){case 5121:return new Uint8Array(b);case 5123:return new Uint16Array(b);case 5125:return new Uint32Array(b);case 5120:return new Int8Array(b);
case 5122:return new Int16Array(b);case 5124:return new Int32Array(b);case 5126:return new Float32Array(b);default:return null}}var n=c("./check"),d=c("./is-typed-array"),a=c("./is-ndarray"),q=c("./constants/arraytypes.json"),e=c("./constants/dtypes.json"),h=c("./values"),x={"static":35044,dynamic:35048,stream:35040};f.exports=function(c){function f(a,b){this.id=r++;this.buffer=a;this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function A(a){c.isBuffer(a.buffer)||
(a.buffer=c.createBuffer());a.bind();c.bufferData(a.type,a.data||a.byteLength,a.usage)}function m(a){var b=a.buffer;n(b,"buffer must not be deleted already");c.isBuffer(b)&&c.deleteBuffer(b);a.buffer=null;delete v[a.id]}var r=0,v={};f.prototype.bind=function(){c.bindBuffer(this.type,this.buffer)};return{create:function(l,r,h){function u(l){var m=l||{};if(Array.isArray(m)||d(m)||a(m))m={data:m};else if("number"===typeof m)m={length:m|0};else if(null===m||void 0===m)m={};n.type(m,"object","buffer arguments must be an object, a number or an array");
"usage"in m?(n.parameter(m.usage,x,"invalid buffer usage"),k.usage=x[m.usage]):k.usage=35044;l=0;"type"in m&&(n.parameter(m.type,e,"invalid buffer type"),l=e[m.type]);var c=m.dimension|0||1,r=0,h=null;if("data"in m)if(h=m.data,null===h)r=m.length|0;else{if(a(h)){var c=h.shape,r=h.stride,m=h.offset,M=0,f=0,v=0,P=0;1===c.length?(M=c[0],f=1,v=r[0],P=0):2===c.length?(M=c[0],f=c[1],v=r[0],P=r[1]):n.raise("invalid shape");l=l||q[Object.prototype.toString.call(h)]|0||5126;for(var c=f,r=b(l,M*f),h=h.data,
H=0,ma=0;ma<M;++ma)for(var X=0;X<f;++X)r[H++]=h[v*ma+P*X+m];h=r}else if(Array.isArray(h))if(0<h.length&&Array.isArray(h[0])){c=h[0].length;l=l||5126;m=b(l,h.length*c);r=h;h=c;for(M=P=0;M<r.length;++M)for(v=r[M],f=0;f<h;++f)m[P++]=v[f];h=m}else l=l||5126,h=b(l,h);else n.isTypedArray(h,"invalid data type buffer data"),l=l||q[Object.prototype.toString.call(h)]|0;r=h.byteLength}else"length"in m&&(r=m.length|0,n.nni(r,"buffer length must be a nonnegative integer"));k.data=h;k.dtype=l||5121;k.byteLength=
r;k.dimension=c;A(k);return u}var ea=c.createBuffer(),k=new f(ea,r);v[k.id]=k;h||u(l);u._reglType="buffer";u._buffer=k;u.destroy=function(){m(k)};return u},clear:function(){h(v).forEach(m)},refresh:function(){h(v).forEach(A)},getBuffer:function(a){return a&&a._buffer instanceof f?a._buffer:null}}}},{"./check":4,"./constants/arraytypes.json":8,"./constants/dtypes.json":9,"./is-ndarray":18,"./is-typed-array":19,"./values":33}],4:[function(c,f,k){function b(a){a=Error("(regl) "+a);console.error(a);throw a;
}function n(a,d){a||b(d)}var d=c("./is-typed-array");c=c("./extend");f.exports=c(n,{raise:b,parameter:function(a,d,e){a in d||b("unknown parameter ("+a+")"+(e?": "+e:"")+". possible values: "+Object.keys(d).join())},type:function(a,d,e){typeof a!==d&&b("invalid parameter type"+(e?": "+e:"")+". expected "+d+", got "+typeof a)},isTypedArray:function(a,q){d(a)||b("invalid parameter type"+(q?": "+q:"")+". must be a typed array")},nni:function(a,d){0<=a&&(a|0)===a||b("invalid parameter type, ("+a+")"+
(d?": "+d:"")+". must be a nonnegative integer")},oneOf:function(a,d,e){0>d.indexOf(a)&&b("invalid value"+(e?": "+e:"")+". must be one of: "+d)},shaderError:function(a,b,d,c){a.getShaderParameter(b,a.COMPILE_STATUS)||(a=a.getShaderInfoLog(b),n.raise("Error compiling shader:\n"+a))},linkError:function(a,b){if(!a.getProgramParameter(b,a.LINK_STATUS)){var d=a.getProgramInfoLog(b);n.raise("Error linking program:\n"+d)}}})},{"./extend":15,"./is-typed-array":19}],5:[function(c,f,k){f.exports="undefined"!==
typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],6:[function(c,f,k){var b=c("./extend");f.exports=function(){function c(){var a=[],e=[];return b(function(){a.push.apply(a,Array.prototype.slice.call(arguments))},{def:function(){var b="v"+d++;e.push(b);0<arguments.length&&(a.push(b,"="),a.push.apply(a,Array.prototype.slice.call(arguments)),a.push(";"));return b},toString:function(){return[0<e.length?"var "+e+";":"",a.join("")].join("")}})}var d=
0,a=[],q=[],e={};return{link:function(b){var e="g"+d++;a.push(e);q.push(b);return e},block:c,proc:function(a){var q=[],f=c(),k=f.toString;return e[a]=b(f,{arg:function(){var a="a"+d++;q.push(a);return a},toString:function(){return["function(",q.join(),"){",k(),"}"].join("")}})},compile:function(){var b=['"use strict";return {'];Object.keys(e).forEach(function(a){b.push('"',a,'":',e[a].toString(),",")});b.push("}");return Function.apply(null,a.concat([b.join("")])).apply(null,q)}}}},{"./extend":15}],
7:[function(c,f,k){function b(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function n(a,b,d,e){var c,n=",";switch(b){case 5126:c="1f";break;case 35664:c="2fv";break;case 35665:c="3fv";break;case 35666:c="4fv";break;case 35670:case 5124:c="1i";break;case 35671:case 35667:c="2iv";break;case 35672:case 35668:c="3iv";break;case 35673:case 35669:c="4iv";break;case 35674:c="Matrix2fv";n=",false,";
break;case 35675:c="Matrix3fv";n=",false,";break;case 35676:c="Matrix4fv";n=",false,";break;default:q.raise("unsupported uniform type")}return a+".uniform"+c+"("+d+n+e+");"}function d(a){return a+"["+a+".length-1]"}function a(a,b){return"framebuffer"===a||a<b?-1:a>b?1:0}var q=c("./check"),e=c("./codegen"),h=c("./constants/primitives.json"),x=c("./constants/dtypes.json"),H={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,
"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},L={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},A={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};f.exports=function(c,r,f,
l,M,P,k,ea,W,fa,ga,T,ca,ka,oa){function ha(l,r,x,M,k){function u(a){var b=pa[a];return b?b:b=pa[a]=y(la[a])}function U(a){var b=a.id,w=S[b];if(w)return w;w=a.func?p.def(y(a.data),"(",ra,",",F,",",N,")"):p.def(ra,".",a.data);return S[b]=w}function Y(a,b){return a.find(function(a){return a.name===b})}function J(a){return na&&!(a in r||a in k)}var I=e(),y=I.link,p=I.proc("batch"),D=I.block(),E=p.def,aa=p.arg,g=y(c),G=y(l.program),B=y(ga.bind),N=y(ka),ja=y(ea),t=y(ca.count),O=y(ca.offset),ta=y(ca.instances),
V=y(ca.primitive),pa={},da=y(P.elements),t=E(d(t)),O=E(d(O)),V=E(d(V)),da=E(d(da)),z,K,Q=f.angle_instanced_arrays;Q&&(z=E(d(ta)),K=y(Q));var na="elements"in r,ta=aa(),aa=aa(),ra=E(),F=E(),S={};p(g,".useProgram(",G,");");l.uniforms.forEach(function(a){if(!(a.name in x)){var b=y(a.location),w=y(fa.def(a.name)),w=w+"["+w+".length-1]";a=a.info.type;35678===a||35680===a?(a=E(w+"._texture"),p(n(g,5124,b,a+".bind()")),D(a,".unbind();")):p(n(g,a,b,w))}});l.attributes.forEach(function(a){if(!(M.name in M)){var g=
y(ga.def(a.name));p(B,"(",a.location,",",y(ga.bindings[a.location]),",",g,".records[",g,".top]",",",b(a.info.type),");")}});na||p("if(",da,"){",g,".bindBuffer(",34963,",",da,".buffer.buffer);","}else{",g,".bindBuffer(",34963,",null);","}");p("for(",F,"=0;",F,"<",ta,";++",F,"){",ra,"=",aa,"[",F,"];");Object.keys(r).sort(a).forEach(function(a){function b(a){p("if(",w,"){",g,".enable(",a,");}else{",g,".disable(",a,");}")}var w=U(r[a]);switch(a){case "framebuffer":a=u("viewport");var d=u("scissor.box");
p("if(",ja,".push(",w,"&&",w,"._framebuffer)){",ja,".poll();",a,".setDirty();",d,".setDirty();","}");break;case "cull.enable":b(2884);break;case "blend.enable":b(3042);break;case "dither":b(3024);break;case "stencil.enable":b(2960);break;case "depth.enable":b(2929);break;case "scissor.enable":b(3089);break;case "polygonOffset.enable":b(32823);break;case "sample.alpha":b(32926);break;case "sample.enable":b(32928);break;case "depth.mask":p(g,".depthMask(",w,");");break;case "depth.func":a=y(L);p(g,
".depthFunc(",a,"[",w,"]);");break;case "depth.range":p(g,".depthRange(",w,"[0],",w,"[1]);");break;case "blend.color":p(g,".blendColor(",w,"[0],",w,"[1],",w,"[2],",w,"[3]);");break;case "blend.equation":a=y(C);p("if(typeof ",w,'==="string"){',g,".blendEquation(",a,"[",w,"]);","}else{",g,".blendEquationSeparate(",a,"[",w,".rgb],",a,"[",w,".alpha]);","}");break;case "blend.func":a=y(H);p(g,".blendFuncSeparate(",a,'["srcRGB" in ',w,"?",w,".srcRGB:",w,".src],",a,'["dstRGB" in ',w,"?",w,".dstRGB:",w,".dst],",
a,'["srcAlpha" in ',w,"?",w,".srcAlpha:",w,".src],",a,'["dstAlpha" in ',w,"?",w,".dstAlpha:",w,".dst]);");break;case "stencil.mask":p(g,".stencilMask(",w,");");break;case "stencil.func":a=y(L);p(g,".stencilFunc(",a,"[",w,'.cmp||"always"],',w,".ref|0,",'"mask" in ',w,"?",w,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":d=y(A);p(g,".stencilOpSeparate(","stencil.opFront"===a?1028:1029,",",d,"[",w,'.fail||"keep"],',d,"[",w,'.zfail||"keep"],',d,"[",w,'.pass||"keep"]);');break;case "polygonOffset.offset":p(g,
".polygonOffset(",w,".factor||0,",w,".units||0);");break;case "cull.face":p(g,".cullFace(",w,'==="front"?',1028,":",1029,");");break;case "lineWidth":p(g,".lineWidth(",w,");");break;case "frontFace":p(g,".frontFace(",w,'==="cw"?',2304,":",2305,");");break;case "colorMask":p(g,".colorMask(",w,"[0],",w,"[1],",w,"[2],",w,"[3]);");break;case "sample.coverage":p(g,".sampleCoverage(",w,".value,",w,".invert);");break;case "scissor.box":case "viewport":a=u(a);p(a,".push(",w,".x||0,",w,".y||0,",w,".w||-1,",
w,".h||-1);");break;case "primitives":case "offset":case "count":case "elements":break;default:q.raise("unsupported option for batch",a)}});("viewport"in r||"framebuffer"in r)&&p(u("viewport"),".poll();");("scissor.box"in r||"framebuffer"in r)&&p(u("scissor.box"),".poll();");"framebuffer"in r&&p(ja,".pop();");var T=l.uniforms,W=[];Object.keys(x).forEach(function(a){var b=Y(T,a);if(b){var w=b.info.type,d=y(b.location);a=U(x[a]);35678===b.info.type||35680===b.info.type?(b=E(a+"._texture"),W.push(b),
p(n(g,5124,d,b+".bind()"))):p(n(g,w,d,a))}});W.forEach(function(a){p(a,".unbind();")});var ha=l.attributes;Object.keys(M).forEach(function(a){var g=Y(ha,a);g&&p(B,"(",g.location,",",y(a.bindings[g.location]),",",U(M[a]),",",b(g.info.type),");")});r.count?p(t,"=",U(r.count),";"):J("count")||p("if(",t,"){");r.offset&&p(O,"=",U(r.offset),";");r.primitive&&(l=y(h),p(V,"=",l,"[",U(r.primitive),"];"));na&&(l=U(r.elements),p(da,"=",l,"?",l,"._elements:null;"));J("offset")&&p(O,"=0;");p("if(",da,"){");J("count")&&
p(t,"=",da,".vertCount;","if(",t,">0){");J("primitive")&&p(V,"=",da,".primType;");na&&p(g,".bindBuffer(",34963,",",da,".buffer.buffer);");Q&&(r.instances&&p(z,"=",U(r.instances),";"),p("if(",z,">0){",K,".drawElementsInstancedANGLE(",V,",",t,",",da,".type,",O,",",z,");}else{"));p(g,".drawElements(",V,",",t,",",da,".type,",O,");");Q&&p("}");J("count")&&p("}");p("}else{");J("count")||(J("primitive")&&p(V,"=",4,";"),Q&&p("if(",z,">0){",K,".drawArraysInstancedANGLE(",V,",",O,",",t,",",z,");}else{"),p(g,
".drawArrays(",V,",",O,",",t,");}"),Q&&p("}"));p("}}",D);return I.compile().batch}var la=W.contextState,C={add:32774,subtract:32778,"reverse subtract":32779};f.ext_blend_minmax&&(C.min=32775,C.max=32776);var Q=0;return{draw:function(a){var q=e(),l=q.link,r=q.proc("draw"),h=r.def,x=l(c),M=l(a.program),H=l(ga.bind),J=l(ca.count),I=l(ca.offset),y=l(ca.instances),p=l(ca.primitive),D=l(P.elements),E=[];r(x,".useProgram(",M,");");a.attributes.forEach(function(a){var g=l(ga.def(a.name));r(H,"(",a.location,
",",l(ga.bindings[a.location]),",",g,".records[",g,".top]",",",b(a.info.type),");")});a.uniforms.forEach(function(a){var b=l(a.location),d=l(fa.def(a.name)),d=d+"["+d+".length-1]";a=a.info.type;35678===a||35680===a?(a=h(d+"._texture"),E.push(a),r(n(x,5124,b,a+".bind()"))):r(n(x,a,b,d))});E.forEach(function(a){r(a,".unbind();")});a=h(d(p));J=h(d(J));I=h(d(I));D=h(d(D));r("if(",J,"){");(M=f.angle_instanced_arrays)?(y=h(d(y)),M=l(M),r("if(",D,"){",D,".bind();","if(",y,">0){",M,".drawElementsInstancedANGLE(",
a,",",J,",",D,".type,",I,",",y,");}else{",x,".drawElements(",a,",",J,",",D,".type,",I,");}","}else if(",y,">0){",M,".drawArraysInstancedANGLE(",a,",",I,",",J,",",y,");}else{",x,".drawArrays(",a,",",I,",",J,");}}")):r("if(",D,"){",x,".drawElements(",a,",",J,",",D,".type,",I,");}","}else{",x,".drawArrays(",a,",",I,",",J,");}");return q.compile().draw},command:function(b,c,m,n,f,v,k){function u(a){var b=da[a];return b?b:b=da[a]=p(la[a])}function J(a,b){var g=u(a);z(g,".push(",b,");");K(g,".pop();")}
function I(a){var b=a.id,g=va[b];if(g)return g;g=a.func?F.def(p(a.data),"(",sa,",0,",W,")"):F.def(sa,".",a.data);return va[b]=g}var y=e(),p=y.link,D=y.block,E=y.proc,aa=Q++,g=p(oa);p(r);var G=p(T.fragShaders),B=p(T.vertShaders),N=p(T.programs),ja=p(ea),t={count:p(ca.count),offset:p(ca.offset),instances:p(ca.instances),primitive:p(ca.primitive)},O=p(P.elements),ta=p(h),V=p(L),pa=p(A),da={},z=D(),K=D(),ua=!1;Object.keys(b).sort(a).forEach(function(a){var g=b[a];switch(a){case "frag":ua=!0;z(G,".push(",
p(r.id(g)),");");K(G,".pop();");break;case "vert":ua=!0;z(B,".push(",p(r.id(g)),");");K(B,".pop();");break;case "framebuffer":a=ea.getFramebuffer(g);q(null===g||a,"invalid framebuffer object");a=u("viewport");var d=u("scissor.box");z("if(",ja,".push(",p(g&&g._framebuffer),")){",a,".setDirty();",d,".setDirty();","}");K("if(",ja,".pop()){",a,".setDirty();",d,".setDirty();","}");break;case "count":case "offset":case "instances":q.nni(g,a);z(t[a],".push(",g,");");K(t[a],".pop();");break;case "primitive":q.parameter(g,
h,"not a valid drawing primitive");z(t.primitive,".push(",h[g],");");K(t.primitive,".pop();");break;case "elements":d=P.getElements(g);g=!("primitive"in b);a=!("count"in b);d?(d=p(d),z(O,".push(",d,");"),g&&z(t.primitive,".push(",d,".primType);"),a&&z(t.count,".push(",d,".vertCount);")):(z(O,".push(null);"),g&&z(t.primitive,".push(",4,");"),a&&z(t.count,".push(0);"));g&&K(t.primitive,".pop();");a&&K(t.count,".pop();");"offset"in b||(z(t.offset,".push(0);"),K(t.offset,".pop();"));K(O,".pop();");break;
case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":q.type(g,"boolean",a);J(a,g);break;case "depth.func":q.parameter(g,L,a);J(a,L[g]);break;case "depth.range":q(Array.isArray(g)&&2===g.length&&g[0]<=g[1],"depth range is 2d array");a=u(a);z(a,".push(",g[0],",",g[1],");");K(a,".pop();");break;case "blend.func":a=u(a);q.type(g,"object","blend func must be an object");
var d="srcRGB"in g?g.srcRGB:g.src,e="srcAlpha"in g?g.srcAlpha:g.src,c="dstRGB"in g?g.dstRGB:g.dst,g="dstAlpha"in g?g.dstAlpha:g.dst;q.parameter(d,H);q.parameter(e,H);q.parameter(c,H);q.parameter(g,H);z(a,".push(",H[d],",",H[c],",",H[e],",",H[g],");");K(a,".pop();");break;case "blend.equation":a=u(a);"string"===typeof g?(q.parameter(g,C,"invalid blend equation"),z(a,".push(",C[g],",",C[g],");")):"object"===typeof g?(q.parameter(g.rgb,C,"invalid blend equation rgb"),q.parameter(g.alpha,C,"invalid blend equation alpha"),
z(a,".push(",C[g.rgb],",",C[g.alpha],");")):q.raise("invalid blend equation");K(a,".pop();");break;case "blend.color":q(Array.isArray(g)&&4===g.length,"blend color is a 4d array");a=u(a);z(a,".push(",g[0],",",g[1],",",g[2],",",g[3],");");K(a,".pop();");break;case "stencil.mask":q.type(g,"number","stencil mask must be an integer");a=u(a);z(a,".push(",g,");");K(a,".pop();");break;case "stencil.func":q.type(g,"object","stencil func must be an object");d=g.cmp||"keep";e=g.ref||0;g="mask"in g?g.mask:-1;
q.parameter(d,L,"invalid stencil func cmp");q.type(e,"number","stencil func ref");q.type(g,"number","stencil func mask");a=u(a);z(a,".push(",L[d],",",e,",",g,");");K(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":q.type(g,"object",a);d=g.fail||"keep";e=g.zfail||"keep";g=g.pass||"keep";q.parameter(d,A,a);q.parameter(e,A,a);q.parameter(g,A,a);a=u(a);z(a,".push(",A[d],",",A[e],",",A[g],");");K(a,".pop();");break;case "polygonOffset.offset":q.type(g,"object",a);d=g.factor||0;g=g.units||
0;q.type(d,"number","offset.factor");q.type(g,"number","offset.units");a=u(a);z(a,".push(",d,",",g,");");K(a,".pop();");break;case "cull.face":d=0;"front"===g?d=1028:"back"===g&&(d=1029);q(!!d,"cull.face");g=u(a);z(g,".push(",d,");");K(g,".pop();");break;case "lineWidth":d=l.lineWidthDims;q("number"===typeof g&&g>=d[0]&&g<=d[1],"invalid line width, must positive number between "+d[0]+" and "+d[1]);J(a,g);break;case "frontFace":d=0;"cw"===g?d=2304:"ccw"===g&&(d=2305);q(!!d,"frontFace");g=u(a);z(g,
".push(",d,");");K(g,".pop();");break;case "colorMask":q(Array.isArray(g)&&4===g.length,"color mask must be length 4 array");a=u(a);z(a,".push(",g.map(function(a){return!!a}).join(),");");K(a,".pop();");break;case "sample.coverage":q.type(g,"object",a);d="value"in g?g.value:1;g=!!g.invert;q("number"===typeof d&&0<=d&&1>=d,"sample value");a=u(a);z(a,".push(",d,",",g,");");K(a,".pop();");break;case "viewport":case "scissor.box":q("object"===typeof g&&g,a+" is an object");var d=g.x||0,e=g.y||0,m=c=-1;
q("number"===typeof d&&0<=d,a+".x must be a positive int");q("number"===typeof e&&0<=e,a+".y must be a positive int");"w"in g&&(c=g.w,q("number"===typeof c&&0<=c,a+".w must be a positive int"));"h"in g&&(m=g.h,q("number"===typeof m&&0<=m,a+".h must be a positive int"));g=u(a);z(g,".push(",d,",",e,",",c,",",m,");");K(g,".pop();");break;default:q.raise("unsupported parameter "+a)}});if(ua){if(b.frag&&b.vert)D=b.frag,z(N,".push(",p(T.create(r.id(b.vert),r.id(D))),");");else{var D=z.def(G,"[",G,".length-1]"),
na=z.def(B,"[",B,".length-1]"),ra=p(T.create);z(N,".push(",ra,"(",na,",",D,"));")}K(N,".pop();")}Object.keys(c).forEach(function(a){var g=p(fa.def(a));a=c[a];a="function"===typeof a&&a._reglType?p(a):Array.isArray(a)?p(a.slice()):+a;z(g,".push(",a,");");K(g,".pop();")});Object.keys(m).forEach(function(a){var g=p(ga.def(a)),b=m[a];if("number"===typeof b)z(g,".pushVec(",+b,",0,0,0);");else if(q(!!b,"invalid attribute: "+a),Array.isArray(b))z(g,".pushVec(",[b[0]||0,b[1]||0,b[2]||0,b[3]||0],");");else{var d=
M.getBuffer(b),e=0,B=0,l=0,c=0,r=!1,N=5126;d?N=d.dtype:(q.type(b,"object",'invalid attribute "'+a+'"'),d=M.getBuffer(b.buffer),e=b.size||0,B=b.stride||0,l=b.offset||0,c=b.divisor||0,r=b.normalized||!1,q(!!d,"invalid attribute "+a+".buffer"),N=d.dtype,"type"in b&&(q.parameter(b.type,x,"attribute type"),N=x[b.type]));q(!!d,"invalid attribute "+a+".buffer");q.nni(B,a+".stride");q.nni(l,a+".offset");q.nni(c,a+".divisor");q.type(r,"boolean",a+".normalized");q.oneOf(e,[0,1,2,3,4],a+".size");z(g,".pushPtr(",
[p(d),e,l,B,c,r,N].join(),");")}K(g,".pop();")});var F=y.block(),S=y.block(),W,sa;k&&(W=p(ka),sa=z.def());var va={};Object.keys(n).sort(a).forEach(function(a){var g=I(n[a]);switch(a){case "framebuffer":a=u("viewport");var d=u("scissor.box");F("if(",ja,".push(",g,"&&",g,"._framebuffer)){",a,".setDirty();",d,".setDirty();","}");S("if(",ja,".pop()){",a,".setDirty();",d,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=
u(a);F(a,".push(",g,");");S(a,".pop();");break;case "count":case "offset":case "instances":a=t[a];F(a,".push(",g,");");S(a,".pop();");break;case "primitive":a=t.primitive;F(a,".push(",ta,"[",g,"]);");S(a,".pop();");break;case "depth.func":a=u(a);F(a,".push(",V,"[",g,"]);");S(a,".pop();");break;case "blend.func":a=u(a);d=p(H);F(a,".push(",d,'["srcRGB" in ',g,"?",g,".srcRGB:",g,".src],",d,'["dstRGB" in ',g,"?",g,".dstRGB:",g,".dst],",d,'["srcAlpha" in ',g,"?",g,".srcAlpha:",g,".src],",d,'["dstAlpha" in ',
g,"?",g,".dstAlpha:",g,".dst]);");S(a,".pop();");break;case "blend.equation":a=u(a);d=p(C);F("if(typeof ",g,'==="string"){',a,".push(",d,"[",g,"],",d,"[",g,"]);","}else{",a,".push(",d,"[",g,".rgb],",d,"[",g,".alpha]);","}");S(a,".pop();");break;case "blend.color":a=u(a);F(a,".push(",g,"[0],",g,"[1],",g,"[2],",g,"[3]);");S(a,".pop();");break;case "stencil.mask":a=u(a);F(a,".push(",g,");");S(a,".pop();");break;case "stencil.func":a=u(a);F(a,".push(",V,"[",g,".cmp],",g,".ref|0,",'"mask" in ',g,"?",g,
".mask:-1);");S(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=u(a);F(a,".push(",pa,"[",g,'.fail||"keep"],',pa,"[",g,'.zfail||"keep"],',pa,"[",g,'.pass||"keep"]);');S(a,".pop();");break;case "polygonOffset.offset":a=u(a);F(a,".push(",g,".factor||0,",g,".units||0);");S(a,".pop();");break;case "cull.face":a=u(a);F(a,".push(",g,'==="front"?',1028,":",1029,");");S(a,".pop();");break;case "frontFace":a=u(a);F(a,".push(",g,'==="cw"?',2304,":",2305,");");S(a,".pop();");break;case "colorMask":a=
u(a);F(a,".push(",g,"[0],",g,"[1],",g,"[2],",g,"[3]);");S(a,".pop();");break;case "sample.coverage":a=u(a);F(a,".push(",g,".value,",g,".invert);");S(a,".pop();");break;case "scissor.box":case "viewport":a=u(a);F(a,".push(",g,".x||0,",g,".y||0,",'"w" in ',g,"?",g,".w:-1,",'"h" in ',g,"?",g,".h:-1);");S(a,".pop();");break;case "elements":a=!("primitive"in n)&&!("primitive"in b);var d=!("count"in n)&&!("count"in b),e=!("offset"in n)&&!("offset"in b),B=F.def();F("if(",g,"){",B,"=",g,"._elements;",O,".push(",
B,");",a?t.primitive+".push("+B+".primType);":"",d?t.count+".push("+B+".vertCount);":"",e?t.offset+".push("+B+".offset);":"","}else{",O,".push(null);","}");S(O,".pop();","if(",g,"){",a?t.primitive+".pop();":"",d?t.count+".pop();":"",e?t.offset+".pop();":"","}");break;default:q.raise("unsupported dynamic option: "+a)}});Object.keys(f).forEach(function(a){var g=p(fa.def(a));a=I(f[a]);F(g,".push(",a,");");S(g,".pop();")});Object.keys(v).forEach(function(a){var g=p(ga.def(a));a=I(v[a]);F(g,".pushDyn(",
a,");");S(g,".pop();")});D=E("scope");na=D.arg();ra=D.arg();D(z);k&&D(sa,"=",na,";",F);D(ra,"();",k?S:"",K);D=E("draw");D(z);k&&D(sa,"=",D.arg(),";",F);na=d(N);D(g,"();","if(",na,")",na,".draw(",k?sa:"",");",k?S:"",K);var qa=E("batch");qa(z);k=qa.def(d(N));E=p(function(a,g,d){var e=a.batchCache[aa];e||(e=a.batchCache[aa]=ha(a,n,f,v,b));return e(g,d)});qa("if(",k,"){",g,"();",E,"(",k,",",qa.arg(),",",qa.arg(),");");Object.keys(n).forEach(function(a){(a=da[a])&&qa(a,".setDirty();")});qa("}",K);return y.compile()}}}},
{"./check":4,"./codegen":6,"./constants/dtypes.json":9,"./constants/primitives.json":10}],8:[function(c,f,k){f.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],9:[function(c,f,k){f.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,
"float":5126}},{}],10:[function(c,f,k){f.exports={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],11:[function(c,f,k){function b(b,d){function c(){var d=window.innerWidth,e=window.innerHeight;b!==document.body&&(e=b.getBoundingClientRect(),d=e.right-e.left,e=e.top-e.bottom);f.width=L*d;f.height=L*e;a(f.style,{width:d+"px",height:e+"px"})}var f=document.createElement("canvas"),k=n(f,d);a(f.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(f);
b===document.body&&(f.style.position="absolute",a(b.style,{margin:0,padding:0}));var L=+k.options.pixelRatio;window.addEventListener("resize",c,!1);var A=k.options.onDestroy;k.options=a(a({},k.options),{onDestroy:function(){window.removeEventListener("resize",c);b.removeChild(f);A&&A()}});c();return k}function n(b,e){function c(a){try{return b.getContext(a,n)}catch(d){return null}}var n=e.glOptions||{},f=c("webgl")||c("experimental-webgl")||c("webgl-experimental");d(f,"webgl not supported");return{gl:f,
options:a({pixelRatio:window.devicePixelRatio},e)}}var d=c("./check"),a=c("./extend");f.exports=function(d){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:d[0],options:d[1]||{}};var e=document.body,c=d[1]||{};if("string"===typeof d[0])e=document.querySelector(d[0])||document.body;else if("object"===typeof d[0])if(d[0]instanceof HTMLElement)e=d[0];else{if(d[0]instanceof WebGLRenderingContext)return{gl:d[0],options:a({pixelRatio:1},c)};c=d[0]}return e.nodeName&&"CANVAS"===
e.nodeName.toUpperCase()?n(e,c):b(e,c)}},{"./check":4,"./extend":15}],12:[function(c,f,k){f.exports=function(b){return{primitive:[4],count:[0],offset:[0],instances:[0]}}},{}],13:[function(c,f,k){function b(a,b){this.id=d++;this.func=a;this.data=b}function n(a,d){switch(typeof a){case "boolean":case "number":case "string":return new b(!1,a);case "function":return new b(!0,a);default:return n}}var d=0;f.exports={define:n,isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof b},
unbox:function(a,d){return a instanceof b?a:"function"===typeof a&&a!==n?new b(!0,a):new b(!1,d)}}},{}],14:[function(c,f,k){var b=c("./check"),n=c("./is-typed-array"),d=c("./is-ndarray"),a=c("./constants/primitives.json");f.exports=function(c,e,f){function x(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}x.prototype.bind=function(){this.buffer.bind()};return{create:function(c){function q(c){var f=e.oes_element_index_uint;if(c)if("number"===typeof c)m(c);else{var l=null,h="static",x=
0;Array.isArray(c)||n(c)||d(c)?l=c:(b.type(c,"object","invalid arguments for elements"),"data"in c&&(l=c.data),"usage"in c&&(h=c.usage),"length"in c&&(x=c.length));Array.isArray(l)||d(l)&&"array"===l.dtype||"type"in c?m({type:c.type||(f?"uint32":"uint16"),usage:h,data:l,length:x}):m({usage:h,data:l,length:x});if(Array.isArray(l)||n(l))m.dimension=3}else m();l=k.buffer.byteLength;h=0;switch(k.buffer.dtype){case 5121:case 5120:h=5121;break;case 5123:case 5122:h=5123;l>>=1;break;case 5125:case 5124:b(f,
"32 bit element buffers not supported");h=5125;l>>=2;break;default:b.raise("invalid element buffer type")}f=4;x=k.buffer.dimension;1===x&&(f=0);2===x&&(f=1);3===x&&(f=4);"object"===typeof c&&("primitive"in c&&(f=c.primitive,b.parameter(f,a),f=a[f]),"count"in c&&(l=c.vertCount|0));k.primType=f;k.vertCount=l;k.type=h;return q}var k=new x,m=f.create(null,34963,!0);k.buffer=m._buffer;q(c);q._reglType="elements";q._elements=k;q.destroy=function(){b(null!==k.buffer,"must not double destroy elements");m.destroy();
k.buffer=null};return q},elements:[null],getElements:function(a){return a&&a._elements instanceof x?a._elements:null}}}},{"./check":4,"./constants/primitives.json":10,"./is-ndarray":18,"./is-typed-array":19}],15:[function(c,f,k){f.exports=function(b,c){for(var d=Object.keys(c),a=0;a<d.length;++a)b[d[a]]=c[d[a]];return b}},{}],16:[function(c,f,k){f.exports=function(b){function c(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{d[a]=
b.getExtension(a)}catch(c){}})}var d={};c();return{extensions:d,refresh:c}}},{}],17:[function(c,f,k){var b=c("./check"),n=c("./values"),d=c("./extend"),a=[1029];f.exports=function(c,e,f,x,k){function L(a,b,d,c){this.target=a;this.level=b;this.texture=d;this.renderbuffer=c}function A(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function m(a,d,c){if(a.texture)b.oneOf(a.texture._texture.params.internalformat,d,"unsupported texture format for attachment");
else b.oneOf(a.renderbuffer._renderbuffer.format,c,"unsupported renderbuffer format for attachment")}function r(a,d){var c=d.width,e=d.height;if(a.texture){var l=a.texture._texture,m=Math.max(1,l.params.width>>a.level),f=Math.max(1,l.params.height>>a.level),c=c||m,e=e||f;b(m===c&&f===e,"inconsistent width/height for supplied texture");b(0>l.pollId,"polling fbo textures not supported")}else l=a.renderbuffer._renderbuffer,c=c||l.width,e=e||l.height,b(l.width===c&&l.height===e,"inconsistent width/height for renderbuffer"),
b(0<=X.indexOf(l.format),"renderbuffer format not compatible with color channels");l.refCount+=1;d.width=c;d.height=e}function v(a,b){b?b.texture?c.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):c.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):c.framebufferTexture2D(36160,a,3553,null,0)}function l(a){var d=3553,c=0,e=null,l=null,m=a;"object"===typeof a&&(m=a.data,"level"in a&&(c=a.level|0),"target"in a&&(d=a.target|0));b.type(m,"function",
"invalid attachment data");m=a._reglType;"texture"===m?(e=a,34067===e._texture.target?b(34069<=d&&34075>d,"invalid cube map target"):b(3553===d)):"renderbuffer"===m?(l=a,d=36161,c=0):b.raise("invalid regl object for attachment");return new L(d,c,e,l)}function M(a){return a&&(a.texture||a.renderbuffer)}function P(){this.id=R++;Z[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=
this.ownsColor=!1}function u(a){c.isFramebuffer(a.framebuffer)||(a.framebuffer=c.createFramebuffer());Y=!0;c.bindFramebuffer(36160,a.framebuffer);for(var d=a.colorAttachments,l=0;l<d.length;++l)v(36064+l,d[l]);for(l=d.length;l<f.maxColorAttachments;++l)v(36064+l,null);v(36096,a.depthAttachment);v(36128,a.stencilAttachment);v(33306,a.depthStencilAttachment);e.webgl_draw_buffers&&e.webgl_draw_buffers.drawBuffersWEBGL(ba[d.length]);a=c.checkFramebufferStatus(36160);36053!==a&&b.raise("framebuffer configuration not supported, status = "+
fa[a])}function ea(a){a=a.framebuffer;b(a,"must not double destroy framebuffer");c.isFramebuffer(a)&&c.deleteFramebuffer(a)}function W(){return U[U.length-1]}var fa={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},ga={rgba:6408},T={rgba4:32854,rgb565:36194,"rgb5 a1":32855};e.ext_srgb&&(T.srgba=35907);e.ext_color_buffer_half_float&&(T.rgba16f=34842,T.rgb16f=34843);e.webgl_color_buffer_float&&(T.rgba32f=34836);
var ca=[33189],ka=[36168],oa=[34041],ha=[],la=[],C=[];e.webgl_depth_texture&&(ha.push(6402),C.push(34041));var Q=d(d({},ga),T),ma=n(ga),X=n(T),T=5121,ia={uint8:5121};e.oes_texture_half_float&&(T=ia["half float"]=36193);e.oes_texture_float&&(T=ia["float"]=5126);ia.best=T;var ba=function(){for(var a=Array(f.maxDrawbuffers),b=0;b<=f.maxDrawbuffers;++b)for(var d=a[b]=Array(b),c=0;c<b;++c)d[c]=36064+c;return a}(),R=0,Z={},U=[null],Y=!0;return{top:W,dirty:function(){return Y},push:function(a){a=a||null;
Y=Y||a!==W();U.push(a);return Y},pop:function(){var a=W();U.pop();return Y=Y||a!==W()},getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof P)?a:null},poll:function(){if(Y){var b=U[U.length-1],d=e.webgl_draw_buffers;b?(c.bindFramebuffer(36160,b.framebuffer),d&&d.drawBuffersWEBGL(ba[b.colorAttachments.length])):(c.bindFramebuffer(36160,null),d&&d.drawBuffersWEBGL(a));Y=!1}},create:function(a){function d(a){var n,h=a||{};n=e.webgl_draw_buffers;
var v=0,g=0;"shape"in h?(a=h.shape,b(Array.isArray(a)&&2<=a.length,"invalid shape for framebuffer"),v=a[0],g=a[1]):("radius"in h&&(v=g=h.radius),"width"in h&&(v=h.width),"height"in h&&(g=h.height));var G=null;a=!1;if("colorBuffers"in h||"colorBuffer"in h){G=h.colorBuffers||h.colorBuffer;Array.isArray(G)||(G=[G]);f.width=v;f.height=g;1<G.length&&b(n,"multiple render targets not supported");b(0<=G.length,"must specify at least one color attachment");G=G.map(l);for(n=0;n<G.length;++n)v=G[n],m(v,ma,X),
r(v,f);v=f.width;g=f.height}else{var B=!0,N="rgba",ja="uint8",t=1;a=!0;f.width=v||c.drawingBufferWidth;f.height=g||c.drawingBufferHeight;"format"in h&&(N=h.format,b.parameter(N,Q,"invalid color format"),B=N in ga);"type"in h&&(b(B,"colorType can not be set for renderbuffer targets"),ja=h.type,b.parameter(ja,ia,"invalid color type"));"colorCount"in h&&(t=h.colorCount|0,b(0<=t,"color count must be positive"));if(f.ownsColor)for(G=f.colorAttachments;G.length>t;)A(G.pop());else G=[];for(n=0;n<G.length;++n){var O;
a:{O=G[n];var P=B,V=N,pa=v,da=g;if(O.texture){var z=O.texture;if(P){z({format:V,type:ja,width:pa,height:da});z._texture.refCount+=1;O=!0;break a}}else if(z=O.renderbuffer,!P){z({format:V,width:pa,height:da});z._renderbuffer.refCount+=1;O=!0;break a}A(O);O=!1}O||(G[n--]=G[G.length-1],G.pop())}for(;G.length<t;)B?G.push(new L(3553,0,x.create({format:N,type:ja,width:v,height:g},3553),null)):G.push(new L(36161,0,null,k.create({format:N,width:v,height:g})))}b(0<G.length,"must specify at least one color buffer");
f.width=v;f.height=g;N=B=n=null;ja=!1;t=0;"depthBuffer"in h&&(n=l(h.depthBuffer),m(n,ha,ca),t+=1);"stencilBuffer"in h&&(B=l(h.stencilBuffer),m(B,la,ka),t+=1);"depthStencilBuffer"in h&&(N=l(h.depthStencilBuffer),m(N,C,oa),t+=1);if(n||B||N)b(1===t,"can specify only one of depth, stencil or depthStencil attachment"),r(n||B||N,f);else if(t=!0,P=O=!1,"depth"in h&&(t=!!h.depth),"stencil"in h&&(O=!!h.stencil),"depthTexture"in h&&(P=!!h.depthTexture),h=f.depthAttachment||f.stencilAttachment||f.depthStencilAttachment,
V=null,t||O)ja=!0,P?(b(e.webgl_depth_texture,"depth texture extension not supported"),b(t,"stencil only textures not supported"),P=O?"depth stencil":"depth",f.ownsDepthStencil&&h.texture?(h.texture({format:P,width:v,height:g}),h.texture._texture.refCount+=1,V=h):V=new L(3553,0,x.create({format:P,width:v,height:g},3553),null)):(P=t?O?"depth stencil":"depth":"stencil",f.ownsDepthStencil&&h.renderbuffer?(h.renderbuffer({format:P,width:v,height:g}),h.renderbuffer._renderbuffer.refCount+=1,V=h):V=new L(36161,
0,null,k.create({format:P,width:v,height:g}))),t?O?N=V:n=V:B=V;v=f;v.colorAttachments.forEach(A);A(v.depthAttachment);A(v.stencilAttachment);A(v.depthStencilAttachment);f.colorAttachments=G;f.depthAttachment=n;f.stencilAttachment=B;f.depthStencilAttachment=N;f.ownsColor=a;f.ownsDepthStencil=ja;d.color=G.map(M);d.depth=M(n);d.stencil=M(B);d.depthStencil=M(N);u(f);d.width=f.width;d.height=f.height;return d}var f=new P;d(a);d._reglType="framebuffer";d._framebuffer=f;d._destroy=function(){ea(f)};return d},
clear:function(){n(Z).forEach(ea)},refresh:function(){n(Z).forEach(u)}}}},{"./check":4,"./extend":15,"./values":33}],18:[function(c,f,k){var b=c("./is-typed-array");f.exports=function(c){return"object"===typeof c&&Array.isArray(c.shape)&&Array.isArray(c.stride)&&"number"===typeof c.offset&&c.shape.length===c.stride.length&&(Array.isArray(c.data)||b(c.data))}},{"./is-typed-array":19}],19:[function(c,f,k){var b=c("./constants/arraytypes.json");f.exports=function(c){return Object.prototype.toString.call(c)in
b}},{"./constants/arraytypes.json":8}],20:[function(c,f,k){f.exports=function(b,c){var d=1;c.ext_texture_filter_anisotropic&&(d=b.getParameter(34047));var a=1,f=1;c.webgl_draw_buffers&&(a=b.getParameter(34852),f=b.getParameter(36063));return{colorBits:[b.getParameter(3410),b.getParameter(3411),b.getParameter(3412),b.getParameter(3413)],depthBits:b.getParameter(3414),stencilBits:b.getParameter(3415),subpixelBits:b.getParameter(3408),extensions:Object.keys(c).filter(function(a){return!!c[a]}),maxAnisotropic:d,
maxDrawbuffers:a,maxColorAttachments:f,pointSizeDims:b.getParameter(33901),lineWidthDims:b.getParameter(33902),maxViewportDims:b.getParameter(3386),maxCombinedTextureUnits:b.getParameter(35661),maxCubeMapSize:b.getParameter(34076),maxRenderbufferSize:b.getParameter(34024),maxTextureUnits:b.getParameter(34930),maxTextureSize:b.getParameter(3379),maxAttributes:b.getParameter(34921),maxVertexUniforms:b.getParameter(36347),maxVertexTextureUnits:b.getParameter(35660),maxVaryingVectors:b.getParameter(36348),
maxFragmentUniforms:b.getParameter(36349),glsl:b.getParameter(35724),renderer:b.getParameter(7937),vendor:b.getParameter(7936),version:b.getParameter(7938)}}},{}],21:[function(c,f,k){f.exports=function(b,c){if("undefined"!==typeof document){var d;d=(d=/\.(\w+)(\?.*)?$/.exec(b))&&d[1]?d[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(d))return d=document.createElement("video"),d.autoplay=!0,d.loop=!0,c&&(d.crossOrigin=c),d.src=
b,d;if(0<=["dds"].indexOf(d))return d=new XMLHttpRequest,d.responseType="arraybuffer",d.open("GET",b,!0),d.send(),d;d=new Image;c&&(d.crossOrigin=c);d.src=b;return d}return null}},{}],22:[function(c,f,k){var b=c("./check");f.exports=function(c){function f(a){for(var b=X,d=ia,e=0;e<Y;++e){var l=Math.max(1,b+3>>2)*Math.max(1,d+3>>2)*Z;I.pixels.push({target:a,miplevel:e,width:b,height:d,data:new Uint8Array(c,J,l)});J+=l;b>>=1;d>>=1}}var k=new Int32Array(c);b(k[0]===n,"invalid magic number for dds header");
var ma=k[fa];b(ma&v,"unsupported dds format");var X=k[T],ia=k[ga],ba=L,R=0,Z=0,U=4;switch(k[oa]){case M:Z=8;ma&l?(U=3,R=q):R=e;break;case P:Z=16;R=h;break;case u:Z=16;R=x;break;case ea:Z=8;R=H;break;default:b.raise("unsupported dds texture format")}var Y=1;k[ka]&A&&(Y=Math.max(1,k[ca]));var J=k[W]+4,I={width:X,height:ia,channels:U,format:R,type:ba,compressed:!0,cube:!1,pixels:[]},k=k[ha];if(k&m)for(b((k&r)===r,"missing cubemap faces"),I.cube=!0,k=0;6>k;++k)f(a+k);else f(d);return I};var n=542327876,
d=3553,a=34069,q=33776,e=33777,h=33778,x=33779,H=36196,L=5121,A=131072,m=512,r=64512,v=4,l=64,M=827611204,P=861165636,u=894720068,ea=826496069,W=1,fa=2,ga=3,T=4,ca=7,ka=20,oa=21,ha=28},{"./check":4}],23:[function(c,f,k){f.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(b){return requestAnimationFrame(b)},cancel:function(b){return cancelAnimationFrame(b)}}:{next:function(b){setTimeout(b,30)},cancel:clearTimeout}},{}],24:[function(c,f,k){var b=
c("./check"),n=c("./is-typed-array");f.exports=function(d,a,c){return function(e){var f=e||{};n(e)?f={data:f}:2===arguments.length?f={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof e&&(f={});a();var k=f.x||0,H=f.y||0,L=f.width||c.width,A=f.height||c.height,m=L*A*4,f=f.data||new Uint8Array(m);b.isTypedArray(f);b(f.byteLength>=m,"data buffer too small");d.pixelStorei(3333,4);d.readPixels(k,H,L,A,6408,5121,f);return f}}},{"./check":4,"./is-typed-array":19}],25:[function(c,f,k){var b=c("./check"),
n=c("./values");f.exports=function(d,a,c){function e(){this.id=L++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function f(a){d.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=d.createRenderbuffer());d.bindRenderbuffer(36161,a.renderbuffer);d.renderbufferStorage(36161,a.format,a.width,a.height)}function k(a){var c=a.renderbuffer;b(c,"must not double destroy renderbuffer");d.bindRenderbuffer(36161,null);d.isRenderbuffer(c)&&d.deleteRenderbuffer(c);a.renderbuffer=
null;a.refCount=0;delete A[a.id]}var H={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};a.ext_srgb&&(H.srgba=35907);a.ext_color_buffer_half_float&&(H.rgba16f=34842,H.rgb16f=34843);a.webgl_color_buffer_float&&(H.rgba32f=34836);var L=0,A={};e.prototype.decRef=function(){0===--this.refCount&&k(this)};return{create:function(a){function d(a){a=a||{};var e=0,m=0;"shape"in a?(m=a.shape,b(Array.isArray(m)&&2<=m.length,"invalid renderbuffer shape"),e=m[0]|0,m=m[1]|
0):("radius"in a&&(e=m=a.radius|0),"width"in a&&(e=a.width|0),"height"in a&&(m=a.height|0));var k=c.maxRenderbufferSize;b(0<=e&&0<=m&&e<=k&&m<=k,"invalid renderbuffer size");d.width=n.width=Math.max(e,1);d.height=n.height=Math.max(m,1);n.format=32854;"format"in a&&(a=a.format,b.parameter(a,H,"invalid render buffer format"),n.format=H[a]);f(n);return d}var n=new e;A[n.id]=n;d(a);d._reglType="renderbuffer";d._renderbuffer=n;d.destroy=function(){n.decRef()};return d},refresh:function(){n(A).forEach(f)},
clear:function(){n(A).forEach(k)}}}},{"./check":4,"./values":33}],26:[function(c,f,k){function b(a,b,d){this.name=a;this.location=b;this.info=d}var n=c("./check"),d=c("./values");f.exports=function(a,c,e,f,k){function H(b,d){var c=35632===b?m:r,e=c[d];if(!e){var f=k.str(d),e=a.createShader(b);a.shaderSource(e,f);a.compileShader(e);n.shaderError(a,e,f,b);c[d]=e}return e}function L(a,b){this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];this.draw=function(){};this.batchCache=
{}}function A(d){var l,m;l=H(35632,d.fragId);m=H(35633,d.vertId);var k=d.program=a.createProgram();a.attachShader(k,l);a.attachShader(k,m);a.linkProgram(k);n.linkError(a,k);var r=a.getProgramParameter(k,35718),x=d.uniforms=[];for(l=0;l<r;++l)if(m=a.getActiveUniform(k,l))if(1<m.size)for(var v=0;v<m.size;++v){var A=m.name.replace("[0]","["+v+"]");e.def(A);x.push(new b(A,a.getUniformLocation(k,A),m))}else e.def(m.name),x.push(new b(m.name,a.getUniformLocation(k,m.name),m));r=a.getProgramParameter(k,
35721);x=d.attributes=[];for(l=0;l<r;++l)if(m=a.getActiveAttrib(k,l))c.def(m.name),x.push(new b(m.name,a.getAttribLocation(k,m.name),m));d.draw=f(d);d.batchCache={}}var m={},r={},v={},l=[];return{create:function(a,d){var b=v[d];b||(b=v[d]={});var c=b[a];c||(c=new L(d,a),A(c),b[a]=c,l.push(c));return c},clear:function(){var b=a.deleteShader.bind(a);d(m).forEach(b);m={};d(r).forEach(b);r={};l.forEach(function(b){a.deleteProgram(b.program)});l.length=0;v={}},refresh:function(){m={};r={};l.forEach(A)},
programs:[null],fragShaders:[k.id("void main(){gl_FragColor=vec4(0,0,0,0);}")],vertShaders:[k.id("void main(){gl_Position=vec4(0,0,0,0);}")]}}},{"./check":4,"./values":33}],27:[function(c,f,k){f.exports=function(b,c){var d=b.length,a=b.slice(),f=b.slice(),e=!1,h=!0;return{push:function(){e=!1;for(var b=0;b<d;++b){var c=arguments[b];e=e||c!==f[b];a.push(c)}},pop:function(){e=!1;a.length-=d;for(var b=0;b<d;++b)e=e||a[a.length-d+b]!==f[b]},poll:function(){var b=a.length-d;if(e||h){switch(d){case 1:c(a[b]);
break;case 2:c(a[b],a[b+1]);break;case 3:c(a[b],a[b+1],a[b+2]);break;case 4:c(a[b],a[b+1],a[b+2],a[b+3]);break;case 5:c(a[b],a[b+1],a[b+2],a[b+3],a[b+4]);break;case 6:c(a[b],a[b+1],a[b+2],a[b+3],a[b+4],a[b+5]);break;default:c.apply(null,a.slice(b,a.length))}for(var k=0;k<d;++k)f[k]=a[b+k];h=e=!1}},setDirty:function(){h=!0}}}},{}],28:[function(c,f,k){var b=c("./stack"),n=c("./codegen");f.exports=function(d,a,c){function e(a,c){var e=b([!!c],function(b){b?d.enable(a):d.disable(a)});e.flag=a;return e}
var f={dither:e(3024),"blend.enable":e(3042),"blend.color":b([0,0,0,0],function(a,b,c,e){d.blendColor(a,b,c,e)}),"blend.equation":b([32774,32774],function(a,b){d.blendEquationSeparate(a,b)}),"blend.func":b([1,0,1,0],function(a,b,c,e){d.blendFuncSeparate(a,b,c,e)}),"depth.enable":e(2929,!0),"depth.func":b([513],function(a){d.depthFunc(a)}),"depth.range":b([0,1],function(a,b){d.depthRange(a,b)}),"depth.mask":b([!0],function(a){d.depthMask(a)}),"cull.enable":e(2884),"cull.face":b([1029],function(a){d.cullFace(a)}),
frontFace:b([2305],function(a){d.frontFace(a)}),colorMask:b([!0,!0,!0,!0],function(a,b,c,e){d.colorMask(a,b,c,e)}),lineWidth:b([1],function(a){d.lineWidth(a)}),"polygonOffset.enable":e(32823),"polygonOffset.offset":b([0,0],function(a,b){d.polygonOffset(a,b)}),"sample.alpha":e(32926),"sample.enable":e(32928),"sample.coverage":b([1,!1],function(a,b){d.sampleCoverage(a,b)}),"stencil.enable":e(2960),"stencil.mask":b([-1],function(a){d.stencilMask(a)}),"stencil.func":b([519,0,-1],function(a,b,c){d.stencilFunc(a,
b,c)}),"stencil.opFront":b([7680,7680,7680],function(a,b,c){d.stencilOpSeparate(1028,a,b,c)}),"stencil.opBack":b([7680,7680,7680],function(a,b,c){d.stencilOpSeparate(1029,a,b,c)}),"scissor.enable":e(3089),"scissor.box":b([0,0,-1,-1],function(b,c,e,f){var k=e,h=a.top();0>e&&(k=h?h.width-b:d.drawingBufferWidth-b);e=f;0>f&&(e=h?h.height-c:d.drawingBufferHeight-c);d.scissor(b,c,k,e)}),viewport:b([0,0,-1,-1],function(b,e,f,l){var k=f,h=a.top();0>f&&(k=h?h.width-b:d.drawingBufferWidth-b);f=l;0>l&&(f=h?
h.height-e:d.drawingBufferHeight-e);d.viewport(b,e,k,f);c.width=k;c.height=f})},k=n(),H=k.proc("poll"),L=k.proc("refresh");Object.keys(f).forEach(function(a){a=k.link(f[a]);H(a,".poll();");L(a,".setDirty();")});var A=k.compile();return{contextState:f,viewport:c,poll:A.poll,refresh:A.refresh,notifyViewportChanged:function(){f.viewport.setDirty();f["scissor.box"].setDirty()}}}},{"./codegen":6,"./stack":27}],29:[function(c,f,k){f.exports=function(){var b={},c=[""];return{id:function(d){var a=b[d];if(a)return a;
a=b[d]=c.length;c.push(d);return a},str:function(b){return c[b]}}}},{}],30:[function(c,f,k){function b(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function n(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var d=a[0].length,c=1;c<b;++c)if(!Array.isArray(a[c])||a[c].length!==d)return!1;return!0}function d(a){return Object.prototype.toString.call(a)}function a(a){return"[object HTMLCanvasElement]"===d(a)}function q(a){return"[object CanvasRenderingContext2D]"===
d(a)}var e=c("./check"),h=c("./extend"),x=c("./values"),H=c("./is-typed-array"),L=c("./is-ndarray"),A=c("./load-texture"),m=c("./to-half-float"),r=c("./parse-dds"),v=[9984,9986,9985,9987];f.exports=function(c,f,k,u,ea){function W(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=this.miplevel=
0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function fa(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ga(a,b){var d,c,k=0,h=0,l=0,n=0,m=0,p=0,q=!1,r=!1,u=!1,x=0,y=[0,0,0,0,0,0],A=0,F=!1;for(d=0;d<b.length;++d){c=b[d];var n=n||c.width<<c.miplevel,
m=m||c.height<<c.miplevel,k=k||c.type,h=h||c.format,l=l||c.internalformat,p=p||c.channels,r=r||c.needsPoll,u=u||c.needsListeners,q=q||c.compressed,C=c.miplevel;c=c.target;F=F||0<C;3553===c?x|=1<<C:(c-=34069,y[c]|=1<<C,A|=1<<c)}a.needsPoll=r;a.needsListeners=u;a.width=n;a.height=m;a.format=h;a.internalformat=l;a.type=k;r=F?(n<<1)-1:1;if(3553===a.target)e(0===A,"pixmap type must not contain cubemap faces"),e(x===r,"missing mip map data");else for(e(63===A,"missing cubemap faces"),d=0;6>d;++d)e(y[d]===
r,"missing mip map data");d=0<=v.indexOf(a.minFilter);a.genMipmaps=!F&&(a.genMipmaps||d);F=F||a.genMipmaps;a.minFilter?e(F===d,"min filter inconsistent with mipmap data"):a.minFilter=F?9987:9728;F&&e(n===m&&!(n&n-1)&&!!n,"must be a square power of 2 to support mipmaps");a.genMipmaps&&e(!q,"mipmap generation not supported for compressed textures");a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;33071===a.wrapS&&33071===a.wrapT||e(!(n&n-1)&&!!n&&!(m&m-1)&&!!m&&!A,"incompatible size for wrap mode, image must be a power of 2");
(5126===k&&!f.oes_texture_float_linear||36193===k&&!f.oes_texture_half_float_linear)&&e(9728===this.magFilter&&9728===this.minFilter,"unsupported filter mode for float texture");for(d=0;d<b.length;++d)c=b[d],q=c.miplevel,c.width&&e(c.width<<q===n,"inconsistent width"),c.height&&e(c.height<<q===m,"inconsistent width"),c.channels?e(c.channels===p,"inconsistent channels"):c.channels=p,c.format?e(c.format===h,"inconsistent format"):c.format=h,c.internalformat?e(c.internalformat===l,"inconsistent internalformat"):
c.internalformat=l,c.type?e(c.type===k,"inconsistent type"):c.type=k,c.copy&&e(5121===c.type&&6408===c.internalformat,"incompatible format/type for copyTexImage2D")}function T(a){this.id=y++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new fa(a);this.pixels=[]}function ca(a,b){function c(a,d){var g=d.mipmap,e;if(Array.isArray(g))for(var f=0;f<g.length;++f)e=new W(a),e.parseFlags(b),e.parseFlags(d),e.parse(g[f],f),k.push(e);
else e=new W(a),e.parseFlags(b),e.parse(d,0),k.push(e)}var d;ha(a);var f=a.params;fa.call(f,a.target);var k=a.pixels;k.length=0;f.parse(b);if(3553===a.target)c(3553,b);else{var h=b.faces||b;if(Array.isArray(h))for(e(6===h.length,"invalid number of faces in cube map"),d=0;6>d;++d)c(34069+d,h[d]);else if("string"!==typeof h)for(d=0;6>d;++d)c(34069+d,{})}ga(f,k);f.needsListeners&&oa(a);f.needsPoll&&(a.pollId=D.length,D.push(a));ka(a)}function ka(a){c.isTexture(a.texture)||(a.texture=c.createTexture());
var b=a.target,d=a.unit;0<=d?(c.activeTexture(33984+d),I=d):c.bindTexture(b,a.texture);for(var b=a.pixels,e=a.params,f=0;f<b.length;++f)b[f].upload(e);e.upload();0>d&&((d=aa[I])?c.bindTexture(d.target,d.texture):(a.unit=I,aa[I]=a))}function oa(a){function b(c,d,k){var B=r(k);e(B.format in J,"unsupported dds texture format");B.cube?(e(34067===a.target),e.raise("cube map DDS not yet implemented")):e(3553===a.target);d&&e(1===B.pixels.length,"number of mip levels inconsistent");B.pixels.forEach(function(a){var b=
new W(B.cube?a.target:c);b.channels=B.channels;b.compressed=B.compressed;b.type=B.type;b.internalformat=B.format;b.format=J[B.format];b.width=a.width;b.height=a.height;b.miplevel=a.miplevel||d;b.data=a.data;f.push(b)})}function c(){for(var e=0;e<f.length;++e){var k=f[e],B=k.image,h=k.video,n=k.xhr;B&&B.complete?(k.width=B.naturalWidth,k.height=B.naturalHeight):h&&2<h.readyState?(k.width=h.width,k.height=h.height):n&&4===n.readyState&&(f[e]=f[f.length-1],f.pop(),n.removeEventListener("readystatechange",
ka),b(k.target,k.miplevel,n.response))}ga(d,f);ka(a)}var d=a.params,f=a.pixels;f.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){f.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function ha(a){var b=
a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((D[b]=D[D.length-1]).id=b,D.pop(),a.pollId=-1)}function la(a){var b=a.texture;e(b,"must not double destroy texture");var d=a.unit,f=a.target;0<=d&&(c.activeTexture(33984+d),I=d,c.bindTexture(f,null),aa[d]=null);ha(a);c.isTexture(b)&&c.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete p[a.id]}var C={"don't care":4352,"dont care":4352,nice:4354,fast:4353},Q={repeat:10497,clamp:33071,mirror:33648},ma={nearest:9728,
linear:9729},X=h({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ma),ia={none:0,browser:37444},ba={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},R={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Z={};f.ext_srgb&&(R.srgb=35904,R.srgba=35906);f.oes_texture_float&&(ba["float"]=5126);f.oes_texture_half_float&&(ba["half float"]=36193);f.webgl_depth_texture&&
(h(R,{depth:6402,"depth stencil":34041}),h(ba,{uint16:5123,uint32:5125,"depth stencil":34042}));f.webgl_compressed_texture_s3tc&&h(Z,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});f.webgl_compressed_texture_atc&&h(Z,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});f.webgl_compressed_texture_pvrtc&&h(Z,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});f.webgl_compressed_texture_etc1&&
(Z["rgb etc1"]=36196);var U=Array.prototype.slice.call(c.getParameter(34467));Object.keys(Z).forEach(function(a){var b=Z[a];0<=U.indexOf(b)&&(R[a]=b)});var Y=Object.keys(R);k.textureFormats=Y;var J=Y.reduce(function(a,b){var c=R[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});h(W.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in a&&(e.type(a.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),
this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(e.type(a.flipY,"boolean","invalid texture flip"),this.flipY=a.flipY);"alignment"in a&&(e.oneOf(a.alignment,[1,2,4,8],"invalid texture unpack alignment"),this.unpackAlignment=a.alignment);"colorSpace"in a&&(e.parameter(a.colorSpace,ia,"invalid colorSpace"),this.colorSpace=ia[a.colorSpace]);if("format"in a){var b=a.format;e.parameter(b,R,"invalid texture format");this.internalformat=R[b];b in ba&&(this.type=ba[b]);b in Z&&(this.compressed=!0)}"type"in
a&&(b=a.type,e.parameter(b,ba,"invalid texture type"),this.type=ba[b]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(e(Array.isArray(a.shape)&&2<=a.shape.length,"shape must be an array"),b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,e(Array.isArray(b)&&2<=b.length,"invalid stride vector"),
this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(c,k){this.miplevel=k;this.width>>=k;this.height>>=k;var h=c;switch(typeof c){case "string":break;case "object":if(!c)return;this.parseFlags(c);var l=c.data;if("string"===typeof l||l&&(H(l)||b(l)||L(l)||a(l)||
q(l)||"[object HTMLImageElement]"===d(l)||"[object HTMLVideoElement]"===d(l)||n(l)))h=c.data;break;case "undefined":return;default:e.raise("invalid pixel data type")}"string"===typeof h&&(h=A(h,this.crossOrigin));var l=null,p=!1;this.compressed&&e(h instanceof Uint8Array||"[object XMLHttpRequest]"===d(h),"compressed texture data must be stored in a uint8array");if(null!==h)if(H(h))this.data=h;else if(b(h))l=h,p=!0;else if(L(h)){Array.isArray(h.data)?(l=h.data,p=!0):this.data=h.data;var t=h.shape;
this.width=t[0];this.height=t[1];this.channels=3===t.length?t[2]:1;t=h.stride;this.strideX=h.stride[0];this.strideY=h.stride[1];this.strideC=3===t.length?h.stride[2]:1;this.offset=h.offset;this.needsTranspose=!0}else if(a(h)||q(h))a(h)?this.canvas=h:this.canvas=h.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===d(h))this.image=h,h.complete?(this.width=h.naturalWidth,this.height=h.naturalHeight):(this.width=this.width||
h.naturalWidth,this.height=this.height||h.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();else if("[object HTMLVideoElement]"===d(h))this.video=h,1<h.readyState?(this.width=h.width,this.height=h.height):(this.width=this.width||h.width,this.height=this.height||h.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===d(h))this.xhr=h,this.needsListeners=!0;else if(n(h)){var p=h.length,t=h[0].length,r=1,u,v,x,y;if(Array.isArray(h[0][0]))for(r=
h[0][0].length,e(0<=r&&4>=r,"invalid number of channels for image data"),l=Array(p*t*r),v=y=0;v<t;++v)for(u=0;u<p;++u)for(x=0;x<r;++x)l[y++]=h[u][v][x];else for(l=Array(p*t),v=y=0;v<t;++v)for(u=0;u<p;++u)l[y++]=h[u][v];this.width=p;this.height=t;this.channels=r;p=!0}else c.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||ea.width)|0,this.height=(this.height||ea.height)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:
this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=[6409,6410,6407,6408][(this.channels=this.channels||4)-1],e(this.internalformat,"invalid number of channels"));t=this.internalformat;if(6402===t||34041===t)e(f.webgl_depth_texture,"depth/stencil texture not supported"),6402===t&&e(5123===this.type||5125,"depth texture type must be uint16 or uint32"),34041===t&&e(34042===this.type,"depth stencil texture format must match type"),
e(!this.data&&!l&&!this.image&&!this.video&&!this.canvas,"depth/stencil textures are for rendering only");h=this.format=J[t];if(!this.channels)switch(h){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}h=this.type;5126===h?e(f.oes_texture_float,"float texture not supported"):36193===h?e(f.oes_texture_half_float,"half float texture not supported"):h||(h=6402===t?5125:5121);this.type=h;if(p)switch(h){case 5121:this.data=
new Uint8Array(l);break;case 5123:this.data=new Uint16Array(l);break;case 5125:this.data=new Uint32Array(l);break;case 5126:this.data=new Float32Array(l);break;case 36193:this.data=m(l);break;case 33635:case 32820:case 32819:case 34042:e.raise("unsupported format for automatic conversion");break;default:e.raise("unsupported type conversion")}if(this.data){if(this.needsTranspose){l=this.data;p=this.width;t=this.height;r=this.channels;u=this.strideX;v=this.strideY;x=this.strideC;y=this.offset;for(var z=
new l.constructor(p*t*r),C=0,D=0;D<t;++D)for(var E=0;E<p;++E)for(var I=0;I<r;++I)z[C++]=l[v*D+u*E+x*I+y];this.data=z}switch(h){case 5121:e(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray,"incompatible pixel type");break;case 33635:case 32820:case 32819:case 5123:case 36193:e(this.data instanceof Uint16Array,"incompatible pixel type");break;case 5125:e(this.data instanceof Uint32Array,"incompatible pixel type");break;case 5126:e(this.data instanceof Float32Array,"incompatible pixel type");
break;default:e.raise("bad or missing pixel type")}}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){c.pixelStorei(37440,this.flipY);c.pixelStorei(37441,this.premultiplyAlpha);c.pixelStorei(37443,this.colorSpace);c.pixelStorei(3317,this.unpackAlignment);var b=this.target,d=this.miplevel,e=this.image,f=this.canvas,h=this.video,k=this.data,n=this.internalformat,m=this.format,p=this.type,q=this.width||
Math.max(1,a.width>>d);a=this.height||Math.max(1,a.height>>d);h&&2<h.readyState?c.texImage2D(b,d,m,m,p,h):e&&e.complete?c.texImage2D(b,d,m,m,p,e):f?c.texImage2D(b,d,m,m,p,f):this.compressed?c.compressedTexImage2D(b,d,n,q,a,0,k):this.copy?(u(),c.copyTexImage2D(b,d,m,this.x,this.y,q,a,0)):k?c.texImage2D(b,d,m,q,a,0,m,p,k):c.texImage2D(b,d,m,q||1,a||1,0,m,p,null)}});h(fa.prototype,{parse:function(a){if("object"===typeof a&&a){if("min"in a){var b=a.min;e.parameter(b,X);this.minFilter=X[b]}"mag"in a&&
(b=a.mag,e.parameter(b,ma),this.magFilter=ma[b]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var d=a.wrap;"string"===typeof d?(e.parameter(d,Q),b=c=Q[d]):Array.isArray(d)&&(e.parameter(d[0],Q),e.parameter(d[1],Q),b=Q[d[0]],c=Q[d[1]])}else"wrapS"in a&&(b=a.wrapS,e.parameter(b,Q),b=Q[b]),"wrapT"in a&&(c=a.wrapT,e.parameter(c,Q),c=Q[c]);this.wrapS=b;this.wrapT=c;"anisotropic"in a&&(b=a.anisotropic,e("number"===typeof b&&1<=b&&b<=k.maxAnisotropic,"aniso samples must be between 1 and "),this.anisotropic=
a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":e.parameter(a,C,"invalid mipmap hint");this.mipmapHint=C[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a;break;case "object":break;default:e.raise("invalid mipmap type")}}},upload:function(){var a=this.target;c.texParameteri(a,10241,this.minFilter);c.texParameteri(a,10240,this.magFilter);c.texParameteri(a,10242,this.wrapS);c.texParameteri(a,10243,this.wrapT);f.ext_texture_filter_anisotropic&&c.texParameteri(a,
34046,this.anisotropic);this.genMipmaps&&(c.hint(33170,this.mipmapHint),c.generateMipmap(a))}});var I=0,y=0,p={},D=[],E=k.maxTextureUnits,aa=Array(E).map(function(){return null});h(T.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<E;++b){var d=aa[b];if(d){if(0<d.bindCount)continue;d.unit=-1}aa[b]=this;a=b;break}a>=E&&e.raise("insufficient number of texture units");this.unit=a;c.activeTexture(33984+a);c.bindTexture(this.target,this.texture);I=a}return a},unbind:function(){--this.bindCount},
decRef:function(){0===--this.refCount&&la(this)}});return{create:function(a,b){function c(a,e,g,f,h,k){var l=a||{};34067===b&&6===arguments.length&&(l=[a,e,g,f,h,k]);ca(d,l);c.width=d.params.width;c.height=d.params.height;return c}var d=new T(b);p[d.id]=d;c(a);c._reglType="texture";c._texture=d;c.destroy=function(){d.decRef()};return c},refresh:function(){x(p).forEach(ka);for(var a=0;a<E;++a)aa[a]=null;I=0;c.activeTexture(33984)},clear:function(){for(var a=0;a<E;++a)c.activeTexture(33984+a),c.bindTexture(3553,
null),aa[a]=null;c.activeTexture(33984);I=0;x(p).forEach(la)},poll:function(){D.forEach(ka)},getTexture:function(a){return null}}}},{"./check":4,"./extend":15,"./is-ndarray":18,"./is-typed-array":19,"./load-texture":21,"./parse-dds":22,"./to-half-float":31,"./values":33}],31:[function(c,f,k){f.exports=function(b){for(var c=new Float32Array(b),c=new Uint32Array(c.buffer),d=new Uint16Array(b.length),a=0;a<b.length;++a)if(isNaN(b[a]))d[a]=65535;else if(Infinity===b[a])d[a]=31744;else if(-Infinity===
b[a])d[a]=64512;else{var f=c[a],e=f>>>31<<15,h=(f<<1>>>24)-127,f=f>>13&1023;d[a]=-24>h?e:-14>h?e+(f+1024>>-14-h):15<h?e+31744:e+(h+15<<10)+f}return d}},{}],32:[function(c,f,k){f.exports=function(b){var c={};return{def:function(d){d=b.id(d);var a=c[d];a||(a=c[d]=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]);return a}}}},{}],33:[function(c,f,k){f.exports=function(b){return Object.keys(b).map(function(c){return b[c]})}},{}],34:[function(c,f,k){var b=c("./lib/check"),n=c("./lib/extend"),d=c("./lib/context"),a=
c("./lib/strings"),q=c("./lib/extension"),e=c("./lib/limits"),h=c("./lib/buffer"),x=c("./lib/elements"),H=c("./lib/texture"),L=c("./lib/renderbuffer"),A=c("./lib/framebuffer"),m=c("./lib/uniform"),r=c("./lib/attribute"),v=c("./lib/shader"),l=c("./lib/draw"),M=c("./lib/state"),P=c("./lib/compile"),u=c("./lib/read"),ea=c("./lib/dynamic"),W=c("./lib/raf"),fa=c("./lib/clock");f.exports=function(){function c(){N=W.next(c);E.count+=1;if(E.width!==C.drawingBufferWidth||E.height!==C.drawingBufferHeight)E.width=
C.drawingBufferWidth,E.height=C.drawingBufferHeight,aa.notifyViewportChanged();var a=fa();E.dt=a-E.t;E.t=a;y.poll();for(var b=0;b<B.length;++b)(0,B[b])(E.count,E.t,E.dt);E.renderTime=fa()-a}function f(){N&&(W.cancel(c),N=0)}function k(a){f();a.preventDefault();if(Q.onContextLost)Q.onContextLost()}function ka(a){C.getError();ma.refresh();R.refresh();y.refresh();p.refresh();D.refresh();J.refresh();aa.refresh();if(Q.onContextRestored)Q.onContextRestored();c()}function oa(a){function c(a){var b={},e=
{};Object.keys(a).forEach(function(c){var f=a[c];ea.isDynamic(f)?(d=!0,e[c]=ea.unbox(f,c)):b[c]=f});return{dynamic:e,"static":b}}b(!!a,"invalid args to regl({...})");b.type(a,"object","invalid args to regl({...})");var d=!1,e=c(a.uniforms||{}),f=c(a.attributes||{});a=c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=n({},a);delete c.uniforms;delete c.attributes;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");
b("sample");return c}(a));var e=g.command(a["static"],e["static"],f["static"],a.dynamic,e.dynamic,f.dynamic,d),h=e.draw,k=e.batch,l=e.scope,m=[];return function(a,b){if("number"===typeof a){for(var c=a|0;m.length<c;)m.push(null);return k(a|0,m)}return Array.isArray(a)?k(a.length,a):"function"===typeof a?l(null,a):"function"===typeof b?l(a,b):h(a)}}function ha(){D.poll();aa.poll()}var la=d(Array.prototype.slice.call(arguments)),C=la.gl,Q=la.options,la=a(),ma=q(C),X=ma.extensions,ia={width:C.drawingBufferWidth,
height:C.drawingBufferHeight},ba=e(C,X),R=h(C),Z=x(C,X,R),U=m(la),Y=r(C,X,ba,R,la),J=v(C,Y,U,function(a){return g.draw(a)},la),I=l(C,X,R),y=H(C,X,ba,ha,ia),p=L(C,X,ba),D=A(C,X,ba,y,p),E={count:0,start:fa(),dt:0,t:fa(),renderTime:0,width:C.drawingBufferWidth,height:C.drawingBufferHeight,pixelRatio:Q.pixelRatio},aa=M(C,D,ia),ia=u(C,ha,ia),g=P(C,la,X,ba,R,Z,y,D,aa,U,Y,J,I,E,ha),G=C.canvas,B=[],N=0;G&&(G.addEventListener("webglcontextlost",k,!1),G.addEventListener("webglcontextrestored",ka,!1));return n(oa,
{clear:function(a){var c=0;ha();var d=a.color;d&&(C.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in a&&(C.clearDepth(+a.depth),c|=256);"stencil"in a&&(C.clearStencil(a.stencil|0),c|=1024);b(!!c,"called regl.clear with no buffer specified");C.clear(c)},prop:ea.define,draw:oa({}),elements:function(a){return Z.create(a)},buffer:function(a){return R.create(a,34962)},texture:function(a){return y.create(a,3553)},cube:function(a){return 6===arguments.length?y.create(Array.prototype.slice.call(arguments),
34067):y.create(a,34067)},renderbuffer:function(a){return p.create(a)},framebuffer:function(a){return D.create(a)},framebufferCube:function(a){b.raise("framebuffer cube not yet implemented")},frame:function(a){B.push(a);!N&&0<B.length&&c();return{cancel:function(){var b=B.find(function(b){return b===a});0>b||(B.splice(b,1),0>=B.length&&f())}}},stats:E,limits:ba,read:ia,destroy:function(){f();G&&(G.removeEventListener("webglcontextlost",k),G.removeEventListener("webglcontextrestored",ka));J.clear();
D.clear();p.clear();y.clear();R.clear();if(Q.onDestroy)Q.onDestroy()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/check":4,"./lib/clock":5,"./lib/compile":7,"./lib/context":11,"./lib/draw":12,"./lib/dynamic":13,"./lib/elements":14,"./lib/extend":15,"./lib/extension":16,"./lib/framebuffer":17,"./lib/limits":20,"./lib/raf":23,"./lib/read":24,"./lib/renderbuffer":25,"./lib/shader":26,"./lib/state":28,"./lib/strings":29,"./lib/texture":30,"./lib/uniform":32}]},{},[1]);

        </script>
        </body>
      </html>