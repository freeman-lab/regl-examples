(function e$$0(g,p,d){function m(b,f){if(!p[b]){if(!g[b]){var z="function"==typeof require&&require;if(!f&&z)return z(b,!0);if(a)return a(b,!0);z=Error("Cannot find module '"+b+"'");throw z.code="MODULE_NOT_FOUND",z;}z=p[b]={exports:{}};g[b][0].call(z.exports,function(a){var d=g[b][1][a];return m(d?d:a)},z,z.exports,e$$0,g,p,d)}return p[b].exports}for(var a="function"==typeof require&&require,b=0;b<d.length;b++)m(d[b]);return m})({1:[function(e,g,p){e=e("../regl")();var d=e({frag:"\n  precision mediump float;\n  uniform sampler2D specular, normals, diffuse;\n  varying vec3 lightDir, eyeDir;\n  varying vec2 uv;\n  void main () {\n    float d = length(lightDir);\n    vec3 L = normalize(lightDir);\n    vec3 E = normalize(eyeDir);\n    vec3 N = normalize(2.0 * texture2D(normals, uv).rgb - 1.0);\n    N = vec3(-N.x, N.yz);\n    vec3 D = texture2D(diffuse, uv).rgb;\n    vec3 kD = D * (0.01 +\n      max(0.0, dot(L, N) * (0.6 + 0.8 / d) ));\n    vec3 S = texture2D(specular, uv).rgb;\n    vec3 kS = 2.0 * pow(max(0.0, dot(normalize(N + L), -E)), 10.0) * S;\n    gl_FragColor = vec4(kD + kS, 1);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  uniform vec2 lightPosition;\n  varying vec3 lightDir, eyeDir;\n  varying vec2 uv;\n  void main () {\n    vec2 P = 1.0 - 2.0 * position;\n    uv = vec2(position.x, 1.0 - position.y);\n    eyeDir = -vec3(P, 1);\n    lightDir = vec3(lightPosition - P, 1);\n    gl_Position = vec4(P, 0, 1);\n  }",attributes:{position:e.buffer([-2,0,0,-2,2,2])},uniforms:{specular:e.texture({mag:"linear",data:"assets/alpine_cliff_a_spec.png"}),normals:e.texture({mag:"linear",
data:"assets/alpine_cliff_a_norm.png"}),diffuse:e.texture("assets/alpine_cliff_a.dds"),lightPosition:function(d,a){var b=.025*a.count;return[2*Math.cos(b),2*Math.sin(b)]}},count:3});e.frame(function(){d()})},{"../regl":33}],2:[function(e,g,p){var d=e("./constants/dtypes.json");g.exports=function(m,a,b,M,f){function z(){this.pointer=!1;this.w=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}function k(a){this.records=[];this.name=
a}function e(b,c,h,d){d=h.size||d;var n;n=c.pointer?h.pointer&&c.buffer===h.buffer&&c.size===d&&c.normalized===h.normalized&&c.type===(h.type||h.buffer.dtype||5126)&&c.offset===h.offset&&c.stride===h.stride&&c.divisor===h.divisor:!h.pointer&&c.x===h.x&&c.y===h.y&&c.z===h.z&&c.w===h.w;n||(h.pointer?(m.enableVertexAttribArray(b),h.buffer.bind(),m.vertexAttribPointer(b,d,h.type||h.buffer.dtype||5126,h.normalized,h.stride,h.offset),(n=a.angle_instanced_arrays)&&n.vertexAttribDivisorANGLE(b,h.divisor)):
(m.disableVertexAttribArray(b),m.vertexAttrib4f(b,h.x,h.y,h.z,h.w)),(c.pointer=h.pointer)?(c.buffer=h.buffer,c.size=d,c.normalized=h.normalized,c.type=h.type||h.buffer.dtype||5126,c.offset=h.offset,c.stride=h.stride,c.divisor=h.divisor):(c.x=h.x,c.y=h.y,c.z=h.z,c.w=h.w))}var g={};b=b.maxAttributes;for(var C=Array(b),n=0;n<b;++n)C[n]=new z;return{bindings:C,bind:function(a,c,h,b){h=h.records;e(a,c,h[h.length-1],b)},bindRecord:e,def:function(a){var c=f.id(a),h=g[c];h||(h=g[c]=new k(a));return h},box:function(a){var c=
[new z];return{alloc:function(a){var b;b=0>=c.length?new z:c.pop();if("number"===typeof a)b.pointer=!1,b.x=a,b.y=0,b.z=0,b.w=0;else if(Array.isArray(a))b.pointer=!1,b.x=a[0],b.y=a[1],b.z=a[2],b.w=a[3];else{var n=M.getBuffer(a),f=0,m=0,k=0,e=0,g=!1,A=0;n||(n=M.getBuffer(a.buffer),f=a.size||0,m=a.stride||0,k=a.offset||0,e=a.divisor||0,g=a.normalized||!1,A=0,"type"in a&&(A=d[a.type]));b.pointer=!0;b.buffer=n;b.size=f;b.offset=k;b.stride=m;b.divisor=e;b.normalized=g;b.type=A}return b},free:function(a){c.push(a)}}},
state:g}}},{"./constants/dtypes.json":6}],3:[function(e,g,p){function d(a,b){switch(a){case 5121:return new Uint8Array(b);case 5123:return new Uint16Array(b);case 5125:return new Uint32Array(b);case 5120:return new Int8Array(b);case 5122:return new Int16Array(b);case 5124:return new Int32Array(b);case 5126:return new Float32Array(b);default:return null}}var m=e("./util/is-typed-array"),a=e("./util/is-ndarray"),b=e("./constants/arraytypes.json"),M=e("./constants/dtypes.json"),f=e("./util/values"),
z={"static":35044,dynamic:35048,stream:35040};g.exports=function(k,e){function g(a,b){this.id=A++;this.buffer=a;this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function C(a){e(a);k.isBuffer(a.buffer)||(a.buffer=k.createBuffer());a.bind();k.bufferData(a.type,a.data||a.byteLength,a.usage)}function n(a){var b=a.buffer;e(a);k.isBuffer(b)&&k.deleteBuffer(b);a.buffer=null;delete c[a.id]}var A=0,c={};g.prototype.bind=function(){k.bindBuffer(this.type,this.buffer)};
return{create:function(h,f,e){function A(c){var h=c||{};if(Array.isArray(h)||m(h)||a(h))h={data:h};else if("number"===typeof h)h={length:h|0};else if(null===h||void 0===h)h={};B.usage="usage"in h?z[h.usage]:35044;c=0;"type"in h&&(c=M[h.type]);var n=h.dimension|0||1,f=0,k=null;if("data"in h)if(k=h.data,null===k)f=h.length|0;else{if(a(k)){var n=k.shape,f=k.stride,h=k.offset,e=0,g=0,l=0,P=0;1===n.length?(e=n[0],g=1,l=f[0],P=0):2===n.length&&(e=n[0],g=n[1],l=f[0],P=f[1]);c=c||b[Object.prototype.toString.call(k)]|
0||5126;for(var n=g,f=d(c,e*g),k=k.data,ma=0,T=0;T<e;++T)for(var aa=0;aa<g;++aa)f[ma++]=k[l*T+P*aa+h];k=f}else if(Array.isArray(k))if(0<k.length&&Array.isArray(k[0])){n=k[0].length;c=c||5126;h=d(c,k.length*n);f=k;k=n;for(e=P=0;e<f.length;++e)for(l=f[e],g=0;g<k;++g)h[P++]=l[g];k=h}else c=c||5126,k=d(c,k);else c=c||b[Object.prototype.toString.call(k)]|0;f=k.byteLength}else"length"in h&&(f=h.length|0);B.data=k;B.dtype=c||5121;B.byteLength=f;B.dimension=n;C(B);return A}var D=k.createBuffer(),B=new g(D,
f);c[B.id]=B;e||A(h);A._reglType="buffer";A._buffer=B;A.destroy=function(){n(B)};return A},clear:function(){f(c).forEach(n)},refresh:function(){f(c).forEach(C)},getBuffer:function(a){return a&&a._buffer instanceof g?a._buffer:null}}}},{"./constants/arraytypes.json":5,"./constants/dtypes.json":6,"./util/is-ndarray":24,"./util/is-typed-array":25,"./util/values":31}],4:[function(e,g,p){function d(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;
default:return 1}}function m(a,b,d,f){var c,h=",";switch(b){case 5126:c="1f";break;case 35664:c="2fv";break;case 35665:c="3fv";break;case 35666:c="4fv";break;case 35670:case 5124:c="1i";break;case 35671:case 35667:c="2iv";break;case 35672:case 35668:c="3iv";break;case 35673:case 35669:c="4iv";break;case 35674:c="Matrix2fv";h=",false,";break;case 35675:c="Matrix3fv";h=",false,";break;case 35676:c="Matrix4fv",h=",false,"}return a+".uniform"+c+"("+d+h+f+");"}function a(a){return a+"["+a+".length-1]"}
function b(a,b){return"framebuffer"===a||a<b?-1:a>b?1:0}var M=e("./util/codegen"),f=e("./constants/primitives.json"),z={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},k={never:512,less:513,"<":513,equal:514,"=":514,"==":514,
"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},D={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};g.exports=function(e,g,n,A,c,h,I,O,E,p,B,S,U,la,V){function ja(c,l,g,A,W){function I(t){var a=qa[t];return a?a:a=qa[t]=y(Z[t])}function C(t){var a=t.id,c=ca[a];if(c)return c;switch(t.type){case 0:c=q.def(y(t.data),".call(this,",N,",",L,")");break;case 1:c=q.def(N,
t.data);break;case 2:c=q.def(L,t.data);break;case 3:c=q.def("this",t.data)}return ca[a]=c}function ha(t,a){for(var c=0;c<t.length;++c)if(t[c].name===a)return t[c];return null}function v(t){return J&&!(t in l||t in W)}var E=M(),y=E.link,q=E.proc("batch"),u=E.block(),F=q.def,fa=q.arg,x=y(e),r=y(c.program),Q=y(B.bind),na=y(B.bindRecord),L=y(la),Y=y(O),ba=y(U.count),ia=y(U.offset),pa=y(U.instances),R=y(U.primitive),qa={},w=y(h.elements),ba=F(a(ba)),ia=F(a(ia)),R=F(a(R)),w=F(a(w)),H,ga,S=n.angle_instanced_arrays;
S&&(H=F(a(pa)),ga=y(S));var J="elements"in l,pa=fa(),fa=fa(),N=F(),V=F(),ca={};q(x,".useProgram(",r,");");c.uniforms.forEach(function(t){if(!(t.name in g)){var a=y(t.location),c=y(p.def(t.name)),c=c+"["+c+".length-1]";t=t.info.type;35678===t||35680===t?(t=F(c+"._texture"),q(m(x,5124,a,t+".bind()")),u(t,".unbind();")):q(m(x,t,a,c))}});c.attributes.forEach(function(t){if(!(t.name in A)){var a=y(B.def(t.name));q(Q,"(",t.location,",",y(B.bindings[t.location]),",",a,",",d(t.info.type),");")}});J||q("if(",
w,")",x,".bindBuffer(",34963,",",w,".buffer.buffer);");q("for(",V,"=0;",V,"<",pa,";++",V,"){",N,"=",fa,"[",V,"];",L,".batchId=",V,";");Object.keys(l).sort(b).forEach(function(t){function a(t){q("if(",c,"){",x,".enable(",t,");}else{",x,".disable(",t,");}")}var c=C(l[t]);switch(t){case "framebuffer":t=I("viewport");var b=I("scissor.box");q("if(",Y,".push(",c,"&&",c,"._framebuffer)){",Y,".poll();",t,".setDirty();",b,".setDirty();","}");break;case "cull.enable":a(2884);break;case "blend.enable":a(3042);
break;case "dither":a(3024);break;case "stencil.enable":a(2960);break;case "depth.enable":a(2929);break;case "scissor.enable":a(3089);break;case "polygonOffset.enable":a(32823);break;case "sample.alpha":a(32926);break;case "sample.enable":a(32928);break;case "depth.mask":q(x,".depthMask(",c,");");break;case "depth.func":t=y(k);q(x,".depthFunc(",t,"[",c,"]);");break;case "depth.range":q(x,".depthRange(",c,"[0],",c,"[1]);");break;case "blend.color":q(x,".blendColor(",c,"[0],",c,"[1],",c,"[2],",c,"[3]);");
break;case "blend.equation":t=y(K);q("if(typeof ",c,'==="string"){',x,".blendEquation(",t,"[",c,"]);","}else{",x,".blendEquationSeparate(",t,"[",c,".rgb],",t,"[",c,".alpha]);","}");break;case "blend.func":t=y(z);q(x,".blendFuncSeparate(",t,'["srcRGB" in ',c,"?",c,".srcRGB:",c,".src],",t,'["dstRGB" in ',c,"?",c,".dstRGB:",c,".dst],",t,'["srcAlpha" in ',c,"?",c,".srcAlpha:",c,".src],",t,'["dstAlpha" in ',c,"?",c,".dstAlpha:",c,".dst]);");break;case "stencil.mask":q(x,".stencilMask(",c,");");break;case "stencil.func":t=
y(k);q(x,".stencilFunc(",t,"[",c,'.cmp||"always"],',c,".ref|0,",'"mask" in ',c,"?",c,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":b=y(D);q(x,".stencilOpSeparate(","stencil.opFront"===t?1028:1029,",",b,"[",c,'.fail||"keep"],',b,"[",c,'.zfail||"keep"],',b,"[",c,'.pass||"keep"]);');break;case "polygonOffset.offset":q(x,".polygonOffset(",c,".factor||0,",c,".units||0);");break;case "cull.face":q(x,".cullFace(",c,'==="front"?',1028,":",1029,");");break;case "lineWidth":q(x,".lineWidth(",
c,");");break;case "frontFace":q(x,".frontFace(",c,'==="cw"?',2304,":",2305,");");break;case "colorMask":q(x,".colorMask(",c,"[0],",c,"[1],",c,"[2],",c,"[3]);");break;case "sample.coverage":q(x,".sampleCoverage(",c,".value,",c,".invert);");break;case "scissor.box":case "viewport":t=I(t),q(t,".push(",c,".x||0,",c,".y||0,",c,".w||-1,",c,".h||-1);")}});("viewport"in l||"framebuffer"in l)&&q(I("viewport"),".poll();");("scissor.box"in l||"framebuffer"in l)&&q(I("scissor.box"),".poll();");"framebuffer"in
l&&q(Y,".pop();");var da=c.uniforms,sa=[];Object.keys(g).forEach(function(t){var c=ha(da,t);if(c){var a=c.info.type,b=y(c.location);t=C(g[t]);35678===c.info.type||35680===c.info.type?(c=F(t+"._texture"),sa.push(c),q(m(x,5124,b,c+".bind()"))):q(m(x,a,b,t))}});sa.forEach(function(t){q(t,".unbind();")});var oa=c.attributes;Object.keys(A).forEach(function(t){var c=ha(oa,t);if(c){var a=y(B.box(t));t=C(A[t]);t=F(a+".alloc("+t+")");q(na,"(",c.location,",",y(B.bindings[c.location]),",",t,",",d(c.info.type),
");");u(a,".free(",t,");")}});l.count&&q(ba,"=",C(l.count),";");l.offset&&q(ia,"=",C(l.offset),";");l.primitive&&q(R,"=",y(f),"[",C(l.primitive),"];");S&&l.instances&&q(H,"=",C(l.instances),";");J&&(c=C(l.elements),q(w,"=",c,"?",c,"._elements:null;"));v("offset")&&q(ia,"=0;");q("if(",w,"){");v("count")&&q(ba,"=",w,".vertCount;");q("if(",ba,">0){");v("primitive")&&q(R,"=",w,".primType;");J&&q(x,".bindBuffer(",34963,",",w,".buffer.buffer);");S&&q("if(",H,">0){",ga,".drawElementsInstancedANGLE(",R,",",
ba,",",w,".type,",ia,",",H,");}else ");q(x,".drawElements(",R,",",ba,",",w,".type,",ia,");");q("}}else if(",ba,">0){");v("count")||(v("primitive")&&q(R,"=",4,";"),S&&q("if(",H,">0){",ga,".drawArraysInstancedANGLE(",R,",",ia,",",ba,",",H,");}else{"),q(x,".drawArrays(",R,",",ia,",",ba,");"),S&&q("}"));q("}}",u);return E.compile().batch}var Z=E.contextState,K={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(K.min=32775,K.max=32776);var l=0;return{draw:function(c){var b=M(),f=
b.link,k=b.proc("draw"),l=k.def,g=f(e),z=f(c.program),A=f(B.bind),v=f(U.count),I=f(U.offset),y=f(U.instances),q=f(U.primitive),u=f(h.elements),C=[];k(g,".useProgram(",z,");");c.attributes.forEach(function(c){var a=f(B.def(c.name));k(A,"(",c.location,",",f(B.bindings[c.location]),",",a,",",d(c.info.type),");")});c.uniforms.forEach(function(c){var a=f(c.location),b=f(p.def(c.name)),b=b+"["+b+".length-1]";c=c.info.type;35678===c||35680===c?(c=l(b+"._texture"),C.push(c),k(m(g,5124,a,c+".bind()"))):k(m(g,
c,a,b))});C.forEach(function(c){k(c,".unbind();")});c=l(a(q));v=l(a(v));I=l(a(I));u=l(a(u));k("if(",v,"){");(z=n.angle_instanced_arrays)?(y=l(a(y)),z=f(z),k("if(",u,"){",u,".bind();","if(",y,">0){",z,".drawElementsInstancedANGLE(",c,",",v,",",u,".type,",I,",",y,");}else{",g,".drawElements(",c,",",v,",",u,".type,",I,");}","}else if(",y,">0){",z,".drawArraysInstancedANGLE(",c,",",I,",",v,",",y,");}else{",g,".drawArrays(",c,",",I,",",v,");}}")):k("if(",u,"){",u,".bind();",g,".drawElements(",c,",",v,
",",u,".type,",I,");","}else{",g,".drawArrays(",c,",",I,",",v,");}}");return b.compile().draw},command:function(c,a,d,n,e,m,A,I){function v(c){var a=qa[c];return a?a:a=qa[c]=u(Z[c])}function E(c,a){var b=v(c);w(b,".push(",a,");");H(b,".pop();")}function y(c){var a=c.id,b=ua[a];if(b)return b;switch(c.type){case 0:b=J.def(u(c.data),".call(this,",ga,",",R,")");break;case 1:b=J.def(ga,c.data);break;case 2:b=J.def(R,c.data);break;case 3:b=J.def("this",c.data)}return ua[a]=b}var q=M(),u=q.link,F=q.block,
G=q.proc,x=l++,r=u(V),Q=u(S),na=u(O),L={count:u(U.count),offset:u(U.offset),instances:u(U.instances),primitive:u(U.primitive)},Y=u(h.elements),ba=u(f),ia=u(k),pa=u(D),R=u(la),qa={},w=F(),H=F(),ga;I&&(ga=w.def());w(R,".batchId=0;");var ta=F();Object.keys(A["static"]).forEach(function(c){var a=w.def(R,".",c);ta(R,".",c,"=",u(A["static"][c]),";");H(R,".",c,"=",a,";")});Object.keys(A.dynamic).forEach(function(c){var a=w.def(R,".",c),b=w.def(),r=A.dynamic[c];ta(R,".",c,"=",b,";");switch(r.type){case 0:w(b,
"=",u(r.data),".call(this,",ga,",",R,");");break;case 1:w(b,"=",ga,r.data,";");break;case 2:w(b,"=",R,r.data,";");break;case 3:w(b,"=","this",r.data,";")}H(R,".",c,"=",a,";")});w(ta);Object.keys(c).sort(b).forEach(function(a){var b=c[a];switch(a){case "frag":case "vert":b=g.id(b);S.shader("frag"===a?35632:35633,b);w(Q,".",a,".push(",b,");");H(Q,".",a,".pop();");break;case "framebuffer":O.getFramebuffer(b);a=v("viewport");var r=v("scissor.box");w("if(",na,".push(",u(b&&b._framebuffer),")){",a,".setDirty();",
r,".setDirty();","}");H("if(",na,".pop()){",a,".setDirty();",r,".setDirty();","}");break;case "count":case "offset":case "instances":w(L[a],".push(",b,");");H(L[a],".pop();");break;case "primitive":w(L.primitive,".push(",f[b],");");H(L.primitive,".pop();");break;case "elements":r=h.getElements(b);b=!("primitive"in c);a=!("count"in c);r?(r=u(r),w(Y,".push(",r,");"),b&&w(L.primitive,".push(",r,".primType);"),a&&w(L.count,".push(",r,".vertCount);")):(w(Y,".push(null);"),b&&w(L.primitive,".push(",4,");"),
a&&w(L.count,".push(0);"));b&&H(L.primitive,".pop();");a&&H(L.count,".pop();");"offset"in c||(w(L.offset,".push(0);"),H(L.offset,".pop();"));H(Y,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":E(a,b);break;case "depth.func":E(a,k[b]);break;case "depth.range":a=v(a);w(a,".push(",b[0],",",b[1],");");H(a,".pop();");break;case "blend.func":a=
v(a);w(a,".push(",z["srcRGB"in b?b.srcRGB:b.src],",",z["dstRGB"in b?b.dstRGB:b.dst],",",z["srcAlpha"in b?b.srcAlpha:b.src],",",z["dstAlpha"in b?b.dstAlpha:b.dst],");");H(a,".pop();");break;case "blend.equation":a=v(a);"string"===typeof b?w(a,".push(",K[b],",",K[b],");"):"object"===typeof b&&w(a,".push(",K[b.rgb],",",K[b.alpha],");");H(a,".pop();");break;case "blend.color":a=v(a);w(a,".push(",b[0],",",b[1],",",b[2],",",b[3],");");H(a,".pop();");break;case "stencil.mask":a=v(a);w(a,".push(",b,");");
H(a,".pop();");break;case "stencil.func":var r=b.cmp||"keep",d=b.ref||0,b="mask"in b?b.mask:-1;a=v(a);w(a,".push(",k[r],",",d,",",b,");");H(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":r=b.fail||"keep";d=b.zfail||"keep";b=b.pass||"keep";a=v(a);w(a,".push(",D[r],",",D[d],",",D[b],");");H(a,".pop();");break;case "polygonOffset.offset":r=b.factor||0;b=b.units||0;a=v(a);w(a,".push(",r,",",b,");");H(a,".pop();");break;case "cull.face":r=0;"front"===b?r=1028:"back"===b&&(r=1029);b=v(a);
w(b,".push(",r,");");H(b,".pop();");break;case "lineWidth":E(a,b);break;case "frontFace":r=0;"cw"===b?r=2304:"ccw"===b&&(r=2305);b=v(a);w(b,".push(",r,");");H(b,".pop();");break;case "colorMask":a=v(a);w(a,".push(",b.map(function(c){return!!c}).join(),");");H(a,".pop();");break;case "sample.coverage":r="value"in b?b.value:1;b=!!b.invert;a=v(a);w(a,".push(",r,",",b,");");H(a,".pop();");break;case "viewport":case "scissor.box":var r=b.x||0,d=b.y||0,n=-1,l=-1;"w"in b&&(n=b.w);"h"in b&&(l=b.h);b=v(a);
w(b,".push(",r,",",d,",",n,",",l,");");H(b,".pop();")}});Object.keys(a).forEach(function(c){var b=u(p.def(c));c=a[c];c="function"===typeof c&&c._reglType?u(c):Array.isArray(c)?u(c.slice()):+c;w(b,".push(",c,");");H(b,".pop();")});Object.keys(d).forEach(function(c){var a=d[c],b=u(B.def(c));c=u(B.box(c).alloc(a));w(b,".records.push(",c,");");H(b,".records.pop();")});var J=q.block(),N=q.block(),ua={};Object.keys(n).sort(b).forEach(function(a){var b=y(n[a]);switch(a){case "framebuffer":a=v("viewport");
var r=v("scissor.box");J("if(",na,".push(",b,"&&",b,"._framebuffer)){",a,".setDirty();",r,".setDirty();","}");N("if(",na,".pop()){",a,".setDirty();",r,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=v(a);J(a,".push(",b,");");N(a,".pop();");break;case "count":case "offset":case "instances":a=L[a];J(a,
".push(",b,");");N(a,".pop();");break;case "primitive":a=L.primitive;J(a,".push(",ba,"[",b,"]);");N(a,".pop();");break;case "depth.func":a=v(a);J(a,".push(",ia,"[",b,"]);");N(a,".pop();");break;case "blend.func":a=v(a);r=u(z);J(a,".push(",r,'["srcRGB" in ',b,"?",b,".srcRGB:",b,".src],",r,'["dstRGB" in ',b,"?",b,".dstRGB:",b,".dst],",r,'["srcAlpha" in ',b,"?",b,".srcAlpha:",b,".src],",r,'["dstAlpha" in ',b,"?",b,".dstAlpha:",b,".dst]);");N(a,".pop();");break;case "blend.equation":a=v(a);r=u(K);J("if(typeof ",
b,'==="string"){',a,".push(",r,"[",b,"],",r,"[",b,"]);","}else{",a,".push(",r,"[",b,".rgb],",r,"[",b,".alpha]);","}");N(a,".pop();");break;case "blend.color":a=v(a);J(a,".push(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");N(a,".pop();");break;case "stencil.mask":a=v(a);J(a,".push(",b,");");N(a,".pop();");break;case "stencil.func":a=v(a);J(a,".push(",ia,"[",b,".cmp],",b,".ref|0,",'"mask" in ',b,"?",b,".mask:-1);");N(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=v(a);J(a,".push(",pa,"[",
b,'.fail||"keep"],',pa,"[",b,'.zfail||"keep"],',pa,"[",b,'.pass||"keep"]);');N(a,".pop();");break;case "polygonOffset.offset":a=v(a);J(a,".push(",b,".factor||0,",b,".units||0);");N(a,".pop();");break;case "cull.face":a=v(a);J(a,".push(",b,'==="front"?',1028,":",1029,");");N(a,".pop();");break;case "frontFace":a=v(a);J(a,".push(",b,'==="cw"?',2304,":",2305,");");N(a,".pop();");break;case "colorMask":a=v(a);J(a,".push(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");N(a,".pop();");break;case "sample.coverage":a=
v(a);J(a,".push(",b,".value,",b,".invert);");N(a,".pop();");break;case "scissor.box":case "viewport":a=v(a);J(a,".push(",b,".x||0,",b,".y||0,",'"w" in ',b,"?",b,".w:-1,",'"h" in ',b,"?",b,".h:-1);");N(a,".pop();");break;case "elements":a=!("primitive"in n)&&!("primitive"in c);var r=!("count"in n)&&!("count"in c),d=!("offset"in n)&&!("offset"in c),h=J.def();J("if(",b,"){",h,"=",b,"._elements;",Y,".push(",h,");",a?L.primitive+".push("+h+".primType);":"",r?L.count+".push("+h+".vertCount);":"",d?L.offset+
".push("+h+".offset);":"","}else{",Y,".push(null);","}");N(Y,".pop();","if(",b,"){",a?L.primitive+".pop();":"",r?L.count+".pop();":"",d?L.offset+".pop();":"","}")}});Object.keys(e).forEach(function(a){var b=u(p.def(a));a=y(e[a]);J(b,".push(",a,");");N(b,".pop();")});Object.keys(m).forEach(function(a){var b=u(B.def(a)),c=y(m[a]);a=u(B.box(a));J(b,".records.push(",a,".alloc(",c,"));");N(a,".free(",b,".records.pop());")});var ca=G("scope"),da=ca.arg(),sa=ca.arg();I&&ca(ga,"=",da,";");ca(w);I&&ca(J);
ca(sa,"(",da,",",R,");",I?N:"",H);ca=F();F=ca.def();c.frag&&c.vert?(da=c.frag,ca(F,"=",u(S.program(g.id(c.vert),g.id(da))),";")):ca(F,"=",Q,".program","(",Q,".vert[",Q,".vert.length-1]",",",Q,".frag[",Q,".frag.length-1]",");");da=G("draw");I&&da(ga,"=",da.arg(),";");da(w,ca);I&&da(J);da(r,"();","if(",F,")",F,".draw.call(this",I?","+ga:"",");",I?N:"",H);var oa=G("batch"),G=oa.arg(),da=oa.arg();I&&oa(ga,"=",da,"[0];");oa(w,ca);I=u(function(a,b,r){var d=a.batchCache[x];d||(d=a.batchCache[x]=ja(a,n,e,
m,c));return d.call(this,b,r)});oa("if(",F,"){",r,"();",I,".call(this,",F,",",G,",",da,");");Object.keys(n).forEach(function(a){(a=qa[a])&&oa(a,".setDirty();")});oa("}",H);return q.compile()}}}},{"./constants/primitives.json":7,"./util/codegen":22}],5:[function(e,g,p){g.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,
"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],6:[function(e,g,p){g.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],7:[function(e,g,p){g.exports={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],8:[function(e,g,p){g.exports=function(d){return{primitive:[4],count:[-1],offset:[0],instances:[0]}}},{}],9:[function(e,g,p){function d(a,d){this.id=b++;this.type=a;this.data=d}function m(a){if(0===
a.length)return[];var b=a.charAt(0),d=a.charAt(a.length-1);if(1<a.length&&b===d&&('"'===b||"'"===b))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return m(a.substr(0,b.index)).concat(m(b[1])).concat(m(a.substr(b.index+b[0].length)));b=a.split(".");if(1===b.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(d=0;d<b.length;++d)a=a.concat(m(b[d]));return a}function a(a){return"["+m(a).join("][")+
"]"}var b=0;g.exports={define:function(b,f){switch(typeof f){case "boolean":case "number":case "string":return new d(b,a(f+""));case "undefined":return new d(b|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof d},unbox:function(b,f){if(b instanceof d){if(b.type&128)return new d(b.type&-129,a(f))}else if("function"===typeof b)return new d(0,b);return b},accessor:a}},{}],10:[function(e,g,p){var d=e("./util/is-typed-array"),m=e("./util/is-ndarray"),a=e("./constants/primitives.json");
g.exports=function(b,e,f){function g(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}g.prototype.bind=function(){this.buffer.bind()};return{create:function(b){function D(b){var k=e.oes_element_index_uint;if(b)if("number"===typeof b)C(b);else{var c=null,h="static",f=0;Array.isArray(b)||d(b)||m(b)?c=b:("data"in b&&(c=b.data),"usage"in b&&(h=b.usage),"length"in b&&(f=b.length));Array.isArray(c)||m(c)&&"array"===c.dtype||"type"in b?C({type:b.type||(k?"uint32":"uint16"),usage:h,data:c,length:f}):
C({usage:h,data:c,length:f});if(Array.isArray(c)||d(c))C.dimension=3}else C();k=G.buffer.byteLength;c=0;switch(G.buffer.dtype){case 5121:case 5120:c=5121;break;case 5123:case 5122:c=5123;k>>=1;break;case 5125:case 5124:c=5125,k>>=2}h=4;f=G.buffer.dimension;1===f&&(h=0);2===f&&(h=1);3===f&&(h=4);"object"===typeof b&&("primitive"in b&&(h=a[b.primitive]),"count"in b&&(k=b.vertCount|0));G.primType=h;G.vertCount=k;G.type=c;return D}var G=new g,C=f.create(null,34963,!0);G.buffer=C._buffer;D(b);D._reglType=
"elements";D._elements=G;D.destroy=function(){C.destroy();G.buffer=null};return D},elements:[null],getElements:function(a){return a&&a._elements instanceof g?a._elements:null}}}},{"./constants/primitives.json":7,"./util/is-ndarray":24,"./util/is-typed-array":25}],11:[function(e,g,p){g.exports=function(d){function e(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(b){try{a[b]=
d.getExtension(b)}catch(e){}})}var a={};e();return{extensions:a,refresh:e}}},{}],12:[function(e,g,p){var d=e("./util/values"),m=e("./util/extend"),a=[1029];g.exports=function(b,e,f,g,k){function D(a,b,c,d){this.target=a;this.level=b;this.texture=c;this.renderbuffer=d}function G(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function C(a,b){var c=b.width,d=b.height;if(a.texture)var h=a.texture._texture,k=Math.max(1,h.params.width>>a.level),f=Math.max(1,
h.params.height>>a.level),c=c||k,d=d||f;else h=a.renderbuffer._renderbuffer,c=c||h.width,d=d||h.height;h.refCount+=1;b.width=c;b.height=d}function n(a,c){c?c.texture?b.framebufferTexture2D(36160,a,c.target,c.texture._texture.texture,c.level):b.framebufferRenderbuffer(36160,a,36161,c.renderbuffer._renderbuffer.renderbuffer):b.framebufferTexture2D(36160,a,3553,null,0)}function A(a){var b=3553,c=0,d=null,h=null;"object"===typeof a&&("level"in a&&(c=a.level|0),"target"in a&&(b=a.target|0));var k=a._reglType;
"texture"===k?d=a:"renderbuffer"===k&&(h=a,b=36161,c=0);return new D(b,c,d,h)}function c(a){return a&&(a.texture||a.renderbuffer)}function h(){this.id=V++;ja[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function I(a){b.isFramebuffer(a.framebuffer)||(a.framebuffer=b.createFramebuffer());K=!0;b.bindFramebuffer(36160,a.framebuffer);for(var c=a.colorAttachments,
d=0;d<c.length;++d)n(36064+d,c[d]);for(d=c.length;d<f.maxColorAttachments;++d)n(36064+d,null);n(36096,a.depthAttachment);n(36128,a.stencilAttachment);n(33306,a.depthStencilAttachment);e.webgl_draw_buffers&&e.webgl_draw_buffers.drawBuffersWEBGL(la[c.length]);b.checkFramebufferStatus(36160)}function O(a){a=a.framebuffer;b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function E(){return Z[Z.length-1]}var p={rgba:6408},B={rgba4:32854,rgb565:36194,"rgb5 a1":32855};e.ext_srgb&&(B.srgba=35907);e.ext_color_buffer_half_float&&
(B.rgba16f=34842,B.rgb16f=34843);e.webgl_color_buffer_float&&(B.rgba32f=34836);var S=[],U=[];e.webgl_depth_texture&&(S.push(6402),U.push(34041));m(m({},p),B);d(p);d(B);B=5121;S={uint8:5121};e.oes_texture_half_float&&(B=S["half float"]=36193);e.oes_texture_float&&(B=S["float"]=5126);S.best=B;var la=function(){for(var a=Array(f.maxDrawbuffers),b=0;b<=f.maxDrawbuffers;++b)for(var c=a[b]=Array(b),d=0;d<b;++d)c[d]=36064+d;return a}(),V=0,ja={},Z=[null],K=!0;return{top:E,dirty:function(){return K},push:function(a){a=
a||null;K=K||a!==E();Z.push(a);return K},pop:function(){var a=E();Z.pop();return K=K||a!==E()},getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof h)?a:null},poll:function(){if(K){var c=Z[Z.length-1],d=e.webgl_draw_buffers;c?(b.bindFramebuffer(36160,c.framebuffer),d&&d.drawBuffersWEBGL(la[c.colorAttachments.length])):(b.bindFramebuffer(36160,null),d&&d.drawBuffersWEBGL(a));K=!1}},create:function(a){function d(a){var h,e=a||{},n=a=0;if("shape"in
e){var m=e.shape;a=m[0];n=m[1]}else"radius"in e&&(a=n=e.radius),"width"in e&&(a=e.width),"height"in e&&(n=e.height);var l=null,m=!1;if("colorBuffers"in e||"colorBuffer"in e){l=e.colorBuffers||e.colorBuffer;Array.isArray(l)||(l=[l]);f.width=a;f.height=n;l=l.map(A);for(h=0;h<l.length;++h)C(l[h],f);a=f.width;n=f.height}else{var v=!0,M="rgba",y="uint8",q=1,m=!0;f.width=a=a||b.drawingBufferWidth;f.height=n=n||b.drawingBufferHeight;"format"in e&&(M=e.format,v=M in p);"type"in e&&(y=e.type);"colorCount"in
e&&(q=e.colorCount|0);if(f.ownsColor)for(l=f.colorAttachments;l.length>q;)G(l.pop());else l=[];for(h=0;h<l.length;++h){var u;a:{u=l[h];var O=v,E=M,x=a,r=n;if(u.texture){var Q=u.texture;if(O){Q({format:E,type:y,width:x,height:r});Q._texture.refCount+=1;u=!0;break a}}else if(Q=u.renderbuffer,!O){Q({format:E,width:x,height:r});Q._renderbuffer.refCount+=1;u=!0;break a}G(u);u=!1}u||(l[h--]=l[l.length-1],l.pop())}for(;l.length<q;)v?l.push(new D(3553,0,g.create({format:M,type:y,width:a,height:n},3553),null)):
l.push(new D(36161,0,null,k.create({format:M,width:a,height:n})))}f.width=a;f.height=n;M=v=h=null;y=!1;"depthBuffer"in e&&(h=A(e.depthBuffer));"stencilBuffer"in e&&(v=A(e.stencilBuffer));"depthStencilBuffer"in e&&(M=A(e.depthStencilBuffer));if(h||v||M)C(h||v||M,f);else if(q=!0,O=u=!1,"depth"in e&&(q=!!e.depth),"stencil"in e&&(u=!!e.stencil),"depthTexture"in e&&(O=!!e.depthTexture),e=f.depthAttachment||f.stencilAttachment||f.depthStencilAttachment,E=null,q||u)y=!0,O?(O=u?"depth stencil":"depth",f.ownsDepthStencil&&
e.texture?(e.texture({format:O,width:a,height:n}),e.texture._texture.refCount+=1,E=e):E=new D(3553,0,g.create({format:O,width:a,height:n},3553),null)):(O=q?u?"depth stencil":"depth":"stencil",f.ownsDepthStencil&&e.renderbuffer?(e.renderbuffer({format:O,width:a,height:n}),e.renderbuffer._renderbuffer.refCount+=1,E=e):E=new D(36161,0,null,k.create({format:O,width:a,height:n}))),q?u?M=E:h=E:v=E;a=f;a.colorAttachments.forEach(G);G(a.depthAttachment);G(a.stencilAttachment);G(a.depthStencilAttachment);
f.colorAttachments=l;f.depthAttachment=h;f.stencilAttachment=v;f.depthStencilAttachment=M;f.ownsColor=m;f.ownsDepthStencil=y;d.color=l.map(c);d.depth=c(h);d.stencil=c(v);d.depthStencil=c(M);I(f);d.width=f.width;d.height=f.height;return d}var f=new h;d(a);d._reglType="framebuffer";d._framebuffer=f;d._destroy=function(){O(f)};return d},clear:function(){d(ja).forEach(O)},refresh:function(){d(ja).forEach(I)}}}},{"./util/extend":23,"./util/values":31}],13:[function(e,g,p){g.exports=function(d,e){var a=
1;e.ext_texture_filter_anisotropic&&(a=d.getParameter(34047));var b=1,g=1;e.webgl_draw_buffers&&(b=d.getParameter(34852),g=d.getParameter(36063));return{colorBits:[d.getParameter(3410),d.getParameter(3411),d.getParameter(3412),d.getParameter(3413)],depthBits:d.getParameter(3414),stencilBits:d.getParameter(3415),subpixelBits:d.getParameter(3408),extensions:Object.keys(e).filter(function(a){return!!e[a]}),maxAnisotropic:a,maxDrawbuffers:b,maxColorAttachments:g,pointSizeDims:d.getParameter(33901),lineWidthDims:d.getParameter(33902),
maxViewportDims:d.getParameter(3386),maxCombinedTextureUnits:d.getParameter(35661),maxCubeMapSize:d.getParameter(34076),maxRenderbufferSize:d.getParameter(34024),maxTextureUnits:d.getParameter(34930),maxTextureSize:d.getParameter(3379),maxAttributes:d.getParameter(34921),maxVertexUniforms:d.getParameter(36347),maxVertexTextureUnits:d.getParameter(35660),maxVaryingVectors:d.getParameter(36348),maxFragmentUniforms:d.getParameter(36349),glsl:d.getParameter(35724),renderer:d.getParameter(7937),vendor:d.getParameter(7936),
version:d.getParameter(7938)}}},{}],14:[function(e,g,p){var d=e("./util/is-typed-array");g.exports=function(e,a,b){return function(g){var f=g||{};d(g)?f={data:f}:2===arguments.length?f={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof g&&(f={});a();var z=f.x||0,k=f.y||0,D=f.width||b.width,p=f.height||b.height,f=f.data||new Uint8Array(D*p*4);e.pixelStorei(3333,4);e.readPixels(z,k,D,p,6408,5121,f);return f}}},{"./util/is-typed-array":25}],15:[function(e,g,p){var d=e("./util/values");g.exports=
function(e,a,b){function g(){this.id=D++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function f(a){e.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=e.createRenderbuffer());e.bindRenderbuffer(36161,a.renderbuffer);e.renderbufferStorage(36161,a.format,a.width,a.height)}function z(a){var b=a.renderbuffer;e.bindRenderbuffer(36161,null);e.isRenderbuffer(b)&&e.deleteRenderbuffer(b);a.renderbuffer=null;a.refCount=0;delete p[a.id]}var k={rgba4:32854,rgb565:36194,"rgb5 a1":32855,
depth:33189,stencil:36168,"depth stencil":34041};a.ext_srgb&&(k.srgba=35907);a.ext_color_buffer_half_float&&(k.rgba16f=34842,k.rgb16f=34843);a.webgl_color_buffer_float&&(k.rgba32f=34836);var D=0,p={};g.prototype.decRef=function(){0===--this.refCount&&z(this)};return{create:function(a){function b(a){a=a||{};var e=0,g=0;"shape"in a?(g=a.shape,e=g[0]|0,g=g[1]|0):("radius"in a&&(e=g=a.radius|0),"width"in a&&(e=a.width|0),"height"in a&&(g=a.height|0));b.width=d.width=Math.max(e,1);b.height=d.height=Math.max(g,
1);d.format=32854;"format"in a&&(d.format=k[a.format]);f(d);return b}var d=new g;p[d.id]=d;b(a);b._reglType="renderbuffer";b._renderbuffer=d;b.destroy=function(){d.decRef()};return b},refresh:function(){d(p).forEach(f)},clear:function(){d(p).forEach(z)}}}},{"./util/values":31}],16:[function(e,g,p){function d(a,b,d,e){this.name=a;this.id=b;this.location=d;this.info=e}var m=e("./util/values");g.exports=function(a,b,e,f,g){function k(b,c){var d=35632===b?C:n,e=d[c];if(!e){var f=g.str(c),e=a.createShader(b);
a.shaderSource(e,f);a.compileShader(e);d[c]=e}return e}function D(a,b){this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];this.draw=function(){};this.batchCache={}}function p(c){var n,m;n=k(35632,c.fragId);m=k(35633,c.vertId);var A=c.program=a.createProgram();a.attachShader(A,n);a.attachShader(A,m);a.linkProgram(A);var D=a.getProgramParameter(A,35718),B=c.uniforms=[];for(n=0;n<D;++n)if(m=a.getActiveUniform(A,n))if(1<m.size)for(var C=0;C<m.size;++C){var G=m.name.replace("[0]",
"["+C+"]");e.def(G);B.push(new d(G,g.id(G),a.getUniformLocation(A,G),m))}else e.def(m.name),B.push(new d(m.name,g.id(m.name),a.getUniformLocation(A,m.name),m));D=a.getProgramParameter(A,35721);B=c.attributes=[];for(n=0;n<D;++n)if(m=a.getActiveAttrib(A,n))b.def(m.name),B.push(new d(m.name,g.id(m.name),a.getAttribLocation(A,m.name),m));c.draw=f(c);c.batchCache={}}var C={},n={},A={},c=[];return{clear:function(){var b=a.deleteShader.bind(a);m(C).forEach(b);C={};m(n).forEach(b);n={};c.forEach(function(b){a.deleteProgram(b.program)});
c.length=0;A={}},refresh:function(){C={};n={};c.forEach(p)},program:function(a,b){var d=A[b];d||(d=A[b]={});var e=d[a];e||(e=new D(b,a),p(e),d[a]=e,c.push(e));return e},shader:k,frag:[-1],vert:[-1]}}},{"./util/values":31}],17:[function(e,g,p){var d=e("./util/stack"),m=e("./util/codegen");g.exports=function(a,b,e){function f(b,e){var c=d([!!e],function(c){c?a.enable(b):a.disable(b)});c.flag=b;return c}var g={dither:f(3024),"blend.enable":f(3042),"blend.color":d([0,0,0,0],function(b,d,c,e){a.blendColor(b,
d,c,e)}),"blend.equation":d([32774,32774],function(b,d){a.blendEquationSeparate(b,d)}),"blend.func":d([1,0,1,0],function(b,d,c,e){a.blendFuncSeparate(b,d,c,e)}),"depth.enable":f(2929,!0),"depth.func":d([513],function(b){a.depthFunc(b)}),"depth.range":d([0,1],function(b,d){a.depthRange(b,d)}),"depth.mask":d([!0],function(b){a.depthMask(b)}),"cull.enable":f(2884),"cull.face":d([1029],function(b){a.cullFace(b)}),frontFace:d([2305],function(b){a.frontFace(b)}),colorMask:d([!0,!0,!0,!0],function(b,d,c,
e){a.colorMask(b,d,c,e)}),lineWidth:d([1],function(b){a.lineWidth(b)}),"polygonOffset.enable":f(32823),"polygonOffset.offset":d([0,0],function(b,d){a.polygonOffset(b,d)}),"sample.alpha":f(32926),"sample.enable":f(32928),"sample.coverage":d([1,!1],function(b,d){a.sampleCoverage(b,d)}),"stencil.enable":f(2960),"stencil.mask":d([-1],function(b){a.stencilMask(b)}),"stencil.func":d([519,0,-1],function(b,d,c){a.stencilFunc(b,d,c)}),"stencil.opFront":d([7680,7680,7680],function(b,d,c){a.stencilOpSeparate(1028,
b,d,c)}),"stencil.opBack":d([7680,7680,7680],function(b,d,c){a.stencilOpSeparate(1029,b,d,c)}),"scissor.enable":f(3089),"scissor.box":d([0,0,-1,-1],function(d,e,c,f){var k=c,g=b.top();0>c&&(k=g?g.width-d:a.drawingBufferWidth-d);c=f;0>f&&(c=g?g.height-e:a.drawingBufferHeight-e);a.scissor(d,e,k,c)}),viewport:d([0,0,-1,-1],function(d,f,c,k){var g=c,m=b.top();0>c&&(g=m?m.width-d:a.drawingBufferWidth-d);c=k;0>k&&(c=m?m.height-f:a.drawingBufferHeight-f);a.viewport(d,f,g,c);e.width=g;e.height=c})},k=m(),
D=k.proc("poll"),p=k.proc("refresh");Object.keys(g).forEach(function(a){a=k.link(g[a]);D(a,".poll();");p(a,".setDirty();")});var C=k.compile();return{contextState:g,viewport:e,poll:C.poll,refresh:C.refresh,notifyViewportChanged:function(){g.viewport.setDirty();g["scissor.box"].setDirty()}}}},{"./util/codegen":22,"./util/stack":29}],18:[function(e,g,p){g.exports=function(){var d={"":0},e=[""];return{id:function(a){var b=d[a];if(b)return b;b=d[a]=e.length;e.push(a);return b},str:function(a){return e[a]}}}},
{}],19:[function(e,g,p){function d(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function m(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var d=a[0].length,e=1;e<b;++e)if(!Array.isArray(a[e])||a[e].length!==d)return!1;return!0}function a(a){return Object.prototype.toString.call(a)}function b(b){return"[object HTMLCanvasElement]"===a(b)}function M(b){return"[object CanvasRenderingContext2D]"===a(b)}var f=e("./util/extend"),z=e("./util/values"),
k=e("./util/is-typed-array"),D=e("./util/is-ndarray"),G=e("./util/load-texture"),C=e("./util/to-half-float"),n=e("./util/parse-dds"),A=[9984,9986,9985,9987];g.exports=function(c,e,g,p,E){function ka(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=this.miplevel=0;this.copy=!1;this.crossOrigin=
this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function B(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function S(a,b){var c,d,e=0,f=0,k=0,g=0,h=0,m=0,w=!1,n=!1,l=!1;for(c=0;c<b.length;++c)d=b[c],g=g||d.width<<d.miplevel,h=h||d.height<<d.miplevel,e=e||d.type,f=f||d.format,k=k||d.internalformat,
m=m||d.channels,w=w||d.needsPoll,n=n||d.needsListeners,d=d.miplevel,l=l||0<d;a.needsPoll=w;a.needsListeners=n;a.width=g;a.height=h;a.format=f;a.internalformat=k;a.type=e;if(3553!==a.target)for(c=0;6>c;++c);c=0<=A.indexOf(a.minFilter);a.genMipmaps=!l&&(a.genMipmaps||c);l=l||a.genMipmaps;a.minFilter||(a.minFilter=l?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(c=0;c<b.length;++c)d=b[c],d.channels||(d.channels=m),d.format||(d.format=f),d.internalformat||(d.internalformat=k),d.type||(d.type=
e)}function U(a){this.id=q++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new B(a);this.pixels=[]}function la(a,b){function c(a,d){var e=d.mipmap,r;if(Array.isArray(e))for(var k=0;k<e.length;++k)r=new ka(a),r.parseFlags(b),r.parseFlags(d),r.parse(e[k],k),f.push(r);else r=new ka(a),r.parseFlags(b),r.parse(d,0),f.push(r)}var d;Z(a);var e=a.params;B.call(e,a.target);var f=a.pixels;f.length=0;e.parse(b);if(3553===a.target)c(3553,
b);else{var k=b.faces||b;if(Array.isArray(k))for(d=0;6>d;++d)c(34069+d,k[d]);else if("string"!==typeof k)for(d=0;6>d;++d)c(34069+d,{})}S(e,f);e.needsListeners&&ja(a);e.needsPoll&&(a.pollId=F.length,F.push(a));V(a)}function V(a){c.isTexture(a.texture)||(a.texture=c.createTexture());var b=a.target,d=a.unit;0<=d?(c.activeTexture(33984+d),y=d):c.bindTexture(b,a.texture);for(var b=a.pixels,e=a.params,f=0;f<b.length;++f)b[f].upload(e);e.upload();0>d&&((d=x[y])?c.bindTexture(d.target,d.texture):(a.unit=
y,x[y]=a))}function ja(a){function b(a,c,d){var r=n(d);r.pixels.forEach(function(b){var d=new ka(r.cube?b.target:a);d.channels=r.channels;d.compressed=r.compressed;d.type=r.type;d.internalformat=r.format;d.format=ra[r.format];d.width=b.width;d.height=b.height;d.miplevel=b.miplevel||c;d.data=b.data;e.push(d)})}function c(){for(var f=0;f<e.length;++f){var k=e[f],g=k.image,h=k.video,m=k.xhr;g&&g.complete?(k.width=g.naturalWidth,k.height=g.naturalHeight):h&&2<h.readyState?(k.width=h.width,k.height=h.height):
m&&4===m.readyState&&(e[f]=e[e.length-1],e.pop(),m.removeEventListener("readystatechange",V),b(k.target,k.miplevel,m.response))}S(d,e);V(a)}var d=a.params,e=a.pixels;e.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){e.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",
c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function Z(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((F[b]=F[F.length-1]).id=b,F.pop(),a.pollId=-1)}function K(a){var b=a.texture,d=a.unit,e=a.target;0<=d&&(c.activeTexture(33984+d),y=d,c.bindTexture(e,null),x[d]=null);Z(a);c.isTexture(b)&&c.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete u[a.id]}var l={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
P={repeat:10497,clamp:33071,mirror:33648},ma={nearest:9728,linear:9729},T=f({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ma),aa={none:0,browser:37444},W={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},X={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ea={};e.ext_srgb&&(X.srgb=35904,X.srgba=35906);e.oes_texture_float&&(W["float"]=5126);e.oes_texture_half_float&&
(W["half float"]=36193);e.webgl_depth_texture&&(f(X,{depth:6402,"depth stencil":34041}),f(W,{uint16:5123,uint32:5125,"depth stencil":34042}));e.webgl_compressed_texture_s3tc&&f(ea,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});e.webgl_compressed_texture_atc&&f(ea,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});e.webgl_compressed_texture_pvrtc&&f(ea,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});e.webgl_compressed_texture_etc1&&(ea["rgb etc1"]=36196);var ha=Array.prototype.slice.call(c.getParameter(34467));Object.keys(ea).forEach(function(a){var b=ea[a];0<=ha.indexOf(b)&&(X[a]=b)});var v=Object.keys(X);g.textureFormats=v;var ra=v.reduce(function(a,b){var c=X[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});f(ka.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=aa[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=X[b];b in W&&(this.type=W[b]);b in ea&&(this.compressed=!0)}"type"in a&&(this.type=W[a.type]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),
"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(c,e){this.miplevel=e;this.width>>=e;this.height>>=e;var f=c;switch(typeof c){case "object":if(!c)return;
this.parseFlags(c);var g=c.data;if("string"===typeof g||g&&(k(g)||d(g)||D(g)||b(g)||M(g)||"[object HTMLImageElement]"===a(g)||"[object HTMLVideoElement]"===a(g)||m(g)))f=c.data;break;case "undefined":return}"string"===typeof f&&(f=G(f,this.crossOrigin));var g=null,h=!1;if(null!==f)if(k(f))this.data=f;else if(d(f))g=f,h=!0;else if(D(f)){Array.isArray(f.data)?(g=f.data,h=!0):this.data=f.data;var l=f.shape;this.width=l[0];this.height=l[1];this.channels=3===l.length?l[2]:1;l=f.stride;this.strideX=f.stride[0];
this.strideY=f.stride[1];this.strideC=3===l.length?f.stride[2]:1;this.offset=f.offset;this.needsTranspose=!0}else if(b(f)||M(f))b(f)?this.canvas=f:this.canvas=f.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===a(f))this.image=f,f.complete?(this.width=f.naturalWidth,this.height=f.naturalHeight):(this.width=this.width||f.naturalWidth,this.height=this.height||f.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===a(f))this.video=f,1<f.readyState?(this.width=f.width,this.height=f.height):(this.width=this.width||f.width,this.height=this.height||f.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===a(f))this.xhr=f,this.needsListeners=!0;else if(m(f)){var h=f[0].length,l=f.length,n=1,q,z,u,w;if(Array.isArray(f[0][0]))for(n=f[0][0].length,g=Array(h*l*n),z=w=0;z<l;++z)for(q=0;q<h;++q)for(u=0;u<n;++u)g[w++]=f[z][q][u];
else for(g=Array(h*l),z=w=0;z<l;++z)for(q=0;q<h;++q)g[w++]=f[z][q];this.width=h;this.height=l;this.channels=n;h=!0}else c.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||E.width)|0,this.height=(this.height||E.height)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=[6409,
6410,6407,6408][(this.channels=this.channels||4)-1]);f=this.internalformat;l=this.format=ra[f];if(!this.channels)switch(l){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}l=this.type;5126!==l&&36193!==l&&(l||(l=6402===f?5125:5121));this.type=l;if(h)switch(l){case 5121:this.data=new Uint8Array(g);break;case 5123:this.data=new Uint16Array(g);break;case 5125:this.data=new Uint32Array(g);break;case 5126:this.data=
new Float32Array(g);break;case 36193:this.data=C(g)}if(this.data&&this.needsTranspose){g=this.data;f=this.width;h=this.height;l=this.channels;n=this.strideX;q=this.strideY;z=this.strideC;u=this.offset;w=new g.constructor(f*h*l);for(var v=0,p=0;p<h;++p)for(var y=0;y<f;++y)for(var x=0;x<l;++x)w[v++]=g[q*p+n*y+z*x+u];this.data=w}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){c.pixelStorei(37440,
this.flipY);c.pixelStorei(37441,this.premultiplyAlpha);c.pixelStorei(37443,this.colorSpace);c.pixelStorei(3317,this.unpackAlignment);var b=this.target,d=this.miplevel,e=this.image,f=this.canvas,g=this.video,k=this.data,h=this.internalformat,m=this.format,l=this.type,n=this.width||Math.max(1,a.width>>d);a=this.height||Math.max(1,a.height>>d);g&&2<g.readyState?c.texImage2D(b,d,m,m,l,g):e&&e.complete?c.texImage2D(b,d,m,m,l,e):f?c.texImage2D(b,d,m,m,l,f):this.compressed?c.compressedTexImage2D(b,d,h,n,
a,0,k):this.copy?(p(),c.copyTexImage2D(b,d,m,this.x,this.y,n,a,0)):k?c.texImage2D(b,d,m,n,a,0,m,l,k):c.texImage2D(b,d,m,n||1,a||1,0,m,l,null)}});f(B.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=T[a.min]);"mag"in a&&(this.magFilter=ma[a.mag]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var d=a.wrap;"string"===typeof d?b=c=P[d]:Array.isArray(d)&&(b=P[d[0]],c=P[d[1]])}else"wrapS"in a&&(b=P[a.wrapS]),"wrapT"in a&&(c=P[a.wrapT]);this.wrapS=b;this.wrapT=c;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=l[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;c.texParameteri(a,10241,this.minFilter);c.texParameteri(a,10240,this.magFilter);c.texParameteri(a,10242,this.wrapS);c.texParameteri(a,10243,this.wrapT);e.ext_texture_filter_anisotropic&&c.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(c.hint(33170,this.mipmapHint),c.generateMipmap(a))}});
var y=0,q=0,u={},F=[],fa=g.maxTextureUnits,x=Array(fa).map(function(){return null});f(U.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<fa;++b){var d=x[b];if(d){if(0<d.bindCount)continue;d.unit=-1}x[b]=this;a=b;break}this.unit=a;c.activeTexture(33984+a);c.bindTexture(this.target,this.texture);y=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&K(this)}});return{create:function(a,b){function c(a,e,f,g,k,h){var m=a||{};34067===
b&&6===arguments.length&&(m=[a,e,f,g,k,h]);la(d,m);c.width=d.params.width;c.height=d.params.height;return c}var d=new U(b);u[d.id]=d;c(a);c._reglType="texture";c._texture=d;c.destroy=function(){d.decRef()};return c},refresh:function(){z(u).forEach(V);for(var a=0;a<fa;++a)x[a]=null;y=0;c.activeTexture(33984)},clear:function(){for(var a=0;a<fa;++a)c.activeTexture(33984+a),c.bindTexture(3553,null),x[a]=null;c.activeTexture(33984);y=0;z(u).forEach(K)},poll:function(){F.forEach(V)},getTexture:function(a){return null}}}},
{"./util/extend":23,"./util/is-ndarray":24,"./util/is-typed-array":25,"./util/load-texture":26,"./util/parse-dds":27,"./util/to-half-float":30,"./util/values":31}],20:[function(e,g,p){g.exports=function(d){var e={};return{def:function(a){a=d.id(a);var b=e[a];b||(b=e[a]=[]);return b},uniforms:e}}},{}],21:[function(e,g,p){g.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(e,g,p){var d=e("./extend");g.exports=
function(){function e(){var b=[],f=[];return d(function(){b.push.apply(b,Array.prototype.slice.call(arguments))},{def:function(){var d="v"+a++;f.push(d);0<arguments.length&&(b.push(d,"="),b.push.apply(b,Array.prototype.slice.call(arguments)),b.push(";"));return d},toString:function(){return[0<f.length?"var "+f+";":"",b.join("")].join("")}})}var a=0,b=[],g=[],f={};return{link:function(d){var e="g"+a++;b.push(e);g.push(d);return e},block:e,proc:function(b){var g=[],p=e(),M=p.toString;return f[b]=d(p,
{arg:function(){var b="a"+a++;g.push(b);return b},toString:function(){return["function(",g.join(),"){",M(),"}"].join("")}})},compile:function(){var a=['"use strict";return {'];Object.keys(f).forEach(function(b){a.push('"',b,'":',f[b].toString(),",")});a.push("}");return Function.apply(null,b.concat([a.join("")])).apply(null,g)}}}},{"./extend":23}],23:[function(e,g,p){g.exports=function(d,e){for(var a=Object.keys(e),b=0;b<a.length;++b)d[a[b]]=e[a[b]];return d}},{}],24:[function(e,g,p){var d=e("./is-typed-array");
g.exports=function(e){return!!e&&"object"===typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"===typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||d(e.data))}},{"./is-typed-array":25}],25:[function(e,g,p){var d=e("../constants/arraytypes.json");g.exports=function(e){return Object.prototype.toString.call(e)in d}},{"../constants/arraytypes.json":5}],26:[function(e,g,p){g.exports=function(d,e){if("undefined"!==typeof document){var a;a=(a=/\.(\w+)(\?.*)?$/.exec(d))&&
a[1]?a[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(a))return a=document.createElement("video"),a.autoplay=!0,a.loop=!0,e&&(a.crossOrigin=e),a.src=d,a;if(0<=["dds"].indexOf(a))return a=new XMLHttpRequest,a.responseType="arraybuffer",a.open("GET",d,!0),a.send(),a;a=new Image;e&&(a.crossOrigin=e);a.src=d;return a}return null}},{}],27:[function(e,g,p){g.exports=function(e){function g(a){for(var b=l,c=P,d=0;d<X;++d){var f=Math.max(1,
b+3>>2)*Math.max(1,c+3>>2)*aa;ha.pixels.push({target:a,miplevel:d,width:b,height:c,data:new Uint8Array(e,ea,f)});ea+=f;b>>=1;c>>=1}}var p=new Int32Array(e),K=p[O],l=p[ka],P=p[E],ma=k,T=0,aa=0,W=4;switch(p[U]){case n:aa=8;K&C?(W=3,T=a):T=b;break;case A:aa=16;T=M;break;case c:aa=16;T=f;break;case h:aa=8,T=z}var X=1;p[S]&D&&(X=Math.max(1,p[B]));var ea=p[I]+4,ha={width:l,height:P,channels:W,format:T,type:ma,compressed:!0,cube:!1,pixels:[]};if(p[la]&G)for(ha.cube=!0,p=0;6>p;++p)g(m+p);else g(d);return ha};
var d=3553,m=34069,a=33776,b=33777,M=33778,f=33779,z=36196,k=5121,D=131072,G=512,C=64,n=827611204,A=861165636,c=894720068,h=826496069,I=1,O=2,E=3,ka=4,B=7,S=20,U=21,la=28},{}],28:[function(e,g,p){g.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(d){return requestAnimationFrame(d)},cancel:function(d){return cancelAnimationFrame(d)}}:{next:function(d){setTimeout(d,30)},cancel:clearTimeout}},{}],29:[function(e,g,p){g.exports=function(d,e){var a=
d.length,b=d.slice(),g=d.slice(),f=!1,p=!0;return{push:function(){f=!1;for(var d=0;d<a;++d){var e=arguments[d];f=f||e!==g[d];b.push(e)}},pop:function(){f=!1;b.length-=a;for(var d=0;d<a;++d)f=f||b[b.length-a+d]!==g[d]},poll:function(){var d=b.length-a;if(f||p){switch(a){case 1:e(b[d]);break;case 2:e(b[d],b[d+1]);break;case 3:e(b[d],b[d+1],b[d+2]);break;case 4:e(b[d],b[d+1],b[d+2],b[d+3]);break;case 5:e(b[d],b[d+1],b[d+2],b[d+3],b[d+4]);break;case 6:e(b[d],b[d+1],b[d+2],b[d+3],b[d+4],b[d+5]);break;
default:e.apply(null,b.slice(d,b.length))}for(var D=0;D<a;++D)g[D]=b[d+D];p=f=!1}},setDirty:function(){p=!0}}}},{}],30:[function(e,g,p){g.exports=function(d){for(var e=new Float32Array(d),e=new Uint32Array(e.buffer),a=new Uint16Array(d.length),b=0;b<d.length;++b)if(isNaN(d[b]))a[b]=65535;else if(Infinity===d[b])a[b]=31744;else if(-Infinity===d[b])a[b]=64512;else{var g=e[b],f=g>>>31<<15,p=(g<<1>>>24)-127,g=g>>13&1023;a[b]=-24>p?f:-14>p?f+(g+1024>>-14-p):15<p?f+31744:f+(p+15<<10)+g}return a}},{}],31:[function(e,
g,p){g.exports=function(d){return Object.keys(d).map(function(e){return d[e]})}},{}],32:[function(e,g,p){function d(b,d){function e(){var d=window.innerWidth,f=window.innerHeight;b!==document.body&&(f=b.getBoundingClientRect(),d=f.right-f.left,f=f.top-f.bottom);g.width=p*d;g.height=p*f;a(g.style,{width:d+"px",height:f+"px"})}var g=document.createElement("canvas"),k=m(g,d);a(g.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(g);b===document.body&&(g.style.position="absolute",a(b.style,
{margin:0,padding:0}));var p=+k.options.pixelRatio;window.addEventListener("resize",e,!1);var G=k.options.onDestroy;k.options=a(a({},k.options),{onDestroy:function(){window.removeEventListener("resize",e);b.removeChild(g);G&&G()}});e();return k}function m(b,d){function e(a){try{return b.getContext(a,g)}catch(d){return null}}var g=d.glOptions||{};return{gl:e("webgl")||e("experimental-webgl")||e("webgl-experimental"),options:a({pixelRatio:window.devicePixelRatio},d)}}var a=e("./util/extend");g.exports=
function(b){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:b[0],options:b[1]||{}};var e=document.body,f=b[1]||{};if("string"===typeof b[0])e=document.querySelector(b[0])||document.body;else if("object"===typeof b[0])if(b[0]instanceof HTMLElement)e=b[0];else{if(b[0]instanceof WebGLRenderingContext)return{gl:b[0],options:a({pixelRatio:1},f)};f=b[0]}return e.nodeName&&"CANVAS"===e.nodeName.toUpperCase()?m(e,f):d(e,f)}},{"./util/extend":23}],33:[function(e,g,p){var d=e("./lib/util/extend"),
m=e("./lib/webgl"),a=e("./lib/strings"),b=e("./lib/extension"),M=e("./lib/limits"),f=e("./lib/buffer"),z=e("./lib/elements"),k=e("./lib/texture"),D=e("./lib/renderbuffer"),G=e("./lib/framebuffer"),C=e("./lib/uniform"),n=e("./lib/attribute"),A=e("./lib/shader"),c=e("./lib/draw"),h=e("./lib/state"),I=e("./lib/compile"),O=e("./lib/read"),E=e("./lib/dynamic"),ka=e("./lib/util/raf"),B=e("./lib/util/clock");g.exports=function(){function e(){ba=ka.next(e);x.count+=1;r.count=x.count;if(x.width!==l.drawingBufferWidth||
x.height!==l.drawingBufferHeight)r.viewportWidth=r.drawingBufferWidth=x.width=l.drawingBufferWidth,r.viewportHeight=r.drawingBufferHeight=x.height=l.drawingBufferHeight,Q.notifyViewportChanged();var a=B();x.dt=a-x.t;x.t=a;r.deltaTime=x.dt/1E3;r.time=(a-fa)/1E3;q.poll();for(var b=0;b<Y.length;++b)(0,Y[b])(null,r);x.renderTime=B()-a}function g(){ba&&(ka.cancel(e),ba=0)}function p(a){g();a.preventDefault();if(P.onContextLost)P.onContextLost()}function V(a){l.getError();ma.refresh();X.refresh();q.refresh();
u.refresh();F.refresh();ra.refresh();Q.refresh();if(P.onContextRestored)P.onContextRestored();e()}function ja(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var f=a[b];E.isDynamic(f)?(e=!0,d[b]=E.unbox(f,b)):c[b]=f});return{dynamic:d,"static":c}}function c(a){for(;n.length<a;)n.push(null);return n}var e=!1,f=b(a.context||{}),g=b(a.uniforms||{}),h=b(a.attributes||{});a=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}
var c=d({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var f=na.command(a["static"],g["static"],h["static"],a.dynamic,g.dynamic,h.dynamic,f,e),k=f.draw,l=f.batch,m=f.scope,n=[];return function(a,b){return"function"===typeof a?m.call(this,null,a):"function"===typeof b?m.call(this,a,b):"number"===typeof a?l.call(this,a|0,c(a|0)):Array.isArray(a)?l.call(this,a.length,a):k.call(this,a)}}
function Z(){F.poll();Q.poll()}var K=m(Array.prototype.slice.call(arguments)),l=K.gl,P=K.options,K=a(),ma=b(l),T=ma.extensions,aa={width:l.drawingBufferWidth,height:l.drawingBufferHeight},W=M(l,T),X=f(l,function(a){for(var b=0;b<v.bindings.length;++b){var c=v.bindings[b];c.pointer&&c.buffer===a&&(c.pointer=!1,c.buffer=null,c.x=c.y=c.z=c.w=NaN,l.disableVertexAttribArray(b))}}),ea=z(l,T,X),ha=C(K),v=n(l,T,W,X,K),ra=A(l,v,ha,function(a){return na.draw(a)},K),y=c(l,T,X),q=k(l,T,W,Z,aa),u=D(l,T,W),F=G(l,
T,W,q,u),fa=B(),x={count:0,start:fa,dt:0,t:fa,renderTime:0,width:l.drawingBufferWidth,height:l.drawingBufferHeight,pixelRatio:P.pixelRatio},r={count:0,batchId:0,deltaTime:0,time:0,viewportWidth:x.width,viewportHeight:x.height,drawingBufferWidth:x.width,drawingBufferHeight:x.height,pixelRatio:x.pixelRatio},Q=h(l,F,aa),aa=O(l,Z,aa),na=I(l,K,T,W,X,ea,q,F,Q,ha,v,ra,y,r,Z),L=l.canvas,Y=[],ba=0;L&&(L.addEventListener("webglcontextlost",p,!1),L.addEventListener("webglcontextrestored",V,!1));return d(ja,
{clear:function(a){var b=0;Z();var c=a.color;c&&(l.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(l.clearDepth(+a.depth),b|=256);"stencil"in a&&(l.clearStencil(a.stencil|0),b|=1024);l.clear(b)},prop:E.define.bind(null,1),context:E.define.bind(null,2),"this":E.define.bind(null,3),draw:ja({}),elements:function(a){return ea.create(a)},buffer:function(a){return X.create(a,34962)},texture:function(a){return q.create(a,3553)},cube:function(a){return 6===arguments.length?q.create(Array.prototype.slice.call(arguments),
34067):q.create(a,34067)},renderbuffer:function(a){return u.create(a)},framebuffer:function(a){return F.create(a)},framebufferCube:function(a){},frame:function(a){Y.push(a);!ba&&0<Y.length&&e();return{cancel:function(){var b=Y.find(function(b){return b===a});0>b||(Y.splice(b,1),0>=Y.length&&g())}}},stats:x,limits:W,read:aa,destroy:function(){g();L&&(L.removeEventListener("webglcontextlost",p),L.removeEventListener("webglcontextrestored",V));ra.clear();F.clear();u.clear();q.clear();X.clear();if(P.onDestroy)P.onDestroy()}})}},
{"./lib/attribute":2,"./lib/buffer":3,"./lib/compile":4,"./lib/draw":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/state":17,"./lib/strings":18,"./lib/texture":19,"./lib/uniform":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":28,"./lib/webgl":32}]},{},[1]);
