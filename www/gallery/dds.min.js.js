(function e$$0(g,n,b){function r(d,f){if(!n[d]){if(!g[d]){var l="function"==typeof require&&require;if(!f&&l)return l(d,!0);if(a)return a(d,!0);l=Error("Cannot find module '"+d+"'");throw l.code="MODULE_NOT_FOUND",l;}l=n[d]={exports:{}};g[d][0].call(l.exports,function(a){var b=g[d][1][a];return r(b?b:a)},l,l.exports,e$$0,g,n,b)}return n[d].exports}for(var a="function"==typeof require&&require,d=0;d<b.length;d++)r(b[d]);return r})({1:[function(c,g,n){c=c("../regl")();var b=c({frag:"\n  precision mediump float;\n  uniform sampler2D specular, normals, diffuse;\n  varying vec3 lightDir, eyeDir;\n  varying vec2 uv;\n  void main () {\n    float d = length(lightDir);\n    vec3 L = normalize(lightDir);\n    vec3 E = normalize(eyeDir);\n    vec3 N = normalize(2.0 * texture2D(normals, uv).rgb - 1.0);\n    N = vec3(-N.x, N.yz);\n    vec3 D = texture2D(diffuse, uv).rgb;\n    vec3 kD = D * (0.01 +\n      max(0.0, dot(L, N) * (0.6 + 0.8 / d) ));\n    vec3 S = texture2D(specular, uv).rgb;\n    vec3 kS = 2.0 * pow(max(0.0, dot(normalize(N + L), -E)), 10.0) * S;\n    gl_FragColor = vec4(kD + kS, 1);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  uniform vec2 lightPosition;\n  varying vec3 lightDir, eyeDir;\n  varying vec2 uv;\n  void main () {\n    vec2 P = 1.0 - 2.0 * position;\n    uv = vec2(position.x, 1.0 - position.y);\n    eyeDir = -vec3(P, 1);\n    lightDir = vec3(lightPosition - P, 1);\n    gl_Position = vec4(P, 0, 1);\n  }",attributes:{position:c.buffer([-2,0,0,-2,2,2])},uniforms:{specular:c.texture({mag:"linear",data:"assets/alpine_cliff_a_spec.png"}),normals:c.texture({mag:"linear",
data:"assets/alpine_cliff_a_norm.png"}),diffuse:c.texture("assets/alpine_cliff_a.dds"),lightPosition:function(b,a,d){b=.025*d.count;return[2*Math.cos(b),2*Math.sin(b)]}},count:3});c.frame(function(){b()})},{"../regl":32}],2:[function(c,g,n){function b(){this.pointer=!1;this.w=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}var r=c("./constants/dtypes.json");Object.assign(b.prototype,{equals:function(a,b){return this.pointer?
a.pointer&&this.buffer===a.buffer&&this.size===b&&this.normalized===a.normalized&&this.type===a.type&&this.offset===a.offset&&this.stride===a.stride&&this.divisor===a.divisor:!a.pointer&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},set:function(a,b){(this.pointer=a.pointer)?(this.buffer=a.buffer,this.size=b,this.normalized=a.normalized,this.type=a.type,this.offset=a.offset,this.stride=a.stride,this.divisor=a.divisor):(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w)}});g.exports=function(a,
d,h,f){function c(){for(var a=Array(16),d=0;16>d;++d)a[d]=new b;this.records=a;this.top=0}function B(a){for(var d=a.records,k=a.top;d.length-1<=k;)d.push(new b);return d[++a.top]}var J={};h=h.maxAttributes;for(var g=Array(h),I=0;I<h;++I)g[I]=new b;Object.assign(c.prototype,{pushVec:function(a,b,d,f){var h=B(this);h.pointer=!1;h.x=a;h.y=b;h.z=d;h.w=f},pushPtr:function(a,b,d,f,h,r,c){var l=B(this);l.pointer=!0;l.buffer=a;l.size=b;l.offset=d;l.stride=f;l.divisor=h;l.normalized=r;l.type=c},pushDyn:function(a){if("number"===
typeof a)this.pushVec(a,0,0,0);else if(Array.isArray(a))this.pushVec(a[0],a[1],a[2],a[3]);else{var b=f.getBuffer(a),d=0,h=0,l=0,c=0,B=!1,J=5126;b?J=b.dtype:(b=f.getBuffer(a.buffer),d=a.size||0,h=a.stride||0,l=a.offset||0,c=a.divisor||0,B=a.normalized||!1,J=b.dtype,"type"in a&&(J=r[a.type]));this.pushPtr(b,d,l,h,c,B,J)}},pop:function(){--this.top}});return{bindings:g,attributes:J,bind:function(b,h,f,v){v=f.size||v;if(!h.equals(f,v)){if(f.pointer){h.pointer||a.enableVertexAttribArray(b);h.buffer!==
f.buffer&&f.buffer.bind();a.vertexAttribPointer(b,v,f.type,f.normalized,f.stride,f.offset);var l=d.angle_instanced_arrays;l&&l.vertexAttribDivisorANGLE(b,f.divisor)}else h.pointer&&a.disableVertexAttribArray(b),a.vertexAttrib4f(b,f.x,f.y,f.z,f.w);h.set(f,v)}},def:function(a){a in J||(J[a]=new c)}}}},{"./constants/dtypes.json":9}],3:[function(c,g,n){function b(a,b){switch(a){case 5121:return new Uint8Array(b);case 5123:return new Uint16Array(b);case 5125:return new Uint32Array(b);case 5120:return new Int8Array(b);
case 5122:return new Int16Array(b);case 5124:return new Int32Array(b);case 5126:return new Float32Array(b);default:return null}}var r=c("./check"),a=c("./is-typed-array"),d=c("./is-ndarray"),h=c("./constants/arraytypes.json"),f=c("./constants/dtypes.json"),l=c("./values"),B={"static":35044,dynamic:35048,stream:35040};g.exports=function(c){function g(a,b){this.id=p++;this.buffer=a;this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function I(a){c.isBuffer(a.buffer)||
(a.buffer=c.createBuffer());a.bind();c.bufferData(a.type,a.data||a.byteLength,a.usage)}function u(a){var b=a.buffer;r(b,"buffer must not be deleted already");c.isBuffer(b)&&c.deleteBuffer(b);a.buffer=null;delete k[a.id]}var p=0,k={};g.prototype.bind=function(){c.bindBuffer(this.type,this.buffer)};return{create:function(l,p,A){function ba(k){var u=k||{};if(Array.isArray(u)||a(u)||d(u))u={data:u};else if("number"===typeof u)u={length:u|0};else if(null===u||void 0===u)u={};r.type(u,"object","buffer arguments must be an object, a number or an array");
"usage"in u?(r.parameter(u.usage,B,"invalid buffer usage"),S.usage=B[u.usage]):S.usage=35044;k=0;"type"in u&&(r.parameter(u.type,f,"invalid buffer type"),k=f[u.type]);var c=u.dimension|0||1,l=0,p=null;if("data"in u)if(p=u.data,null===p)l=u.length|0;else{if(d(p)){var c=p.shape,l=p.stride,u=p.offset,v=0,F=0,A=0,g=0;1===c.length?(v=c[0],F=1,A=l[0],g=0):2===c.length?(v=c[0],F=c[1],A=l[0],g=l[1]):r.raise("invalid shape");k=k||h[Object.prototype.toString.call(p)]|0||5126;for(var c=F,l=b(k,v*F),p=p.data,
J=0,ea=0;ea<v;++ea)for(var Z=0;Z<F;++Z)l[J++]=p[A*ea+g*Z+u];p=l}else if(Array.isArray(p))if(0<p.length&&Array.isArray(p[0])){c=p[0].length;k=k||5126;u=b(k,p.length*c);l=p;p=c;for(v=g=0;v<l.length;++v)for(A=l[v],F=0;F<p;++F)u[g++]=A[F];p=u}else k=k||5126,p=b(k,p);else r.isTypedArray(p,"invalid data type buffer data"),k=k||h[Object.prototype.toString.call(p)]|0;l=p.byteLength}else"length"in u&&(l=u.length|0,r.nni(l,"buffer length must be a nonnegative integer"));S.data=p;S.dtype=k||5121;S.byteLength=
l;S.dimension=c;I(S);return ba}var N=c.createBuffer(),S=new g(N,p);k[S.id]=S;A||ba(l);ba._reglType="buffer";ba._buffer=S;ba.destroy=function(){u(S)};return ba},clear:function(){l(k).forEach(u)},refresh:function(){l(k).forEach(I)},getBuffer:function(a){return a&&a._buffer instanceof g?a._buffer:null}}}},{"./check":4,"./constants/arraytypes.json":8,"./constants/dtypes.json":9,"./is-ndarray":17,"./is-typed-array":18,"./values":31}],4:[function(c,g,n){function b(a){a=Error("(regl) "+a);console.error(a);
throw a;}var r=c("./is-typed-array");g.exports=Object.assign(function(a,d){a||b(d)},{raise:b,parameter:function(a,d,h){a in d||b("unknown parameter ("+a+")"+(h?": "+h:"")+". possible values: "+Object.keys(d).join())},type:function(a,d,h){typeof a!==d&&b("invalid parameter type"+(h?": "+h:"")+". expected "+d+", got "+typeof a)},isTypedArray:function(a,d){r(a)||b("invalid parameter type"+(d?": "+d:"")+". must be a typed array")},nni:function(a,d){0<=a&&(a|0)===a||b("invalid parameter type, ("+a+")"+
(d?": "+d:"")+". must be a nonnegative integer")},oneOf:function(a,d,h){0>d.indexOf(a)&&b("invalid value"+(h?": "+h:"")+". must be one of: "+d)}})},{"./is-typed-array":18}],5:[function(c,g,n){g.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],6:[function(c,g,n){g.exports=function(){function b(){var a=[],b=[];return Object.assign(function(){a.push.apply(a,Array.prototype.slice.call(arguments))},{def:function(){var d="v"+
c++;b.push(d);0<arguments.length&&(a.push(d,"="),a.push.apply(a,Array.prototype.slice.call(arguments)),a.push(";"));return d},toString:function(){return[0<b.length?"var "+b+";":"",a.join("")].join("")}})}var c=0,a=[],d=[],h={};return{link:function(b){var h="g"+c++;a.push(h);d.push(b);return h},block:b,proc:function(a){var d=[],B=b(),g=B.toString;return h[a]=Object.assign(B,{arg:function(){var a="a"+c++;d.push(a);return a},toString:function(){return["function(",d.join(),"){",g(),"}"].join("")}})},
compile:function(){var b=['"use strict";return {'];Object.keys(h).forEach(function(a){b.push('"',a,'":',h[a].toString(),",")});b.push("}");return Function.apply(null,a.concat([b.join("")])).apply(null,d)}}}},{}],7:[function(c,g,n){function b(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function r(a,b,d,f){var c,l=",";switch(b){case 5126:c="1f";break;case 35664:c="2fv";break;case 35665:c=
"3fv";break;case 35666:c="4fv";break;case 35670:case 5124:c="1i";break;case 35671:case 35667:c="2iv";break;case 35672:case 35668:c="3iv";break;case 35673:case 35669:c="4iv";break;case 35674:c="Matrix2fv";l=",false,";break;case 35675:c="Matrix3fv";l=",false,";break;case 35676:c="Matrix4fv";l=",false,";break;default:h.raise("unsupported uniform type")}return a+".uniform"+c+"("+d+l+f+");"}function a(a){return a+"["+a+".length-1]"}function d(a,b){return"framebuffer"===a||a<b?-1:a>b?1:0}var h=c("./check"),
f=c("./codegen"),l=c("./constants/primitives.json"),B=c("./constants/dtypes.json"),J={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Y={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,
">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},I={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};g.exports=function(c,p,k,v,g,A,ba,N,S,n,T,ca,ja,la){function W(k,v,B,A,N){function Q(a){var e=ra[a];return e?e:e=ra[a]=y(H[a])}function R(a){var e=a.id,z=V[e];if(z)return z;z=a.func?m.def(y(a.data),"(",T,",",O,",",E,")"):m.def(T,".",a.data);return V[e]=z}function w(a,e){return a.find(function(a){return a.name===
e})}function K(a){return na&&!(a in v||a in N)}var L=f(),y=L.link,m=L.proc("batch"),D=L.block(),t=m.def,aa=m.arg,e=y(c),G=y(k.program),q=y(n.bind),E=y(ja),ia=y(ba),C=y(ca.count),P=y(ca.offset),ga=y(ca.instances),X=y(ca.primitive),ra={},fa=y(g.elements),C=t(a(C)),P=t(a(P)),X=t(a(X)),fa=t(a(fa)),x,M,oa=p.angle_instanced_arrays;oa&&(x=t(a(ga)),M=y(oa));var na="elements"in v,ga=aa(),aa=aa(),T=t(),O=t(),V={};m(e,".useProgram(",G,");");k.uniforms.forEach(function(a){if(!(a.name in B)){var ua=y(a.location),
z=y(S.uniforms[a.name]),z=z+"["+z+".length-1]";35678===a.info.type||35680===a.info.type?(a=t(z+"._texture"),m(r(e,5124,ua,a+".bind()")),D(a,".unbind();")):m(r(e,a.info.type,ua,z))}});k.attributes.forEach(function(a){if(!(A.name in A)){var e=y(n.attributes[a.name]);m(q,"(",a.location,",",y(n.bindings[a.location]),",",e,".records[",e,".top]",",",b(a.info.type),");")}});na||m("if(",fa,"){",e,".bindBuffer(",34963,",",fa,".buffer.buffer);","}else{",e,".bindBuffer(",34963,",null);","}");m("for(",O,"=0;",
O,"<",ga,";++",O,"){",T,"=",aa,"[",O,"];");Object.keys(v).sort(d).forEach(function(a){function b(a){m("if(",z,"){",e,".enable(",a,");}else{",e,".disable(",a,");}")}var z=R(v[a]);switch(a){case "framebuffer":a=Q("viewport");var q=Q("scissor.box");m("if(",ia,".push(",z,"&&",z,"._framebuffer)){",ia,".poll();",a,".setDirty();",q,".setDirty();","}");break;case "cull.enable":b(2884);break;case "blend.enable":b(3042);break;case "dither":b(3024);break;case "stencil.enable":b(2960);break;case "depth.enable":b(2929);
break;case "scissor.enable":b(3089);break;case "polygonOffset.enable":b(32823);break;case "sample.alpha":b(32926);break;case "sample.enable":b(32928);break;case "depth.mask":m(e,".depthMask(",z,");");break;case "depth.func":a=y(Y);m(e,".depthFunc(",a,"[",z,"]);");break;case "depth.range":m(e,".depthRange(",z,"[0],",z,"[1]);");break;case "blend.color":m(e,".blendColor(",z,"[0],",z,"[1],",z,"[2],",z,"[3]);");break;case "blend.equation":a=y(U);m("if(typeof ",z,'==="string"){',e,".blendEquation(",a,"[",
z,"]);","}else{",e,".blendEquationSeparate(",a,"[",z,".rgb],",a,"[",z,".alpha]);","}");break;case "blend.func":a=y(J);m(e,".blendFuncSeparate(",a,'["srcRGB" in ',z,"?",z,".srcRGB:",z,".src],",a,'["dstRGB" in ',z,"?",z,".dstRGB:",z,".dst],",a,'["srcAlpha" in ',z,"?",z,".srcAlpha:",z,".src],",a,'["dstAlpha" in ',z,"?",z,".dstAlpha:",z,".dst]);");break;case "stencil.mask":m(e,".stencilMask(",z,");");break;case "stencil.func":a=y(Y);m(e,".stencilFunc(",a,"[",z,'.cmp||"always"],',z,".ref|0,",'"mask" in ',
z,"?",z,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":q=y(I);m(e,".stencilOpSeparate(","stencil.opFront"===a?1028:1029,",",q,"[",z,'.fail||"keep"],',q,"[",z,'.zfail||"keep"],',q,"[",z,'.pass||"keep"]);');break;case "polygonOffset.offset":m(e,".polygonOffset(",z,".factor||0,",z,".units||0);");break;case "cull.face":m(e,".cullFace(",z,'==="front"?',1028,":",1029,");");break;case "lineWidth":m(e,".lineWidth(",z,");");break;case "frontFace":m(e,".frontFace(",z,'==="cw"?',2304,":",2305,
");");break;case "colorMask":m(e,".colorMask(",z,"[0],",z,"[1],",z,"[2],",z,"[3]);");break;case "sample.coverage":m(e,".sampleCoverage(",z,".value,",z,".invert);");break;case "scissor.box":case "viewport":a=Q(a);m(a,".push(",z,".x||0,",z,".y||0,",z,".w||-1,",z,".h||-1);");break;case "primitives":case "offset":case "count":case "elements":break;default:h.raise("unsupported option for batch",a)}});("viewport"in v||"framebuffer"in v)&&m(Q("viewport"),".poll();");("scissor.box"in v||"framebuffer"in v)&&
m(Q("scissor.box"),".poll();");"framebuffer"in v&&m(ia,".pop();");var W=k.uniforms,da=[];Object.keys(B).forEach(function(a){var b=w(W,a);if(b){var z=b.info.type,q=y(b.location);a=R(B[a]);35678===b.info.type||35680===b.info.type?(b=t(a+"._texture"),da.push(b),m(r(e,5124,q,b+".bind()"))):m(r(e,z,q,a))}});da.forEach(function(a){m(a,".unbind();")});var la=k.attributes;Object.keys(A).forEach(function(a){var e=w(la,a);e&&m(q,"(",e.location,",",y(a.bindings[e.location]),",",R(A[a]),",",b(e.info.type),");")});
v.count?m(C,"=",R(v.count),";"):K("count")||m("if(",C,"){");v.offset&&m(P,"=",R(v.offset),";");v.primitive&&(k=y(l),m(X,"=",k,"[",R(v.primitive),"];"));na&&(k=R(v.elements),m(fa,"=",k,"?",k,"._elements:null;"));K("offset")&&m(P,"=0;");m("if(",fa,"){");K("count")&&m(C,"=",fa,".vertCount;","if(",C,">0){");K("primitive")&&m(X,"=",fa,".primType;");na&&m(e,".bindBuffer(",34963,",",fa,".buffer.buffer);");oa&&(v.instances&&m(x,"=",R(v.instances),";"),m("if(",x,">0){",M,".drawElementsInstancedANGLE(",X,",",
C,",",fa,".type,",P,",",x,");}else{"));m(e,".drawElements(",X,",",C,",",fa,".type,",P,");");oa&&m("}");K("count")&&m("}");m("}else{");K("count")||(K("primitive")&&m(X,"=",4,";"),oa&&m("if(",x,">0){",M,".drawArraysInstancedANGLE(",X,",",P,",",C,",",x,");}else{"),m(e,".drawArrays(",X,",",P,",",C,");}"),oa&&m("}"));m("}}",D);return L.compile().batch}var H=N.contextState,U={add:32774,subtract:32778,"reverse subtract":32779};p.ext_blend_minmax&&(U.min=32775,U.max=32776);var da=0;return{draw:function(d){var h=
f(),k=h.link,l=h.proc("draw"),v=l.def,A=k(c),B=k(d.program),J=k(n.bind),K=k(ca.count),L=k(ca.offset),y=k(ca.instances),m=k(ca.primitive),D=k(g.elements),t=[];l(A,".useProgram(",B,");");d.attributes.forEach(function(a){var e=k(n.attributes[a.name]);l(J,"(",a.location,",",k(n.bindings[a.location]),",",e,".records[",e,".top]",",",b(a.info.type),");")});d.uniforms.forEach(function(a){var e=k(a.location),b=k(S.uniforms[a.name]),b=b+"["+b+".length-1]";35678===a.info.type||35680===a.info.type?(a=v(b+"._texture"),
t.push(a),l(r(A,5124,e,a+".bind()"))):l(r(A,a.info.type,e,b))});t.forEach(function(a){l(a,".unbind();")});d=v(a(m));K=v(a(K));L=v(a(L));D=v(a(D));l("if(",K,"){");(B=p.angle_instanced_arrays)?(y=v(a(y)),B=k(B),l("if(",D,"){",D,".bind();","if(",y,">0){",B,".drawElementsInstancedANGLE(",d,",",K,",",D,".type,",L,",",y,");}else{",A,".drawElements(",d,",",K,",",D,".type,",L,");}","}else if(",y,">0){",B,".drawArraysInstancedANGLE(",d,",",L,",",K,",",y,");}else{",A,".drawArrays(",d,",",L,",",K,");}}")):l("if(",
D,"){",A,".drawElements(",d,",",K,",",D,".type,",L,");}","}else{",A,".drawArrays(",d,",",L,",",K,");}");return h.compile().draw},command:function(b,c,u,p,r,A,N){function w(a){var b=fa[a];return b?b:b=fa[a]=m(H[a])}function K(a,b){var e=w(a);x(e,".push(",b,");");M(e,".pop();")}function L(a){var b=a.id,e=wa[b];if(e)return e;e=a.func?O.def(m(a.data),"(",sa,",0,",va,")"):O.def(sa,".",a.data);return wa[b]=e}var y=f(),m=y.link,D=y.block,t=y.proc,aa=da++,e=m(la),G=m(T.fragShaders),q=m(T.vertShaders),E=m(T.programs),
ia=m(ba),C={count:m(ca.count),offset:m(ca.offset),instances:m(ca.instances),primitive:m(ca.primitive)},P=m(g.elements),ga=m(l),X=m(Y),ra=m(I),fa={},x=D(),M=D(),oa=!1;Object.keys(b).sort(d).forEach(function(a){var e=b[a];switch(a){case "frag":oa=!0;x(G,".push(",m(e),");");M(G,".pop();");break;case "vert":oa=!0;x(q,".push(",m(e),");");M(q,".pop();");break;case "framebuffer":a=ba.getFramebuffer(e);h(null===e||a,"invalid framebuffer object");a=w("viewport");var d=w("scissor.box");x("if(",ia,".push(",
m(e&&e._framebuffer),")){",a,".setDirty();",d,".setDirty();","}");M("if(",ia,".pop()){",a,".setDirty();",d,".setDirty();","}");break;case "count":case "offset":case "instances":h.nni(e,a);x(C[a],".push(",e,");");M(C[a],".pop();");break;case "primitive":h.parameter(e,l,"not a valid drawing primitive");x(C.primitive,".push(",l[e],");");M(C.primitive,".pop();");break;case "elements":d=g.getElements(e);e=!("primitive"in b);a=!("count"in b);d?(d=m(d),x(P,".push(",d,");"),e&&x(C.primitive,".push(",d,".primType);"),
a&&x(C.count,".push(",d,".vertCount);")):(x(P,".push(null);"),e&&x(C.primitive,".push(",4,");"),a&&x(C.count,".push(0);"));e&&M(C.primitive,".pop();");a&&M(C.count,".pop();");"offset"in b||(x(C.offset,".push(0);"),M(C.offset,".pop();"));M(P,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":h.type(e,"boolean",a);K(a,e);break;case "depth.func":h.parameter(e,
Y,a);K(a,Y[e]);break;case "depth.range":h(Array.isArray(e)&&2===e.length&&e[0]<=e[1],"depth range is 2d array");a=w(a);x(a,".push(",e[0],",",e[1],");");M(a,".pop();");break;case "blend.func":a=w(a);h.type(e,"object","blend func must be an object");var d="srcRGB"in e?e.srcRGB:e.src,E="srcAlpha"in e?e.srcAlpha:e.src,f="dstRGB"in e?e.dstRGB:e.dst,e="dstAlpha"in e?e.dstAlpha:e.dst;h.parameter(d,J);h.parameter(E,J);h.parameter(f,J);h.parameter(e,J);x(a,".push(",J[d],",",J[f],",",J[E],",",J[e],");");M(a,
".pop();");break;case "blend.equation":a=w(a);"string"===typeof e?(h.parameter(e,U,"invalid blend equation"),x(a,".push(",U[e],",",U[e],");")):"object"===typeof e?(h.parameter(e.rgb,U,"invalid blend equation rgb"),h.parameter(e.alpha,U,"invalid blend equation alpha"),x(a,".push(",U[e.rgb],",",U[e.alpha],");")):h.raise("invalid blend equation");M(a,".pop();");break;case "blend.color":h(Array.isArray(e)&&4===e.length,"blend color is a 4d array");a=w(a);x(a,".push(",e[0],",",e[1],",",e[2],",",e[3],");");
M(a,".pop();");break;case "stencil.mask":h.type(e,"number","stencil mask must be an integer");a=w(a);x(a,".push(",e,");");M(a,".pop();");break;case "stencil.func":h.type(e,"object","stencil func must be an object");d=e.cmp||"keep";E=e.ref||0;e="mask"in e?e.mask:-1;h.parameter(d,Y,"invalid stencil func cmp");h.type(E,"number","stencil func ref");h.type(e,"number","stencil func mask");a=w(a);x(a,".push(",Y[d],",",E,",",e,");");M(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":h.type(e,
"object",a);d=e.fail||"keep";E=e.zfail||"keep";e=e.pass||"keep";h.parameter(d,I,a);h.parameter(E,I,a);h.parameter(e,I,a);a=w(a);x(a,".push(",I[d],",",I[E],",",I[e],");");M(a,".pop();");break;case "polygonOffset.offset":h.type(e,"object",a);d=e.factor||0;e=e.units||0;h.type(d,"number","offset.factor");h.type(e,"number","offset.units");a=w(a);x(a,".push(",d,",",e,");");M(a,".pop();");break;case "cull.face":d=0;"front"===e?d=1028:"back"===e&&(d=1029);h(!!d,"cull.face");e=w(a);x(e,".push(",d,");");M(e,
".pop();");break;case "lineWidth":d=k.lineWidthDims;h("number"===typeof e&&e>=d[0]&&e<=d[1],"invalid line width, must positive number between "+d[0]+" and "+d[1]);K(a,e);break;case "frontFace":d=0;"cw"===e?d=2304:"ccw"===e&&(d=2305);h(!!d,"frontFace");e=w(a);x(e,".push(",d,");");M(e,".pop();");break;case "colorMask":h(Array.isArray(e)&&4===e.length,"color mask must be length 4 array");a=w(a);x(a,".push(",e.map(function(a){return!!a}).join(),");");M(a,".pop();");break;case "sample.coverage":h.type(e,
"object",a);d="value"in e?e.value:1;e=!!e.invert;h("number"===typeof d&&0<=d&&1>=d,"sample value");a=w(a);x(a,".push(",d,",",e,");");M(a,".pop();");break;case "viewport":case "scissor.box":h("object"===typeof e&&e,a+" is an object");var d=e.x||0,E=e.y||0,c=f=-1;h("number"===typeof d&&0<=d,a+".x must be a positive int");h("number"===typeof E&&0<=E,a+".y must be a positive int");"w"in e&&(f=e.w,h("number"===typeof f&&0<=f,a+".w must be a positive int"));"h"in e&&(c=e.h,h("number"===typeof c&&0<=c,a+
".h must be a positive int"));e=w(a);x(e,".push(",d,",",E,",",f,",",c,");");M(e,".pop();");break;default:h.raise("unsupported parameter "+a)}});if(oa){if(b.frag&&b.vert)x(E,".push(",m(T.create(b.vert,b.frag)),");");else{var D=x.def(G,"[",G,".length-1]"),na=x.def(q,"[",q,".length-1]"),ta=m(T.create);x(E,".push(",ta,"(",na,",",D,"));")}M(E,".pop();")}Object.keys(c).forEach(function(a){S.def(a);var e=m(S.uniforms[a]);a=c[a];a="function"===typeof a&&a._reglType?m(a):Array.isArray(a)?m(a.slice()):+a;x(e,
".push(",a,");");M(e,".pop();")});Object.keys(u).forEach(function(a){n.def(a);var e=m(n.attributes[a]),b=u[a];if("number"===typeof b)x(e,".pushVec(",+b,",0,0,0);");else if(h(!!b,"invalid attribute: "+a),Array.isArray(b))x(e,".pushVec(",[b[0]||0,b[1]||0,b[2]||0,b[3]||0],");");else{var d=v.getBuffer(b),q=0,E=0,k=0,f=0,c=!1,G=5126;d?G=d.dtype:(h.type(b,"object",'invalid attribute "'+a+'"'),d=v.getBuffer(b.buffer),q=b.size||0,E=b.stride||0,k=b.offset||0,f=b.divisor||0,c=b.normalized||!1,h(!!d,"invalid attribute "+
a+".buffer"),G=d.dtype,"type"in b&&(h.parameter(b.type,B,"attribute type"),G=B[b.type]));h(!!d,"invalid attribute "+a+".buffer");h.nni(E,a+".stride");h.nni(k,a+".offset");h.nni(f,a+".divisor");h.type(c,"boolean",a+".normalized");h.oneOf(q,[0,1,2,3,4],a+".size");x(e,".pushPtr(",[m(d),q,k,E,f,c,G].join(),");")}M(e,".pop();")});var O=y.block(),V=y.block(),va,sa;N&&(va=m(ja),sa=x.def());var wa={};Object.keys(p).sort(d).forEach(function(a){var e=L(p[a]);switch(a){case "framebuffer":a=w("viewport");var d=
w("scissor.box");O("if(",ia,".push(",e,"&&",e,"._framebuffer)){",a,".setDirty();",d,".setDirty();","}");V("if(",ia,".pop()){",a,".setDirty();",d,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=w(a);O(a,".push(",e,");");V(a,".pop();");break;case "count":case "offset":case "instances":a=C[a];O(a,".push(",
e,");");V(a,".pop();");break;case "primitive":a=C.primitive;O(a,".push(",ga,"[",e,"]);");V(a,".pop();");break;case "depth.func":a=w(a);O(a,".push(",X,"[",e,"]);");V(a,".pop();");break;case "blend.func":a=w(a);d=m(J);O(a,".push(",d,'["srcRGB" in ',e,"?",e,".srcRGB:",e,".src],",d,'["dstRGB" in ',e,"?",e,".dstRGB:",e,".dst],",d,'["srcAlpha" in ',e,"?",e,".srcAlpha:",e,".src],",d,'["dstAlpha" in ',e,"?",e,".dstAlpha:",e,".dst]);");V(a,".pop();");break;case "blend.equation":a=w(a);d=m(U);O("if(typeof ",
e,'==="string"){',a,".push(",d,"[",e,"],",d,"[",e,"]);","}else{",a,".push(",d,"[",e,".rgb],",d,"[",e,".alpha]);","}");V(a,".pop();");break;case "blend.color":a=w(a);O(a,".push(",e,"[0],",e,"[1],",e,"[2],",e,"[3]);");V(a,".pop();");break;case "stencil.mask":a=w(a);O(a,".push(",e,");");V(a,".pop();");break;case "stencil.func":a=w(a);O(a,".push(",X,"[",e,".cmp],",e,".ref|0,",'"mask" in ',e,"?",e,".mask:-1);");V(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=w(a);O(a,".push(",ra,"[",
e,'.fail||"keep"],',ra,"[",e,'.zfail||"keep"],',ra,"[",e,'.pass||"keep"]);');V(a,".pop();");break;case "polygonOffset.offset":a=w(a);O(a,".push(",e,".factor||0,",e,".units||0);");V(a,".pop();");break;case "cull.face":a=w(a);O(a,".push(",e,'==="front"?',1028,":",1029,");");V(a,".pop();");break;case "frontFace":a=w(a);O(a,".push(",e,'==="cw"?',2304,":",2305,");");V(a,".pop();");break;case "colorMask":a=w(a);O(a,".push(",e,"[0],",e,"[1],",e,"[2],",e,"[3]);");V(a,".pop();");break;case "sample.coverage":a=
w(a);O(a,".push(",e,".value,",e,".invert);");V(a,".pop();");break;case "scissor.box":case "viewport":a=w(a);O(a,".push(",e,".x||0,",e,".y||0,",'"w" in ',e,"?",e,".w:-1,",'"h" in ',e,"?",e,".h:-1);");V(a,".pop();");break;case "elements":a=!("primitive"in p)&&!("primitive"in b);var d=!("count"in p)&&!("count"in b),q=!("offset"in p)&&!("offset"in b),E=O.def();O("if(",e,"){",E,"=",e,"._elements;",P,".push(",E,");",a?C.primitive+".push("+E+".primType);":"",d?C.count+".push("+E+".vertCount);":"",q?C.offset+
".push("+E+".offset);":"","}else{",P,".push(null);","}");V(P,".pop();","if(",e,"){",a?C.primitive+".pop();":"",d?C.count+".pop();":"",q?C.offset+".pop();":"","}");break;default:h.raise("unsupported dynamic option: "+a)}});Object.keys(r).forEach(function(a){S.def(a);var e=m(S.uniforms[a]);a=L(r[a]);O(e,".push(",a,");");V(e,".pop();")});Object.keys(A).forEach(function(a){n.def(a);var e=m(n.attributes[a]);a=L(A[a]);O(e,".pushDyn(",a,");");V(e,".pop();")});D=t("scope");na=D.arg();ta=D.arg();D(x);N&&D(sa,
"=",na,";",O);D(ta,"();",N?V:"",M);D=t("draw");D(x);N&&D(sa,"=",D.arg(),";",O);na=a(E);D(e,"();","if(",na,")",na,".draw(",N?sa:"",");",N?V:"",M);var qa=t("batch");qa(x);N=qa.def(a(E));t=m(function(a,e,d){var q=a.batchCache[aa];q||(q=a.batchCache[aa]=W(a,p,r,A,b));return q(e,d)});qa("if(",N,"){",e,"();",t,"(",N,",",qa.arg(),",",qa.arg(),");");Object.keys(p).forEach(function(a){(a=fa[a])&&qa(a,".setDirty();")});qa("}",M);return y.compile()}}}},{"./check":4,"./codegen":6,"./constants/dtypes.json":9,
"./constants/primitives.json":10}],8:[function(c,g,n){g.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],9:[function(c,g,n){g.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],10:[function(c,g,n){g.exports={points:0,
lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],11:[function(c,g,n){function b(a,b){function f(){var b=window.innerWidth,f=window.innerHeight;a!==document.body&&(f=a.getBoundingClientRect(),b=f.right-f.left,f=f.top-f.bottom);c.width=g*b;c.height=g*f;Object.assign(c.style,{width:b+"px",height:f+"px"})}var c=document.createElement("canvas"),B=r(c,b);Object.assign(c.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(c);a===document.body&&(c.style.position=
"absolute",Object.assign(a.style,{margin:0,padding:0}));var g=+B.options.pixelRatio;window.addEventListener("resize",f,!1);var n=B.options.onDestroy;B.options=Object.assign({},B.options,{onDestroy:function(){window.removeEventListener("resize",f);a.removeChild(c);n&&n()}});f();return B}function r(b,c){function f(a){try{return b.getContext(a,l)}catch(f){return null}}var l=c.glOptions||{},r=f("webgl")||f("experimental-webgl")||f("webgl-experimental");a(r,"webgl not supported");return{gl:r,options:Object.assign({pixelRatio:window.devicePixelRatio},
c)}}var a=c("./check");g.exports=function(a){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:a[0],options:a[1]||{}};var c=document.body,f=a[1]||{};if("string"===typeof a[0])c=document.querySelector(a[0])||document.body;else if("object"===typeof a[0])if(a[0]instanceof HTMLElement)c=a[0];else{if(a[0]instanceof WebGLRenderingContext)return{gl:a[0],options:Object.assign({pixelRatio:1},f)};f=a[0]}return c.nodeName&&"CANVAS"===c.nodeName.toUpperCase()?r(c,f):b(c,f)}},{"./check":4}],
12:[function(c,g,n){g.exports=function(b){return{primitive:[4],count:[0],offset:[0],instances:[0]}}},{}],13:[function(c,g,n){function b(b,c){this.id=a++;this.func=b;this.data=c}function r(a,c){switch(typeof a){case "boolean":case "number":case "string":return new b(!1,a);case "function":return new b(!0,a);default:return r}}var a=0;g.exports={define:r,isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof b},unbox:function(a,c){return a instanceof b?a:"function"===typeof a&&
a!==r?new b(!0,a):new b(!1,c)}}},{}],14:[function(c,g,n){var b=c("./check"),r=c("./is-typed-array"),a=c("./is-ndarray"),d=c("./constants/primitives.json");g.exports=function(c,f,l){function B(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}B.prototype.bind=function(){this.buffer.bind()};return{create:function(c){function h(c){var k=f.oes_element_index_uint;if(c)if("number"===typeof c)u(c);else{var v=null,l="static",A=0;Array.isArray(c)||r(c)||a(c)?v=c:(b.type(c,"object","invalid arguments for elements"),
"data"in c&&(v=c.data),"usage"in c&&(l=c.usage),"length"in c&&(A=c.length));Array.isArray(v)||a(v)&&"array"===v.dtype||"type"in c?u({type:c.type||(k?"uint32":"uint16"),usage:l,data:v,length:A}):u({usage:l,data:v,length:A});if(Array.isArray(v)||r(v))u.dimension=3}else u();v=g.buffer.byteLength;l=0;switch(g.buffer.dtype){case 5121:case 5120:l=5121;break;case 5123:case 5122:l=5123;v>>=1;break;case 5125:case 5124:b(k,"32 bit element buffers not supported");l=5125;v>>=2;break;default:b.raise("invalid element buffer type")}k=
4;A=g.buffer.dimension;1===A&&(k=0);2===A&&(k=1);3===A&&(k=4);"object"===typeof c&&("primitive"in c&&(k=c.primitive,b.parameter(k,d),k=d[k]),"count"in c&&(v=c.vertCount|0));g.primType=k;g.vertCount=v;g.type=l;return h}var g=new B,u=l.create(null,34963,!0);g.buffer=u._buffer;h(c);Object.assign(h,{_reglType:"elements",_elements:g,destroy:function(){b(null!==g.buffer,"must not double destroy elements");u.destroy();g.buffer=null}});return h},elements:[null],getElements:function(a){return a&&a._elements instanceof
B?a._elements:null}}}},{"./check":4,"./constants/primitives.json":10,"./is-ndarray":17,"./is-typed-array":18}],15:[function(c,g,n){g.exports=function(b){function c(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(d){try{a[d]=
b.getExtension(d)}catch(c){}})}var a={};c();return{extensions:a,refresh:c}}},{}],16:[function(c,g,n){var b=c("./check"),r=c("./values"),a=[1029];g.exports=function(d,c,f,l,g){function J(a,b,d,c){this.target=a;this.level=b;this.texture=d;this.renderbuffer=c}function n(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function I(a,d,c){if(a.texture)b.oneOf(a.texture._texture.params.internalformat,d,"unsupported texture format for attachment");else b.oneOf(a.renderbuffer._renderbuffer.format,
c,"unsupported renderbuffer format for attachment")}function u(a,d){var c=d.width,f=d.height;if(a.texture){var k=a.texture._texture,h=Math.max(1,k.params.width>>a.level),l=Math.max(1,k.params.height>>a.level),c=c||h,f=f||l;b(h===c&&l===f,"inconsistent width/height for supplied texture");b(0>k.pollId,"polling fbo textures not supported")}else k=a.renderbuffer._renderbuffer,c=c||k.width,f=f||k.height,b(k.width===c&&k.height===f,"inconsistent width/height for renderbuffer"),b(0<=ea.indexOf(k.format),
"renderbuffer format not compatible with color channels");k.refCount+=1;d.width=c;d.height=f}function p(a,b){b?b.texture?d.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):d.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):d.framebufferTexture2D(36160,a,3553,null,0)}function k(a){var d=3553,c=0,f=null,k=null,h=a;"object"===typeof a&&(h=a.data,"level"in a&&(c=a.level|0),"target"in a&&(d=a.target|0));b.type(h,"function","invalid attachment data");
h=a._reglType;"texture"===h?(f=a,34067===f._texture.target?b(34069<=d&&34075>d,"invalid cube map target"):b(3553===d)):"renderbuffer"===h?(k=a,d=36161,c=0):b.raise("invalid regl object for attachment");return new J(d,c,f,k)}function v(a){return a&&(a.texture||a.renderbuffer)}function F(){this.id=ka++;Q[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=
!1}function A(a){d.isFramebuffer(a.framebuffer)||(a.framebuffer=d.createFramebuffer());w=!0;d.bindFramebuffer(36160,a.framebuffer);for(var k=a.colorAttachments,l=0;l<k.length;++l)p(36064+l,k[l]);for(l=k.length;l<f.maxColorAttachments;++l)p(36064+l,null);p(36096,a.depthAttachment);p(36128,a.stencilAttachment);p(33306,a.depthStencilAttachment);c.webgl_draw_buffers&&c.webgl_draw_buffers.drawBuffersWEBGL(ha[k.length]);a=d.checkFramebufferStatus(36160);36053!==a&&b.raise("framebuffer configuration not supported, status = "+
S[a])}function ba(a){a=a.framebuffer;b(a,"must not double destroy framebuffer");d.isFramebuffer(a)&&d.deleteFramebuffer(a)}function N(){return R[R.length-1]}var S={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},pa={rgba:6408},T={rgba4:32854,rgb565:36194,"rgb5 a1":32855};c.ext_srgb&&(T.srgba=35907);c.ext_color_buffer_half_float&&(T.rgba16f=34842,T.rgb16f=34843);c.webgl_color_buffer_float&&(T.rgba32f=34836);var ca=
[33189],ja=[36168],la=[34041],W=[],H=[],U=[];c.webgl_depth_texture&&(W.push(6402),U.push(34041));var da=Object.assign({},pa,T),ma=r(pa),ea=r(T),T=5121,Z={uint8:5121};c.oes_texture_half_float&&(T=Z["half float"]=36193);c.oes_texture_float&&(T=Z["float"]=5126);Z.best=T;var ha=function(){for(var a=Array(f.maxDrawbuffers),b=0;b<=f.maxDrawbuffers;++b)for(var d=a[b]=Array(b),c=0;c<b;++c)d[c]=36064+c;return a}(),ka=0,Q={},R=[null],w=!0;return{top:N,dirty:function(){return w},push:function(a){a=a||null;w=
w||a!==N();R.push(a);return w},pop:function(){var a=N();R.pop();return w=w||a!==N()},getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof F)?a:null},poll:function(){if(w){var b=R[R.length-1],k=c.webgl_draw_buffers;b?(d.bindFramebuffer(36160,b.framebuffer),k&&k.drawBuffersWEBGL(ha[b.colorAttachments.length])):(d.bindFramebuffer(36160,null),k&&k.drawBuffersWEBGL(a));w=!1}},create:function(a){function f(a){var r,t=a||{};r=c.webgl_draw_buffers;
var F=0,e=0;"shape"in t?(a=t.shape,b(Array.isArray(a)&&2<=a.length,"invalid shape for framebuffer"),F=a[0],e=a[1]):("radius"in t&&(F=e=t.radius),"width"in t&&(F=t.width),"height"in t&&(e=t.height));var G=null;a=!1;if("colorBuffers"in t||"colorBuffer"in t){G=t.colorBuffers||t.colorBuffer;Array.isArray(G)||(G=[G]);p.width=F;p.height=e;1<G.length&&b(r,"multiple render targets not supported");b(0<=G.length,"must specify at least one color attachment");G=G.map(k);for(r=0;r<G.length;++r)F=G[r],I(F,ma,ea),
u(F,p);F=p.width;e=p.height}else{var q=!0,E="rgba",ia="uint8",C=1;a=!0;p.width=F||d.drawingBufferWidth;p.height=e||d.drawingBufferHeight;"format"in t&&(E=t.format,b.parameter(E,da,"invalid color format"),q=E in pa);"type"in t&&(b(q,"colorType can not be set for renderbuffer targets"),ia=t.type,b.parameter(ia,Z,"invalid color type"));"colorCount"in t&&(C=t.colorCount|0,b(0<=C,"color count must be positive"));if(p.ownsColor)for(G=p.colorAttachments;G.length>C;)n(G.pop());else G=[];for(r=0;r<G.length;++r){var P;
a:{P=G[r];var ga=q,X=E,w=F,fa=e;if(P.texture){var x=P.texture;if(ga){x({format:X,type:ia,width:w,height:fa});x._texture.refCount+=1;P=!0;break a}}else if(x=P.renderbuffer,!ga){x({format:X,width:w,height:fa});x._renderbuffer.refCount+=1;P=!0;break a}n(P);P=!1}P||(G[r--]=G[G.length-1],G.pop())}for(;G.length<C;)q?G.push(new J(3553,0,l.create({format:E,type:ia,width:F,height:e},3553),null)):G.push(new J(36161,0,null,g.create({format:E,width:F,height:e})))}b(0<G.length,"must specify at least one color buffer");
p.width=F;p.height=e;E=q=r=null;ia=!1;C=0;"depthBuffer"in t&&(r=k(t.depthBuffer),I(r,W,ca),C+=1);"stencilBuffer"in t&&(q=k(t.stencilBuffer),I(q,H,ja),C+=1);"depthStencilBuffer"in t&&(E=k(t.depthStencilBuffer),I(E,U,la),C+=1);if(r||q||E)b(1===C,"can specify only one of depth, stencil or depthStencil attachment"),u(r||q||E,p);else if(C=!0,ga=P=!1,"depth"in t&&(C=!!t.depth),"stencil"in t&&(P=!!t.stencil),"depthTexture"in t&&(ga=!!t.depthTexture),t=p.depthAttachment||p.stencilAttachment||p.depthStencilAttachment,
X=null,C||P)ia=!0,ga?(b(c.webgl_depth_texture,"depth texture extension not supported"),b(C,"stencil only textures not supported"),ga=P?"depth stencil":"depth",p.ownsDepthStencil&&t.texture?(t.texture({format:ga,width:F,height:e}),t.texture._texture.refCount+=1,X=t):X=new J(3553,0,l.create({format:ga,width:F,height:e},3553),null)):(ga=C?P?"depth stencil":"depth":"stencil",p.ownsDepthStencil&&t.renderbuffer?(t.renderbuffer({format:ga,width:F,height:e}),t.renderbuffer._renderbuffer.refCount+=1,X=t):
X=new J(36161,0,null,g.create({format:ga,width:F,height:e}))),C?P?E=X:r=X:q=X;F=p;F.colorAttachments.forEach(n);n(F.depthAttachment);n(F.stencilAttachment);n(F.depthStencilAttachment);p.colorAttachments=G;p.depthAttachment=r;p.stencilAttachment=q;p.depthStencilAttachment=E;p.ownsColor=a;p.ownsDepthStencil=ia;f.color=G.map(v);f.depth=v(r);f.stencil=v(q);f.depthStencil=v(E);A(p);f.width=p.width;f.height=p.height;return f}var p=new F;f(a);Object.assign(f,{_reglType:"framebuffer",_framebuffer:p,destroy:function(){ba(p)}});
return f},clear:function(){r(Q).forEach(ba)},refresh:function(){r(Q).forEach(A)}}}},{"./check":4,"./values":31}],17:[function(c,g,n){var b=c("./is-typed-array");g.exports=function(c){return"object"===typeof c&&Array.isArray(c.shape)&&Array.isArray(c.stride)&&"number"===typeof c.offset&&c.shape.length===c.stride.length&&(Array.isArray(c.data)||b(c.data))}},{"./is-typed-array":18}],18:[function(c,g,n){var b=c("./constants/arraytypes.json");g.exports=function(c){return Object.prototype.toString.call(c)in
b}},{"./constants/arraytypes.json":8}],19:[function(c,g,n){g.exports=function(b,c){var a=1;c.ext_texture_filter_anisotropic&&(a=b.getParameter(34047));var d=1,h=1;c.webgl_draw_buffers&&(d=b.getParameter(34852),h=b.getParameter(36063));return{colorBits:[b.getParameter(3410),b.getParameter(3411),b.getParameter(3412),b.getParameter(3413)],depthBits:b.getParameter(3414),stencilBits:b.getParameter(3415),subpixelBits:b.getParameter(3408),extensions:Object.keys(c).filter(function(a){return!!c[a]}),maxAnisotropic:a,
maxDrawbuffers:d,maxColorAttachments:h,pointSizeDims:b.getParameter(33901),lineWidthDims:b.getParameter(33902),maxViewportDims:b.getParameter(3386),maxCombinedTextureUnits:b.getParameter(35661),maxCubeMapSize:b.getParameter(34076),maxRenderbufferSize:b.getParameter(34024),maxTextureUnits:b.getParameter(34930),maxTextureSize:b.getParameter(3379),maxAttributes:b.getParameter(34921),maxVertexUniforms:b.getParameter(36347),maxVertexTextureUnits:b.getParameter(35660),maxVaryingVectors:b.getParameter(36348),
maxFragmentUniforms:b.getParameter(36349),glsl:b.getParameter(35724),renderer:b.getParameter(7937),vendor:b.getParameter(7936),version:b.getParameter(7938)}}},{}],20:[function(c,g,n){g.exports=function(b,c){if("undefined"!==typeof document){var a;a=(a=/\.(\w+)(\?.*)?$/.exec(b))&&a[1]?a[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(a))return a=document.createElement("video"),a.autoplay=!0,a.loop=!0,c&&(a.crossOrigin=c),a.src=
b,a;if(0<=["dds"].indexOf(a))return a=new XMLHttpRequest,a.responseType="arraybuffer",a.open("GET",b,!0),a.send(),a;a=new Image;c&&(a.crossOrigin=c);a.src=b;return a}return null}},{}],21:[function(c,g,n){var b=c("./check");g.exports=function(c){function g(a){for(var b=Z,d=ha,f=0;f<K;++f){var e=Math.max(1,b+3>>2)*Math.max(1,d+3>>2)*R;y.pixels.push({target:a,miplevel:f,width:b,height:d,data:new Uint8Array(c,L,e)});L+=e;b>>=1;d>>=1}}var n=new Int32Array(c);b(n[0]===r,"invalid magic number for dds header");
var ea=n[pa];b(ea&k,"unsupported dds format");var Z=n[ca],ha=n[T],ka=Y,Q=0,R=0,w=4;switch(n[W]){case F:R=8;ea&v?(w=3,Q=h):Q=f;break;case A:R=16;Q=l;break;case ba:R=16;Q=B;break;case N:R=8;Q=J;break;default:b.raise("unsupported dds texture format")}var K=1;n[la]&I&&(K=Math.max(1,n[ja]));var L=n[S]+4,y={width:Z,height:ha,channels:w,format:Q,type:ka,compressed:!0,cube:!1,pixels:[]},n=n[H];if(n&u)for(b((n&p)===p,"missing cubemap faces"),y.cube=!0,n=0;6>n;++n)g(d+n);else g(a);return y};var r=542327876,
a=3553,d=34069,h=33776,f=33777,l=33778,B=33779,J=36196,Y=5121,I=131072,u=512,p=64512,k=4,v=64,F=827611204,A=861165636,ba=894720068,N=826496069,S=1,pa=2,T=3,ca=4,ja=7,la=20,W=21,H=28},{"./check":4}],22:[function(c,g,n){g.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(b){return requestAnimationFrame(b)},cancel:function(b){return cancelAnimationFrame(b)}}:{next:function(b){setTimeout(b,30)},cancel:clearTimeout}},{}],23:[function(c,g,n){var b=
c("./check"),r=c("./is-typed-array");g.exports=function(a,c,h){return function(f){var l=f||{};r(f)?l={data:l}:2===arguments.length?l={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof f&&(l={});c();var g=l.x||0,n=l.y||0,Y=l.width||h.width,I=l.height||h.height,u=Y*I*4,l=l.data||new Uint8Array(u);b.isTypedArray(l);b(l.byteLength>=u,"data buffer too small");a.pixelStorei(3333,4);a.readPixels(g,n,Y,I,6408,5121,l);return l}}},{"./check":4,"./is-typed-array":18}],24:[function(c,g,n){var b=c("./check"),
r=c("./values");g.exports=function(a,c,h){function f(){this.id=Y++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function l(b){a.isRenderbuffer(b.renderbuffer)||(b.renderbuffer=a.createRenderbuffer());a.bindRenderbuffer(36161,b.renderbuffer);a.renderbufferStorage(36161,b.format,b.width,b.height)}function g(c){var d=c.renderbuffer;b(d,"must not double destroy renderbuffer");a.bindRenderbuffer(36161,null);a.isRenderbuffer(d)&&a.deleteRenderbuffer(d);c.renderbuffer=
null;c.refCount=0;delete I[c.id]}var n={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};c.ext_srgb&&(n.srgba=35907);c.ext_color_buffer_half_float&&(n.rgba16f=34842,n.rgb16f=34843);c.webgl_color_buffer_float&&(n.rgba32f=34836);var Y=0,I={};f.prototype.decRef=function(){0===--this.refCount&&g(this)};return{create:function(a){function c(a){a=a||{};var f=0,g=0;"shape"in a?(g=a.shape,b(Array.isArray(g)&&2<=g.length,"invalid renderbuffer shape"),f=g[0]|0,g=g[1]|
0):("radius"in a&&(f=g=a.radius|0),"width"in a&&(f=a.width|0),"height"in a&&(g=a.height|0));var u=h.maxRenderbufferSize;b(0<=f&&0<=g&&f<=u&&g<=u,"invalid renderbuffer size");c.width=d.width=Math.max(f,1);c.height=d.height=Math.max(g,1);d.format=32854;"format"in a&&(a=a.format,b.parameter(a,n,"invalid render buffer format"),d.format=n[a]);l(d);return c}var d=new f;I[d.id]=d;c(a);Object.assign(c,{_reglType:"renderbuffer",_renderbuffer:d,destroy:function(){d.decRef()}});return c},refresh:function(){r(I).forEach(l)},
clear:function(){r(I).forEach(g)}}}},{"./check":4,"./values":31}],25:[function(c,g,n){function b(a,b,c){this.name=a;this.location=b;this.info=c}var r=c("./check");g.exports=function(a,c,h,f){function l(b,c){var d=p[b],f=d[c];if(!f){f=a.createShader(b);a.shaderSource(f,c);a.compileShader(f);if(!a.getShaderParameter(f,a.COMPILE_STATUS)){var k=a.getShaderInfoLog(f);r.raise("Error compiling shader:\n"+k)}d[c]=f}return f}function g(){Object.keys(p).forEach(function(b){Object.keys(p[b]).forEach(function(c){a.deleteShader(p[b][c])})});
p[35632]={};p[35633]={}}function n(a,b){this.fragSrc=a;this.vertSrc=b;this.program=null;this.uniforms=[];this.attributes=[];this.draw=function(){};this.batchCache={}}function Y(){v.forEach(function(a){a.destroy()});v.length=0;k={}}function I(){v.forEach(function(a){a.link()})}function u(){g();Y()}var p={},k={},v=[];Object.assign(n.prototype,{link:function(){var k,g;k=l(a.FRAGMENT_SHADER,this.fragSrc);g=l(a.VERTEX_SHADER,this.vertSrc);var p=this.program=a.createProgram();a.attachShader(p,k);a.attachShader(p,
g);a.linkProgram(p);a.getProgramParameter(p,a.LINK_STATUS)||(k=a.getProgramInfoLog(p),r.raise("Error linking program:\n"+k));var u=a.getProgramParameter(p,a.ACTIVE_UNIFORMS),v=this.uniforms=[];for(k=0;k<u;++k)if(g=a.getActiveUniform(p,k))if(1<g.size)for(var n=0;n<g.size;++n){var B=g.name.replace("[0]","["+n+"]");v.push(new b(B,a.getUniformLocation(p,B),g));h.def(B)}else v.push(new b(g.name,a.getUniformLocation(p,g.name),g)),h.def(g.name);u=a.getProgramParameter(p,a.ACTIVE_ATTRIBUTES);v=this.attributes=
[];for(k=0;k<u;++k)if(g=a.getActiveAttrib(p,k))v.push(new b(g.name,a.getAttribLocation(p,g.name),g)),c.def(g.name);this.draw=f(this);this.batchCache={}},destroy:function(){a.deleteProgram(this.program)}});u();return{create:function(a,b){var c=k[b];c||(c=k[b]={});var d=c[a];d||(d=new n(b,a),d.link(),c[a]=d,v.push(d));return d},clear:u,refresh:function(){p[35632]={};p[35633]={};I()},programs:[null],fragShaders:["void main(){gl_FragColor=vec4(0,0,0,0);}"],vertShaders:["void main(){gl_Position=vec4(0,0,0,0);}"]}}},
{"./check":4}],26:[function(c,g,n){g.exports=function(b,c){var a=b.length,d=b.slice(),h=b.slice(),f=!1,g=!0;return{push:function(){f=!1;for(var b=0;b<a;++b){var c=arguments[b];f=f||c!==h[b];d.push(c)}},pop:function(){f=!1;d.length-=a;for(var b=0;b<a;++b)f=f||d[d.length-a+b]!==h[b]},poll:function(){var b=d.length-a;if(f||g){switch(a){case 1:c(d[b]);break;case 2:c(d[b],d[b+1]);break;case 3:c(d[b],d[b+1],d[b+2]);break;case 4:c(d[b],d[b+1],d[b+2],d[b+3]);break;case 5:c(d[b],d[b+1],d[b+2],d[b+3],d[b+4]);
break;case 6:c(d[b],d[b+1],d[b+2],d[b+3],d[b+4],d[b+5]);break;default:c.apply(null,d.slice(b,d.length))}for(var n=0;n<a;++n)h[n]=d[b+n];g=f=!1}},setDirty:function(){g=!0}}}},{}],27:[function(c,g,n){var b=c("./stack"),r=c("./codegen");g.exports=function(a,c,g){function f(c,d){var f=b([!!d],function(b){b?a.enable(c):a.disable(c)});f.flag=c;return f}var l={dither:f(3024),"blend.enable":f(3042),"blend.color":b([0,0,0,0],function(b,c,d,f){a.blendColor(b,c,d,f)}),"blend.equation":b([32774,32774],function(b,
c){a.blendEquationSeparate(b,c)}),"blend.func":b([1,0,1,0],function(b,c,d,f){a.blendFuncSeparate(b,c,d,f)}),"depth.enable":f(2929,!0),"depth.func":b([513],function(b){a.depthFunc(b)}),"depth.range":b([0,1],function(b,c){a.depthRange(b,c)}),"depth.mask":b([!0],function(b){a.depthMask(b)}),"cull.enable":f(2884),"cull.face":b([1029],function(b){a.cullFace(b)}),frontFace:b([2305],function(b){a.frontFace(b)}),colorMask:b([!0,!0,!0,!0],function(b,c,d,f){a.colorMask(b,c,d,f)}),lineWidth:b([1],function(b){a.lineWidth(b)}),
"polygonOffset.enable":f(32823),"polygonOffset.offset":b([0,0],function(b,c){a.polygonOffset(b,c)}),"sample.alpha":f(32926),"sample.enable":f(32928),"sample.coverage":b([1,!1],function(b,c){a.sampleCoverage(b,c)}),"stencil.enable":f(2960),"stencil.mask":b([-1],function(b){a.stencilMask(b)}),"stencil.func":b([519,0,-1],function(b,c,d){a.stencilFunc(b,c,d)}),"stencil.opFront":b([7680,7680,7680],function(b,c,d){a.stencilOpSeparate(1028,b,c,d)}),"stencil.opBack":b([7680,7680,7680],function(b,c,d){a.stencilOpSeparate(1029,
b,c,d)}),"scissor.enable":f(3089),"scissor.box":b([0,0,-1,-1],function(b,f,k,g){var h=k,l=c.top();0>k&&(h=l?l.width-b:a.drawingBufferWidth-b);k=g;0>g&&(k=l?l.height-f:a.drawingBufferHeight-f);a.scissor(b,f,h,k)}),viewport:b([0,0,-1,-1],function(b,f,k,l){var n=k,r=c.top();0>k&&(n=r?r.width-b:a.drawingBufferWidth-b);k=l;0>l&&(k=r?r.height-f:a.drawingBufferHeight-f);a.viewport(b,f,n,k);g.width=n;g.height=k})},n=r(),J=n.proc("poll"),Y=n.proc("refresh");Object.keys(l).forEach(function(a){a=n.link(l[a]);
J(a,".poll();");Y(a,".setDirty();")});var I=n.compile();return{contextState:l,viewport:g,poll:I.poll,refresh:I.refresh,notifyViewportChanged:function(){l.viewport.setDirty();l["scissor.box"].setDirty()}}}},{"./codegen":6,"./stack":26}],28:[function(c,g,n){function b(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function r(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,d=1;d<b;++d)if(!Array.isArray(a[d])||a[d].length!==
c)return!1;return!0}function a(a){return Object.prototype.toString.call(a)}function d(b){return"[object HTMLCanvasElement]"===a(b)}function h(b){return"[object CanvasRenderingContext2D]"===a(b)}var f=c("./check"),l=c("./values"),B=c("./is-typed-array"),J=c("./is-ndarray"),Y=c("./load-texture"),I=c("./to-half-float"),u=c("./parse-dds"),p=[9984,9986,9985,9987];g.exports=function(c,g,n,A,ba){function N(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=
this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=this.miplevel=0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function S(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=
4352}function pa(a,b){var c,d,h=0,l=0,k=0,m=0,n=0,r=0,t=!1,x=!1,u=!1,w=0,y=[0,0,0,0,0,0],B=0,A=!1;for(c=0;c<b.length;++c){d=b[c];var m=m||d.width<<d.miplevel,n=n||d.height<<d.miplevel,h=h||d.type,l=l||d.format,k=k||d.internalformat,r=r||d.channels,x=x||d.needsPoll,u=u||d.needsListeners,t=t||d.compressed,D=d.miplevel;d=d.target;A=A||0<D;3553===d?w|=1<<D:(d-=34069,y[d]|=1<<D,B|=1<<d)}a.needsPoll=x;a.needsListeners=u;a.width=m;a.height=n;a.format=l;a.internalformat=k;a.type=h;x=A?(m<<1)-1:1;if(3553===
a.target)f(0===B,"pixmap type must not contain cubemap faces"),f(w===x,"missing mip map data");else for(f(63===B,"missing cubemap faces"),c=0;6>c;++c)f(y[c]===x,"missing mip map data");c=0<=p.indexOf(a.minFilter);a.genMipmaps=!A&&(a.genMipmaps||c);A=A||a.genMipmaps;a.minFilter?f(A===c,"min filter inconsistent with mipmap data"):a.minFilter=A?9987:9728;A&&f(m===n&&!(m&m-1)&&!!m,"must be a square power of 2 to support mipmaps");a.genMipmaps&&f(!t,"mipmap generation not supported for compressed textures");
a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;33071===a.wrapS&&33071===a.wrapT||f(!(m&m-1)&&!!m&&!(n&n-1)&&!!n&&!B,"incompatible size for wrap mode, image must be a power of 2");(5126===h&&!g.oes_texture_float_linear||36193===h&&!g.oes_texture_half_float_linear)&&f(9728===this.magFilter&&9728===this.minFilter,"unsupported filter mode for float texture");for(c=0;c<b.length;++c)d=b[c],t=d.miplevel,d.width&&f(d.width<<t===m,"inconsistent width"),d.height&&f(d.height<<t===n,"inconsistent width"),d.channels?
f(d.channels===r,"inconsistent channels"):d.channels=r,d.format?f(d.format===l,"inconsistent format"):d.format=l,d.internalformat?f(d.internalformat===k,"inconsistent internalformat"):d.internalformat=k,d.type?f(d.type===h,"inconsistent type"):d.type=h,d.copy&&f(5121===d.type&&6408===d.internalformat,"incompatible format/type for copyTexImage2D")}function T(a){this.id=y++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=
new S(a);this.pixels=[]}function ca(a,b){function c(a,e){var d=e.mipmap,f;if(Array.isArray(d))for(var q=0;q<d.length;++q)f=new N(a),f.parseFlags(b),f.parseFlags(e),f.parse(d[q],q),h.push(f);else f=new N(a),f.parseFlags(b),f.parse(e,0),h.push(f)}var d;W(a);var g=a.params;S.call(g,a.target);var h=a.pixels;h.length=0;g.parse(b);if(3553===a.target)c(3553,b);else{var l=b.faces||b;if(Array.isArray(l))for(f(6===l.length,"invalid number of faces in cube map"),d=0;6>d;++d)c(34069+d,l[d]);else if("string"!==
typeof l)for(d=0;6>d;++d)c(34069+d,{})}pa(g,h);g.needsListeners&&la(a);g.needsPoll&&(a.pollId=D.length,D.push(a));ja(a)}function ja(a){c.isTexture(a.texture)||(a.texture=c.createTexture());var b=a.target,d=a.unit;0<=d?(c.activeTexture(33984+d),L=d):c.bindTexture(b,a.texture);for(var b=a.pixels,f=a.params,g=0;g<b.length;++g)b[g].upload(f);f.upload();0>d&&((d=aa[L])?c.bindTexture(d.target,d.texture):(a.unit=L,aa[L]=a))}function la(a){function b(c,d,q){var h=u(q);f(h.format in K,"unsupported dds texture format");
h.cube?(f(34067===a.target),f.raise("cube map DDS not yet implemented")):f(3553===a.target);d&&f(1===h.pixels.length,"number of mip levels inconsistent");h.pixels.forEach(function(a){var b=new N(h.cube?a.target:c);b.channels=h.channels;b.compressed=h.compressed;b.type=h.type;b.internalformat=h.format;b.format=K[h.format];b.width=a.width;b.height=a.height;b.miplevel=a.miplevel||d;b.data=a.data;g.push(b)})}function c(){for(var f=0;f<g.length;++f){var q=g[f],h=q.image,l=q.video,k=q.xhr;h&&h.complete?
(q.width=h.naturalWidth,q.height=h.naturalHeight):l&&2<l.readyState?(q.width=l.width,q.height=l.height):k&&4===k.readyState&&(g[f]=g[g.length-1],g.pop(),k.removeEventListener("readystatechange",ja),b(q.target,q.miplevel,k.response))}pa(d,g);ja(a)}var d=a.params,g=a.pixels;g.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){g.forEach(function(a){a.image?
a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function W(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((D[b]=D[D.length-1]).id=b,D.pop(),a.pollId=-1)}function H(a){var b=a.texture;f(b,"must not double destroy texture");var d=a.unit,g=a.target;0<=d&&(c.activeTexture(33984+d),L=d,c.bindTexture(g,null),aa[d]=null);W(a);c.isTexture(b)&&c.deleteTexture(b);a.texture=
null;a.params=null;a.pixels=null;a.refCount=0;delete m[a.id]}var U={"don't care":4352,"dont care":4352,nice:4354,fast:4353},da={repeat:10497,clamp:33071,mirror:33648},ma={nearest:9728,linear:9729},ea=Object.assign({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ma),Z={none:0,browser:37444},ha={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},ka={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,
rgba4:32854,"rgb5 a1":32855,rgb565:36194},Q={};g.ext_srgb&&(ka.srgb=35904,ka.srgba=35906);g.oes_texture_float&&(ha["float"]=5126);g.oes_texture_half_float&&(ha["half float"]=36193);g.webgl_depth_texture&&(Object.assign(ka,{depth:6402,"depth stencil":34041}),Object.assign(ha,{uint16:5123,uint32:5125,"depth stencil":34042}));g.webgl_compressed_texture_s3tc&&Object.assign(Q,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});g.webgl_compressed_texture_atc&&Object.assign(Q,
{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});g.webgl_compressed_texture_pvrtc&&Object.assign(Q,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});g.webgl_compressed_texture_etc1&&(Q["rgb etc1"]=36196);var R=Array.prototype.slice.call(c.getParameter(34467));Object.keys(Q).forEach(function(a){var b=Q[a];0<=R.indexOf(b)&&(ka[a]=b)});var w=Object.keys(ka);n.textureFormats=w;var K=w.reduce(function(a,b){var c=
ka[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});Object.assign(N.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in a&&(f.type(a.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(f.type(a.flipY,"boolean","invalid texture flip"),this.flipY=a.flipY);"alignment"in a&&(f.oneOf(a.alignment,[1,2,4,8],"invalid texture unpack alignment"),
this.unpackAlignment=a.alignment);"colorSpace"in a&&(f.parameter(a.colorSpace,Z,"invalid colorSpace"),this.colorSpace=Z[a.colorSpace]);if("format"in a){var b=a.format;f.parameter(b,ka,"invalid texture format");this.internalformat=ka[b];b in ha&&(this.type=ha[b]);b in Q&&(this.compressed=!0)}"type"in a&&(b=a.type,f.parameter(b,ha,"invalid texture type"),this.type=ha[b]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(f(Array.isArray(a.shape)&&2<=a.shape.length,"shape must be an array"),
b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,f(Array.isArray(b)&&2<=b.length,"invalid stride vector"),this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|
0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(c,l){this.miplevel=l;this.width>>=l;this.height>>=l;var q=c;switch(typeof c){case "string":break;case "object":if(!c)return;this.parseFlags(c);var k=c.data;if("string"===typeof k||k&&(B(k)||b(k)||J(k)||d(k)||h(k)||"[object HTMLImageElement]"===a(k)||"[object HTMLVideoElement]"===a(k)||r(k)))q=c.data;break;case "undefined":return;default:f.raise("invalid pixel data type")}"string"===typeof q&&(q=Y(q,this.crossOrigin));
var k=null,m=!1;this.compressed&&f(q instanceof Uint8Array||"[object XMLHttpRequest]"===a(q),"compressed texture data must be stored in a uint8array");if(null!==q)if(B(q))this.data=q;else if(b(q))k=q,m=!0;else if(J(q)){Array.isArray(q.data)?(k=q.data,m=!0):this.data=q.data;var n=q.shape;this.width=n[0];this.height=n[1];this.channels=3===n.length?n[2]:1;n=q.stride;this.strideX=q.stride[0];this.strideY=q.stride[1];this.strideC=3===n.length?q.stride[2]:1;this.offset=q.offset;this.needsTranspose=!0}else if(d(q)||
h(q))d(q)?this.canvas=q:this.canvas=q.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===a(q))this.image=q,q.complete?(this.width=q.naturalWidth,this.height=q.naturalHeight):(this.width=this.width||q.naturalWidth,this.height=this.height||q.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();else if("[object HTMLVideoElement]"===a(q))this.video=q,1<q.readyState?(this.width=q.width,this.height=q.height):(this.width=
this.width||q.width,this.height=this.height||q.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===a(q))this.xhr=q,this.needsListeners=!0;else if(r(q)){var m=q.length,n=q[0].length,p=1,t,u,w,y;if(Array.isArray(q[0][0]))for(p=q[0][0].length,f(0<=p&&4>=p,"invalid number of channels for image data"),k=Array(m*n*p),u=y=0;u<n;++u)for(t=0;t<m;++t)for(w=0;w<p;++w)k[y++]=q[t][u][w];else for(k=Array(m*n),u=y=0;u<n;++u)for(t=0;t<m;++t)k[y++]=q[t][u];
this.width=m;this.height=n;this.channels=p;m=!0}else c.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||ba.width)|0,this.height=(this.height||ba.height)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=[6409,6410,6407,6408][(this.channels=this.channels||4)-1],f(this.internalformat,
"invalid number of channels"));n=this.internalformat;if(6402===n||34041===n)f(g.webgl_depth_texture,"depth/stencil texture not supported"),6402===n&&f(5123===this.type||5125,"depth texture type must be uint16 or uint32"),34041===n&&f(34042===this.type,"depth stencil texture format must match type"),f(!this.data&&!k&&!this.image&&!this.video&&!this.canvas,"depth/stencil textures are for rendering only");q=this.format=K[n];if(!this.channels)switch(q){case 6409:case 6406:case 6402:this.channels=1;break;
case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}q=this.type;5126===q?f(g.oes_texture_float,"float texture not supported"):36193===q?f(g.oes_texture_half_float,"half float texture not supported"):q||(q=6402===n?5125:5121);this.type=q;if(m)switch(q){case 5121:this.data=new Uint8Array(k);break;case 5123:this.data=new Uint16Array(k);break;case 5125:this.data=new Uint32Array(k);break;case 5126:this.data=new Float32Array(k);break;case 36193:this.data=I(k);
break;case 33635:case 32820:case 32819:case 34042:f.raise("unsupported format for automatic conversion");break;default:f.raise("unsupported type conversion")}if(this.data){if(this.needsTranspose){k=this.data;m=this.width;n=this.height;p=this.channels;t=this.strideX;u=this.strideY;w=this.strideC;y=this.offset;for(var x=new k.constructor(m*n*p),A=0,D=0;D<n;++D)for(var F=0;F<m;++F)for(var H=0;H<p;++H)x[A++]=k[u*D+t*F+w*H+y];this.data=x}switch(q){case 5121:f(this.data instanceof Uint8Array||this.data instanceof
Uint8ClampedArray,"incompatible pixel type");break;case 33635:case 32820:case 32819:case 5123:case 36193:f(this.data instanceof Uint16Array,"incompatible pixel type");break;case 5125:f(this.data instanceof Uint32Array,"incompatible pixel type");break;case 5126:f(this.data instanceof Float32Array,"incompatible pixel type");break;default:f.raise("bad or missing pixel type")}}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=
!1},upload:function(a){c.pixelStorei(37440,this.flipY);c.pixelStorei(37441,this.premultiplyAlpha);c.pixelStorei(37443,this.colorSpace);c.pixelStorei(3317,this.unpackAlignment);var b=this.target,d=this.miplevel,f=this.image,g=this.canvas,h=this.video,l=this.data,n=this.internalformat,m=this.format,p=this.type,r=this.width||Math.max(1,a.width>>d);a=this.height||Math.max(1,a.height>>d);h&&2<h.readyState?c.texImage2D(b,d,m,m,p,h):f&&f.complete?c.texImage2D(b,d,m,m,p,f):g?c.texImage2D(b,d,m,m,p,g):this.compressed?
c.compressedTexImage2D(b,d,n,r,a,0,l):this.copy?(A(),c.copyTexImage2D(b,d,m,this.x,this.y,r,a,0)):l?c.texImage2D(b,d,m,r,a,0,m,p,l):c.texImage2D(b,d,m,r||1,a||1,0,m,p,null)}});Object.assign(S.prototype,{parse:function(a){if("object"===typeof a&&a){if("min"in a){var b=a.min;f.parameter(b,ea);this.minFilter=ea[b]}"mag"in a&&(b=a.mag,f.parameter(b,ma),this.magFilter=ma[b]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var d=a.wrap;"string"===typeof d?(f.parameter(d,da),b=c=da[d]):Array.isArray(d)&&(f.parameter(d[0],
da),f.parameter(d[1],da),b=da[d[0]],c=da[d[1]])}else"wrapS"in a&&(b=a.wrapS,f.parameter(b,da),b=da[b]),"wrapT"in a&&(c=a.wrapT,f.parameter(c,da),c=da[c]);this.wrapS=b;this.wrapT=c;"anisotropic"in a&&(b=a.anisotropic,f("number"===typeof b&&1<=b&&b<=n.maxAnisotropic,"aniso samples must be between 1 and "),this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":f.parameter(a,U,"invalid mipmap hint");this.mipmapHint=U[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=
!!a;break;case "object":break;default:f.raise("invalid mipmap type")}}},upload:function(){var a=this.target;c.texParameteri(a,10241,this.minFilter);c.texParameteri(a,10240,this.magFilter);c.texParameteri(a,10242,this.wrapS);c.texParameteri(a,10243,this.wrapT);g.ext_texture_filter_anisotropic&&c.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(c.hint(33170,this.mipmapHint),c.generateMipmap(a))}});var L=0,y=0,m={},D=[],t=n.maxTextureUnits,aa=Array(t).map(function(){return null});Object.assign(T.prototype,
{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<t;++b){var d=aa[b];if(d){if(0<d.bindCount)continue;d.unit=-1}aa[b]=this;a=b;break}a>=t&&f.raise("insufficient number of texture units");this.unit=a;c.activeTexture(33984+a);c.bindTexture(this.target,this.texture);L=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&H(this)}});return{create:function(a,b){function c(a,e,f,g,h,k){var l=a||{};34067===b&&6===arguments.length&&(l=[a,e,f,g,h,k]);
ca(d,l);c.width=d.params.width;c.height=d.params.height;return c}var d=new T(b);m[d.id]=d;c(a);Object.assign(c,{_reglType:"texture",_texture:d,destroy:function(){d.decRef()}});return c},refresh:function(){l(m).forEach(ja);for(var a=0;a<t;++a)aa[a]=null;L=0;c.activeTexture(33984)},clear:function(){for(var a=0;a<t;++a)c.activeTexture(33984+a),c.bindTexture(3553,null),aa[a]=null;c.activeTexture(33984);L=0;l(m).forEach(H)},poll:function(){D.forEach(ja)},getTexture:function(a){return null}}}},{"./check":4,
"./is-ndarray":17,"./is-typed-array":18,"./load-texture":20,"./parse-dds":21,"./to-half-float":29,"./values":31}],29:[function(c,g,n){g.exports=function(b){for(var c=new Float32Array(b),c=new Uint32Array(c.buffer),a=new Uint16Array(b.length),d=0;d<b.length;++d)if(isNaN(b[d]))a[d]=65535;else if(Infinity===b[d])a[d]=31744;else if(-Infinity===b[d])a[d]=64512;else{var g=c[d],f=g>>>31<<15,l=(g<<1>>>24)-127,g=g>>13&1023;a[d]=-24>l?f:-14>l?f+(g+1024>>-14-l):15<l?f+31744:f+(l+15<<10)+g}return a}},{}],30:[function(c,
g,n){g.exports=function(){var b={};return{uniforms:b,def:function(c){c in b||(b[c]=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]])}}}},{}],31:[function(c,g,n){g.exports=function(b){return Object.keys(b).map(function(c){return b[c]})}},{}],32:[function(c,g,n){var b=c("./lib/check"),r=c("./lib/context"),a=c("./lib/extension"),d=c("./lib/limits"),h=c("./lib/buffer"),f=c("./lib/elements"),l=c("./lib/texture"),B=c("./lib/renderbuffer"),J=c("./lib/framebuffer"),Y=c("./lib/uniform"),I=c("./lib/attribute"),u=c("./lib/shader"),
p=c("./lib/draw"),k=c("./lib/state"),v=c("./lib/compile"),F=c("./lib/read"),A=c("./lib/dynamic"),ba=c("./lib/raf"),N=c("./lib/clock");g.exports=function(){function c(){G=ba.next(c);m.count+=1;if(m.width!==H.drawingBufferWidth||m.height!==H.drawingBufferHeight)m.width=H.drawingBufferWidth,m.height=H.drawingBufferHeight,D.notifyViewportChanged();var a=N();m.dt=a-m.t;m.t=a;K.poll();for(var b=0;b<e.length;++b)(0,e[b])(m.count,m.t,m.dt);m.renderTime=N()-a}function g(){G&&(ba.cancel(c),G=0)}function n(a){g();
a.preventDefault();if(U.onContextLost)U.onContextLost()}function ca(a){H.getError();da.refresh();Z.refresh();K.refresh();L.refresh();y.refresh();R.refresh();D.refresh();if(U.onContextRestored)U.onContextRestored();c()}function ja(a){function c(a){var b={},e={};Object.keys(a).forEach(function(c){var f=a[c];A.isDynamic(f)?(d=!0,e[c]=A.unbox(f,c)):b[c]=f});return{dynamic:e,"static":b}}b(!!a,"invalid args to regl({...})");b.type(a,"object","invalid args to regl({...})");var d=!1,e=c(a.uniforms||{}),f=
c(a.attributes||{});a=c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=Object.assign({},a);delete c.uniforms;delete c.attributes;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var e=t.command(a["static"],e["static"],f["static"],a.dynamic,e.dynamic,f.dynamic,d),g=e.draw,h=e.batch,k=e.scope,l=[];return function(a,b){if("number"===typeof a){for(var c=a|0;l.length<c;)l.push(null);
return h(a|0,l)}return Array.isArray(a)?h(a.length,a):"function"===typeof a?k(null,a):"function"===typeof b?k(a,b):g(a)}}function la(){y.poll();D.poll()}var W=r(Array.prototype.slice.call(arguments)),H=W.gl,U=W.options,da=a(H),W=da.extensions,ma={width:H.drawingBufferWidth,height:H.drawingBufferHeight},ea=d(H,W),Z=h(H),ha=f(H,W,Z),ka=Y(),Q=I(H,W,ea,Z),R=u(H,Q,ka,function(a){return t.draw(a)}),w=p(H,W,Z),K=l(H,W,ea,la,ma),L=B(H,W,ea),y=J(H,W,ea,K,L),m={count:0,start:N(),dt:0,t:N(),renderTime:0,width:H.drawingBufferWidth,
height:H.drawingBufferHeight,pixelRatio:U.pixelRatio},D=k(H,y,ma),ma=F(H,la,ma),t=v(H,W,ea,Z,ha,K,y,D,ka,Q,R,w,m,la),aa=H.canvas,e=[],G=0;aa&&(aa.addEventListener("webglcontextlost",n,!1),aa.addEventListener("webglcontextrestored",ca,!1));return Object.assign(ja,{clear:function(a){var c=0;la();var d=a.color;d&&(H.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in a&&(H.clearDepth(+a.depth),c|=256);"stencil"in a&&(H.clearStencil(a.stencil|0),c|=1024);b(!!c,"called regl.clear with no buffer specified");
H.clear(c)},prop:A.define,draw:ja({}),elements:function(a){return ha.create(a)},buffer:function(a){return Z.create(a,34962)},texture:function(a){return K.create(a,3553)},cube:function(a){return 6===arguments.length?K.create(Array.prototype.slice.call(arguments),34067):K.create(a,34067)},renderbuffer:function(a){return L.create(a)},framebuffer:function(a){return y.create(a)},framebufferCube:function(a){b.raise("framebuffer cube not yet implemented")},frame:function(a){e.push(a);!G&&0<e.length&&c();
return{cancel:function(){var b=e.find(function(b){return b===a});0>b||(e.splice(b,1),0>=e.length&&g())}}},stats:m,limits:ea,read:ma,destroy:function(){g();aa&&(aa.removeEventListener("webglcontextlost",n),aa.removeEventListener("webglcontextrestored",ca));R.clear();y.clear();L.clear();K.clear();Z.clear();if(U.onDestroy)U.onDestroy()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/check":4,"./lib/clock":5,"./lib/compile":7,"./lib/context":11,"./lib/draw":12,"./lib/dynamic":13,"./lib/elements":14,
"./lib/extension":15,"./lib/framebuffer":16,"./lib/limits":19,"./lib/raf":22,"./lib/read":23,"./lib/renderbuffer":24,"./lib/shader":25,"./lib/state":27,"./lib/texture":28,"./lib/uniform":30}]},{},[1]);
