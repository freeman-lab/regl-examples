(function e$$0(m,r,f){function e(b,c){if(!r[b]){if(!m[b]){var h="function"==typeof require&&require;if(!c&&h)return h(b,!0);if(u)return u(b,!0);h=Error("Cannot find module '"+b+"'");throw h.code="MODULE_NOT_FOUND",h;}h=r[b]={exports:{}};m[b][0].call(h.exports,function(c){var f=m[b][1][c];return e(f?f:c)},h,h.exports,e$$0,m,r,f)}return r[b].exports}for(var u="function"==typeof require&&require,h=0;h<f.length;h++)e(f[h]);return e})({1:[function(l,m,r){var f=l("../regl")(),e=l("parse-dds");l("resl")({manifest:{diffuse:{type:"binary",
src:"assets/alpine_cliff_a.dds",parser:function(u){var h=e(u),b=h.images[0];return f.texture({format:"rgba s3tc "+h.format,shape:h.shape,mag:"linear",data:new Uint8Array(u,b.offset,b.length)})}},specular:{type:"image",src:"assets/alpine_cliff_a_spec.png",parser:function(e){return f.texture({mag:"linear",data:e})}},normals:{type:"image",src:"assets/alpine_cliff_a_norm.png",parser:function(e){return f.texture({mag:"linear",data:e})}}},onDone:function(e){var h=f({frag:"\n      precision mediump float;\n      uniform sampler2D specular, normals, diffuse;\n      varying vec3 lightDir, eyeDir;\n      varying vec2 uv;\n      void main () {\n        float d = length(lightDir);\n        vec3 L = normalize(lightDir);\n        vec3 E = normalize(eyeDir);\n        vec3 N = normalize(2.0 * texture2D(normals, uv).rgb - 1.0);\n        N = vec3(-N.x, N.yz);\n        vec3 D = texture2D(diffuse, uv).rgb;\n        vec3 kD = D * (0.01 +\n          max(0.0, dot(L, N) * (0.6 + 0.8 / d) ));\n        vec3 S = texture2D(specular, uv).rgb;\n        vec3 kS = 2.0 * pow(max(0.0, dot(normalize(N + L), -E)), 10.0) * S;\n        gl_FragColor = vec4(kD + kS, 1);\n      }",
vert:"\n      precision mediump float;\n      attribute vec2 position;\n      uniform vec2 lightPosition;\n      varying vec3 lightDir, eyeDir;\n      varying vec2 uv;\n      void main () {\n        vec2 P = 1.0 - 2.0 * position;\n        uv = vec2(position.x, 1.0 - position.y);\n        eyeDir = -vec3(P, 1);\n        lightDir = vec3(lightPosition - P, 1);\n        gl_Position = vec4(P, 0, 1);\n      }",attributes:{position:[-2,0,0,-2,2,2]},uniforms:{specular:e.specular,normals:e.normals,diffuse:e.diffuse,
lightPosition:function(b){b=.025*b.count;return[2*Math.cos(b),2*Math.sin(b)]}},count:3});f.frame(function(){h()})}})},{"../regl":31,"parse-dds":30,resl:32}],2:[function(l,m,r){function f(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}m.exports=function(e,u,h,b,c){e=h.maxAttributes;u=Array(e);for(h=0;h<e;++h)u[h]=new f;return{Record:f,scope:{},state:u}}},{}],3:[function(l,m,r){function f(c){return ca[Object.prototype.toString.call(c)]|
0}function e(c,b){for(var f=0;f<b.length;++f)c[f]=b[f]}function u(c,b,f,e,h,a,u){for(var q=0,L=0;L<f;++L)for(var w=0;w<e;++w)c[q++]=b[h*L+a*w+u]}function h(c,b,f){for(var e=0,h=0;h<b.length;++h)for(var a=b[h],u=0;u<f;++u)c[e++]=a[u]}var b=l("./util/is-typed-array"),c=l("./util/is-ndarray"),q=l("./util/values"),D=l("./util/pool"),ca=l("./constants/arraytypes.json"),E=l("./constants/dtypes.json"),C=l("./constants/usage.json");m.exports=function(n){function v(c){this.id=a++;this.buffer=n.createBuffer();
this.type=c;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121}function y(c,b,f){c.byteLength=b.byteLength;n.bufferData(c.type,b,f)}function l(a,w,p,n,q){a.usage=p;if(Array.isArray(w))a.dtype=n||5126,0<w.length&&(Array.isArray(w[0])?(a.dimension=w[0].length,n=D.allocType(a.dtype,w.length*a.dimension),h(n,w,a.dimension),y(a,n,p),D.freeType(n)):"number"===typeof w[0]?(a.dimension=q,n=D.allocType(a.dtype,w.length),e(n,w),y(a,n,p),D.freeType(n)):b(w[0])&&(a.dimension=w[0].length,a.dtype=
n||f(w[0])||5126,n=D.allocType(a.dtype,w.length*a.dimension),h(n,w,a.dimension),y(a,n,p),D.freeType(n)));else if(b(w))a.dtype=n||f(w),a.dimension=q,y(a,w,p);else if(c(w)){var z=w.shape,v=w.stride;q=w.offset;var H=0,R=0,B=0,I=0;1===z.length?(H=z[0],R=1,B=v[0],I=0):2===z.length&&(H=z[0],R=z[1],B=v[0],I=v[1]);a.dtype=n||f(w.data)||5126;a.dimension=R;n=D.allocType(a.dtype,H*R);u(n,w.data,H,R,B,I,q);y(a,n,p);D.freeType(n)}}function p(c){var b=c.buffer;n.isBuffer(b)&&n.deleteBuffer(b);c.buffer=null;delete O[c.id]}
var a=0,O={};v.prototype.bind=function(){n.bindBuffer(this.type,this.buffer)};var m=[];return{create:function(a,w,q){function y(a){var f=35044,e=null,h=0,w=0,p=1;Array.isArray(a)||b(a)||c(a)?e=a:"number"===typeof a?h=a|0:a&&("data"in a&&(e=a.data),"usage"in a&&(f=C[a.usage]),"type"in a&&(w=E[a.type]),"dimension"in a&&(p=a.dimension|0),"length"in a&&(h=a.length|0));m.bind();e?l(m,e,f,w,p):(n.bufferData(m.type,h,f),m.dtype=w||5121,m.usage=f,m.dimension=p,m.byteLength=h);return y}var m=new v(w);O[m.id]=
m;q||y(a);y._reglType="buffer";y._buffer=m;y.subdata=function(a,w){var p=(w||0)|0;m.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var q=D.allocType(m.dtype,a.length);e(q,a);n.bufferSubData(m.type,p,q);D.freeType(q)}else if(Array.isArray(a[0])||b(a[0])){var q=a[0].length,v=D.allocType(m.dtype,a.length*q);h(v,a,q);n.bufferSubData(m.type,p,v);D.freeType(v)}}else if(b(a))n.bufferSubData(m.type,p,a);else if(c(a)){var I=a.shape,l=a.stride,B=v=q=0,O=0;1===I.length?(q=I[0],v=1,B=l[0],
O=0):2===I.length&&(q=I[0],v=I[1],B=l[0],O=l[1]);I=Array.isArray(a.data)?m.dtype:f(a.data);I=D.allocType(I,q*v);u(I,a.data,q,v,B,O,a.offset);n.bufferSubData(m.type,p,I);D.freeType(I)}return y};y.destroy=function(){p(m)};return y},createStream:function(a,c){var b=m.pop();b||(b=new v(a),b.buffer=n.createBuffer());b.bind();l(b,c,35040,0,1);return b},destroyStream:function(a){m.push(a)},clear:function(){q(O).forEach(p)},getBuffer:function(a){return a&&a._buffer instanceof v?a._buffer:null},_initBuffer:l}}},
{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/pool":25,"./util/values":28}],4:[function(l,m,r){m.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(l,
m,r){m.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(l,m,r){m.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(l,m,r){m.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(l,m,r){function f(a){return Array.isArray(a)||ca(a)||E(a)}function e(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:
a<b?-1:1})}function u(a,b,c,f){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=f}function h(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function b(a){return new u(!1,!1,!1,a)}function c(a,b){var c=a.type;return 0===c?(c=a.data.length,new u(!0,1<=c,2<=c,b)):new u(3===c,2===c,1===c,b)}var q=l("./util/codegen"),D=l("./util/loop"),ca=l("./util/is-typed-array"),E=l("./util/is-ndarray"),C=l("./constants/primitives.json"),n=l("./constants/dtypes.json"),v=["x","y","z","w"],y={0:0,1:1,zero:0,
one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},B={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},p={0:0,zero:0,keep:7680,
replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},a={cw:2304,ccw:2305},O=new u(!1,!1,!1,function(){});m.exports=function(l,m,w,E,F,r,z,da,H,R,V,I,ea){function N(d){return d.replace(".","_")}function J(d,a,c){var b=N(d);t.push(d);x[b]=g[b]=!!c;ia[b]=a}function K(d,a,b){var c=N(d);t.push(d);Array.isArray(b)?(g[c]=b.slice(),x[c]=b.slice()):g[c]=x[c]=b;ja[c]=a}function fa(){var d=q(),a=d.link,b=d.global;d.id=Ga++;d.batchId="0";var c=a(Ea),oa=d.shared=
{props:"a0"};Object.keys(Ea).forEach(function(k){oa[k]=b.def(c,".",k)});var A=d.next={},f=d.current={};Object.keys(ja).forEach(function(k){Array.isArray(g[k])&&(A[k]=b.def(oa.next,".",k),f[k]=b.def(oa.current,".",k))});var k=d.constants={};Object.keys(ya).forEach(function(d){k[d]=b.def(JSON.stringify(ya[d]))});d.invoke=function(k,g){switch(g.type){case 0:var b=["this",oa.context,oa.props,d.batchId];return k.def(a(g.data),".call(",b.slice(0,Math.max(g.data.length+1,4)),")");case 1:return k.def(oa.props,
g.data);case 2:return k.def(oa.context,g.data);case 3:return k.def("this",g.data)}};d.attribCache={};var Ca={};d.scopeAttrib=function(k){k=m.id(k);if(k in Ca)return Ca[k];var d=R.scope[k];d||(d=R.scope[k]=new pa);return Ca[k]=a(d)};return d}function aa(d){var g=d["static"];d=d.dynamic;if("framebuffer"in g){var a=g.framebuffer;return a?(a=da.getFramebuffer(a),b(function(d,g){var b=d.link(a),k=d.shared;g.set(k.framebuffer,".next",b);k=k.context;g.set(k,".framebufferWidth",b+".width");g.set(k,".framebufferHeight",
b+".height");return b})):b(function(d,g){var a=d.shared;g.set(a.framebuffer,".next","null");a=a.context;g.set(a,".framebufferWidth",a+".drawingBufferWidth");g.set(a,".framebufferHeight",a+".drawingBufferHeight");return null})}if("framebuffer"in d){var f=d.framebuffer;return c(f,function(d,g){var a=d.invoke(g,f),k=d.shared,b=k.framebuffer,a=g.def(b,".getFramebuffer(",a,")");g.set(b,".next",a);k=k.context;g.set(k,".framebufferWidth",a+"?"+a+".width:"+k+".drawingBufferWidth");g.set(k,".framebufferHeight",
a+"?"+a+".height:"+k+".drawingBufferHeight");return a})}return null}function ka(d,g){function a(k){if(k in b){var d=b[k];k=!0;var Fa=d.x|0,A=d.y|0,e,xa;"w"in d?e=d.w|0:k=!1;"h"in d?xa=d.h|0:k=!1;return new u(k&&g&&g.thisDep,k&&g&&g.contextDep,k&&g&&g.propDep,function(k,g){var a=k.shared.context,b=e;"w"in d||(b=g.def(a,".","framebufferWidth","-",Fa));var c=xa;"h"in d||(c=g.def(a,".","framebufferHeight","-",A));return[Fa,A,b,c]})}if(k in f){var h=f[k];k=c(h,function(k,d){var g=k.invoke(d,h),a=k.shared.context,
b=d.def(g,".x|0"),c=d.def(g,".y|0"),G=d.def('"w" in ',g,"?",g,".w|0:","(",a,".","framebufferWidth","-",b,")"),g=d.def('"h" in ',g,"?",g,".h|0:","(",a,".","framebufferHeight","-",c,")");return[b,c,G,g]});g&&(k.thisDep=k.thisDep||g.thisDep,k.contextDep=k.contextDep||g.contextDep,k.propDep=k.propDep||g.prpoDep);return k}return g?new u(g.thisDep,g.contextDep,g.propDep,function(k,d){var g=k.shared.context;return[0,0,d.def(g,".","framebufferWidth"),d.def(g,".","framebufferHeight")]}):null}var b=d["static"],
f=d.dynamic,A=a("viewport");if(A)var e=A,A=new u(A.thisDep,A.contextDep,A.propDep,function(k,d){var g=e.append(k,d),a=k.shared.context;d.set(a,".viewportWidth",g[2]);d.set(a,".viewportHeight",g[3]);return g});return{viewport:A,scissor_box:a("scissor.box")}}function la(d){function g(k){if(k in a){var d=m.id(a[k]);k=b(function(){return d});k.id=d;return k}if(k in f){var G=f[k];return c(G,function(k,d){var g=k.invoke(d,G);return d.def(k.shared.strings,".id(",g,")")})}return null}var a=d["static"],f=
d.dynamic,e=g("frag"),A=g("vert"),n=null;h(e)&&h(A)?(n=V.program(A.id,e.id),d=b(function(k,d){return k.link(n)})):d=new u(e&&e.thisDep||A&&A.thisDep,e&&e.contextDep||A&&A.contextDep,e&&e.propDep||A&&A.propDep,function(k,d){var g=k.shared.shader,a;a=e?e.append(k,d):d.def(g,".","frag");var b;b=A?A.append(k,d):d.def(g,".","vert");return d.def(g+".program("+b+","+a+")")});return{frag:e,vert:A,progVar:d,program:n}}function sa(d){function g(d,k){if(d in a){var G=a[d]|0;return b(function(d,g){k&&(d.OFFSET=
G);return G})}if(d in e){var f=e[d];return c(f,function(d,g){var a=d.invoke(g,f);k&&(d.OFFSET=a);return a})}return k&&n?b(function(k,d){k.OFFSET="0";return 0}):null}var a=d["static"],e=d.dynamic,n=function(){if("elements"in a){var d=a.elements;f(d)?d=r.getElements(r.create(d)):d&&(d=r.getElements(d));var k=b(function(k,g){if(d){var a=k.link(d);return k.ELEMENTS=a}return k.ELEMENTS=null});k.value=d;return k}if("elements"in e){var g=e.elements;return c(g,function(k,d){var a=k.shared,b=a.isBufferArgs,
a=a.elements,c=k.invoke(d,g),G=d.def("null"),b=d.def(b,"(",c,")"),c=k.cond(b).then(G,"=",a,".createStream(",c,");")["else"](G,"=",a,".getElements(",c,");");d.entry(c);d.exit(k.cond(b).then(a,".destroyStream(",G,");"));return k.ELEMENTS=G})}return null}(),A=g("offset",!0);return{elements:n,primitive:function(){if("primitive"in a){var d=a.primitive;return b(function(k,g){return C[d]})}if("primitive"in e){var k=e.primitive;return c(k,function(d,g){var a=d.constants.primTypes,b=d.invoke(g,k);return g.def(a,
"[",b,"]")})}return n?h(n)?n.value?b(function(k,d){return d.def(k.ELEMENTS,".primType")}):b(function(){return 4}):new u(n.thisDep,n.contextDep,n.propDep,function(k,d){var g=k.ELEMENTS;return d.def(g,"?",g,".primType:",4)}):null}(),count:function(){if("count"in a){var d=a.count|0;return b(function(){return d})}if("count"in e){var k=e.count;return c(k,function(d,g){return d.invoke(g,k)})}return n?h(n)?n?A?new u(A.thisDep,A.contextDep,A.propDep,function(k,d){return d.def(k.ELEMENTS,".vertCount-",k.OFFSET)}):
b(function(k,d){return d.def(k.ELEMENTS,".vertCount")}):b(function(){return-1}):new u(n.thisDep||A.thisDep,n.contextDep||A.contextDep,n.propDep||A.propDep,function(k,d){var g=k.ELEMENTS;return k.OFFSET?d.def(g,"?",g,".vertCount-",k.OFFSET,":-1"):d.def(g,"?",g,".vertCount:-1")}):null}(),instances:g("instances",!1),offset:A}}function ga(d){var g=d["static"],f=d.dynamic,e={};t.forEach(function(d){function A(k,a){if(d in g){var A=k(g[d]);e[n]=b(function(){return A})}else if(d in f){var h=f[d];e[n]=c(h,
function(k,d){return a(k,d,k.invoke(d,h))})}}var n=N(d);switch(d){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return A(function(k){return k},function(k,d,g){return g});case "depth.func":return A(function(k){return B[k]},function(k,d,g){return d.def(k.constants.compareFuncs,"[",g,"]")});case "depth.range":return A(function(k){return k},function(k,
d,g){k=d.def("+",g,"[0]");d=d.def("+",g,"[1]");return[k,d]});case "blend.func":return A(function(d){return[y["srcRGB"in d?d.srcRGB:d.src],y["dstRGB"in d?d.dstRGB:d.dst],y["srcAlpha"in d?d.srcAlpha:d.src],y["dstAlpha"in d?d.dstAlpha:d.dst]]},function(d,g,a){function b(d,k){var G=g.def('"',d,k,'" in ',a,"?",a,".",d,k,":",a,".",d);return g.def(c,"[",G,"]")}var c=d.constants.blendFuncs;d=b("src","RGB");var G=b("src","Alpha"),f=b("dst","RGB"),e=b("dst","Alpha");return[d,f,G,e]});case "blend.equation":return A(function(d){if("string"===
typeof d)return[W[d],W[d]];if("object"===typeof d)return[W[d.rgb],W[d.alpha]]},function(d,g,a){var b=d.constants.blendEquations,c=g.def(),G=g.def();d=d.cond("typeof ",a,'==="string"');d.then(c,"=",G,"=",b,"[",a,"];");d["else"](c,"=",b,"[",a,".rgb];",G,"=",b,"[",a,".alpha];");g(d);return[c,G]});case "blend.color":return A(function(d){return D(4,function(g){return+d[g]})},function(d,g,a){return D(4,function(d){return g.def("+",a,"[",d,"]")})});case "stencil.mask":return A(function(d){return d|0},function(d,
g,a){return g.def(a,"|0")});case "stencil.func":return A(function(d){return[B[d.cmp||"keep"],d.ref||0,"mask"in d?d.mask:-1]},function(d,g,a){d=g.def('"cmp" in ',a,"?",d.constants.compareFuncs,"[",a,".cmp]",":",7680);var b=g.def(a,".ref|0");g=g.def('"mask" in ',a,"?",a,".mask|0:-1");return[d,b,g]});case "stencil.opFront":case "stencil.opBack":return A(function(g){return["stencil.opBack"===d?1029:1028,p[g.fail||"keep"],p[g.zfail||"keep"],p[g.pass||"keep"]]},function(g,a,b){function c(d){return a.def('"',
d,'" in ',b,"?",G,"[",b,".",d,"]:",7680)}var G=g.constants.stencilOps;return["stencil.opBack"===d?1029:1028,c("fail"),c("zfail"),c("pass")]});case "polygonOffset.offset":return A(function(d){return[d.factor|0,d.units|0]},function(d,g,a){d=g.def(a,".factor|0");g=g.def(a,".units|0");return[d,g]});case "cull.face":return A(function(d){var g=0;"front"===d?g=1028:"back"===d&&(g=1029);return g},function(d,g,a){return g.def(a,'==="front"?',1028,":",1029)});case "lineWidth":return A(function(d){return d},
function(d,g,a){return a});case "frontFace":return A(function(d){return a[d]},function(d,g,a){return g.def(a+'==="cw"?2304:2305')});case "colorMask":return A(function(d){return d.map(function(d){return!!d})},function(d,g,a){return D(4,function(d){return"!!"+a+"["+d+"]"})});case "sample.coverage":return A(function(d){return["value"in d?d.value:1,!!d.invert]},function(d,g,a){d=g.def('"value" in ',a,"?+",a,".value:1");g=g.def("!!",a,".invert");return[d,g]})}});return e}function ma(d){var g=d["static"],
a=d.dynamic,f={};Object.keys(g).forEach(function(d){var a=g[d],c;if("number"===typeof a||"boolean"===typeof a)c=b(function(){return a});else if("function"===typeof a&&("texture2d"===a._reglType||"textureCube"===a._reglTYpe))c=b(function(d){return d.link(a)});else if(Array.isArray(a)||ca(a))c=b(function(d){return d.global.def("[",D(a.length,function(d){return a[d]}),"]")});c.value=a;f[d]=c});Object.keys(a).forEach(function(d){var g=a[d];f[d]=c(g,function(d,a){return d.invoke(a,g)})});return f}function S(d){var g=
d["static"],a=d.dynamic,e={};Object.keys(g).forEach(function(d){var a=g[d],c=m.id(d),k=new pa;if(f(a))k.state=1,k.buffer=F.getBuffer(F.create(a,34962,!1)),k.type=k.buffer.dtype;else{var h=F.getBuffer(a);if(h)k.state=1,k.buffer=h,k.type=h.dtype;else if(a.constant){var t=a.constant;k.state=2;"number"===typeof t?k.x=t:v.forEach(function(d,g){g<t.length&&(k[d]=t[g])})}else{var h=F.getBuffer(a.buffer),x=a.offset|0,p=a.stride|0,xa=a.size|0,q=!!a.normalized,u=0;"type"in a&&(u=n[a.type]);a=a.divisor|0;k.buffer=
h;k.state=1;k.size=xa;k.normalized=q;k.type=u||h.dtype;k.offset=x;k.stride=p;k.divisor=a}}e[d]=b(function(d,g){var a=d.attribCache;if(c in a)return a[c];var b={isStream:!1};Object.keys(k).forEach(function(d){b[d]=k[d]});k.buffer&&(b.buffer=d.link(k.buffer));return a[c]=b})});Object.keys(a).forEach(function(d){var g=a[d];e[d]=c(g,function(d,a){function b(d){a(h[d],"=",c,".",d,"|0;")}var c=d.invoke(a,g),G=d.shared,f=G.isBufferArgs,e=G.buffer,h={isStream:a.def(!1)},n=new pa;n.state=1;Object.keys(n).forEach(function(d){h[d]=
a.def(""+n[d])});var t=h.buffer,x=h.type;a("if(",f,"(",c,")){",h.isStream,"=true;",t,"=",e,".createStream(",34962,",",c,");",x,"=",t,".dtype;","}else{",t,"=",e,".getBuffer(",c,");","if(",t,"){",x,"=",t,".dtype;","}else if(",c,".constant){",h.state,"=",2,";",v.map(function(d,g){return h[d]+"="+c+".length>="+g+"?"+c+"["+g+"]:0;"}).join(""),"}else{",t,"=",e,".getBuffer(",c,".buffer);",x,'="type" in ',c,"?",G.glTypes,"[",c,".type]:",t,".dtype;",h.normalized,"=!!",c,".normalized;");b("size");b("offset");
b("stride");b("divisor");a("}}");return h})});return e}function P(d){var g=d["static"],a=d.dynamic,e={};Object.keys(g).forEach(function(d){var a=g[d];e[d]=b(function(d,g){return"number"===typeof a||"boolean"===typeof a?""+a:d.link(a)})});Object.keys(a).forEach(function(d){var g=a[d];e[d]=c(g,function(d,a){return d.invoke(a,g)})});return e}function T(d,g,a){var b=d.shared.context,c=d.scope();Object.keys(a).forEach(function(e){g.save(b,"."+e);c(b,".",e,"=",a[e].append(d,g),";")});g(c)}function qa(d,
g,a){var b=d.shared,c=b.gl,e=b.framebuffer,f;ba&&(f=g.def(b.extensions,".webgl_draw_buffers"));var k=d.constants,b=k.drawBuffer,k=k.backBuffer;d=a?a.append(d,g):g.def(e,".next");g("if(",e,".dirty||",d,"!==",e,".cur){","if(",d,"){",c,".bindFramebuffer(",36160,",",d,".framebuffer);");ba&&g(f,".drawBuffersWEBGL(",b,"[",d,".colorAttachments.length]);");g("}else{",c,".bindFramebuffer(",36160,",null);");ba&&g(f,".drawBuffersWEBGL(",k,");");g("}",e,".cur=",d,";",e,".dirty=false;","}")}function na(d,a,b){var c=
d.shared,e=c.gl,f=d.current,h=d.next,k=c.current,n=c.next,x=d.cond(k,".dirty");t.forEach(function(a){a=N(a);if(!(a in b.state)){var c,G;if(a in h){c=h[a];G=f[a];var t=D(g[a].length,function(d){return x.def(c,"[",d,"]")});x(d.cond(t.map(function(d,g){return d+"==="+G+"["+g+"]"}).join("&&")).then(e,".",ja[a],"(",t,");",t.map(function(d,g){return G+"["+g+"]="+d}).join(";"),";"))}else c=x.def(n,".",a),t=d.cond(c,"!==",k,".",a),x(t),a in ia?t(d.cond(c).then(e,".enable(",ia[a],");")["else"](e,".disable(",
ia[a],");"),k,".",a,"=",c,";"):t(e,".",ja[a],"(",c,");",k,".",a,"=",c,";")}});0===Object.keys(b.state).length&&x(k,".dirty=false;");a(x)}function ta(d,g,a,b){var c=d.shared,f=d.current,n=c.current,k=c.gl;e(Object.keys(a)).forEach(function(c){var e=a[c];if(!b||b(e)){var t=e.append(d,g);if(ia[c]){var x=ia[c];h(e)?t?g(k,".enable(",x,");"):g(k,".disable(",x,");"):g(d.cond(t).then(k,".enable(",x,");")["else"](k,".disable(",x,");"));g(n,".",c,"=",t,";")}else if(Array.isArray(t)){var p=f[c];g(k,".",ja[c],
"(",t,");",t.map(function(d,g){return p+"["+g+"]="+d}).join(";"),";")}else g(k,".",ja[c],"(",t,");",n,".",c,"=",t,";")}})}function ra(d,g){ha&&!d.instancing&&(d.instancing=g.def(d.shared.extensions,".angle_instanced_arrays"))}function ua(d,g,a,c,b){function e(d){switch(d){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function f(a,c,b){function e(){g("if(!",x,".pointer){",n,".enableVertexAttribArray(",
t,");",x,".pointer=true;}");var a=b.type,k;k=b.size?g.def(b.size,"||",c):c;g("if(",x,".type!==",a,"||",x,".size!==",k,"||",u.map(function(d){return x+"."+d+"!=="+b[d]}).join("||"),"){",n,".bindBuffer(",34962,",",p,".buffer);",n,".vertexAttribPointer(",[t,k,a,b.normalized,b.stride,b.offset],");",x,".type=",a,";",x,".size=",k,";",u.map(function(d){return x+"."+d+"="+b[d]+";"}).join(""),"}");ha&&(a=b.divisor,g("if(",x,".divisor!==",a,"){",d.instancing,".vertexAttribDivisorANGLE(",[t,a],");",x,".divisor=",
a,";}"))}function h(){g("if(",x,".pointer){",n,".disableVertexAttribArray(",t,");",x,".pointer=false;","}if(",v.map(function(d,g){return x+"."+d+"!=="+q[g]}).join("||"),"){",n,".vertexAttrib4f(",t,",",q,");",v.map(function(d,g){return x+"."+d+"="+q[g]+";"}).join(""),"}")}var n=k.gl,t=g.def(a,".location"),x=g.def(k.attributes,"[",t,"]");a=b.state;var p=b.buffer,q=[b.x,b.y,b.z,b.w],u=["buffer","normalized","offset","stride"];1===a?e():2===a?h():(g("if(",a,"===",1,"){"),e(),g("}else{"),h(),g("}"))}var k=
d.shared;c.forEach(function(k){var c=k.name,h=a.attributes[c],n;if(h){if(!b(h))return;n=h.append(d,g)}else{if(!b(O))return;var t=d.scopeAttrib(c);n={};Object.keys(new pa).forEach(function(d){n[d]=g.def(t,".",d)})}f(d.link(k),e(k.info.type),n)})}function X(d,g,a,b,c){for(var e=d.shared,f=e.gl,k,h=0;h<b.length;++h){var n=b[h],t=n.name,x=n.info.type,p=a.uniforms[t],n=d.link(n)+".location";if(p){if(!c(p))continue;if(p["static"]){t=p.value;if(35678===x||35680===x)x=d.link(t._texture),g(f,".uniform1i(",
n,x+".bind());"),g.exit(x,".unbind()");else if(35674===x||35675===x||35676===x)t=d.global.def("["+t+"]"),p=2,35675===x?p=3:35676===x&&(p=4),g(f,".uniformMatrix",p,"fv(",n,",false,",t,");");else{switch(x){case 5126:k="1f";break;case 35664:k="2f";break;case 35665:k="3f";break;case 35666:k="4f";break;case 35670:k="1i";break;case 5124:k="1i";break;case 35671:k="2i";break;case 35667:k="2i";break;case 35672:k="3i";break;case 35668:k="3i";break;case 35673:k="4i";break;case 35669:k="4i"}g(f,".uniform",k,
"(",n,",",t,");")}continue}else t=p.append(d,g)}else{if(!c(O))continue;t=g.def(e.uniforms,"[",m.id(t),"]")}p=",";switch(x){case 35678:case 35680:x=g.def(t,"._texture");g(f,".uniform1i(",n,",",x,".bind());");g.exit(x,".unbind();");continue;case 5124:case 35670:k="1i";break;case 35667:case 35671:k="2iv";break;case 35668:case 35672:k="3iv";break;case 35669:case 35673:k="4iv";break;case 5126:k="1f";break;case 35664:k="2fv";break;case 35665:k="3fv";break;case 35666:k="4fv";break;case 35674:k="Matrix2fv";
p=",false,";break;case 35675:k="Matrix3fv";p=",false,";break;case 35676:k="Matrix4fv",p=",false,"}g(f,".uniform",k,"(",n,p,t,");")}}function Y(d,g,a,b){function c(b){var k=x[b];return k?k.batchStatic?k.append(d,g):k.append(d,a):g.def(t,".",b)}function e(){function d(){a(v,".drawElementsInstancedANGLE(",[q,w,H,u+"<<(("+H+"-5121)>>1)",z],");")}function g(){a(v,".drawArraysInstancedANGLE(",[q,u,w,z],");")}p?l?d():(a("if(",p,"){"),d(),a("}else{"),g(),a("}")):g()}function f(){function d(){a(n+".drawElements("+
[q,w,H,u+"<<(("+H+"-5121)>>1)"]+");")}function g(){a(n+".drawArrays("+[q,u,w]+");")}p?l?d():(a("if(",p,"){"),d(),a("}else{"),g(),a("}")):g()}var k=d.shared,n=k.gl,t=k.draw,x=b.draw,p=function(){var b=x.elements,k=g;b?(b.batchStatic||(k=a),b=b.append(d,k)):b=k.def(t,".","elements");b&&k("if("+b+")"+n+".bindBuffer(34963,"+b+".buffer.buffer);");return b}(),q=c("primitive"),u=c("offset"),w=function(){var b=x.count,k=g;b?(b.batchStatic||(k=a),b=b.append(d,k)):b=k.def(t,".","count");return b}();if("number"===
typeof w){if(0===w)return}else a("if(",w,"){"),a.exit("}");var z,v;ha&&(z=c("instances"),v=d.instancing);var H=p+".type",l=x.elements&&h(x.elements);ha&&("number"!==typeof z||0<=z)?"string"===typeof z?(a("if(",z,">0){"),e(),a("}else if(",z,"<0){"),f(),a("}")):e():f()}function Z(d,g,a,b,c){g=fa();c=g.proc("body",c);ha&&(g.instancing=c.def(g.shared.extensions,".angle_instanced_arrays"));d(g,c,a,b);return g.compile().body}function za(d,g,a,b){ra(d,g);ua(d,g,a,b.attributes,function(){return!0});X(d,g,
a,b.uniforms,function(){return!0});Y(d,g,g,a)}function Aa(d,g){var a=d.proc("draw",1);ra(d,a);T(d,a,g.context);qa(d,a,g.framebuffer);na(d,a,g);ta(d,a,g.state);var b=g.shader.progVar.append(d,a);a(d.shared.gl,".useProgram(",b,".program);");if(g.shader.program)za(d,a,g,g.shader.program);else{var c=d.global.def("{}"),e=a.def(b,".id"),f=a.def(c,"[",e,"]");a(d.cond(f).then(f,".call(this,a0);")["else"](f,"=",c,"[",e,"]=",d.link(function(a){return Z(za,d,g,a,1)}),"(",b,");",f,".call(this,a0);"))}0<Object.keys(g.state).length&&
a(d.shared.current,".dirty=true;")}function Da(d,g,a,b){function c(){return!0}d.batchId="a1";ra(d,g);ua(d,g,a,b.attributes,c);X(d,g,a,b.uniforms,c);Y(d,g,g,a)}function va(d,g,a,b){function c(d){return d.contextDep&&f||d.propDep}function e(d){return!c(d)}ra(d,g);var f=a.contextDynamic,k=g.def(),n=g.def();d.shared.props=n;d.batchId=k;var t=d.scope(),x=d.scope();g(t.entry,"for(",k,"=0;",k,"<","a1",";++",k,"){",n,"=","a0","[",k,"];",x,"}",t.exit);a.needsContext&&T(d,x,a.context);a.needsFramebuffer&&qa(d,
x,a.framebuffer);ta(d,x,a.state,c);b?(ua(d,t,a,b.attributes,e),ua(d,x,a,b.attributes,c),X(d,t,a,b.uniforms,e),X(d,x,a,b.uniforms,c),Y(d,t,x,a)):(g=d.global.def("{}"),b=a.shader.progVar.append(d,x),n=x.def(b,".id"),t=x.def(g,"[",n,"]"),x(d.shared.gl,".useProgram(",b,".program);","if(!",t,"){",t,"=",g,"[",n,"]=",d.link(function(g){return Z(Da,d,a,g,2)}),"(",b,");}",t,".call(this,a0[",k,"],",k,");"))}function Ba(d,g){var a=d.proc("batch",2);d.batchId="0";ra(d,a);var b=!1,c=!0;Object.keys(g.context).forEach(function(d){b=
b||g.context[d].propDep});b||(T(d,a,g.context),c=!1);var e=g.framebuffer,f=!1;e&&(e.propDep?b=f=!0:e.contextDep&&b&&(f=!0),f||qa(d,a,e));g.state.viewport&&g.state.viewport.propDynamic&&(b=!0);na(d,a,g);ta(d,a,g.state,function(d){return!(d.contextDep&&b||d.propDep)});g.contextDep=b;g.needsContext=c;g.needsFramebuffer=f;c=g.shader.progVar;if(c.contextDep&&b||c.propDep)va(d,a,g,null);else if(c=c.append(d,a),a(d.shared.gl,".useProgram(",c,".program);"),g.shader.program)va(d,a,g,g.shader.program);else{var e=
d.global.def("{}"),f=a.def(c,".id"),k=a.def(e,"[",f,"]");a(d.cond(k).then(k,".call(this,a0,a1);")["else"](k,"=",e,"[",f,"]=",d.link(function(a){return Z(va,d,g,a,2)}),"(",c,");",k,".call(this,a0,a1);"))}0<Object.keys(g.state).length&&a(d.shared.current,".dirty=true;")}function wa(d,g){function a(e){var k=g.shader[e];k&&b.set(c.shader,"."+e,k.append(d,b))}var b=d.proc("scope",3);d.batchId="a2";var c=d.shared,f=c.current;T(d,b,g.context);g.framebuffer&&g.framebuffer.append(d,b);e(Object.keys(g.state)).forEach(function(a){var k=
g.state[a].append(d,b);Array.isArray(k)?k.forEach(function(g,c){b.set(d.next[a],"["+c+"]",g)}):b.set(c.next,"."+a,k)});["elements","offset","count","instances","primitive"].forEach(function(a){var k=g.draw[a];k&&b.set(c.draw,"."+a,""+k.append(d,b))});Object.keys(g.uniforms).forEach(function(a){b.set(c.uniforms,"["+m.id(a)+"]",g.uniforms[a].append(d,b))});Object.keys(g.attributes).forEach(function(a){var c=g.attributes[a].append(d,b),e=d.scopeAttrib(a);Object.keys(new pa).forEach(function(d){b.set(e,
"."+d,c[d])})});a("vert");a("frag");0<Object.keys(g.state).length&&(b(f,".dirty=true;"),b.exit(f,".dirty=true;"));b("a1(",d.shared.context,",a0,0);")}var pa=R.Record,W={add:32774,subtract:32778,"reverse subtract":32779};w.ext_blend_minmax&&(W.min=32775,W.max=32776);var ha=w.angle_instanced_arrays,ba=w.webgl_draw_buffers,g={dirty:!0},x={},t=[],ia={},ja={};J("dither",3024);J("blend.enable",3042);K("blend.color","blendColor",[0,0,0,0]);K("blend.equation","blendEquationSeparate",[32774,32774]);K("blend.func",
"blendFuncSeparate",[1,0,1,0]);J("depth.enable",2929,!0);K("depth.func","depthFunc",513);K("depth.range","depthRange",[0,1]);K("depth.mask","depthMask",!0);K("colorMask","colorMask",[!0,!0,!0,!0]);J("cull.enable",2884);K("cull.face","cullFace",1029);K("frontFace","frontFace",2305);K("lineWidth","lineWidth",1);J("polygonOffset.enable",32823);K("polygonOffset.offset","polygonOffset",[0,0]);J("sample.alpha",32926);J("sample.enable",32928);K("sample.coverage","sampleCoverage",[1,!1]);J("stencil.enable",
2960);K("stencil.mask","stencilMask",-1);K("stencil.func","stencilFunc",[519,0,-1]);K("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);K("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);J("scissor.enable",3089);K("scissor.box","scissor",[0,0,l.drawingBufferWidth,l.drawingBufferHeight]);K("viewport","viewport",[0,0,l.drawingBufferWidth,l.drawingBufferHeight]);var Ea={gl:l,context:ea,strings:m,next:x,current:g,draw:I,elements:r,buffer:F,shader:V,attributes:R.state,uniforms:H,
framebuffer:da,extensions:w,isBufferArgs:f},ya={primTypes:C,compareFuncs:B,blendFuncs:y,blendEquations:W,stencilOps:p,glTypes:n,orientationType:a};ba&&(ya.backBuffer=[1029],ya.drawBuffer=D(E.maxDrawbuffers,function(d){return 0===d?[0]:D(d,function(d){return 36064+d})}));var Ga=0;return{next:x,current:g,procs:function(){var d=fa(),a=d.proc("poll"),b=d.proc("refresh"),c=d.block();a(c);b(c);var e=d.shared,f=e.gl,x=e.next,k=e.current;c(k,".dirty=false;");qa(d,a);b(e.framebuffer,".dirty=true;");qa(d,b);
Object.keys(ia).forEach(function(g){var e=ia[g],t=c.def(x,".",g),n=d.block();n("if(",t,"){",f,".enable(",e,")}else{",f,".disable(",e,")}",k,".",g,"=",t,";");b(n);a("if(",t,"!==",k,".",g,"){",n,"}")});Object.keys(ja).forEach(function(e){var t=ja[e],n=g[e],h,p,q=d.block();q(f,".",t,"(");Array.isArray(n)?(t=n.length,h=d.global.def(x,".",e),p=d.global.def(k,".",e),q(D(t,function(d){return h+"["+d+"]"}),");",D(t,function(d){return p+"["+d+"]="+h+"["+d+"];"}).join("")),a("if(",D(t,function(d){return h+
"["+d+"]!=="+p+"["+d+"]"}).join("||"),"){",q,"}")):(h=c.def(x,".",e),p=c.def(k,".",e),q(h,");",k,".",e,"=",h,";"),a("if(",h,"!==",p,"){",q,"}"));b(q)});return d.compile()}(),compile:function(d,g,a,b){var c=fa(),e;e=aa(d);var f=ka(d,e),k=sa(d),t=ga(d);d=la(d);var n=f.viewport;n&&(t.viewport=n);n=N("scissor.box");(f=f[n])&&(t[n]=f);f=0<Object.keys(t).length;e={framebuffer:e,draw:k,shader:d,state:t,dirty:f};e.uniforms=ma(a);e.attributes=S(g);e.context=P(b);Aa(c,e);wa(c,e);Ba(c,e);return c.compile()}}}},
{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":20,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/loop":24}],9:[function(l,m,r){function f(b,c){this.id=h++;this.type=b;this.data=c}function e(b){if(0===b.length)return[];var c=b.charAt(0),f=b.charAt(b.length-1);if(1<b.length&&c===f&&('"'===c||"'"===c))return['"'+b.substr(1,b.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(c=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return e(b.substr(0,c.index)).concat(e(c[1])).concat(e(b.substr(c.index+
c[0].length)));c=b.split(".");if(1===c.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(f=0;f<c.length;++f)b=b.concat(e(c[f]));return b}function u(b){return"["+e(b).join("][")+"]"}var h=0;m.exports={define:function(b,c){switch(typeof c){case "boolean":case "number":case "string":return new f(b,u(c+""));case "undefined":return new f(b|128,null)}},isDynamic:function(b){return"function"===typeof b&&!b._reglType||b instanceof f},unbox:function(b,c){if(b instanceof f){if(b.type&
128)return new f(b.type&-129,u(c))}else if("function"===typeof b)return new f(0,b);return b},accessor:u}},{}],10:[function(l,m,r){var f=l("./util/is-typed-array"),e=l("./util/is-ndarray"),u=l("./constants/primitives.json"),h=l("./constants/usage.json");m.exports=function(b,c,q){function l(b){this.buffer=b;this.primType=4;this.type=this.vertCount=0}function m(b,h,u,l,p,a,D){(a=D)||f(h)&&(!e(h)||f(h.data))||(a=c.oes_element_index_uint?5125:5123);b.buffer.bind();q._initBuffer(b.buffer,h,u,a,3);h=D;if(!D){switch(b.buffer.dtype){case 5121:case 5120:h=
5121;break;case 5123:case 5122:h=5123;break;case 5125:case 5124:h=5125}b.buffer.dtype=h}b.type=h;0>p&&(p=b.buffer.byteLength,5123===h?p>>=1:5125===h&&(p>>=2));b.vertCount=p;p=l;0>l&&(p=4,l=b.buffer.dimension,1===l&&(p=0),2===l&&(p=1),3===l&&(p=4));b.primType=p}var E={uint8:5121,uint16:5123};c.oes_element_index_uint&&(E.uint32=5125);l.prototype.bind=function(){this.buffer.bind()};var C=[];return{create:function(c){function v(c){if(c)if("number"===typeof c)y(c),B.primType=4,B.vertCount=c|0,B.type=5121;
else{var a=null,n=35044,q=-1,l=-1,w=0,D=0;Array.isArray(c)||f(c)||e(c)?a=c:("data"in c&&(a=c.data),"usage"in c&&(n=h[c.usage]),"primitive"in c&&(q=u[c.primitive]),"count"in c&&(l=c.count|0),"length"in c&&(w=c.length|0),"type"in c&&(D=E[c.type]));a?m(B,a,n,q,l,w,D):(c=B.buffer,c.bind(),b.bufferData(34963,w,n),c.dtype=D||5121,c.usage=n,c.dimension=3,c.byteLength=w,B.primType=0>q?4:q,B.vertCount=0>l?0:l,B.type=c.dtype)}else y(),B.primType=4,B.vertCount=0,B.type=5121;return v}var y=q.create(null,34963,
!0),B=new l(y._buffer);v(c);v._reglType="elements";v._elements=B;v.subdata=function(b,a){y.subdata(b,a);return v};v.destroy=function(){y.destroy();B.buffer=null};return v},createStream:function(b){var c=C.pop();c||(c=new l(q.create(null,34963,!0)._buffer));m(c,b,35040,-1,-1,0,0);return c},destroyStream:function(b){C.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof l?b._elements:null}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":22,
"./util/is-typed-array":23}],11:[function(l,m,r){m.exports=function(f){function e(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(e){try{u[e]=
f.getExtension(e)}catch(b){}})}var u={};e();return{extensions:u,refresh:e}}},{}],12:[function(l,m,r){var f=l("./util/values"),e=l("./util/extend");m.exports=function(u,h,b,c,q){function l(a,b,c,e){this.target=a;this.level=b;this.texture=c;this.renderbuffer=e}function m(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function E(a,b){var c=b.width,e=b.height;if(a.texture)var f=a.texture._texture,h=Math.max(1,f.params.width>>a.level),n=Math.max(1,
f.params.height>>a.level),c=c||h,e=e||n;else f=a.renderbuffer._renderbuffer,c=c||f.width,e=e||f.height;f.refCount+=1;b.width=c;b.height=e}function C(a,b){b?b.texture?u.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):u.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):u.framebufferTexture2D(36160,a,3553,null,0)}function n(a){var b=3553,c=0,e=null,f=null;"object"===typeof a&&("level"in a&&(c=a.level|0),"target"in a&&(b=a.target|0));var h=a._reglType;
"texture"===h?e=a:"renderbuffer"===h&&(f=a,b=36161,c=0);return new l(b,c,e,f)}function v(a){return a&&(a.texture||a.renderbuffer)}function y(){this.id=F++;M[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function B(c){u.isFramebuffer(c.framebuffer)||(c.framebuffer=u.createFramebuffer());a.dirty=!0;u.bindFramebuffer(36160,c.framebuffer);for(var e=
c.colorAttachments,f=0;f<e.length;++f)C(36064+f,e[f]);for(f=e.length;f<b.maxColorAttachments;++f)C(36064+f,null);C(36096,c.depthAttachment);C(36128,c.stencilAttachment);C(33306,c.depthStencilAttachment);h.webgl_draw_buffers&&h.webgl_draw_buffers.drawBuffersWEBGL(Q[e.length]);u.checkFramebufferStatus(36160)}function p(a){a=a.framebuffer;u.isFramebuffer(a)&&u.deleteFramebuffer(a)}var a={current:null,next:null,dirty:!1},O={rgba:6408},r={rgba4:32854,rgb565:36194,"rgb5 a1":32855};h.ext_srgb&&(r.srgba=
35907);h.ext_color_buffer_half_float&&(r.rgba16f=34842,r.rgb16f=34843);h.webgl_color_buffer_float&&(r.rgba32f=34836);var L=[],w=[];h.webgl_depth_texture&&(L.push(6402),w.push(34041));e(e({},O),r);f(O);f(r);r=5121;L={uint8:5121};h.oes_texture_half_float&&(r=L["half float"]=36193);h.oes_texture_float&&(r=L["float"]=5126);L.best=r;var Q=function(){for(var a=Array(b.maxDrawbuffers),c=0;c<=b.maxDrawbuffers;++c)for(var e=a[c]=Array(c),f=0;f<c;++f)e[f]=36064+f;return a}(),F=0,M={};return e(a,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof y)?a:null},create:function(a){function b(a){var f,h=a||{},p=a=0;if("shape"in h){var w=h.shape;a=w[0];p=w[1]}else"radius"in h&&(a=p=h.radius),"width"in h&&(a=h.width),"height"in h&&(p=h.height);var y=null,w=!1;if("colorBuffers"in h||"colorBuffer"in h){y=h.colorBuffers||h.colorBuffer;Array.isArray(y)||(y=[y]);e.width=a;e.height=p;y=y.map(n);for(f=0;f<y.length;++f)E(y[f],e);a=e.width;p=e.height}else{var C=!0,z="rgba",r="uint8",F=1,
w=!0;e.width=a=a||u.drawingBufferWidth;e.height=p=p||u.drawingBufferHeight;"format"in h&&(z=h.format,C=z in O);"type"in h&&(r=h.type);"colorCount"in h&&(F=h.colorCount|0);if(e.ownsColor)for(y=e.colorAttachments;y.length>F;)m(y.pop());else y=[];for(f=0;f<y.length;++f){var Q;a:{Q=y[f];var L=C,M=z,U=a,S=p;if(Q.texture){var P=Q.texture;if(L){P({format:M,type:r,width:U,height:S});P._texture.refCount+=1;Q=!0;break a}}else if(P=Q.renderbuffer,!L){P({format:M,width:U,height:S});P._renderbuffer.refCount+=
1;Q=!0;break a}m(Q);Q=!1}Q||(y[f--]=y[y.length-1],y.pop())}for(;y.length<F;)C?y.push(new l(3553,0,c.create2D({format:z,type:r,width:a,height:p},3553),null)):y.push(new l(36161,0,null,q.create({format:z,width:a,height:p})))}e.width=a;e.height=p;z=C=f=null;r=!1;"depthBuffer"in h&&(f=n(h.depthBuffer));"stencilBuffer"in h&&(C=n(h.stencilBuffer));"depthStencilBuffer"in h&&(z=n(h.depthStencilBuffer));if(f||C||z)E(f||C||z,e);else if(F=!0,L=Q=!1,"depth"in h&&(F=!!h.depth),"stencil"in h&&(Q=!!h.stencil),"depthTexture"in
h&&(L=!!h.depthTexture),h=e.depthAttachment||e.stencilAttachment||e.depthStencilAttachment,M=null,F||Q)r=!0,L?(L=Q?"depth stencil":"depth",e.ownsDepthStencil&&h.texture?(h.texture({format:L,width:a,height:p}),h.texture._texture.refCount+=1,M=h):M=new l(3553,0,c.create({format:L,width:a,height:p},3553),null)):(L=F?Q?"depth stencil":"depth":"stencil",e.ownsDepthStencil&&h.renderbuffer?(h.renderbuffer({format:L,width:a,height:p}),h.renderbuffer._renderbuffer.refCount+=1,M=h):M=new l(36161,0,null,q.create({format:L,
width:a,height:p}))),F?Q?z=M:f=M:C=M;a=e;a.colorAttachments.forEach(m);m(a.depthAttachment);m(a.stencilAttachment);m(a.depthStencilAttachment);e.colorAttachments=y;e.depthAttachment=f;e.stencilAttachment=C;e.depthStencilAttachment=z;e.ownsColor=w;e.ownsDepthStencil=r;b.color=y.map(v);b.depth=v(f);b.stencil=v(C);b.depthStencil=v(z);B(e);b.width=e.width;b.height=e.height;return b}var e=new y;b(a);b._reglType="framebuffer";b._framebuffer=e;b._destroy=function(){p(e)};return b},clear:function(){f(M).forEach(p)},
refresh:function(){f(M).forEach(B)}})}},{"./util/extend":21,"./util/values":28}],13:[function(l,m,r){m.exports=function(f,e){var l=1;e.ext_texture_filter_anisotropic&&(l=f.getParameter(34047));var h=1,b=1;e.webgl_draw_buffers&&(h=f.getParameter(34852),b=f.getParameter(36063));return{colorBits:[f.getParameter(3410),f.getParameter(3411),f.getParameter(3412),f.getParameter(3413)],depthBits:f.getParameter(3414),stencilBits:f.getParameter(3415),subpixelBits:f.getParameter(3408),extensions:Object.keys(e).filter(function(b){return!!e[b]}),
maxAnisotropic:l,maxDrawbuffers:h,maxColorAttachments:b,pointSizeDims:f.getParameter(33901),lineWidthDims:f.getParameter(33902),maxViewportDims:f.getParameter(3386),maxCombinedTextureUnits:f.getParameter(35661),maxCubeMapSize:f.getParameter(34076),maxRenderbufferSize:f.getParameter(34024),maxTextureUnits:f.getParameter(34930),maxTextureSize:f.getParameter(3379),maxAttributes:f.getParameter(34921),maxVertexUniforms:f.getParameter(36347),maxVertexTextureUnits:f.getParameter(35660),maxVaryingVectors:f.getParameter(36348),
maxFragmentUniforms:f.getParameter(36349),glsl:f.getParameter(35724),renderer:f.getParameter(7937),vendor:f.getParameter(7936),version:f.getParameter(7938)}}},{}],14:[function(l,m,r){var f=l("./util/is-typed-array");m.exports=function(e,l,h){return function(b){var c=b||{};f(b)?c={data:c}:2===arguments.length?c={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof b&&(c={});l();var q=c.x||0,m=c.y||0,r=c.width||h.viewportWidth,E=c.height||h.viewportHeight,c=c.data||new Uint8Array(r*E*4);e.pixelStorei(3333,
4);e.readPixels(q,m,r,E,6408,5121,c);return c}}},{"./util/is-typed-array":23}],15:[function(l,m,r){var f=l("./util/values");m.exports=function(e,l,h){function b(){this.id=r++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function c(b){e.isRenderbuffer(b.renderbuffer)||(b.renderbuffer=e.createRenderbuffer());e.bindRenderbuffer(36161,b.renderbuffer);e.renderbufferStorage(36161,b.format,b.width,b.height)}function q(b){var c=b.renderbuffer;e.bindRenderbuffer(36161,
null);e.isRenderbuffer(c)&&e.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete E[b.id]}var m={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};l.ext_srgb&&(m.srgba=35907);l.ext_color_buffer_half_float&&(m.rgba16f=34842,m.rgb16f=34843);l.webgl_color_buffer_float&&(m.rgba32f=34836);var r=0,E={};b.prototype.decRef=function(){0===--this.refCount&&q(this)};return{create:function(e){function f(b){b=b||{};var e=0,p=0;"shape"in b?(p=b.shape,e=p[0]|0,p=
p[1]|0):("radius"in b&&(e=p=b.radius|0),"width"in b&&(e=b.width|0),"height"in b&&(p=b.height|0));f.width=h.width=Math.max(e,1);f.height=h.height=Math.max(p,1);h.format=32854;"format"in b&&(h.format=m[b.format]);c(h);return f}var h=new b;E[h.id]=h;f(e);f._reglType="renderbuffer";f._renderbuffer=h;f.destroy=function(){h.decRef()};return f},refresh:function(){f(E).forEach(c)},clear:function(){f(E).forEach(q)}}}},{"./util/values":28}],16:[function(l,m,r){var f=l("./util/values");m.exports=function(e,
l){function h(b,c,e,a){this.name=b;this.id=c;this.location=e;this.info=a}function b(b,c){for(var e=0;e<b.length;++e)if(b[e].id===c.id){b[e].location=c.location;return}b.push(c)}function c(b,c,f){f=35632===b?r:E;var a=f[c];if(!a){var h=l.str(c),a=e.createShader(b);e.shaderSource(a,h);e.compileShader(a);f[c]=a}return a}function q(b,c){this.id=v++;this.fragId=b;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[]}function m(f,n){var q,a;q=c(35632,f.fragId);a=c(35633,f.vertId);var v=f.program=
e.createProgram();e.attachShader(v,q);e.attachShader(v,a);e.linkProgram(v);var r=e.getProgramParameter(v,35718),D=f.uniforms;for(q=0;q<r;++q)if(a=e.getActiveUniform(v,q))if(1<a.size)for(var w=0;w<a.size;++w){var C=a.name.replace("[0]","["+w+"]");b(D,new h(C,l.id(C),e.getUniformLocation(v,C),a))}else b(D,new h(a.name,l.id(a.name),e.getUniformLocation(v,a.name),a));r=e.getProgramParameter(v,35721);D=f.attributes;for(q=0;q<r;++q)(a=e.getActiveAttrib(v,q))&&b(D,new h(a.name,l.id(a.name),e.getAttribLocation(v,
a.name),a))}var r={},E={},C={},n=[],v=0;return{clear:function(){var b=e.deleteShader.bind(e);f(r).forEach(b);r={};f(E).forEach(b);E={};n.forEach(function(b){e.deleteProgram(b.program)});n.length=0;C={}},refresh:function(){r={};E={};n.forEach(m)},program:function(b,c,e){var a=C[c];a||(a=C[c]={});var f=a[b];f||(f=new q(c,b),m(f,e),a[b]=f,n.push(f));return f},shader:c,frag:null,vert:null}}},{"./util/values":28}],17:[function(l,m,r){m.exports=function(){var f={"":0},e=[""];return{id:function(l){var h=
f[l];if(h)return h;h=f[l]=e.length;e.push(l);return h},str:function(f){return e[f]}}}},{}],18:[function(l,m,r){function f(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function e(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,e=1;e<b;++e)if(!Array.isArray(a[e])||a[e].length!==c)return!1;return!0}function u(a){return Object.prototype.toString.call(a)}function h(a){if(!a)return!1;var b=u(a);return 0<=p.indexOf(b)?!0:
f(a)||e(a)||ca(a)}function b(a,b){36193===a.type?(a.data=C(b),E.freeType(b)):a.data=b}var c=l("./util/extend"),q=l("./util/values"),D=l("./util/is-typed-array"),ca=l("./util/is-ndarray"),E=l("./util/pool"),C=l("./util/to-half-float");r=l("./constants/arraytypes.json");var n=l("./constants/arraytypes.json"),v=[9984,9986,9985,9987],y=[0,6409,6410,6407,6408],B={};B[6409]=B[6406]=B[6402]=1;B[34041]=B[6410]=2;B[6407]=3;B[6408]=4;var p=Object.keys(r).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]",
"[object HTMLImageElement]","[object HTMLVideoElement]"]);m.exports=function(a,l,p,m,w){function r(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function F(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;
a.width=b.width;a.height=b.height;a.channels=b.channels}function M(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=ua[b.colorSpace]);"type"in b&&(a.type=X[b.type]);var c=a.width,e=a.height,f=a.channels,h=!1;"shape"in b?(c=b.shape[0],e=b.shape[1],3===b.shape.length&&(f=b.shape[2],h=!0)):("radius"in b&&(c=e=b.radius),"width"in b&&(c=b.width),
"height"in b&&(e=b.height),"channels"in b&&(f=b.channels,h=!0));a.width=c|0;a.height=e|0;a.channels=f|0;c=!1;"format"in b&&(c=b.format,e=a.internalformat=Y[c],a.format=Da[e],c in X&&!("type"in b)&&(a.type=X[c]),c in Z&&(a.compressed=!0),c=!0);!h&&c?a.channels=B[a.format]:h&&!c&&a.channels!==y[a.format]&&(a.format=a.internalformat=y[a.channels])}}function z(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}
function da(){r.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function H(a,c){var t=null;h(c)?t=c:c&&(M(a,c),"x"in c&&(a.xOffset=c.x|0),"y"in c&&(a.yOffset=c.y|0),h(c.data)&&(t=c.data));if(c.copy){var l=w.viewportWidth,q=w.viewportHeight;a.width=a.width||l-a.xOffset;a.height=a.height||q-a.yOffset;a.needsCopy=!0}else if(!t)a.width=a.width||1,a.height=a.height||1;else if(D(t))a.data=t,"type"in c||5121!==a.type||(a.type=n[Object.prototype.toString.call(t)]|
0);else if(f(t)){l=t;q=a.width*a.height*a.channels;switch(a.type){case 5121:case 5123:case 5125:case 5126:q=E.allocType(a.type,q);q.set(l);a.data=q;break;case 36193:a.data=C(l)}a.alignment=1;a.needsFree=!0}else if(ca(t)){l=t.data;Array.isArray(l)||5121!==a.type||(a.type=n[Object.prototype.toString.call(l)]|0);var q=t.shape,p=t.stride,m,v,d,r;3===q.length?(d=q[2],r=p[2]):r=d=1;m=q[0];v=q[1];q=p[0];p=p[1];a.alignment=1;a.width=m;a.height=v;a.channels=d;a.format=a.internalformat=y[d];a.needsFree=!0;
m=r;t=t.offset;d=a.width;r=a.height;v=a.channels;for(var z=E.allocType(36193===a.type?5126:a.type,d*r*v),F=0,B=0;B<r;++B)for(var A=0;A<d;++A)for(var H=0;H<v;++H)z[F++]=l[q*A+p*B+m*H+t];b(a,z)}else if("[object HTMLCanvasElement]"===u(t)||"[object CanvasRenderingContext2D]"===u(t))"[object HTMLCanvasElement]"===u(t)?a.element=t:a.element=t.canvas,a.width=a.element.width,a.height=a.element.height;else if("[object HTMLImageElement]"===u(t))a.element=t,a.width=t.naturalWidth,a.height=t.naturalHeight;else if("[object HTMLVideoElement]"===
u(t))a.element=t,a.width=t.videoWidth,a.height=t.videoHeight,a.needsPoll=!0;else if(e(t)){l=t[0].length;q=t.length;p=1;if(Array.isArray(t[0][0])){m=p=t[0][0].length;d=E.allocType(36193===a.type?5126:a.type,l*q*m);for(v=r=0;v<q;++v)for(z=t[v],F=0;F<l;++F)for(B=z[F],A=0;A<m;++A)d[r++]=B[A];b(a,d)}else{m=E.allocType(36193===a.type?5126:a.type,l*q);for(r=d=0;r<q;++r)for(v=t[r],z=0;z<l;++z)m[d++]=v[z];b(a,m)}a.alignment=1;a.width=l;a.height=q;a.channels=p;a.format=a.internalformat=y[p];a.needsFree=!0}}
function R(b,c,e,f,h){var n=b.element,q=b.data,l=b.internalformat,d=b.format,p=b.type,w=b.width,u=b.height;z(b);n?a.texSubImage2D(c,h,e,f,d,p,n):b.compressed?a.compressedTexSubImage2D(c,h,e,f,l,w,u,q):b.needsCopy?(m(),a.copyTexSubImage2D(c,h,e,f,b.xOffset,b.yOffset,w,u)):a.texSubImage2D(c,h,e,f,w,u,d,p,q)}function V(){return va.pop()||new da}function I(a){a.needsFree&&E.freeType(a.data);da.call(a);va.push(a)}function ea(){r.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=
Array(16)}function N(a,b,c){var e=a.images[0]=V();a.mipmask=1;e.width=a.width=b;e.height=a.height=c}function J(a,b){var c=null;if(h(b))c=a.images[0]=V(),H(c,b),a.mipmask=1;else if(M(a,b),Array.isArray(b.mipmap))for(var e=b.mipmap,f=0;f<e.length;++f)c=a.images[f]=V(),F(c,a),c.width>>=f,c.height>>=f,H(c,e[f]),a.mipmask|=1<<f;else c=a.images[0]=V(),F(c,a),H(c,b),a.mipmask=1;F(a,a.images[0])}function K(b,c){for(var e=b.images,f=0;f<e.length&&e[f];++f){var h=e[f],n=c,q=f,l=h.element,d=h.data,p=h.internalformat,
w=h.format,u=h.type,v=h.width,r=h.height;z(h);l?a.texImage2D(n,q,w,w,u,l):h.compressed?a.compressedTexImage2D(n,q,p,v,r,0,d):h.needsCopy?(m(),a.copyTexImage2D(n,q,w,h.xOffset,h.yOffset,v,r,0)):a.texImage2D(n,q,w,v,r,0,w,u,d)}}function fa(){var a=Ba.pop()||new ea;r.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function aa(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&I(b[c]),b[c]=null;Ba.push(a)}function ka(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=
1;this.genMipmaps=!1;this.mipmapHint=4352}function la(a,b){"min"in b&&(a.minFilter=ra[b.min],0<=v.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=ta[b.mag]);var c=a.wrapS,e=a.wrapT;if("wrap"in b){var f=b.wrap;"string"===typeof f?c=e=na[f]:Array.isArray(f)&&(c=na[f[0]],e=na[f[1]])}else"wrapS"in b&&(c=na[b.wrapS]),"wrapT"in b&&(e=na[b.wrapT]);a.wrapS=c;a.wrapT=e;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=
qa[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function sa(b,c){a.texParameteri(c,10241,b.minFilter);a.texParameteri(c,10240,b.magFilter);a.texParameteri(c,10242,b.wrapS);a.texParameteri(c,10243,b.wrapT);l.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(c))}function ga(){var a=wa.pop()||new ka;ka.call(a);return a}
function ma(b){r.call(this);this.mipmask=0;this.id=pa++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0}function S(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function P(){var b=ba[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function T(b){var c=b.texture,e=b.unit,f=b.target;0<=e&&(a.activeTexture(33984+e),a.bindTexture(f,null),ba[e]=null);a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete W[b.id]}
var qa={"don't care":4352,"dont care":4352,nice:4354,fast:4353},na={repeat:10497,clamp:33071,mirror:33648},ta={nearest:9728,linear:9729},ra=c({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ta),ua={none:0,browser:37444},X={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Y={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Z={};l.ext_srgb&&(Y.srgb=35904,
Y.srgba=35906);l.oes_texture_float&&(X["float"]=5126);l.oes_texture_half_float&&(X.float16=X["half float"]=36193);l.webgl_depth_texture&&(c(Y,{depth:6402,"depth stencil":34041}),c(X,{uint16:5123,uint32:5125,"depth stencil":34042}));l.webgl_compressed_texture_s3tc&&c(Z,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});l.webgl_compressed_texture_atc&&c(Z,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});l.webgl_compressed_texture_pvrtc&&
c(Z,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});l.webgl_compressed_texture_etc1&&(Z["rgb etc1"]=36196);var za=Array.prototype.slice.call(a.getParameter(34467));Object.keys(Z).forEach(function(a){var b=Z[a];0<=za.indexOf(b)&&(Y[a]=b)});var Aa=Object.keys(Y);p.textureFormats=Aa;var Da=Aa.reduce(function(a,b){var c=Y[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},
{}),va=[],Ba=[],wa=[],pa=0,W={},ha=p.maxTextureUnits,ba=Array(ha).map(function(){return null});c(ma.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<ha;++c){var e=ba[c];if(e){if(0<e.bindCount)continue;e.unit=-1}ba[c]=this;b=c;break}this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&T(this)}});return{create2D:function(a,b){function c(a,b){var g=ga(),f=fa();
"number"===typeof a?"number"===typeof b?N(f,a|0,b|0):N(f,a|0,a|0):a?(la(g,a),J(f,a)):N(f,1,1);g.genMipmaps&&(f.mipmask=(f.width<<1)-1);e.mipmask=f.mipmask;F(e,f);c.width=f.width;c.height=f.height;S(e);K(f,3553);sa(g,3553);P();wa.push(g);aa(f);return c}var e=new ma(3553);W[e.id]=e;c(a,b);c.subimage=function(a,b,f,g){b|=0;f|=0;g|=0;var d=V();F(d,e);d.width>>=g;d.height>>=g;d.width-=b;d.height-=f;H(d,a);S(e);R(d,3553,b,f,g);P();I(d);return c};c._reglType="texture2d";c._texture=e;c.destroy=function(){e.decRef()};
return c},createCube:function(a,b,c,e,f,h){function n(a,b,c,e,f,g){var k,h=ga();for(k=0;6>k;++k)d[k]=fa();if("number"===typeof a||!a)for(a=a|0||1,k=0;6>k;++k)N(d[k],a,a);else if("object"===typeof a)if(b)J(d[0],a),J(d[1],b),J(d[2],c),J(d[3],e),J(d[4],f),J(d[5],g);else if(la(h,a),M(q,a),"faces"in a)for(a=a.faces,k=0;6>k;++k)F(d[k],q),J(d[k],a[k]);else for(k=0;6>k;++k)J(d[k],a);F(q,d[0]);q.mipmask=h.genMipmaps?(d[0].width<<1)-1:d[0].mipmask;n.width=d[0].width;n.height=d[0].height;S(q);for(k=0;6>k;++k)K(d[k],
34069+k);sa(h,34067);P();wa.push(h);for(k=0;6>k;++k)aa(d[k]);return n}var q=new ma(34067);W[q.id]=q;var d=Array(6);n(a,b,c,e,f,h);n.subimage=function(a,b,d,c,e){d|=0;c|=0;e|=0;var f=V();F(f,q);f.width>>=e;f.height>>=e;f.width-=d;f.height-=c;H(f,b);S(q);R(f,34069+a,d,c,e);P();I(f);return n};n._reglType="textureCube";n._texture=q;n.destroy=function(){q.decRef()};return n},clear:function(){for(var b=0;b<ha;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),ba[b]=null;q(W).forEach(T)},getTexture:function(a){return null}}}},
{"./constants/arraytypes.json":4,"./util/extend":21,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/pool":25,"./util/to-half-float":27,"./util/values":28}],19:[function(l,m,r){m.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],20:[function(l,m,r){function f(e){return Array.prototype.slice.call(e)}function e(e){return f(e).join("")}var u=l("./extend");m.exports=function(){function h(){var b=[],h=[];return u(function(){b.push.apply(b,
f(arguments))},{def:function(){var e="v"+c++;h.push(e);0<arguments.length&&(b.push(e,"="),b.push.apply(b,f(arguments)),b.push(";"));return e},toString:function(){return e([0<h.length?"var "+h+";":"",e(b)])}})}function b(){function b(f,a){e(f,a,"=",c.def(f,a),";")}var c=h(),e=h(),f=c.toString,q=e.toString;return u(c,{entry:c,exit:e,save:b,set:function(e,a,f){b(e,a);c(e,a,"=",f,";")},toString:function(){return f()+q()}})}var c=0,q=[],l=[],m=h(),r={};return{global:m,link:function(b){for(var e=0;e<l.length;++e)if(l[e]===
b)return q[e];e="g"+c++;q.push(e);l.push(b);return e},block:h,proc:function(c,f){function h(){var a="a"+q.length;q.push(a);return a}var q=[];f=f||0;for(var l=0;l<f;++l)h();var l=b(),m=l.toString;return r[c]=u(l,{arg:h,toString:function(){return e(["function(",q.join(),"){",m(),"}"])}})},scope:b,cond:function(){var c=e(arguments),h=b(),q=b(),l=h.toString,m=q.toString;return u(h,{then:function(){h.apply(h,f(arguments));return this},"else":function(){q.apply(q,f(arguments));return this},toString:function(){var b=
m();b&&(b="else{"+b+"}");return e(["if(",c,"){",l(),"}",b])}})},compile:function(){var b=['"use strict";',m,"return {"];Object.keys(r).forEach(function(c){b.push('"',c,'":',r[c].toString(),",")});b.push("}");var c=e(b).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,q.concat(c)).apply(null,l)}}}},{"./extend":21}],21:[function(l,m,r){m.exports=function(f,e){for(var l=Object.keys(e),h=0;h<l.length;++h)f[l[h]]=e[l[h]];return f}},{}],22:[function(l,m,r){var f=l("./is-typed-array");
m.exports=function(e){return!!e&&"object"===typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"===typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||f(e.data))}},{"./is-typed-array":23}],23:[function(l,m,r){var f=l("../constants/arraytypes.json");m.exports=function(e){return Object.prototype.toString.call(e)in f}},{"../constants/arraytypes.json":4}],24:[function(l,m,r){m.exports=function(f,e){for(var l=Array(f),h=0;h<f;++h)l[h]=e(h);return l}},{}],25:[function(l,
m,r){function f(b){var c,e;c=(65535<b)<<4;b>>>=c;e=(255<b)<<3;b>>>=e;c|=e;e=(15<b)<<2;b>>>=e;c|=e;e=(3<b)<<1;return c|e|b>>>e>>1}function e(b){a:{for(var c=16;268435456>=c;c*=16)if(b<=c){b=c;break a}b=0}c=h[f(b)>>2];return 0<c.length?c.pop():new ArrayBuffer(b)}function u(b){h[f(b.byteLength)>>2].push(b)}var h=l("./loop")(8,function(){return[]});m.exports={alloc:e,free:u,allocType:function(b,c){var f=null;switch(b){case 5120:f=new Int8Array(e(c),0,c);break;case 5121:f=new Uint8Array(e(c),0,c);break;
case 5122:f=new Int16Array(e(2*c),0,c);break;case 5123:f=new Uint16Array(e(2*c),0,c);break;case 5124:f=new Int32Array(e(4*c),0,c);break;case 5125:f=new Uint32Array(e(4*c),0,c);break;case 5126:f=new Float32Array(e(4*c),0,c);break;default:return null}return f.length!==c?f.subarray(0,c):f},freeType:function(b){u(b.buffer)}}},{"./loop":24}],26:[function(l,m,r){m.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(f){return requestAnimationFrame(f)},
cancel:function(f){return cancelAnimationFrame(f)}}:{next:function(f){setTimeout(f,30)},cancel:clearTimeout}},{}],27:[function(l,m,r){var f=l("./pool"),e=new Float32Array(1),u=new Uint32Array(e.buffer);m.exports=function(h){for(var b=f.allocType(5123,h.length),c=0;c<h.length;++c)if(isNaN(h[c]))b[c]=65535;else if(Infinity===h[c])b[c]=31744;else if(-Infinity===h[c])b[c]=64512;else{e[0]=h[c];var l=u[0],m=l>>>31<<15,r=(l<<1>>>24)-127,l=l>>13&1023;b[c]=-24>r?m:-14>r?m+(l+1024>>-14-r):15<r?m+31744:m+(r+
15<<10)+l}return b}},{"./pool":25}],28:[function(l,m,r){m.exports=function(f){return Object.keys(f).map(function(e){return f[e]})}},{}],29:[function(l,m,r){function f(f,b){function c(){var b=window.innerWidth,c=window.innerHeight;f!==document.body&&(c=f.getBoundingClientRect(),b=c.right-c.left,c=c.top-c.bottom);l.width=r*b;l.height=r*c;u(l.style,{width:b+"px",height:c+"px"})}var l=document.createElement("canvas"),m=e(l,b);u(l.style,{border:0,margin:0,padding:0,top:0,left:0});f.appendChild(l);f===
document.body&&(l.style.position="absolute",u(f.style,{margin:0,padding:0}));var r=+m.options.pixelRatio;window.addEventListener("resize",c,!1);var E=m.options.onDestroy;m.options=u(u({},m.options),{onDestroy:function(){window.removeEventListener("resize",c);f.removeChild(l);E&&E()}});c();return m}function e(e,b){function c(b){try{return e.getContext(b,f)}catch(c){return null}}var f=b.glOptions||{};return{gl:c("webgl")||c("experimental-webgl")||c("webgl-experimental"),options:u({pixelRatio:window.devicePixelRatio},
b)}}var u=l("./util/extend");m.exports=function(h){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:h[0],options:h[1]||{}};var b=document.body,c=h[1]||{};if("string"===typeof h[0])b=document.querySelector(h[0])||document.body;else if("object"===typeof h[0])if(h[0]instanceof HTMLElement)b=h[0];else{if(h[0]instanceof WebGLRenderingContext)return{gl:h[0],options:u({pixelRatio:1},c)};c=h[0]}return b.nodeName&&"CANVAS"===b.nodeName.toUpperCase()?e(b,c):f(b,c)}},{"./util/extend":21}],
30:[function(l,m,r){function f(b){return b.charCodeAt(0)+(b.charCodeAt(1)<<8)+(b.charCodeAt(2)<<16)+(b.charCodeAt(3)<<24)}var e=f("DXT1"),u=f("DXT3"),h=f("DXT5"),b=f("DX10");m.exports=function(c){var f=new Int32Array(c,0,31);if(542327876!==f[0])throw Error("Invalid magic number in DDS header");if(!f[20]&4)throw Error("Unsupported format, must contain a FourCC code");var l,m=f[21];switch(m){case e:l=8;c="dxt1";break;case u:l=16;c="dxt3";break;case h:l=16;c="dxt5";break;case 116:c="rgba32f";break;case b:var r=
new Uint32Array(c.slice(128,148));c=r[0];if(3===r[1]&&2===c)c="rgba32f";else throw Error("Unsupported DX10 texture format "+c);break;default:throw Error("Unsupported FourCC code: "+String.fromCharCode(m&255,m>>8&255,m>>16&255,m>>24&255));}var r=f[2],C=1;r&131072&&(C=Math.max(1,f[7]));var n=!1;f[28]&512&&(n=!0);var v=f[4],y=f[3],f=f[1]+4,B=v,p=y,a=[];m===b&&(f+=20);if(n)for(l=0;6>l;l++){if("rgba32f"!==c)throw Error("Only RGBA32f cubemaps are supported");for(var v=B,y=p,O=Math.log(v)/Math.log(2)+1,
U=0;U<O;U++)m=v*y*16,a.push({offset:f,length:m,shape:[v,y]}),U<C&&(f+=m),v=Math.floor(v/2),y=Math.floor(y/2)}else for(U=0;U<C;U++)m=Math.max(4,v)/4*Math.max(4,y)/4*l,a.push({offset:f,length:m,shape:[v,y]}),f+=m,v=Math.floor(v/2),y=Math.floor(y/2);return{shape:[B,p],images:a,format:c,flags:r,cubemap:n}}},{}],31:[function(l,m,r){var f=l("./lib/util/extend"),e=l("./lib/dynamic"),u=l("./lib/util/raf"),h=l("./lib/util/clock"),b=l("./lib/strings"),c=l("./lib/webgl"),q=l("./lib/extension"),D=l("./lib/limits"),
ca=l("./lib/buffer"),E=l("./lib/elements"),C=l("./lib/texture"),n=l("./lib/renderbuffer"),v=l("./lib/framebuffer"),y=l("./lib/attribute"),B=l("./lib/shader"),p=l("./lib/read"),a=l("./lib/core");m.exports=function(){function l(){T=u.next(l);N.count+=1;var a=h();N.deltaTime=(a-V)/1E3;N.time=(a-R)/1E3;V=a;F();for(a=0;a<P.length;++a)(0,P[a])(N,null,0)}function m(a){}function r(a){}function w(a){function b(a){var c={},f={};Object.keys(a).forEach(function(b){var h=a[b];e.isDynamic(h)?f[b]=e.unbox(h,b):
c[b]=h});return{dynamic:f,"static":c}}function c(a){for(;p.length<a;)p.push(null);return p}var h=b(a.context||{}),l=b(a.uniforms||{}),m=b(a.attributes||{});a=b(function(a){function b(a){if(a in c){var e=c[a];delete c[a];Object.keys(e).forEach(function(b){c[a+"."+b]=e[b]})}}var c=f({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var h=ga.compile(a,m,l,h),n=h.draw,q=h.batch,w=h.scope,
p=[];return function(a,b){var e;if("function"===typeof a)return w.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(e=0;e<a;++e)w.call(this,null,b,e);else if(Array.isArray(a))for(e=0;e<a.length;++e)w.call(this,a[e],b,e);else return w.call(this,a,b,0);else if("number"===typeof a){if(0<a)return q.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return q.call(this,a,a.length)}else return n.call(this,a)}}function Q(){ga.procs.poll()}function F(){var a=ma.viewport,b=ma.scissor_box;
a[0]=a[1]=b[0]=b[1]=0;N.viewportWidth=N.frameBufferWidth=N.drawingBufferWidth=a[2]=b[2]=z.drawingBufferWidth;N.viewportHeight=N.frameBufferWidth=N.drawingBufferHeight=a[3]=b[3]=z.drawingBufferHeight;ga.procs.refresh()}var M=c(Array.prototype.slice.call(arguments)),z=M.gl,da=M.options,M=b(),H=q(z).extensions,R=h(),V=R,I=z.drawingBufferWidth,ea=z.drawingBufferHeight,N={count:0,deltaTime:0,time:0,viewportWidth:I,viewportHeight:ea,framebufferWidth:I,framebufferHeight:ea,drawingBufferWidth:I,drawingBufferHeight:ea,
pixelRatio:da.pixelRatio},J=D(z,H),K=ca(z),I=E(z,H,K),ea=y(z,H,J,K,M),fa=B(z,M),aa=C(z,H,J,Q,N),ka=n(z,H,J),la=v(z,H,J,aa,ka),sa=p(z,Q,N),ga=a(z,M,H,J,K,I,aa,la,{},ea,fa,{elements:null,primitive:4,count:-1,offset:0,instances:-1},N),ma=ga.next,S=z.canvas,P=[],T=0;S&&(S.addEventListener("webglcontextlost",m,!1),S.addEventListener("webglcontextrestored",r,!1));F();return f(w,{clear:function(a){var b=0;Q();var c=a.color;c&&(z.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(z.clearDepth(+a.depth),
b|=256);"stencil"in a&&(z.clearStencil(a.stencil|0),b|=1024);z.clear(b)},prop:e.define.bind(null,1),context:e.define.bind(null,2),"this":e.define.bind(null,3),draw:w({}),buffer:function(a){return K.create(a,34962)},elements:I.create,texture:aa.create2D,cube:aa.createCube,renderbuffer:ka.create,framebuffer:la.create,framebufferCube:function(a){},attributes:z.getContextAttributes(),frame:function(a){P.push(a);!T&&0<P.length&&l();return{cancel:function(){var b=P.find(function(b){return b===a});0>b||
(P.splice(b,1),0>=P.length&&T&&(u.cancel(l),T=0))}}},limits:J,hasExtension:function(a){return 0<=J.extensions.indexOf(a.toLowerCase())},read:sa,destroy:function(){T&&(u.cancel(l),T=0);S&&(S.removeEventListener("webglcontextlost",m),S.removeEventListener("webglcontextrestored",r));fa.clear();la.clear();ka.clear();aa.clear();K.clear();if(da.onDestroy)da.onDestroy()},_gl:z,_refresh:F})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,
"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/strings":17,"./lib/texture":18,"./lib/util/clock":19,"./lib/util/extend":21,"./lib/util/raf":26,"./lib/webgl":29}],32:[function(l,m,r){function f(b){throw Error("resl: "+b);}function e(b,c,e){Object.keys(b).forEach(function(b){0>c.indexOf(b)&&f('invalid parameter "'+b+'" in '+e)})}function u(b,c){this.state=0;this.ready=!1;this.progress=0;this.name=b;this.cancel=c}var h=["manifest","onDone","onProgress","onError"],
b=["type","src","stream","credentials","parser"],c=["onData","onDone"];m.exports=function(l){function m(a,b){if(a in l){var c=l[a];"function"!==typeof c&&f('invalid callback "'+a+'"');return c}return null}function r(b){function c(){if(!(2>m.readyState||1===p.state||-1===p.state)){if(200!==m.status)return C('error loading resource "'+b.name+'"');if(2<m.readyState&&0===p.state){var f;f="binary"===b.type?m.response:m.responseText;if(l.data)try{q=l.data(f)}catch(h){return C(h)}else q=f}if(3<m.readyState&&
0===p.state){if(l.done)try{q=l.done()}catch(h){return C(h)}p.state=1}a[e]=q;p.progress=.75*p.progress+.25;p.ready=b.stream&&!!q||1===p.state;n()}}var e=b.name,f=b.stream,h="binary"===b.type,l=b.parser,m=new XMLHttpRequest,q=null,p=new u(e,function(){1!==p.state&&-1!==p.state&&(m.onreadystatechange=null,m.abort(),p.state=-1)});m.onreadystatechange=f?c:function(){4===m.readyState&&c()};h&&(m.responseType="arraybuffer");b.credentials&&(m.withCredentials=!0);m.open("GET",b.src,!0);m.send();return p}function E(b,
c){function e(){if(0===r.state)if(q.data)try{v=q.data(c)}catch(a){return C(a)}else v=c}function f(c){e();a[p]=v;r.progress=c.lengthComputable?Math.max(r.progress,c.loaded/c.total):.75*r.progress+.25;r.ready=b.stream;n(p)}function h(){e();if(0===r.state){if(q.done)try{v=q.done()}catch(b){return C(b)}r.state=1}r.progress=1;r.ready=!0;a[p]=v;m();n("finish "+p)}function l(){C('error loading asset "'+p+'"')}function m(){b.stream&&c.removeEventListener("progress",f);"image"===b.type?c.addEventListener("load",
h):c.addEventListener("canplay",h);c.removeEventListener("error",l)}var p=b.name,q=b.parser,r=new u(p,function(){1!==r.state&&-1!==r.state&&(r.state=-1,m(),c.src="")}),v=c;b.stream&&c.addEventListener("progress",f);"image"===b.type?c.addEventListener("load",h):c.addEventListener("canplay",h);c.addEventListener("error",l);c.crossOrigin=b.credentials?"use-credentials":"anonymous";c.src=b.src;return r}function C(a){-1!==O&&1!==O&&(O=-1,L.forEach(function(a){a.cancel()}),p?"string"===typeof a?p(Error("resl: "+
a)):p(a):console.error("resl error:",a))}function n(b){if(-1!==O&&1!==O){var c=0,e=0;L.forEach(function(a){a.ready&&(e+=1);c+=a.progress});e===L.length?(O=1,y(a)):B&&B(c/L.length,b)}}"object"===typeof l&&l||f("invalid or missing configuration");e(l,h,"config");var v=l.manifest;"object"===typeof v&&v||f("missing manifest");var y=m("onDone");y||f("missing onDone() callback");var B=m("onProgress"),p=m("onError"),a={},O=0,U={text:r,binary:function(a){return r(a)},image:function(a){return E(a,document.createElement("img"))},
video:function(a){return E(a,document.createElement("video"))},audio:function(a){return E(a,document.createElement("audio"))}},L=Object.keys(v).map(function(a){function h(a,b){if(a in l.parser){var c=l.parser[a];"function"!==typeof c&&f("invalid parser callback "+a+' for asset "'+a+'"');return c}return b}var l=v[a];"string"===typeof l?l={src:l}:"object"===typeof l&&l||f('invalid asset definition "'+a+'"');e(l,b,'asset "'+a+'"');var m={};"parser"in l&&("function"===typeof l.parser?m={data:l.parser}:
"object"===typeof l.parser&&l.parser?(e(m,c,'parser for asset "'+a+'"'),"onData"in m||f('missing onData callback for parser in asset "'+a+'"'),m={data:h("onData"),done:h("onDone")}):f('invalid parser for asset "'+a+'"'));return{name:a,type:function(b,c,e){b in l&&(e=l[b]);0>c.indexOf(e)&&f("invalid "+b+' "'+e+'" for asset "'+a+'", possible values: '+c);return e}("type",Object.keys(U),"text"),stream:!!l.stream,credentials:!!l.credentials,src:function(b,c,e){b in l?e=l[b]:c&&f("missing "+b+' for asset "'+
a+'"');"string"!==typeof e&&f("invalid "+b+' for asset "'+a+'", must be a string');return e}("src",!0,""),parser:m}}).map(function(a){return U[a.type](a)})}},{}]},{},[1]);
