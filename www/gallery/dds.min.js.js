(function e$$0(l,w,g){function d(f,c){if(!w[f]){if(!l[f]){var b="function"==typeof require&&require;if(!c&&b)return b(f,!0);if(C)return C(f,!0);b=Error("Cannot find module '"+f+"'");throw b.code="MODULE_NOT_FOUND",b;}b=w[f]={exports:{}};l[f][0].call(b.exports,function(c){var b=l[f][1][c];return d(b?b:c)},b,b.exports,e$$0,l,w,g)}return w[f].exports}for(var C="function"==typeof require&&require,x=0;x<g.length;x++)d(g[x]);return d})({1:[function(h,l,w){var g=h("../regl")({extensions:"WEBGL_compressed_texture_s3tc"}),
d=h("parse-dds");h("resl")({manifest:{diffuse:{type:"binary",src:"assets/alpine_cliff_a.dds",parser:function(C){var x=d(C),f=x.images[0];return g.texture({format:"rgba s3tc "+x.format,shape:x.shape,mag:"linear",data:new Uint8Array(C,f.offset,f.length)})}},specular:{type:"image",src:"assets/alpine_cliff_a_spec.png",parser:function(d){return g.texture({mag:"linear",data:d})}},normals:{type:"image",src:"assets/alpine_cliff_a_norm.png",parser:function(d){return g.texture({mag:"linear",data:d})}}},onDone:function(d){var x=
g({frag:"\n      precision mediump float;\n      uniform sampler2D specular, normals, diffuse;\n      varying vec3 lightDir, eyeDir;\n      varying vec2 uv;\n      void main () {\n        float d = length(lightDir);\n        vec3 L = normalize(lightDir);\n        vec3 E = normalize(eyeDir);\n        vec3 N = normalize(2.0 * texture2D(normals, uv).rgb - 1.0);\n        N = vec3(-N.x, N.yz);\n        vec3 D = texture2D(diffuse, uv).rgb;\n        vec3 kD = D * (0.01 +\n          max(0.0, dot(L, N) * (0.6 + 0.8 / d) ));\n        vec3 S = texture2D(specular, uv).rgb;\n        vec3 kS = 2.0 * pow(max(0.0, dot(normalize(N + L), -E)), 10.0) * S;\n        gl_FragColor = vec4(kD + kS, 1);\n      }",
vert:"\n      precision mediump float;\n      attribute vec2 position;\n      uniform vec2 lightPosition;\n      varying vec3 lightDir, eyeDir;\n      varying vec2 uv;\n      void main () {\n        vec2 P = 1.0 - 2.0 * position;\n        uv = vec2(position.x, 1.0 - position.y);\n        eyeDir = -vec3(P, 1);\n        lightDir = vec3(lightPosition - P, 1);\n        gl_Position = vec4(P, 0, 1);\n      }",attributes:{position:[-2,0,0,-2,2,2]},uniforms:{specular:d.specular,normals:d.normals,diffuse:d.diffuse,
lightPosition:function(f){f=.025*f.tick;return[2*Math.cos(f),2*Math.sin(f)]}},count:3});g.frame(function(){x()})}})},{"../regl":35,"parse-dds":33,resl:34}],2:[function(h,l,w){function g(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}l.exports=function(d,C,x,f,c){d=x.maxAttributes;C=Array(d);for(x=0;x<d;++x)C[x]=new g;return{Record:g,scope:{},state:C}}},{}],3:[function(h,l,w){function g(c){return A[Object.prototype.toString.call(c)]|
0}function d(c,f){for(var b=0;b<f.length;++b)c[b]=f[b]}function C(c,f,b,d,g,n,u){for(var x=0,a=0;a<b;++a)for(var q=0;q<d;++q)c[x++]=f[g*a+n*q+u]}function x(c,f,b){for(var d=0,g=0;g<f.length;++g)for(var n=f[g],u=0;u<b;++u)c[d++]=n[u]}var f=h("./util/is-typed-array"),c=h("./util/is-ndarray"),b=h("./util/values"),u=h("./util/pool"),A=h("./constants/arraytypes.json"),I=h("./constants/dtypes.json"),z=h("./constants/usage.json"),n=[];n[5120]=1;n[5122]=2;n[5124]=4;n[5121]=1;n[5123]=2;n[5125]=4;n[5126]=4;
l.exports=function(p,h,E){function k(a){this.id=G++;this.buffer=p.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;E.profile&&(this.stats={size:0})}function m(a,c,f){a.byteLength=c.byteLength;p.bufferData(a.type,c,f)}function L(a,b,q,k,n,p){a.usage=q;if(Array.isArray(b))a.dtype=k||5126,0<b.length&&(Array.isArray(b[0])?(a.dimension=b[0].length,k=u.allocType(a.dtype,b.length*a.dimension),x(k,b,a.dimension),m(a,k,q),p?a.persistentData=
k:u.freeType(k)):"number"===typeof b[0]?(a.dimension=n,k=u.allocType(a.dtype,b.length),d(k,b),m(a,k,q),p?a.persistentData=k:u.freeType(k)):f(b[0])&&(a.dimension=b[0].length,a.dtype=k||g(b[0])||5126,k=u.allocType(a.dtype,b.length*a.dimension),x(k,b,a.dimension),m(a,k,q),p?a.persistentData=k:u.freeType(k)));else if(f(b))a.dtype=k||g(b),a.dimension=n,m(a,b,q),p&&(a.persistentData=new Uint8Array(new Uint8Array(b.buffer)));else if(c(b)){var h=b.shape,N=b.stride;n=b.offset;var F=0,z=0,r=0,aa=0;1===h.length?
(F=h[0],z=1,r=N[0],aa=0):2===h.length&&(F=h[0],z=h[1],r=N[0],aa=N[1]);a.dtype=k||g(b.data)||5126;a.dimension=z;k=u.allocType(a.dtype,F*z);C(k,b.data,F,z,r,aa,n);m(a,k,q);p?a.persistentData=k:u.freeType(k)}}function F(b){h.bufferCount--;p.deleteBuffer(b.buffer);b.buffer=null;delete a[b.id]}var G=0,a={};k.prototype.bind=function(){p.bindBuffer(this.type,this.buffer)};k.prototype.destroy=function(){F(this)};var q=[];E.profile&&(h.getTotalBufferSize=function(){var b=0;Object.keys(a).forEach(function(c){b+=
a[c].stats.size});return b});return{create:function(b,q,m,G){function l(a){var b=35044,d=null,k=0,g=0,q=1;Array.isArray(a)||f(a)||c(a)?d=a:"number"===typeof a?k=a|0:a&&("data"in a&&(d=a.data),"usage"in a&&(b=z[a.usage]),"type"in a&&(g=I[a.type]),"dimension"in a&&(q=a.dimension|0),"length"in a&&(k=a.length|0));A.bind();d?L(A,d,b,g,q,G):(p.bufferData(A.type,k,b),A.dtype=g||5121,A.usage=b,A.dimension=q,A.byteLength=k);E.profile&&(A.stats.size=A.byteLength*n[A.dtype]);return l}h.bufferCount++;var A=new k(q);
a[A.id]=A;m||l(b);l._reglType="buffer";l._buffer=A;l.subdata=function(a,b){var k=(b||0)|0;A.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var q=u.allocType(A.dtype,a.length);d(q,a);p.bufferSubData(A.type,k,q);u.freeType(q)}else if(Array.isArray(a[0])||f(a[0])){var q=a[0].length,r=u.allocType(A.dtype,a.length*q);x(r,a,q);p.bufferSubData(A.type,k,r);u.freeType(r)}}else if(f(a))p.bufferSubData(A.type,k,a);else if(c(a)){var m=a.shape,n=a.stride,h=r=q=0,V=0;1===m.length?(q=m[0],
r=1,h=n[0],V=0):2===m.length&&(q=m[0],r=m[1],h=n[0],V=n[1]);m=Array.isArray(a.data)?A.dtype:g(a.data);m=u.allocType(m,q*r);C(m,a.data,q,r,h,V,a.offset);p.bufferSubData(A.type,k,m);u.freeType(m)}return l};E.profile&&(l.stats=A.stats);l.destroy=function(){F(A)};return l},createStream:function(a,b){var c=q.pop();c||(c=new k(a));c.bind();L(c,b,35040,0,1,!1);return c},destroyStream:function(a){q.push(a)},clear:function(){b(a).forEach(F);q.forEach(F)},getBuffer:function(a){return a&&a._buffer instanceof
k?a._buffer:null},restore:function(){b(a).forEach(function(a){a.buffer=p.createBuffer();p.bindBuffer(a.type,a.buffer);p.bufferData(a.type,a.persistentData||a.byteLength,a.usage)})},_initBuffer:L}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],4:[function(h,l,w){l.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,
"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(h,l,w){l.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(h,l,w){l.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(h,l,w){l.exports={"static":35044,
dynamic:35048,stream:35040}},{}],8:[function(h,l,w){function g(a){return Array.isArray(a)||A(a)||I(a)}function d(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function C(a,b,c,f){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=f}function x(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function f(a){return new C(!1,!1,!1,a)}function c(a,b){var c=a.type;return 0===c?(c=a.data.length,new C(!0,1<=c,2<=c,b)):4===c?(c=a.data,new C(c.thisDep,c.contextDep,
c.propDep,b)):new C(3===c,2===c,1===c,b)}var b=h("./util/codegen"),u=h("./util/loop"),A=h("./util/is-typed-array"),I=h("./util/is-ndarray"),z=h("./util/is-array-like"),n=h("./dynamic"),p=h("./constants/primitives.json"),J=h("./constants/dtypes.json"),E=["x","y","z","w"],k="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),m={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,
"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},L={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},F={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,
invert:5386},G={cw:2304,ccw:2305},a=new C(!1,!1,!1,function(){});l.exports=function(q,h,A,l,I,D,w,M,N,ka,qa,r,aa,ba,ha){function W(a){return a.replace(".","_")}function P(a,e,b){var c=W(a);Ga.push(a);za[c]=ra[c]=!!b;sa[c]=e}function H(a,e,b){var c=W(a);Ga.push(a);Array.isArray(b)?(ra[c]=b.slice(),za[c]=b.slice()):ra[c]=za[c]=b;ta[c]=e}function ua(){var a=b(),e=a.link,c=a.global;a.id=Ma++;a.batchId="0";var f=e(La),k=a.shared={props:"a0"};Object.keys(La).forEach(function(a){k[a]=c.def(f,".",a)});var d=
a.next={},T=a.current={};Object.keys(ta).forEach(function(a){Array.isArray(ra[a])&&(d[a]=c.def(k.next,".",a),T[a]=c.def(k.current,".",a))});var Na=a.constants={};Object.keys(Ha).forEach(function(a){Na[a]=c.def(JSON.stringify(Ha[a]))});a.invoke=function(B,O){switch(O.type){case 0:var b=["this",k.context,k.props,a.batchId];return B.def(e(O.data),".call(",b.slice(0,Math.max(O.data.length+1,4)),")");case 1:return B.def(k.props,O.data);case 2:return B.def(k.context,O.data);case 3:return B.def("this",O.data);
case 4:return O.data.append(a,B),O.data.ref}};a.attribCache={};var B={};a.scopeAttrib=function(a){a=h.id(a);if(a in B)return B[a];var y=ka.scope[a];y||(y=ka.scope[a]=new t);return B[a]=e(y)};return a}function la(a){var e=a["static"];a=a.dynamic;var b;if("profile"in e){var k=!!e.profile;b=f(function(a,e){return k});b.enable=k}else if("profile"in a){var d=a.profile;b=c(d,function(a,e){return a.invoke(e,d)})}return b}function va(a,e){var b=a["static"],k=a.dynamic;if("framebuffer"in b){var d=b.framebuffer;
return d?(d=M.getFramebuffer(d),f(function(a,e){var B=a.link(d),b=a.shared;e.set(b.framebuffer,".next",B);b=b.context;e.set(b,".framebufferWidth",B+".width");e.set(b,".framebufferHeight",B+".height");return B})):f(function(a,e){var B=a.shared;e.set(B.framebuffer,".next","null");B=B.context;e.set(B,".framebufferWidth",B+".drawingBufferWidth");e.set(B,".framebufferHeight",B+".drawingBufferHeight");return"null"})}if("framebuffer"in k){var g=k.framebuffer;return c(g,function(a,e){var B=a.invoke(e,g),
b=a.shared,y=b.framebuffer,B=e.def(y,".getFramebuffer(",B,")");e.set(y,".next",B);b=b.context;e.set(b,".framebufferWidth",B+"?"+B+".width:"+b+".drawingBufferWidth");e.set(b,".framebufferHeight",B+"?"+B+".height:"+b+".drawingBufferHeight");return B})}return null}function R(a,e,b){function f(a){if(a in k){var B=k[a];a=!0;var b=B.x|0,O=B.y|0,y,g;"width"in B?y=B.width|0:a=!1;"height"in B?g=B.height|0:a=!1;return new C(!a&&e&&e.thisDep,!a&&e&&e.contextDep,!a&&e&&e.propDep,function(a,e){var c=a.shared.context,
K=y;"width"in B||(K=e.def(c,".","framebufferWidth","-",b));var f=g;"height"in B||(f=e.def(c,".","framebufferHeight","-",O));return[b,O,K,f]})}if(a in d){var T=d[a];a=c(T,function(a,e){var B=a.invoke(e,T),b=a.shared.context,O=e.def(B,".x|0"),y=e.def(B,".y|0"),c=e.def('"width" in ',B,"?",B,".width|0:","(",b,".","framebufferWidth","-",O,")"),B=e.def('"height" in ',B,"?",B,".height|0:","(",b,".","framebufferHeight","-",y,")");return[O,y,c,B]});e&&(a.thisDep=a.thisDep||e.thisDep,a.contextDep=a.contextDep||
e.contextDep,a.propDep=a.propDep||e.propDep);return a}return e?new C(e.thisDep,e.contextDep,e.propDep,function(a,e){var B=a.shared.context;return[0,0,e.def(B,".","framebufferWidth"),e.def(B,".","framebufferHeight")]}):null}var k=a["static"],d=a.dynamic;if(a=f("viewport")){var g=a;a=new C(a.thisDep,a.contextDep,a.propDep,function(a,e){var b=g.append(a,e),O=a.shared.context;e.set(O,".viewportWidth",b[2]);e.set(O,".viewportHeight",b[3]);return b})}return{viewport:a,scissor_box:f("scissor.box")}}function da(a){function e(a){if(a in
b){var B=h.id(b[a]);a=f(function(){return B});a.id=B;return a}if(a in k){var y=k[a];return c(y,function(a,e){var B=a.invoke(e,y);return e.def(a.shared.strings,".id(",B,")")})}return null}var b=a["static"],k=a.dynamic,d=e("frag"),g=e("vert"),T=null;x(d)&&x(g)?(T=qa.program(g.id,d.id),a=f(function(a,e){return a.link(T)})):a=new C(d&&d.thisDep||g&&g.thisDep,d&&d.contextDep||g&&g.contextDep,d&&d.propDep||g&&g.propDep,function(a,e){var b=a.shared.shader,O;O=d?d.append(a,e):e.def(b,".","frag");var y;y=
g?g.append(a,e):e.def(b,".","vert");return e.def(b+".program("+y+","+O+")")});return{frag:d,vert:g,progVar:a,program:T}}function ea(a,e){function b(a,e){if(a in d){var y=d[a]|0;return f(function(a,b){e&&(a.OFFSET=y);return y})}if(a in k){var O=k[a];return c(O,function(a,b){var y=a.invoke(b,O);e&&(a.OFFSET=y);return y})}return e&&t?f(function(a,e){a.OFFSET="0";return 0}):null}var d=a["static"],k=a.dynamic,t=function(){if("elements"in d){var a=d.elements;g(a)?a=D.getElements(D.create(a,!0)):a&&(a=D.getElements(a));
var e=f(function(e,b){if(a){var B=e.link(a);return e.ELEMENTS=B}return e.ELEMENTS=null});e.value=a;return e}if("elements"in k){var b=k.elements;return c(b,function(a,e){var B=a.shared,y=B.isBufferArgs,B=B.elements,c=a.invoke(e,b),K=e.def("null"),y=e.def(y,"(",c,")"),c=a.cond(y).then(K,"=",B,".createStream(",c,");")["else"](K,"=",B,".getElements(",c,");");e.entry(c);e.exit(a.cond(y).then(B,".destroyStream(",K,");"));return a.ELEMENTS=K})}return null}(),T=b("offset",!0);return{elements:t,primitive:function(){if("primitive"in
d){var a=d.primitive;return f(function(e,b){return p[a]})}if("primitive"in k){var e=k.primitive;return c(e,function(a,b){var y=a.constants.primTypes,c=a.invoke(b,e);return b.def(y,"[",c,"]")})}return t?x(t)?t.value?f(function(a,e){return e.def(a.ELEMENTS,".primType")}):f(function(){return 4}):new C(t.thisDep,t.contextDep,t.propDep,function(a,e){var b=a.ELEMENTS;return e.def(b,"?",b,".primType:",4)}):null}(),count:function(){if("count"in d){var a=d.count|0;return f(function(){return a})}if("count"in
k){var e=k.count;return c(e,function(a,b){return a.invoke(b,e)})}return t?x(t)?t?T?new C(T.thisDep,T.contextDep,T.propDep,function(a,e){return e.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):f(function(a,e){return e.def(a.ELEMENTS,".vertCount")}):f(function(){return-1}):new C(t.thisDep||T.thisDep,t.contextDep||T.contextDep,t.propDep||T.propDep,function(a,e){var b=a.ELEMENTS;return a.OFFSET?e.def(b,"?",b,".vertCount-",a.OFFSET,":-1"):e.def(b,"?",b,".vertCount:-1")}):null}(),instances:b("instances",!1),
offset:T}}function oa(a,e){var b=a["static"],d=a.dynamic,k={};Ga.forEach(function(a){function e(B,K){if(a in b){var O=B(b[a]);k[y]=f(function(){return O})}else if(a in d){var g=d[a];k[y]=c(g,function(a,e){return K(a,e,a.invoke(e,g))})}}var y=W(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return e(function(a){return a},function(a,
e,b){return b});case "depth.func":return e(function(a){return L[a]},function(a,e,b){return e.def(a.constants.compareFuncs,"[",b,"]")});case "depth.range":return e(function(a){return a},function(a,e,b){a=e.def("+",b,"[0]");e=e.def("+",b,"[1]");return[a,e]});case "blend.func":return e(function(a){return[m["srcRGB"in a?a.srcRGB:a.src],m["dstRGB"in a?a.dstRGB:a.dst],m["srcAlpha"in a?a.srcAlpha:a.src],m["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,e,b){function y(a,B){return e.def('"',a,B,'" in ',b,"?",
b,".",a,B,":",b,".",a)}a=a.constants.blendFuncs;var c=y("src","RGB"),K=y("dst","RGB"),c=e.def(a,"[",c,"]"),d=e.def(a,"[",y("src","Alpha"),"]"),K=e.def(a,"[",K,"]");a=e.def(a,"[",y("dst","Alpha"),"]");return[c,K,d,a]});case "blend.equation":return e(function(a){if("string"===typeof a)return[ma[a],ma[a]];if("object"===typeof a)return[ma[a.rgb],ma[a.alpha]]},function(a,e,b){var y=a.constants.blendEquations,c=e.def(),K=e.def();a=a.cond("typeof ",b,'==="string"');a.then(c,"=",K,"=",y,"[",b,"];");a["else"](c,
"=",y,"[",b,".rgb];",K,"=",y,"[",b,".alpha];");e(a);return[c,K]});case "blend.color":return e(function(a){return u(4,function(e){return+a[e]})},function(a,e,b){return u(4,function(a){return e.def("+",b,"[",a,"]")})});case "stencil.mask":return e(function(a){return a|0},function(a,e,b){return e.def(b,"|0")});case "stencil.func":return e(function(a){return[L[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,e,b){a=e.def('"cmp" in ',b,"?",a.constants.compareFuncs,"[",b,".cmp]",":",7680);var y=
e.def(b,".ref|0");e=e.def('"mask" in ',b,"?",b,".mask|0:-1");return[a,y,e]});case "stencil.opFront":case "stencil.opBack":return e(function(e){return["stencil.opBack"===a?1029:1028,F[e.fail||"keep"],F[e.zfail||"keep"],F[e.zpass||"keep"]]},function(e,b,y){function c(a){return b.def('"',a,'" in ',y,"?",K,"[",y,".",a,"]:",7680)}var K=e.constants.stencilOps;return["stencil.opBack"===a?1029:1028,c("fail"),c("zfail"),c("zpass")]});case "polygonOffset.offset":return e(function(a){return[a.factor|0,a.units|
0]},function(a,e,b){a=e.def(b,".factor|0");e=e.def(b,".units|0");return[a,e]});case "cull.face":return e(function(a){var e=0;"front"===a?e=1028:"back"===a&&(e=1029);return e},function(a,e,b){return e.def(b,'==="front"?',1028,":",1029)});case "lineWidth":return e(function(a){return a},function(a,e,b){return b});case "frontFace":return e(function(a){return G[a]},function(a,e,b){return e.def(b+'==="cw"?2304:2305')});case "colorMask":return e(function(a){return a.map(function(a){return!!a})},function(a,
e,b){return u(4,function(a){return"!!"+b+"["+a+"]"})});case "sample.coverage":return e(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,e,b){a=e.def('"value" in ',b,"?+",b,".value:1");e=e.def("!!",b,".invert");return[a,e]})}});return k}function fa(a,e){var b=a["static"],d=a.dynamic,k={};Object.keys(b).forEach(function(a){var e=b[a],y;if("number"===typeof e||"boolean"===typeof e)y=f(function(){return e});else if("function"===typeof e){var c=e._reglType;if("texture2d"===c||"textureCube"===
c)y=f(function(a){return a.link(e)});else if("framebuffer"===c||"framebufferCube"===c)y=f(function(a){return a.link(e.color[0])})}else z(e)&&(y=f(function(a){return a.global.def("[",u(e.length,function(a){return e[a]}),"]")}));y.value=e;k[a]=y});Object.keys(d).forEach(function(a){var e=d[a];k[a]=c(e,function(a,b){return a.invoke(b,e)})});return k}function X(a,e){var b=a["static"],d=a.dynamic,k={};Object.keys(b).forEach(function(a){var e=b[a],y=h.id(a),c=new t;if(g(e))c.state=1,c.buffer=I.getBuffer(I.create(e,
34962,!1,!0)),c.type=c.buffer.dtype;else{var K=I.getBuffer(e);if(K)c.state=1,c.buffer=K,c.type=K.dtype;else if(e.constant){var d=e.constant;c.buffer="null";c.state=2;"number"===typeof d?c.x=d:E.forEach(function(a,e){e<d.length&&(c[a]=d[e])})}else{var K=g(e.buffer)?I.getBuffer(I.create(e.buffer,34962,!1,!0)):I.getBuffer(e.buffer),v=e.offset|0,m=e.stride|0,q=e.size|0,r=!!e.normalized,n=0;"type"in e&&(n=J[e.type]);e=e.divisor|0;c.buffer=K;c.state=1;c.size=q;c.normalized=r;c.type=n||K.dtype;c.offset=
v;c.stride=m;c.divisor=e}}k[a]=f(function(a,e){var b=a.attribCache;if(y in b)return b[y];var K={isStream:!1};Object.keys(c).forEach(function(a){K[a]=c[a]});c.buffer&&(K.buffer=a.link(c.buffer));return b[y]=K})});Object.keys(d).forEach(function(a){var e=d[a];k[a]=c(e,function(a,b){function c(a){b(f[a],"=",y,".",a,"|0;")}var y=a.invoke(b,e),K=a.shared,d=K.isBufferArgs,k=K.buffer,f={isStream:b.def(!1)},g=new t;g.state=1;Object.keys(g).forEach(function(a){f[a]=b.def(""+g[a])});var v=f.buffer,m=f.type;
b("if(",d,"(",y,")){",f.isStream,"=true;",v,"=",k,".createStream(",34962,",",y,");",m,"=",v,".dtype;","}else{",v,"=",k,".getBuffer(",y,");","if(",v,"){",m,"=",v,".dtype;",'}else if("constant" in ',y,"){",f.state,"=",2,";","if(typeof "+y+'.constant === "number"){',f[E[0]],"=",y,".constant;",E.slice(1).map(function(a){return f[a]}).join("="),"=0;","}else{",E.map(function(a,e){return f[a]+"="+y+".constant.length>="+e+"?"+y+".constant["+e+"]:0;"}).join(""),"}}else{","if(",d,"(",y,".buffer)){",v,"=",k,
".createStream(",34962,",",y,".buffer);","}else{",v,"=",k,".getBuffer(",y,".buffer);","}",m,'="type" in ',y,"?",K.glTypes,"[",y,".type]:",v,".dtype;",f.normalized,"=!!",y,".normalized;");c("size");c("offset");c("stride");c("divisor");b("}}");b.exit("if(",f.isStream,"){",k,".destroyStream(",v,");","}");return f})});return k}function pa(a){var e=a["static"],b=a.dynamic,d={};Object.keys(e).forEach(function(a){var b=e[a];d[a]=f(function(a,e){return"number"===typeof b||"boolean"===typeof b?""+b:a.link(b)})});
Object.keys(b).forEach(function(a){var e=b[a];d[a]=c(e,function(a,b){return a.invoke(b,e)})});return d}function na(a,e,b,c,d){var f=va(a,d),k=R(a,f,d),g=ea(a,d),t=oa(a,d),v=da(a,d),m=k.viewport;m&&(t.viewport=m);m=W("scissor.box");(k=k[m])&&(t[m]=k);k=0<Object.keys(t).length;f={framebuffer:f,draw:g,shader:v,state:t,dirty:k};f.profile=la(a,d);f.uniforms=fa(b,d);f.attributes=X(e,d);f.context=pa(c,d);return f}function S(a,e,b){var c=a.shared.context,d=a.scope();Object.keys(b).forEach(function(f){e.save(c,
"."+f);d(c,".",f,"=",b[f].append(a,e),";")});e(d)}function ga(a,e,b,c){var d=a.shared,f=d.gl,k=d.framebuffer,g;Ia&&(g=e.def(d.extensions,".webgl_draw_buffers"));var t=a.constants,d=t.drawBuffer,t=t.backBuffer;a=b?b.append(a,e):e.def(k,".next");c||e("if(",a,"!==",k,".cur){");e("if(",a,"){",f,".bindFramebuffer(",36160,",",a,".framebuffer);");Ia&&e(g,".drawBuffersWEBGL(",d,"[",a,".colorAttachments.length]);");e("}else{",f,".bindFramebuffer(",36160,",null);");Ia&&e(g,".drawBuffersWEBGL(",t,");");e("}",
k,".cur=",a,";");c||e("}")}function ia(a,e,b){var c=a.shared,d=c.gl,f=a.current,k=a.next,g=c.current,t=c.next,v=a.cond(g,".dirty");Ga.forEach(function(e){e=W(e);if(!(e in b.state)){var c,K;if(e in k){c=k[e];K=f[e];var m=u(ra[e].length,function(a){return v.def(c,"[",a,"]")});v(a.cond(m.map(function(a,e){return a+"!=="+K+"["+e+"]"}).join("||")).then(d,".",ta[e],"(",m,");",m.map(function(a,e){return K+"["+e+"]="+a}).join(";"),";"))}else c=v.def(t,".",e),m=a.cond(c,"!==",g,".",e),v(m),e in sa?m(a.cond(c).then(d,
".enable(",sa[e],");")["else"](d,".disable(",sa[e],");"),g,".",e,"=",c,";"):m(d,".",ta[e],"(",c,");",g,".",e,"=",c,";")}});0===Object.keys(b.state).length&&v(g,".dirty=false;");e(v)}function Q(a,e,b,c){var f=a.shared,k=a.current,g=f.current,t=f.gl;d(Object.keys(b)).forEach(function(d){var f=b[d];if(!c||c(f)){var v=f.append(a,e);if(sa[d]){var m=sa[d];x(f)?v?e(t,".enable(",m,");"):e(t,".disable(",m,");"):e(a.cond(v).then(t,".enable(",m,");")["else"](t,".disable(",m,");"));e(g,".",d,"=",v,";")}else if(z(v)){var q=
k[d];e(t,".",ta[d],"(",v,");",v.map(function(a,e){return q+"["+e+"]="+a}).join(";"),";")}else e(t,".",ta[d],"(",v,");",g,".",d,"=",v,";")}})}function U(a,e){Aa&&!a.instancing&&(a.instancing=e.def(a.shared.extensions,".angle_instanced_arrays"))}function Y(a,e,b,c,d){function f(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function k(a){n=e.def();a(n,"=",f(),";");"string"===typeof d?a(m,".count+=",d,";"):a(m,".count++;");ba&&(c?(h=e.def(),a(h,"=",r,".getNumPendingQueries();")):
a(r,".beginQuery(",m,");"))}function g(a){a(m,".cpuTime+=",f(),"-",n,";");ba&&(c?a(r,".pushScopeStats(",h,",",r,".getNumPendingQueries(),",m,");"):a(r,".endQuery();"))}function t(a){var b=e.def(q,".profile");e(q,".profile=",a,";");e.exit(q,".profile=",b,";")}var v=a.shared,m=a.stats,q=v.current,r=v.timer;b=b.profile;var n,h;if(b){if(x(b)){b.enable?(k(e),g(e.exit),t("true")):t("false");return}b=b.append(a,e);t(b)}else b=e.def(q,".profile");v=a.block();k(v);e("if(",b,"){",v,"}");a=a.block();g(a);e.exit("if(",
b,"){",a,"}")}function Z(e,b,c,d,f){function k(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function g(a,c,d){function f(){b("if(!",q,".buffer){",t,".enableVertexAttribArray(",m,");}");var a=d.type,k;k=d.size?b.def(d.size,"||",c):c;b("if(",q,".type!==",a,"||",q,".size!==",k,"||",h.map(function(a){return q+"."+a+"!=="+d[a]}).join("||"),"){",t,".bindBuffer(",34962,",",r,".buffer);",t,".vertexAttribPointer(",
[m,k,a,d.normalized,d.stride,d.offset],");",q,".type=",a,";",q,".size=",k,";",h.map(function(a){return q+"."+a+"="+d[a]+";"}).join(""),"}");Aa&&(a=d.divisor,b("if(",q,".divisor!==",a,"){",e.instancing,".vertexAttribDivisorANGLE(",[m,a],");",q,".divisor=",a,";}"))}function k(){b("if(",q,".buffer){",t,".disableVertexAttribArray(",m,");","}if(",E.map(function(a,e){return q+"."+a+"!=="+n[e]}).join("||"),"){",t,".vertexAttrib4f(",m,",",n,");",E.map(function(a,e){return q+"."+a+"="+n[e]+";"}).join(""),
"}")}var t=v.gl,m=b.def(a,".location"),q=b.def(v.attributes,"[",m,"]");a=d.state;var r=d.buffer,n=[d.x,d.y,d.z,d.w],h=["buffer","normalized","offset","stride"];1===a?f():2===a?k():(b("if(",a,"===",1,"){"),f(),b("}else{"),k(),b("}"))}var v=e.shared;d.forEach(function(d){var v=d.name,m=c.attributes[v],q;if(m){if(!f(m))return;q=m.append(e,b)}else{if(!f(a))return;var r=e.scopeAttrib(v);q={};Object.keys(new t).forEach(function(a){q[a]=b.def(r,".",a)})}g(e.link(d),k(d.info.type),q)})}function ca(e,b,c,
d,f){for(var k=e.shared,g=k.gl,t,v=0;v<d.length;++v){var m=d[v],q=m.name,r=m.info.type,n=c.uniforms[q],m=e.link(m)+".location",p;if(n){if(!f(n))continue;if(x(n)){q=n.value;if(35678===r||35680===r)r=e.link(q._texture||q.color[0]._texture),b(g,".uniform1i(",m,",",r+".bind());"),b.exit(r,".unbind();");else if(35674===r||35675===r||35676===r)q=e.global.def("new Float32Array(["+Array.prototype.slice.call(q)+"])"),n=2,35675===r?n=3:35676===r&&(n=4),b(g,".uniformMatrix",n,"fv(",m,",false,",q,");");else{switch(r){case 5126:t=
"1f";break;case 35664:t="2f";break;case 35665:t="3f";break;case 35666:t="4f";break;case 35670:t="1i";break;case 5124:t="1i";break;case 35671:t="2i";break;case 35667:t="2i";break;case 35672:t="3i";break;case 35668:t="3i";break;case 35673:t="4i";break;case 35669:t="4i"}b(g,".uniform",t,"(",m,",",z(q)?Array.prototype.slice.call(q):q,");")}continue}else p=n.append(e,b)}else{if(!f(a))continue;p=b.def(k.uniforms,"[",h.id(q),"]")}35678===r?b("if(",p,"&&",p,'._reglType==="framebuffer"){',p,"=",p,".color[0];",
"}"):35680===r&&b("if(",p,"&&",p,'._reglType==="framebufferCube"){',p,"=",p,".color[0];","}");q=1;switch(r){case 35678:case 35680:r=b.def(p,"._texture");b(g,".uniform1i(",m,",",r,".bind());");b.exit(r,".unbind();");continue;case 5124:case 35670:t="1i";break;case 35667:case 35671:t="2i";q=2;break;case 35668:case 35672:t="3i";q=3;break;case 35669:case 35673:t="4i";q=4;break;case 5126:t="1f";break;case 35664:t="2f";q=2;break;case 35665:t="3f";q=3;break;case 35666:t="4f";q=4;break;case 35674:t="Matrix2fv";
break;case 35675:t="Matrix3fv";break;case 35676:t="Matrix4fv"}b(g,".uniform",t,"(",m,",");if("M"===t.charAt(0)){var m=Math.pow(r-35674+2,2),N=e.global.def("new Float32Array(",m,")");b("false,(Array.isArray(",p,")||",p," instanceof Float32Array)?",p,":(",u(m,function(a){return N+"["+a+"]="+p+"["+a+"]"}),",",N,")")}else 1<q?b(u(q,function(a){return p+"["+a+"]"})):b(p);b(");")}}function ya(a,e,b,c){function d(f){var k=v[f];return k?k.contextDep&&c.contextDynamic||k.propDep?k.append(a,b):k.append(a,e):
e.def(m,".",f)}function f(){function a(){b(u,".drawElementsInstancedANGLE(",[r,p,N,n+"<<(("+N+"-5121)>>1)",h],");")}function e(){b(u,".drawArraysInstancedANGLE(",[r,n,p,h],");")}q?ma?a():(b("if(",q,"){"),a(),b("}else{"),e(),b("}")):e()}function k(){function a(){b(g+".drawElements("+[r,p,N,n+"<<(("+N+"-5121)>>1)"]+");")}function e(){b(g+".drawArrays("+[r,n,p]+");")}q?ma?a():(b("if(",q,"){"),a(),b("}else{"),e(),b("}")):e()}var t=a.shared,g=t.gl,m=t.draw,v=c.draw,q=function(){var d=v.elements,f=e;if(d){if(d.contextDep&&
c.contextDynamic||d.propDep)f=b;d=d.append(a,f)}else d=f.def(m,".","elements");d&&f("if("+d+")"+g+".bindBuffer(34963,"+d+".buffer.buffer);");return d}(),r=d("primitive"),n=d("offset"),p=function(){var d=v.count,f=e;if(d){if(d.contextDep&&c.contextDynamic||d.propDep)f=b;d=d.append(a,f)}else d=f.def(m,".","count");return d}();if("number"===typeof p){if(0===p)return}else b("if(",p,"){"),b.exit("}");var h,u;Aa&&(h=d("instances"),u=a.instancing);var N=q+".type",ma=v.elements&&x(v.elements);Aa&&("number"!==
typeof h||0<=h)?"string"===typeof h?(b("if(",h,">0){"),f(),b("}else if(",h,"<0){"),k(),b("}")):f():k()}function Ba(a,e,b,c,d){e=ua();d=e.proc("body",d);Aa&&(e.instancing=d.def(e.shared.extensions,".angle_instanced_arrays"));a(e,d,b,c);return e.compile().body}function Ca(a,e,b,c){U(a,e);Z(a,e,b,c.attributes,function(){return!0});ca(a,e,b,c.uniforms,function(){return!0});ya(a,e,e,b)}function Ja(a,e){var b=a.proc("draw",1);U(a,b);S(a,b,e.context);ga(a,b,e.framebuffer);ia(a,b,e);Q(a,b,e.state);Y(a,b,
e,!1,!0);var c=e.shader.progVar.append(a,b);b(a.shared.gl,".useProgram(",c,".program);");if(e.shader.program)Ca(a,b,e,e.shader.program);else{var d=a.global.def("{}"),f=b.def(c,".id"),k=b.def(d,"[",f,"]");b(a.cond(k).then(k,".call(this,a0);")["else"](k,"=",d,"[",f,"]=",a.link(function(b){return Ba(Ca,a,e,b,1)}),"(",c,");",k,".call(this,a0);"))}0<Object.keys(e.state).length&&b(a.shared.current,".dirty=true;")}function Ka(a,e,b,c){function d(){return!0}a.batchId="a1";U(a,e);Z(a,e,b,c.attributes,d);ca(a,
e,b,c.uniforms,d);ya(a,e,e,b)}function ja(a,e,b,c){function d(a){return a.contextDep&&k||a.propDep}function f(a){return!d(a)}U(a,e);var k=b.contextDep,t=e.def(),g=e.def();a.shared.props=g;a.batchId=t;var m=a.scope(),v=a.scope();e(m.entry,"for(",t,"=0;",t,"<","a1",";++",t,"){",g,"=","a0","[",t,"];",v,"}",m.exit);b.needsContext&&S(a,v,b.context);b.needsFramebuffer&&ga(a,v,b.framebuffer);Q(a,v,b.state,d);b.profile&&d(b.profile)&&Y(a,v,b,!1,!0);c?(Z(a,m,b,c.attributes,f),Z(a,v,b,c.attributes,d),ca(a,
m,b,c.uniforms,f),ca(a,v,b,c.uniforms,d),ya(a,m,v,b)):(e=a.global.def("{}"),c=b.shader.progVar.append(a,v),g=v.def(c,".id"),m=v.def(e,"[",g,"]"),v(a.shared.gl,".useProgram(",c,".program);","if(!",m,"){",m,"=",e,"[",g,"]=",a.link(function(e){return Ba(Ka,a,b,e,2)}),"(",c,");}",m,".call(this,a0[",t,"],",t,");"))}function Da(a,e){function b(a){return a.contextDep&&d||a.propDep}var c=a.proc("batch",2);a.batchId="0";U(a,c);var d=!1,f=!0;Object.keys(e.context).forEach(function(a){d=d||e.context[a].propDep});
d||(S(a,c,e.context),f=!1);var k=e.framebuffer,t=!1;k?(k.propDep?d=t=!0:k.contextDep&&d&&(t=!0),t||ga(a,c,k)):ga(a,c,null);e.state.viewport&&e.state.viewport.propDep&&(d=!0);ia(a,c,e);Q(a,c,e.state,function(a){return!b(a)});e.profile&&b(e.profile)||Y(a,c,e,!1,"a1");e.contextDep=d;e.needsContext=f;e.needsFramebuffer=t;f=e.shader.progVar;if(f.contextDep&&d||f.propDep)ja(a,c,e,null);else if(f=f.append(a,c),c(a.shared.gl,".useProgram(",f,".program);"),e.shader.program)ja(a,c,e,e.shader.program);else{var k=
a.global.def("{}"),t=c.def(f,".id"),g=c.def(k,"[",t,"]");c(a.cond(g).then(g,".call(this,a0,a1);")["else"](g,"=",k,"[",t,"]=",a.link(function(b){return Ba(ja,a,e,b,2)}),"(",f,");",g,".call(this,a0,a1);"))}0<Object.keys(e.state).length&&c(a.shared.current,".dirty=true;")}function xa(a,e){function b(d){var k=e.shader[d];k&&c.set(f.shader,"."+d,k.append(a,c))}var c=a.proc("scope",3);a.batchId="a2";var f=a.shared,k=f.current;S(a,c,e.context);e.framebuffer&&e.framebuffer.append(a,c);d(Object.keys(e.state)).forEach(function(b){var d=
e.state[b].append(a,c);z(d)?d.forEach(function(e,d){c.set(a.next[b],"["+d+"]",e)}):c.set(f.next,"."+b,d)});Y(a,c,e,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(b){var d=e.draw[b];d&&c.set(f.draw,"."+b,""+d.append(a,c))});Object.keys(e.uniforms).forEach(function(b){c.set(f.uniforms,"["+h.id(b)+"]",e.uniforms[b].append(a,c))});Object.keys(e.attributes).forEach(function(b){var d=e.attributes[b].append(a,c),f=a.scopeAttrib(b);Object.keys(new t).forEach(function(a){c.set(f,
"."+a,d[a])})});b("vert");b("frag");0<Object.keys(e.state).length&&(c(k,".dirty=true;"),c.exit(k,".dirty=true;"));c("a1(",a.shared.context,",a0,",a.batchId,");")}function e(a){if("object"===typeof a&&!z(a)){for(var e=Object.keys(a),b=0;b<e.length;++b)if(n.isDynamic(a[e[b]]))return!0;return!1}}function v(a,b,d){function f(a,e){g.forEach(function(b){var c=k[b];n.isDynamic(c)&&(c=a.invoke(e,c),e(r,".",b,"=",c,";"))})}var k=b["static"][d];if(k&&e(k)){var t=a.global,g=Object.keys(k),v=!1,m=!1,q=!1,r=a.global.def("{}");
g.forEach(function(e){var b=k[e];if(n.isDynamic(b))"function"===typeof b&&(b=k[e]=n.unbox(b)),e=c(b,null),v=v||e.thisDep,q=q||e.propDep,m=m||e.contextDep;else{t(r,".",e,"=");switch(typeof b){case "number":t(b);break;case "string":t('"',b,'"');break;case "object":Array.isArray(b)&&t("[",b.join(),"]");break;default:t(a.link(b))}t(";")}});b.dynamic[d]=new n.DynamicVariable(4,{thisDep:v,contextDep:m,propDep:q,ref:r,append:f});delete b["static"][d]}}var t=ka.Record,ma={add:32774,subtract:32778,"reverse subtract":32779};
A.ext_blend_minmax&&(ma.min=32775,ma.max=32776);var Aa=A.angle_instanced_arrays,Ia=A.webgl_draw_buffers,ra={dirty:!0,profile:ha.profile},za={},Ga=[],sa={},ta={};P("dither",3024);P("blend.enable",3042);H("blend.color","blendColor",[0,0,0,0]);H("blend.equation","blendEquationSeparate",[32774,32774]);H("blend.func","blendFuncSeparate",[1,0,1,0]);P("depth.enable",2929,!0);H("depth.func","depthFunc",513);H("depth.range","depthRange",[0,1]);H("depth.mask","depthMask",!0);H("colorMask","colorMask",[!0,!0,
!0,!0]);P("cull.enable",2884);H("cull.face","cullFace",1029);H("frontFace","frontFace",2305);H("lineWidth","lineWidth",1);P("polygonOffset.enable",32823);H("polygonOffset.offset","polygonOffset",[0,0]);P("sample.alpha",32926);P("sample.enable",32928);H("sample.coverage","sampleCoverage",[1,!1]);P("stencil.enable",2960);H("stencil.mask","stencilMask",-1);H("stencil.func","stencilFunc",[519,0,-1]);H("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);H("stencil.opBack","stencilOpSeparate",
[1029,7680,7680,7680]);P("scissor.enable",3089);H("scissor.box","scissor",[0,0,q.drawingBufferWidth,q.drawingBufferHeight]);H("viewport","viewport",[0,0,q.drawingBufferWidth,q.drawingBufferHeight]);var La={gl:q,context:aa,strings:h,next:za,current:ra,draw:r,elements:D,buffer:I,shader:qa,attributes:ka.state,uniforms:N,framebuffer:M,extensions:A,timer:ba,isBufferArgs:g},Ha={primTypes:p,compareFuncs:L,blendFuncs:m,blendEquations:ma,stencilOps:F,glTypes:J,orientationType:G};Ia&&(Ha.backBuffer=[1029],
Ha.drawBuffer=u(l.maxDrawbuffers,function(a){return 0===a?[0]:u(a,function(a){return 36064+a})}));var Ma=0;return{next:za,current:ra,procs:function(){var a=ua(),e=a.proc("poll"),b=a.proc("refresh"),c=a.block();e(c);b(c);var d=a.shared,f=d.gl,k=d.next,t=d.current;c(t,".dirty=false;");ga(a,e);ga(a,b,null,!0);var g=q.getExtension("angle_instanced_arrays"),v;g&&(v=a.link(g));for(var m=0;m<l.maxAttributes;++m){var r=b.def(d.attributes,"[",m,"]"),n=a.cond(r,".buffer");n.then(f,".enableVertexAttribArray(",
m,");",f,".bindBuffer(",34962,",",r,".buffer.buffer);",f,".vertexAttribPointer(",m,",",r,".size,",r,".type,",r,".normalized,",r,".stride,",r,".offset);")["else"](f,".disableVertexAttribArray(",m,");",f,".vertexAttrib4f(",m,",",r,".x,",r,".y,",r,".z,",r,".w);",r,".buffer=null;");b(n);g&&b(v,".vertexAttribDivisorANGLE(",m,",",r,".divisor);")}Object.keys(sa).forEach(function(d){var g=sa[d],m=c.def(k,".",d),v=a.block();v("if(",m,"){",f,".enable(",g,")}else{",f,".disable(",g,")}",t,".",d,"=",m,";");b(v);
e("if(",m,"!==",t,".",d,"){",v,"}")});Object.keys(ta).forEach(function(d){var g=ta[d],m=ra[d],v,q,r=a.block();r(f,".",g,"(");z(m)?(g=m.length,v=a.global.def(k,".",d),q=a.global.def(t,".",d),r(u(g,function(a){return v+"["+a+"]"}),");",u(g,function(a){return q+"["+a+"]="+v+"["+a+"];"}).join("")),e("if(",u(g,function(a){return v+"["+a+"]!=="+q+"["+a+"]"}).join("||"),"){",r,"}")):(v=c.def(k,".",d),q=c.def(t,".",d),r(v,");",t,".",d,"=",v,";"),e("if(",v,"!==",q,"){",r,"}"));b(r)});return a.compile()}(),
compile:function(a,e,b,c,d){var f=ua();f.stats=f.link(d);Object.keys(e["static"]).forEach(function(a){v(f,e,a)});k.forEach(function(e){v(f,a,e)});b=na(a,e,b,c,f);Ja(f,b);xa(f,b);Da(f,b);return f.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],9:[function(h,l,w){function g(d,c){this.id=x++;this.type=d;this.data=c}function d(f){if(0===f.length)return[];
var c=f.charAt(0),b=f.charAt(f.length-1);if(1<f.length&&c===b&&('"'===c||"'"===c))return['"'+f.substr(1,f.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(c=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(f))return d(f.substr(0,c.index)).concat(d(c[1])).concat(d(f.substr(c.index+c[0].length)));c=f.split(".");if(1===c.length)return['"'+f.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];f=[];for(b=0;b<c.length;++b)f=f.concat(d(c[b]));return f}function C(f){return"["+d(f).join("][")+"]"}var x=
0;l.exports={DynamicVariable:g,define:function(d,c){return new g(d,C(c+""))},isDynamic:function(d){return"function"===typeof d&&!d._reglType||d instanceof g},unbox:function(d,c){return"function"===typeof d?new g(0,d):d},accessor:C}},{}],10:[function(h,l,w){var g=h("./util/is-typed-array"),d=h("./util/is-ndarray"),C=h("./util/values"),x=h("./constants/primitives.json"),f=h("./constants/usage.json");l.exports=function(c,b,h,A){function l(b){this.id=J++;p[this.id]=this;this.buffer=b;this.primType=4;
this.type=this.vertCount=0}function z(c,f,k,n,a,q,p){(q=p)||g(f)&&(!d(f)||g(f.data))||(q=b.oes_element_index_uint?5125:5123);c.buffer.bind();h._initBuffer(c.buffer,f,k,q,3);f=p;if(!p){switch(c.buffer.dtype){case 5121:case 5120:f=5121;break;case 5123:case 5122:f=5123;break;case 5125:case 5124:f=5125}c.buffer.dtype=f}c.type=f;0>a&&(a=c.buffer.byteLength,5123===f?a>>=1:5125===f&&(a>>=2));c.vertCount=a;a=n;0>n&&(a=4,n=c.buffer.dimension,1===n&&(a=0),2===n&&(a=1),3===n&&(a=4));c.primType=a}function n(b){A.elementsCount--;
delete p[b.id];b.buffer.destroy();b.buffer=null}var p={},J=0,E={uint8:5121,uint16:5123};b.oes_element_index_uint&&(E.uint32=5125);l.prototype.bind=function(){this.buffer.bind()};var k=[];return{create:function(b,k){function p(b){if(b)if("number"===typeof b)C(b),a.primType=4,a.vertCount=b|0,a.type=5121;else{var k=null,m=35044,n=-1,h=-1,u=0,A=0;Array.isArray(b)||g(b)||d(b)?k=b:("data"in b&&(k=b.data),"usage"in b&&(m=f[b.usage]),"primitive"in b&&(n=x[b.primitive]),"count"in b&&(h=b.count|0),"length"in
b&&(u=b.length|0),"type"in b&&(A=E[b.type]));k?z(a,k,m,n,h,u,A):(b=a.buffer,b.bind(),c.bufferData(34963,u,m),b.dtype=A||5121,b.usage=m,b.dimension=3,b.byteLength=u,a.primType=0>n?4:n,a.vertCount=0>h?0:h,a.type=b.dtype)}else C(),a.primType=4,a.vertCount=0,a.type=5121;return p}var C=h.create(null,34963,!0),a=new l(C._buffer);A.elementsCount++;p(b);p._reglType="elements";p._elements=a;p.subdata=function(a,b){C.subdata(a,b);return p};p.destroy=function(){n(a)};return p},createStream:function(b){var c=
k.pop();c||(c=new l(h.create(null,34963,!0,!1)._buffer));z(c,b,35040,-1,-1,0,0);return c},destroyStream:function(b){k.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof l?b._elements:null},clear:function(){C(p).forEach(n)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],11:[function(h,l,w){l.exports=function(g,d){function h(b){b=b.toLowerCase();var c;try{c=x[b]=g.getExtension(b)}catch(d){}return!!c}
for(var x={},f=0;f<d.extensions.length;++f){var c=d.extensions[f];if(!h(c))return d.onDestroy(),d.onDone('"'+c+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}d.optionalExtensions.forEach(h);return{extensions:x,restore:function(){Object.keys(x).forEach(function(b){if(!h(b))throw Error("(regl): error restoring extension "+b);})}}}},{}],12:[function(h,l,w){var g=h("./util/values"),d=h("./util/extend"),C=[];C[6408]=4;var x=[];x[5121]=
1;x[5126]=4;x[36193]=2;l.exports=function(f,c,b,h,A,l){function z(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var d=a=0;b?(a=b.width,d=b.height):c&&(a=c.width,d=c.height);this.width=a;this.height=d}function n(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function p(a,b,c){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function J(a,b){b?b.texture?f.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,
0):f.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):f.framebufferTexture2D(36160,a,3553,null,0)}function E(a){var b=3553,c=null,d=null,f=a;"object"===typeof a&&(f=a.data,"target"in a&&(b=a.target|0));a=f._reglType;"texture2d"===a?c=f:"textureCube"===a?c=f:"renderbuffer"===a&&(d=f,b=36161);return new z(b,c,d)}function k(a,b,c,d,f){if(c)return a=h.create2D({width:a,height:b,format:d,type:f}),a._texture.refCount=0,new z(3553,a,null);a=A.create({width:a,height:b,format:d});
a._renderbuffer.refCount=0;return new z(36161,null,a)}function m(a){return a&&(a.texture||a.renderbuffer)}function L(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function F(){this.id=Fa++;M[this.id]=this;this.framebuffer=f.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function G(a){a.colorAttachments.forEach(n);n(a.depthAttachment);n(a.stencilAttachment);n(a.depthStencilAttachment)}
function a(a){f.deleteFramebuffer(a.framebuffer);a.framebuffer=null;l.framebufferCount--;delete M[a.id]}function q(a){var c;f.bindFramebuffer(36160,a.framebuffer);var d=a.colorAttachments;for(c=0;c<d.length;++c)J(36064+c,d[c]);for(c=d.length;c<b.maxColorAttachments;++c)J(36064+c,null);J(36096,a.depthAttachment);J(36128,a.stencilAttachment);J(33306,a.depthStencilAttachment);f.checkFramebufferStatus(36160);f.bindFramebuffer(36160,w.next);w.cur=w.next;f.getError()}function V(b,c){function f(a,b){var c,
d=0,n=0,h=!0,u=!0;c=null;var A=!0,l="rgba",z="uint8",J=1,F=null,I=null,V=null,L=!1;if("number"===typeof a)d=a|0,n=b|0||d;else if(a){"shape"in a?(n=a.shape,d=n[0],n=n[1]):("radius"in a&&(d=n=a.radius),"width"in a&&(d=a.width),"height"in a&&(n=a.height));if("color"in a||"colors"in a)c=a.color||a.colors,Array.isArray(c);if(!c){"colorCount"in a&&(J=a.colorCount|0);"colorTexture"in a&&(A=!!a.colorTexture,l="rgba4");if("colorType"in a&&(z=a.colorType,!A))if("half float"===z||"float16"===z)l="rgba16f";else if("float"===
z||"float32"===z)l="rgba32f";"colorFormat"in a&&(l=a.colorFormat,0<=Ea.indexOf(l)?A=!0:0<=wa.indexOf(l)&&(A=!1))}if("depthTexture"in a||"depthStencilTexture"in a)L=!(!a.depthTexture&&!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?h=a.depth:(F=a.depth,u=!1));"stencil"in a&&("boolean"===typeof a.stencil?u=a.stencil:(I=a.stencil,h=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?h=u=a.depthStencil:(V=a.depthStencil,u=h=!1))}else d=n=1;var D=null,N=null,w=null,M=null;if(Array.isArray(c))D=
c.map(E);else if(c)D=[E(c)];else for(D=Array(J),c=0;c<J;++c)D[c]=k(d,n,A,l,z);d=d||D[0].width;n=n||D[0].height;F?N=E(F):h&&!u&&(N=k(d,n,L,"depth","uint32"));I?w=E(I):u&&!h&&(w=k(d,n,!1,"stencil","uint8"));V?M=E(V):!F&&!I&&u&&h&&(M=k(d,n,L,"depth stencil","depth stencil"));h=null;for(c=0;c<D.length;++c)p(D[c],d,n),D[c]&&D[c].texture&&(u=C[D[c].texture._texture.format]*x[D[c].texture._texture.type],null===h&&(h=u));p(N,d,n);p(w,d,n);p(M,d,n);G(g);g.width=d;g.height=n;g.colorAttachments=D;g.depthAttachment=
N;g.stencilAttachment=w;g.depthStencilAttachment=M;f.color=D.map(m);f.depth=m(N);f.stencil=m(w);f.depthStencil=m(M);f.width=g.width;f.height=g.height;q(g);return f}var g=new F;l.framebufferCount++;f(b,c);return d(f,{resize:function(a,b){var c=a|0,d=b|0||c;if(c===g.width&&d===g.height)return f;for(var k=g.colorAttachments,m=0;m<k.length;++m)L(k[m],c,d);L(g.depthAttachment,c,d);L(g.stencilAttachment,c,d);L(g.depthStencilAttachment,c,d);g.width=f.width=c;g.height=f.height=d;q(g);return f},_reglType:"framebuffer",
_framebuffer:g,destroy:function(){a(g);G(g)}})}var w={cur:null,next:null,dirty:!1},Ea=["rgba"],wa=["rgba4","rgb565","rgb5 a1"];c.ext_srgb&&wa.push("srgba");c.ext_color_buffer_half_float&&wa.push("rgba16f","rgb16f");c.webgl_color_buffer_float&&wa.push("rgba32f");var D=["uint8"];c.oes_texture_half_float&&D.push("half float","float16");c.oes_texture_float&&D.push("float","float32");var Fa=0,M={};return d(w,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,
a instanceof F)?a:null},create:V,createCube:function(a){function b(a){var f,k={color:null},g=0,m=null;f="rgba";var n="uint8",q=1;if("number"===typeof a)g=a|0;else if(a){"shape"in a?g=a.shape[0]:("radius"in a&&(g=a.radius|0),"width"in a?g=a.width|0:"height"in a&&(g=a.height|0));if("color"in a||"colors"in a)m=a.color||a.colors,Array.isArray(m);m||("colorCount"in a&&(q=a.colorCount|0),"colorType"in a&&(n=a.colorType),"colorFormat"in a&&(f=a.colorFormat));"depth"in a&&(k.depth=a.depth);"stencil"in a&&
(k.stencil=a.stencil);"depthStencil"in a&&(k.depthStencil=a.depthStencil)}else g=1;if(m)if(Array.isArray(m))for(a=[],f=0;f<m.length;++f)a[f]=m[f];else a=[m];else for(a=Array(q),m={radius:g,format:f,type:n},f=0;f<q;++f)a[f]=h.createCube(m);k.color=Array(a.length);for(f=0;f<a.length;++f)q=a[f],g=g||q.width,k.color[f]={target:34069,data:a[f]};for(f=0;6>f;++f){for(q=0;q<a.length;++q)k.color[q].target=34069+f;0<f&&(k.depth=c[0].depth,k.stencil=c[0].stencil,k.depthStencil=c[0].depthStencil);if(c[f])c[f](k);
else c[f]=V(k)}return d(b,{width:g,height:g,color:a})}var c=Array(6);b(a);return d(b,{faces:c,resize:function(a){var d=a|0;if(d===b.width)return b;var f=b.color;for(a=0;a<f.length;++a)f[a].resize(d);for(a=0;6>a;++a)c[a].resize(d);b.width=b.height=d;return b},_reglType:"framebufferCube",destroy:function(){c.forEach(function(a){a.destroy()})}})},clear:function(){g(M).forEach(a)},restore:function(){g(M).forEach(function(a){a.framebuffer=f.createFramebuffer();q(a)})}})}},{"./util/extend":23,"./util/values":31}],
13:[function(h,l,w){l.exports=function(g,d){var h=1;d.ext_texture_filter_anisotropic&&(h=g.getParameter(34047));var x=1,f=1;d.webgl_draw_buffers&&(x=g.getParameter(34852),f=g.getParameter(36063));return{colorBits:[g.getParameter(3410),g.getParameter(3411),g.getParameter(3412),g.getParameter(3413)],depthBits:g.getParameter(3414),stencilBits:g.getParameter(3415),subpixelBits:g.getParameter(3408),extensions:Object.keys(d).filter(function(c){return!!d[c]}),maxAnisotropic:h,maxDrawbuffers:x,maxColorAttachments:f,
pointSizeDims:g.getParameter(33901),lineWidthDims:g.getParameter(33902),maxViewportDims:g.getParameter(3386),maxCombinedTextureUnits:g.getParameter(35661),maxCubeMapSize:g.getParameter(34076),maxRenderbufferSize:g.getParameter(34024),maxTextureUnits:g.getParameter(34930),maxTextureSize:g.getParameter(3379),maxAttributes:g.getParameter(34921),maxVertexUniforms:g.getParameter(36347),maxVertexTextureUnits:g.getParameter(35660),maxVaryingVectors:g.getParameter(36348),maxFragmentUniforms:g.getParameter(36349),
glsl:g.getParameter(35724),renderer:g.getParameter(7937),vendor:g.getParameter(7936),version:g.getParameter(7938)}}},{}],14:[function(h,l,w){var g=h("./util/is-typed-array");l.exports=function(d,h,x,f,c,b){return function(b){var c;c=null===h.next?5121:h.next.colorAttachments[0].texture._texture.type;var l=0,z=0,n=f.framebufferWidth,p=f.framebufferHeight,J=null;g(b)?J=b:b&&(l=b.x|0,z=b.y|0,n=(b.width||f.framebufferWidth-l)|0,p=(b.height||f.framebufferHeight-z)|0,J=b.data||null);x();b=n*p*4;J||(5121===
c?J=new Uint8Array(b):5126===c&&(J=J||new Float32Array(b)));d.pixelStorei(3333,4);d.readPixels(l,z,n,p,6408,c,J);return J}}},{"./util/is-typed-array":26}],15:[function(h,l,w){var g=h("./util/values"),d=[];d[32854]=2;d[32855]=2;d[36194]=2;d[33189]=2;d[36168]=1;d[34041]=4;d[35907]=4;d[34836]=16;d[34842]=8;d[34843]=6;l.exports=function(h,x,f,c,b){function u(c){this.id=z++;this.refCount=1;this.renderbuffer=c;this.format=32854;this.height=this.width=0;b.profile&&(this.stats={size:0})}function l(b){var d=
b.renderbuffer;h.bindRenderbuffer(36161,null);h.deleteRenderbuffer(d);b.renderbuffer=null;b.refCount=0;delete n[b.id];c.renderbufferCount--}var I={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};x.ext_srgb&&(I.srgba=35907);x.ext_color_buffer_half_float&&(I.rgba16f=34842,I.rgb16f=34843);x.webgl_color_buffer_float&&(I.rgba32f=34836);var z=0,n={};u.prototype.decRef=function(){0>=--this.refCount&&l(this)};b.profile&&(c.getTotalRenderbufferSize=function(){var b=
0;Object.keys(n).forEach(function(c){b+=n[c].stats.size});return b});return{create:function(f,g){function l(c,f){var g=0,n=0,a=32854;"object"===typeof c&&c?("shape"in c?(n=c.shape,g=n[0]|0,n=n[1]|0):("radius"in c&&(g=n=c.radius|0),"width"in c&&(g=c.width|0),"height"in c&&(n=c.height|0)),"format"in c&&(a=I[c.format])):"number"===typeof c?(g=c|0,n="number"===typeof f?f|0:g):c||(g=n=1);if(g!==k.width||n!==k.height||a!==k.format)return l.width=k.width=g,l.height=k.height=n,k.format=a,h.bindRenderbuffer(36161,
k.renderbuffer),h.renderbufferStorage(36161,a,g,n),b.profile&&(k.stats.size=d[k.format]*k.width*k.height),l}var k=new u(h.createRenderbuffer());n[k.id]=k;c.renderbufferCount++;l(f,g);l.resize=function(c,f){var g=c|0,n=f|0||g;if(g===k.width&&n===k.height)return l;l.width=k.width=g;l.height=k.height=n;h.bindRenderbuffer(36161,k.renderbuffer);h.renderbufferStorage(36161,k.format,g,n);b.profile&&(k.stats.size=d[k.format]*k.width*k.height);return l};l._reglType="renderbuffer";l._renderbuffer=k;b.profile&&
(l.stats=k.stats);l.destroy=function(){k.decRef()};return l},clear:function(){g(n).forEach(l)},restore:function(){g(n).forEach(function(b){b.renderbuffer=h.createRenderbuffer();h.bindRenderbuffer(36161,b.renderbuffer);h.renderbufferStorage(36161,b.format,b.width,b.height)});h.bindRenderbuffer(36161,null)}}}},{"./util/values":31}],16:[function(h,l,w){var g=h("./util/values");l.exports=function(d,h,l,f){function c(b,c,d,f){this.name=b;this.id=c;this.location=d;this.info=f}function b(b,c){for(var d=
0;d<b.length;++d)if(b[d].id===c.id){b[d].location=c.location;return}b.push(c)}function u(b,c,f){f=35632===b?z:n;var g=f[c];if(!g){var p=h.str(c),g=d.createShader(b);d.shaderSource(g,p);d.compileShader(g);f[c]=g}return g}function A(b,c){this.id=E++;this.fragId=b;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[];f.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function I(g,n){var p,l;p=u(35632,g.fragId);l=u(35633,g.vertId);var x=g.program=d.createProgram();d.attachShader(x,
p);d.attachShader(x,l);d.linkProgram(x);var a=d.getProgramParameter(x,35718);f.profile&&(g.stats.uniformsCount=a);var q=g.uniforms;for(p=0;p<a;++p)if(l=d.getActiveUniform(x,p))if(1<l.size)for(var z=0;z<l.size;++z){var A=l.name.replace("[0]","["+z+"]");b(q,new c(A,h.id(A),d.getUniformLocation(x,A),l))}else b(q,new c(l.name,h.id(l.name),d.getUniformLocation(x,l.name),l));a=d.getProgramParameter(x,35721);f.profile&&(g.stats.attributesCount=a);q=g.attributes;for(p=0;p<a;++p)(l=d.getActiveAttrib(x,p))&&
b(q,new c(l.name,h.id(l.name),d.getAttribLocation(x,l.name),l))}var z={},n={},p={},J=[],E=0;f.profile&&(l.getMaxUniformsCount=function(){var b=0;J.forEach(function(c){c.stats.uniformsCount>b&&(b=c.stats.uniformsCount)});return b},l.getMaxAttributesCount=function(){var b=0;J.forEach(function(c){c.stats.attributesCount>b&&(b=c.stats.attributesCount)});return b});return{clear:function(){var b=d.deleteShader.bind(d);g(z).forEach(b);z={};g(n).forEach(b);n={};J.forEach(function(b){d.deleteProgram(b.program)});
J.length=0;p={};l.shaderCount=0},program:function(b,c,d){l.shaderCount++;var f=p[c];f||(f=p[c]={});var g=f[b];g||(g=new A(c,b),I(g,d),f[b]=g,J.push(g));return g},restore:function(){z={};n={};for(var b=0;b<J.length;++b)I(J[b])},shader:u,frag:-1,vert:-1}}},{"./util/values":31}],17:[function(h,l,w){l.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(h,l,w){l.exports=function(){var g=
{"":0},d=[""];return{id:function(h){var l=g[h];if(l)return l;l=g[h]=d.length;d.push(h);return l},str:function(g){return d[g]}}}},{}],19:[function(h,l,w){function g(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function d(a){return Array.isArray(a)&&0!==a.length&&p(a[0])?!0:!1}function C(a){return Object.prototype.toString.call(a)}function x(a){if(!a)return!1;var b=C(a);return 0<=L.indexOf(b)?!0:g(a)||d(a)||I(a)}function f(a,b){36193===a.type?(a.data=n(b),z.freeType(b)):a.data=
b}function c(a,b,c,d,f,g){a="undefined"!==typeof G[a]?G[a]:m[a]*F[b];g&&(a*=6);if(f){for(d=0;1<=c;)d+=a*c*c,c/=2;return d}return a*c*d}var b=h("./util/extend"),u=h("./util/values"),A=h("./util/is-typed-array"),I=h("./util/is-ndarray"),z=h("./util/pool"),n=h("./util/to-half-float"),p=h("./util/is-array-like");w=h("./constants/arraytypes.json");var J=h("./constants/arraytypes.json"),E=[9984,9986,9985,9987],k=[0,6409,6410,6407,6408],m={};m[6409]=m[6406]=m[6402]=1;m[34041]=m[6410]=2;m[6407]=m[35904]=
3;m[6408]=m[35906]=4;var L=Object.keys(w).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),F=[];F[5121]=1;F[5126]=4;F[36193]=2;F[5123]=2;F[5125]=4;var G=[];G[32854]=2;G[32855]=2;G[36194]=2;G[34041]=4;G[33776]=.5;G[33777]=.5;G[33778]=1;G[33779]=1;G[35986]=.5;G[35987]=1;G[34798]=1;G[35840]=.5;G[35841]=.25;G[35842]=.5;G[35843]=.25;G[36196]=.5;l.exports=function(a,h,l,w,F,G,D){function L(){this.format=this.internalformat=
6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function M(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function N(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=
b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=Q[b.colorSpace]);"type"in b&&(a.type=U[b.type]);var c=a.width,d=a.height,f=a.channels,g=!1;"shape"in b?(c=b.shape[0],d=b.shape[1],3===b.shape.length&&(f=b.shape[2],g=!0)):("radius"in b&&(c=d=b.radius),"width"in b&&(c=b.width),"height"in b&&(d=b.height),"channels"in b&&(f=b.channels,g=!0));a.width=c|0;a.height=d|0;a.channels=f|0;c=!1;"format"in b&&(c=b.format,d=a.internalformat=
Y[c],a.format=Ba[d],c in U&&!("type"in b)&&(a.type=U[c]),c in Z&&(a.compressed=!0),c=!0);!g&&c?a.channels=m[a.format]:g&&!c&&a.channels!==k[a.format]&&(a.format=a.internalformat=k[a.channels])}}function ka(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function qa(){L.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function r(a,b){var c=null;
x(b)?c=b:b&&(N(a,b),"x"in b&&(a.xOffset=b.x|0),"y"in b&&(a.yOffset=b.y|0),x(b.data)&&(c=b.data));if(b.copy){var h=F.viewportWidth,m=F.viewportHeight;a.width=a.width||h-a.xOffset;a.height=a.height||m-a.yOffset;a.needsCopy=!0}else if(!c)a.width=a.width||1,a.height=a.height||1;else if(A(c))a.data=c,"type"in b||5121!==a.type||(a.type=J[Object.prototype.toString.call(c)]|0);else if(g(c)){h=c;m=a.width*a.height*a.channels;switch(a.type){case 5121:case 5123:case 5125:case 5126:m=z.allocType(a.type,m);m.set(h);
a.data=m;break;case 36193:a.data=n(h)}a.alignment=1;a.needsFree=!0}else if(I(c)){h=c.data;Array.isArray(h)||5121!==a.type||(a.type=J[Object.prototype.toString.call(h)]|0);var m=c.shape,q=c.stride,l,u,r,D;3===m.length?(r=m[2],D=q[2]):D=r=1;l=m[0];u=m[1];m=q[0];q=q[1];a.alignment=1;a.width=l;a.height=u;a.channels=r;a.format=a.internalformat=k[r];a.needsFree=!0;l=D;c=c.offset;r=a.width;D=a.height;u=a.channels;for(var E=z.allocType(36193===a.type?5126:a.type,r*D*u),w=0,V=0;V<D;++V)for(var M=0;M<r;++M)for(var y=
0;y<u;++y)E[w++]=h[m*M+q*V+l*y+c];f(a,E)}else if("[object HTMLCanvasElement]"===C(c)||"[object CanvasRenderingContext2D]"===C(c))"[object HTMLCanvasElement]"===C(c)?a.element=c:a.element=c.canvas,a.width=a.element.width,a.height=a.element.height;else if("[object HTMLImageElement]"===C(c))a.element=c,a.width=c.naturalWidth,a.height=c.naturalHeight;else if("[object HTMLVideoElement]"===C(c))a.element=c,a.width=c.videoWidth,a.height=c.videoHeight,a.needsPoll=!0;else if(d(c)){h=c[0].length;m=c.length;
q=1;if(p(c[0][0])){l=q=c[0][0].length;r=z.allocType(36193===a.type?5126:a.type,h*m*l);for(u=D=0;u<m;++u)for(E=c[u],w=0;w<h;++w)for(V=E[w],M=0;M<l;++M)r[D++]=V[M];f(a,r)}else{l=z.allocType(36193===a.type?5126:a.type,h*m);for(D=r=0;D<m;++D)for(u=c[D],E=0;E<h;++E)l[r++]=u[E];f(a,l)}a.alignment=1;a.width=h;a.height=m;a.channels=q;a.format=a.internalformat=k[q];a.needsFree=!0}}function aa(b,c,d,f,g){var k=b.element,h=b.data,n=b.internalformat,m=b.format,q=b.type,l=b.width,p=b.height;ka(b);k?a.texSubImage2D(c,
g,d,f,m,q,k):b.compressed?a.compressedTexSubImage2D(c,g,d,f,n,l,p,h):b.needsCopy?(w(),a.copyTexSubImage2D(c,g,d,f,b.xOffset,b.yOffset,l,p)):a.texSubImage2D(c,g,d,f,l,p,m,q,h)}function ba(){return Ca.pop()||new qa}function ha(a){a.needsFree&&z.freeType(a.data);qa.call(a);Ca.push(a)}function W(){L.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function P(a,b,c){var d=a.images[0]=ba();a.mipmask=1;d.width=a.width=b;d.height=a.height=c}function H(a,b){var c=null;
if(x(b))c=a.images[0]=ba(),M(c,a),r(c,b),a.mipmask=1;else if(N(a,b),Array.isArray(b.mipmap))for(var d=b.mipmap,f=0;f<d.length;++f)c=a.images[f]=ba(),M(c,a),c.width>>=f,c.height>>=f,r(c,d[f]),a.mipmask|=1<<f;else c=a.images[0]=ba(),M(c,a),r(c,b),a.mipmask=1;M(a,a.images[0])}function ua(b,c){for(var d=b.images,f=0;f<d.length&&d[f];++f){var g=d[f],k=c,h=f,n=g.element,m=g.data,q=g.internalformat,l=g.format,p=g.type,u=g.width,r=g.height;ka(g);n?a.texImage2D(k,h,l,l,p,n):g.compressed?a.compressedTexImage2D(k,
h,q,u,r,0,m):g.needsCopy?(w(),a.copyTexImage2D(k,h,l,g.xOffset,g.yOffset,u,r,0)):a.texImage2D(k,h,l,u,r,0,l,p,m)}}function la(){var a=Ja.pop()||new W;L.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function va(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&ha(b[c]),b[c]=null;Ja.push(a)}function R(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function da(a,b){"min"in b&&(a.minFilter=ia[b.min],0<=E.indexOf(a.minFilter)&&
(a.genMipmaps=!0));"mag"in b&&(a.magFilter=ga[b.mag]);var c=a.wrapS,d=a.wrapT;if("wrap"in b){var f=b.wrap;"string"===typeof f?c=d=S[f]:Array.isArray(f)&&(c=S[f[0]],d=S[f[1]])}else"wrapS"in b&&(c=S[b.wrapS]),"wrapT"in b&&(d=S[b.wrapT]);a.wrapS=c;a.wrapT=d;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=na[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in
b||(a.minFilter=9984)}}function ea(b,c){a.texParameteri(c,10241,b.minFilter);a.texParameteri(c,10240,b.magFilter);a.texParameteri(c,10242,b.wrapS);a.texParameteri(c,10243,b.wrapT);h.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(c))}function oa(b){L.call(this);this.mipmask=0;this.internalformat=6408;this.id=Ka++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=
new R;D.profile&&(this.stats={size:0})}function fa(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function X(){var b=xa[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function pa(b){var c=b.texture,d=b.unit,f=b.target;0<=d&&(a.activeTexture(33984+d),a.bindTexture(f,null),xa[d]=null);a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete ja[b.id];G.textureCount--}var na={"don't care":4352,"dont care":4352,nice:4354,fast:4353},S={repeat:10497,
clamp:33071,mirror:33648},ga={nearest:9728,linear:9729},ia=b({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ga),Q={none:0,browser:37444},U={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Y={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Z={};h.ext_srgb&&(Y.srgb=35904,Y.srgba=35906);h.oes_texture_float&&(U.float32=U["float"]=5126);h.oes_texture_half_float&&
(U.float16=U["half float"]=36193);h.webgl_depth_texture&&(b(Y,{depth:6402,"depth stencil":34041}),b(U,{uint16:5123,uint32:5125,"depth stencil":34042}));h.webgl_compressed_texture_s3tc&&b(Z,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});h.webgl_compressed_texture_atc&&b(Z,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});h.webgl_compressed_texture_pvrtc&&b(Z,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});h.webgl_compressed_texture_etc1&&(Z["rgb etc1"]=36196);var ca=Array.prototype.slice.call(a.getParameter(34467));Object.keys(Z).forEach(function(a){var b=Z[a];0<=ca.indexOf(b)&&(Y[a]=b)});var ya=Object.keys(Y);l.textureFormats=ya;var Ba=ya.reduce(function(a,b){var c=Y[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),Ca=[],Ja=[],Ka=0,ja={},Da=l.maxTextureUnits,xa=Array(Da).map(function(){return null});
b(oa.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<Da;++c){var d=xa[c];if(d){if(0<d.bindCount)continue;d.unit=-1}xa[c]=this;b=c;break}D.profile&&G.maxTextureUnits<b+1&&(G.maxTextureUnits=b+1);this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&pa(this)}});D.profile&&(G.getTotalTextureSize=function(){var a=0;Object.keys(ja).forEach(function(b){a+=ja[b].stats.size});
return a});return{create2D:function(b,d){function f(a,b){var d=g.texInfo;R.call(d);var e=la();"number"===typeof a?"number"===typeof b?P(e,a|0,b|0):P(e,a|0,a|0):a?(da(d,a),H(e,a)):P(e,1,1);d.genMipmaps&&(e.mipmask=(e.width<<1)-1);g.mipmask=e.mipmask;M(g,e);g.internalformat=e.internalformat;f.width=e.width;f.height=e.height;fa(g);ua(e,3553);ea(d,3553);X();va(e);D.profile&&(g.stats.size=c(g.internalformat,g.type,e.width,e.height,d.genMipmaps,!1));return f}var g=new oa(3553);ja[g.id]=g;G.textureCount++;
f(b,d);f.subimage=function(a,b,c,e){b|=0;c|=0;e|=0;var d=ba();M(d,g);d.width>>=e;d.height>>=e;d.width-=b;d.height-=c;r(d,a);fa(g);aa(d,3553,b,c,e);X();ha(d);return f};f.resize=function(b,d){var e=b|0,k=d|0||e;if(e===g.width&&k===g.height)return f;f.width=g.width=e;f.height=g.height=k;fa(g);for(var h=0;g.mipmask>>h;++h)a.texImage2D(3553,h,g.format,e>>h,k>>h,0,g.format,g.type,null);X();D.profile&&(g.stats.size=c(g.internalformat,g.type,e,k,!1,!1));return f};f._reglType="texture2d";f._texture=g;D.profile&&
(f.stats=g.stats);f.destroy=function(){g.decRef()};return f},createCube:function(b,d,f,g,k,h){function n(a,b,d,e,f,g){var k,h=m.texInfo;R.call(h);for(k=0;6>k;++k)l[k]=la();if("number"===typeof a||!a)for(a=a|0||1,k=0;6>k;++k)P(l[k],a,a);else if("object"===typeof a)if(b)H(l[0],a),H(l[1],b),H(l[2],d),H(l[3],e),H(l[4],f),H(l[5],g);else if(da(h,a),N(m,a),"faces"in a)for(a=a.faces,k=0;6>k;++k)M(l[k],m),H(l[k],a[k]);else for(k=0;6>k;++k)H(l[k],a);M(m,l[0]);m.mipmask=h.genMipmaps?(l[0].width<<1)-1:l[0].mipmask;
m.internalformat=l[0].internalformat;n.width=l[0].width;n.height=l[0].height;fa(m);for(k=0;6>k;++k)ua(l[k],34069+k);ea(h,34067);X();D.profile&&(m.stats.size=c(m.internalformat,m.type,n.width,n.height,h.genMipmaps,!0));for(k=0;6>k;++k)va(l[k]);return n}var m=new oa(34067);ja[m.id]=m;G.cubeCount++;var l=Array(6);n(b,d,f,g,k,h);n.subimage=function(a,b,c,d,e){c|=0;d|=0;e|=0;var f=ba();M(f,m);f.width>>=e;f.height>>=e;f.width-=c;f.height-=d;r(f,b);fa(m);aa(f,34069+a,c,d,e);X();ha(f);return n};n.resize=
function(b){b|=0;if(b!==m.width){n.width=m.width=b;n.height=m.height=b;fa(m);for(var d=0;6>d;++d)for(var e=0;m.mipmask>>e;++e)a.texImage2D(34069+d,e,m.format,b>>e,b>>e,0,m.format,m.type,null);X();D.profile&&(m.stats.size=c(m.internalformat,m.type,n.width,n.height,!1,!0));return n}};n._reglType="textureCube";n._texture=m;D.profile&&(n.stats=m.stats);n.destroy=function(){m.decRef()};return n},clear:function(){for(var b=0;b<Da;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),xa[b]=null;u(ja).forEach(pa);
G.cubeCount=0;G.textureCount=0},getTexture:function(a){return null},restore:function(){u(ja).forEach(function(b){b.texture=a.createTexture();a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!==(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var d=0;6>d;++d)a.texImage2D(34069+d,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);ea(b.texInfo,b.target)})}}}},{"./constants/arraytypes.json":4,
"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/to-half-float":30,"./util/values":31}],20:[function(h,l,w){l.exports=function(g,d){function h(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function l(b,c,d){var f=u.pop()||new h;f.startQueryIndex=b;f.endQueryIndex=c;f.sum=0;f.stats=d;A.push(f)}var f=d.ext_disjoint_timer_query;if(!f)return null;var c=[],b=[],u=[],A=[],I=[],z=[];return{beginQuery:function(d){var g=
c.pop()||f.createQueryEXT();f.beginQueryEXT(35007,g);b.push(g);l(b.length-1,b.length,d)},endQuery:function(){f.endQueryEXT(35007)},pushScopeStats:l,update:function(){var d,g;d=b.length;if(0!==d){z.length=Math.max(z.length,d+1);I.length=Math.max(I.length,d+1);I[0]=0;var h=z[0]=0;for(g=d=0;g<b.length;++g){var l=b[g];f.getQueryObjectEXT(l,34919)?(h+=f.getQueryObjectEXT(l,34918),c.push(l)):b[d++]=l;I[g+1]=h;z[g+1]=d}b.length=d;for(g=d=0;g<A.length;++g){var h=A[g],k=h.startQueryIndex,l=h.endQueryIndex;
h.sum+=I[l]-I[k];k=z[k];l=z[l];l===k?(h.stats.gpuTime+=h.sum/1E6,u.push(h)):(h.startQueryIndex=k,h.endQueryIndex=l,A[d++]=h)}A.length=d}},getNumPendingQueries:function(){return b.length},clear:function(){c.push.apply(c,b);for(var d=0;d<c.length;d++)f.deleteQueryEXT(c[d]);b.length=0;c.length=0},restore:function(){b.length=0;c.length=0}}}},{}],21:[function(h,l,w){l.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(h,
l,w){function g(d){return Array.prototype.slice.call(d)}function d(d){return g(d).join("")}var C=h("./extend");l.exports=function(){function h(){var b=[],f=[];return C(function(){b.push.apply(b,g(arguments))},{def:function(){var d="v"+c++;f.push(d);0<arguments.length&&(b.push(d,"="),b.push.apply(b,g(arguments)),b.push(";"));return d},toString:function(){return d([0<f.length?"var "+f+";":"",d(b)])}})}function f(){function b(f,g){d(f,g,"=",c.def(f,g),";")}var c=h(),d=h(),f=c.toString,l=d.toString;return C(function(){c.apply(c,
g(arguments))},{def:c.def,entry:c,exit:d,save:b,set:function(d,f,g){b(d,f);c(d,f,"=",g,";")},toString:function(){return f()+l()}})}var c=0,b=[],l=[],A=h(),I={};return{global:A,link:function(d){for(var f=0;f<l.length;++f)if(l[f]===d)return b[f];f="g"+c++;b.push(f);l.push(d);return f},block:h,proc:function(b,c){function g(){var b="a"+h.length;h.push(b);return b}var h=[];c=c||0;for(var l=0;l<c;++l)g();var l=f(),k=l.toString;return I[b]=C(l,{arg:g,toString:function(){return d(["function(",h.join(),"){",
k(),"}"])}})},scope:f,cond:function(){var b=d(arguments),c=f(),h=f(),l=c.toString,u=h.toString;return C(c,{then:function(){c.apply(c,g(arguments));return this},"else":function(){h.apply(h,g(arguments));return this},toString:function(){var c=u();c&&(c="else{"+c+"}");return d(["if(",b,"){",l(),"}",c])}})},compile:function(){var c=['"use strict";',A,"return {"];Object.keys(I).forEach(function(b){c.push('"',b,'":',I[b].toString(),",")});c.push("}");var f=d(c).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,
"{\n");return Function.apply(null,b.concat(f)).apply(null,l)}}}},{"./extend":23}],23:[function(h,l,w){l.exports=function(g,d){for(var h=Object.keys(d),l=0;l<h.length;++l)g[h[l]]=d[h[l]];return g}},{}],24:[function(h,l,w){var g=h("./is-typed-array");l.exports=function(d){return Array.isArray(d)||g(d)}},{"./is-typed-array":26}],25:[function(h,l,w){var g=h("./is-typed-array");l.exports=function(d){return!!d&&"object"===typeof d&&Array.isArray(d.shape)&&Array.isArray(d.stride)&&"number"===typeof d.offset&&
d.shape.length===d.stride.length&&(Array.isArray(d.data)||g(d.data))}},{"./is-typed-array":26}],26:[function(h,l,w){var g=h("../constants/arraytypes.json");l.exports=function(d){return Object.prototype.toString.call(d)in g}},{"../constants/arraytypes.json":4}],27:[function(h,l,w){l.exports=function(g,d){for(var h=Array(g),l=0;l<g;++l)h[l]=d(l);return h}},{}],28:[function(h,l,w){function g(d){var c,b;c=(65535<d)<<4;d>>>=c;b=(255<d)<<3;d>>>=b;c|=b;b=(15<d)<<2;d>>>=b;c|=b;b=(3<d)<<1;return c|b|d>>>b>>
1}function d(d){a:{for(var c=16;268435456>=c;c*=16)if(d<=c){d=c;break a}d=0}c=x[g(d)>>2];return 0<c.length?c.pop():new ArrayBuffer(d)}function C(d){x[g(d.byteLength)>>2].push(d)}var x=h("./loop")(8,function(){return[]});l.exports={alloc:d,free:C,allocType:function(f,c){var b=null;switch(f){case 5120:b=new Int8Array(d(c),0,c);break;case 5121:b=new Uint8Array(d(c),0,c);break;case 5122:b=new Int16Array(d(2*c),0,c);break;case 5123:b=new Uint16Array(d(2*c),0,c);break;case 5124:b=new Int32Array(d(4*c),
0,c);break;case 5125:b=new Uint32Array(d(4*c),0,c);break;case 5126:b=new Float32Array(d(4*c),0,c);break;default:return null}return b.length!==c?b.subarray(0,c):b},freeType:function(d){C(d.buffer)}}},{"./loop":27}],29:[function(h,l,w){l.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(g){return requestAnimationFrame(g)},cancel:function(g){return cancelAnimationFrame(g)}}:{next:function(g){return setTimeout(g,16)},cancel:clearTimeout}},{}],30:[function(h,
l,w){var g=h("./pool"),d=new Float32Array(1),C=new Uint32Array(d.buffer);l.exports=function(h){for(var f=g.allocType(5123,h.length),c=0;c<h.length;++c)if(isNaN(h[c]))f[c]=65535;else if(Infinity===h[c])f[c]=31744;else if(-Infinity===h[c])f[c]=64512;else{d[0]=h[c];var b=C[0],l=b>>>31<<15,A=(b<<1>>>24)-127,b=b>>13&1023;f[c]=-24>A?l:-14>A?l+(b+1024>>-14-A):15<A?l+31744:l+(A+15<<10)+b}return f}},{"./pool":28}],31:[function(h,l,w){l.exports=function(g){return Object.keys(g).map(function(d){return g[d]})}},
{}],32:[function(h,l,w){function g(c,b,d){function g(){var b=window.innerWidth,l=window.innerHeight;c!==document.body&&(l=c.getBoundingClientRect(),b=l.right-l.left,l=l.top-l.bottom);h.width=d*b;h.height=d*l;f(h.style,{width:b+"px",height:l+"px"})}var h=document.createElement("canvas");f(h.style,{border:0,margin:0,padding:0,top:0,left:0});c.appendChild(h);c===document.body&&(h.style.position="absolute",f(c.style,{margin:0,padding:0}));window.addEventListener("resize",g,!1);g();return{canvas:h,onDestroy:function(){window.removeEventListener("resize",
g);c.removeChild(h)}}}function d(c,b){function d(f){try{return c.getContext(f,b)}catch(g){return null}}return d("webgl")||d("experimental-webgl")||d("webgl-experimental")}function C(c){return"string"===typeof c?c.split():c}function x(c){return"string"===typeof c?document.querySelector(c):c}var f=h("./util/extend");l.exports=function(c){var b=c||{},f,h,l,z;c={};var n=[],p=[],w="undefined"===typeof window?1:window.devicePixelRatio,E=!1,k=function(b){},m=function(){};"string"===typeof b?f=document.querySelector(b):
"object"===typeof b&&("string"===typeof b.nodeName&&"function"===typeof b.appendChild&&"function"===typeof b.getBoundingClientRect?f=b:"function"===typeof b.drawArrays||"function"===typeof b.drawElements?(z=b,l=z.canvas):("gl"in b?z=b.gl:"canvas"in b?l=x(b.canvas):"container"in b&&(h=x(b.container)),"attributes"in b&&(c=b.attributes),"extensions"in b&&(n=C(b.extensions)),"optionalExtensions"in b&&(p=C(b.optionalExtensions)),"onDone"in b&&(k=b.onDone),"profile"in b&&(E=!!b.profile),"pixelRatio"in b&&
(w=+b.pixelRatio)));f&&("canvas"===f.nodeName.toLowerCase()?l=f:h=f);if(!z){if(!l){f=g(h||document.body,k,w);if(!f)return null;l=f.canvas;m=f.onDestroy}z=d(l,c)}return z?{gl:z,canvas:l,container:h,extensions:n,optionalExtensions:p,pixelRatio:w,profile:E,onDone:k,onDestroy:m}:(m(),k("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/extend":23}],33:[function(h,l,w){function g(c){return c.charCodeAt(0)+(c.charCodeAt(1)<<8)+(c.charCodeAt(2)<<
16)+(c.charCodeAt(3)<<24)}var d=g("DXT1"),C=g("DXT3"),x=g("DXT5"),f=g("DX10");l.exports=function(c){var b=new Int32Array(c,0,31);if(542327876!==b[0])throw Error("Invalid magic number in DDS header");if(!b[20]&4)throw Error("Unsupported format, must contain a FourCC code");var g,h=b[21];switch(h){case d:g=8;c="dxt1";break;case C:g=16;c="dxt3";break;case x:g=16;c="dxt5";break;case 116:c="rgba32f";break;case f:var l=new Uint32Array(c.slice(128,148));c=l[0];if(3===l[1]&&2===c)c="rgba32f";else throw Error("Unsupported DX10 texture format "+
c);break;default:throw Error("Unsupported FourCC code: "+String.fromCharCode(h&255,h>>8&255,h>>16&255,h>>24&255));}var l=b[2],z=1;l&131072&&(z=Math.max(1,b[7]));var n=!1;b[28]&512&&(n=!0);var p=b[4],w=b[3],b=b[1]+4,E=p,k=w,m=[];h===f&&(b+=20);if(n)for(g=0;6>g;g++){if("rgba32f"!==c)throw Error("Only RGBA32f cubemaps are supported");for(var p=E,w=k,L=Math.log(p)/Math.log(2)+1,F=0;F<L;F++)h=p*w*16,m.push({offset:b,length:h,shape:[p,w]}),F<z&&(b+=h),p=Math.floor(p/2),w=Math.floor(w/2)}else for(F=0;F<
z;F++)h=Math.max(4,p)/4*Math.max(4,w)/4*g,m.push({offset:b,length:h,shape:[p,w]}),b+=h,p=Math.floor(p/2),w=Math.floor(w/2);return{shape:[E,k],images:m,format:c,flags:l,cubemap:n}}},{}],34:[function(h,l,w){function g(b){throw Error("resl: "+b);}function d(b,c,d){Object.keys(b).forEach(function(b){0>c.indexOf(b)&&g('invalid parameter "'+b+'" in '+d)})}function C(b,c){this.state=0;this.ready=!1;this.progress=0;this.name=b;this.cancel=c}var x=["manifest","onDone","onProgress","onError"],f=["type","src",
"stream","credentials","parser"],c=["onData","onDone"];l.exports=function(b){function h(a,c){if(a in b){var d=b[a];"function"!==typeof d&&g('invalid callback "'+a+'"');return d}return null}function l(a){function b(){if(!(2>h.readyState||1===p.state||-1===p.state)){if(200!==h.status)return z('error loading resource "'+a.name+'"');if(2<h.readyState&&0===p.state){var d;d="binary"===a.type?h.response:h.responseText;if(g.data)try{k=g.data(d)}catch(f){return z(f)}else k=d}if(3<h.readyState&&0===p.state){if(g.done)try{k=
g.done()}catch(f){return z(f)}p.state=1}m[c]=k;p.progress=.75*p.progress+.25;p.ready=a.stream&&!!k||1===p.state;n()}}var c=a.name,d=a.stream,f="binary"===a.type,g=a.parser,h=new XMLHttpRequest,k=null,p=new C(c,function(){1!==p.state&&-1!==p.state&&(h.onreadystatechange=null,h.abort(),p.state=-1)});h.onreadystatechange=d?b:function(){4===h.readyState&&b()};f&&(h.responseType="arraybuffer");a.credentials&&(h.withCredentials=!0);h.open("GET",a.src,!0);h.send();return p}function w(a,b){function c(){if(0===
p.state)if(l.data)try{u=l.data(b)}catch(a){return z(a)}else u=b}function d(b){c();m[k]=u;p.progress=b.lengthComputable?Math.max(p.progress,b.loaded/b.total):.75*p.progress+.25;p.ready=a.stream;n(k)}function f(){c();if(0===p.state){if(l.done)try{u=l.done()}catch(a){return z(a)}p.state=1}p.progress=1;p.ready=!0;m[k]=u;h();n("finish "+k)}function g(){z('error loading asset "'+k+'"')}function h(){a.stream&&b.removeEventListener("progress",d);"image"===a.type?b.addEventListener("load",f):b.addEventListener("canplay",
f);b.removeEventListener("error",g)}var k=a.name,l=a.parser,p=new C(k,function(){1!==p.state&&-1!==p.state&&(p.state=-1,h(),b.src="")}),u=b;a.stream&&b.addEventListener("progress",d);"image"===a.type?b.addEventListener("load",f):b.addEventListener("canplay",f);b.addEventListener("error",g);b.crossOrigin=a.credentials?"use-credentials":"anonymous";b.src=a.src;return p}function z(a){-1!==L&&1!==L&&(L=-1,G.forEach(function(a){a.cancel()}),k?"string"===typeof a?k(Error("resl: "+a)):k(a):console.error("resl error:",
a))}function n(a){if(-1!==L&&1!==L){var b=0,c=0;G.forEach(function(a){a.ready&&(c+=1);b+=a.progress});c===G.length?(L=1,J(m)):E&&E(b/G.length,a)}}"object"===typeof b&&b||g("invalid or missing configuration");d(b,x,"config");var p=b.manifest;"object"===typeof p&&p||g("missing manifest");var J=h("onDone");J||g("missing onDone() callback");var E=h("onProgress"),k=h("onError"),m={},L=0,F={text:l,binary:function(a){return l(a)},image:function(a){return w(a,document.createElement("img"))},video:function(a){return w(a,
document.createElement("video"))},audio:function(a){return w(a,document.createElement("audio"))}},G=Object.keys(p).map(function(a){function b(a,c){if(a in h.parser){var d=h.parser[a];"function"!==typeof d&&g("invalid parser callback "+a+' for asset "'+a+'"');return d}return c}var h=p[a];"string"===typeof h?h={src:h}:"object"===typeof h&&h||g('invalid asset definition "'+a+'"');d(h,f,'asset "'+a+'"');var k={};"parser"in h&&("function"===typeof h.parser?k={data:h.parser}:"object"===typeof h.parser&&
h.parser?(d(k,c,'parser for asset "'+a+'"'),"onData"in k||g('missing onData callback for parser in asset "'+a+'"'),k={data:b("onData"),done:b("onDone")}):g('invalid parser for asset "'+a+'"'));return{name:a,type:function(b,c,d){b in h&&(d=h[b]);0>c.indexOf(d)&&g("invalid "+b+' "'+d+'" for asset "'+a+'", possible values: '+c);return d}("type",Object.keys(F),"text"),stream:!!h.stream,credentials:!!h.credentials,src:function(b,c,d){b in h?d=h[b]:c&&g("missing "+b+' for asset "'+a+'"');"string"!==typeof d&&
g("invalid "+b+' for asset "'+a+'", must be a string');return d}("src",!0,""),parser:k}}).map(function(a){return F[a.type](a)})}},{}],35:[function(h,l,w){function g(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var d=h("./lib/util/extend"),C=h("./lib/dynamic"),x=h("./lib/util/raf"),f=h("./lib/util/clock"),c=h("./lib/strings"),b=h("./lib/webgl"),u=h("./lib/extension"),A=h("./lib/limits"),I=h("./lib/buffer"),z=h("./lib/elements"),n=h("./lib/texture"),p=h("./lib/renderbuffer"),J=h("./lib/framebuffer"),
E=h("./lib/attribute"),k=h("./lib/shader"),m=h("./lib/read"),L=h("./lib/core"),F=h("./lib/stats"),G=h("./lib/timer");l.exports=function(a){function h(){if(0===Q.length)H&&H.update(),ca=null;else{ca=x.next(h);N();for(var a=Q.length-1;0<=a;--a){var b=Q[a];b&&b(R,null,0)}r.flush();H&&H.update()}}function l(){!ca&&0<Q.length&&(ca=x.next(h))}function w(){ca&&(x.cancel(h),ca=null)}function Ea(a){a.preventDefault();w();U.forEach(function(a){a()})}function wa(a){r.getError();ba.restore();fa.restore();ea.restore();
X.restore();pa.restore();na.restore();H&&H.restore();S.procs.refresh();l();Y.forEach(function(a){a()})}function D(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];C.isDynamic(e)?d[b]=C.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;n.length<a;)n.push(null);return n}var f=b(a.context||{}),g=b(a.uniforms||{}),h=b(a.attributes||{}),k=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=
d({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var f=S.compile(k,h,g,f,a),l=f.draw,e=f.batch,m=f.scope,n=[];return d(function(a,b){var d;if("function"===typeof a)return m.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)m.call(this,
null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)m.call(this,a[d],b,d);else return m.call(this,a,b,0);else if("number"===typeof a){if(0<a)return e.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return e.call(this,a,a.length)}else return l.call(this,a)},{stats:a})}function Fa(a){Q.push(a);l();return{cancel:function(){function b(){var a=g(Q,b);Q[a]=Q[Q.length-1];--Q.length;0>=Q.length&&w()}var c=g(Q,a);Q[c]=b}}}function M(){var a=ga.viewport,b=ga.scissor_box;a[0]=a[1]=b[0]=b[1]=
0;R.viewportWidth=R.framebufferWidth=R.drawingBufferWidth=a[2]=b[2]=r.drawingBufferWidth;R.viewportHeight=R.framebufferHeight=R.drawingBufferHeight=a[3]=b[3]=r.drawingBufferHeight}function N(){R.tick+=1;R.time=qa();M();S.procs.poll()}function ka(){M();S.procs.refresh();H&&H.update()}function qa(){return(f()-ua)/1E3}a=b(a);if(!a)return null;var r=a.gl,aa=r.getContextAttributes();r.isContextLost();var ba=u(r,a);if(!ba)return null;var ha=c(),W=F(),P=ba.extensions,H=G(r,P),ua=f(),la=r.drawingBufferWidth,
va=r.drawingBufferHeight,R={tick:0,time:0,viewportWidth:la,viewportHeight:va,framebufferWidth:la,framebufferHeight:va,drawingBufferWidth:la,drawingBufferHeight:va,pixelRatio:a.pixelRatio},da=A(r,P),ea=I(r,W,a),oa=z(r,P,ea,W),la=E(r,P,da,ea,ha),fa=k(r,ha,W,a),X=n(r,P,da,function(){S.procs.poll()},R,W,a),pa=p(r,P,da,W,a),na=J(r,P,da,X,pa,W),S=L(r,ha,P,da,ea,oa,X,na,{},la,fa,{elements:null,primitive:4,count:-1,offset:0,instances:-1},R,H,a),ha=m(r,na,S.procs.poll,R,aa,P),ga=S.next,ia=r.canvas,Q=[],U=
[],Y=[],Z=[a.onDestroy],ca=null;ia&&(ia.addEventListener("webglcontextlost",Ea,!1),ia.addEventListener("webglcontextrestored",wa,!1));ka();aa=d(D,{clear:function(a){var b=0;S.procs.poll();var c=a.color;c&&(r.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(r.clearDepth(+a.depth),b|=256);"stencil"in a&&(r.clearStencil(a.stencil|0),b|=1024);r.clear(b)},prop:C.define.bind(null,1),context:C.define.bind(null,2),"this":C.define.bind(null,3),draw:D({}),buffer:function(a){return ea.create(a,
34962,!1,!1)},elements:function(a){return oa.create(a,!1)},texture:X.create2D,cube:X.createCube,renderbuffer:pa.create,framebuffer:na.create,framebufferCube:na.createCube,attributes:aa,frame:Fa,on:function(a,b){var c;switch(a){case "frame":return Fa(b);case "lost":c=U;break;case "restore":c=Y;break;case "destroy":c=Z}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:da,hasExtension:function(a){return 0<=da.extensions.indexOf(a.toLowerCase())},
read:ha,destroy:function(){Q.length=0;w();ia&&(ia.removeEventListener("webglcontextlost",Ea),ia.removeEventListener("webglcontextrestored",wa));fa.clear();na.clear();pa.clear();X.clear();oa.clear();ea.clear();H&&H.clear();Z.forEach(function(a){a()})},_gl:r,_refresh:ka,poll:function(){N();H&&H.update()},now:qa,stats:W});a.onDone(null,aa);return aa}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,
"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},{},[1]);
