(function e$$0(p,t,e){function l(n,h){if(!t[n]){if(!p[n]){var K="function"==typeof require&&require;if(!h&&K)return K(n,!0);if(a)return a(n,!0);K=Error("Cannot find module '"+n+"'");throw K.code="MODULE_NOT_FOUND",K;}K=t[n]={exports:{}};p[n][0].call(K.exports,function(a){var e=p[n][1][a];return l(e?e:a)},K,K.exports,e$$0,p,t,e)}return t[n].exports}for(var a="function"==typeof require&&require,h=0;h<e.length;h++)l(e[h]);return l})({1:[function(b,p,t){b=b("../regl")();var e=b({frag:"\n  precision mediump float;\n  uniform sampler2D specular, normals, diffuse;\n  varying vec3 lightDir, eyeDir;\n  varying vec2 uv;\n  void main () {\n    float d = length(lightDir);\n    vec3 L = normalize(lightDir);\n    vec3 E = normalize(eyeDir);\n    vec3 N = normalize(2.0 * texture2D(normals, uv).rgb - 1.0);\n    N = vec3(-N.x, N.yz);\n    vec3 D = texture2D(diffuse, uv).rgb;\n    vec3 kD = D * (0.01 +\n      max(0.0, dot(L, N) * (0.6 + 0.8 / d) ));\n    vec3 S = texture2D(specular, uv).rgb;\n    vec3 kS = 2.0 * pow(max(0.0, dot(normalize(N + L), -E)), 10.0) * S;\n    gl_FragColor = vec4(kD + kS, 1);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  uniform vec2 lightPosition;\n  varying vec3 lightDir, eyeDir;\n  varying vec2 uv;\n  void main () {\n    vec2 P = 1.0 - 2.0 * position;\n    uv = vec2(position.x, 1.0 - position.y);\n    eyeDir = -vec3(P, 1);\n    lightDir = vec3(lightPosition - P, 1);\n    gl_Position = vec4(P, 0, 1);\n  }",attributes:{position:[-2,0,0,-2,2,2]},uniforms:{specular:b.texture({mag:"linear",data:"assets/alpine_cliff_a_spec.png"}),normals:b.texture({mag:"linear",
data:"assets/alpine_cliff_a_norm.png"}),diffuse:b.texture("assets/alpine_cliff_a.dds"),lightPosition:function(e){e=.025*e.count;return[2*Math.cos(e),2*Math.sin(e)]}},count:3});b.frame(function(){e()})},{"../regl":30}],2:[function(b,p,t){function e(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}p.exports=function(l,a,h,n,g){l=h.maxAttributes;a=Array(l);for(h=0;h<l;++h)a[h]=new e;return{Record:e,scope:{},
state:a}}},{}],3:[function(b,p,t){function e(e,a){switch(e){case 5121:return new Uint8Array(a);case 5123:return new Uint16Array(a);case 5125:return new Uint32Array(a);case 5120:return new Int8Array(a);case 5122:return new Int16Array(a);case 5124:return new Int32Array(a);case 5126:return new Float32Array(a);default:return null}}var l=b("./util/is-typed-array"),a=b("./util/is-ndarray"),h=b("./constants/arraytypes.json"),n=b("./constants/dtypes.json"),g=b("./util/values"),K={"static":35044,dynamic:35048,
stream:35040};p.exports=function(b){function p(a){this.id=B++;this.buffer=null;this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function C(a){b.isBuffer(a.buffer)||(a.buffer=b.createBuffer());a.bind();b.bufferData(a.type,a.data||a.byteLength,a.usage)}function v(a){var e=a.buffer;b.isBuffer(e)&&b.deleteBuffer(e);a.buffer=null;delete d[a.id]}function r(g,b,r){function B(d){var g=d||{};if(Array.isArray(g)||l(g)||a(g))g={data:g};else if("number"===typeof g)g=
{length:g|0};else if(null===g||void 0===g)g={};z.usage="usage"in g?K[g.usage]:35044;d=0;"type"in g&&(d=n[g.type]);var b=g.dimension|0||1,r=0,u=null;if("data"in g)if(u=g.data,null===u)r=g.length|0;else{if(a(u)){var b=u.shape,r=u.stride,g=u.offset,w=0,H=0,v=0,x=0;1===b.length?(w=b[0],H=1,v=r[0],x=0):2===b.length&&(w=b[0],H=b[1],v=r[0],x=r[1]);d=d||h[Object.prototype.toString.call(u.data)]|0||5126;for(var b=H,r=e(d,w*H),u=u.data,p=0,G=0;G<w;++G)for(var y=0;y<H;++y)r[p++]=u[v*G+x*y+g];u=r}else if(Array.isArray(u))if(0<
u.length&&Array.isArray(u[0])){b=u[0].length;d=d||5126;g=e(d,u.length*b);r=u;u=b;for(w=x=0;w<r.length;++w)for(v=r[w],H=0;H<u;++H)g[x++]=v[H];u=g}else d=d||5126,u=e(d,u);else d=d||h[Object.prototype.toString.call(u)]|0;r=u.byteLength}else"length"in g&&(r=g.length|0);z.data=u;z.dtype=d||5121;z.byteLength=r;z.dimension=b;C(z);return B}var z=new p(b);d[z.id]=z;r||B(g);B._reglType="buffer";B._buffer=z;B.destroy=function(){v(z)};return B}var B=0,d={};p.prototype.bind=function(){b.bindBuffer(this.type,this.buffer)};
return{create:r,createStream:function(a){return r({data:a,usage:"stream"},34962,!1)._buffer},destroyStream:function(a){v(a)},clear:function(){g(d).forEach(v)},refresh:function(){g(d).forEach(C)},getBuffer:function(a){return a&&a._buffer instanceof p?a._buffer:null}}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./util/is-ndarray":21,"./util/is-typed-array":22,"./util/values":28}],4:[function(b,p,t){p.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,
"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(b,p,t){p.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],6:[function(b,p,t){p.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(b,p,t){function e(a){return Array.isArray(a)||
V(a)||C(a)}function l(a){return a.sort(function(a,d){return"viewport"===a?-1:"viewport"===d?1:a<d?-1:1})}function a(a,d,e,g){this.thisDep=a;this.contextDep=d;this.propDep=e;this.append=g}function h(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function n(d){return new a(!1,!1,!1,d)}function g(d,e){var g=d.type;return 0===g?(g=d.data.length,new a(!0,1<=g,2<=g,e)):new a(3===g,2===g,1===g,e)}var K=b("./util/codegen"),y=b("./util/loop"),V=b("./util/is-typed-array"),C=b("./util/is-ndarray"),v=b("./constants/primitives.json"),
r=b("./constants/dtypes.json"),B=["x","y","z","w"],d={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},u={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,
"!=":517,"!==":517,gequal:518,">=":518,always:519},x={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},G={cw:2304,ccw:2305},ba=new a(!1,!1,!1,function(){});p.exports=function(b,p,C,t,W,I,w,H,ga,R,Y,ha,M){function P(k){return k.replace(".","_")}function F(k,c,a){var m=P(k);qa.push(k);na[m]=ia[m]=!!a;ja[m]=c}function D(k,c,a){var m=P(k);qa.push(k);Array.isArray(a)?(ia[m]=a.slice(),na[m]=a.slice()):ia[m]=na[m]=a;ka[m]=c}function Q(){var k=
K(),c=k.link,a=k.global;k.id=Ca++;k.batchId="0";var m=c(za),d=k.shared={props:"a0"};Object.keys(za).forEach(function(f){d[f]=a.def(m,".",f)});var E=k.next={},e=k.current={};Object.keys(ka).forEach(function(f){Array.isArray(ia[f])&&(E[f]=a.def(d.next,".",f),e[f]=a.def(d.current,".",f))});var f=k.constants={};Object.keys(sa).forEach(function(k){f[k]=a.def(JSON.stringify(sa[k]))});k.invoke=function(f,T){switch(T.type){case 0:var a=["this",d.context,d.props,k.batchId];return f.def(c(T.data),".call(",
a.slice(0,Math.max(T.data.length+1,4)),")");case 1:return f.def(d.props,T.data);case 2:return f.def(d.context,T.data);case 3:return f.def("this",T.data)}};k.attribCache={};var T={};k.scopeAttrib=function(f){f=p.id(f);if(f in T)return T[f];var k=R.scope[f];k||(k=R.scope[f]=new oa);return T[f]=c(k)};return k}function da(k){var c=k["static"];k=k.dynamic;if("framebuffer"in c){var a=c.framebuffer;return a?(a=H.getFramebuffer(a),n(function(k,c){var m=k.link(a),f=k.shared;c.set(f.framebuffer,".next",m);
f=f.context;c.set(f,".framebufferWidth",m+".width");c.set(f,".framebufferHeight",m+".height");return m})):n(function(k,c){var a=k.shared;c.set(a.framebuffer,".next","null");a=a.context;c.set(a,".framebufferWidth",a+".drawingBufferWidth");c.set(a,".framebufferHeight",a+".drawingBufferHeight");return null})}if("framebuffer"in k){var m=k.framebuffer;return g(m,function(k,c){var a=k.invoke(c,m),f=k.shared,T=f.framebuffer,a=c.def(T,".getFramebuffer(",a,")");c.set(T,".next",a);f=f.context;c.set(f,".framebufferWidth",
a+"?"+a+".width:"+f+".drawingBufferWidth");c.set(f,".framebufferHeight",a+"?"+a+".height:"+f+".drawingBufferHeight");return a})}return null}function Z(k,c){function m(f){if(f in d){var k=d[f];f=!0;var ra=k.x|0,Aa=k.y|0,E,q;"w"in k?E=k.w|0:f=!1;"h"in k?q=k.h|0:f=!1;return new a(f&&c&&c.thisDep,f&&c&&c.contextDep,f&&c&&c.propDep,function(f,c){var a=f.shared.context,m=E;"w"in k||(m=c.def(a,".","framebufferWidth","-",ra));var d=q;"h"in k||(d=c.def(a,".","framebufferHeight","-",Aa));return[ra,Aa,m,d]})}if(f in
e){var ma=e[f];f=g(ma,function(f,k){var c=f.invoke(k,ma),a=f.shared.context,m=k.def(c,".x|0"),T=k.def(c,".y|0"),ra=k.def('"w" in ',c,"?",c,".w|0:","(",a,".","framebufferWidth","-",m,")"),c=k.def('"h" in ',c,"?",c,".h|0:","(",a,".","framebufferHeight","-",T,")");return[m,T,ra,c]});c&&(f.thisDep=f.thisDep||c.thisDep,f.contextDep=f.contextDep||c.contextDep,f.propDep=f.propDep||c.prpoDep);return f}return c?new a(c.thisDep,c.contextDep,c.propDep,function(f,c){var k=f.shared.context;return[0,0,c.def(k,
".","framebufferWidth"),c.def(k,".","framebufferHeight")]}):null}var d=k["static"],e=k.dynamic,E=m("viewport");if(E)var q=E,E=new a(E.thisDep,E.contextDep,E.propDep,function(f,c){var k=q.append(f,c),a=f.shared.context;c.set(a,".viewportWidth",k[2]);c.set(a,".viewportHeight",k[3]);return k});return{viewport:E,scissor_box:m("scissor.box")}}function L(c){function m(f){if(f in d){var c=p.id(d[f]);f=n(function(){return c});f.id=c;return f}if(f in e){var k=e[f];return g(k,function(f,c){var a=f.invoke(c,
k);return c.def(f.shared.strings,".id(",a,")")})}return null}var d=c["static"],e=c.dynamic,q=m("frag"),E=m("vert"),l=null;h(q)&&h(E)?(l=Y.program(E.id,q.id),c=n(function(f,c){return f.link(l)})):c=new a(q&&q.thisDep||E&&E.thisDep,q&&q.contextDep||E&&E.contextDep,q&&q.propDep||E&&E.propDep,function(f,c){var k=f.shared.shader,a;a=q?q.append(f,c):c.def(k,".","frag");var m;m=E?E.append(f,c):c.def(k,".","vert");return c.def(k+".program("+m+","+a+")")});return{frag:q,vert:E,progVar:c,program:l}}function J(c){function m(c,
f){if(c in d){var k=d[c]|0;return n(function(c,a){f&&(c.OFFSET=k);return k})}if(c in q){var a=q[c];return g(a,function(c,k){var m=c.invoke(k,a);f&&(c.OFFSET=m);return m})}return f&&l?n(function(f,c){f.OFFSET="0";return 0}):null}var d=c["static"],q=c.dynamic,l=function(){if("elements"in d){var c=d.elements;e(c)?c=I.getElements(I.create(c)):c&&(c=I.getElements(c));var f=n(function(f,k){if(c){var a=f.link(c);return f.ELEMENTS=a}return f.ELEMENTS=null});f.value=c;return f}if("elements"in q){var k=q.elements;
return g(k,function(f,c){var a=f.shared,m=a.isBufferArgs,a=a.elements,d=f.invoke(c,k),q=c.def("null"),m=c.def(m,"(",d,")"),d=f.cond(m).then(q,"=",a,".createStream(",d,");")["else"](q,"=",a,".getElements(",d,");");c.entry(d);c.exit(f.cond(m).then(a,".destroyStream(",q,");"));return f.ELEMENTS=q})}return null}(),E=m("offset",!0);return{elements:l,primitive:function(){if("primitive"in d){var c=d.primitive;return n(function(f,k){return v[c]})}if("primitive"in q){var f=q.primitive;return g(f,function(c,
k){var a=c.constants.primTypes,m=c.invoke(k,f);return k.def(a,"[",m,"]")})}return l?h(l)?l.value?n(function(f,c){return c.def(f.ELEMENTS,".primType")}):n(function(){return 4}):new a(l.thisDep,l.contextDep,l.propDep,function(f,c){var k=f.ELEMENTS;return c.def(k,"?",k,".primType:",4)}):null}(),count:function(){if("count"in d){var c=d.count|0;return n(function(){return c})}if("count"in q){var f=q.count;return g(f,function(c,k){return c.invoke(k,f)})}return l?h(l)?l?E?new a(E.thisDep,E.contextDep,E.propDep,
function(f,c){return c.def(f.ELEMENTS,".vertCount-",f.OFFSET)}):n(function(f,c){return c.def(f.ELEMENTS,".vertCount")}):n(function(){return-1}):new a(l.thisDep||E.thisDep,l.contextDep||E.contextDep,l.propDep||E.propDep,function(f,c){var k=f.ELEMENTS;return f.OFFSET?c.def(k,"?",k,".vertCount-",f.OFFSET,":-1"):c.def(k,"?",k,".vertCount:-1")}):null}(),instances:m("instances",!1),offset:E}}function U(c){var a=c["static"],m=c.dynamic,q={};qa.forEach(function(c){function k(f,d){if(c in a){var l=f(a[c]);
q[e]=n(function(){return l})}else if(c in m){var E=m[c];q[e]=g(E,function(f,c){return d(f,c,f.invoke(c,E))})}}var e=P(c);switch(c){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return k(function(f){return f},function(f,c,k){return k});case "depth.func":return k(function(f){return u[f]},function(f,c,k){return c.def(f.constants.compareFuncs,"[",
k,"]")});case "depth.range":return k(function(f){return f},function(f,c,k){f=c.def("+",k,"[0]");c=c.def("+",k,"[1]");return[f,c]});case "blend.func":return k(function(f){return[d["srcRGB"in f?f.srcRGB:f.src],d["dstRGB"in f?f.dstRGB:f.dst],d["srcAlpha"in f?f.srcAlpha:f.src],d["dstAlpha"in f?f.dstAlpha:f.dst]]},function(f,c,k){function a(f,d){var q=c.def('"',f,d,'" in ',k,"?",k,".",f,d,":",k,".",f);return c.def(m,"[",q,"]")}var m=f.constants.blendFuncs;f=a("src","RGB");var d=a("src","Alpha"),q=a("dst",
"RGB"),e=a("dst","Alpha");return[f,q,d,e]});case "blend.equation":return k(function(f){if("string"===typeof f)return[la[f],la[f]];if("object"===typeof f)return[la[f.rgb],la[f.alpha]]},function(f,c,k){var a=f.constants.blendEquations,m=c.def(),d=c.def();f=f.cond("typeof ",k,'==="string"');f.then(m,"=",d,"=",a,"[",k,"];");f["else"](m,"=",a,"[",k,".rgb];",d,"=",a,"[",k,".alpha];");c(f);return[m,d]});case "blend.color":return k(function(f){return y(4,function(c){return+f[c]})},function(f,c,k){return y(4,
function(f){return c.def("+",k,"[",f,"]")})});case "stencil.mask":return k(function(f){return f|0},function(f,c,k){return c.def(k,"|0")});case "stencil.func":return k(function(f){return[u[f.cmp||"keep"],f.ref||0,"mask"in f?f.mask:-1]},function(f,c,k){f=c.def('"cmp" in ',k,"?",f.constants.compareFuncs,"[",k,".cmp]",":",7680);var a=c.def(k,".ref|0");c=c.def('"mask" in ',k,"?",k,".mask|0:-1");return[f,a,c]});case "stencil.opFront":case "stencil.opBack":return k(function(f){return["stencil.opBack"===
c?1029:1028,x[f.fail||"keep"],x[f.zfail||"keep"],x[f.pass||"keep"]]},function(f,k,a){function m(c){return k.def('"',c,'" in ',a,"?",d,"[",a,".",c,"]:",7680)}var d=f.constants.stencilOps;return["stencil.opBack"===c?1029:1028,m("fail"),m("zfail"),m("pass")]});case "polygonOffset.offset":return k(function(c){return[c.factor|0,c.units|0]},function(c,k,a){c=k.def(a,".factor|0");k=k.def(a,".units|0");return[c,k]});case "cull.face":return k(function(c){var k=0;"front"===c?k=1028:"back"===c&&(k=1029);return k},
function(c,k,a){return k.def(a,'==="front"?',1028,":",1029)});case "lineWidth":return k(function(c){return c},function(c,k,a){return a});case "frontFace":return k(function(c){return G[c]},function(c,k,a){return k.def(a+'==="cw"?2304:2305')});case "colorMask":return k(function(c){return c.map(function(c){return!!c})},function(c,k,a){return y(4,function(c){return"!!"+a+"["+c+"]"})});case "sample.coverage":return k(function(c){return["value"in c?c.value:1,!!c.invert]},function(c,k,a){c=k.def('"value" in ',
a,"?+",a,".value:1");k=k.def("!!",a,".invert");return[c,k]})}});return q}function S(c){var a=c["static"],m=c.dynamic,d={};Object.keys(a).forEach(function(c){var k=a[c],m;if("number"===typeof k||"boolean"===typeof k)m=n(function(){return k});else if("function"===typeof k&&"texture"===k._reglType)m=n(function(c){return c.link(k)});else if(Array.isArray(k)||V(k))m=n(function(c){return c.global.def("[",y(k.length,function(c){return k[c]}),"]")});m.value=k;d[c]=m});Object.keys(m).forEach(function(c){var k=
m[c];d[c]=g(k,function(c,f){return c.invoke(f,k)})});return d}function aa(c){var a=c["static"],m=c.dynamic,d={};Object.keys(a).forEach(function(c){var k=a[c],m=p.id(c),f=new oa;if(e(k))f.state=1,f.buffer=W.getBuffer(W.create(k,34962,!1)),f.type=f.buffer.dtype;else{var q=W.getBuffer(k);if(q)f.state=1,f.buffer=q,f.type=q.dtype;else if(k.constant){var g=k.constant;f.state=2;"number"===typeof g?f.x=g:B.forEach(function(c,k){k<g.length&&(f[c]=g[k])})}else{var q=W.getBuffer(k.buffer),l=k.offset|0,h=k.stride|
0,b=k.size|0,A=!!k.normalized,ma=0;"type"in k&&(ma=r[k.type]);k=k.divisor|0;f.buffer=q;f.state=1;f.size=b;f.normalized=A;f.type=ma||q.dtype;f.offset=l;f.stride=h;f.divisor=k}}d[c]=n(function(c,k){var a=c.attribCache;if(m in a)return a[m];var d={isStream:!1};Object.keys(f).forEach(function(c){d[c]=f[c]});f.buffer&&(d.buffer=c.link(f.buffer));return a[m]=d})});Object.keys(m).forEach(function(c){var k=m[c];d[c]=g(k,function(c,f){function a(c){f(g[c],"=",m,".",c,"|0;")}var m=c.invoke(f,k),d=c.shared,
q=d.isBufferArgs,e=d.buffer,g={isStream:f.def(!1)},l=new oa;l.state=1;Object.keys(l).forEach(function(c){g[c]=f.def(""+l[c])});var ca=g.buffer,n=g.type;f("if(",q,"(",m,")){",g.isStream,"=true;",ca,"=",e,".createStream(",m,");",n,"=",ca,".dtype;","}else{",ca,"=",e,".getBuffer(",m,");","if(",ca,"){",n,"=",ca,".dtype;","}else if(",m,".constant){",g.state,"=",2,";",B.map(function(c,k){return g[c]+"="+m+".length>="+k+"?"+m+"["+k+"]:0;"}).join(""),"}else{",ca,"=",e,".getBuffer(",m,".buffer);",n,'="type" in ',
m,"?",d.glTypes,"[",m,".type]:",ca,".dtype;",g.normalized,"=!!",m,".normalized;");a("size");a("offset");a("stride");a("divisor");f("}}");return g})});return d}function N(c){var a=c["static"],m=c.dynamic,d={};Object.keys(a).forEach(function(c){var k=a[c];d[c]=n(function(c,f){return"number"===typeof k||"boolean"===typeof k?""+k:c.link(k)})});Object.keys(m).forEach(function(c){var k=m[c];d[c]=g(k,function(c,f){return c.invoke(f,k)})});return d}function O(c,a,m){var d=c.shared.context,q=c.scope();Object.keys(m).forEach(function(e){a.save(d,
"."+e);q(d,".",e,"=",m[e].append(c,a),";")});a(q)}function c(c,a,m){var d=c.shared,q=d.gl,e=d.framebuffer,g;ta&&(g=a.def(d.extensions,".webgl_draw_buffers"));var f=c.constants,d=f.drawBuffers,f=f.backBuffer;c=m?m.append(c,a):a.def(e,".next");a("if(",e,".dirty||",c,"!==",e,".cur){","if(",c,"){",q,".bindFramebuffer(",36160,",",c,".framebuffer);");ta&&a(g,".drawBuffersWEBGL(",d,"[",c,".colorAttachments.length]);");a("}else{",q,".bindFramebuffer(",36160,",null);");ta&&a(g,".drawBuffersWEBGL(",f,");");
a("}",e,".cur=",c,";",e,".dirty=false;","}")}function q(c,a,m){var d=c.shared,q=d.gl,e=c.current,g=c.next,f=d.current,l=d.next,n=c.cond(f,".dirty");qa.forEach(function(a){a=P(a);if(!(a in m.state)){var d,ca;if(a in g){d=g[a];ca=e[a];var h=y(ia[a].length,function(c){return n.def(d,"[",c,"]")});n(c.cond(h.map(function(c,k){return c+"==="+ca+"["+k+"]"}).join("&&")).then(q,".",ka[a],"(",h,");",h.map(function(c,k){return ca+"["+k+"]="+c}).join(";"),";"))}else d=n.def(l,".",a),h=c.cond(d,"!==",f,".",a),
n(h),a in ja?h(c.cond(d).then(q,".enable(",ja[a],");")["else"](q,".disable(",ja[a],");"),f,".",a,"=",d,";"):h(q,".",ka[a],"(",d,");",f,".",a,"=",d,";")}});0===Object.keys(m.state).length&&n(f,".dirty=false;");a(n)}function m(c,a,m,d){var q=c.shared,e=c.current,g=q.current,f=q.gl;l(Object.keys(m)).forEach(function(q){var l=m[q];if(!d||d(l)){var n=l.append(c,a);if(ja[q]){var b=ja[q];h(l)?n?a(f,".enable(",b,");"):a(f,".disable(",b,");"):a(c.cond(n).then(f,".enable(",b,");")["else"](f,".disable(",b,");"));
a(g,".",q,"=",n,";")}else if(Array.isArray(n)){var A=e[q];a(f,".",ka[q],"(",n,");",n.map(function(c,k){return A+"["+k+"]="+c}).join(";"),";")}else a(f,".",ka[q],"(",n,");",g,".",q,"=",n,";")}})}function A(c,a){pa&&!c.instancing&&(c.instancing=a.def(c.shared.extensions,".angle_instanced_arrays"))}function ua(c,a,m,d,q){function e(c){switch(c){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function g(m,
d,q){function e(){a("if(!",b,".pointer){",n,".enableVertexAttribArray(",h,");",b,".pointer=true;}");var f=q.type,m;m=q.size?a.def(q.size,"||",d):d;a("if(",b,".type!==",f,"||",b,".size!==",m,"||",r.map(function(c){return b+"."+c+"!=="+q[c]}).join("||"),"){",n,".bindBuffer(",34962,",",A,".buffer);",n,".vertexAttribPointer(",[h,m,f,q.normalized,q.stride,q.offset],");",b,".type=",f,";",b,".size=",m,";",r.map(function(c){return b+"."+c+"="+q[c]+";"}).join(""),"}");pa&&(f=q.divisor,a("if(",b,".divisor!==",
f,"){",c.instancing,".vertexAttribDivisorANGLE(",[h,f],");",b,".divisor=",f,";}"))}function l(){a("if(",b,".pointer){",n,".disableVertexAttribArray(",h,");",b,".pointer=false;","}if(",B.map(function(c,a){return b+"."+c+"!=="+u[a]}).join("||"),"){",n,".vertexAttrib4f(",h,",",u,");",B.map(function(c,a){return b+"."+c+"="+u[a]+";"}).join(""),"}")}var n=f.gl,h=a.def(m,".location"),b=a.def(f.attributes,"[",h,"]");m=q.state;var A=q.buffer,u=[q.x,q.y,q.z,q.w],r=["buffer","normalized","offset","stride"];
1===m?e():2===m?l():(a("if(",m,"===",1,"){"),e(),a("}else{"),l(),a("}"))}var f=c.shared;d.forEach(function(f){var d=f.name,l=m.attributes[d],n;if(l){if(!q(l))return;n=l.append(c,a)}else{if(!q(ba))return;var b=c.scopeAttrib(d);n={};Object.keys(new oa).forEach(function(c){n[c]=a.def(b,".",c)})}g(c.link(f),e(f.info.type),n)})}function va(c,a,m,d,q){for(var e=c.shared,g=e.gl,f,l=0;l<d.length;++l){var n=d[l],b=n.name,h=n.info.type,A=m.uniforms[b],n=c.link(n)+".location";if(A){if(!q(A))continue;if(A["static"]){b=
A.value;if(35678===h||35680===h)h=c.link(b._texture),a(g,".uniform1i(",n,h+".bind());"),a.exit(h,".unbind()");else if(35674===h||35675===h||35676===h)b=c.global.def("["+b+"]"),A=2,35675===h?A=3:35676===h&&(A=4),a(g,".uniformMatrix",A,"fv(",n,",false,",b,");");else{switch(h){case 5126:f="1f";break;case 35664:f="2f";break;case 35665:f="3f";break;case 35666:f="4f";break;case 35670:f="1i";break;case 5124:f="1i";break;case 35671:f="2i";break;case 35667:f="2i";break;case 35672:f="3i";break;case 35668:f=
"3i";break;case 35673:f="4i";break;case 35669:f="4i"}a(g,".uniform",f,"(",n,",",b,");")}continue}else b=A.append(c,a)}else{if(!q(ba))continue;b=a.def(e.uniforms,"[",p.id(b),"]")}A=",";switch(h){case 35678:case 35680:h=a.def(b,"._texture");a(g,".uniform1i(",n,",",h,".bind());");a.exit(h,".unbind();");continue;case 5124:case 35670:f="1i";break;case 35667:case 35671:f="2iv";break;case 35668:case 35672:f="3iv";break;case 35669:case 35673:f="4iv";break;case 5126:f="1f";break;case 35664:f="2fv";break;case 35665:f=
"3fv";break;case 35666:f="4fv";break;case 35674:f="Matrix2fv";A=",false,";break;case 35675:f="Matrix3fv";A=",false,";break;case 35676:f="Matrix4fv",A=",false,"}a(g,".uniform",f,"(",n,A,b,");")}}function wa(c,a,m,d){function q(f){var d=b[f];return d?d.batchStatic?d.append(c,a):d.append(c,m):a.def(l,".",f)}function e(){function c(){m(H,".drawElementsInstancedANGLE(",[u,w,x,r+"<<(("+x+"-5121)>>1)",v],");")}function a(){m(H,".drawArraysInstancedANGLE(",[u,r,w,v],");")}A?p?c():(m("if(",A,"){"),c(),m("}else{"),
a(),m("}")):a()}function g(){function c(){m(n+".drawElements("+[u,w,x,r+"<<(("+x+"-5121)>>1)"]+");")}function a(){m(n+".drawArrays("+[u,r,w]+");")}A?p?c():(m("if(",A,"){"),c(),m("}else{"),a(),m("}")):a()}var f=c.shared,n=f.gl,l=f.draw,b=d.draw,A=function(){var f=b.elements,d=a;f?(f.batchStatic||(d=m),f=f.append(c,d)):f=d.def(l,".","elements");f&&d("if("+f+")"+n+".bindBuffer(34963,"+f+".buffer.buffer);");return f}(),u=q("primitive"),r=q("offset"),w=function(){var f=b.count,d=a;f?(f.batchStatic||(d=
m),f=f.append(c,d)):f=d.def(l,".","count");return f}();if("number"===typeof w){if(0===w)return}else m("if(",w,"){"),m.exit("}");var v,H;pa&&(v=q("instances"),H=c.instancing);var x=A+".type",p=b.elements&&h(b.elements);pa&&("number"!==typeof v||0<=v)?"string"===typeof v?(m("if(",v,">0){"),e(),m("}else if(",v,"<0){"),g(),m("}")):e():g()}function xa(c,a,m,d,q){a=Q();q=a.proc("body",q);pa&&(a.instancing=q.def(a.shared.extensions,".angle_instanced_arrays"));c(a,q,m,d);return a.compile().body}function Ba(c,
a,m,d){A(c,a);ua(c,a,m,d.attributes,function(){return!0});va(c,a,m,d.uniforms,function(){return!0});wa(c,a,a,m)}function Da(a,d){var e=a.proc("draw",1);A(a,e);O(a,e,d.context);c(a,e,d.framebuffer);q(a,e,d);m(a,e,d.state);var g=d.shader.progVar.append(a,e);e(a.shared.gl,".useProgram(",g,".program);");if(d.shader.program)Ba(a,e,d,d.shader.program);else{var n=a.global.def("{}"),l=e.def(g,".id"),b=e.def(n,"[",l,"]");e(a.cond(b).then(b,".call(this,a0);")["else"](b,"=",n,"[",l,"]=",a.link(function(c){return xa(Ba,
a,d,c,1)}),"(",g,");",b,".call(this,a0);"))}0<Object.keys(d.state).length&&e(a.shared.current,".dirty=true;")}function Ea(c,a,m,d){function q(){return!0}c.batchId="a1";A(c,a);ua(c,a,m,d.attributes,q);va(c,a,m,d.uniforms,q);wa(c,a,a,m)}function ya(a,d,q,e){function g(c){return c.contextDep&&l||c.propDep}function n(c){return!g(c)}A(a,d);var l=q.contextDynamic,f=d.def(),b=d.def();a.shared.props=b;a.batchId=f;var h=a.scope(),u=a.scope();d(h.entry,"for(",f,"=0;",f,"<","a1",";++",f,"){",b,"=","a0","[",
f,"];",u,"}",h.exit);q.needsContext&&O(a,u,q.context);q.needsFramebuffer&&c(a,u,q.framebuffer);m(a,u,q.state,g);e?(ua(a,h,q,e.attributes,n),ua(a,u,q,e.attributes,g),va(a,h,q,e.uniforms,n),va(a,u,q,e.uniforms,g),wa(a,h,u,q)):(d=a.global.def("{}"),e=q.shader.progVar.append(a,u),b=u.def(e,".id"),h=u.def(d,"[",b,"]"),u(a.shared.gl,".useProgram(",e,".program);","if(!",h,"){",h,"=",d,"[",b,"]=",a.link(function(c){return xa(Ea,a,q,c,2)}),"(",e,");}",h,".call(this,a0[",f,"],",f,");"))}function Fa(a,d){var e=
a.proc("batch",2);a.batchId="0";A(a,e);var g=!1,n=!0;Object.keys(d.context).forEach(function(c){g=g||d.context[c].propDep});g||(O(a,e,d.context),n=!1);var l=d.framebuffer,b=!1;l&&(l.propDep?g=b=!0:l.contextDep&&g&&(b=!0),b||c(a,e,l));d.state.viewport&&d.state.viewport.propDynamic&&(g=!0);q(a,e,d);m(a,e,d.state,function(c){return!(c.contextDep&&g||c.propDep)});d.contextDep=g;d.needsContext=n;d.needsFramebuffer=b;n=d.shader.progVar;if(n.contextDep&&g||n.propDep)ya(a,e,d,null);else if(n=n.append(a,e),
e(a.shared.gl,".useProgram(",n,".program);"),d.shader.program)ya(a,e,d,d.shader.program);else{var l=a.global.def("{}"),b=e.def(n,".id"),f=e.def(l,"[",b,"]");e(a.cond(f).then(f,".call(this,a0,a1);")["else"](f,"=",l,"[",b,"]=",a.link(function(c){return xa(ya,a,d,c,2)}),"(",n,");",f,".call(this,a0,a1);"))}0<Object.keys(d.state).length&&e(a.shared.current,".dirty=true;")}function Ga(c,a){function d(e){var f=a.shader[e];f&&m.set(q.shader,"."+e,f.append(c,m))}var m=c.proc("scope",3);c.batchId="a2";var q=
c.shared,e=q.current;O(c,m,a.context);a.framebuffer&&a.framebuffer.append(c,m);l(Object.keys(a.state)).forEach(function(d){var f=a.state[d].append(c,m);Array.isArray(f)?f.forEach(function(a,f){m.set(c.next[d],"["+f+"]",a)}):m.set(q.next,"."+d,f)});["elements","offset","count","instances","primitive"].forEach(function(d){var f=a.draw[d];f&&m.set(q.draw,"."+d,""+f.append(c,m))});Object.keys(a.uniforms).forEach(function(d){m.set(q.uniforms,"["+p.id(d)+"]",a.uniforms[d].append(c,m))});Object.keys(a.attributes).forEach(function(d){var f=
a.attributes[d].append(c,m),q=c.scopeAttrib(d);Object.keys(new oa).forEach(function(c){m.set(q,"."+c,f[c])})});d("vert");d("frag");0<Object.keys(a.state).length&&(m(e,".dirty=true;"),m.exit(e,".dirty=true;"));m("a1(",c.shared.context,",a0,0);")}var oa=R.Record,la={add:32774,subtract:32778,"reverse subtract":32779};C.ext_blend_minmax&&(la.min=32775,la.max=32776);var pa=C.angle_instanced_arrays,ta=C.webgl_draw_buffers,ia={dirty:!0},na={},qa=[],ja={},ka={};F("dither",3024);F("blend.enable",3042);D("blend.color",
"blendColor",[0,0,0,0]);D("blend.equation","blendEquationSeparate",[32774,32774]);D("blend.func","blendFuncSeparate",[1,0,1,0]);F("depth.enable",2929,!0);D("depth.func","depthFunc",513);D("depth.range","depthRange",[0,1]);D("depth.mask","depthMask",!0);D("colorMask","colorMask",[!0,!0,!0,!0]);F("cull.enable",2884);D("cull.face","cullFace",1029);D("frontFace","frontFace",2305);D("lineWidth","lineWidth",1);F("polygonOffset.enable",32823);D("polygonOffset.offset","polygonOffset",[0,0]);F("sample.alpha",
32926);F("sample.enable",32928);D("sample.coverage","sampleCoverage",[1,!1]);F("stencil.enable",2960);D("stencil.mask","stencilMask",-1);D("stencil.func","stencilFunc",[519,0,-1]);D("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);D("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);F("scissor.enable",3089);D("scissor.box","scissor",[0,0,b.drawingBufferWidth,b.drawingBufferHeight]);D("viewport","viewport",[0,0,b.drawingBufferWidth,b.drawingBufferHeight]);var za={gl:b,context:M,
strings:p,next:na,current:ia,draw:ha,elements:I,buffer:W,shader:Y,attributes:R.state,uniforms:ga,framebuffer:H,extensions:C,isBufferArgs:e},sa={primTypes:v,compareFuncs:u,blendFuncs:d,blendEquations:la,stencilOps:x,glTypes:r,orientationType:G};ta&&(sa.backBuffer=[1029],sa.drawBuffer=y(t.maxDrawbuffers,function(c){return y(c,function(c){return 36064+c})}));var Ca=0;return{next:na,current:ia,procs:function(){var a=Q(),d=a.proc("poll"),m=a.proc("refresh"),q=a.block();d(q);m(q);var e=a.shared,g=e.gl,
n=e.next,f=e.current;q(f,".dirty=false;");c(a,d);m(e.framebuffer,".dirty=true;");c(a,m);Object.keys(ja).forEach(function(c){var e=ja[c],l=q.def(n,".",c),b=a.block();b("if(",l,"){",g,".enable(",e,")}else{",g,".disable(",e,")}",f,".",c,"=",l,";");m(b);d("if(",l,"!==",f,".",c,"){",b,"}")});Object.keys(ka).forEach(function(c){var e=ka[c],l=ia[c],b,h,A=a.block();A(g,".",e,"(");Array.isArray(l)?(e=l.length,b=a.global.def(n,".",c),h=a.global.def(f,".",c),A(y(e,function(c){return b+"["+c+"]"}),");",y(e,function(c){return h+
"["+c+"]="+b+"["+c+"];"}).join("")),d("if(",y(e,function(c){return b+"["+c+"]!=="+h+"["+c+"]"}).join("||"),"){",A,"}")):(b=q.def(n,".",c),h=q.def(f,".",c),A(b,");",f,".",c,"=",b,";"),d("if(",b,"!==",h,"){",A,"}"));m(A)});return a.compile()}(),compile:function(c,a,d,m){var q=Q(),e;e=da(c);var g=Z(c,e),f=J(c),n=U(c);c=L(c);var b=g.viewport;b&&(n.viewport=b);b=P("scissor.box");(g=g[b])&&(n[b]=g);g=0<Object.keys(n).length;e={framebuffer:e,draw:f,shader:c,state:n,dirty:g};e.uniforms=S(d);e.attributes=
aa(a);e.context=N(m);Da(q,e);Ga(q,e);Fa(q,e);return q.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":19,"./util/is-ndarray":21,"./util/is-typed-array":22,"./util/loop":24}],8:[function(b,p,t){function e(a,e){this.id=h++;this.type=a;this.data=e}function l(a){if(0===a.length)return[];var e=a.charAt(0),b=a.charAt(a.length-1);if(1<a.length&&e===b&&('"'===e||"'"===e))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(e=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return l(a.substr(0,
e.index)).concat(l(e[1])).concat(l(a.substr(e.index+e[0].length)));e=a.split(".");if(1===e.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(b=0;b<e.length;++b)a=a.concat(l(e[b]));return a}function a(a){return"["+l(a).join("][")+"]"}var h=0;p.exports={define:function(b,g){switch(typeof g){case "boolean":case "number":case "string":return new e(b,a(g+""));case "undefined":return new e(b|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof
e},unbox:function(b,g){if(b instanceof e){if(b.type&128)return new e(b.type&-129,a(g))}else if("function"===typeof b)return new e(0,b);return b},accessor:a}},{}],9:[function(b,p,t){var e=b("./util/is-typed-array"),l=b("./util/is-ndarray"),a=b("./constants/primitives.json");p.exports=function(b,n,g){function p(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}function y(b){function h(b){var d=n.oes_element_index_uint;if(b)if("number"===typeof b)r(b);else{var g=null,p="static";Array.isArray(b)||
e(b)||l(b)?g=b:("data"in b&&(g=b.data),"usage"in b&&(p=b.usage));Array.isArray(g)||l(g)&&Array.isArray(g.data)||"type"in b?r({type:b.type||(d?"uint32":"uint16"),usage:p,data:g}):r({usage:p,data:g});if(Array.isArray(g)||e(g))r.dimension=3}else r();d=v.buffer.byteLength;g=0;switch(v.buffer.dtype){case 5121:case 5120:g=5121;break;case 5123:case 5122:g=5123;d>>=1;break;case 5125:case 5124:g=5125,d>>=2}var p=4,G=v.buffer.dimension;1===G&&(p=0);2===G&&(p=1);3===G&&(p=4);"object"===typeof b&&("primitive"in
b&&(p=a[b.primitive]),"count"in b&&(d=b.vertCount|0));v.primType=p;v.vertCount=d;v.type=g;return h}var v=new p,r=g.create(null,34963,!0);v.buffer=r._buffer;h(b);h._reglType="elements";h._elements=v;h.destroy=function(){r.destroy();v.buffer=null};return h}p.prototype.bind=function(){this.buffer.bind()};return{create:y,createStream:function(a){return y({usage:"stream",data:a})._elements},destroyStream:function(a){g.destroyStream(a.buffer)},getElements:function(a){return"function"===typeof a&&a._elements instanceof
p?a._elements:null}}}},{"./constants/primitives.json":6,"./util/is-ndarray":21,"./util/is-typed-array":22}],10:[function(b,p,t){p.exports=function(e){function b(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(b){try{a[b]=
e.getExtension(b)}catch(l){}})}var a={};b();return{extensions:a,refresh:b}}},{}],11:[function(b,p,t){var e=b("./util/values"),l=b("./util/extend");p.exports=function(a,b,n,g,p){function y(a,d,e,b){this.target=a;this.level=d;this.texture=e;this.renderbuffer=b}function t(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function C(a,d){var e=d.width,b=d.height;if(a.texture)var g=a.texture._texture,l=Math.max(1,g.params.width>>a.level),h=Math.max(1,
g.params.height>>a.level),e=e||l,b=b||h;else g=a.renderbuffer._renderbuffer,e=e||g.width,b=b||g.height;g.refCount+=1;d.width=e;d.height=b}function v(d,e){e?e.texture?a.framebufferTexture2D(36160,d,e.target,e.texture._texture.texture,e.level):a.framebufferRenderbuffer(36160,d,36161,e.renderbuffer._renderbuffer.renderbuffer):a.framebufferTexture2D(36160,d,3553,null,0)}function r(a){var d=3553,e=0,b=null,g=null;"object"===typeof a&&("level"in a&&(e=a.level|0),"target"in a&&(d=a.target|0));var l=a._reglType;
"texture"===l?b=a:"renderbuffer"===l&&(g=a,d=36161,e=0);return new y(d,e,b,g)}function B(a){return a&&(a.texture||a.renderbuffer)}function d(){this.id=W++;I[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function u(d){a.isFramebuffer(d.framebuffer)||(d.framebuffer=a.createFramebuffer());G.dirty=!0;a.bindFramebuffer(36160,d.framebuffer);for(var e=
d.colorAttachments,g=0;g<e.length;++g)v(36064+g,e[g]);for(g=e.length;g<n.maxColorAttachments;++g)v(36064+g,null);v(36096,d.depthAttachment);v(36128,d.stencilAttachment);v(33306,d.depthStencilAttachment);b.webgl_draw_buffers&&b.webgl_draw_buffers.drawBuffersWEBGL(fa[e.length]);a.checkFramebufferStatus(36160)}function x(d){d=d.framebuffer;a.isFramebuffer(d)&&a.deleteFramebuffer(d)}var G={current:null,next:null,dirty:!1},ba={rgba:6408},z={rgba4:32854,rgb565:36194,"rgb5 a1":32855};b.ext_srgb&&(z.srgba=
35907);b.ext_color_buffer_half_float&&(z.rgba16f=34842,z.rgb16f=34843);b.webgl_color_buffer_float&&(z.rgba32f=34836);var X=[],ea=[];b.webgl_depth_texture&&(X.push(6402),ea.push(34041));l(l({},ba),z);e(ba);e(z);z=5121;X={uint8:5121};b.oes_texture_half_float&&(z=X["half float"]=36193);b.oes_texture_float&&(z=X["float"]=5126);X.best=z;var fa=function(){for(var a=Array(n.maxDrawbuffers),d=0;d<=n.maxDrawbuffers;++d)for(var e=a[d]=Array(d),b=0;b<d;++b)e[b]=36064+b;return a}(),W=0,I={};return l(G,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof d)?a:null},create:function(e){function b(d){var e,h=d||{},n=d=0;if("shape"in h){var v=h.shape;d=v[0];n=v[1]}else"radius"in h&&(d=n=h.radius),"width"in h&&(d=h.width),"height"in h&&(n=h.height);var x=null,v=!1;if("colorBuffers"in h||"colorBuffer"in h){x=h.colorBuffers||h.colorBuffer;Array.isArray(x)||(x=[x]);l.width=d;l.height=n;x=x.map(r);for(e=0;e<x.length;++e)C(x[e],l);d=l.width;n=l.height}else{var G=!0,w="rgba",z="uint8",I=1,
v=!0;l.width=d=d||a.drawingBufferWidth;l.height=n=n||a.drawingBufferHeight;"format"in h&&(w=h.format,G=w in ba);"type"in h&&(z=h.type);"colorCount"in h&&(I=h.colorCount|0);if(l.ownsColor)for(x=l.colorAttachments;x.length>I;)t(x.pop());else x=[];for(e=0;e<x.length;++e){var L;a:{L=x[e];var J=G,U=w,S=d,X=n;if(L.texture){var N=L.texture;if(J){N({format:U,type:z,width:S,height:X});N._texture.refCount+=1;L=!0;break a}}else if(N=L.renderbuffer,!J){N({format:U,width:S,height:X});N._renderbuffer.refCount+=
1;L=!0;break a}t(L);L=!1}L||(x[e--]=x[x.length-1],x.pop())}for(;x.length<I;)G?x.push(new y(3553,0,g.create({format:w,type:z,width:d,height:n},3553),null)):x.push(new y(36161,0,null,p.create({format:w,width:d,height:n})))}l.width=d;l.height=n;w=G=e=null;z=!1;"depthBuffer"in h&&(e=r(h.depthBuffer));"stencilBuffer"in h&&(G=r(h.stencilBuffer));"depthStencilBuffer"in h&&(w=r(h.depthStencilBuffer));if(e||G||w)C(e||G||w,l);else if(I=!0,J=L=!1,"depth"in h&&(I=!!h.depth),"stencil"in h&&(L=!!h.stencil),"depthTexture"in
h&&(J=!!h.depthTexture),h=l.depthAttachment||l.stencilAttachment||l.depthStencilAttachment,U=null,I||L)z=!0,J?(J=L?"depth stencil":"depth",l.ownsDepthStencil&&h.texture?(h.texture({format:J,width:d,height:n}),h.texture._texture.refCount+=1,U=h):U=new y(3553,0,g.create({format:J,width:d,height:n},3553),null)):(J=I?L?"depth stencil":"depth":"stencil",l.ownsDepthStencil&&h.renderbuffer?(h.renderbuffer({format:J,width:d,height:n}),h.renderbuffer._renderbuffer.refCount+=1,U=h):U=new y(36161,0,null,p.create({format:J,
width:d,height:n}))),I?L?w=U:e=U:G=U;d=l;d.colorAttachments.forEach(t);t(d.depthAttachment);t(d.stencilAttachment);t(d.depthStencilAttachment);l.colorAttachments=x;l.depthAttachment=e;l.stencilAttachment=G;l.depthStencilAttachment=w;l.ownsColor=v;l.ownsDepthStencil=z;b.color=x.map(B);b.depth=B(e);b.stencil=B(G);b.depthStencil=B(w);u(l);b.width=l.width;b.height=l.height;return b}var l=new d;b(e);b._reglType="framebuffer";b._framebuffer=l;b._destroy=function(){x(l)};return b},clear:function(){e(I).forEach(x)},
refresh:function(){e(I).forEach(u)}})}},{"./util/extend":20,"./util/values":28}],12:[function(b,p,t){p.exports=function(e,b){var a=1;b.ext_texture_filter_anisotropic&&(a=e.getParameter(34047));var h=1,n=1;b.webgl_draw_buffers&&(h=e.getParameter(34852),n=e.getParameter(36063));return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(b).filter(function(a){return!!b[a]}),
maxAnisotropic:a,maxDrawbuffers:h,maxColorAttachments:n,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),
maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}}},{}],13:[function(b,p,t){var e=b("./util/is-typed-array");p.exports=function(b,a,h){return function(n){var g=n||{};e(n)?g={data:g}:2===arguments.length?g={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof n&&(g={});a();var p=g.x||0,y=g.y||0,t=g.width||h.viewportWidth,C=g.height||h.viewportHeight,g=g.data||new Uint8Array(t*C*4);b.pixelStorei(3333,
4);b.readPixels(p,y,t,C,6408,5121,g);return g}}},{"./util/is-typed-array":22}],14:[function(b,p,t){var e=b("./util/values");p.exports=function(b,a,h){function n(){this.id=t++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function g(a){b.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=b.createRenderbuffer());b.bindRenderbuffer(36161,a.renderbuffer);b.renderbufferStorage(36161,a.format,a.width,a.height)}function p(a){var e=a.renderbuffer;b.bindRenderbuffer(36161,
null);b.isRenderbuffer(e)&&b.deleteRenderbuffer(e);a.renderbuffer=null;a.refCount=0;delete C[a.id]}var y={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};a.ext_srgb&&(y.srgba=35907);a.ext_color_buffer_half_float&&(y.rgba16f=34842,y.rgb16f=34843);a.webgl_color_buffer_float&&(y.rgba32f=34836);var t=0,C={};n.prototype.decRef=function(){0===--this.refCount&&p(this)};return{create:function(a){function e(a){a=a||{};var l=0,h=0;"shape"in a?(h=a.shape,l=h[0]|0,h=
h[1]|0):("radius"in a&&(l=h=a.radius|0),"width"in a&&(l=a.width|0),"height"in a&&(h=a.height|0));e.width=b.width=Math.max(l,1);e.height=b.height=Math.max(h,1);b.format=32854;"format"in a&&(b.format=y[a.format]);g(b);return e}var b=new n;C[b.id]=b;e(a);e._reglType="renderbuffer";e._renderbuffer=b;e.destroy=function(){b.decRef()};return e},refresh:function(){e(C).forEach(g)},clear:function(){e(C).forEach(p)}}}},{"./util/values":28}],15:[function(b,p,t){var e=b("./util/values");p.exports=function(b,
a){function h(a,e,b,g){this.name=a;this.id=e;this.location=b;this.info=g}function n(a,e){for(var b=0;b<a.length;++b)if(a[b].id===e.id){a[b].location=e.location;return}a.push(e)}function g(d,e,g){g=35632===d?t:C;var h=g[e];if(!h){var n=a.str(e),h=b.createShader(d);b.shaderSource(h,n);b.compileShader(h);g[e]=h}return h}function p(a,e){this.id=B++;this.fragId=a;this.vertId=e;this.program=null;this.uniforms=[];this.attributes=[]}function y(d,e){var p,r;p=g(35632,d.fragId);r=g(35633,d.vertId);var v=d.program=
b.createProgram();b.attachShader(v,p);b.attachShader(v,r);b.linkProgram(v);var y=b.getProgramParameter(v,35718),t=d.uniforms;for(p=0;p<y;++p)if(r=b.getActiveUniform(v,p))if(1<r.size)for(var B=0;B<r.size;++B){var K=r.name.replace("[0]","["+B+"]");n(t,new h(K,a.id(K),b.getUniformLocation(v,K),r))}else n(t,new h(r.name,a.id(r.name),b.getUniformLocation(v,r.name),r));y=b.getProgramParameter(v,35721);t=d.attributes;for(p=0;p<y;++p)(r=b.getActiveAttrib(v,p))&&n(t,new h(r.name,a.id(r.name),b.getAttribLocation(v,
r.name),r))}var t={},C={},v={},r=[],B=0;return{clear:function(){var a=b.deleteShader.bind(b);e(t).forEach(a);t={};e(C).forEach(a);C={};r.forEach(function(a){b.deleteProgram(a.program)});r.length=0;v={}},refresh:function(){t={};C={};r.forEach(y)},program:function(a,e,b){var g=v[e];g||(g=v[e]={});var h=g[a];h||(h=new p(e,a),y(h,b),g[a]=h,r.push(h));return h},shader:g,frag:null,vert:null}}},{"./util/values":28}],16:[function(b,p,t){p.exports=function(){var e={"":0},b=[""];return{id:function(a){var h=
e[a];if(h)return h;h=e[a]=b.length;b.push(a);return h},str:function(a){return b[a]}}}},{}],17:[function(b,p,t){function e(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function l(a){if(!Array.isArray(a))return!1;var e=a.length;if(0===e||!Array.isArray(a[0]))return!1;for(var b=a[0].length,g=1;g<e;++g)if(!Array.isArray(a[g])||a[g].length!==b)return!1;return!0}function a(a){return Object.prototype.toString.call(a)}function h(d){return"[object HTMLCanvasElement]"===a(d)}function n(d){return"[object CanvasRenderingContext2D]"===
a(d)}var g=b("./util/extend"),K=b("./util/values"),y=b("./util/is-typed-array"),V=b("./util/is-ndarray"),C=b("./util/load-texture"),v=b("./util/to-half-float"),r=b("./util/parse-dds"),B=[9984,9986,9985,9987];p.exports=function(d,b,p,t,ba){function z(c){this.target=c;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=
this.miplevel=0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function X(c){this.target=c;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ea(c,a){var d,b,e=0,g=0,h=0,l=0,n=0,p=0,r=!1,v=!1,u=!1;for(d=0;d<a.length;++d)b=a[d],l=l||b.width<<b.miplevel,n=n||b.height<<b.miplevel,
e=e||b.type,g=g||b.format,h=h||b.internalformat,p=p||b.channels,r=r||b.needsPoll,v=v||b.needsListeners,b=b.miplevel,u=u||0<b;c.needsPoll=r;c.needsListeners=v;c.width=l;c.height=n;c.format=g;c.internalformat=h;c.type=e;if(3553!==c.target)for(d=0;6>d;++d);d=0<=B.indexOf(c.minFilter);c.genMipmaps=!u&&(c.genMipmaps||d);u=u||c.genMipmaps;c.minFilter||(c.minFilter=u?9987:9728);c.wrapS=c.wrapS||33071;c.wrapT=c.wrapT||33071;for(d=0;d<a.length;++d)b=a[d],b.channels||(b.channels=p),b.format||(b.format=g),b.internalformat||
(b.internalformat=h),b.type||(b.type=e)}function fa(a){this.id=U++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new X(a);this.pixels=[]}function W(a,b){function d(a,c){var e=c.mipmap,m;if(Array.isArray(e))for(var g=0;g<e.length;++g)m=new z(a),m.parseFlags(b),m.parseFlags(c),m.parse(e[g],g),h.push(m);else m=new z(a),m.parseFlags(b),m.parse(c,0),h.push(m)}var e;H(a);var g=a.params;X.call(g,a.target);var h=a.pixels;h.length=
0;g.parse(b);if(3553===a.target)d(3553,b);else{var l=b.faces||b;if(Array.isArray(l))for(e=0;6>e;++e)d(34069+e,l[e]);else if("string"!==typeof l)for(e=0;6>e;++e)d(34069+e,{})}ea(g,h);g.needsListeners&&w(a);g.needsPoll&&(a.pollId=aa.length,aa.push(a));I(a)}function I(a){d.isTexture(a.texture)||(a.texture=d.createTexture());var b=a.target,e=a.unit;0<=e?(d.activeTexture(33984+e),J=e):d.bindTexture(b,a.texture);for(var b=a.pixels,g=a.params,h=0;h<b.length;++h)b[h].upload(g);g.upload();0>e&&((e=O[J])?d.bindTexture(e.target,
e.texture):(a.unit=J,O[J]=a))}function w(a){function b(a,c,d){var e=r(d);e.pixels.forEach(function(b){var d=new z(e.cube?b.target:a);d.channels=e.channels;d.compressed=e.compressed;d.type=e.type;d.internalformat=e.format;d.format=L[e.format];d.width=b.width;d.height=b.height;d.miplevel=b.miplevel||c;d.data=b.data;g.push(d)})}function d(){for(var m=0;m<g.length;++m){var h=g[m],l=h.image,n=h.video,p=h.xhr;l&&l.complete?(h.width=l.naturalWidth,h.height=l.naturalHeight):n&&2<n.readyState?(h.width=n.width,
h.height=n.height):p&&4===p.readyState&&(g[m]=g[g.length-1],g.pop(),p.removeEventListener("readystatechange",I),b(h.target,h.miplevel,p.response))}ea(e,g);I(a)}var e=a.params,g=a.pixels;g.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",d):a.video&&1>a.readyState?a.video.addEventListener("progress",d):a.xhr&&a.xhr.addEventListener("readystatechange",d)});a.cancelPending=function(){g.forEach(function(a){a.image?a.image.removeEventListener("load",d):a.video?a.video.removeEventListener("progress",
d):a.xhr&&(a.xhr.removeEventListener("readystatechange",d),a.xhr.abort())})}}function H(a){var d=a.cancelPending;d&&(d(),a.cancelPending=null);d=a.pollId;0<=d&&((aa[d]=aa[aa.length-1]).id=d,aa.pop(),a.pollId=-1)}function ga(a){var b=a.texture,e=a.unit,g=a.target;0<=e&&(d.activeTexture(33984+e),J=e,d.bindTexture(g,null),O[e]=null);H(a);d.isTexture(b)&&d.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete S[a.id]}var R={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
Y={repeat:10497,clamp:33071,mirror:33648},ha={nearest:9728,linear:9729},M=g({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ha),P={none:0,browser:37444},F={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},D={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Q={};b.ext_srgb&&(D.srgb=35904,D.srgba=35906);b.oes_texture_float&&(F["float"]=5126);b.oes_texture_half_float&&
(F["half float"]=36193);b.webgl_depth_texture&&(g(D,{depth:6402,"depth stencil":34041}),g(F,{uint16:5123,uint32:5125,"depth stencil":34042}));b.webgl_compressed_texture_s3tc&&g(Q,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});b.webgl_compressed_texture_atc&&g(Q,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});b.webgl_compressed_texture_pvrtc&&g(Q,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});b.webgl_compressed_texture_etc1&&(Q["rgb etc1"]=36196);var da=Array.prototype.slice.call(d.getParameter(34467));Object.keys(Q).forEach(function(a){var d=Q[a];0<=da.indexOf(d)&&(D[a]=d)});var Z=Object.keys(D);p.textureFormats=Z;var L=Z.reduce(function(a,d){var b=D[d];6409===b||6406===b||6409===b||6410===b||6402===b||34041===b?a[b]=b:32855===b||0<=d.indexOf("rgba")?a[b]=6408:a[b]=6407;return a},{});g(z.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=P[a.colorSpace]);if("format"in a){var d=a.format;this.internalformat=D[d];d in F&&(this.type=F[d]);d in Q&&(this.compressed=!0)}"type"in a&&(this.type=F[a.type]);var d=this.width,b=this.height,e=this.channels;"shape"in a?(d=a.shape[0],b=a.shape[1],3===a.shape.length&&(e=a.shape[2])):("radius"in a&&(d=b=a.radius),"width"in a&&(d=a.width),
"height"in a&&(b=a.height),"channels"in a&&(e=a.channels));this.width=d|0;this.height=b|0;this.channels=e|0;"stride"in a?(d=a.stride,this.strideX=d[0],this.strideY=d[1],this.strideC=3===d.length?d[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*e,this.strideY=this.strideX*d);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(c,d){this.miplevel=d;this.width>>=d;this.height>>=d;var b=c;switch(typeof c){case "object":if(!c)return;
this.parseFlags(c);var g=c.data;if("string"===typeof g||g&&(y(g)||e(g)||V(g)||h(g)||n(g)||"[object HTMLImageElement]"===a(g)||"[object HTMLVideoElement]"===a(g)||l(g)))b=c.data;break;case "undefined":return}"string"===typeof b&&(b=C(b,this.crossOrigin));var g=null,p=!1;if(null!==b)if(y(b))this.data=b;else if(e(b))g=b,p=!0;else if(V(b)){Array.isArray(b.data)?(g=b.data,p=!0):this.data=b.data;var r=b.shape;this.width=r[0];this.height=r[1];this.channels=3===r.length?r[2]:1;r=b.stride;this.strideX=b.stride[0];
this.strideY=b.stride[1];this.strideC=3===r.length?b.stride[2]:1;this.offset=b.offset;this.needsTranspose=!0}else if(h(b)||n(b))h(b)?this.canvas=b:this.canvas=b.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===a(b))this.image=b,b.complete?(this.width=b.naturalWidth,this.height=b.naturalHeight):(this.width=this.width||b.naturalWidth,this.height=this.height||b.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===a(b))this.video=b,1<b.readyState?(this.width=b.width,this.height=b.height):(this.width=this.width||b.width,this.height=this.height||b.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===a(b))this.xhr=b,this.needsListeners=!0;else if(l(b)){var p=b[0].length,r=b.length,u=1,t,x,w,B;if(Array.isArray(b[0][0]))for(u=b[0][0].length,g=Array(p*r*u),x=B=0;x<r;++x)for(t=0;t<p;++t)for(w=0;w<u;++w)g[B++]=b[x][t][w];
else for(g=Array(p*r),x=B=0;x<r;++x)for(t=0;t<p;++t)g[B++]=b[x][t];this.width=p;this.height=r;this.channels=u;p=!0}else c.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||ba.viewportWidth)|0,this.height=(this.height||ba.viewportHeight)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=
[6409,6410,6407,6408][(this.channels=this.channels||4)-1]);b=this.internalformat;r=this.format=L[b];if(!this.channels)switch(r){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}r=this.type;5126!==r&&36193!==r&&(r||(r=6402===b?5125:5121));this.type=r;if(p)switch(r){case 5121:this.data=new Uint8Array(g);break;case 5123:this.data=new Uint16Array(g);break;case 5125:this.data=new Uint32Array(g);break;
case 5126:this.data=new Float32Array(g);break;case 36193:this.data=v(g)}if(this.data&&this.needsTranspose){g=this.data;b=this.width;p=this.height;r=this.channels;u=this.strideX;t=this.strideY;x=this.strideC;w=this.offset;B=new g.constructor(b*p*r);for(var K=0,H=0;H<p;++H)for(var z=0;z<b;++z)for(var G=0;G<r;++G)B[K++]=g[t*H+u*z+x*G+w];this.data=B}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){d.pixelStorei(37440,
this.flipY);d.pixelStorei(37441,this.premultiplyAlpha);d.pixelStorei(37443,this.colorSpace);d.pixelStorei(3317,this.unpackAlignment);var b=this.target,e=this.miplevel,g=this.image,h=this.canvas,l=this.video,n=this.data,p=this.internalformat,r=this.format,v=this.type,u=this.width||Math.max(1,a.width>>e);a=this.height||Math.max(1,a.height>>e);l&&2<l.readyState?d.texImage2D(b,e,r,r,v,l):g&&g.complete?d.texImage2D(b,e,r,r,v,g):h?d.texImage2D(b,e,r,r,v,h):this.compressed?d.compressedTexImage2D(b,e,p,u,
a,0,n):this.copy?(t(),d.copyTexImage2D(b,e,r,this.x,this.y,u,a,0)):n?d.texImage2D(b,e,r,u,a,0,r,v,n):d.texImage2D(b,e,r,u||1,a||1,0,r,v,null)}});g(X.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=M[a.min]);"mag"in a&&(this.magFilter=ha[a.mag]);var b=this.wrapS,d=this.wrapT;if("wrap"in a){var e=a.wrap;"string"===typeof e?b=d=Y[e]:Array.isArray(e)&&(b=Y[e[0]],d=Y[e[1]])}else"wrapS"in a&&(b=Y[a.wrapS]),"wrapT"in a&&(d=Y[a.wrapT]);this.wrapS=b;this.wrapT=d;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=R[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;d.texParameteri(a,10241,this.minFilter);d.texParameteri(a,10240,this.magFilter);d.texParameteri(a,10242,this.wrapS);d.texParameteri(a,10243,this.wrapT);b.ext_texture_filter_anisotropic&&d.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(d.hint(33170,this.mipmapHint),d.generateMipmap(a))}});
var J=0,U=0,S={},aa=[],N=p.maxTextureUnits,O=Array(N).map(function(){return null});g(fa.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<N;++b){var e=O[b];if(e){if(0<e.bindCount)continue;e.unit=-1}O[b]=this;a=b;break}this.unit=a;d.activeTexture(33984+a);d.bindTexture(this.target,this.texture);J=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&ga(this)}});return{create:function(a,b){function d(a,c,g,h,l,n){var r=a||{};34067===
b&&6===arguments.length&&(r=[a,c,g,h,l,n]);W(e,r);d.width=e.params.width;d.height=e.params.height;return d}var e=new fa(b);S[e.id]=e;d(a);d._reglType="texture";d._texture=e;d.destroy=function(){e.decRef()};return d},refresh:function(){K(S).forEach(I);for(var a=0;a<N;++a)O[a]=null;J=0;d.activeTexture(33984)},clear:function(){for(var a=0;a<N;++a)d.activeTexture(33984+a),d.bindTexture(3553,null),O[a]=null;d.activeTexture(33984);J=0;K(S).forEach(ga)},poll:function(){aa.forEach(I)},getTexture:function(a){return null}}}},
{"./util/extend":20,"./util/is-ndarray":21,"./util/is-typed-array":22,"./util/load-texture":23,"./util/parse-dds":25,"./util/to-half-float":27,"./util/values":28}],18:[function(b,p,t){p.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],19:[function(b,p,t){function e(a){return Array.prototype.slice.call(a)}function l(a){return e(a).join("")}var a=b("./extend");p.exports=function(){function b(){var h=[],n=[];return a(function(){h.push.apply(h,
e(arguments))},{def:function(){var a="v"+g++;n.push(a);0<arguments.length&&(h.push(a,"="),h.push.apply(h,e(arguments)),h.push(";"));return a},toString:function(){return l([0<n.length?"var "+n+";":"",l(h)])}})}function n(){function e(a,b){l(a,b,"=",g.def(a,b),";")}var g=b(),l=b(),d=g.toString,n=l.toString;return a(g,{entry:g,exit:l,save:e,set:function(a,b,d){e(a,b);g(a,b,"=",d,";")},toString:function(){return d()+n()}})}var g=0,p=[],t=[],V=b(),C={};return{global:V,link:function(a){for(var b=0;b<t.length;++b)if(t[b]===
a)return p[b];b="g"+g++;p.push(b);t.push(a);return b},block:b,proc:function(b,e){function g(){var a="a"+d.length;d.push(a);return a}var d=[];e=e||0;for(var h=0;h<e;++h)g();var h=n(),p=h.toString;return C[b]=a(h,{arg:g,toString:function(){return l(["function(",d.join(),"){",p(),"}"])}})},scope:n,cond:function(){var b=l(arguments),g=n(),h=n(),d=g.toString,p=h.toString;return a(g,{then:function(){g.apply(g,e(arguments));return this},"else":function(){h.apply(h,e(arguments));return this},toString:function(){var a=
p();a&&(a="else{"+a+"}");return l(["if(",b,"){",d(),"}",a])}})},compile:function(){var a=['"use strict";',V,"return {"];Object.keys(C).forEach(function(b){a.push('"',b,'":',C[b].toString(),",")});a.push("}");var b=l(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,p.concat(b)).apply(null,t)}}}},{"./extend":20}],20:[function(b,p,t){p.exports=function(b,l){for(var a=Object.keys(l),h=0;h<a.length;++h)b[a[h]]=l[a[h]];return b}},{}],21:[function(b,p,t){var e=b("./is-typed-array");
p.exports=function(b){return!!b&&"object"===typeof b&&Array.isArray(b.shape)&&Array.isArray(b.stride)&&"number"===typeof b.offset&&b.shape.length===b.stride.length&&(Array.isArray(b.data)||e(b.data))}},{"./is-typed-array":22}],22:[function(b,p,t){var e=b("../constants/arraytypes.json");p.exports=function(b){return Object.prototype.toString.call(b)in e}},{"../constants/arraytypes.json":4}],23:[function(b,p,t){p.exports=function(b,l){if("undefined"!==typeof document){var a;a=(a=/\.(\w+)(\?.*)?$/.exec(b))&&
a[1]?a[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(a))return a=document.createElement("video"),a.autoplay=!0,a.loop=!0,l&&(a.crossOrigin=l),a.src=b,a;if(0<=["dds"].indexOf(a))return a=new XMLHttpRequest,a.responseType="arraybuffer",a.open("GET",b,!0),a.send(),a;a=new Image;l&&(a.crossOrigin=l);a.src=b;return a}return null}},{}],24:[function(b,p,t){p.exports=function(b,l){for(var a=Array(b),h=0;h<b;++h)a[h]=l(h);return a}},
{}],25:[function(b,p,t){p.exports=function(b){function p(a){for(var d=R,e=Y,g=0;g<D;++g){var h=Math.max(1,d+3>>2)*Math.max(1,e+3>>2)*P;da.pixels.push({target:a,miplevel:g,width:d,height:e,data:new Uint8Array(b,Q,h)});Q+=h;d>>=1;e>>=1}}var t=new Int32Array(b),ga=t[G],R=t[z],Y=t[ba],ha=y,M=0,P=0,F=4;switch(t[fa]){case r:P=8;ga&v?(F=3,M=a):M=h;break;case B:P=16;M=n;break;case d:P=16;M=g;break;case u:P=8,M=K}var D=1;t[ea]&V&&(D=Math.max(1,t[X]));var Q=t[x]+4,da={width:R,height:Y,channels:F,format:M,type:ha,
compressed:!0,cube:!1,pixels:[]};if(t[W]&C)for(da.cube=!0,t=0;6>t;++t)p(l+t);else p(e);return da};var e=3553,l=34069,a=33776,h=33777,n=33778,g=33779,K=36196,y=5121,V=131072,C=512,v=64,r=827611204,B=861165636,d=894720068,u=826496069,x=1,G=2,ba=3,z=4,X=7,ea=20,fa=21,W=28},{}],26:[function(b,p,t){p.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(b){return requestAnimationFrame(b)},cancel:function(b){return cancelAnimationFrame(b)}}:{next:function(b){setTimeout(b,
30)},cancel:clearTimeout}},{}],27:[function(b,p,t){p.exports=function(b){for(var l=new Float32Array(b),l=new Uint32Array(l.buffer),a=new Uint16Array(b.length),h=0;h<b.length;++h)if(isNaN(b[h]))a[h]=65535;else if(Infinity===b[h])a[h]=31744;else if(-Infinity===b[h])a[h]=64512;else{var n=l[h],g=n>>>31<<15,p=(n<<1>>>24)-127,n=n>>13&1023;a[h]=-24>p?g:-14>p?g+(n+1024>>-14-p):15<p?g+31744:g+(p+15<<10)+n}return a}},{}],28:[function(b,p,t){p.exports=function(b){return Object.keys(b).map(function(l){return b[l]})}},
{}],29:[function(b,p,t){function e(b,e){function g(){var e=window.innerWidth,g=window.innerHeight;b!==document.body&&(g=b.getBoundingClientRect(),e=g.right-g.left,g=g.top-g.bottom);p.width=V*e;p.height=V*g;a(p.style,{width:e+"px",height:g+"px"})}var p=document.createElement("canvas"),t=l(p,e);a(p.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(p);b===document.body&&(p.style.position="absolute",a(b.style,{margin:0,padding:0}));var V=+t.options.pixelRatio;window.addEventListener("resize",
g,!1);var C=t.options.onDestroy;t.options=a(a({},t.options),{onDestroy:function(){window.removeEventListener("resize",g);b.removeChild(p);C&&C()}});g();return t}function l(b,e){function g(a){try{return b.getContext(a,l)}catch(e){return null}}var l=e.glOptions||{};return{gl:g("webgl")||g("experimental-webgl")||g("webgl-experimental"),options:a({pixelRatio:window.devicePixelRatio},e)}}var a=b("./util/extend");p.exports=function(b){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:b[0],
options:b[1]||{}};var n=document.body,g=b[1]||{};if("string"===typeof b[0])n=document.querySelector(b[0])||document.body;else if("object"===typeof b[0])if(b[0]instanceof HTMLElement)n=b[0];else{if(b[0]instanceof WebGLRenderingContext)return{gl:b[0],options:a({pixelRatio:1},g)};g=b[0]}return n.nodeName&&"CANVAS"===n.nodeName.toUpperCase()?l(n,g):e(n,g)}},{"./util/extend":20}],30:[function(b,p,t){var e=b("./lib/util/extend"),l=b("./lib/dynamic"),a=b("./lib/util/raf"),h=b("./lib/util/clock"),n=b("./lib/strings"),
g=b("./lib/webgl"),K=b("./lib/extension"),y=b("./lib/limits"),V=b("./lib/buffer"),C=b("./lib/elements"),v=b("./lib/texture"),r=b("./lib/renderbuffer"),B=b("./lib/framebuffer"),d=b("./lib/attribute"),u=b("./lib/shader"),x=b("./lib/read"),G=b("./lib/core");p.exports=function(){function b(){c=a.next(b);F.count+=1;var d=aa.viewport,e=aa.scissor_box;d[0]=d[1]=e[0]=e[1]=0;F.viewportWidth=F.frameBufferWidth=F.drawingBufferWidth=d[2]=e[2]=w.drawingBufferWidth;F.viewportHeight=F.frameBufferWidth=F.drawingBufferHeight=
d[3]=e[3]=w.drawingBufferHeight;d=h();F.deltaTime=(d-ha)/1E3;F.time=(d-Y)/1E3;ha=d;S.procs.refresh();Z.poll();for(d=0;d<O.length;++d)(0,O[d])(F,null,0)}function p(){c&&(a.cancel(b),c=0)}function t(a){p();a.preventDefault();if(H.onContextLost)H.onContextLost()}function ea(a){w.getError();ga.refresh();S.procs.refresh();D.refresh();Z.refresh();L.refresh();J.refresh();da.refresh();if(H.onContextRestored)H.onContextRestored();b()}function fa(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=
a[b];l.isDynamic(e)?d[b]=l.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;t.length<a;)t.push(null);return t}var d=b(a.context||{}),g=b(a.uniforms||{}),h=b(a.attributes||{});a=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=e({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var d=S.compile(a,
h,g,d),n=d.draw,p=d.batch,r=d.scope,t=[];return function(a,b){var d;if("function"===typeof a)return r.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)r.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)r.call(this,a[d],b,d);else return r.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return n.call(this,a)}}function W(){S.procs.poll()}
var I=g(Array.prototype.slice.call(arguments)),w=I.gl,H=I.options,I=n(),ga=K(w),R=ga.extensions,Y=h(),ha=Y,M=w.drawingBufferWidth,P=w.drawingBufferHeight,F={count:0,deltaTime:0,time:0,viewportWidth:M,viewportHeight:P,framebufferWidth:M,framebufferHeight:P,drawingBufferWidth:M,drawingBufferHeight:P,pixelRatio:H.pixelRatio},M=y(w,R),D=V(w),Q=C(w,R,D),P=d(w,R,M,D,I),da=u(w,I),Z=v(w,R,M,W,F),L=r(w,R,M),J=B(w,R,M,Z,L),U=x(w,W,F),S=G(w,I,R,M,D,Q,Z,J,{},P,da,{elements:null,primitive:4,count:-1,offset:0,
instances:-1},F),aa=S.next,N=w.canvas,O=[],c=0;N&&(N.addEventListener("webglcontextlost",t,!1),N.addEventListener("webglcontextrestored",ea,!1));S.procs.refresh();return e(fa,{clear:function(a){var b=0;W();var c=a.color;c&&(w.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(w.clearDepth(+a.depth),b|=256);"stencil"in a&&(w.clearStencil(a.stencil|0),b|=1024);w.clear(b)},prop:l.define.bind(null,1),context:l.define.bind(null,2),"this":l.define.bind(null,3),draw:fa({}),elements:function(a){return Q.create(a)},
buffer:function(a){return D.create(a,34962)},texture:function(a){return Z.create(a,3553)},cube:function(a){return 6===arguments.length?Z.create(Array.prototype.slice.call(arguments),34067):Z.create(a,34067)},renderbuffer:function(a){return L.create(a)},framebuffer:function(a){return J.create(a)},framebufferCube:function(a){},attributes:w.getContextAttributes(),frame:function(a){O.push(a);!c&&0<O.length&&b();return{cancel:function(){var b=O.find(function(b){return b===a});0>b||(O.splice(b,1),0>=O.length&&
p())}}},limits:M,read:U,destroy:function(){p();N&&(N.removeEventListener("webglcontextlost",t),N.removeEventListener("webglcontextrestored",ea));da.clear();J.clear();L.clear();Z.clear();D.clear();if(H.onDestroy)H.onDestroy()},_gl:w,_refresh:function(){S.procs.refresh()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":7,"./lib/dynamic":8,"./lib/elements":9,"./lib/extension":10,"./lib/framebuffer":11,"./lib/limits":12,"./lib/read":13,"./lib/renderbuffer":14,"./lib/shader":15,"./lib/strings":16,
"./lib/texture":17,"./lib/util/clock":18,"./lib/util/extend":20,"./lib/util/raf":26,"./lib/webgl":29}]},{},[1]);
