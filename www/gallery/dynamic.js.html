<!DOCTYPE html>
      <html>
        <head>
          <title>example/dynamic.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(h,k,d){function n(b,f){if(!k[b]){if(!h[b]){var A="function"==typeof require&&require;if(!f&&A)return A(b,!0);if(c)return c(b,!0);A=Error("Cannot find module '"+b+"'");throw A.code="MODULE_NOT_FOUND",A;}A=k[b]={exports:{}};h[b][0].call(A.exports,function(c){var d=h[b][1][c];return n(d?d:c)},A,A.exports,e$$0,h,k,d)}return k[b].exports}for(var c="function"==typeof require&&require,b=0;b<d.length;b++)n(d[b]);return n})({1:[function(e,h,k){var d=e("../regl")(),n=d({frag:"\n    precision mediump float;\n    uniform vec4 color;\n    void main() {\n      gl_FragColor = color;\n    }",
vert:"\n    precision mediump float;\n    attribute vec2 position;\n    uniform float angle;\n    void main() {\n      gl_Position = vec4(\n        cos(angle) * position.x + sin(angle) * position.y,\n        -sin(angle) * position.x + cos(angle) * position.y, 0, 1);\n    }",attributes:{position:d.buffer([-1,0,0,-1,1,1])},uniforms:{color:d.prop("color"),angle:function(c,b,d){return.01*d.count}},depth:{enable:!1},count:3});d.frame(function(c){d.clear({color:[0,0,0,1]});n({color:[Math.sin(.001*c),Math.cos(.02*
c),Math.sin(.3*c),1]})})},{"../regl":33}],2:[function(e,h,k){var d=e("./constants/dtypes.json");h.exports=function(n,c,b,e,f){function A(){this.pointer=!1;this.w=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}function q(c){this.records=[];this.name=c}function h(b,a,p,d){d=p.size||d;var g;g=a.pointer?p.pointer&&a.buffer===p.buffer&&a.size===d&&a.normalized===p.normalized&&a.type===p.type&&a.offset===p.offset&&a.stride===
p.stride&&a.divisor===p.divisor:!p.pointer&&a.x===p.x&&a.y===p.y&&a.z===p.z&&a.w===p.w;g||(p.pointer?(a.pointer||n.enableVertexAttribArray(b),a.buffer!==p.buffer&&p.buffer.bind(),n.vertexAttribPointer(b,d,p.type,p.normalized,p.stride,p.offset),(g=c.angle_instanced_arrays)&&g.vertexAttribDivisorANGLE(b,p.divisor)):(a.pointer&&n.disableVertexAttribArray(b),n.vertexAttrib4f(b,p.x,p.y,p.z,p.w)),(a.pointer=p.pointer)?(a.buffer=p.buffer,a.size=d,a.normalized=p.normalized,a.type=p.type,a.offset=p.offset,
a.stride=p.stride,a.divisor=p.divisor):(a.x=p.x,a.y=p.y,a.z=p.z,a.w=p.w))}var z={};b=b.maxAttributes;for(var t=Array(b),g=0;g<b;++g)t[g]=new A;return{bindings:t,bind:function(b,a,c,d){c=c.records;h(b,a,c[c.length-1],d)},bindRecord:h,def:function(c){var a=f.id(c),b=z[a];b||(b=z[a]=new q(c));return b},box:function(c){var a=[new A];return{alloc:function(c){var b;b=0>=a.length?new A:a.pop();if("number"===typeof c)b.pointer=!1,b.x=c,b.y=0,b.z=0,b.w=0;else if(Array.isArray(c))b.pointer=!1,b.x=c[0],b.y=
c[1],b.z=c[2],b.w=c[3];else{var g=e.getBuffer(c),n=0,q=0,f=0,h=0,v=!1,G=5126;g?G=g.dtype:(g=e.getBuffer(c.buffer),n=c.size||0,q=c.stride||0,f=c.offset||0,h=c.divisor||0,v=c.normalized||!1,G=g.dtype,"type"in c&&(G=d[c.type]));b.pointer=!0;b.buffer=g;b.size=n;b.offset=f;b.stride=q;b.divisor=h;b.normalized=v;b.type=G}return b},free:function(b){a.push(b)}}},state:z}}},{"./constants/dtypes.json":6}],3:[function(e,h,k){function d(b,c){switch(b){case 5121:return new Uint8Array(c);case 5123:return new Uint16Array(c);
case 5125:return new Uint32Array(c);case 5120:return new Int8Array(c);case 5122:return new Int16Array(c);case 5124:return new Int32Array(c);case 5126:return new Float32Array(c);default:return null}}var n=e("./util/is-typed-array"),c=e("./util/is-ndarray"),b=e("./constants/arraytypes.json"),L=e("./constants/dtypes.json"),f=e("./util/values"),A={"static":35044,dynamic:35048,stream:35040};h.exports=function(q){function e(c,b){this.id=g++;this.buffer=c;this.type=b;this.usage=35044;this.byteLength=0;this.dimension=
1;this.data=null;this.dtype=5121}function h(c){q.isBuffer(c.buffer)||(c.buffer=q.createBuffer());c.bind();q.bufferData(c.type,c.data||c.byteLength,c.usage)}function t(c){var b=c.buffer;q.isBuffer(b)&&q.deleteBuffer(b);c.buffer=null;delete v[c.id]}var g=0,v={};e.prototype.bind=function(){q.bindBuffer(this.type,this.buffer)};return{create:function(a,g,f){function E(a){var g=a||{};if(Array.isArray(g)||n(g)||c(g))g={data:g};else if("number"===typeof g)g={length:g|0};else if(null===g||void 0===g)g={};
k.usage="usage"in g?A[g.usage]:35044;a=0;"type"in g&&(a=L[g.type]);var p=g.dimension|0||1,q=0,f=null;if("data"in g)if(f=g.data,null===f)q=g.length|0;else{if(c(f)){var p=f.shape,q=f.stride,g=f.offset,e=0,v=0,t=0,m=0;1===p.length?(e=p[0],v=1,t=q[0],m=0):2===p.length&&(e=p[0],v=p[1],t=q[0],m=q[1]);a=a||b[Object.prototype.toString.call(f)]|0||5126;for(var p=v,q=d(a,e*v),f=f.data,R=0,ga=0;ga<e;++ga)for(var N=0;N<v;++N)q[R++]=f[t*ga+m*N+g];f=q}else if(Array.isArray(f))if(0<f.length&&Array.isArray(f[0])){p=
f[0].length;a=a||5126;g=d(a,f.length*p);q=f;f=p;for(e=m=0;e<q.length;++e)for(t=q[e],v=0;v<f;++v)g[m++]=t[v];f=g}else a=a||5126,f=d(a,f);else a=a||b[Object.prototype.toString.call(f)]|0;q=f.byteLength}else"length"in g&&(q=g.length|0);k.data=f;k.dtype=a||5121;k.byteLength=q;k.dimension=p;h(k);return E}var B=q.createBuffer(),k=new e(B,g);v[k.id]=k;f||E(a);E._reglType="buffer";E._buffer=k;E.destroy=function(){t(k)};return E},clear:function(){f(v).forEach(t)},refresh:function(){f(v).forEach(h)},getBuffer:function(c){return c&&
c._buffer instanceof e?c._buffer:null}}}},{"./constants/arraytypes.json":5,"./constants/dtypes.json":6,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":32}],4:[function(e,h,k){function d(c){switch(c){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function n(c,b,g,d){var a,p=",";switch(b){case 5126:a="1f";break;case 35664:a="2fv";break;case 35665:a="3fv";break;case 35666:a="4fv";break;
case 35670:case 5124:a="1i";break;case 35671:case 35667:a="2iv";break;case 35672:case 35668:a="3iv";break;case 35673:case 35669:a="4iv";break;case 35674:a="Matrix2fv";p=",false,";break;case 35675:a="Matrix3fv";p=",false,";break;case 35676:a="Matrix4fv",p=",false,"}return c+".uniform"+a+"("+g+p+d+");"}function c(c){return c+"["+c+".length-1]"}function b(c,b){return"framebuffer"===c||c<b?-1:c>b?1:0}var L=e("./util/codegen"),f=e("./constants/primitives.json"),A={0:0,1:1,zero:0,one:1,"src color":768,
"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},q={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},G={0:0,zero:0,keep:7680,replace:7681,increment:7682,
decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};h.exports=function(e,h,g,v,a,p,u,E,k,Q,x,U,P,ka,X){function ja(a,m,h,v,S){function u(c){var b=I[c];return b?b:b=I[c]=r(V[c])}function t(c){var b=c.id,a=U[b];if(a)return a;a=c.func?l.def(r(c.data),"(",W,",",Z,",",ba,")"):l.def(W,".",c.data);return U[b]=a}function ha(c,b){for(var a=0;a<c.length;++a)if(c[a].name===b)return c[a];return null}function k(c){return la&&!(c in m||c in S)}var ia=L(),r=ia.link,l=ia.proc("batch"),ca=ia.block(),
D=l.def,M=l.arg,y=r(e),w=r(a.program),O=r(x.bind),J=r(x.bindRecord),ba=r(ka),pa=r(E),da=r(P.count),fa=r(P.offset),ma=r(P.instances),C=r(P.primitive),I={},F=r(p.elements),da=D(c(da)),fa=D(c(fa)),C=D(c(C)),F=D(c(F)),K,B,ea=g.angle_instanced_arrays;ea&&(K=D(c(ma)),B=r(ea));var la="elements"in m,ma=M(),M=M(),W=D(),Z=D(),U={};l(y,".useProgram(",w,");");a.uniforms.forEach(function(c){if(!(c.name in h)){var b=r(c.location),a=r(Q.def(c.name)),a=a+"["+a+".length-1]";c=c.info.type;35678===c||35680===c?(c=D(a+
"._texture"),l(n(y,5124,b,c+".bind()")),ca(c,".unbind();")):l(n(y,c,b,a))}});a.attributes.forEach(function(c){if(!(c.name in v)){var b=r(x.def(c.name));l(O,"(",c.location,",",r(x.bindings[c.location]),",",b,",",d(c.info.type),");")}});la||l("if(",F,")",y,".bindBuffer(",34963,",",F,".buffer.buffer);");l("for(",Z,"=0;",Z,"<",ma,";++",Z,"){",W,"=",M,"[",Z,"];");Object.keys(m).sort(b).forEach(function(c){function b(c){l("if(",a,"){",y,".enable(",c,");}else{",y,".disable(",c,");}")}var a=t(m[c]);switch(c){case "framebuffer":c=
u("viewport");var w=u("scissor.box");l("if(",pa,".push(",a,"&&",a,"._framebuffer)){",pa,".poll();",c,".setDirty();",w,".setDirty();","}");break;case "cull.enable":b(2884);break;case "blend.enable":b(3042);break;case "dither":b(3024);break;case "stencil.enable":b(2960);break;case "depth.enable":b(2929);break;case "scissor.enable":b(3089);break;case "polygonOffset.enable":b(32823);break;case "sample.alpha":b(32926);break;case "sample.enable":b(32928);break;case "depth.mask":l(y,".depthMask(",a,");");
break;case "depth.func":c=r(q);l(y,".depthFunc(",c,"[",a,"]);");break;case "depth.range":l(y,".depthRange(",a,"[0],",a,"[1]);");break;case "blend.color":l(y,".blendColor(",a,"[0],",a,"[1],",a,"[2],",a,"[3]);");break;case "blend.equation":c=r(H);l("if(typeof ",a,'==="string"){',y,".blendEquation(",c,"[",a,"]);","}else{",y,".blendEquationSeparate(",c,"[",a,".rgb],",c,"[",a,".alpha]);","}");break;case "blend.func":c=r(A);l(y,".blendFuncSeparate(",c,'["srcRGB" in ',a,"?",a,".srcRGB:",a,".src],",c,'["dstRGB" in ',
a,"?",a,".dstRGB:",a,".dst],",c,'["srcAlpha" in ',a,"?",a,".srcAlpha:",a,".src],",c,'["dstAlpha" in ',a,"?",a,".dstAlpha:",a,".dst]);");break;case "stencil.mask":l(y,".stencilMask(",a,");");break;case "stencil.func":c=r(q);l(y,".stencilFunc(",c,"[",a,'.cmp||"always"],',a,".ref|0,",'"mask" in ',a,"?",a,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":w=r(G);l(y,".stencilOpSeparate(","stencil.opFront"===c?1028:1029,",",w,"[",a,'.fail||"keep"],',w,"[",a,'.zfail||"keep"],',w,"[",a,'.pass||"keep"]);');
break;case "polygonOffset.offset":l(y,".polygonOffset(",a,".factor||0,",a,".units||0);");break;case "cull.face":l(y,".cullFace(",a,'==="front"?',1028,":",1029,");");break;case "lineWidth":l(y,".lineWidth(",a,");");break;case "frontFace":l(y,".frontFace(",a,'==="cw"?',2304,":",2305,");");break;case "colorMask":l(y,".colorMask(",a,"[0],",a,"[1],",a,"[2],",a,"[3]);");break;case "sample.coverage":l(y,".sampleCoverage(",a,".value,",a,".invert);");break;case "scissor.box":case "viewport":c=u(c),l(c,".push(",
a,".x||0,",a,".y||0,",a,".w||-1,",a,".h||-1);")}});("viewport"in m||"framebuffer"in m)&&l(u("viewport"),".poll();");("scissor.box"in m||"framebuffer"in m)&&l(u("scissor.box"),".poll();");"framebuffer"in m&&l(pa,".pop();");var X=a.uniforms,ra=[];Object.keys(h).forEach(function(c){var a=ha(X,c);if(a){var b=a.info.type,w=r(a.location);c=t(h[c]);35678===a.info.type||35680===a.info.type?(a=D(c+"._texture"),ra.push(a),l(n(y,5124,w,a+".bind()"))):l(n(y,b,w,c))}});ra.forEach(function(c){l(c,".unbind();")});
var ta=a.attributes;Object.keys(v).forEach(function(c){var a=ha(ta,c);if(a){var b=r(x.box(c));c=t(v[c]);c=D(b+".alloc("+c+")");l(J,"(",a.location,",",r(x.bindings[a.location]),",",c,",",d(a.info.type),");");ca(b,".free(",c,");")}});m.count&&l(da,"=",t(m.count),";");m.offset&&l(fa,"=",t(m.offset),";");m.primitive&&l(C,"=",r(f),"[",t(m.primitive),"];");ea&&m.instances&&l(K,"=",t(m.instances),";");la&&(a=t(m.elements),l(F,"=",a,"?",a,"._elements:null;"));k("offset")&&l(fa,"=0;");l("if(",F,"){");k("count")&&
l(da,"=",F,".vertCount;");l("if(",da,">0){");k("primitive")&&l(C,"=",F,".primType;");la&&l(y,".bindBuffer(",34963,",",F,".buffer.buffer);");ea&&l("if(",K,">0){",B,".drawElementsInstancedANGLE(",C,",",da,",",F,".type,",fa,",",K,");}else ");l(y,".drawElements(",C,",",da,",",F,".type,",fa,");");l("}}else if(",da,">0){");k("count")||(k("primitive")&&l(C,"=",4,";"),ea&&l("if(",K,">0){",B,".drawArraysInstancedANGLE(",C,",",fa,",",da,",",K,");}else{"),l(y,".drawArrays(",C,",",fa,",",da,");"),ea&&l("}"));
l("}}",ca);return ia.compile().batch}var V=k.contextState,H={add:32774,subtract:32778,"reverse subtract":32779};g.ext_blend_minmax&&(H.min=32775,H.max=32776);var m=0;return{draw:function(a){var b=L(),m=b.link,f=b.proc("draw"),q=f.def,A=m(e),h=m(a.program),v=m(x.bind),t=m(P.count),u=m(P.offset),r=m(P.instances),l=m(P.primitive),E=m(p.elements),G=[];f(A,".useProgram(",h,");");a.attributes.forEach(function(c){var a=m(x.def(c.name));f(v,"(",c.location,",",m(x.bindings[c.location]),",",a,",",d(c.info.type),
");")});a.uniforms.forEach(function(c){var a=m(c.location),b=m(Q.def(c.name)),b=b+"["+b+".length-1]";c=c.info.type;35678===c||35680===c?(c=q(b+"._texture"),G.push(c),f(n(A,5124,a,c+".bind()"))):f(n(A,c,a,b))});G.forEach(function(c){f(c,".unbind();")});a=q(c(l));t=q(c(t));u=q(c(u));E=q(c(E));f("if(",t,"){");(h=g.angle_instanced_arrays)?(r=q(c(r)),h=m(h),f("if(",E,"){",E,".bind();","if(",r,">0){",h,".drawElementsInstancedANGLE(",a,",",t,",",E,".type,",u,",",r,");}else{",A,".drawElements(",a,",",t,",",
E,".type,",u,");}","}else if(",r,">0){",h,".drawArraysInstancedANGLE(",a,",",u,",",t,",",r,");}else{",A,".drawArrays(",a,",",u,",",t,");}}")):f("if(",E,"){",E,".bind();",A,".drawElements(",a,",",t,",",E,".type,",u,");","}else{",A,".drawArrays(",a,",",u,",",t,");}}");return b.compile().draw},command:function(c,a,d,g,n,e,v){function u(c){var a=ma[c];return a?a:a=ma[c]=l(V[c])}function k(c,a){var b=u(c);C(b,".push(",a,");");I(b,".pop();")}function z(c){var a=c.id,b=la[a];if(b)return b;b=c.func?F.def(l(c.data),
"(",ea,",0,",qa,")"):F.def(ea,".",c.data);return la[a]=b}var r=L(),l=r.link,B=r.block,D=r.proc,M=m++,y=l(X),w=l(U),O=l(E),J={count:l(P.count),offset:l(P.offset),instances:l(P.instances),primitive:l(P.primitive)},ba=l(p.elements),pa=l(f),da=l(q),fa=l(G),ma={},C=B(),I=B();Object.keys(c).sort(b).forEach(function(a){var b=c[a];switch(a){case "frag":case "vert":b=h.id(b);U.shader("frag"===a?35632:35633,b);C(w,".",a,".push(",b,");");I(w,".",a,".pop();");break;case "framebuffer":E.getFramebuffer(b);a=u("viewport");
var g=u("scissor.box");C("if(",O,".push(",l(b&&b._framebuffer),")){",a,".setDirty();",g,".setDirty();","}");I("if(",O,".pop()){",a,".setDirty();",g,".setDirty();","}");break;case "count":case "offset":case "instances":C(J[a],".push(",b,");");I(J[a],".pop();");break;case "primitive":C(J.primitive,".push(",f[b],");");I(J.primitive,".pop();");break;case "elements":g=p.getElements(b);b=!("primitive"in c);a=!("count"in c);g?(g=l(g),C(ba,".push(",g,");"),b&&C(J.primitive,".push(",g,".primType);"),a&&C(J.count,
".push(",g,".vertCount);")):(C(ba,".push(null);"),b&&C(J.primitive,".push(",4,");"),a&&C(J.count,".push(0);"));b&&I(J.primitive,".pop();");a&&I(J.count,".pop();");"offset"in c||(C(J.offset,".push(0);"),I(J.offset,".pop();"));I(ba,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":k(a,b);break;case "depth.func":k(a,q[b]);break;case "depth.range":a=
u(a);C(a,".push(",b[0],",",b[1],");");I(a,".pop();");break;case "blend.func":a=u(a);C(a,".push(",A["srcRGB"in b?b.srcRGB:b.src],",",A["dstRGB"in b?b.dstRGB:b.dst],",",A["srcAlpha"in b?b.srcAlpha:b.src],",",A["dstAlpha"in b?b.dstAlpha:b.dst],");");I(a,".pop();");break;case "blend.equation":a=u(a);"string"===typeof b?C(a,".push(",H[b],",",H[b],");"):"object"===typeof b&&C(a,".push(",H[b.rgb],",",H[b.alpha],");");I(a,".pop();");break;case "blend.color":a=u(a);C(a,".push(",b[0],",",b[1],",",b[2],",",
b[3],");");I(a,".pop();");break;case "stencil.mask":a=u(a);C(a,".push(",b,");");I(a,".pop();");break;case "stencil.func":var g=b.cmp||"keep",d=b.ref||0,b="mask"in b?b.mask:-1;a=u(a);C(a,".push(",q[g],",",d,",",b,");");I(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":g=b.fail||"keep";d=b.zfail||"keep";b=b.pass||"keep";a=u(a);C(a,".push(",G[g],",",G[d],",",G[b],");");I(a,".pop();");break;case "polygonOffset.offset":g=b.factor||0;b=b.units||0;a=u(a);C(a,".push(",g,",",b,");");I(a,".pop();");
break;case "cull.face":g=0;"front"===b?g=1028:"back"===b&&(g=1029);b=u(a);C(b,".push(",g,");");I(b,".pop();");break;case "lineWidth":k(a,b);break;case "frontFace":g=0;"cw"===b?g=2304:"ccw"===b&&(g=2305);b=u(a);C(b,".push(",g,");");I(b,".pop();");break;case "colorMask":a=u(a);C(a,".push(",b.map(function(a){return!!a}).join(),");");I(a,".pop();");break;case "sample.coverage":g="value"in b?b.value:1;b=!!b.invert;a=u(a);C(a,".push(",g,",",b,");");I(a,".pop();");break;case "viewport":case "scissor.box":var g=
b.x||0,d=b.y||0,m=-1,n=-1;"w"in b&&(m=b.w);"h"in b&&(n=b.h);b=u(a);C(b,".push(",g,",",d,",",m,",",n,");");I(b,".pop();")}});Object.keys(a).forEach(function(c){var b=l(Q.def(c));c=a[c];c="function"===typeof c&&c._reglType?l(c):Array.isArray(c)?l(c.slice()):+c;C(b,".push(",c,");");I(b,".pop();")});Object.keys(d).forEach(function(a){var c=d[a],b=l(x.def(a));a=l(x.box(a).alloc(c));C(b,".records.push(",a,");");I(b,".records.pop();")});var F=r.block(),K=r.block(),qa,ea;v&&(qa=l(ka),ea=C.def());var la={};
Object.keys(g).sort(b).forEach(function(a){var b=z(g[a]);switch(a){case "framebuffer":a=u("viewport");var w=u("scissor.box");F("if(",O,".push(",b,"&&",b,"._framebuffer)){",a,".setDirty();",w,".setDirty();","}");K("if(",O,".pop()){",a,".setDirty();",w,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=u(a);
F(a,".push(",b,");");K(a,".pop();");break;case "count":case "offset":case "instances":a=J[a];F(a,".push(",b,");");K(a,".pop();");break;case "primitive":a=J.primitive;F(a,".push(",pa,"[",b,"]);");K(a,".pop();");break;case "depth.func":a=u(a);F(a,".push(",da,"[",b,"]);");K(a,".pop();");break;case "blend.func":a=u(a);w=l(A);F(a,".push(",w,'["srcRGB" in ',b,"?",b,".srcRGB:",b,".src],",w,'["dstRGB" in ',b,"?",b,".dstRGB:",b,".dst],",w,'["srcAlpha" in ',b,"?",b,".srcAlpha:",b,".src],",w,'["dstAlpha" in ',
b,"?",b,".dstAlpha:",b,".dst]);");K(a,".pop();");break;case "blend.equation":a=u(a);w=l(H);F("if(typeof ",b,'==="string"){',a,".push(",w,"[",b,"],",w,"[",b,"]);","}else{",a,".push(",w,"[",b,".rgb],",w,"[",b,".alpha]);","}");K(a,".pop();");break;case "blend.color":a=u(a);F(a,".push(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");K(a,".pop();");break;case "stencil.mask":a=u(a);F(a,".push(",b,");");K(a,".pop();");break;case "stencil.func":a=u(a);F(a,".push(",da,"[",b,".cmp],",b,".ref|0,",'"mask" in ',b,"?",
b,".mask:-1);");K(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=u(a);F(a,".push(",fa,"[",b,'.fail||"keep"],',fa,"[",b,'.zfail||"keep"],',fa,"[",b,'.pass||"keep"]);');K(a,".pop();");break;case "polygonOffset.offset":a=u(a);F(a,".push(",b,".factor||0,",b,".units||0);");K(a,".pop();");break;case "cull.face":a=u(a);F(a,".push(",b,'==="front"?',1028,":",1029,");");K(a,".pop();");break;case "frontFace":a=u(a);F(a,".push(",b,'==="cw"?',2304,":",2305,");");K(a,".pop();");break;case "colorMask":a=
u(a);F(a,".push(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");K(a,".pop();");break;case "sample.coverage":a=u(a);F(a,".push(",b,".value,",b,".invert);");K(a,".pop();");break;case "scissor.box":case "viewport":a=u(a);F(a,".push(",b,".x||0,",b,".y||0,",'"w" in ',b,"?",b,".w:-1,",'"h" in ',b,"?",b,".h:-1);");K(a,".pop();");break;case "elements":a=!("primitive"in g)&&!("primitive"in c);var w=!("count"in g)&&!("count"in c),d=!("offset"in g)&&!("offset"in c),m=F.def();F("if(",b,"){",m,"=",b,"._elements;",ba,
".push(",m,");",a?J.primitive+".push("+m+".primType);":"",w?J.count+".push("+m+".vertCount);":"",d?J.offset+".push("+m+".offset);":"","}else{",ba,".push(null);","}");K(ba,".pop();","if(",b,"){",a?J.primitive+".pop();":"",w?J.count+".pop();":"",d?J.offset+".pop();":"","}")}});Object.keys(n).forEach(function(a){var b=l(Q.def(a));a=z(n[a]);F(b,".push(",a,");");K(b,".pop();")});Object.keys(e).forEach(function(a){var b=l(x.def(a)),c=z(e[a]);a=l(x.box(a));F(b,".records.push(",a,".alloc(",c,"));");K(a,".free(",
b,".records.pop());")});var W=D("scope"),Z=W.arg(),sa=W.arg();W(C);v&&W(ea,"=",Z,";",F);W(sa,"();",v?K:"",I);W=B();B=W.def();c.frag&&c.vert?(Z=c.frag,W(B,"=",l(U.program(h.id(c.vert),h.id(Z))),";")):W(B,"=",w,".program","(",w,".vert[",w,".vert.length-1]",",",w,".frag[",w,".frag.length-1]",");");Z=D("draw");Z(C,W);v&&Z(ea,"=",Z.arg(),";",F);Z(y,"();","if(",B,")",B,".draw(",v?ea:"",");",v?K:"",I);var na=D("batch");na(C,W);v=l(function(a,b,w){var d=a.batchCache[M];d||(d=a.batchCache[M]=ja(a,g,n,e,c));
return d(b,w)});na("if(",B,"){",y,"();",v,"(",B,",",na.arg(),",",na.arg(),");");Object.keys(g).forEach(function(a){(a=ma[a])&&na(a,".setDirty();")});na("}",I);return r.compile()}}}},{"./constants/primitives.json":7,"./util/codegen":23}],5:[function(e,h,k){h.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,
"[object ArrayBuffer]":5121}},{}],6:[function(e,h,k){h.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],7:[function(e,h,k){h.exports={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],8:[function(e,h,k){function d(b,d){function f(){var d=window.innerWidth,g=window.innerHeight;b!==document.body&&(g=b.getBoundingClientRect(),d=g.right-g.left,g=g.top-g.bottom);e.width=h*d;e.height=h*g;c(e.style,{width:d+"px",
height:g+"px"})}var e=document.createElement("canvas"),q=n(e,d);c(e.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(e);b===document.body&&(e.style.position="absolute",c(b.style,{margin:0,padding:0}));var h=+q.options.pixelRatio;window.addEventListener("resize",f,!1);var k=q.options.onDestroy;q.options=c(c({},q.options),{onDestroy:function(){window.removeEventListener("resize",f);b.removeChild(e);k&&k()}});f();return q}function n(b,d){function f(c){try{return b.getContext(c,n)}catch(d){return null}}
var n=d.glOptions||{};return{gl:f("webgl")||f("experimental-webgl")||f("webgl-experimental"),options:c({pixelRatio:window.devicePixelRatio},d)}}var c=e("./util/extend");h.exports=function(b){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:b[0],options:b[1]||{}};var e=document.body,f=b[1]||{};if("string"===typeof b[0])e=document.querySelector(b[0])||document.body;else if("object"===typeof b[0])if(b[0]instanceof HTMLElement)e=b[0];else{if(b[0]instanceof WebGLRenderingContext)return{gl:b[0],
options:c({pixelRatio:1},f)};f=b[0]}return e.nodeName&&"CANVAS"===e.nodeName.toUpperCase()?n(e,f):d(e,f)}},{"./util/extend":24}],9:[function(e,h,k){h.exports=function(d){return{primitive:[4],count:[-1],offset:[0],instances:[0]}}},{}],10:[function(e,h,k){function d(b,d){this.id=c++;this.func=b;this.data=d}function n(b,c){switch(typeof b){case "boolean":case "number":case "string":return new d(!1,b);case "function":return new d(!0,b);default:return n}}var c=0;h.exports={define:n,isDynamic:function(b){return"function"===
typeof b&&!b._reglType||b instanceof d},unbox:function(b,c){return b instanceof d?b:"function"===typeof b&&b!==n?new d(!0,b):new d(!1,c)}}},{}],11:[function(e,h,k){var d=e("./util/is-typed-array"),n=e("./util/is-ndarray"),c=e("./constants/primitives.json");h.exports=function(b,e,f){function h(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}h.prototype.bind=function(){this.buffer.bind()};return{create:function(b){function k(b){var f=e.oes_element_index_uint;if(b)if("number"===typeof b)t(b);
else{var a=null,p="static",q=0;Array.isArray(b)||d(b)||n(b)?a=b:("data"in b&&(a=b.data),"usage"in b&&(p=b.usage),"length"in b&&(q=b.length));Array.isArray(a)||n(a)&&"array"===a.dtype||"type"in b?t({type:b.type||(f?"uint32":"uint16"),usage:p,data:a,length:q}):t({usage:p,data:a,length:q});if(Array.isArray(a)||d(a))t.dimension=3}else t();f=z.buffer.byteLength;a=0;switch(z.buffer.dtype){case 5121:case 5120:a=5121;break;case 5123:case 5122:a=5123;f>>=1;break;case 5125:case 5124:a=5125,f>>=2}p=4;q=z.buffer.dimension;
1===q&&(p=0);2===q&&(p=1);3===q&&(p=4);"object"===typeof b&&("primitive"in b&&(p=c[b.primitive]),"count"in b&&(f=b.vertCount|0));z.primType=p;z.vertCount=f;z.type=a;return k}var z=new h,t=f.create(null,34963,!0);z.buffer=t._buffer;k(b);k._reglType="elements";k._elements=z;k.destroy=function(){t.destroy();z.buffer=null};return k},elements:[null],getElements:function(b){return b&&b._elements instanceof h?b._elements:null}}}},{"./constants/primitives.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26}],
12:[function(e,h,k){h.exports=function(d){function e(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(b){try{c[b]=
d.getExtension(b)}catch(e){}})}var c={};e();return{extensions:c,refresh:e}}},{}],13:[function(e,h,k){var d=e("./util/values"),n=e("./util/extend"),c=[1029];h.exports=function(b,e,f,h,q){function k(a,b,c,d){this.target=a;this.level=b;this.texture=c;this.renderbuffer=d}function z(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function t(a,b){var c=b.width,d=b.height;if(a.texture)var g=a.texture._texture,f=Math.max(1,g.params.width>>a.level),e=Math.max(1,
g.params.height>>a.level),c=c||f,d=d||e;else g=a.renderbuffer._renderbuffer,c=c||g.width,d=d||g.height;g.refCount+=1;b.width=c;b.height=d}function g(a,c){c?c.texture?b.framebufferTexture2D(36160,a,c.target,c.texture._texture.texture,c.level):b.framebufferRenderbuffer(36160,a,36161,c.renderbuffer._renderbuffer.renderbuffer):b.framebufferTexture2D(36160,a,3553,null,0)}function v(a){var b=3553,c=0,d=null,g=null;"object"===typeof a&&("level"in a&&(c=a.level|0),"target"in a&&(b=a.target|0));var f=a._reglType;
"texture"===f?d=a:"renderbuffer"===f&&(g=a,b=36161,c=0);return new k(b,c,d,g)}function a(a){return a&&(a.texture||a.renderbuffer)}function p(){this.id=X++;ja[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function u(a){b.isFramebuffer(a.framebuffer)||(a.framebuffer=b.createFramebuffer());H=!0;b.bindFramebuffer(36160,a.framebuffer);for(var c=a.colorAttachments,
d=0;d<c.length;++d)g(36064+d,c[d]);for(d=c.length;d<f.maxColorAttachments;++d)g(36064+d,null);g(36096,a.depthAttachment);g(36128,a.stencilAttachment);g(33306,a.depthStencilAttachment);e.webgl_draw_buffers&&e.webgl_draw_buffers.drawBuffersWEBGL(ka[c.length]);b.checkFramebufferStatus(36160)}function E(a){a=a.framebuffer;b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function B(){return V[V.length-1]}var Q={rgba:6408},x={rgba4:32854,rgb565:36194,"rgb5 a1":32855};e.ext_srgb&&(x.srgba=35907);e.ext_color_buffer_half_float&&
(x.rgba16f=34842,x.rgb16f=34843);e.webgl_color_buffer_float&&(x.rgba32f=34836);var U=[],P=[];e.webgl_depth_texture&&(U.push(6402),P.push(34041));n(n({},Q),x);d(Q);d(x);x=5121;U={uint8:5121};e.oes_texture_half_float&&(x=U["half float"]=36193);e.oes_texture_float&&(x=U["float"]=5126);U.best=x;var ka=function(){for(var a=Array(f.maxDrawbuffers),b=0;b<=f.maxDrawbuffers;++b)for(var c=a[b]=Array(b),d=0;d<b;++d)c[d]=36064+d;return a}(),X=0,ja={},V=[null],H=!0;return{top:B,dirty:function(){return H},push:function(a){a=
a||null;H=H||a!==B();V.push(a);return H},pop:function(){var a=B();V.pop();return H=H||a!==B()},getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof p)?a:null},poll:function(){if(H){var a=V[V.length-1],d=e.webgl_draw_buffers;a?(b.bindFramebuffer(36160,a.framebuffer),d&&d.drawBuffersWEBGL(ka[a.colorAttachments.length])):(b.bindFramebuffer(36160,null),d&&d.drawBuffersWEBGL(c));H=!1}},create:function(c){function d(c){var f,e=c||{},p=c=0;if("shape"in
e){var n=e.shape;c=n[0];p=n[1]}else"radius"in e&&(c=p=e.radius),"width"in e&&(c=e.width),"height"in e&&(p=e.height);var m=null,n=!1;if("colorBuffers"in e||"colorBuffer"in e){m=e.colorBuffers||e.colorBuffer;Array.isArray(m)||(m=[m]);g.width=c;g.height=p;m=m.map(v);for(f=0;f<m.length;++f)t(m[f],g);c=g.width;p=g.height}else{var E=!0,B="rgba",r="uint8",l=1,n=!0;g.width=c=c||b.drawingBufferWidth;g.height=p=p||b.drawingBufferHeight;"format"in e&&(B=e.format,E=B in Q);"type"in e&&(r=e.type);"colorCount"in
e&&(l=e.colorCount|0);if(g.ownsColor)for(m=g.colorAttachments;m.length>l;)z(m.pop());else m=[];for(f=0;f<m.length;++f){var L;a:{L=m[f];var D=E,x=B,y=c,w=p;if(L.texture){var O=L.texture;if(D){O({format:x,type:r,width:y,height:w});O._texture.refCount+=1;L=!0;break a}}else if(O=L.renderbuffer,!D){O({format:x,width:y,height:w});O._renderbuffer.refCount+=1;L=!0;break a}z(L);L=!1}L||(m[f--]=m[m.length-1],m.pop())}for(;m.length<l;)E?m.push(new k(3553,0,h.create({format:B,type:r,width:c,height:p},3553),null)):
m.push(new k(36161,0,null,q.create({format:B,width:c,height:p})))}g.width=c;g.height=p;B=E=f=null;r=!1;"depthBuffer"in e&&(f=v(e.depthBuffer));"stencilBuffer"in e&&(E=v(e.stencilBuffer));"depthStencilBuffer"in e&&(B=v(e.depthStencilBuffer));if(f||E||B)t(f||E||B,g);else if(l=!0,D=L=!1,"depth"in e&&(l=!!e.depth),"stencil"in e&&(L=!!e.stencil),"depthTexture"in e&&(D=!!e.depthTexture),e=g.depthAttachment||g.stencilAttachment||g.depthStencilAttachment,x=null,l||L)r=!0,D?(D=L?"depth stencil":"depth",g.ownsDepthStencil&&
e.texture?(e.texture({format:D,width:c,height:p}),e.texture._texture.refCount+=1,x=e):x=new k(3553,0,h.create({format:D,width:c,height:p},3553),null)):(D=l?L?"depth stencil":"depth":"stencil",g.ownsDepthStencil&&e.renderbuffer?(e.renderbuffer({format:D,width:c,height:p}),e.renderbuffer._renderbuffer.refCount+=1,x=e):x=new k(36161,0,null,q.create({format:D,width:c,height:p}))),l?L?B=x:f=x:E=x;c=g;c.colorAttachments.forEach(z);z(c.depthAttachment);z(c.stencilAttachment);z(c.depthStencilAttachment);
g.colorAttachments=m;g.depthAttachment=f;g.stencilAttachment=E;g.depthStencilAttachment=B;g.ownsColor=n;g.ownsDepthStencil=r;d.color=m.map(a);d.depth=a(f);d.stencil=a(E);d.depthStencil=a(B);u(g);d.width=g.width;d.height=g.height;return d}var g=new p;d(c);d._reglType="framebuffer";d._framebuffer=g;d._destroy=function(){E(g)};return d},clear:function(){d(ja).forEach(E)},refresh:function(){d(ja).forEach(u)}}}},{"./util/extend":24,"./util/values":32}],14:[function(e,h,k){h.exports=function(d,e){var c=
1;e.ext_texture_filter_anisotropic&&(c=d.getParameter(34047));var b=1,h=1;e.webgl_draw_buffers&&(b=d.getParameter(34852),h=d.getParameter(36063));return{colorBits:[d.getParameter(3410),d.getParameter(3411),d.getParameter(3412),d.getParameter(3413)],depthBits:d.getParameter(3414),stencilBits:d.getParameter(3415),subpixelBits:d.getParameter(3408),extensions:Object.keys(e).filter(function(b){return!!e[b]}),maxAnisotropic:c,maxDrawbuffers:b,maxColorAttachments:h,pointSizeDims:d.getParameter(33901),lineWidthDims:d.getParameter(33902),
maxViewportDims:d.getParameter(3386),maxCombinedTextureUnits:d.getParameter(35661),maxCubeMapSize:d.getParameter(34076),maxRenderbufferSize:d.getParameter(34024),maxTextureUnits:d.getParameter(34930),maxTextureSize:d.getParameter(3379),maxAttributes:d.getParameter(34921),maxVertexUniforms:d.getParameter(36347),maxVertexTextureUnits:d.getParameter(35660),maxVaryingVectors:d.getParameter(36348),maxFragmentUniforms:d.getParameter(36349),glsl:d.getParameter(35724),renderer:d.getParameter(7937),vendor:d.getParameter(7936),
version:d.getParameter(7938)}}},{}],15:[function(e,h,k){var d=e("./util/is-typed-array");h.exports=function(e,c,b){return function(h){var f=h||{};d(h)?f={data:f}:2===arguments.length?f={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof h&&(f={});c();var A=f.x||0,q=f.y||0,k=f.width||b.width,z=f.height||b.height,f=f.data||new Uint8Array(k*z*4);e.pixelStorei(3333,4);e.readPixels(A,q,k,z,6408,5121,f);return f}}},{"./util/is-typed-array":26}],16:[function(e,h,k){var d=e("./util/values");h.exports=
function(e,c,b){function h(){this.id=G++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function f(b){e.isRenderbuffer(b.renderbuffer)||(b.renderbuffer=e.createRenderbuffer());e.bindRenderbuffer(36161,b.renderbuffer);e.renderbufferStorage(36161,b.format,b.width,b.height)}function k(b){var c=b.renderbuffer;e.bindRenderbuffer(36161,null);e.isRenderbuffer(c)&&e.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete z[b.id]}var q={rgba4:32854,rgb565:36194,"rgb5 a1":32855,
depth:33189,stencil:36168,"depth stencil":34041};c.ext_srgb&&(q.srgba=35907);c.ext_color_buffer_half_float&&(q.rgba16f=34842,q.rgb16f=34843);c.webgl_color_buffer_float&&(q.rgba32f=34836);var G=0,z={};h.prototype.decRef=function(){0===--this.refCount&&k(this)};return{create:function(b){function c(a){a=a||{};var b=0,e=0;"shape"in a?(e=a.shape,b=e[0]|0,e=e[1]|0):("radius"in a&&(b=e=a.radius|0),"width"in a&&(b=a.width|0),"height"in a&&(e=a.height|0));c.width=d.width=Math.max(b,1);c.height=d.height=Math.max(e,
1);d.format=32854;"format"in a&&(d.format=q[a.format]);f(d);return c}var d=new h;z[d.id]=d;c(b);c._reglType="renderbuffer";c._renderbuffer=d;c.destroy=function(){d.decRef()};return c},refresh:function(){d(z).forEach(f)},clear:function(){d(z).forEach(k)}}}},{"./util/values":32}],17:[function(e,h,k){function d(c,b,d,e){this.name=c;this.id=b;this.location=d;this.info=e}var n=e("./util/values");h.exports=function(c,b,e,f,h){function q(a,b){var d=35632===a?t:g,e=d[b];if(!e){var f=h.str(b),e=c.createShader(a);
c.shaderSource(e,f);c.compileShader(e);d[b]=e}return e}function k(a,b){this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];this.draw=function(){};this.batchCache={}}function z(a){var g,n;g=q(35632,a.fragId);n=q(35633,a.vertId);var k=a.program=c.createProgram();c.attachShader(k,g);c.attachShader(k,n);c.linkProgram(k);var v=c.getProgramParameter(k,35718),t=a.uniforms=[];for(g=0;g<v;++g)if(n=c.getActiveUniform(k,g))if(1<n.size)for(var z=0;z<n.size;++z){var G=n.name.replace("[0]",
"["+z+"]");e.def(G);t.push(new d(G,h.id(G),c.getUniformLocation(k,G),n))}else e.def(n.name),t.push(new d(n.name,h.id(n.name),c.getUniformLocation(k,n.name),n));v=c.getProgramParameter(k,35721);t=a.attributes=[];for(g=0;g<v;++g)if(n=c.getActiveAttrib(k,g))b.def(n.name),t.push(new d(n.name,h.id(n.name),c.getAttribLocation(k,n.name),n));a.draw=f(a);a.batchCache={}}var t={},g={},v={},a=[];return{clear:function(){var b=c.deleteShader.bind(c);n(t).forEach(b);t={};n(g).forEach(b);g={};a.forEach(function(a){c.deleteProgram(a.program)});
a.length=0;v={}},refresh:function(){t={};g={};a.forEach(z)},program:function(b,c){var d=v[c];d||(d=v[c]={});var e=d[b];e||(e=new k(c,b),z(e),d[b]=e,a.push(e));return e},shader:q,frag:[-1],vert:[-1]}}},{"./util/values":32}],18:[function(e,h,k){var d=e("./util/stack"),n=e("./util/codegen");h.exports=function(c,b,e){function f(b,e){var a=d([!!e],function(a){a?c.enable(b):c.disable(b)});a.flag=b;return a}var h={dither:f(3024),"blend.enable":f(3042),"blend.color":d([0,0,0,0],function(b,d,a,e){c.blendColor(b,
d,a,e)}),"blend.equation":d([32774,32774],function(b,d){c.blendEquationSeparate(b,d)}),"blend.func":d([1,0,1,0],function(b,d,a,e){c.blendFuncSeparate(b,d,a,e)}),"depth.enable":f(2929,!0),"depth.func":d([513],function(b){c.depthFunc(b)}),"depth.range":d([0,1],function(b,d){c.depthRange(b,d)}),"depth.mask":d([!0],function(b){c.depthMask(b)}),"cull.enable":f(2884),"cull.face":d([1029],function(b){c.cullFace(b)}),frontFace:d([2305],function(b){c.frontFace(b)}),colorMask:d([!0,!0,!0,!0],function(b,d,a,
e){c.colorMask(b,d,a,e)}),lineWidth:d([1],function(b){c.lineWidth(b)}),"polygonOffset.enable":f(32823),"polygonOffset.offset":d([0,0],function(b,d){c.polygonOffset(b,d)}),"sample.alpha":f(32926),"sample.enable":f(32928),"sample.coverage":d([1,!1],function(b,d){c.sampleCoverage(b,d)}),"stencil.enable":f(2960),"stencil.mask":d([-1],function(b){c.stencilMask(b)}),"stencil.func":d([519,0,-1],function(b,d,a){c.stencilFunc(b,d,a)}),"stencil.opFront":d([7680,7680,7680],function(b,d,a){c.stencilOpSeparate(1028,
b,d,a)}),"stencil.opBack":d([7680,7680,7680],function(b,d,a){c.stencilOpSeparate(1029,b,d,a)}),"scissor.enable":f(3089),"scissor.box":d([0,0,-1,-1],function(d,e,a,f){var q=a,n=b.top();0>a&&(q=n?n.width-d:c.drawingBufferWidth-d);a=f;0>f&&(a=n?n.height-e:c.drawingBufferHeight-e);c.scissor(d,e,q,a)}),viewport:d([0,0,-1,-1],function(d,f,a,q){var n=a,h=b.top();0>a&&(n=h?h.width-d:c.drawingBufferWidth-d);a=q;0>q&&(a=h?h.height-f:c.drawingBufferHeight-f);c.viewport(d,f,n,a);e.width=n;e.height=a})},q=n(),
k=q.proc("poll"),z=q.proc("refresh");Object.keys(h).forEach(function(b){b=q.link(h[b]);k(b,".poll();");z(b,".setDirty();")});var t=q.compile();return{contextState:h,viewport:e,poll:t.poll,refresh:t.refresh,notifyViewportChanged:function(){h.viewport.setDirty();h["scissor.box"].setDirty()}}}},{"./util/codegen":23,"./util/stack":30}],19:[function(e,h,k){h.exports=function(){var d={"":0},e=[""];return{id:function(c){var b=d[c];if(b)return b;b=d[c]=e.length;e.push(c);return b},str:function(c){return e[c]}}}},
{}],20:[function(e,h,k){function d(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function n(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,d=1;d<b;++d)if(!Array.isArray(a[d])||a[d].length!==c)return!1;return!0}function c(a){return Object.prototype.toString.call(a)}function b(a){return"[object HTMLCanvasElement]"===c(a)}function L(a){return"[object CanvasRenderingContext2D]"===c(a)}var f=e("./util/extend"),A=e("./util/values"),
q=e("./util/is-typed-array"),G=e("./util/is-ndarray"),z=e("./util/load-texture"),t=e("./util/to-half-float"),g=e("./util/parse-dds"),v=[9984,9986,9985,9987];h.exports=function(a,e,h,k,B){function Q(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=this.miplevel=0;this.copy=!1;this.crossOrigin=
this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function x(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function U(a,b){var c,d,e=0,f=0,g=0,q=0,h=0,n=0,l=!1,m=!1,k=!1;for(c=0;c<b.length;++c)d=b[c],q=q||d.width<<d.miplevel,h=h||d.height<<d.miplevel,e=e||d.type,f=f||d.format,g=g||d.internalformat,
n=n||d.channels,l=l||d.needsPoll,m=m||d.needsListeners,d=d.miplevel,k=k||0<d;a.needsPoll=l;a.needsListeners=m;a.width=q;a.height=h;a.format=f;a.internalformat=g;a.type=e;if(3553!==a.target)for(c=0;6>c;++c);c=0<=v.indexOf(a.minFilter);a.genMipmaps=!k&&(a.genMipmaps||c);k=k||a.genMipmaps;a.minFilter||(a.minFilter=k?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(c=0;c<b.length;++c)d=b[c],d.channels||(d.channels=n),d.format||(d.format=f),d.internalformat||(d.internalformat=g),d.type||(d.type=
e)}function P(a){this.id=l++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new x(a);this.pixels=[]}function ka(a,b){function c(a,d){var e=d.mipmap,w;if(Array.isArray(e))for(var g=0;g<e.length;++g)w=new Q(a),w.parseFlags(b),w.parseFlags(d),w.parse(e[g],g),f.push(w);else w=new Q(a),w.parseFlags(b),w.parse(d,0),f.push(w)}var d;V(a);var e=a.params;x.call(e,a.target);var f=a.pixels;f.length=0;e.parse(b);if(3553===a.target)c(3553,
b);else{var g=b.faces||b;if(Array.isArray(g))for(d=0;6>d;++d)c(34069+d,g[d]);else if("string"!==typeof g)for(d=0;6>d;++d)c(34069+d,{})}U(e,f);e.needsListeners&&ja(a);e.needsPoll&&(a.pollId=D.length,D.push(a));X(a)}function X(b){a.isTexture(b.texture)||(b.texture=a.createTexture());var c=b.target,d=b.unit;0<=d?(a.activeTexture(33984+d),r=d):a.bindTexture(c,b.texture);for(var c=b.pixels,e=b.params,f=0;f<c.length;++f)c[f].upload(e);e.upload();0>d&&((d=y[r])?a.bindTexture(d.target,d.texture):(b.unit=
r,y[r]=b))}function ja(a){function b(a,c,d){var f=g(d);f.pixels.forEach(function(b){var d=new Q(f.cube?b.target:a);d.channels=f.channels;d.compressed=f.compressed;d.type=f.type;d.internalformat=f.format;d.format=ia[f.format];d.width=b.width;d.height=b.height;d.miplevel=b.miplevel||c;d.data=b.data;e.push(d)})}function c(){for(var f=0;f<e.length;++f){var g=e[f],q=g.image,h=g.video,n=g.xhr;q&&q.complete?(g.width=q.naturalWidth,g.height=q.naturalHeight):h&&2<h.readyState?(g.width=h.width,g.height=h.height):
n&&4===n.readyState&&(e[f]=e[e.length-1],e.pop(),n.removeEventListener("readystatechange",X),b(g.target,g.miplevel,n.response))}U(d,e);X(a)}var d=a.params,e=a.pixels;e.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){e.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",
c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function V(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((D[b]=D[D.length-1]).id=b,D.pop(),a.pollId=-1)}function H(b){var c=b.texture,d=b.unit,e=b.target;0<=d&&(a.activeTexture(33984+d),r=d,a.bindTexture(e,null),y[d]=null);V(b);a.isTexture(c)&&a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete ca[b.id]}var m={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
R={repeat:10497,clamp:33071,mirror:33648},ga={nearest:9728,linear:9729},N=f({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ga),aa={none:0,browser:37444},S={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},T={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Y={};e.ext_srgb&&(T.srgb=35904,T.srgba=35906);e.oes_texture_float&&(S["float"]=5126);e.oes_texture_half_float&&
(S["half float"]=36193);e.webgl_depth_texture&&(f(T,{depth:6402,"depth stencil":34041}),f(S,{uint16:5123,uint32:5125,"depth stencil":34042}));e.webgl_compressed_texture_s3tc&&f(Y,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});e.webgl_compressed_texture_atc&&f(Y,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});e.webgl_compressed_texture_pvrtc&&f(Y,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});e.webgl_compressed_texture_etc1&&(Y["rgb etc1"]=36196);var ha=Array.prototype.slice.call(a.getParameter(34467));Object.keys(Y).forEach(function(a){var b=Y[a];0<=ha.indexOf(b)&&(T[a]=b)});var oa=Object.keys(T);h.textureFormats=oa;var ia=oa.reduce(function(a,b){var c=T[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});f(Q.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=aa[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=T[b];b in S&&(this.type=S[b]);b in Y&&(this.compressed=!0)}"type"in a&&(this.type=S[a.type]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),
"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(a,e){this.miplevel=e;this.width>>=e;this.height>>=e;var f=a;switch(typeof a){case "object":if(!a)return;
this.parseFlags(a);var g=a.data;if("string"===typeof g||g&&(q(g)||d(g)||G(g)||b(g)||L(g)||"[object HTMLImageElement]"===c(g)||"[object HTMLVideoElement]"===c(g)||n(g)))f=a.data;break;case "undefined":return}"string"===typeof f&&(f=z(f,this.crossOrigin));var g=null,h=!1;if(null!==f)if(q(f))this.data=f;else if(d(f))g=f,h=!0;else if(G(f)){Array.isArray(f.data)?(g=f.data,h=!0):this.data=f.data;var l=f.shape;this.width=l[0];this.height=l[1];this.channels=3===l.length?l[2]:1;l=f.stride;this.strideX=f.stride[0];
this.strideY=f.stride[1];this.strideC=3===l.length?f.stride[2]:1;this.offset=f.offset;this.needsTranspose=!0}else if(b(f)||L(f))b(f)?this.canvas=f:this.canvas=f.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===c(f))this.image=f,f.complete?(this.width=f.naturalWidth,this.height=f.naturalHeight):(this.width=this.width||f.naturalWidth,this.height=this.height||f.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===c(f))this.video=f,1<f.readyState?(this.width=f.width,this.height=f.height):(this.width=this.width||f.width,this.height=this.height||f.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===c(f))this.xhr=f,this.needsListeners=!0;else if(n(f)){var h=f[0].length,l=f.length,m=1,k,p,A,r;if(Array.isArray(f[0][0]))for(m=f[0][0].length,g=Array(h*l*m),p=r=0;p<l;++p)for(k=0;k<h;++k)for(A=0;A<m;++A)g[r++]=f[p][k][A];
else for(g=Array(h*l),p=r=0;p<l;++p)for(k=0;k<h;++k)g[r++]=f[p][k];this.width=h;this.height=l;this.channels=m;h=!0}else a.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||B.width)|0,this.height=(this.height||B.height)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=[6409,
6410,6407,6408][(this.channels=this.channels||4)-1]);f=this.internalformat;l=this.format=ia[f];if(!this.channels)switch(l){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}l=this.type;5126!==l&&36193!==l&&(l||(l=6402===f?5125:5121));this.type=l;if(h)switch(l){case 5121:this.data=new Uint8Array(g);break;case 5123:this.data=new Uint16Array(g);break;case 5125:this.data=new Uint32Array(g);break;case 5126:this.data=
new Float32Array(g);break;case 36193:this.data=t(g)}if(this.data&&this.needsTranspose){g=this.data;f=this.width;h=this.height;l=this.channels;m=this.strideX;k=this.strideY;p=this.strideC;A=this.offset;r=new g.constructor(f*h*l);for(var u=0,v=0;v<h;++v)for(var x=0;x<f;++x)for(var y=0;y<l;++y)r[u++]=g[k*v+m*x+p*y+A];this.data=r}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(b){a.pixelStorei(37440,
this.flipY);a.pixelStorei(37441,this.premultiplyAlpha);a.pixelStorei(37443,this.colorSpace);a.pixelStorei(3317,this.unpackAlignment);var c=this.target,d=this.miplevel,e=this.image,f=this.canvas,g=this.video,h=this.data,q=this.internalformat,n=this.format,l=this.type,m=this.width||Math.max(1,b.width>>d);b=this.height||Math.max(1,b.height>>d);g&&2<g.readyState?a.texImage2D(c,d,n,n,l,g):e&&e.complete?a.texImage2D(c,d,n,n,l,e):f?a.texImage2D(c,d,n,n,l,f):this.compressed?a.compressedTexImage2D(c,d,q,m,
b,0,h):this.copy?(k(),a.copyTexImage2D(c,d,n,this.x,this.y,m,b,0)):h?a.texImage2D(c,d,n,m,b,0,n,l,h):a.texImage2D(c,d,n,m||1,b||1,0,n,l,null)}});f(x.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=N[a.min]);"mag"in a&&(this.magFilter=ga[a.mag]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var d=a.wrap;"string"===typeof d?b=c=R[d]:Array.isArray(d)&&(b=R[d[0]],c=R[d[1]])}else"wrapS"in a&&(b=R[a.wrapS]),"wrapT"in a&&(c=R[a.wrapT]);this.wrapS=b;this.wrapT=c;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=m[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var b=this.target;a.texParameteri(b,10241,this.minFilter);a.texParameteri(b,10240,this.magFilter);a.texParameteri(b,10242,this.wrapS);a.texParameteri(b,10243,this.wrapT);e.ext_texture_filter_anisotropic&&a.texParameteri(b,34046,this.anisotropic);this.genMipmaps&&(a.hint(33170,this.mipmapHint),a.generateMipmap(b))}});
var r=0,l=0,ca={},D=[],M=h.maxTextureUnits,y=Array(M).map(function(){return null});f(P.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<M;++c){var d=y[c];if(d){if(0<d.bindCount)continue;d.unit=-1}y[c]=this;b=c;break}this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture);r=b}return b},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&H(this)}});return{create:function(a,b){function c(a,e,f,g,h,n){var q=a||{};34067===b&&
6===arguments.length&&(q=[a,e,f,g,h,n]);ka(d,q);c.width=d.params.width;c.height=d.params.height;return c}var d=new P(b);ca[d.id]=d;c(a);c._reglType="texture";c._texture=d;c.destroy=function(){d.decRef()};return c},refresh:function(){A(ca).forEach(X);for(var b=0;b<M;++b)y[b]=null;r=0;a.activeTexture(33984)},clear:function(){for(var b=0;b<M;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),y[b]=null;a.activeTexture(33984);r=0;A(ca).forEach(H)},poll:function(){D.forEach(X)},getTexture:function(a){return null}}}},
{"./util/extend":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/load-texture":27,"./util/parse-dds":28,"./util/to-half-float":31,"./util/values":32}],21:[function(e,h,k){h.exports=function(d){var e={};return{def:function(c){c=d.id(c);var b=e[c];b||(b=e[c]=[]);return b},uniforms:e}}},{}],22:[function(e,h,k){h.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],23:[function(e,h,k){var d=e("./extend");h.exports=
function(){function e(){var b=[],f=[];return d(function(){b.push.apply(b,Array.prototype.slice.call(arguments))},{def:function(){var d="v"+c++;f.push(d);0<arguments.length&&(b.push(d,"="),b.push.apply(b,Array.prototype.slice.call(arguments)),b.push(";"));return d},toString:function(){return[0<f.length?"var "+f+";":"",b.join("")].join("")}})}var c=0,b=[],h=[],f={};return{link:function(d){var e="g"+c++;b.push(e);h.push(d);return e},block:e,proc:function(b){var h=[],k=e(),z=k.toString;return f[b]=d(k,
{arg:function(){var b="a"+c++;h.push(b);return b},toString:function(){return["function(",h.join(),"){",z(),"}"].join("")}})},compile:function(){var c=['"use strict";return {'];Object.keys(f).forEach(function(b){c.push('"',b,'":',f[b].toString(),",")});c.push("}");return Function.apply(null,b.concat([c.join("")])).apply(null,h)}}}},{"./extend":24}],24:[function(e,h,k){h.exports=function(d,e){for(var c=Object.keys(e),b=0;b<c.length;++b)d[c[b]]=e[c[b]];return d}},{}],25:[function(e,h,k){var d=e("./is-typed-array");
h.exports=function(e){return"object"===typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"===typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||d(e.data))}},{"./is-typed-array":26}],26:[function(e,h,k){var d=e("../constants/arraytypes.json");h.exports=function(e){return Object.prototype.toString.call(e)in d}},{"../constants/arraytypes.json":5}],27:[function(e,h,k){h.exports=function(d,e){if("undefined"!==typeof document){var c;c=(c=/\.(\w+)(\?.*)?$/.exec(d))&&
c[1]?c[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(c))return c=document.createElement("video"),c.autoplay=!0,c.loop=!0,e&&(c.crossOrigin=e),c.src=d,c;if(0<=["dds"].indexOf(c))return c=new XMLHttpRequest,c.responseType="arraybuffer",c.open("GET",d,!0),c.send(),c;c=new Image;e&&(c.crossOrigin=e);c.src=d;return c}return null}},{}],28:[function(e,h,k){h.exports=function(e){function h(a){for(var b=m,c=R,d=0;d<T;++d){var f=Math.max(1,
b+3>>2)*Math.max(1,c+3>>2)*aa;ha.pixels.push({target:a,miplevel:d,width:b,height:c,data:new Uint8Array(e,Y,f)});Y+=f;b>>=1;c>>=1}}var k=new Int32Array(e),H=k[E],m=k[Q],R=k[B],ga=q,N=0,aa=0,S=4;switch(k[P]){case g:aa=8;H&t?(S=3,N=c):N=b;break;case v:aa=16;N=L;break;case a:aa=16;N=f;break;case p:aa=8,N=A}var T=1;k[U]&G&&(T=Math.max(1,k[x]));var Y=k[u]+4,ha={width:m,height:R,channels:S,format:N,type:ga,compressed:!0,cube:!1,pixels:[]};if(k[ka]&z)for(ha.cube=!0,k=0;6>k;++k)h(n+k);else h(d);return ha};
var d=3553,n=34069,c=33776,b=33777,L=33778,f=33779,A=36196,q=5121,G=131072,z=512,t=64,g=827611204,v=861165636,a=894720068,p=826496069,u=1,E=2,B=3,Q=4,x=7,U=20,P=21,ka=28},{}],29:[function(e,h,k){h.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(d){return requestAnimationFrame(d)},cancel:function(d){return cancelAnimationFrame(d)}}:{next:function(d){setTimeout(d,30)},cancel:clearTimeout}},{}],30:[function(e,h,k){h.exports=function(d,e){var c=
d.length,b=d.slice(),h=d.slice(),f=!1,k=!0;return{push:function(){f=!1;for(var d=0;d<c;++d){var e=arguments[d];f=f||e!==h[d];b.push(e)}},pop:function(){f=!1;b.length-=c;for(var d=0;d<c;++d)f=f||b[b.length-c+d]!==h[d]},poll:function(){var d=b.length-c;if(f||k){switch(c){case 1:e(b[d]);break;case 2:e(b[d],b[d+1]);break;case 3:e(b[d],b[d+1],b[d+2]);break;case 4:e(b[d],b[d+1],b[d+2],b[d+3]);break;case 5:e(b[d],b[d+1],b[d+2],b[d+3],b[d+4]);break;case 6:e(b[d],b[d+1],b[d+2],b[d+3],b[d+4],b[d+5]);break;
default:e.apply(null,b.slice(d,b.length))}for(var G=0;G<c;++G)h[G]=b[d+G];k=f=!1}},setDirty:function(){k=!0}}}},{}],31:[function(e,h,k){h.exports=function(d){for(var e=new Float32Array(d),e=new Uint32Array(e.buffer),c=new Uint16Array(d.length),b=0;b<d.length;++b)if(isNaN(d[b]))c[b]=65535;else if(Infinity===d[b])c[b]=31744;else if(-Infinity===d[b])c[b]=64512;else{var h=e[b],f=h>>>31<<15,k=(h<<1>>>24)-127,h=h>>13&1023;c[b]=-24>k?f:-14>k?f+(h+1024>>-14-k):15<k?f+31744:f+(k+15<<10)+h}return c}},{}],32:[function(e,
h,k){h.exports=function(d){return Object.keys(d).map(function(e){return d[e]})}},{}],33:[function(e,h,k){var d=e("./lib/util/extend"),n=e("./lib/context"),c=e("./lib/strings"),b=e("./lib/extension"),L=e("./lib/limits"),f=e("./lib/buffer"),A=e("./lib/elements"),q=e("./lib/texture"),G=e("./lib/renderbuffer"),z=e("./lib/framebuffer"),t=e("./lib/uniform"),g=e("./lib/attribute"),v=e("./lib/shader"),a=e("./lib/draw"),p=e("./lib/state"),u=e("./lib/compile"),E=e("./lib/read"),B=e("./lib/dynamic"),Q=e("./lib/util/raf"),
x=e("./lib/util/clock");h.exports=function(){function e(){ba=Q.next(e);M.count+=1;if(M.width!==m.drawingBufferWidth||M.height!==m.drawingBufferHeight)M.width=m.drawingBufferWidth,M.height=m.drawingBufferHeight,y.notifyViewportChanged();var a=x();M.dt=a-M.t;M.t=a;l.poll();for(var b=0;b<J.length;++b)(0,J[b])(M.count,M.t,M.dt);M.renderTime=x()-a}function h(){ba&&(Q.cancel(e),ba=0)}function k(a){h();a.preventDefault();if(R.onContextLost)R.onContextLost()}function X(a){m.getError();ga.refresh();T.refresh();
l.refresh();ca.refresh();D.refresh();ia.refresh();y.refresh();if(R.onContextRestored)R.onContextRestored();e()}function ja(a){function b(a){var d={},e={};Object.keys(a).forEach(function(b){var f=a[b];B.isDynamic(f)?(c=!0,e[b]=B.unbox(f,b)):d[b]=f});return{dynamic:e,"static":d}}var c=!1,e=b(a.uniforms||{}),f=b(a.attributes||{});a=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=d({},a);delete c.uniforms;delete c.attributes;b("blend");
b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var e=w.command(a["static"],e["static"],f["static"],a.dynamic,e.dynamic,f.dynamic,c),g=e.draw,h=e.batch,k=e.scope,l=[];return function(a,b){if("function"===typeof a)return k(null,a);if("function"===typeof b)return k(a,b);if("number"===typeof a){for(var c=a|0;l.length<c;)l.push(null);return h(a|0,l)}return Array.isArray(a)?h(a.length,a):g(a)}}function V(){D.poll();y.poll()}var H=n(Array.prototype.slice.call(arguments)),
m=H.gl,R=H.options,H=c(),ga=b(m),N=ga.extensions,aa={width:m.drawingBufferWidth,height:m.drawingBufferHeight},S=L(m,N),T=f(m),Y=A(m,N,T),ha=t(H),oa=g(m,N,S,T,H),ia=v(m,oa,ha,function(a){return w.draw(a)},H),r=a(m,N,T),l=q(m,N,S,V,aa),ca=G(m,N,S),D=z(m,N,S,l,ca),M={count:0,start:x(),dt:0,t:x(),renderTime:0,width:m.drawingBufferWidth,height:m.drawingBufferHeight,pixelRatio:R.pixelRatio},y=p(m,D,aa),aa=E(m,V,aa),w=u(m,H,N,S,T,Y,l,D,y,ha,oa,ia,r,M,V),O=m.canvas,J=[],ba=0;O&&(O.addEventListener("webglcontextlost",
k,!1),O.addEventListener("webglcontextrestored",X,!1));return d(ja,{clear:function(a){var b=0;V();var c=a.color;c&&(m.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(m.clearDepth(+a.depth),b|=256);"stencil"in a&&(m.clearStencil(a.stencil|0),b|=1024);m.clear(b)},prop:B.define,draw:ja({}),elements:function(a){return Y.create(a)},buffer:function(a){return T.create(a,34962)},texture:function(a){return l.create(a,3553)},cube:function(a){return 6===arguments.length?l.create(Array.prototype.slice.call(arguments),
34067):l.create(a,34067)},renderbuffer:function(a){return ca.create(a)},framebuffer:function(a){return D.create(a)},framebufferCube:function(a){},frame:function(a){J.push(a);!ba&&0<J.length&&e();return{cancel:function(){var b=J.find(function(b){return b===a});0>b||(J.splice(b,1),0>=J.length&&h())}}},stats:M,limits:S,read:aa,destroy:function(){h();O&&(O.removeEventListener("webglcontextlost",k),O.removeEventListener("webglcontextrestored",X));ia.clear();D.clear();ca.clear();l.clear();T.clear();if(R.onDestroy)R.onDestroy()}})}},
{"./lib/attribute":2,"./lib/buffer":3,"./lib/compile":4,"./lib/context":8,"./lib/draw":9,"./lib/dynamic":10,"./lib/elements":11,"./lib/extension":12,"./lib/framebuffer":13,"./lib/limits":14,"./lib/read":15,"./lib/renderbuffer":16,"./lib/shader":17,"./lib/state":18,"./lib/strings":19,"./lib/texture":20,"./lib/uniform":21,"./lib/util/clock":22,"./lib/util/extend":24,"./lib/util/raf":29}]},{},[1]);

        </script>
        </body>
      </html>