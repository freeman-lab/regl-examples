(function e$$0(n,q,h){function g(a,e){if(!q[a]){if(!n[a]){var b="function"==typeof require&&require;if(!e&&b)return b(a,!0);if(c)return c(a,!0);b=Error("Cannot find module '"+a+"'");throw b.code="MODULE_NOT_FOUND",b;}b=q[a]={exports:{}};n[a][0].call(b.exports,function(c){var e=n[a][1][c];return g(e?e:c)},b,b.exports,e$$0,n,q,h)}return q[a].exports}for(var c="function"==typeof require&&require,b=0;b<h.length;b++)g(h[b]);return g})({1:[function(f,n,q){var h=f("../regl")(),g=h({frag:"\n    precision mediump float;\n    uniform vec4 color;\n    void main() {\n      gl_FragColor = color;\n    }",
vert:"\n    precision mediump float;\n    attribute vec2 position;\n    uniform float angle;\n    void main() {\n      gl_Position = vec4(\n        cos(angle) * position.x + sin(angle) * position.y,\n        -sin(angle) * position.x + cos(angle) * position.y, 0, 1);\n    }",attributes:{position:[-1,0,0,-1,1,1]},uniforms:{color:h.prop("color"),angle:function(c){return.01*c.count}},depth:{enable:!1},count:3});h.frame(function(c){c=c.count;h.clear({color:[0,0,0,1]});g({color:[Math.sin(.001*c),Math.cos(.02*
c),Math.sin(.3*c),1]})})},{"../regl":34}],2:[function(f,n,q){function h(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}n.exports=function(g,c,b,a,e){g=b.maxAttributes;c=Array(g);for(b=0;b<g;++b)c[b]=new h;return{Record:h,scope:{},state:c}}},{}],3:[function(f,n,q){function h(a,c){for(var e=0;e<c.length;++e)a[e]=c[e]}var g=f("./util/is-typed-array"),c=f("./util/is-ndarray"),b=f("./util/values"),a=f("./util/flatten"),
e=f("./util/transpose"),u=f("./util/pool"),H=f("./constants/arraytypes.json"),V=f("./constants/dtypes.json"),z=f("./constants/usage.json");n.exports=function(f){function p(a){this.id=m++;this.buffer=f.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121}function v(a,c,e){a.byteLength=c.byteLength;f.bufferData(a.type,c,e)}function l(b,l,m,f,p){b.usage=m;if(Array.isArray(l))b.dtype=f||5126,0<l.length&&Array.isArray(l[0])?(b.dimension=l[0].length,f=u.allocType(b.dtype,
l.length*b.dimension),a(f,l,b.dimension)):(b.dimension=p,f=u.allocType(b.dtype,l.length),h(f,l)),v(b,f,m),u.freeType(f);else if(g(l))b.dtype=f||H[Object.prototype.toString.call(l)]|0,b.dimension=p,v(b,l,m);else if(c(l)){var t=l.shape,w=l.stride;p=l.offset;var I=0,W=0,n=0,G=0;1===t.length?(I=t[0],W=1,n=w[0],G=0):2===t.length&&(I=t[0],W=t[1],n=w[0],G=w[1]);b.dtype=f||H[Object.prototype.toString.call(l.data)]|0||5126;b.dimension=W;f=u.allocType(b.dtype,I*W);e(f,l.data,I,W,n,G,p);v(b,f,m);u.freeType(f)}}
function w(a){var c=a.buffer;f.isBuffer(c)&&f.deleteBuffer(c);a.buffer=null;delete n[a.id]}var m=0,n={};p.prototype.bind=function(){f.bindBuffer(this.type,this.buffer)};var O=[];return{create:function(b,m,v){function O(a){var e=35044,b=null,h=0,m=0,p=1;Array.isArray(a)||g(a)||c(a)?b=a:"number"===typeof a?h=a|0:a&&("data"in a&&(b=a.data),"usage"in a&&(e=z[a.usage]),"type"in a&&(m=V[a.type]),"dimension"in a&&(p=a.dimension|0),"length"in a&&(h=a.length|0));q.bind();b?l(q,b,e,m,p):(f.bufferData(q.type,
h,e),q.dtype=m||5121,q.usage=e,q.dimension=p,q.byteLength=h);return O}var q=new p(m);n[q.id]=q;v||O(b);O._reglType="buffer";O._buffer=q;O.subdata=function(b,l){var m=(l||0)|0;q.bind();if(Array.isArray(b))if(0<b.length&&Array.isArray(b[0])){var p=b[0].length,w=u.allocType(q.dtype,b.length*p);a(w,b,p);f.bufferSubData(q.type,m,w);u.freeType(w)}else p=u.allocType(q.dtype,b.length),h(p,b),f.bufferSubData(q.type,m,p),u.freeType(p);else if(g(b))f.bufferSubData(q.type,m,b);else if(c(b)){var n=b.shape,v=b.stride,
x=w=p=0,F=0;1===n.length?(p=n[0],w=1,x=v[0],F=0):2===n.length&&(p=n[0],w=n[1],x=v[0],F=v[1]);n=Array.isArray(b.data)?q.dtype:H[Object.prototype.toString.call(b.data)]|0;n=u.allocType(n,p*w);e(n,b.data,p,w,x,F,b.offset);f.bufferSubData(q.type,m,n);u.freeType(n)}return O};O.destroy=function(){w(q)};return O},createStream:function(a,b){var c=O.pop();c||(c=new p(a),c.buffer=f.createBuffer());c.bind();l(c,b,35040,0,1);return c},destroyStream:function(a){O.push(a)},clear:function(){b(n).forEach(w)},getBuffer:function(a){return a&&
a._buffer instanceof p?a._buffer:null},_initBuffer:l}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/flatten":22,"./util/is-ndarray":23,"./util/is-typed-array":24,"./util/pool":28,"./util/transpose":31,"./util/values":32}],4:[function(f,n,q){n.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,
"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(f,n,q){n.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],6:[function(f,n,q){n.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(f,n,q){n.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(f,n,q){function h(a){return Array.isArray(a)||V(a)||
z(a)}function g(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function c(a,b,c,e){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=e}function b(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function a(a){return new c(!1,!1,!1,a)}function e(a,b){var e=a.type;return 0===e?(e=a.data.length,new c(!0,1<=e,2<=e,b)):new c(3===e,2===e,1===e,b)}var u=f("./util/codegen"),H=f("./util/loop"),V=f("./util/is-typed-array"),z=f("./util/is-ndarray"),A=f("./constants/primitives.json"),
p=f("./constants/dtypes.json"),v=["x","y","z","w"],l={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},w={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,
"!=":517,"!==":517,gequal:518,">=":518,always:519},m={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},x={cw:2304,ccw:2305},O=new c(!1,!1,!1,function(){});n.exports=function(f,n,q,z,R,t,la,I,W,Y,G,Z,J){function Q(a){return a.replace(".","_")}function K(a,d,b){var e=Q(a);pa.push(a);ma[e]=ga[e]=!!b;ha[e]=d}function D(a,d,b){var e=Q(a);pa.push(a);Array.isArray(b)?(ga[e]=b.slice(),ma[e]=b.slice()):ga[e]=ma[e]=b;ia[e]=d}function B(){var a=
u(),d=a.link,b=a.global;a.id=Ba++;a.batchId="0";var e=d(xa),c=a.shared={props:"a0"};Object.keys(xa).forEach(function(k){c[k]=b.def(e,".",k)});var C=a.next={},r=a.current={};Object.keys(ia).forEach(function(k){Array.isArray(ga[k])&&(C[k]=b.def(c.next,".",k),r[k]=b.def(c.current,".",k))});var k=a.constants={};Object.keys(qa).forEach(function(a){k[a]=b.def(JSON.stringify(qa[a]))});a.invoke=function(k,b){switch(b.type){case 0:var ba=["this",c.context,c.props,a.batchId];return k.def(d(b.data),".call(",
ba.slice(0,Math.max(b.data.length+1,4)),")");case 1:return k.def(c.props,b.data);case 2:return k.def(c.context,b.data);case 3:return k.def("this",b.data)}};a.attribCache={};var ba={};a.scopeAttrib=function(k){k=n.id(k);if(k in ba)return ba[k];var a=Y.scope[k];a||(a=Y.scope[k]=new na);return ba[k]=d(a)};return a}function ca(d){var b=d["static"];d=d.dynamic;if("framebuffer"in b){var c=b.framebuffer;return c?(c=I.getFramebuffer(c),a(function(a,d){var b=a.link(c),k=a.shared;d.set(k.framebuffer,".next",
b);k=k.context;d.set(k,".framebufferWidth",b+".width");d.set(k,".framebufferHeight",b+".height");return b})):a(function(a,d){var b=a.shared;d.set(b.framebuffer,".next","null");b=b.context;d.set(b,".framebufferWidth",b+".drawingBufferWidth");d.set(b,".framebufferHeight",b+".drawingBufferHeight");return null})}if("framebuffer"in d){var r=d.framebuffer;return e(r,function(a,d){var b=a.invoke(d,r),k=a.shared,ba=k.framebuffer,b=d.def(ba,".getFramebuffer(",b,")");d.set(ba,".next",b);k=k.context;d.set(k,
".framebufferWidth",b+"?"+b+".width:"+k+".drawingBufferWidth");d.set(k,".framebufferHeight",b+"?"+b+".height:"+k+".drawingBufferHeight");return b})}return null}function ja(a,d){function b(k){if(k in r){var a=r[k];k=!0;var y=a.x|0,ya=a.y|0,C,h;"w"in a?C=a.w|0:k=!1;"h"in a?h=a.h|0:k=!1;return new c(k&&d&&d.thisDep,k&&d&&d.contextDep,k&&d&&d.propDep,function(k,d){var b=k.shared.context,c=C;"w"in a||(c=d.def(b,".","framebufferWidth","-",y));var e=h;"h"in a||(e=d.def(b,".","framebufferHeight","-",ya));
return[y,ya,c,e]})}if(k in l){var g=l[k];k=e(g,function(k,a){var d=k.invoke(a,g),b=k.shared.context,ba=a.def(d,".x|0"),c=a.def(d,".y|0"),e=a.def('"w" in ',d,"?",d,".w|0:","(",b,".","framebufferWidth","-",ba,")"),d=a.def('"h" in ',d,"?",d,".h|0:","(",b,".","framebufferHeight","-",c,")");return[ba,c,e,d]});d&&(k.thisDep=k.thisDep||d.thisDep,k.contextDep=k.contextDep||d.contextDep,k.propDep=k.propDep||d.prpoDep);return k}return d?new c(d.thisDep,d.contextDep,d.propDep,function(k,a){var d=k.shared.context;
return[0,0,a.def(d,".","framebufferWidth"),a.def(d,".","framebufferHeight")]}):null}var r=a["static"],l=a.dynamic,C=b("viewport");if(C)var h=C,C=new c(C.thisDep,C.contextDep,C.propDep,function(k,a){var d=h.append(k,a),b=k.shared.context;a.set(b,".viewportWidth",d[2]);a.set(b,".viewportHeight",d[3]);return d});return{viewport:C,scissor_box:b("scissor.box")}}function L(d){function r(k){if(k in l){var d=n.id(l[k]);k=a(function(){return d});k.id=d;return k}if(k in h){var b=h[k];return e(b,function(k,
a){var d=k.invoke(a,b);return a.def(k.shared.strings,".id(",d,")")})}return null}var l=d["static"],h=d.dynamic,g=r("frag"),C=r("vert"),m=null;b(g)&&b(C)?(m=G.program(C.id,g.id),d=a(function(k,a){return k.link(m)})):d=new c(g&&g.thisDep||C&&C.thisDep,g&&g.contextDep||C&&C.contextDep,g&&g.propDep||C&&C.propDep,function(k,a){var d=k.shared.shader,b;b=g?g.append(k,a):a.def(d,".","frag");var c;c=C?C.append(k,a):a.def(d,".","vert");return a.def(d+".program("+c+","+b+")")});return{frag:g,vert:C,progVar:d,
program:m}}function E(d){function r(d,k){if(d in g){var b=g[d]|0;return a(function(d,a){k&&(d.OFFSET=b);return b})}if(d in l){var c=l[d];return e(c,function(d,a){var b=d.invoke(a,c);k&&(d.OFFSET=b);return b})}return k&&m?a(function(k,d){k.OFFSET="0";return 0}):null}var g=d["static"],l=d.dynamic,m=function(){if("elements"in g){var d=g.elements;h(d)?d=t.getElements(t.create(d)):d&&(d=t.getElements(d));var k=a(function(k,a){if(d){var b=k.link(d);return k.ELEMENTS=b}return k.ELEMENTS=null});k.value=d;
return k}if("elements"in l){var b=l.elements;return e(b,function(k,d){var a=k.shared,c=a.isBufferArgs,a=a.elements,e=k.invoke(d,b),y=d.def("null"),c=d.def(c,"(",e,")"),e=k.cond(c).then(y,"=",a,".createStream(",e,");")["else"](y,"=",a,".getElements(",e,");");d.entry(e);d.exit(k.cond(c).then(a,".destroyStream(",y,");"));return k.ELEMENTS=y})}return null}(),C=r("offset",!0);return{elements:m,primitive:function(){if("primitive"in g){var d=g.primitive;return a(function(k,a){return A[d]})}if("primitive"in
l){var k=l.primitive;return e(k,function(d,a){var b=d.constants.primTypes,c=d.invoke(a,k);return a.def(b,"[",c,"]")})}return m?b(m)?m.value?a(function(k,d){return d.def(k.ELEMENTS,".primType")}):a(function(){return 4}):new c(m.thisDep,m.contextDep,m.propDep,function(k,d){var a=k.ELEMENTS;return d.def(a,"?",a,".primType:",4)}):null}(),count:function(){if("count"in g){var d=g.count|0;return a(function(){return d})}if("count"in l){var k=l.count;return e(k,function(d,a){return d.invoke(a,k)})}return m?
b(m)?m?C?new c(C.thisDep,C.contextDep,C.propDep,function(k,d){return d.def(k.ELEMENTS,".vertCount-",k.OFFSET)}):a(function(k,d){return d.def(k.ELEMENTS,".vertCount")}):a(function(){return-1}):new c(m.thisDep||C.thisDep,m.contextDep||C.contextDep,m.propDep||C.propDep,function(k,d){var a=k.ELEMENTS;return k.OFFSET?d.def(a,"?",a,".vertCount-",k.OFFSET,":-1"):d.def(a,"?",a,".vertCount:-1")}):null}(),instances:r("instances",!1),offset:C}}function S(d){var b=d["static"],c=d.dynamic,r={};pa.forEach(function(d){function y(k,
l){if(d in b){var h=k(b[d]);r[g]=a(function(){return h})}else if(d in c){var m=c[d];r[g]=e(m,function(k,d){return l(k,d,k.invoke(d,m))})}}var g=Q(d);switch(d){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return y(function(k){return k},function(k,d,a){return a});case "depth.func":return y(function(k){return w[k]},function(k,d,a){return d.def(k.constants.compareFuncs,
"[",a,"]")});case "depth.range":return y(function(d){return d},function(d,a,b){d=a.def("+",b,"[0]");a=a.def("+",b,"[1]");return[d,a]});case "blend.func":return y(function(d){return[l["srcRGB"in d?d.srcRGB:d.src],l["dstRGB"in d?d.dstRGB:d.dst],l["srcAlpha"in d?d.srcAlpha:d.src],l["dstAlpha"in d?d.dstAlpha:d.dst]]},function(d,a,b){function c(d,k){var y=a.def('"',d,k,'" in ',b,"?",b,".",d,k,":",b,".",d);return a.def(e,"[",y,"]")}var e=d.constants.blendFuncs;d=c("src","RGB");var y=c("src","Alpha"),r=
c("dst","RGB"),g=c("dst","Alpha");return[d,r,y,g]});case "blend.equation":return y(function(d){if("string"===typeof d)return[ka[d],ka[d]];if("object"===typeof d)return[ka[d.rgb],ka[d.alpha]]},function(d,a,b){var c=d.constants.blendEquations,e=a.def(),y=a.def();d=d.cond("typeof ",b,'==="string"');d.then(e,"=",y,"=",c,"[",b,"];");d["else"](e,"=",c,"[",b,".rgb];",y,"=",c,"[",b,".alpha];");a(d);return[e,y]});case "blend.color":return y(function(d){return H(4,function(a){return+d[a]})},function(d,a,b){return H(4,
function(d){return a.def("+",b,"[",d,"]")})});case "stencil.mask":return y(function(d){return d|0},function(d,a,b){return a.def(b,"|0")});case "stencil.func":return y(function(d){return[w[d.cmp||"keep"],d.ref||0,"mask"in d?d.mask:-1]},function(d,a,b){d=a.def('"cmp" in ',b,"?",d.constants.compareFuncs,"[",b,".cmp]",":",7680);var c=a.def(b,".ref|0");a=a.def('"mask" in ',b,"?",b,".mask|0:-1");return[d,c,a]});case "stencil.opFront":case "stencil.opBack":return y(function(a){return["stencil.opBack"===
d?1029:1028,m[a.fail||"keep"],m[a.zfail||"keep"],m[a.pass||"keep"]]},function(a,b,c){function e(d){return b.def('"',d,'" in ',c,"?",y,"[",c,".",d,"]:",7680)}var y=a.constants.stencilOps;return["stencil.opBack"===d?1029:1028,e("fail"),e("zfail"),e("pass")]});case "polygonOffset.offset":return y(function(d){return[d.factor|0,d.units|0]},function(d,a,b){d=a.def(b,".factor|0");a=a.def(b,".units|0");return[d,a]});case "cull.face":return y(function(d){var a=0;"front"===d?a=1028:"back"===d&&(a=1029);return a},
function(d,a,b){return a.def(b,'==="front"?',1028,":",1029)});case "lineWidth":return y(function(d){return d},function(d,a,b){return b});case "frontFace":return y(function(d){return x[d]},function(d,a,b){return a.def(b+'==="cw"?2304:2305')});case "colorMask":return y(function(d){return d.map(function(d){return!!d})},function(d,a,b){return H(4,function(d){return"!!"+b+"["+d+"]"})});case "sample.coverage":return y(function(d){return["value"in d?d.value:1,!!d.invert]},function(d,a,b){d=a.def('"value" in ',
b,"?+",b,".value:1");a=a.def("!!",b,".invert");return[d,a]})}});return r}function U(d){var b=d["static"],c=d.dynamic,r={};Object.keys(b).forEach(function(d){var c=b[d],e;if("number"===typeof c||"boolean"===typeof c)e=a(function(){return c});else if("function"===typeof c&&"texture"===c._reglType)e=a(function(d){return d.link(c)});else if(Array.isArray(c)||V(c))e=a(function(d){return d.global.def("[",H(c.length,function(d){return c[d]}),"]")});e.value=c;r[d]=e});Object.keys(c).forEach(function(d){var a=
c[d];r[d]=e(a,function(d,b){return d.invoke(b,a)})});return r}function P(d){var b=d["static"],c=d.dynamic,r={};Object.keys(b).forEach(function(d){var c=b[d],e=n.id(d),k=new na;if(h(c))k.state=1,k.buffer=R.getBuffer(R.create(c,34962,!1)),k.type=k.buffer.dtype;else{var y=R.getBuffer(c);if(y)k.state=1,k.buffer=y,k.type=y.dtype;else if(c.constant){var g=c.constant;k.state=2;"number"===typeof g?k.x=g:v.forEach(function(d,a){a<g.length&&(k[d]=g[a])})}else{var y=R.getBuffer(c.buffer),l=c.offset|0,m=c.stride|
0,f=c.size|0,Aa=!!c.normalized,T=0;"type"in c&&(T=p[c.type]);c=c.divisor|0;k.buffer=y;k.state=1;k.size=f;k.normalized=Aa;k.type=T||y.dtype;k.offset=l;k.stride=m;k.divisor=c}}r[d]=a(function(d,a){var b=d.attribCache;if(e in b)return b[e];var c={isStream:!1};Object.keys(k).forEach(function(d){c[d]=k[d]});k.buffer&&(c.buffer=d.link(k.buffer));return b[e]=c})});Object.keys(c).forEach(function(d){var a=c[d];r[d]=e(a,function(d,b){function c(d){b(l[d],"=",e,".",d,"|0;")}var e=d.invoke(b,a),y=d.shared,r=
y.isBufferArgs,g=y.buffer,l={isStream:b.def(!1)},m=new na;m.state=1;Object.keys(m).forEach(function(d){l[d]=b.def(""+m[d])});var h=l.buffer,aa=l.type;b("if(",r,"(",e,")){",l.isStream,"=true;",h,"=",g,".createStream(",34962,",",e,");",aa,"=",h,".dtype;","}else{",h,"=",g,".getBuffer(",e,");","if(",h,"){",aa,"=",h,".dtype;","}else if(",e,".constant){",l.state,"=",2,";",v.map(function(d,a){return l[d]+"="+e+".length>="+a+"?"+e+"["+a+"]:0;"}).join(""),"}else{",h,"=",g,".getBuffer(",e,".buffer);",aa,'="type" in ',
e,"?",y.glTypes,"[",e,".type]:",h,".dtype;",l.normalized,"=!!",e,".normalized;");c("size");c("offset");c("stride");c("divisor");b("}}");return l})});return r}function M(d){var b=d["static"],c=d.dynamic,r={};Object.keys(b).forEach(function(d){var c=b[d];r[d]=a(function(d,a){return"number"===typeof c||"boolean"===typeof c?""+c:d.link(c)})});Object.keys(c).forEach(function(d){var a=c[d];r[d]=e(a,function(d,b){return d.invoke(b,a)})});return r}function X(d,a,b){var c=d.shared.context,e=d.scope();Object.keys(b).forEach(function(r){a.save(c,
"."+r);e(c,".",r,"=",b[r].append(d,a),";")});a(e)}function d(d,a,b){var c=d.shared,e=c.gl,r=c.framebuffer,g;ra&&(g=a.def(c.extensions,".webgl_draw_buffers"));var k=d.constants,c=k.drawBuffers,k=k.backBuffer;d=b?b.append(d,a):a.def(r,".next");a("if(",r,".dirty||",d,"!==",r,".cur){","if(",d,"){",e,".bindFramebuffer(",36160,",",d,".framebuffer);");ra&&a(g,".drawBuffersWEBGL(",c,"[",d,".colorAttachments.length]);");a("}else{",e,".bindFramebuffer(",36160,",null);");ra&&a(g,".drawBuffersWEBGL(",k,");");
a("}",r,".cur=",d,";",r,".dirty=false;","}")}function da(d,a,b){var c=d.shared,e=c.gl,r=d.current,g=d.next,k=c.current,l=c.next,h=d.cond(k,".dirty");pa.forEach(function(a){a=Q(a);if(!(a in b.state)){var c,m;if(a in g){c=g[a];m=r[a];var aa=H(ga[a].length,function(d){return h.def(c,"[",d,"]")});h(d.cond(aa.map(function(d,a){return d+"==="+m+"["+a+"]"}).join("&&")).then(e,".",ia[a],"(",aa,");",aa.map(function(d,a){return m+"["+a+"]="+d}).join(";"),";"))}else c=h.def(l,".",a),aa=d.cond(c,"!==",k,".",
a),h(aa),a in ha?aa(d.cond(c).then(e,".enable(",ha[a],");")["else"](e,".disable(",ha[a],");"),k,".",a,"=",c,";"):aa(e,".",ia[a],"(",c,");",k,".",a,"=",c,";")}});0===Object.keys(b.state).length&&h(k,".dirty=false;");a(h)}function r(d,a,c,e){var r=d.shared,l=d.current,h=r.current,k=r.gl;g(Object.keys(c)).forEach(function(r){var g=c[r];if(!e||e(g)){var m=g.append(d,a);if(ha[r]){var f=ha[r];b(g)?m?a(k,".enable(",f,");"):a(k,".disable(",f,");"):a(d.cond(m).then(k,".enable(",f,");")["else"](k,".disable(",
f,");"));a(h,".",r,"=",m,";")}else if(Array.isArray(m)){var p=l[r];a(k,".",ia[r],"(",m,");",m.map(function(d,a){return p+"["+a+"]="+d}).join(";"),";")}else a(k,".",ia[r],"(",m,");",h,".",r,"=",m,";")}})}function T(d,a){oa&&!d.instancing&&(d.instancing=a.def(d.shared.extensions,".angle_instanced_arrays"))}function sa(d,a,b,c,e){function r(d){switch(d){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function g(b,
c,e){function r(){a("if(!",f,".pointer){",m,".enableVertexAttribArray(",h,");",f,".pointer=true;}");var b=e.type,k;k=e.size?a.def(e.size,"||",c):c;a("if(",f,".type!==",b,"||",f,".size!==",k,"||",n.map(function(d){return f+"."+d+"!=="+e[d]}).join("||"),"){",m,".bindBuffer(",34962,",",p,".buffer);",m,".vertexAttribPointer(",[h,k,b,e.normalized,e.stride,e.offset],");",f,".type=",b,";",f,".size=",k,";",n.map(function(d){return f+"."+d+"="+e[d]+";"}).join(""),"}");oa&&(b=e.divisor,a("if(",f,".divisor!==",
b,"){",d.instancing,".vertexAttribDivisorANGLE(",[h,b],");",f,".divisor=",b,";}"))}function l(){a("if(",f,".pointer){",m,".disableVertexAttribArray(",h,");",f,".pointer=false;","}if(",v.map(function(d,a){return f+"."+d+"!=="+T[a]}).join("||"),"){",m,".vertexAttrib4f(",h,",",T,");",v.map(function(d,a){return f+"."+d+"="+T[a]+";"}).join(""),"}")}var m=k.gl,h=a.def(b,".location"),f=a.def(k.attributes,"[",h,"]");b=e.state;var p=e.buffer,T=[e.x,e.y,e.z,e.w],n=["buffer","normalized","offset","stride"];
1===b?r():2===b?l():(a("if(",b,"===",1,"){"),r(),a("}else{"),l(),a("}"))}var k=d.shared;c.forEach(function(c){var k=c.name,l=b.attributes[k],m;if(l){if(!e(l))return;m=l.append(d,a)}else{if(!e(O))return;var h=d.scopeAttrib(k);m={};Object.keys(new na).forEach(function(d){m[d]=a.def(h,".",d)})}g(d.link(c),r(c.info.type),m)})}function ta(d,a,b,c,e){for(var r=d.shared,g=r.gl,k,l=0;l<c.length;++l){var m=c[l],h=m.name,f=m.info.type,p=b.uniforms[h],m=d.link(m)+".location";if(p){if(!e(p))continue;if(p["static"]){h=
p.value;if(35678===f||35680===f)f=d.link(h._texture),a(g,".uniform1i(",m,f+".bind());"),a.exit(f,".unbind()");else if(35674===f||35675===f||35676===f)h=d.global.def("["+h+"]"),p=2,35675===f?p=3:35676===f&&(p=4),a(g,".uniformMatrix",p,"fv(",m,",false,",h,");");else{switch(f){case 5126:k="1f";break;case 35664:k="2f";break;case 35665:k="3f";break;case 35666:k="4f";break;case 35670:k="1i";break;case 5124:k="1i";break;case 35671:k="2i";break;case 35667:k="2i";break;case 35672:k="3i";break;case 35668:k=
"3i";break;case 35673:k="4i";break;case 35669:k="4i"}a(g,".uniform",k,"(",m,",",h,");")}continue}else h=p.append(d,a)}else{if(!e(O))continue;h=a.def(r.uniforms,"[",n.id(h),"]")}p=",";switch(f){case 35678:case 35680:f=a.def(h,"._texture");a(g,".uniform1i(",m,",",f,".bind());");a.exit(f,".unbind();");continue;case 5124:case 35670:k="1i";break;case 35667:case 35671:k="2iv";break;case 35668:case 35672:k="3iv";break;case 35669:case 35673:k="4iv";break;case 5126:k="1f";break;case 35664:k="2fv";break;case 35665:k=
"3fv";break;case 35666:k="4fv";break;case 35674:k="Matrix2fv";p=",false,";break;case 35675:k="Matrix3fv";p=",false,";break;case 35676:k="Matrix4fv",p=",false,"}a(g,".uniform",k,"(",m,p,h,");")}}function ua(d,a,c,e){function r(b){var e=f[b];return e?e.batchStatic?e.append(d,a):e.append(d,c):a.def(h,".",b)}function g(){function d(){c(v,".drawElementsInstancedANGLE(",[T,w,u,n+"<<(("+u+"-5121)>>1)",da],");")}function a(){c(v,".drawArraysInstancedANGLE(",[T,n,w,da],");")}p?I?d():(c("if(",p,"){"),d(),c("}else{"),
a(),c("}")):a()}function l(){function d(){c(m+".drawElements("+[T,w,u,n+"<<(("+u+"-5121)>>1)"]+");")}function a(){c(m+".drawArrays("+[T,n,w]+");")}p?I?d():(c("if(",p,"){"),d(),c("}else{"),a(),c("}")):a()}var k=d.shared,m=k.gl,h=k.draw,f=e.draw,p=function(){var b=f.elements,e=a;b?(b.batchStatic||(e=c),b=b.append(d,e)):b=e.def(h,".","elements");b&&e("if("+b+")"+m+".bindBuffer(34963,"+b+".buffer.buffer);");return b}(),T=r("primitive"),n=r("offset"),w=function(){var b=f.count,e=a;b?(b.batchStatic||(e=
c),b=b.append(d,e)):b=e.def(h,".","count");return b}();if("number"===typeof w){if(0===w)return}else c("if(",w,"){"),c.exit("}");var da,v;oa&&(da=r("instances"),v=d.instancing);var u=p+".type",I=f.elements&&b(f.elements);oa&&("number"!==typeof da||0<=da)?"string"===typeof da?(c("if(",da,">0){"),g(),c("}else if(",da,"<0){"),l(),c("}")):g():l()}function va(d,a,b,c,e){a=B();e=a.proc("body",e);oa&&(a.instancing=e.def(a.shared.extensions,".angle_instanced_arrays"));d(a,e,b,c);return a.compile().body}function za(d,
a,b,c){T(d,a);sa(d,a,b,c.attributes,function(){return!0});ta(d,a,b,c.uniforms,function(){return!0});ua(d,a,a,b)}function Ca(a,b){var c=a.proc("draw",1);T(a,c);X(a,c,b.context);d(a,c,b.framebuffer);da(a,c,b);r(a,c,b.state);var e=b.shader.progVar.append(a,c);c(a.shared.gl,".useProgram(",e,".program);");if(b.shader.program)za(a,c,b,b.shader.program);else{var g=a.global.def("{}"),m=c.def(e,".id"),l=c.def(g,"[",m,"]");c(a.cond(l).then(l,".call(this,a0);")["else"](l,"=",g,"[",m,"]=",a.link(function(d){return va(za,
a,b,d,1)}),"(",e,");",l,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Da(d,a,b,c){function e(){return!0}d.batchId="a1";T(d,a);sa(d,a,b,c.attributes,e);ta(d,a,b,c.uniforms,e);ua(d,a,a,b)}function wa(a,b,c,e){function g(d){return d.contextDep&&m||d.propDep}function l(d){return!g(d)}T(a,b);var m=c.contextDynamic,k=b.def(),h=b.def();a.shared.props=h;a.batchId=k;var f=a.scope(),p=a.scope();b(f.entry,"for(",k,"=0;",k,"<","a1",";++",k,"){",h,"=","a0","[",
k,"];",p,"}",f.exit);c.needsContext&&X(a,p,c.context);c.needsFramebuffer&&d(a,p,c.framebuffer);r(a,p,c.state,g);e?(sa(a,f,c,e.attributes,l),sa(a,p,c,e.attributes,g),ta(a,f,c,e.uniforms,l),ta(a,p,c,e.uniforms,g),ua(a,f,p,c)):(b=a.global.def("{}"),e=c.shader.progVar.append(a,p),h=p.def(e,".id"),f=p.def(b,"[",h,"]"),p(a.shared.gl,".useProgram(",e,".program);","if(!",f,"){",f,"=",b,"[",h,"]=",a.link(function(d){return va(Da,a,c,d,2)}),"(",e,");}",f,".call(this,a0[",k,"],",k,");"))}function Ea(a,b){var c=
a.proc("batch",2);a.batchId="0";T(a,c);var e=!1,g=!0;Object.keys(b.context).forEach(function(d){e=e||b.context[d].propDep});e||(X(a,c,b.context),g=!1);var l=b.framebuffer,h=!1;l&&(l.propDep?e=h=!0:l.contextDep&&e&&(h=!0),h||d(a,c,l));b.state.viewport&&b.state.viewport.propDynamic&&(e=!0);da(a,c,b);r(a,c,b.state,function(d){return!(d.contextDep&&e||d.propDep)});b.contextDep=e;b.needsContext=g;b.needsFramebuffer=h;g=b.shader.progVar;if(g.contextDep&&e||g.propDep)wa(a,c,b,null);else if(g=g.append(a,
c),c(a.shared.gl,".useProgram(",g,".program);"),b.shader.program)wa(a,c,b,b.shader.program);else{var l=a.global.def("{}"),h=c.def(g,".id"),k=c.def(l,"[",h,"]");c(a.cond(k).then(k,".call(this,a0,a1);")["else"](k,"=",l,"[",h,"]=",a.link(function(d){return va(wa,a,b,d,2)}),"(",g,");",k,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Fa(d,a){function b(r){var k=a.shader[r];k&&c.set(e.shader,"."+r,k.append(d,c))}var c=d.proc("scope",3);d.batchId="a2";var e=
d.shared,r=e.current;X(d,c,a.context);a.framebuffer&&a.framebuffer.append(d,c);g(Object.keys(a.state)).forEach(function(b){var k=a.state[b].append(d,c);Array.isArray(k)?k.forEach(function(a,e){c.set(d.next[b],"["+e+"]",a)}):c.set(e.next,"."+b,k)});["elements","offset","count","instances","primitive"].forEach(function(b){var k=a.draw[b];k&&c.set(e.draw,"."+b,""+k.append(d,c))});Object.keys(a.uniforms).forEach(function(b){c.set(e.uniforms,"["+n.id(b)+"]",a.uniforms[b].append(d,c))});Object.keys(a.attributes).forEach(function(b){var e=
a.attributes[b].append(d,c),r=d.scopeAttrib(b);Object.keys(new na).forEach(function(d){c.set(r,"."+d,e[d])})});b("vert");b("frag");0<Object.keys(a.state).length&&(c(r,".dirty=true;"),c.exit(r,".dirty=true;"));c("a1(",d.shared.context,",a0,0);")}var na=Y.Record,ka={add:32774,subtract:32778,"reverse subtract":32779};q.ext_blend_minmax&&(ka.min=32775,ka.max=32776);var oa=q.angle_instanced_arrays,ra=q.webgl_draw_buffers,ga={dirty:!0},ma={},pa=[],ha={},ia={};K("dither",3024);K("blend.enable",3042);D("blend.color",
"blendColor",[0,0,0,0]);D("blend.equation","blendEquationSeparate",[32774,32774]);D("blend.func","blendFuncSeparate",[1,0,1,0]);K("depth.enable",2929,!0);D("depth.func","depthFunc",513);D("depth.range","depthRange",[0,1]);D("depth.mask","depthMask",!0);D("colorMask","colorMask",[!0,!0,!0,!0]);K("cull.enable",2884);D("cull.face","cullFace",1029);D("frontFace","frontFace",2305);D("lineWidth","lineWidth",1);K("polygonOffset.enable",32823);D("polygonOffset.offset","polygonOffset",[0,0]);K("sample.alpha",
32926);K("sample.enable",32928);D("sample.coverage","sampleCoverage",[1,!1]);K("stencil.enable",2960);D("stencil.mask","stencilMask",-1);D("stencil.func","stencilFunc",[519,0,-1]);D("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);D("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);K("scissor.enable",3089);D("scissor.box","scissor",[0,0,f.drawingBufferWidth,f.drawingBufferHeight]);D("viewport","viewport",[0,0,f.drawingBufferWidth,f.drawingBufferHeight]);var xa={gl:f,context:J,
strings:n,next:ma,current:ga,draw:Z,elements:t,buffer:R,shader:G,attributes:Y.state,uniforms:W,framebuffer:I,extensions:q,isBufferArgs:h},qa={primTypes:A,compareFuncs:w,blendFuncs:l,blendEquations:ka,stencilOps:m,glTypes:p,orientationType:x};ra&&(qa.backBuffer=[1029],qa.drawBuffer=H(z.maxDrawbuffers,function(d){return H(d,function(d){return 36064+d})}));var Ba=0;return{next:ma,current:ga,procs:function(){var a=B(),b=a.proc("poll"),c=a.proc("refresh"),e=a.block();b(e);c(e);var r=a.shared,g=r.gl,l=
r.next,k=r.current;e(k,".dirty=false;");d(a,b);c(r.framebuffer,".dirty=true;");d(a,c);Object.keys(ha).forEach(function(d){var r=ha[d],h=e.def(l,".",d),m=a.block();m("if(",h,"){",g,".enable(",r,")}else{",g,".disable(",r,")}",k,".",d,"=",h,";");c(m);b("if(",h,"!==",k,".",d,"){",m,"}")});Object.keys(ia).forEach(function(d){var r=ia[d],h=ga[d],m,f,p=a.block();p(g,".",r,"(");Array.isArray(h)?(r=h.length,m=a.global.def(l,".",d),f=a.global.def(k,".",d),p(H(r,function(d){return m+"["+d+"]"}),");",H(r,function(d){return f+
"["+d+"]="+m+"["+d+"];"}).join("")),b("if(",H(r,function(d){return m+"["+d+"]!=="+f+"["+d+"]"}).join("||"),"){",p,"}")):(m=e.def(l,".",d),f=e.def(k,".",d),p(m,");",k,".",d,"=",m,";"),b("if(",m,"!==",f,"){",p,"}"));c(p)});return a.compile()}(),compile:function(d,a,b,c){var e=B(),r;r=ca(d);var g=ja(d,r),k=E(d),h=S(d);d=L(d);var l=g.viewport;l&&(h.viewport=l);l=Q("scissor.box");(g=g[l])&&(h[l]=g);g=0<Object.keys(h).length;r={framebuffer:r,draw:k,shader:d,state:h,dirty:g};r.uniforms=U(b);r.attributes=
P(a);r.context=M(c);Ca(e,r);Fa(e,r);Ea(e,r);return e.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":20,"./util/is-ndarray":23,"./util/is-typed-array":24,"./util/loop":26}],9:[function(f,n,q){function h(a,c){this.id=b++;this.type=a;this.data=c}function g(a){if(0===a.length)return[];var b=a.charAt(0),c=a.charAt(a.length-1);if(1<a.length&&b===c&&('"'===b||"'"===b))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return g(a.substr(0,
b.index)).concat(g(b[1])).concat(g(a.substr(b.index+b[0].length)));b=a.split(".");if(1===b.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(c=0;c<b.length;++c)a=a.concat(g(b[c]));return a}function c(a){return"["+g(a).join("][")+"]"}var b=0;n.exports={define:function(a,b){switch(typeof b){case "boolean":case "number":case "string":return new h(a,c(b+""));case "undefined":return new h(a|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof
h},unbox:function(a,b){if(a instanceof h){if(a.type&128)return new h(a.type&-129,c(b))}else if("function"===typeof a)return new h(0,a);return a},accessor:c}},{}],10:[function(f,n,q){var h=f("./util/is-typed-array"),g=f("./util/is-ndarray"),c=f("./constants/primitives.json"),b=f("./constants/usage.json");n.exports=function(a,e,f){function n(a){this.buffer=a;this.primType=4;this.type=this.vertCount=0}function q(a,b,c,n,m,x,A){(x=A)||h(b)&&(!g(b)||h(b.data))||(x=e.oes_element_index_uint?5125:5123);a.buffer.bind();
f._initBuffer(a.buffer,b,c,x,3);b=A;if(!A){switch(a.buffer.dtype){case 5121:case 5120:b=5121;break;case 5123:case 5122:b=5123;break;case 5125:case 5124:b=5125}a.buffer.dtype=b}a.type=b;0>m&&(m=a.buffer.byteLength,5123===b?m>>=1:5125===b&&(m>>=2));a.vertCount=m;m=n;0>n&&(m=4,n=a.buffer.dimension,1===n&&(m=0),2===n&&(m=1),3===n&&(m=4));a.primType=m}var z={uint8:5121,uint16:5123};e.oes_element_index_uint&&(z.uint32=5125);n.prototype.bind=function(){this.buffer.bind()};var A=[];return{create:function(e){function v(e){if(e)if("number"===
typeof e)l(e),w.primType=4,w.vertCount=e|0,w.type=5121;else{var f=null,p=35044,n=-1,u=-1,A=0,H=0;Array.isArray(e)||h(e)||g(e)?f=e:("data"in e&&(f=e.data),"usage"in e&&(p=b[e.usage]),"primitive"in e&&(n=c[e.primitive]),"count"in e&&(u=e.count|0),"length"in e&&(A=e.length|0),"type"in e&&(H=z[e.type]));f?q(w,f,p,n,u,A,H):(e=w.buffer,e.bind(),a.bufferData(34963,A,p),e.dtype=H||5121,e.usage=p,e.dimension=3,e.byteLength=A,w.primType=0>n?4:n,w.vertCount=0>u?0:u,w.type=e.dtype)}else l(),w.primType=4,w.vertCount=
0,w.type=5121;return v}var l=f.create(null,34963,!0),w=new n(l._buffer);v(e);v._reglType="elements";v._elements=w;v.subdata=function(a,b){l.subdata(a,b);return v};v.destroy=function(){l.destroy();w.buffer=null};return v},createStream:function(a){var b=A.pop();b||(b=new n(f.create(null,34963,!0)._buffer));q(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){A.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof n?a._elements:null}}}},{"./constants/primitives.json":6,
"./constants/usage.json":7,"./util/is-ndarray":23,"./util/is-typed-array":24}],11:[function(f,n,q){n.exports=function(h){function g(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(b){try{c[b]=
h.getExtension(b)}catch(a){}})}var c={};g();return{extensions:c,refresh:g}}},{}],12:[function(f,n,q){var h=f("./util/values"),g=f("./util/extend");n.exports=function(c,b,a,e,f){function n(a,b,c,e){this.target=a;this.level=b;this.texture=c;this.renderbuffer=e}function q(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function z(a,b){var c=b.width,e=b.height;if(a.texture)var g=a.texture._texture,h=Math.max(1,g.params.width>>a.level),l=Math.max(1,
g.params.height>>a.level),c=c||h,e=e||l;else g=a.renderbuffer._renderbuffer,c=c||g.width,e=e||g.height;g.refCount+=1;b.width=c;b.height=e}function A(a,b){b?b.texture?c.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):c.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):c.framebufferTexture2D(36160,a,3553,null,0)}function p(a){var b=3553,c=0,e=null,g=null;"object"===typeof a&&("level"in a&&(c=a.level|0),"target"in a&&(b=a.target|0));var h=a._reglType;
"texture"===h?e=a:"renderbuffer"===h&&(g=a,b=36161,c=0);return new n(b,c,e,g)}function v(a){return a&&(a.texture||a.renderbuffer)}function l(){this.id=R++;t[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function w(e){c.isFramebuffer(e.framebuffer)||(e.framebuffer=c.createFramebuffer());x.dirty=!0;c.bindFramebuffer(36160,e.framebuffer);for(var g=
e.colorAttachments,h=0;h<g.length;++h)A(36064+h,g[h]);for(h=g.length;h<a.maxColorAttachments;++h)A(36064+h,null);A(36096,e.depthAttachment);A(36128,e.stencilAttachment);A(33306,e.depthStencilAttachment);b.webgl_draw_buffers&&b.webgl_draw_buffers.drawBuffersWEBGL(ea[g.length]);c.checkFramebufferStatus(36160)}function m(a){a=a.framebuffer;c.isFramebuffer(a)&&c.deleteFramebuffer(a)}var x={current:null,next:null,dirty:!1},O={rgba:6408},F={rgba4:32854,rgb565:36194,"rgb5 a1":32855};b.ext_srgb&&(F.srgba=
35907);b.ext_color_buffer_half_float&&(F.rgba16f=34842,F.rgb16f=34843);b.webgl_color_buffer_float&&(F.rgba32f=34836);var N=[],fa=[];b.webgl_depth_texture&&(N.push(6402),fa.push(34041));g(g({},O),F);h(O);h(F);F=5121;N={uint8:5121};b.oes_texture_half_float&&(F=N["half float"]=36193);b.oes_texture_float&&(F=N["float"]=5126);N.best=F;var ea=function(){for(var b=Array(a.maxDrawbuffers),c=0;c<=a.maxDrawbuffers;++c)for(var e=b[c]=Array(c),g=0;g<c;++g)e[g]=36064+g;return b}(),R=0,t={};return g(x,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof l)?a:null},create:function(a){function b(a){var h,l=a||{},m=a=0;if("shape"in l){var A=l.shape;a=A[0];m=A[1]}else"radius"in l&&(a=m=l.radius),"width"in l&&(a=l.width),"height"in l&&(m=l.height);var x=null,A=!1;if("colorBuffers"in l||"colorBuffer"in l){x=l.colorBuffers||l.colorBuffer;Array.isArray(x)||(x=[x]);g.width=a;g.height=m;x=x.map(p);for(h=0;h<x.length;++h)z(x[h],g);a=g.width;m=g.height}else{var t=!0,B="rgba",F="uint8",N=1,
A=!0;g.width=a=a||c.drawingBufferWidth;g.height=m=m||c.drawingBufferHeight;"format"in l&&(B=l.format,t=B in O);"type"in l&&(F=l.type);"colorCount"in l&&(N=l.colorCount|0);if(g.ownsColor)for(x=g.colorAttachments;x.length>N;)q(x.pop());else x=[];for(h=0;h<x.length;++h){var L;a:{L=x[h];var E=t,S=B,U=a,P=m;if(L.texture){var M=L.texture;if(E){M({format:S,type:F,width:U,height:P});M._texture.refCount+=1;L=!0;break a}}else if(M=L.renderbuffer,!E){M({format:S,width:U,height:P});M._renderbuffer.refCount+=
1;L=!0;break a}q(L);L=!1}L||(x[h--]=x[x.length-1],x.pop())}for(;x.length<N;)t?x.push(new n(3553,0,e.create({format:B,type:F,width:a,height:m},3553),null)):x.push(new n(36161,0,null,f.create({format:B,width:a,height:m})))}g.width=a;g.height=m;B=t=h=null;F=!1;"depthBuffer"in l&&(h=p(l.depthBuffer));"stencilBuffer"in l&&(t=p(l.stencilBuffer));"depthStencilBuffer"in l&&(B=p(l.depthStencilBuffer));if(h||t||B)z(h||t||B,g);else if(N=!0,E=L=!1,"depth"in l&&(N=!!l.depth),"stencil"in l&&(L=!!l.stencil),"depthTexture"in
l&&(E=!!l.depthTexture),l=g.depthAttachment||g.stencilAttachment||g.depthStencilAttachment,S=null,N||L)F=!0,E?(E=L?"depth stencil":"depth",g.ownsDepthStencil&&l.texture?(l.texture({format:E,width:a,height:m}),l.texture._texture.refCount+=1,S=l):S=new n(3553,0,e.create({format:E,width:a,height:m},3553),null)):(E=N?L?"depth stencil":"depth":"stencil",g.ownsDepthStencil&&l.renderbuffer?(l.renderbuffer({format:E,width:a,height:m}),l.renderbuffer._renderbuffer.refCount+=1,S=l):S=new n(36161,0,null,f.create({format:E,
width:a,height:m}))),N?L?B=S:h=S:t=S;a=g;a.colorAttachments.forEach(q);q(a.depthAttachment);q(a.stencilAttachment);q(a.depthStencilAttachment);g.colorAttachments=x;g.depthAttachment=h;g.stencilAttachment=t;g.depthStencilAttachment=B;g.ownsColor=A;g.ownsDepthStencil=F;b.color=x.map(v);b.depth=v(h);b.stencil=v(t);b.depthStencil=v(B);w(g);b.width=g.width;b.height=g.height;return b}var g=new l;b(a);b._reglType="framebuffer";b._framebuffer=g;b._destroy=function(){m(g)};return b},clear:function(){h(t).forEach(m)},
refresh:function(){h(t).forEach(w)}})}},{"./util/extend":21,"./util/values":32}],13:[function(f,n,q){n.exports=function(h,g){var c=1;g.ext_texture_filter_anisotropic&&(c=h.getParameter(34047));var b=1,a=1;g.webgl_draw_buffers&&(b=h.getParameter(34852),a=h.getParameter(36063));return{colorBits:[h.getParameter(3410),h.getParameter(3411),h.getParameter(3412),h.getParameter(3413)],depthBits:h.getParameter(3414),stencilBits:h.getParameter(3415),subpixelBits:h.getParameter(3408),extensions:Object.keys(g).filter(function(a){return!!g[a]}),
maxAnisotropic:c,maxDrawbuffers:b,maxColorAttachments:a,pointSizeDims:h.getParameter(33901),lineWidthDims:h.getParameter(33902),maxViewportDims:h.getParameter(3386),maxCombinedTextureUnits:h.getParameter(35661),maxCubeMapSize:h.getParameter(34076),maxRenderbufferSize:h.getParameter(34024),maxTextureUnits:h.getParameter(34930),maxTextureSize:h.getParameter(3379),maxAttributes:h.getParameter(34921),maxVertexUniforms:h.getParameter(36347),maxVertexTextureUnits:h.getParameter(35660),maxVaryingVectors:h.getParameter(36348),
maxFragmentUniforms:h.getParameter(36349),glsl:h.getParameter(35724),renderer:h.getParameter(7937),vendor:h.getParameter(7936),version:h.getParameter(7938)}}},{}],14:[function(f,n,q){var h=f("./util/is-typed-array");n.exports=function(g,c,b){return function(a){var e=a||{};h(a)?e={data:e}:2===arguments.length?e={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof a&&(e={});c();var f=e.x||0,n=e.y||0,q=e.width||b.viewportWidth,z=e.height||b.viewportHeight,e=e.data||new Uint8Array(q*z*4);g.pixelStorei(3333,
4);g.readPixels(f,n,q,z,6408,5121,e);return e}}},{"./util/is-typed-array":24}],15:[function(f,n,q){var h=f("./util/values");n.exports=function(g,c,b){function a(){this.id=q++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function e(a){g.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=g.createRenderbuffer());g.bindRenderbuffer(36161,a.renderbuffer);g.renderbufferStorage(36161,a.format,a.width,a.height)}function f(a){var b=a.renderbuffer;g.bindRenderbuffer(36161,
null);g.isRenderbuffer(b)&&g.deleteRenderbuffer(b);a.renderbuffer=null;a.refCount=0;delete z[a.id]}var n={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};c.ext_srgb&&(n.srgba=35907);c.ext_color_buffer_half_float&&(n.rgba16f=34842,n.rgb16f=34843);c.webgl_color_buffer_float&&(n.rgba32f=34836);var q=0,z={};a.prototype.decRef=function(){0===--this.refCount&&f(this)};return{create:function(b){function c(a){a=a||{};var b=0,h=0;"shape"in a?(h=a.shape,b=h[0]|0,h=
h[1]|0):("radius"in a&&(b=h=a.radius|0),"width"in a&&(b=a.width|0),"height"in a&&(h=a.height|0));c.width=g.width=Math.max(b,1);c.height=g.height=Math.max(h,1);g.format=32854;"format"in a&&(g.format=n[a.format]);e(g);return c}var g=new a;z[g.id]=g;c(b);c._reglType="renderbuffer";c._renderbuffer=g;c.destroy=function(){g.decRef()};return c},refresh:function(){h(z).forEach(e)},clear:function(){h(z).forEach(f)}}}},{"./util/values":32}],16:[function(f,n,q){var h=f("./util/values");n.exports=function(g,
c){function b(a,b,c,e){this.name=a;this.id=b;this.location=c;this.info=e}function a(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function e(a,b,e){e=35632===a?q:z;var h=e[b];if(!h){var f=c.str(b),h=g.createShader(a);g.shaderSource(h,f);g.compileShader(h);e[b]=h}return h}function f(a,b){this.id=v++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[]}function n(h,f){var m,p;m=e(35632,h.fragId);p=e(35633,h.vertId);var q=h.program=
g.createProgram();g.attachShader(q,m);g.attachShader(q,p);g.linkProgram(q);var u=g.getProgramParameter(q,35718),A=h.uniforms;for(m=0;m<u;++m)if(p=g.getActiveUniform(q,m))if(1<p.size)for(var v=0;v<p.size;++v){var z=p.name.replace("[0]","["+v+"]");a(A,new b(z,c.id(z),g.getUniformLocation(q,z),p))}else a(A,new b(p.name,c.id(p.name),g.getUniformLocation(q,p.name),p));u=g.getProgramParameter(q,35721);A=h.attributes;for(m=0;m<u;++m)(p=g.getActiveAttrib(q,m))&&a(A,new b(p.name,c.id(p.name),g.getAttribLocation(q,
p.name),p))}var q={},z={},A={},p=[],v=0;return{clear:function(){var a=g.deleteShader.bind(g);h(q).forEach(a);q={};h(z).forEach(a);z={};p.forEach(function(a){g.deleteProgram(a.program)});p.length=0;A={}},refresh:function(){q={};z={};p.forEach(n)},program:function(a,b,c){var e=A[b];e||(e=A[b]={});var g=e[a];g||(g=new f(b,a),n(g,c),e[a]=g,p.push(g));return g},shader:e,frag:null,vert:null}}},{"./util/values":32}],17:[function(f,n,q){n.exports=function(){var h={"":0},g=[""];return{id:function(c){var b=
h[c];if(b)return b;b=h[c]=g.length;g.push(c);return b},str:function(c){return g[c]}}}},{}],18:[function(f,n,q){function h(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function g(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,e=1;e<b;++e)if(!Array.isArray(a[e])||a[e].length!==c)return!1;return!0}function c(a){return Object.prototype.toString.call(a)}function b(a){return"[object HTMLCanvasElement]"===c(a)}function a(a){return"[object CanvasRenderingContext2D]"===
c(a)}var e=f("./util/extend"),u=f("./util/values"),H=f("./util/is-typed-array"),V=f("./util/is-ndarray"),z=f("./util/load-texture"),A=f("./util/to-half-float"),p=f("./util/parse-dds"),v=[9984,9986,9985,9987];n.exports=function(l,f,m,n,q){function F(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=
this.miplevel=0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function N(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function fa(a,b){var c,e,g=0,h=0,f=0,l=0,m=0,p=0,n=!1,q=!1,u=!1;for(c=0;c<b.length;++c)e=b[c],l=l||e.width<<e.miplevel,m=m||e.height<<e.miplevel,
g=g||e.type,h=h||e.format,f=f||e.internalformat,p=p||e.channels,n=n||e.needsPoll,q=q||e.needsListeners,e=e.miplevel,u=u||0<e;a.needsPoll=n;a.needsListeners=q;a.width=l;a.height=m;a.format=h;a.internalformat=f;a.type=g;if(3553!==a.target)for(c=0;6>c;++c);c=0<=v.indexOf(a.minFilter);a.genMipmaps=!u&&(a.genMipmaps||c);u=u||a.genMipmaps;a.minFilter||(a.minFilter=u?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(c=0;c<b.length;++c)e=b[c],e.channels||(e.channels=p),e.format||(e.format=h),e.internalformat||
(e.internalformat=f),e.type||(e.type=g)}function ea(a){this.id=S++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new N(a);this.pixels=[]}function R(a,b){function c(a,d){var e=d.mipmap,g;if(Array.isArray(e))for(var r=0;r<e.length;++r)g=new F(a),g.parseFlags(b),g.parseFlags(d),g.parse(e[r],r),h.push(g);else g=new F(a),g.parseFlags(b),g.parse(d,0),h.push(g)}var e;I(a);var g=a.params;N.call(g,a.target);var h=a.pixels;h.length=
0;g.parse(b);if(3553===a.target)c(3553,b);else{var f=b.faces||b;if(Array.isArray(f))for(e=0;6>e;++e)c(34069+e,f[e]);else if("string"!==typeof f)for(e=0;6>e;++e)c(34069+e,{})}fa(g,h);g.needsListeners&&la(a);g.needsPoll&&(a.pollId=P.length,P.push(a));t(a)}function t(a){l.isTexture(a.texture)||(a.texture=l.createTexture());var b=a.target,c=a.unit;0<=c?(l.activeTexture(33984+c),E=c):l.bindTexture(b,a.texture);for(var b=a.pixels,e=a.params,g=0;g<b.length;++g)b[g].upload(e);e.upload();0>c&&((c=X[E])?l.bindTexture(c.target,
c.texture):(a.unit=E,X[E]=a))}function la(a){function b(a,d,c){var e=p(c);e.pixels.forEach(function(b){var c=new F(e.cube?b.target:a);c.channels=e.channels;c.compressed=e.compressed;c.type=e.type;c.internalformat=e.format;c.format=L[e.format];c.width=b.width;c.height=b.height;c.miplevel=b.miplevel||d;c.data=b.data;g.push(c)})}function c(){for(var h=0;h<g.length;++h){var r=g[h],f=r.image,l=r.video,m=r.xhr;f&&f.complete?(r.width=f.naturalWidth,r.height=f.naturalHeight):l&&2<l.readyState?(r.width=l.width,
r.height=l.height):m&&4===m.readyState&&(g[h]=g[g.length-1],g.pop(),m.removeEventListener("readystatechange",t),b(r.target,r.miplevel,m.response))}fa(e,g);t(a)}var e=a.params,g=a.pixels;g.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){g.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",
c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function I(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((P[b]=P[P.length-1]).id=b,P.pop(),a.pollId=-1)}function W(a){var b=a.texture,c=a.unit,e=a.target;0<=c&&(l.activeTexture(33984+c),E=c,l.bindTexture(e,null),X[c]=null);I(a);l.isTexture(b)&&l.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete U[a.id]}var Y={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
G={repeat:10497,clamp:33071,mirror:33648},Z={nearest:9728,linear:9729},J=e({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},Z),Q={none:0,browser:37444},K={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},D={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},B={};f.ext_srgb&&(D.srgb=35904,D.srgba=35906);f.oes_texture_float&&(K["float"]=5126);f.oes_texture_half_float&&
(K["half float"]=36193);f.webgl_depth_texture&&(e(D,{depth:6402,"depth stencil":34041}),e(K,{uint16:5123,uint32:5125,"depth stencil":34042}));f.webgl_compressed_texture_s3tc&&e(B,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});f.webgl_compressed_texture_atc&&e(B,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});f.webgl_compressed_texture_pvrtc&&e(B,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});f.webgl_compressed_texture_etc1&&(B["rgb etc1"]=36196);var ca=Array.prototype.slice.call(l.getParameter(34467));Object.keys(B).forEach(function(a){var b=B[a];0<=ca.indexOf(b)&&(D[a]=b)});var ja=Object.keys(D);m.textureFormats=ja;var L=ja.reduce(function(a,b){var c=D[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});e(F.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=Q[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=D[b];b in K&&(this.type=K[b]);b in B&&(this.compressed=!0)}"type"in a&&(this.type=K[a.type]);var b=this.width,c=this.height,e=this.channels;"shape"in a?(b=a.shape[0],c=a.shape[1],3===a.shape.length&&(e=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),
"height"in a&&(c=a.height),"channels"in a&&(e=a.channels));this.width=b|0;this.height=c|0;this.channels=e|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*e,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(d,e){this.miplevel=e;this.width>>=e;this.height>>=e;var f=d;switch(typeof d){case "object":if(!d)return;
this.parseFlags(d);var l=d.data;if("string"===typeof l||l&&(H(l)||h(l)||V(l)||b(l)||a(l)||"[object HTMLImageElement]"===c(l)||"[object HTMLVideoElement]"===c(l)||g(l)))f=d.data;break;case "undefined":return}"string"===typeof f&&(f=z(f,this.crossOrigin));var l=null,m=!1;if(null!==f)if(H(f))this.data=f;else if(h(f))l=f,m=!0;else if(V(f)){Array.isArray(f.data)?(l=f.data,m=!0):this.data=f.data;var p=f.shape;this.width=p[0];this.height=p[1];this.channels=3===p.length?p[2]:1;p=f.stride;this.strideX=f.stride[0];
this.strideY=f.stride[1];this.strideC=3===p.length?f.stride[2]:1;this.offset=f.offset;this.needsTranspose=!0}else if(b(f)||a(f))b(f)?this.canvas=f:this.canvas=f.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===c(f))this.image=f,f.complete?(this.width=f.naturalWidth,this.height=f.naturalHeight):(this.width=this.width||f.naturalWidth,this.height=this.height||f.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===c(f))this.video=f,1<f.readyState?(this.width=f.width,this.height=f.height):(this.width=this.width||f.width,this.height=this.height||f.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===c(f))this.xhr=f,this.needsListeners=!0;else if(g(f)){var m=f[0].length,p=f.length,n=1,u,v,w,t;if(Array.isArray(f[0][0]))for(n=f[0][0].length,l=Array(m*p*n),v=t=0;v<p;++v)for(u=0;u<m;++u)for(w=0;w<n;++w)l[t++]=f[v][u][w];
else for(l=Array(m*p),v=t=0;v<p;++v)for(u=0;u<m;++u)l[t++]=f[v][u];this.width=m;this.height=p;this.channels=n;m=!0}else d.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||q.viewportWidth)|0,this.height=(this.height||q.viewportHeight)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=
[6409,6410,6407,6408][(this.channels=this.channels||4)-1]);f=this.internalformat;p=this.format=L[f];if(!this.channels)switch(p){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}p=this.type;5126!==p&&36193!==p&&(p||(p=6402===f?5125:5121));this.type=p;if(m)switch(p){case 5121:this.data=new Uint8Array(l);break;case 5123:this.data=new Uint16Array(l);break;case 5125:this.data=new Uint32Array(l);break;
case 5126:this.data=new Float32Array(l);break;case 36193:this.data=A(l)}if(this.data&&this.needsTranspose){l=this.data;f=this.width;m=this.height;p=this.channels;n=this.strideX;u=this.strideY;v=this.strideC;w=this.offset;t=new l.constructor(f*m*p);for(var X=0,x=0;x<m;++x)for(var B=0;B<f;++B)for(var I=0;I<p;++I)t[X++]=l[u*x+n*B+v*I+w];this.data=t}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){l.pixelStorei(37440,
this.flipY);l.pixelStorei(37441,this.premultiplyAlpha);l.pixelStorei(37443,this.colorSpace);l.pixelStorei(3317,this.unpackAlignment);var b=this.target,c=this.miplevel,e=this.image,g=this.canvas,h=this.video,f=this.data,m=this.internalformat,p=this.format,q=this.type,u=this.width||Math.max(1,a.width>>c);a=this.height||Math.max(1,a.height>>c);h&&2<h.readyState?l.texImage2D(b,c,p,p,q,h):e&&e.complete?l.texImage2D(b,c,p,p,q,e):g?l.texImage2D(b,c,p,p,q,g):this.compressed?l.compressedTexImage2D(b,c,m,u,
a,0,f):this.copy?(n(),l.copyTexImage2D(b,c,p,this.x,this.y,u,a,0)):f?l.texImage2D(b,c,p,u,a,0,p,q,f):l.texImage2D(b,c,p,u||1,a||1,0,p,q,null)}});e(N.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=J[a.min]);"mag"in a&&(this.magFilter=Z[a.mag]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var e=a.wrap;"string"===typeof e?b=c=G[e]:Array.isArray(e)&&(b=G[e[0]],c=G[e[1]])}else"wrapS"in a&&(b=G[a.wrapS]),"wrapT"in a&&(c=G[a.wrapT]);this.wrapS=b;this.wrapT=c;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=Y[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;l.texParameteri(a,10241,this.minFilter);l.texParameteri(a,10240,this.magFilter);l.texParameteri(a,10242,this.wrapS);l.texParameteri(a,10243,this.wrapT);f.ext_texture_filter_anisotropic&&l.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(l.hint(33170,this.mipmapHint),l.generateMipmap(a))}});
var E=0,S=0,U={},P=[],M=m.maxTextureUnits,X=Array(M).map(function(){return null});e(ea.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<M;++b){var c=X[b];if(c){if(0<c.bindCount)continue;c.unit=-1}X[b]=this;a=b;break}this.unit=a;l.activeTexture(33984+a);l.bindTexture(this.target,this.texture);E=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&W(this)}});return{create:function(a,b){function c(a,d,g,h,f,l){var m=a||{};34067===b&&
6===arguments.length&&(m=[a,d,g,h,f,l]);R(e,m);c.width=e.params.width;c.height=e.params.height;return c}var e=new ea(b);U[e.id]=e;c(a);c._reglType="texture";c._texture=e;c.destroy=function(){e.decRef()};return c},refresh:function(){u(U).forEach(t);for(var a=0;a<M;++a)X[a]=null;E=0;l.activeTexture(33984)},clear:function(){for(var a=0;a<M;++a)l.activeTexture(33984+a),l.bindTexture(3553,null),X[a]=null;l.activeTexture(33984);E=0;u(U).forEach(W)},poll:function(){P.forEach(t)},getTexture:function(a){return null}}}},
{"./util/extend":21,"./util/is-ndarray":23,"./util/is-typed-array":24,"./util/load-texture":25,"./util/parse-dds":27,"./util/to-half-float":30,"./util/values":32}],19:[function(f,n,q){n.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],20:[function(f,n,q){function h(b){return Array.prototype.slice.call(b)}function g(b){return h(b).join("")}var c=f("./extend");n.exports=function(){function b(){var a=[],b=[];return c(function(){a.push.apply(a,
h(arguments))},{def:function(){var c="v"+e++;b.push(c);0<arguments.length&&(a.push(c,"="),a.push.apply(a,h(arguments)),a.push(";"));return c},toString:function(){return g([0<b.length?"var "+b+";":"",g(a)])}})}function a(){function a(b,c){g(b,c,"=",e.def(b,c),";")}var e=b(),g=b(),f=e.toString,h=g.toString;return c(e,{entry:e,exit:g,save:a,set:function(b,c,g){a(b,c);e(b,c,"=",g,";")},toString:function(){return f()+h()}})}var e=0,f=[],n=[],q=b(),z={};return{global:q,link:function(a){for(var b=0;b<n.length;++b)if(n[b]===
a)return f[b];b="g"+e++;f.push(b);n.push(a);return b},block:b,proc:function(b,e){function f(){var a="a"+h.length;h.push(a);return a}var h=[];e=e||0;for(var n=0;n<e;++n)f();var n=a(),m=n.toString;return z[b]=c(n,{arg:f,toString:function(){return g(["function(",h.join(),"){",m(),"}"])}})},scope:a,cond:function(){var b=g(arguments),e=a(),f=a(),l=e.toString,n=f.toString;return c(e,{then:function(){e.apply(e,h(arguments));return this},"else":function(){f.apply(f,h(arguments));return this},toString:function(){var a=
n();a&&(a="else{"+a+"}");return g(["if(",b,"){",l(),"}",a])}})},compile:function(){var a=['"use strict";',q,"return {"];Object.keys(z).forEach(function(b){a.push('"',b,'":',z[b].toString(),",")});a.push("}");var b=g(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,f.concat(b)).apply(null,n)}}}},{"./extend":21}],21:[function(f,n,q){n.exports=function(f,g){for(var c=Object.keys(g),b=0;b<c.length;++b)f[c[b]]=g[c[b]];return f}},{}],22:[function(f,n,q){n.exports=
function(f,g,c){for(var b=0,a=0;a<g.length;++a)for(var e=g[a],n=0;n<c;++n)f[b++]=e[n]}},{}],23:[function(f,n,q){var h=f("./is-typed-array");n.exports=function(g){return!!g&&"object"===typeof g&&Array.isArray(g.shape)&&Array.isArray(g.stride)&&"number"===typeof g.offset&&g.shape.length===g.stride.length&&(Array.isArray(g.data)||h(g.data))}},{"./is-typed-array":24}],24:[function(f,n,q){var h=f("../constants/arraytypes.json");n.exports=function(g){return Object.prototype.toString.call(g)in h}},{"../constants/arraytypes.json":4}],
25:[function(f,n,q){n.exports=function(f,g){if("undefined"!==typeof document){var c;c=(c=/\.(\w+)(\?.*)?$/.exec(f))&&c[1]?c[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(c))return c=document.createElement("video"),c.autoplay=!0,c.loop=!0,g&&(c.crossOrigin=g),c.src=f,c;if(0<=["dds"].indexOf(c))return c=new XMLHttpRequest,c.responseType="arraybuffer",c.open("GET",f,!0),c.send(),c;c=new Image;g&&(c.crossOrigin=g);c.src=f;return c}return null}},
{}],26:[function(f,n,q){n.exports=function(f,g){for(var c=Array(f),b=0;b<f;++b)c[b]=g(b);return c}},{}],27:[function(f,n,q){n.exports=function(f){function n(a){for(var b=Y,c=G,e=0;e<D;++e){var g=Math.max(1,b+3>>2)*Math.max(1,c+3>>2)*Q;ca.pixels.push({target:a,miplevel:e,width:b,height:c,data:new Uint8Array(f,B,g)});B+=g;b>>=1;c>>=1}}var q=new Int32Array(f),W=q[x],Y=q[F],G=q[O],Z=H,J=0,Q=0,K=4;switch(q[ea]){case p:Q=8;W&A?(K=3,J=c):J=b;break;case v:Q=16;J=a;break;case l:Q=16;J=e;break;case w:Q=8,J=
u}var D=1;q[fa]&V&&(D=Math.max(1,q[N]));var B=q[m]+4,ca={width:Y,height:G,channels:K,format:J,type:Z,compressed:!0,cube:!1,pixels:[]};if(q[R]&z)for(ca.cube=!0,q=0;6>q;++q)n(g+q);else n(h);return ca};var h=3553,g=34069,c=33776,b=33777,a=33778,e=33779,u=36196,H=5121,V=131072,z=512,A=64,p=827611204,v=861165636,l=894720068,w=826496069,m=1,x=2,O=3,F=4,N=7,fa=20,ea=21,R=28},{}],28:[function(f,n,q){function h(a){var b,c;b=(65535<a)<<4;a>>>=b;c=(255<a)<<3;a>>>=c;b|=c;c=(15<a)<<2;a>>>=c;b|=c;c=(3<a)<<1;return b|
c|a>>>c>>1}function g(a){a:{for(var c=16;268435456>=c;c*=16)if(a<=c){a=c;break a}a=0}c=b[h(a)>>2];return 0<c.length?c.pop():new ArrayBuffer(a)}function c(a){b[h(a.byteLength)>>2].push(a)}var b=f("./loop")(8,function(){return[]});n.exports={alloc:g,free:c,allocType:function(a,b){switch(a){case 5120:return new Int8Array(g(b),0,b);case 5121:return new Uint8Array(g(b),0,b);case 5122:return new Int16Array(g(2*b),0,b);case 5123:return new Uint16Array(g(2*b),0,b);case 5124:return new Int32Array(g(4*b),0,
b);case 5125:return new Uint32Array(g(4*b),0,b);case 5126:return new Float32Array(g(4*b),0,b);default:return null}},freeType:function(a){c(a.buffer)}}},{"./loop":26}],29:[function(f,n,q){n.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(f){return requestAnimationFrame(f)},cancel:function(f){return cancelAnimationFrame(f)}}:{next:function(f){setTimeout(f,30)},cancel:clearTimeout}},{}],30:[function(f,n,q){n.exports=function(f){for(var g=new Float32Array(f),
g=new Uint32Array(g.buffer),c=new Uint16Array(f.length),b=0;b<f.length;++b)if(isNaN(f[b]))c[b]=65535;else if(Infinity===f[b])c[b]=31744;else if(-Infinity===f[b])c[b]=64512;else{var a=g[b],e=a>>>31<<15,n=(a<<1>>>24)-127,a=a>>13&1023;c[b]=-24>n?e:-14>n?e+(a+1024>>-14-n):15<n?e+31744:e+(n+15<<10)+a}return c}},{}],31:[function(f,n,q){n.exports=function(f,g,c,b,a,e,n){for(var q=0,V=0;V<c;++V)for(var z=0;z<b;++z)f[q++]=g[a*V+e*z+n]}},{}],32:[function(f,n,q){n.exports=function(f){return Object.keys(f).map(function(g){return f[g]})}},
{}],33:[function(f,n,q){function h(b,a){function e(){var a=window.innerWidth,e=window.innerHeight;b!==document.body&&(e=b.getBoundingClientRect(),a=e.right-e.left,e=e.top-e.bottom);f.width=n*a;f.height=n*e;c(f.style,{width:a+"px",height:e+"px"})}var f=document.createElement("canvas"),h=g(f,a);c(f.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(f);b===document.body&&(f.style.position="absolute",c(b.style,{margin:0,padding:0}));var n=+h.options.pixelRatio;window.addEventListener("resize",
e,!1);var q=h.options.onDestroy;h.options=c(c({},h.options),{onDestroy:function(){window.removeEventListener("resize",e);b.removeChild(f);q&&q()}});e();return h}function g(b,a){function e(a){try{return b.getContext(a,g)}catch(c){return null}}var g=a.glOptions||{};return{gl:e("webgl")||e("experimental-webgl")||e("webgl-experimental"),options:c({pixelRatio:window.devicePixelRatio},a)}}var c=f("./util/extend");n.exports=function(b){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:b[0],
options:b[1]||{}};var a=document.body,e=b[1]||{};if("string"===typeof b[0])a=document.querySelector(b[0])||document.body;else if("object"===typeof b[0])if(b[0]instanceof HTMLElement)a=b[0];else{if(b[0]instanceof WebGLRenderingContext)return{gl:b[0],options:c({pixelRatio:1},e)};e=b[0]}return a.nodeName&&"CANVAS"===a.nodeName.toUpperCase()?g(a,e):h(a,e)}},{"./util/extend":21}],34:[function(f,n,q){var h=f("./lib/util/extend"),g=f("./lib/dynamic"),c=f("./lib/util/raf"),b=f("./lib/util/clock"),a=f("./lib/strings"),
e=f("./lib/webgl"),u=f("./lib/extension"),H=f("./lib/limits"),V=f("./lib/buffer"),z=f("./lib/elements"),A=f("./lib/texture"),p=f("./lib/renderbuffer"),v=f("./lib/framebuffer"),l=f("./lib/attribute"),w=f("./lib/shader"),m=f("./lib/read"),x=f("./lib/core");n.exports=function(){function f(){M=c.next(f);J.count+=1;var a=S.viewport,d=S.scissor_box;a[0]=a[1]=d[0]=d[1]=0;J.viewportWidth=J.frameBufferWidth=J.drawingBufferWidth=a[2]=d[2]=t.drawingBufferWidth;J.viewportHeight=J.frameBufferWidth=J.drawingBufferHeight=
a[3]=d[3]=t.drawingBufferHeight;a=b();J.deltaTime=(a-Y)/1E3;J.time=(a-W)/1E3;Y=a;E.procs.refresh();B.poll();for(a=0;a<P.length;++a)(0,P[a])(J,null,0)}function n(a){}function q(a){}function fa(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];g.isDynamic(e)?d[b]=g.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;q.length<a;)q.push(null);return q}var e=b(a.context||{}),f=b(a.uniforms||{}),l=b(a.attributes||{});a=b(function(a){function b(a){if(a in c){var d=
c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=h({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var e=E.compile(a,l,f,e),n=e.draw,m=e.batch,p=e.scope,q=[];return function(a,b){var d;if("function"===typeof a)return p.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)p.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<
a.length;++d)p.call(this,a[d],b,d);else return p.call(this,a,b,0);else if("number"===typeof a){if(0<a)return m.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return m.call(this,a,a.length)}else return n.call(this,a)}}function ea(){E.procs.poll()}var R=e(Array.prototype.slice.call(arguments)),t=R.gl,la=R.options,R=a(),I=u(t).extensions,W=b(),Y=W,G=t.drawingBufferWidth,Z=t.drawingBufferHeight,J={count:0,deltaTime:0,time:0,viewportWidth:G,viewportHeight:Z,framebufferWidth:G,framebufferHeight:Z,
drawingBufferWidth:G,drawingBufferHeight:Z,pixelRatio:la.pixelRatio},G=H(t,I),Q=V(t),K=z(t,I,Q),Z=l(t,I,G,Q,R),D=w(t,R),B=A(t,I,G,ea,J),ca=p(t,I,G),ja=v(t,I,G,B,ca),L=m(t,ea,J),E=x(t,R,I,G,Q,K,B,ja,{},Z,D,{elements:null,primitive:4,count:-1,offset:0,instances:-1},J),S=E.next,U=t.canvas,P=[],M=0;U&&(U.addEventListener("webglcontextlost",n,!1),U.addEventListener("webglcontextrestored",q,!1));E.procs.refresh();return h(fa,{clear:function(a){var b=0;ea();var c=a.color;c&&(t.clearColor(+c[0]||0,+c[1]||
0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(t.clearDepth(+a.depth),b|=256);"stencil"in a&&(t.clearStencil(a.stencil|0),b|=1024);t.clear(b)},prop:g.define.bind(null,1),context:g.define.bind(null,2),"this":g.define.bind(null,3),draw:fa({}),elements:function(a){return K.create(a)},buffer:function(a){return Q.create(a,34962)},texture:function(a){return B.create(a,3553)},cube:function(a){return 6===arguments.length?B.create(Array.prototype.slice.call(arguments),34067):B.create(a,34067)},renderbuffer:function(a){return ca.create(a)},
framebuffer:function(a){return ja.create(a)},framebufferCube:function(a){},attributes:t.getContextAttributes(),frame:function(a){P.push(a);!M&&0<P.length&&f();return{cancel:function(){var b=P.find(function(b){return b===a});0>b||(P.splice(b,1),0>=P.length&&M&&(c.cancel(f),M=0))}}},limits:G,read:L,destroy:function(){M&&(c.cancel(f),M=0);U&&(U.removeEventListener("webglcontextlost",n),U.removeEventListener("webglcontextrestored",q));D.clear();ja.clear();ca.clear();B.clear();Q.clear();if(la.onDestroy)la.onDestroy()},
_gl:t,_refresh:function(){E.procs.refresh()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/strings":17,"./lib/texture":18,"./lib/util/clock":19,"./lib/util/extend":21,"./lib/util/raf":29,"./lib/webgl":33}]},{},[1]);
