<!DOCTYPE html>
      <html>
        <head>
          <title>example/elements.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(h,l,c){function q(a,f){if(!l[a]){if(!h[a]){var A="function"==typeof require&&require;if(!f&&A)return A(a,!0);if(b)return b(a,!0);A=Error("Cannot find module '"+a+"'");throw A.code="MODULE_NOT_FOUND",A;}A=l[a]={exports:{}};h[a][0].call(A.exports,function(b){var c=h[a][1][b];return q(c?c:b)},A,A.exports,e$$0,h,l,c)}return l[a].exports}for(var b="function"==typeof require&&require,a=0;a<c.length;a++)q(c[a]);return q})({1:[function(e,h,l){e=e("../regl")();e.clear({color:[0,0,0,1],depth:1});
e({frag:"\n    precision mediump float;\n    uniform vec4 color;\n    void main() {\n      gl_FragColor = color;\n    }",vert:"\n    precision mediump float;\n    attribute vec2 position;\n    void main() {\n      gl_Position = vec4(position, 0, 1);\n    }",attributes:{position:e.buffer(Array(5).fill().map(function(c,q){var b=2*Math.PI*q/5;return[Math.sin(b),Math.cos(b)]}))},uniforms:{color:[1,0,0,1]},elements:e.elements([[0,1],[0,2],[0,3],[0,4],[1,2],[1,3],[1,4],[2,3],[2,4],[3,4]]),lineWidth:3})()},
{"../regl":33}],2:[function(e,h,l){var c=e("./constants/dtypes.json");h.exports=function(q,b,a,e,f){function A(){this.pointer=!1;this.w=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}function n(b){this.records=[];this.name=b}function h(a,d,p,c){c=p.size||c;var g;g=d.pointer?p.pointer&&d.buffer===p.buffer&&d.size===c&&d.normalized===p.normalized&&d.type===p.type&&d.offset===p.offset&&d.stride===p.stride&&d.divisor===p.divisor:
!p.pointer&&d.x===p.x&&d.y===p.y&&d.z===p.z&&d.w===p.w;g||(p.pointer?(d.pointer||q.enableVertexAttribArray(a),d.buffer!==p.buffer&&p.buffer.bind(),q.vertexAttribPointer(a,c,p.type,p.normalized,p.stride,p.offset),(g=b.angle_instanced_arrays)&&g.vertexAttribDivisorANGLE(a,p.divisor)):(d.pointer&&q.disableVertexAttribArray(a),q.vertexAttrib4f(a,p.x,p.y,p.z,p.w)),(d.pointer=p.pointer)?(d.buffer=p.buffer,d.size=c,d.normalized=p.normalized,d.type=p.type,d.offset=p.offset,d.stride=p.stride,d.divisor=p.divisor):
(d.x=p.x,d.y=p.y,d.z=p.z,d.w=p.w))}var y={};a=a.maxAttributes;for(var t=Array(a),g=0;g<a;++g)t[g]=new A;return{bindings:t,bind:function(a,d,b,c){b=b.records;h(a,d,b[b.length-1],c)},bindRecord:h,def:function(b){var d=f.id(b),a=y[d];a||(a=y[d]=new n(b));return a},box:function(a){var d=[new A];return{alloc:function(a){var b;b=0>=d.length?new A:d.pop();if("number"===typeof a)b.pointer=!1,b.x=a,b.y=0,b.z=0,b.w=0;else if(Array.isArray(a))b.pointer=!1,b.x=a[0],b.y=a[1],b.z=a[2],b.w=a[3];else{var g=e.getBuffer(a),
q=0,n=0,f=0,h=0,v=!1,H=5126;g?H=g.dtype:(g=e.getBuffer(a.buffer),q=a.size||0,n=a.stride||0,f=a.offset||0,h=a.divisor||0,v=a.normalized||!1,H=g.dtype,"type"in a&&(H=c[a.type]));b.pointer=!0;b.buffer=g;b.size=q;b.offset=f;b.stride=n;b.divisor=h;b.normalized=v;b.type=H}return b},free:function(b){d.push(b)}}},state:y}}},{"./constants/dtypes.json":6}],3:[function(e,h,l){function c(b,a){switch(b){case 5121:return new Uint8Array(a);case 5123:return new Uint16Array(a);case 5125:return new Uint32Array(a);
case 5120:return new Int8Array(a);case 5122:return new Int16Array(a);case 5124:return new Int32Array(a);case 5126:return new Float32Array(a);default:return null}}var q=e("./util/is-typed-array"),b=e("./util/is-ndarray"),a=e("./constants/arraytypes.json"),L=e("./constants/dtypes.json"),f=e("./util/values"),A={"static":35044,dynamic:35048,stream:35040};h.exports=function(n){function e(a,b){this.id=g++;this.buffer=a;this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=
5121}function h(a){n.isBuffer(a.buffer)||(a.buffer=n.createBuffer());a.bind();n.bufferData(a.type,a.data||a.byteLength,a.usage)}function t(a){var b=a.buffer;n.isBuffer(b)&&n.deleteBuffer(b);a.buffer=null;delete v[a.id]}var g=0,v={};e.prototype.bind=function(){n.bindBuffer(this.type,this.buffer)};return{create:function(d,g,f){function E(d){var g=d||{};if(Array.isArray(g)||q(g)||b(g))g={data:g};else if("number"===typeof g)g={length:g|0};else if(null===g||void 0===g)g={};l.usage="usage"in g?A[g.usage]:
35044;d=0;"type"in g&&(d=L[g.type]);var p=g.dimension|0||1,n=0,f=null;if("data"in g)if(f=g.data,null===f)n=g.length|0;else{if(b(f)){var p=f.shape,n=f.stride,g=f.offset,e=0,v=0,t=0,m=0;1===p.length?(e=p[0],v=1,t=n[0],m=0):2===p.length&&(e=p[0],v=p[1],t=n[0],m=n[1]);d=d||a[Object.prototype.toString.call(f)]|0||5126;for(var p=v,n=c(d,e*v),f=f.data,R=0,ga=0;ga<e;++ga)for(var N=0;N<v;++N)n[R++]=f[t*ga+m*N+g];f=n}else if(Array.isArray(f))if(0<f.length&&Array.isArray(f[0])){p=f[0].length;d=d||5126;g=c(d,
f.length*p);n=f;f=p;for(e=m=0;e<n.length;++e)for(t=n[e],v=0;v<f;++v)g[m++]=t[v];f=g}else d=d||5126,f=c(d,f);else d=d||a[Object.prototype.toString.call(f)]|0;n=f.byteLength}else"length"in g&&(n=g.length|0);l.data=f;l.dtype=d||5121;l.byteLength=n;l.dimension=p;h(l);return E}var B=n.createBuffer(),l=new e(B,g);v[l.id]=l;f||E(d);E._reglType="buffer";E._buffer=l;E.destroy=function(){t(l)};return E},clear:function(){f(v).forEach(t)},refresh:function(){f(v).forEach(h)},getBuffer:function(a){return a&&a._buffer instanceof
e?a._buffer:null}}}},{"./constants/arraytypes.json":5,"./constants/dtypes.json":6,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":32}],4:[function(e,h,l){function c(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function q(a,b,g,c){var d,p=",";switch(b){case 5126:d="1f";break;case 35664:d="2fv";break;case 35665:d="3fv";break;case 35666:d="4fv";break;case 35670:case 5124:d=
"1i";break;case 35671:case 35667:d="2iv";break;case 35672:case 35668:d="3iv";break;case 35673:case 35669:d="4iv";break;case 35674:d="Matrix2fv";p=",false,";break;case 35675:d="Matrix3fv";p=",false,";break;case 35676:d="Matrix4fv",p=",false,"}return a+".uniform"+d+"("+g+p+c+");"}function b(a){return a+"["+a+".length-1]"}function a(a,b){return"framebuffer"===a||a<b?-1:a>b?1:0}var L=e("./util/codegen"),f=e("./constants/primitives.json"),A={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,
"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},n={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},H={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,
"increment wrap":34055,"decrement wrap":34056,invert:5386};h.exports=function(e,h,g,v,d,p,u,E,l,Q,w,U,P,ka,X){function ja(d,m,h,v,S){function u(a){var b=J[a];return b?b:b=J[a]=r(V[a])}function t(a){var b=a.id,d=U[b];if(d)return d;d=a.func?k.def(r(a.data),"(",W,",",Z,",",ba,")"):k.def(W,".",a.data);return U[b]=d}function ha(a,b){for(var d=0;d<a.length;++d)if(a[d].name===b)return a[d];return null}function l(a){return la&&!(a in m||a in S)}var ia=L(),r=ia.link,k=ia.proc("batch"),ca=ia.block(),D=k.def,
M=k.arg,x=r(e),z=r(d.program),O=r(w.bind),G=r(w.bindRecord),ba=r(ka),pa=r(E),da=r(P.count),fa=r(P.offset),ma=r(P.instances),C=r(P.primitive),J={},F=r(p.elements),da=D(b(da)),fa=D(b(fa)),C=D(b(C)),F=D(b(F)),K,B,ea=g.angle_instanced_arrays;ea&&(K=D(b(ma)),B=r(ea));var la="elements"in m,ma=M(),M=M(),W=D(),Z=D(),U={};k(x,".useProgram(",z,");");d.uniforms.forEach(function(a){if(!(a.name in h)){var b=r(a.location),d=r(Q.def(a.name)),d=d+"["+d+".length-1]";a=a.info.type;35678===a||35680===a?(a=D(d+"._texture"),
k(q(x,5124,b,a+".bind()")),ca(a,".unbind();")):k(q(x,a,b,d))}});d.attributes.forEach(function(a){if(!(a.name in v)){var b=r(w.def(a.name));k(O,"(",a.location,",",r(w.bindings[a.location]),",",b,",",c(a.info.type),");")}});la||k("if(",F,")",x,".bindBuffer(",34963,",",F,".buffer.buffer);");k("for(",Z,"=0;",Z,"<",ma,";++",Z,"){",W,"=",M,"[",Z,"];");Object.keys(m).sort(a).forEach(function(a){function b(a){k("if(",d,"){",x,".enable(",a,");}else{",x,".disable(",a,");}")}var d=t(m[a]);switch(a){case "framebuffer":a=
u("viewport");var z=u("scissor.box");k("if(",pa,".push(",d,"&&",d,"._framebuffer)){",pa,".poll();",a,".setDirty();",z,".setDirty();","}");break;case "cull.enable":b(2884);break;case "blend.enable":b(3042);break;case "dither":b(3024);break;case "stencil.enable":b(2960);break;case "depth.enable":b(2929);break;case "scissor.enable":b(3089);break;case "polygonOffset.enable":b(32823);break;case "sample.alpha":b(32926);break;case "sample.enable":b(32928);break;case "depth.mask":k(x,".depthMask(",d,");");
break;case "depth.func":a=r(n);k(x,".depthFunc(",a,"[",d,"]);");break;case "depth.range":k(x,".depthRange(",d,"[0],",d,"[1]);");break;case "blend.color":k(x,".blendColor(",d,"[0],",d,"[1],",d,"[2],",d,"[3]);");break;case "blend.equation":a=r(I);k("if(typeof ",d,'==="string"){',x,".blendEquation(",a,"[",d,"]);","}else{",x,".blendEquationSeparate(",a,"[",d,".rgb],",a,"[",d,".alpha]);","}");break;case "blend.func":a=r(A);k(x,".blendFuncSeparate(",a,'["srcRGB" in ',d,"?",d,".srcRGB:",d,".src],",a,'["dstRGB" in ',
d,"?",d,".dstRGB:",d,".dst],",a,'["srcAlpha" in ',d,"?",d,".srcAlpha:",d,".src],",a,'["dstAlpha" in ',d,"?",d,".dstAlpha:",d,".dst]);");break;case "stencil.mask":k(x,".stencilMask(",d,");");break;case "stencil.func":a=r(n);k(x,".stencilFunc(",a,"[",d,'.cmp||"always"],',d,".ref|0,",'"mask" in ',d,"?",d,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":z=r(H);k(x,".stencilOpSeparate(","stencil.opFront"===a?1028:1029,",",z,"[",d,'.fail||"keep"],',z,"[",d,'.zfail||"keep"],',z,"[",d,'.pass||"keep"]);');
break;case "polygonOffset.offset":k(x,".polygonOffset(",d,".factor||0,",d,".units||0);");break;case "cull.face":k(x,".cullFace(",d,'==="front"?',1028,":",1029,");");break;case "lineWidth":k(x,".lineWidth(",d,");");break;case "frontFace":k(x,".frontFace(",d,'==="cw"?',2304,":",2305,");");break;case "colorMask":k(x,".colorMask(",d,"[0],",d,"[1],",d,"[2],",d,"[3]);");break;case "sample.coverage":k(x,".sampleCoverage(",d,".value,",d,".invert);");break;case "scissor.box":case "viewport":a=u(a),k(a,".push(",
d,".x||0,",d,".y||0,",d,".w||-1,",d,".h||-1);")}});("viewport"in m||"framebuffer"in m)&&k(u("viewport"),".poll();");("scissor.box"in m||"framebuffer"in m)&&k(u("scissor.box"),".poll();");"framebuffer"in m&&k(pa,".pop();");var X=d.uniforms,ra=[];Object.keys(h).forEach(function(a){var d=ha(X,a);if(d){var b=d.info.type,z=r(d.location);a=t(h[a]);35678===d.info.type||35680===d.info.type?(d=D(a+"._texture"),ra.push(d),k(q(x,5124,z,d+".bind()"))):k(q(x,b,z,a))}});ra.forEach(function(a){k(a,".unbind();")});
var ta=d.attributes;Object.keys(v).forEach(function(a){var d=ha(ta,a);if(d){var b=r(w.box(a));a=t(v[a]);a=D(b+".alloc("+a+")");k(G,"(",d.location,",",r(w.bindings[d.location]),",",a,",",c(d.info.type),");");ca(b,".free(",a,");")}});m.count&&k(da,"=",t(m.count),";");m.offset&&k(fa,"=",t(m.offset),";");m.primitive&&k(C,"=",r(f),"[",t(m.primitive),"];");ea&&m.instances&&k(K,"=",t(m.instances),";");la&&(d=t(m.elements),k(F,"=",d,"?",d,"._elements:null;"));l("offset")&&k(fa,"=0;");k("if(",F,"){");l("count")&&
k(da,"=",F,".vertCount;");k("if(",da,">0){");l("primitive")&&k(C,"=",F,".primType;");la&&k(x,".bindBuffer(",34963,",",F,".buffer.buffer);");ea&&k("if(",K,">0){",B,".drawElementsInstancedANGLE(",C,",",da,",",F,".type,",fa,",",K,");}else ");k(x,".drawElements(",C,",",da,",",F,".type,",fa,");");k("}}else if(",da,">0){");l("count")||(l("primitive")&&k(C,"=",4,";"),ea&&k("if(",K,">0){",B,".drawArraysInstancedANGLE(",C,",",fa,",",da,",",K,");}else{"),k(x,".drawArrays(",C,",",fa,",",da,");"),ea&&k("}"));
k("}}",ca);return ia.compile().batch}var V=l.contextState,I={add:32774,subtract:32778,"reverse subtract":32779};g.ext_blend_minmax&&(I.min=32775,I.max=32776);var m=0;return{draw:function(a){var d=L(),m=d.link,f=d.proc("draw"),n=f.def,A=m(e),h=m(a.program),v=m(w.bind),t=m(P.count),u=m(P.offset),r=m(P.instances),k=m(P.primitive),E=m(p.elements),H=[];f(A,".useProgram(",h,");");a.attributes.forEach(function(a){var d=m(w.def(a.name));f(v,"(",a.location,",",m(w.bindings[a.location]),",",d,",",c(a.info.type),
");")});a.uniforms.forEach(function(a){var d=m(a.location),b=m(Q.def(a.name)),b=b+"["+b+".length-1]";a=a.info.type;35678===a||35680===a?(a=n(b+"._texture"),H.push(a),f(q(A,5124,d,a+".bind()"))):f(q(A,a,d,b))});H.forEach(function(a){f(a,".unbind();")});a=n(b(k));t=n(b(t));u=n(b(u));E=n(b(E));f("if(",t,"){");(h=g.angle_instanced_arrays)?(r=n(b(r)),h=m(h),f("if(",E,"){",E,".bind();","if(",r,">0){",h,".drawElementsInstancedANGLE(",a,",",t,",",E,".type,",u,",",r,");}else{",A,".drawElements(",a,",",t,",",
E,".type,",u,");}","}else if(",r,">0){",h,".drawArraysInstancedANGLE(",a,",",u,",",t,",",r,");}else{",A,".drawArrays(",a,",",u,",",t,");}}")):f("if(",E,"){",E,".bind();",A,".drawElements(",a,",",t,",",E,".type,",u,");","}else{",A,".drawArrays(",a,",",u,",",t,");}}");return d.compile().draw},command:function(d,b,g,c,q,e,v){function u(a){var d=ma[a];return d?d:d=ma[a]=k(V[a])}function l(a,d){var b=u(a);C(b,".push(",d,");");J(b,".pop();")}function y(a){var d=a.id,b=la[d];if(b)return b;b=a.func?F.def(k(a.data),
"(",ea,",0,",qa,")"):F.def(ea,".",a.data);return la[d]=b}var r=L(),k=r.link,B=r.block,D=r.proc,M=m++,x=k(X),z=k(U),O=k(E),G={count:k(P.count),offset:k(P.offset),instances:k(P.instances),primitive:k(P.primitive)},ba=k(p.elements),pa=k(f),da=k(n),fa=k(H),ma={},C=B(),J=B();Object.keys(d).sort(a).forEach(function(a){var b=d[a];switch(a){case "frag":case "vert":b=h.id(b);U.shader("frag"===a?35632:35633,b);C(z,".",a,".push(",b,");");J(z,".",a,".pop();");break;case "framebuffer":E.getFramebuffer(b);a=u("viewport");
var g=u("scissor.box");C("if(",O,".push(",k(b&&b._framebuffer),")){",a,".setDirty();",g,".setDirty();","}");J("if(",O,".pop()){",a,".setDirty();",g,".setDirty();","}");break;case "count":case "offset":case "instances":C(G[a],".push(",b,");");J(G[a],".pop();");break;case "primitive":C(G.primitive,".push(",f[b],");");J(G.primitive,".pop();");break;case "elements":g=p.getElements(b);b=!("primitive"in d);a=!("count"in d);g?(g=k(g),C(ba,".push(",g,");"),b&&C(G.primitive,".push(",g,".primType);"),a&&C(G.count,
".push(",g,".vertCount);")):(C(ba,".push(null);"),b&&C(G.primitive,".push(",4,");"),a&&C(G.count,".push(0);"));b&&J(G.primitive,".pop();");a&&J(G.count,".pop();");"offset"in d||(C(G.offset,".push(0);"),J(G.offset,".pop();"));J(ba,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":l(a,b);break;case "depth.func":l(a,n[b]);break;case "depth.range":a=
u(a);C(a,".push(",b[0],",",b[1],");");J(a,".pop();");break;case "blend.func":a=u(a);C(a,".push(",A["srcRGB"in b?b.srcRGB:b.src],",",A["dstRGB"in b?b.dstRGB:b.dst],",",A["srcAlpha"in b?b.srcAlpha:b.src],",",A["dstAlpha"in b?b.dstAlpha:b.dst],");");J(a,".pop();");break;case "blend.equation":a=u(a);"string"===typeof b?C(a,".push(",I[b],",",I[b],");"):"object"===typeof b&&C(a,".push(",I[b.rgb],",",I[b.alpha],");");J(a,".pop();");break;case "blend.color":a=u(a);C(a,".push(",b[0],",",b[1],",",b[2],",",
b[3],");");J(a,".pop();");break;case "stencil.mask":a=u(a);C(a,".push(",b,");");J(a,".pop();");break;case "stencil.func":var g=b.cmp||"keep",c=b.ref||0,b="mask"in b?b.mask:-1;a=u(a);C(a,".push(",n[g],",",c,",",b,");");J(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":g=b.fail||"keep";c=b.zfail||"keep";b=b.pass||"keep";a=u(a);C(a,".push(",H[g],",",H[c],",",H[b],");");J(a,".pop();");break;case "polygonOffset.offset":g=b.factor||0;b=b.units||0;a=u(a);C(a,".push(",g,",",b,");");J(a,".pop();");
break;case "cull.face":g=0;"front"===b?g=1028:"back"===b&&(g=1029);b=u(a);C(b,".push(",g,");");J(b,".pop();");break;case "lineWidth":l(a,b);break;case "frontFace":g=0;"cw"===b?g=2304:"ccw"===b&&(g=2305);b=u(a);C(b,".push(",g,");");J(b,".pop();");break;case "colorMask":a=u(a);C(a,".push(",b.map(function(a){return!!a}).join(),");");J(a,".pop();");break;case "sample.coverage":g="value"in b?b.value:1;b=!!b.invert;a=u(a);C(a,".push(",g,",",b,");");J(a,".pop();");break;case "viewport":case "scissor.box":var g=
b.x||0,c=b.y||0,m=-1,q=-1;"w"in b&&(m=b.w);"h"in b&&(q=b.h);b=u(a);C(b,".push(",g,",",c,",",m,",",q,");");J(b,".pop();")}});Object.keys(b).forEach(function(a){var d=k(Q.def(a));a=b[a];a="function"===typeof a&&a._reglType?k(a):Array.isArray(a)?k(a.slice()):+a;C(d,".push(",a,");");J(d,".pop();")});Object.keys(g).forEach(function(a){var b=g[a],d=k(w.def(a));a=k(w.box(a).alloc(b));C(d,".records.push(",a,");");J(d,".records.pop();")});var F=r.block(),K=r.block(),qa,ea;v&&(qa=k(ka),ea=C.def());var la={};
Object.keys(c).sort(a).forEach(function(a){var b=y(c[a]);switch(a){case "framebuffer":a=u("viewport");var z=u("scissor.box");F("if(",O,".push(",b,"&&",b,"._framebuffer)){",a,".setDirty();",z,".setDirty();","}");K("if(",O,".pop()){",a,".setDirty();",z,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=u(a);
F(a,".push(",b,");");K(a,".pop();");break;case "count":case "offset":case "instances":a=G[a];F(a,".push(",b,");");K(a,".pop();");break;case "primitive":a=G.primitive;F(a,".push(",pa,"[",b,"]);");K(a,".pop();");break;case "depth.func":a=u(a);F(a,".push(",da,"[",b,"]);");K(a,".pop();");break;case "blend.func":a=u(a);z=k(A);F(a,".push(",z,'["srcRGB" in ',b,"?",b,".srcRGB:",b,".src],",z,'["dstRGB" in ',b,"?",b,".dstRGB:",b,".dst],",z,'["srcAlpha" in ',b,"?",b,".srcAlpha:",b,".src],",z,'["dstAlpha" in ',
b,"?",b,".dstAlpha:",b,".dst]);");K(a,".pop();");break;case "blend.equation":a=u(a);z=k(I);F("if(typeof ",b,'==="string"){',a,".push(",z,"[",b,"],",z,"[",b,"]);","}else{",a,".push(",z,"[",b,".rgb],",z,"[",b,".alpha]);","}");K(a,".pop();");break;case "blend.color":a=u(a);F(a,".push(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");K(a,".pop();");break;case "stencil.mask":a=u(a);F(a,".push(",b,");");K(a,".pop();");break;case "stencil.func":a=u(a);F(a,".push(",da,"[",b,".cmp],",b,".ref|0,",'"mask" in ',b,"?",
b,".mask:-1);");K(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=u(a);F(a,".push(",fa,"[",b,'.fail||"keep"],',fa,"[",b,'.zfail||"keep"],',fa,"[",b,'.pass||"keep"]);');K(a,".pop();");break;case "polygonOffset.offset":a=u(a);F(a,".push(",b,".factor||0,",b,".units||0);");K(a,".pop();");break;case "cull.face":a=u(a);F(a,".push(",b,'==="front"?',1028,":",1029,");");K(a,".pop();");break;case "frontFace":a=u(a);F(a,".push(",b,'==="cw"?',2304,":",2305,");");K(a,".pop();");break;case "colorMask":a=
u(a);F(a,".push(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");K(a,".pop();");break;case "sample.coverage":a=u(a);F(a,".push(",b,".value,",b,".invert);");K(a,".pop();");break;case "scissor.box":case "viewport":a=u(a);F(a,".push(",b,".x||0,",b,".y||0,",'"w" in ',b,"?",b,".w:-1,",'"h" in ',b,"?",b,".h:-1);");K(a,".pop();");break;case "elements":a=!("primitive"in c)&&!("primitive"in d);var z=!("count"in c)&&!("count"in d),g=!("offset"in c)&&!("offset"in d),m=F.def();F("if(",b,"){",m,"=",b,"._elements;",ba,
".push(",m,");",a?G.primitive+".push("+m+".primType);":"",z?G.count+".push("+m+".vertCount);":"",g?G.offset+".push("+m+".offset);":"","}else{",ba,".push(null);","}");K(ba,".pop();","if(",b,"){",a?G.primitive+".pop();":"",z?G.count+".pop();":"",g?G.offset+".pop();":"","}")}});Object.keys(q).forEach(function(a){var b=k(Q.def(a));a=y(q[a]);F(b,".push(",a,");");K(b,".pop();")});Object.keys(e).forEach(function(a){var b=k(w.def(a)),d=y(e[a]);a=k(w.box(a));F(b,".records.push(",a,".alloc(",d,"));");K(a,".free(",
b,".records.pop());")});var W=D("scope"),Z=W.arg(),sa=W.arg();W(C);v&&W(ea,"=",Z,";",F);W(sa,"();",v?K:"",J);W=B();B=W.def();d.frag&&d.vert?(Z=d.frag,W(B,"=",k(U.program(h.id(d.vert),h.id(Z))),";")):W(B,"=",z,".program","(",z,".vert[",z,".vert.length-1]",",",z,".frag[",z,".frag.length-1]",");");Z=D("draw");Z(C,W);v&&Z(ea,"=",Z.arg(),";",F);Z(x,"();","if(",B,")",B,".draw(",v?ea:"",");",v?K:"",J);var na=D("batch");na(C,W);v=k(function(a,b,z){var g=a.batchCache[M];g||(g=a.batchCache[M]=ja(a,c,q,e,d));
return g(b,z)});na("if(",B,"){",x,"();",v,"(",B,",",na.arg(),",",na.arg(),");");Object.keys(c).forEach(function(a){(a=ma[a])&&na(a,".setDirty();")});na("}",J);return r.compile()}}}},{"./constants/primitives.json":7,"./util/codegen":23}],5:[function(e,h,l){h.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,
"[object ArrayBuffer]":5121}},{}],6:[function(e,h,l){h.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],7:[function(e,h,l){h.exports={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],8:[function(e,h,l){function c(a,c){function f(){var c=window.innerWidth,g=window.innerHeight;a!==document.body&&(g=a.getBoundingClientRect(),c=g.right-g.left,g=g.top-g.bottom);e.width=h*c;e.height=h*g;b(e.style,{width:c+"px",
height:g+"px"})}var e=document.createElement("canvas"),n=q(e,c);b(e.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(e);a===document.body&&(e.style.position="absolute",b(a.style,{margin:0,padding:0}));var h=+n.options.pixelRatio;window.addEventListener("resize",f,!1);var l=n.options.onDestroy;n.options=b(b({},n.options),{onDestroy:function(){window.removeEventListener("resize",f);a.removeChild(e);l&&l()}});f();return n}function q(a,c){function f(b){try{return a.getContext(b,e)}catch(c){return null}}
var e=c.glOptions||{};return{gl:f("webgl")||f("experimental-webgl")||f("webgl-experimental"),options:b({pixelRatio:window.devicePixelRatio},c)}}var b=e("./util/extend");h.exports=function(a){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:a[0],options:a[1]||{}};var e=document.body,f=a[1]||{};if("string"===typeof a[0])e=document.querySelector(a[0])||document.body;else if("object"===typeof a[0])if(a[0]instanceof HTMLElement)e=a[0];else{if(a[0]instanceof WebGLRenderingContext)return{gl:a[0],
options:b({pixelRatio:1},f)};f=a[0]}return e.nodeName&&"CANVAS"===e.nodeName.toUpperCase()?q(e,f):c(e,f)}},{"./util/extend":24}],9:[function(e,h,l){h.exports=function(c){return{primitive:[4],count:[-1],offset:[0],instances:[0]}}},{}],10:[function(e,h,l){function c(a,c){this.id=b++;this.func=a;this.data=c}function q(a,b){switch(typeof a){case "boolean":case "number":case "string":return new c(!1,a);case "function":return new c(!0,a);default:return q}}var b=0;h.exports={define:q,isDynamic:function(a){return"function"===
typeof a&&!a._reglType||a instanceof c},unbox:function(a,b){return a instanceof c?a:"function"===typeof a&&a!==q?new c(!0,a):new c(!1,b)}}},{}],11:[function(e,h,l){var c=e("./util/is-typed-array"),q=e("./util/is-ndarray"),b=e("./constants/primitives.json");h.exports=function(a,e,f){function h(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}h.prototype.bind=function(){this.buffer.bind()};return{create:function(a){function l(a){var f=e.oes_element_index_uint;if(a)if("number"===typeof a)t(a);
else{var d=null,p="static",n=0;Array.isArray(a)||c(a)||q(a)?d=a:("data"in a&&(d=a.data),"usage"in a&&(p=a.usage),"length"in a&&(n=a.length));Array.isArray(d)||q(d)&&"array"===d.dtype||"type"in a?t({type:a.type||(f?"uint32":"uint16"),usage:p,data:d,length:n}):t({usage:p,data:d,length:n});if(Array.isArray(d)||c(d))t.dimension=3}else t();f=y.buffer.byteLength;d=0;switch(y.buffer.dtype){case 5121:case 5120:d=5121;break;case 5123:case 5122:d=5123;f>>=1;break;case 5125:case 5124:d=5125,f>>=2}p=4;n=y.buffer.dimension;
1===n&&(p=0);2===n&&(p=1);3===n&&(p=4);"object"===typeof a&&("primitive"in a&&(p=b[a.primitive]),"count"in a&&(f=a.vertCount|0));y.primType=p;y.vertCount=f;y.type=d;return l}var y=new h,t=f.create(null,34963,!0);y.buffer=t._buffer;l(a);l._reglType="elements";l._elements=y;l.destroy=function(){t.destroy();y.buffer=null};return l},elements:[null],getElements:function(a){return a&&a._elements instanceof h?a._elements:null}}}},{"./constants/primitives.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26}],
12:[function(e,h,l){h.exports=function(c){function e(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{b[a]=
c.getExtension(a)}catch(e){}})}var b={};e();return{extensions:b,refresh:e}}},{}],13:[function(e,h,l){var c=e("./util/values"),q=e("./util/extend"),b=[1029];h.exports=function(a,e,f,h,n){function l(a,b,d,c){this.target=a;this.level=b;this.texture=d;this.renderbuffer=c}function y(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function t(a,b){var d=b.width,c=b.height;if(a.texture)var g=a.texture._texture,e=Math.max(1,g.params.width>>a.level),f=Math.max(1,
g.params.height>>a.level),d=d||e,c=c||f;else g=a.renderbuffer._renderbuffer,d=d||g.width,c=c||g.height;g.refCount+=1;b.width=d;b.height=c}function g(b,d){d?d.texture?a.framebufferTexture2D(36160,b,d.target,d.texture._texture.texture,d.level):a.framebufferRenderbuffer(36160,b,36161,d.renderbuffer._renderbuffer.renderbuffer):a.framebufferTexture2D(36160,b,3553,null,0)}function v(a){var b=3553,d=0,c=null,g=null;"object"===typeof a&&("level"in a&&(d=a.level|0),"target"in a&&(b=a.target|0));var e=a._reglType;
"texture"===e?c=a:"renderbuffer"===e&&(g=a,b=36161,d=0);return new l(b,d,c,g)}function d(a){return a&&(a.texture||a.renderbuffer)}function p(){this.id=X++;ja[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function u(b){a.isFramebuffer(b.framebuffer)||(b.framebuffer=a.createFramebuffer());I=!0;a.bindFramebuffer(36160,b.framebuffer);for(var d=b.colorAttachments,
c=0;c<d.length;++c)g(36064+c,d[c]);for(c=d.length;c<f.maxColorAttachments;++c)g(36064+c,null);g(36096,b.depthAttachment);g(36128,b.stencilAttachment);g(33306,b.depthStencilAttachment);e.webgl_draw_buffers&&e.webgl_draw_buffers.drawBuffersWEBGL(ka[d.length]);a.checkFramebufferStatus(36160)}function E(b){b=b.framebuffer;a.isFramebuffer(b)&&a.deleteFramebuffer(b)}function B(){return V[V.length-1]}var Q={rgba:6408},w={rgba4:32854,rgb565:36194,"rgb5 a1":32855};e.ext_srgb&&(w.srgba=35907);e.ext_color_buffer_half_float&&
(w.rgba16f=34842,w.rgb16f=34843);e.webgl_color_buffer_float&&(w.rgba32f=34836);var U=[],P=[];e.webgl_depth_texture&&(U.push(6402),P.push(34041));q(q({},Q),w);c(Q);c(w);w=5121;U={uint8:5121};e.oes_texture_half_float&&(w=U["half float"]=36193);e.oes_texture_float&&(w=U["float"]=5126);U.best=w;var ka=function(){for(var a=Array(f.maxDrawbuffers),b=0;b<=f.maxDrawbuffers;++b)for(var d=a[b]=Array(b),c=0;c<b;++c)d[c]=36064+c;return a}(),X=0,ja={},V=[null],I=!0;return{top:B,dirty:function(){return I},push:function(a){a=
a||null;I=I||a!==B();V.push(a);return I},pop:function(){var a=B();V.pop();return I=I||a!==B()},getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof p)?a:null},poll:function(){if(I){var d=V[V.length-1],c=e.webgl_draw_buffers;d?(a.bindFramebuffer(36160,d.framebuffer),c&&c.drawBuffersWEBGL(ka[d.colorAttachments.length])):(a.bindFramebuffer(36160,null),c&&c.drawBuffersWEBGL(b));I=!1}},create:function(b){function c(b){var e,f=b||{},p=b=0;if("shape"in
f){var q=f.shape;b=q[0];p=q[1]}else"radius"in f&&(b=p=f.radius),"width"in f&&(b=f.width),"height"in f&&(p=f.height);var m=null,q=!1;if("colorBuffers"in f||"colorBuffer"in f){m=f.colorBuffers||f.colorBuffer;Array.isArray(m)||(m=[m]);g.width=b;g.height=p;m=m.map(v);for(e=0;e<m.length;++e)t(m[e],g);b=g.width;p=g.height}else{var E=!0,B="rgba",r="uint8",k=1,q=!0;g.width=b=b||a.drawingBufferWidth;g.height=p=p||a.drawingBufferHeight;"format"in f&&(B=f.format,E=B in Q);"type"in f&&(r=f.type);"colorCount"in
f&&(k=f.colorCount|0);if(g.ownsColor)for(m=g.colorAttachments;m.length>k;)y(m.pop());else m=[];for(e=0;e<m.length;++e){var L;a:{L=m[e];var D=E,w=B,x=b,z=p;if(L.texture){var O=L.texture;if(D){O({format:w,type:r,width:x,height:z});O._texture.refCount+=1;L=!0;break a}}else if(O=L.renderbuffer,!D){O({format:w,width:x,height:z});O._renderbuffer.refCount+=1;L=!0;break a}y(L);L=!1}L||(m[e--]=m[m.length-1],m.pop())}for(;m.length<k;)E?m.push(new l(3553,0,h.create({format:B,type:r,width:b,height:p},3553),null)):
m.push(new l(36161,0,null,n.create({format:B,width:b,height:p})))}g.width=b;g.height=p;B=E=e=null;r=!1;"depthBuffer"in f&&(e=v(f.depthBuffer));"stencilBuffer"in f&&(E=v(f.stencilBuffer));"depthStencilBuffer"in f&&(B=v(f.depthStencilBuffer));if(e||E||B)t(e||E||B,g);else if(k=!0,D=L=!1,"depth"in f&&(k=!!f.depth),"stencil"in f&&(L=!!f.stencil),"depthTexture"in f&&(D=!!f.depthTexture),f=g.depthAttachment||g.stencilAttachment||g.depthStencilAttachment,w=null,k||L)r=!0,D?(D=L?"depth stencil":"depth",g.ownsDepthStencil&&
f.texture?(f.texture({format:D,width:b,height:p}),f.texture._texture.refCount+=1,w=f):w=new l(3553,0,h.create({format:D,width:b,height:p},3553),null)):(D=k?L?"depth stencil":"depth":"stencil",g.ownsDepthStencil&&f.renderbuffer?(f.renderbuffer({format:D,width:b,height:p}),f.renderbuffer._renderbuffer.refCount+=1,w=f):w=new l(36161,0,null,n.create({format:D,width:b,height:p}))),k?L?B=w:e=w:E=w;b=g;b.colorAttachments.forEach(y);y(b.depthAttachment);y(b.stencilAttachment);y(b.depthStencilAttachment);
g.colorAttachments=m;g.depthAttachment=e;g.stencilAttachment=E;g.depthStencilAttachment=B;g.ownsColor=q;g.ownsDepthStencil=r;c.color=m.map(d);c.depth=d(e);c.stencil=d(E);c.depthStencil=d(B);u(g);c.width=g.width;c.height=g.height;return c}var g=new p;c(b);c._reglType="framebuffer";c._framebuffer=g;c._destroy=function(){E(g)};return c},clear:function(){c(ja).forEach(E)},refresh:function(){c(ja).forEach(u)}}}},{"./util/extend":24,"./util/values":32}],14:[function(e,h,l){h.exports=function(c,e){var b=
1;e.ext_texture_filter_anisotropic&&(b=c.getParameter(34047));var a=1,h=1;e.webgl_draw_buffers&&(a=c.getParameter(34852),h=c.getParameter(36063));return{colorBits:[c.getParameter(3410),c.getParameter(3411),c.getParameter(3412),c.getParameter(3413)],depthBits:c.getParameter(3414),stencilBits:c.getParameter(3415),subpixelBits:c.getParameter(3408),extensions:Object.keys(e).filter(function(a){return!!e[a]}),maxAnisotropic:b,maxDrawbuffers:a,maxColorAttachments:h,pointSizeDims:c.getParameter(33901),lineWidthDims:c.getParameter(33902),
maxViewportDims:c.getParameter(3386),maxCombinedTextureUnits:c.getParameter(35661),maxCubeMapSize:c.getParameter(34076),maxRenderbufferSize:c.getParameter(34024),maxTextureUnits:c.getParameter(34930),maxTextureSize:c.getParameter(3379),maxAttributes:c.getParameter(34921),maxVertexUniforms:c.getParameter(36347),maxVertexTextureUnits:c.getParameter(35660),maxVaryingVectors:c.getParameter(36348),maxFragmentUniforms:c.getParameter(36349),glsl:c.getParameter(35724),renderer:c.getParameter(7937),vendor:c.getParameter(7936),
version:c.getParameter(7938)}}},{}],15:[function(e,h,l){var c=e("./util/is-typed-array");h.exports=function(e,b,a){return function(h){var f=h||{};c(h)?f={data:f}:2===arguments.length?f={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof h&&(f={});b();var A=f.x||0,n=f.y||0,l=f.width||a.width,y=f.height||a.height,f=f.data||new Uint8Array(l*y*4);e.pixelStorei(3333,4);e.readPixels(A,n,l,y,6408,5121,f);return f}}},{"./util/is-typed-array":26}],16:[function(e,h,l){var c=e("./util/values");h.exports=
function(e,b,a){function h(){this.id=H++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function f(a){e.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=e.createRenderbuffer());e.bindRenderbuffer(36161,a.renderbuffer);e.renderbufferStorage(36161,a.format,a.width,a.height)}function l(a){var b=a.renderbuffer;e.bindRenderbuffer(36161,null);e.isRenderbuffer(b)&&e.deleteRenderbuffer(b);a.renderbuffer=null;a.refCount=0;delete y[a.id]}var n={rgba4:32854,rgb565:36194,"rgb5 a1":32855,
depth:33189,stencil:36168,"depth stencil":34041};b.ext_srgb&&(n.srgba=35907);b.ext_color_buffer_half_float&&(n.rgba16f=34842,n.rgb16f=34843);b.webgl_color_buffer_float&&(n.rgba32f=34836);var H=0,y={};h.prototype.decRef=function(){0===--this.refCount&&l(this)};return{create:function(a){function b(a){a=a||{};var e=0,h=0;"shape"in a?(h=a.shape,e=h[0]|0,h=h[1]|0):("radius"in a&&(e=h=a.radius|0),"width"in a&&(e=a.width|0),"height"in a&&(h=a.height|0));b.width=c.width=Math.max(e,1);b.height=c.height=Math.max(h,
1);c.format=32854;"format"in a&&(c.format=n[a.format]);f(c);return b}var c=new h;y[c.id]=c;b(a);b._reglType="renderbuffer";b._renderbuffer=c;b.destroy=function(){c.decRef()};return b},refresh:function(){c(y).forEach(f)},clear:function(){c(y).forEach(l)}}}},{"./util/values":32}],17:[function(e,h,l){function c(b,a,c,e){this.name=b;this.id=a;this.location=c;this.info=e}var q=e("./util/values");h.exports=function(b,a,e,f,h){function n(a,d){var c=35632===a?t:g,e=c[d];if(!e){var f=h.str(d),e=b.createShader(a);
b.shaderSource(e,f);b.compileShader(e);c[d]=e}return e}function l(a,b){this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];this.draw=function(){};this.batchCache={}}function y(d){var g,q;g=n(35632,d.fragId);q=n(35633,d.vertId);var l=d.program=b.createProgram();b.attachShader(l,g);b.attachShader(l,q);b.linkProgram(l);var v=b.getProgramParameter(l,35718),t=d.uniforms=[];for(g=0;g<v;++g)if(q=b.getActiveUniform(l,g))if(1<q.size)for(var y=0;y<q.size;++y){var H=q.name.replace("[0]",
"["+y+"]");e.def(H);t.push(new c(H,h.id(H),b.getUniformLocation(l,H),q))}else e.def(q.name),t.push(new c(q.name,h.id(q.name),b.getUniformLocation(l,q.name),q));v=b.getProgramParameter(l,35721);t=d.attributes=[];for(g=0;g<v;++g)if(q=b.getActiveAttrib(l,g))a.def(q.name),t.push(new c(q.name,h.id(q.name),b.getAttribLocation(l,q.name),q));d.draw=f(d);d.batchCache={}}var t={},g={},v={},d=[];return{clear:function(){var a=b.deleteShader.bind(b);q(t).forEach(a);t={};q(g).forEach(a);g={};d.forEach(function(a){b.deleteProgram(a.program)});
d.length=0;v={}},refresh:function(){t={};g={};d.forEach(y)},program:function(a,b){var c=v[b];c||(c=v[b]={});var g=c[a];g||(g=new l(b,a),y(g),c[a]=g,d.push(g));return g},shader:n,frag:[-1],vert:[-1]}}},{"./util/values":32}],18:[function(e,h,l){var c=e("./util/stack"),q=e("./util/codegen");h.exports=function(b,a,e){function f(a,e){var d=c([!!e],function(d){d?b.enable(a):b.disable(a)});d.flag=a;return d}var h={dither:f(3024),"blend.enable":f(3042),"blend.color":c([0,0,0,0],function(a,c,d,e){b.blendColor(a,
c,d,e)}),"blend.equation":c([32774,32774],function(a,c){b.blendEquationSeparate(a,c)}),"blend.func":c([1,0,1,0],function(a,c,d,e){b.blendFuncSeparate(a,c,d,e)}),"depth.enable":f(2929,!0),"depth.func":c([513],function(a){b.depthFunc(a)}),"depth.range":c([0,1],function(a,c){b.depthRange(a,c)}),"depth.mask":c([!0],function(a){b.depthMask(a)}),"cull.enable":f(2884),"cull.face":c([1029],function(a){b.cullFace(a)}),frontFace:c([2305],function(a){b.frontFace(a)}),colorMask:c([!0,!0,!0,!0],function(a,c,d,
e){b.colorMask(a,c,d,e)}),lineWidth:c([1],function(a){b.lineWidth(a)}),"polygonOffset.enable":f(32823),"polygonOffset.offset":c([0,0],function(a,c){b.polygonOffset(a,c)}),"sample.alpha":f(32926),"sample.enable":f(32928),"sample.coverage":c([1,!1],function(a,c){b.sampleCoverage(a,c)}),"stencil.enable":f(2960),"stencil.mask":c([-1],function(a){b.stencilMask(a)}),"stencil.func":c([519,0,-1],function(a,c,d){b.stencilFunc(a,c,d)}),"stencil.opFront":c([7680,7680,7680],function(a,c,d){b.stencilOpSeparate(1028,
a,c,d)}),"stencil.opBack":c([7680,7680,7680],function(a,c,d){b.stencilOpSeparate(1029,a,c,d)}),"scissor.enable":f(3089),"scissor.box":c([0,0,-1,-1],function(c,e,d,f){var h=d,n=a.top();0>d&&(h=n?n.width-c:b.drawingBufferWidth-c);d=f;0>f&&(d=n?n.height-e:b.drawingBufferHeight-e);b.scissor(c,e,h,d)}),viewport:c([0,0,-1,-1],function(c,f,d,h){var n=d,q=a.top();0>d&&(n=q?q.width-c:b.drawingBufferWidth-c);d=h;0>h&&(d=q?q.height-f:b.drawingBufferHeight-f);b.viewport(c,f,n,d);e.width=n;e.height=d})},n=q(),
l=n.proc("poll"),y=n.proc("refresh");Object.keys(h).forEach(function(a){a=n.link(h[a]);l(a,".poll();");y(a,".setDirty();")});var t=n.compile();return{contextState:h,viewport:e,poll:t.poll,refresh:t.refresh,notifyViewportChanged:function(){h.viewport.setDirty();h["scissor.box"].setDirty()}}}},{"./util/codegen":23,"./util/stack":30}],19:[function(e,h,l){h.exports=function(){var c={"":0},e=[""];return{id:function(b){var a=c[b];if(a)return a;a=c[b]=e.length;e.push(b);return a},str:function(b){return e[b]}}}},
{}],20:[function(e,h,l){function c(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function q(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,e=1;e<b;++e)if(!Array.isArray(a[e])||a[e].length!==c)return!1;return!0}function b(a){return Object.prototype.toString.call(a)}function a(a){return"[object HTMLCanvasElement]"===b(a)}function L(a){return"[object CanvasRenderingContext2D]"===b(a)}var f=e("./util/extend"),A=e("./util/values"),
n=e("./util/is-typed-array"),H=e("./util/is-ndarray"),y=e("./util/load-texture"),t=e("./util/to-half-float"),g=e("./util/parse-dds"),v=[9984,9986,9985,9987];h.exports=function(d,e,h,l,B){function Q(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=this.miplevel=0;this.copy=!1;this.crossOrigin=
this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function w(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function U(a,b){var d,c,e=0,f=0,g=0,h=0,n=0,q=0,k=!1,m=!1,l=!1;for(d=0;d<b.length;++d)c=b[d],h=h||c.width<<c.miplevel,n=n||c.height<<c.miplevel,e=e||c.type,f=f||c.format,g=g||c.internalformat,
q=q||c.channels,k=k||c.needsPoll,m=m||c.needsListeners,c=c.miplevel,l=l||0<c;a.needsPoll=k;a.needsListeners=m;a.width=h;a.height=n;a.format=f;a.internalformat=g;a.type=e;if(3553!==a.target)for(d=0;6>d;++d);d=0<=v.indexOf(a.minFilter);a.genMipmaps=!l&&(a.genMipmaps||d);l=l||a.genMipmaps;a.minFilter||(a.minFilter=l?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(d=0;d<b.length;++d)c=b[d],c.channels||(c.channels=q),c.format||(c.format=f),c.internalformat||(c.internalformat=g),c.type||(c.type=
e)}function P(a){this.id=k++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new w(a);this.pixels=[]}function ka(a,b){function d(a,c){var e=c.mipmap,g;if(Array.isArray(e))for(var z=0;z<e.length;++z)g=new Q(a),g.parseFlags(b),g.parseFlags(c),g.parse(e[z],z),f.push(g);else g=new Q(a),g.parseFlags(b),g.parse(c,0),f.push(g)}var c;V(a);var e=a.params;w.call(e,a.target);var f=a.pixels;f.length=0;e.parse(b);if(3553===a.target)d(3553,
b);else{var g=b.faces||b;if(Array.isArray(g))for(c=0;6>c;++c)d(34069+c,g[c]);else if("string"!==typeof g)for(c=0;6>c;++c)d(34069+c,{})}U(e,f);e.needsListeners&&ja(a);e.needsPoll&&(a.pollId=D.length,D.push(a));X(a)}function X(a){d.isTexture(a.texture)||(a.texture=d.createTexture());var b=a.target,c=a.unit;0<=c?(d.activeTexture(33984+c),r=c):d.bindTexture(b,a.texture);for(var b=a.pixels,e=a.params,f=0;f<b.length;++f)b[f].upload(e);e.upload();0>c&&((c=x[r])?d.bindTexture(c.target,c.texture):(a.unit=
r,x[r]=a))}function ja(a){function b(a,d,c){var f=g(c);f.pixels.forEach(function(b){var c=new Q(f.cube?b.target:a);c.channels=f.channels;c.compressed=f.compressed;c.type=f.type;c.internalformat=f.format;c.format=ia[f.format];c.width=b.width;c.height=b.height;c.miplevel=b.miplevel||d;c.data=b.data;e.push(c)})}function d(){for(var f=0;f<e.length;++f){var g=e[f],h=g.image,n=g.video,G=g.xhr;h&&h.complete?(g.width=h.naturalWidth,g.height=h.naturalHeight):n&&2<n.readyState?(g.width=n.width,g.height=n.height):
G&&4===G.readyState&&(e[f]=e[e.length-1],e.pop(),G.removeEventListener("readystatechange",X),b(g.target,g.miplevel,G.response))}U(c,e);X(a)}var c=a.params,e=a.pixels;e.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",d):a.video&&1>a.readyState?a.video.addEventListener("progress",d):a.xhr&&a.xhr.addEventListener("readystatechange",d)});a.cancelPending=function(){e.forEach(function(a){a.image?a.image.removeEventListener("load",d):a.video?a.video.removeEventListener("progress",
d):a.xhr&&(a.xhr.removeEventListener("readystatechange",d),a.xhr.abort())})}}function V(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((D[b]=D[D.length-1]).id=b,D.pop(),a.pollId=-1)}function I(a){var b=a.texture,c=a.unit,e=a.target;0<=c&&(d.activeTexture(33984+c),r=c,d.bindTexture(e,null),x[c]=null);V(a);d.isTexture(b)&&d.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete ca[a.id]}var m={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
R={repeat:10497,clamp:33071,mirror:33648},ga={nearest:9728,linear:9729},N=f({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ga),aa={none:0,browser:37444},S={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},T={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Y={};e.ext_srgb&&(T.srgb=35904,T.srgba=35906);e.oes_texture_float&&(S["float"]=5126);e.oes_texture_half_float&&
(S["half float"]=36193);e.webgl_depth_texture&&(f(T,{depth:6402,"depth stencil":34041}),f(S,{uint16:5123,uint32:5125,"depth stencil":34042}));e.webgl_compressed_texture_s3tc&&f(Y,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});e.webgl_compressed_texture_atc&&f(Y,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});e.webgl_compressed_texture_pvrtc&&f(Y,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});e.webgl_compressed_texture_etc1&&(Y["rgb etc1"]=36196);var ha=Array.prototype.slice.call(d.getParameter(34467));Object.keys(Y).forEach(function(a){var b=Y[a];0<=ha.indexOf(b)&&(T[a]=b)});var oa=Object.keys(T);h.textureFormats=oa;var ia=oa.reduce(function(a,b){var d=T[b];6409===d||6406===d||6409===d||6410===d||6402===d||34041===d?a[d]=d:32855===d||0<=b.indexOf("rgba")?a[d]=6408:a[d]=6407;return a},{});f(Q.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=aa[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=T[b];b in S&&(this.type=S[b]);b in Y&&(this.compressed=!0)}"type"in a&&(this.type=S[a.type]);var b=this.width,d=this.height,c=this.channels;"shape"in a?(b=a.shape[0],d=a.shape[1],3===a.shape.length&&(c=a.shape[2])):("radius"in a&&(b=d=a.radius),"width"in a&&(b=a.width),
"height"in a&&(d=a.height),"channels"in a&&(c=a.channels));this.width=b|0;this.height=d|0;this.channels=c|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*c,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(d,e){this.miplevel=e;this.width>>=e;this.height>>=e;var f=d;switch(typeof d){case "object":if(!d)return;
this.parseFlags(d);var g=d.data;if("string"===typeof g||g&&(n(g)||c(g)||H(g)||a(g)||L(g)||"[object HTMLImageElement]"===b(g)||"[object HTMLVideoElement]"===b(g)||q(g)))f=d.data;break;case "undefined":return}"string"===typeof f&&(f=y(f,this.crossOrigin));var g=null,h=!1;if(null!==f)if(n(f))this.data=f;else if(c(f))g=f,h=!0;else if(H(f)){Array.isArray(f.data)?(g=f.data,h=!0):this.data=f.data;var k=f.shape;this.width=k[0];this.height=k[1];this.channels=3===k.length?k[2]:1;k=f.stride;this.strideX=f.stride[0];
this.strideY=f.stride[1];this.strideC=3===k.length?f.stride[2]:1;this.offset=f.offset;this.needsTranspose=!0}else if(a(f)||L(f))a(f)?this.canvas=f:this.canvas=f.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===b(f))this.image=f,f.complete?(this.width=f.naturalWidth,this.height=f.naturalHeight):(this.width=this.width||f.naturalWidth,this.height=this.height||f.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===b(f))this.video=f,1<f.readyState?(this.width=f.width,this.height=f.height):(this.width=this.width||f.width,this.height=this.height||f.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===b(f))this.xhr=f,this.needsListeners=!0;else if(q(f)){var h=f[0].length,k=f.length,m=1,l,p,A,r;if(Array.isArray(f[0][0]))for(m=f[0][0].length,g=Array(h*k*m),p=r=0;p<k;++p)for(l=0;l<h;++l)for(A=0;A<m;++A)g[r++]=f[p][l][A];
else for(g=Array(h*k),p=r=0;p<k;++p)for(l=0;l<h;++l)g[r++]=f[p][l];this.width=h;this.height=k;this.channels=m;h=!0}else d.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||B.width)|0,this.height=(this.height||B.height)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=[6409,
6410,6407,6408][(this.channels=this.channels||4)-1]);f=this.internalformat;k=this.format=ia[f];if(!this.channels)switch(k){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}k=this.type;5126!==k&&36193!==k&&(k||(k=6402===f?5125:5121));this.type=k;if(h)switch(k){case 5121:this.data=new Uint8Array(g);break;case 5123:this.data=new Uint16Array(g);break;case 5125:this.data=new Uint32Array(g);break;case 5126:this.data=
new Float32Array(g);break;case 36193:this.data=t(g)}if(this.data&&this.needsTranspose){g=this.data;f=this.width;h=this.height;k=this.channels;m=this.strideX;l=this.strideY;p=this.strideC;A=this.offset;r=new g.constructor(f*h*k);for(var u=0,v=0;v<h;++v)for(var w=0;w<f;++w)for(var x=0;x<k;++x)r[u++]=g[l*v+m*w+p*x+A];this.data=r}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){d.pixelStorei(37440,
this.flipY);d.pixelStorei(37441,this.premultiplyAlpha);d.pixelStorei(37443,this.colorSpace);d.pixelStorei(3317,this.unpackAlignment);var b=this.target,c=this.miplevel,f=this.image,e=this.canvas,g=this.video,h=this.data,n=this.internalformat,k=this.format,q=this.type,m=this.width||Math.max(1,a.width>>c);a=this.height||Math.max(1,a.height>>c);g&&2<g.readyState?d.texImage2D(b,c,k,k,q,g):f&&f.complete?d.texImage2D(b,c,k,k,q,f):e?d.texImage2D(b,c,k,k,q,e):this.compressed?d.compressedTexImage2D(b,c,n,m,
a,0,h):this.copy?(l(),d.copyTexImage2D(b,c,k,this.x,this.y,m,a,0)):h?d.texImage2D(b,c,k,m,a,0,k,q,h):d.texImage2D(b,c,k,m||1,a||1,0,k,q,null)}});f(w.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=N[a.min]);"mag"in a&&(this.magFilter=ga[a.mag]);var b=this.wrapS,d=this.wrapT;if("wrap"in a){var c=a.wrap;"string"===typeof c?b=d=R[c]:Array.isArray(c)&&(b=R[c[0]],d=R[c[1]])}else"wrapS"in a&&(b=R[a.wrapS]),"wrapT"in a&&(d=R[a.wrapT]);this.wrapS=b;this.wrapT=d;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=m[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;d.texParameteri(a,10241,this.minFilter);d.texParameteri(a,10240,this.magFilter);d.texParameteri(a,10242,this.wrapS);d.texParameteri(a,10243,this.wrapT);e.ext_texture_filter_anisotropic&&d.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(d.hint(33170,this.mipmapHint),d.generateMipmap(a))}});
var r=0,k=0,ca={},D=[],M=h.maxTextureUnits,x=Array(M).map(function(){return null});f(P.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<M;++b){var c=x[b];if(c){if(0<c.bindCount)continue;c.unit=-1}x[b]=this;a=b;break}this.unit=a;d.activeTexture(33984+a);d.bindTexture(this.target,this.texture);r=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&I(this)}});return{create:function(a,b){function d(a,f,e,g,h,k){var n=a||{};34067===b&&
6===arguments.length&&(n=[a,f,e,g,h,k]);ka(c,n);d.width=c.params.width;d.height=c.params.height;return d}var c=new P(b);ca[c.id]=c;d(a);d._reglType="texture";d._texture=c;d.destroy=function(){c.decRef()};return d},refresh:function(){A(ca).forEach(X);for(var a=0;a<M;++a)x[a]=null;r=0;d.activeTexture(33984)},clear:function(){for(var a=0;a<M;++a)d.activeTexture(33984+a),d.bindTexture(3553,null),x[a]=null;d.activeTexture(33984);r=0;A(ca).forEach(I)},poll:function(){D.forEach(X)},getTexture:function(a){return null}}}},
{"./util/extend":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/load-texture":27,"./util/parse-dds":28,"./util/to-half-float":31,"./util/values":32}],21:[function(e,h,l){h.exports=function(c){var e={};return{def:function(b){b=c.id(b);var a=e[b];a||(a=e[b]=[]);return a},uniforms:e}}},{}],22:[function(e,h,l){h.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],23:[function(e,h,l){var c=e("./extend");h.exports=
function(){function e(){var a=[],f=[];return c(function(){a.push.apply(a,Array.prototype.slice.call(arguments))},{def:function(){var c="v"+b++;f.push(c);0<arguments.length&&(a.push(c,"="),a.push.apply(a,Array.prototype.slice.call(arguments)),a.push(";"));return c},toString:function(){return[0<f.length?"var "+f+";":"",a.join("")].join("")}})}var b=0,a=[],h=[],f={};return{link:function(c){var f="g"+b++;a.push(f);h.push(c);return f},block:e,proc:function(a){var h=[],l=e(),y=l.toString;return f[a]=c(l,
{arg:function(){var a="a"+b++;h.push(a);return a},toString:function(){return["function(",h.join(),"){",y(),"}"].join("")}})},compile:function(){var b=['"use strict";return {'];Object.keys(f).forEach(function(a){b.push('"',a,'":',f[a].toString(),",")});b.push("}");return Function.apply(null,a.concat([b.join("")])).apply(null,h)}}}},{"./extend":24}],24:[function(e,h,l){h.exports=function(c,e){for(var b=Object.keys(e),a=0;a<b.length;++a)c[b[a]]=e[b[a]];return c}},{}],25:[function(e,h,l){var c=e("./is-typed-array");
h.exports=function(e){return"object"===typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"===typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||c(e.data))}},{"./is-typed-array":26}],26:[function(e,h,l){var c=e("../constants/arraytypes.json");h.exports=function(e){return Object.prototype.toString.call(e)in c}},{"../constants/arraytypes.json":5}],27:[function(e,h,l){h.exports=function(c,e){if("undefined"!==typeof document){var b;b=(b=/\.(\w+)(\?.*)?$/.exec(c))&&
b[1]?b[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(b))return b=document.createElement("video"),b.autoplay=!0,b.loop=!0,e&&(b.crossOrigin=e),b.src=c,b;if(0<=["dds"].indexOf(b))return b=new XMLHttpRequest,b.responseType="arraybuffer",b.open("GET",c,!0),b.send(),b;b=new Image;e&&(b.crossOrigin=e);b.src=c;return b}return null}},{}],28:[function(e,h,l){h.exports=function(e){function h(a){for(var b=m,d=R,c=0;c<T;++c){var f=Math.max(1,
b+3>>2)*Math.max(1,d+3>>2)*aa;ha.pixels.push({target:a,miplevel:c,width:b,height:d,data:new Uint8Array(e,Y,f)});Y+=f;b>>=1;d>>=1}}var l=new Int32Array(e),I=l[E],m=l[Q],R=l[B],ga=n,N=0,aa=0,S=4;switch(l[P]){case g:aa=8;I&t?(S=3,N=b):N=a;break;case v:aa=16;N=L;break;case d:aa=16;N=f;break;case p:aa=8,N=A}var T=1;l[U]&H&&(T=Math.max(1,l[w]));var Y=l[u]+4,ha={width:m,height:R,channels:S,format:N,type:ga,compressed:!0,cube:!1,pixels:[]};if(l[ka]&y)for(ha.cube=!0,l=0;6>l;++l)h(q+l);else h(c);return ha};
var c=3553,q=34069,b=33776,a=33777,L=33778,f=33779,A=36196,n=5121,H=131072,y=512,t=64,g=827611204,v=861165636,d=894720068,p=826496069,u=1,E=2,B=3,Q=4,w=7,U=20,P=21,ka=28},{}],29:[function(e,h,l){h.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(c){return requestAnimationFrame(c)},cancel:function(c){return cancelAnimationFrame(c)}}:{next:function(c){setTimeout(c,30)},cancel:clearTimeout}},{}],30:[function(e,h,l){h.exports=function(c,e){var b=
c.length,a=c.slice(),h=c.slice(),f=!1,l=!0;return{push:function(){f=!1;for(var c=0;c<b;++c){var e=arguments[c];f=f||e!==h[c];a.push(e)}},pop:function(){f=!1;a.length-=b;for(var c=0;c<b;++c)f=f||a[a.length-b+c]!==h[c]},poll:function(){var c=a.length-b;if(f||l){switch(b){case 1:e(a[c]);break;case 2:e(a[c],a[c+1]);break;case 3:e(a[c],a[c+1],a[c+2]);break;case 4:e(a[c],a[c+1],a[c+2],a[c+3]);break;case 5:e(a[c],a[c+1],a[c+2],a[c+3],a[c+4]);break;case 6:e(a[c],a[c+1],a[c+2],a[c+3],a[c+4],a[c+5]);break;
default:e.apply(null,a.slice(c,a.length))}for(var H=0;H<b;++H)h[H]=a[c+H];l=f=!1}},setDirty:function(){l=!0}}}},{}],31:[function(e,h,l){h.exports=function(c){for(var e=new Float32Array(c),e=new Uint32Array(e.buffer),b=new Uint16Array(c.length),a=0;a<c.length;++a)if(isNaN(c[a]))b[a]=65535;else if(Infinity===c[a])b[a]=31744;else if(-Infinity===c[a])b[a]=64512;else{var h=e[a],f=h>>>31<<15,l=(h<<1>>>24)-127,h=h>>13&1023;b[a]=-24>l?f:-14>l?f+(h+1024>>-14-l):15<l?f+31744:f+(l+15<<10)+h}return b}},{}],32:[function(e,
h,l){h.exports=function(c){return Object.keys(c).map(function(e){return c[e]})}},{}],33:[function(e,h,l){var c=e("./lib/util/extend"),q=e("./lib/context"),b=e("./lib/strings"),a=e("./lib/extension"),L=e("./lib/limits"),f=e("./lib/buffer"),A=e("./lib/elements"),n=e("./lib/texture"),H=e("./lib/renderbuffer"),y=e("./lib/framebuffer"),t=e("./lib/uniform"),g=e("./lib/attribute"),v=e("./lib/shader"),d=e("./lib/draw"),p=e("./lib/state"),u=e("./lib/compile"),E=e("./lib/read"),B=e("./lib/dynamic"),Q=e("./lib/util/raf"),
w=e("./lib/util/clock");h.exports=function(){function e(){ba=Q.next(e);M.count+=1;if(M.width!==m.drawingBufferWidth||M.height!==m.drawingBufferHeight)M.width=m.drawingBufferWidth,M.height=m.drawingBufferHeight,x.notifyViewportChanged();var a=w();M.dt=a-M.t;M.t=a;k.poll();for(var b=0;b<G.length;++b)(0,G[b])(M.count,M.t,M.dt);M.renderTime=w()-a}function h(){ba&&(Q.cancel(e),ba=0)}function l(a){h();a.preventDefault();if(R.onContextLost)R.onContextLost()}function X(a){m.getError();ga.refresh();T.refresh();
k.refresh();ca.refresh();D.refresh();ia.refresh();x.refresh();if(R.onContextRestored)R.onContextRestored();e()}function ja(a){function b(a){var c={},e={};Object.keys(a).forEach(function(b){var f=a[b];B.isDynamic(f)?(d=!0,e[b]=B.unbox(f,b)):c[b]=f});return{dynamic:e,"static":c}}var d=!1,e=b(a.uniforms||{}),f=b(a.attributes||{});a=b(function(a){function b(a){if(a in d){var c=d[a];delete d[a];Object.keys(c).forEach(function(b){d[a+"."+b]=c[b]})}}var d=c({},a);delete d.uniforms;delete d.attributes;b("blend");
b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return d}(a));var e=z.command(a["static"],e["static"],f["static"],a.dynamic,e.dynamic,f.dynamic,d),g=e.draw,h=e.batch,k=e.scope,l=[];return function(a,b){if("function"===typeof a)return k(null,a);if("function"===typeof b)return k(a,b);if("number"===typeof a){for(var c=a|0;l.length<c;)l.push(null);return h(a|0,l)}return Array.isArray(a)?h(a.length,a):g(a)}}function V(){D.poll();x.poll()}var I=q(Array.prototype.slice.call(arguments)),
m=I.gl,R=I.options,I=b(),ga=a(m),N=ga.extensions,aa={width:m.drawingBufferWidth,height:m.drawingBufferHeight},S=L(m,N),T=f(m),Y=A(m,N,T),ha=t(I),oa=g(m,N,S,T,I),ia=v(m,oa,ha,function(a){return z.draw(a)},I),r=d(m,N,T),k=n(m,N,S,V,aa),ca=H(m,N,S),D=y(m,N,S,k,ca),M={count:0,start:w(),dt:0,t:w(),renderTime:0,width:m.drawingBufferWidth,height:m.drawingBufferHeight,pixelRatio:R.pixelRatio},x=p(m,D,aa),aa=E(m,V,aa),z=u(m,I,N,S,T,Y,k,D,x,ha,oa,ia,r,M,V),O=m.canvas,G=[],ba=0;O&&(O.addEventListener("webglcontextlost",
l,!1),O.addEventListener("webglcontextrestored",X,!1));return c(ja,{clear:function(a){var b=0;V();var c=a.color;c&&(m.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(m.clearDepth(+a.depth),b|=256);"stencil"in a&&(m.clearStencil(a.stencil|0),b|=1024);m.clear(b)},prop:B.define,draw:ja({}),elements:function(a){return Y.create(a)},buffer:function(a){return T.create(a,34962)},texture:function(a){return k.create(a,3553)},cube:function(a){return 6===arguments.length?k.create(Array.prototype.slice.call(arguments),
34067):k.create(a,34067)},renderbuffer:function(a){return ca.create(a)},framebuffer:function(a){return D.create(a)},framebufferCube:function(a){},frame:function(a){G.push(a);!ba&&0<G.length&&e();return{cancel:function(){var b=G.find(function(b){return b===a});0>b||(G.splice(b,1),0>=G.length&&h())}}},stats:M,limits:S,read:aa,destroy:function(){h();O&&(O.removeEventListener("webglcontextlost",l),O.removeEventListener("webglcontextrestored",X));ia.clear();D.clear();ca.clear();k.clear();T.clear();if(R.onDestroy)R.onDestroy()}})}},
{"./lib/attribute":2,"./lib/buffer":3,"./lib/compile":4,"./lib/context":8,"./lib/draw":9,"./lib/dynamic":10,"./lib/elements":11,"./lib/extension":12,"./lib/framebuffer":13,"./lib/limits":14,"./lib/read":15,"./lib/renderbuffer":16,"./lib/shader":17,"./lib/state":18,"./lib/strings":19,"./lib/texture":20,"./lib/uniform":21,"./lib/util/clock":22,"./lib/util/extend":24,"./lib/util/raf":29}]},{},[1]);

        </script>
        </body>
      </html>