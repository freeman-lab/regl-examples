(function e$$0(h,l,b){function c(a,f){if(!l[a]){if(!h[a]){var k="function"==typeof require&&require;if(!f&&k)return k(a,!0);if(e)return e(a,!0);k=Error("Cannot find module '"+a+"'");throw k.code="MODULE_NOT_FOUND",k;}k=l[a]={exports:{}};h[a][0].call(k.exports,function(b){var f=h[a][1][b];return c(f?f:b)},k,k.exports,e$$0,h,l,b)}return l[a].exports}for(var e="function"==typeof require&&require,a=0;a<b.length;a++)c(b[a]);return c})({1:[function(d,h,l){var b=d("../regl")(),c=d("mouse-change")(function(){}),
e=b.texture(),a=b({frag:"\n  precision mediump float;\n  uniform sampler2D texture;\n  uniform vec2 mouse;\n  uniform float t;\n  varying vec2 uv;\n  void main () {\n    float dist = length(gl_FragCoord.xy - mouse);\n    gl_FragColor = vec4(0.98 * texture2D(texture,\n      uv + cos(t) * vec2(0.5 - uv.y, uv.x - 0.5) - sin(2.0 * t) * (uv - 0.5)).rgb, 1) +\n      exp(-0.01 * dist) * vec4(\n        1.0 + cos(2.0 * t),\n        1.0 + cos(2.0 * t + 1.5),\n        1.0 + cos(2.0 * t + 3.0),\n        0.0);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main () {\n    uv = position;\n    gl_Position = vec4(2.0 * position - 1.0, 0, 1);\n  }",attributes:{position:b.buffer([-2,0,0,-2,2,2])},uniforms:{texture:e,mouse:function(a,b,e){a=e.pixelRatio;return[c.x*a,e.height-c.y*a]},t:function(a,b,c){return.01*c.count}},count:3});b.frame(function(){b.clear({color:[0,0,0,1]});a();e({copy:!0})})},{"../regl":36,"mouse-change":34}],2:[function(d,h,l){function b(){this.pointer=
!1;this.w=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}var c=d("./constants/dtypes.json"),e=d("./extend");e(b.prototype,{equals:function(a,b){return this.pointer?a.pointer&&this.buffer===a.buffer&&this.size===b&&this.normalized===a.normalized&&this.type===a.type&&this.offset===a.offset&&this.stride===a.stride&&this.divisor===a.divisor:!a.pointer&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},set:function(a,b){(this.pointer=
a.pointer)?(this.buffer=a.buffer,this.size=b,this.normalized=a.normalized,this.type=a.type,this.offset=a.offset,this.stride=a.stride,this.divisor=a.divisor):(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w)}});h.exports=function(a,q,f,k,A){function d(){for(var a=Array(16),c=0;16>c;++c)a[c]=new b;this.records=a;this.top=0}function h(a){for(var c=a.records,f=a.top;c.length-1<=f;)c.push(new b);return c[++a.top]}var y={};f=f.maxAttributes;for(var n=Array(f),r=0;r<f;++r)n[r]=new b;e(d.prototype,{pushVec:function(a,
b,c,f){var q=h(this);q.pointer=!1;q.x=a;q.y=b;q.z=c;q.w=f},pushPtr:function(a,b,c,f,q,e,n){var k=h(this);k.pointer=!0;k.buffer=a;k.size=b;k.offset=c;k.stride=f;k.divisor=q;k.normalized=e;k.type=n},pushDyn:function(a){if("number"===typeof a)this.pushVec(a,0,0,0);else if(Array.isArray(a))this.pushVec(a[0],a[1],a[2],a[3]);else{var b=k.getBuffer(a),f=0,q=0,e=0,n=0,d=!1,r=5126;b?r=b.dtype:(b=k.getBuffer(a.buffer),f=a.size||0,q=a.stride||0,e=a.offset||0,n=a.divisor||0,d=a.normalized||!1,r=b.dtype,"type"in
a&&(r=c[a.type]));this.pushPtr(b,f,e,q,n,d,r)}},pop:function(){--this.top}});return{bindings:n,bind:function(b,c,f,e){e=f.size||e;if(!c.equals(f,e)){if(f.pointer){c.pointer||a.enableVertexAttribArray(b);c.buffer!==f.buffer&&f.buffer.bind();a.vertexAttribPointer(b,e,f.type,f.normalized,f.stride,f.offset);var n=q.angle_instanced_arrays;n&&n.vertexAttribDivisorANGLE(b,f.divisor)}else c.pointer&&a.disableVertexAttribArray(b),a.vertexAttrib4f(b,f.x,f.y,f.z,f.w);c.set(f,e)}},def:function(a){a=A.id(a);var b=
y[a];b||(b=y[a]=new d);return b}}}},{"./constants/dtypes.json":9,"./extend":15}],3:[function(d,h,l){function b(a,b){switch(a){case 5121:return new Uint8Array(b);case 5123:return new Uint16Array(b);case 5125:return new Uint32Array(b);case 5120:return new Int8Array(b);case 5122:return new Int16Array(b);case 5124:return new Int32Array(b);case 5126:return new Float32Array(b);default:return null}}var c=d("./check"),e=d("./is-typed-array"),a=d("./is-ndarray"),q=d("./constants/arraytypes.json"),f=d("./constants/dtypes.json"),
k=d("./values"),A={"static":35044,dynamic:35048,stream:35040};h.exports=function(d){function h(a,b){this.id=r++;this.buffer=a;this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function y(a){d.isBuffer(a.buffer)||(a.buffer=d.createBuffer());a.bind();d.bufferData(a.type,a.data||a.byteLength,a.usage)}function n(a){var b=a.buffer;c(b,"buffer must not be deleted already");d.isBuffer(b)&&d.deleteBuffer(b);a.buffer=null;delete x[a.id]}var r=0,x={};h.prototype.bind=
function(){d.bindBuffer(this.type,this.buffer)};return{create:function(m,k,r){function J(m){var n=m||{};if(Array.isArray(n)||e(n)||a(n))n={data:n};else if("number"===typeof n)n={length:n|0};else if(null===n||void 0===n)n={};c.type(n,"object","buffer arguments must be an object, a number or an array");"usage"in n?(c.parameter(n.usage,A,"invalid buffer usage"),w.usage=A[n.usage]):w.usage=35044;m=0;"type"in n&&(c.parameter(n.type,f,"invalid buffer type"),m=f[n.type]);var k=n.dimension|0||1,d=0,r=null;
if("data"in n)if(r=n.data,null===r)d=n.length|0;else{if(a(r)){var k=r.shape,d=r.stride,n=r.offset,u=0,H=0,x=0,h=0;1===k.length?(u=k[0],H=1,x=d[0],h=0):2===k.length?(u=k[0],H=k[1],x=d[0],h=d[1]):c.raise("invalid shape");m=m||q[Object.prototype.toString.call(r)]|0||5126;for(var k=H,d=b(m,u*H),r=r.data,Q=0,ja=0;ja<u;++ja)for(var U=0;U<H;++U)d[Q++]=r[x*ja+h*U+n];r=d}else if(Array.isArray(r))if(0<r.length&&Array.isArray(r[0])){k=r[0].length;m=m||5126;n=b(m,r.length*k);d=r;r=k;for(u=h=0;u<d.length;++u)for(x=
d[u],H=0;H<r;++H)n[h++]=x[H];r=n}else m=m||5126,r=b(m,r);else c.isTypedArray(r,"invalid data type buffer data"),m=m||q[Object.prototype.toString.call(r)]|0;d=r.byteLength}else"length"in n&&(d=n.length|0,c.nni(d,"buffer length must be a nonnegative integer"));w.data=r;w.dtype=m||5121;w.byteLength=d;w.dimension=k;y(w);return J}var U=d.createBuffer(),w=new h(U,k);x[w.id]=w;r||J(m);J._reglType="buffer";J._buffer=w;J.destroy=function(){n(w)};return J},clear:function(){k(x).forEach(n)},refresh:function(){k(x).forEach(y)},
getBuffer:function(a){return a&&a._buffer instanceof h?a._buffer:null}}}},{"./check":4,"./constants/arraytypes.json":8,"./constants/dtypes.json":9,"./is-ndarray":18,"./is-typed-array":19,"./values":33}],4:[function(d,h,l){function b(a){a=Error("(regl) "+a);console.error(a);throw a;}function c(a,c){a||b(c)}var e=d("./is-typed-array");d=d("./extend");h.exports=d(c,{raise:b,parameter:function(a,c,f){a in c||b("unknown parameter ("+a+")"+(f?": "+f:"")+". possible values: "+Object.keys(c).join())},type:function(a,
c,f){typeof a!==c&&b("invalid parameter type"+(f?": "+f:"")+". expected "+c+", got "+typeof a)},isTypedArray:function(a,c){e(a)||b("invalid parameter type"+(c?": "+c:"")+". must be a typed array")},nni:function(a,c){0<=a&&(a|0)===a||b("invalid parameter type, ("+a+")"+(c?": "+c:"")+". must be a nonnegative integer")},oneOf:function(a,c,f){0>c.indexOf(a)&&b("invalid value"+(f?": "+f:"")+". must be one of: "+c)},shaderError:function(a,b,f,e){a.getShaderParameter(b,a.COMPILE_STATUS)||(a=a.getShaderInfoLog(b),
c.raise("Error compiling shader:\n"+a))},linkError:function(a,b){if(!a.getProgramParameter(b,a.LINK_STATUS)){var f=a.getProgramInfoLog(b);c.raise("Error linking program:\n"+f)}}})},{"./extend":15,"./is-typed-array":19}],5:[function(d,h,l){h.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],6:[function(d,h,l){var b=d("./extend");h.exports=function(){function c(){var a=[],c=[];return b(function(){a.push.apply(a,Array.prototype.slice.call(arguments))},
{def:function(){var b="v"+e++;c.push(b);0<arguments.length&&(a.push(b,"="),a.push.apply(a,Array.prototype.slice.call(arguments)),a.push(";"));return b},toString:function(){return[0<c.length?"var "+c+";":"",a.join("")].join("")}})}var e=0,a=[],q=[],f={};return{link:function(b){var c="g"+e++;a.push(c);q.push(b);return c},block:c,proc:function(a){var q=[],d=c(),h=d.toString;return f[a]=b(d,{arg:function(){var a="a"+e++;q.push(a);return a},toString:function(){return["function(",q.join(),"){",h(),"}"].join("")}})},
compile:function(){var b=['"use strict";return {'];Object.keys(f).forEach(function(a){b.push('"',a,'":',f[a].toString(),",")});b.push("}");return Function.apply(null,a.concat([b.join("")])).apply(null,q)}}}},{"./extend":15}],7:[function(d,h,l){function b(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function c(a,b,c,f){var e,d=",";switch(b){case 5126:e="1f";break;case 35664:e="2fv";break;
case 35665:e="3fv";break;case 35666:e="4fv";break;case 35670:case 5124:e="1i";break;case 35671:case 35667:e="2iv";break;case 35672:case 35668:e="3iv";break;case 35673:case 35669:e="4iv";break;case 35674:e="Matrix2fv";d=",false,";break;case 35675:e="Matrix3fv";d=",false,";break;case 35676:e="Matrix4fv";d=",false,";break;default:q.raise("unsupported uniform type")}return a+".uniform"+e+"("+c+d+f+");"}function e(a){return a+"["+a+".length-1]"}function a(a,b){return"framebuffer"===a||a<b?-1:a>b?1:0}var q=
d("./check"),f=d("./codegen"),k=d("./constants/primitives.json"),A=d("./constants/dtypes.json"),Q={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},M={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,
"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},y={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};h.exports=function(n,d,x,m,H,u,h,U,w,l,ca,O,aa,ha,ma){function ea(d,m,r,A,H){function h(a){var b=J[a];return b?b:b=J[a]=B(ia[a])}function w(a){var b=a.id,z=T[b];if(z)return z;z=a.func?p.def(B(a.data),"(",O,",",N,",",R,")"):p.def(O,".",a.data);return T[b]=z}function v(a,b){return a.find(function(a){return a.name===
b})}function K(a){return oa&&!(a in m||a in H)}var V=f(),B=V.link,p=V.proc("batch"),F=V.block(),G=p.def,Y=p.arg,g=B(n),I=B(d.program),t=B(ca.bind),R=B(ha),ga=B(U),D=B(aa.count),ka=B(aa.offset),ra=B(aa.instances),W=B(aa.primitive),J={},ba=B(u.elements),D=G(e(D)),ka=G(e(ka)),W=G(e(W)),ba=G(e(ba)),C,L,P=x.angle_instanced_arrays;P&&(C=G(e(ra)),L=B(P));var oa="elements"in m,ra=Y(),Y=Y(),O=G(),N=G(),T={};p(g,".useProgram(",I,");");d.uniforms.forEach(function(a){if(!(a.name in r)){var b=B(a.location),z=
B(l.def(a.name)),z=z+"["+z+".length-1]";a=a.info.type;35678===a||35680===a?(a=G(z+"._texture"),p(c(g,5124,b,a+".bind()")),F(a,".unbind();")):p(c(g,a,b,z))}});d.attributes.forEach(function(a){if(!(A.name in A)){var g=B(ca.def(a.name));p(t,"(",a.location,",",B(ca.bindings[a.location]),",",g,".records[",g,".top]",",",b(a.info.type),");")}});oa||p("if(",ba,"){",g,".bindBuffer(",34963,",",ba,".buffer.buffer);","}else{",g,".bindBuffer(",34963,",null);","}");p("for(",N,"=0;",N,"<",ra,";++",N,"){",O,"=",
Y,"[",N,"];");Object.keys(m).sort(a).forEach(function(a){function b(a){p("if(",z,"){",g,".enable(",a,");}else{",g,".disable(",a,");}")}var z=w(m[a]);switch(a){case "framebuffer":a=h("viewport");var c=h("scissor.box");p("if(",ga,".push(",z,"&&",z,"._framebuffer)){",ga,".poll();",a,".setDirty();",c,".setDirty();","}");break;case "cull.enable":b(2884);break;case "blend.enable":b(3042);break;case "dither":b(3024);break;case "stencil.enable":b(2960);break;case "depth.enable":b(2929);break;case "scissor.enable":b(3089);
break;case "polygonOffset.enable":b(32823);break;case "sample.alpha":b(32926);break;case "sample.enable":b(32928);break;case "depth.mask":p(g,".depthMask(",z,");");break;case "depth.func":a=B(M);p(g,".depthFunc(",a,"[",z,"]);");break;case "depth.range":p(g,".depthRange(",z,"[0],",z,"[1]);");break;case "blend.color":p(g,".blendColor(",z,"[0],",z,"[1],",z,"[2],",z,"[3]);");break;case "blend.equation":a=B(E);p("if(typeof ",z,'==="string"){',g,".blendEquation(",a,"[",z,"]);","}else{",g,".blendEquationSeparate(",
a,"[",z,".rgb],",a,"[",z,".alpha]);","}");break;case "blend.func":a=B(Q);p(g,".blendFuncSeparate(",a,'["srcRGB" in ',z,"?",z,".srcRGB:",z,".src],",a,'["dstRGB" in ',z,"?",z,".dstRGB:",z,".dst],",a,'["srcAlpha" in ',z,"?",z,".srcAlpha:",z,".src],",a,'["dstAlpha" in ',z,"?",z,".dstAlpha:",z,".dst]);");break;case "stencil.mask":p(g,".stencilMask(",z,");");break;case "stencil.func":a=B(M);p(g,".stencilFunc(",a,"[",z,'.cmp||"always"],',z,".ref|0,",'"mask" in ',z,"?",z,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":c=
B(y);p(g,".stencilOpSeparate(","stencil.opFront"===a?1028:1029,",",c,"[",z,'.fail||"keep"],',c,"[",z,'.zfail||"keep"],',c,"[",z,'.pass||"keep"]);');break;case "polygonOffset.offset":p(g,".polygonOffset(",z,".factor||0,",z,".units||0);");break;case "cull.face":p(g,".cullFace(",z,'==="front"?',1028,":",1029,");");break;case "lineWidth":p(g,".lineWidth(",z,");");break;case "frontFace":p(g,".frontFace(",z,'==="cw"?',2304,":",2305,");");break;case "colorMask":p(g,".colorMask(",z,"[0],",z,"[1],",z,"[2],",
z,"[3]);");break;case "sample.coverage":p(g,".sampleCoverage(",z,".value,",z,".invert);");break;case "scissor.box":case "viewport":a=h(a);p(a,".push(",z,".x||0,",z,".y||0,",z,".w||-1,",z,".h||-1);");break;case "primitives":case "offset":case "count":case "elements":break;default:q.raise("unsupported option for batch",a)}});("viewport"in m||"framebuffer"in m)&&p(h("viewport"),".poll();");("scissor.box"in m||"framebuffer"in m)&&p(h("scissor.box"),".poll();");"framebuffer"in m&&p(ga,".pop();");var ea=
d.uniforms,ma=[];Object.keys(r).forEach(function(a){var b=v(ea,a);if(b){var z=b.info.type,f=B(b.location);a=w(r[a]);35678===b.info.type||35680===b.info.type?(b=G(a+"._texture"),ma.push(b),p(c(g,5124,f,b+".bind()"))):p(c(g,z,f,a))}});ma.forEach(function(a){p(a,".unbind();")});var sa=d.attributes;Object.keys(A).forEach(function(a){var g=v(sa,a);g&&p(t,"(",g.location,",",B(a.bindings[g.location]),",",w(A[a]),",",b(g.info.type),");")});m.count?p(D,"=",w(m.count),";"):K("count")||p("if(",D,"){");m.offset&&
p(ka,"=",w(m.offset),";");m.primitive&&(d=B(k),p(W,"=",d,"[",w(m.primitive),"];"));oa&&(d=w(m.elements),p(ba,"=",d,"?",d,"._elements:null;"));K("offset")&&p(ka,"=0;");p("if(",ba,"){");K("count")&&p(D,"=",ba,".vertCount;","if(",D,">0){");K("primitive")&&p(W,"=",ba,".primType;");oa&&p(g,".bindBuffer(",34963,",",ba,".buffer.buffer);");P&&(m.instances&&p(C,"=",w(m.instances),";"),p("if(",C,">0){",L,".drawElementsInstancedANGLE(",W,",",D,",",ba,".type,",ka,",",C,");}else{"));p(g,".drawElements(",W,",",
D,",",ba,".type,",ka,");");P&&p("}");K("count")&&p("}");p("}else{");K("count")||(K("primitive")&&p(W,"=",4,";"),P&&p("if(",C,">0){",L,".drawArraysInstancedANGLE(",W,",",ka,",",D,",",C,");}else{"),p(g,".drawArrays(",W,",",ka,",",D,");}"),P&&p("}"));p("}}",F);return V.compile().batch}var ia=w.contextState,E={add:32774,subtract:32778,"reverse subtract":32779};x.ext_blend_minmax&&(E.min=32775,E.max=32776);var P=0;return{draw:function(a){var d=f(),m=d.link,q=d.proc("draw"),r=q.def,k=m(n),A=m(a.program),
h=m(ca.bind),K=m(aa.count),H=m(aa.offset),B=m(aa.instances),p=m(aa.primitive),F=m(u.elements),G=[];q(k,".useProgram(",A,");");a.attributes.forEach(function(a){var g=m(ca.def(a.name));q(h,"(",a.location,",",m(ca.bindings[a.location]),",",g,".records[",g,".top]",",",b(a.info.type),");")});a.uniforms.forEach(function(a){var b=m(a.location),f=m(l.def(a.name)),f=f+"["+f+".length-1]";a=a.info.type;35678===a||35680===a?(a=r(f+"._texture"),G.push(a),q(c(k,5124,b,a+".bind()"))):q(c(k,a,b,f))});G.forEach(function(a){q(a,
".unbind();")});a=r(e(p));K=r(e(K));H=r(e(H));F=r(e(F));q("if(",K,"){");(A=x.angle_instanced_arrays)?(B=r(e(B)),A=m(A),q("if(",F,"){",F,".bind();","if(",B,">0){",A,".drawElementsInstancedANGLE(",a,",",K,",",F,".type,",H,",",B,");}else{",k,".drawElements(",a,",",K,",",F,".type,",H,");}","}else if(",B,">0){",A,".drawArraysInstancedANGLE(",a,",",H,",",K,",",B,");}else{",k,".drawArrays(",a,",",H,",",K,");}}")):q("if(",F,"){",k,".drawElements(",a,",",K,",",F,".type,",H,");}","}else{",k,".drawArrays(",
a,",",H,",",K,");}");return d.compile().draw},command:function(b,c,n,h,x,w,J){function v(a){var b=ba[a];return b?b:b=ba[a]=p(ia[a])}function K(a,b){var g=v(a);C(g,".push(",b,");");L(g,".pop();")}function V(a){var b=a.id,g=sa[b];if(g)return g;g=a.func?N.def(p(a.data),"(",qa,",0,",wa,")"):N.def(qa,".",a.data);return sa[b]=g}var B=f(),p=B.link,F=B.block,G=B.proc,Y=P++,g=p(ma);p(d);var I=p(O.fragShaders),t=p(O.vertShaders),R=p(O.programs),ga=p(U),D={count:p(aa.count),offset:p(aa.offset),instances:p(aa.instances),
primitive:p(aa.primitive)},ka=p(u.elements),ra=p(k),W=p(M),ta=p(y),ba={},C=F(),L=F(),va=!1;Object.keys(b).sort(a).forEach(function(a){var g=b[a];switch(a){case "frag":va=!0;C(I,".push(",p(d.id(g)),");");L(I,".pop();");break;case "vert":va=!0;C(t,".push(",p(d.id(g)),");");L(t,".pop();");break;case "framebuffer":a=U.getFramebuffer(g);q(null===g||a,"invalid framebuffer object");a=v("viewport");var c=v("scissor.box");C("if(",ga,".push(",p(g&&g._framebuffer),")){",a,".setDirty();",c,".setDirty();","}");
L("if(",ga,".pop()){",a,".setDirty();",c,".setDirty();","}");break;case "count":case "offset":case "instances":q.nni(g,a);C(D[a],".push(",g,");");L(D[a],".pop();");break;case "primitive":q.parameter(g,k,"not a valid drawing primitive");C(D.primitive,".push(",k[g],");");L(D.primitive,".pop();");break;case "elements":c=u.getElements(g);g=!("primitive"in b);a=!("count"in b);c?(c=p(c),C(ka,".push(",c,");"),g&&C(D.primitive,".push(",c,".primType);"),a&&C(D.count,".push(",c,".vertCount);")):(C(ka,".push(null);"),
g&&C(D.primitive,".push(",4,");"),a&&C(D.count,".push(0);"));g&&L(D.primitive,".pop();");a&&L(D.count,".pop();");"offset"in b||(C(D.offset,".push(0);"),L(D.offset,".pop();"));L(ka,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":q.type(g,"boolean",a);K(a,g);break;case "depth.func":q.parameter(g,M,a);K(a,M[g]);break;case "depth.range":q(Array.isArray(g)&&
2===g.length&&g[0]<=g[1],"depth range is 2d array");a=v(a);C(a,".push(",g[0],",",g[1],");");L(a,".pop();");break;case "blend.func":a=v(a);q.type(g,"object","blend func must be an object");var c="srcRGB"in g?g.srcRGB:g.src,f="srcAlpha"in g?g.srcAlpha:g.src,e="dstRGB"in g?g.dstRGB:g.dst,g="dstAlpha"in g?g.dstAlpha:g.dst;q.parameter(c,Q);q.parameter(f,Q);q.parameter(e,Q);q.parameter(g,Q);C(a,".push(",Q[c],",",Q[e],",",Q[f],",",Q[g],");");L(a,".pop();");break;case "blend.equation":a=v(a);"string"===typeof g?
(q.parameter(g,E,"invalid blend equation"),C(a,".push(",E[g],",",E[g],");")):"object"===typeof g?(q.parameter(g.rgb,E,"invalid blend equation rgb"),q.parameter(g.alpha,E,"invalid blend equation alpha"),C(a,".push(",E[g.rgb],",",E[g.alpha],");")):q.raise("invalid blend equation");L(a,".pop();");break;case "blend.color":q(Array.isArray(g)&&4===g.length,"blend color is a 4d array");a=v(a);C(a,".push(",g[0],",",g[1],",",g[2],",",g[3],");");L(a,".pop();");break;case "stencil.mask":q.type(g,"number","stencil mask must be an integer");
a=v(a);C(a,".push(",g,");");L(a,".pop();");break;case "stencil.func":q.type(g,"object","stencil func must be an object");c=g.cmp||"keep";f=g.ref||0;g="mask"in g?g.mask:-1;q.parameter(c,M,"invalid stencil func cmp");q.type(f,"number","stencil func ref");q.type(g,"number","stencil func mask");a=v(a);C(a,".push(",M[c],",",f,",",g,");");L(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":q.type(g,"object",a);c=g.fail||"keep";f=g.zfail||"keep";g=g.pass||"keep";q.parameter(c,y,a);q.parameter(f,
y,a);q.parameter(g,y,a);a=v(a);C(a,".push(",y[c],",",y[f],",",y[g],");");L(a,".pop();");break;case "polygonOffset.offset":q.type(g,"object",a);c=g.factor||0;g=g.units||0;q.type(c,"number","offset.factor");q.type(g,"number","offset.units");a=v(a);C(a,".push(",c,",",g,");");L(a,".pop();");break;case "cull.face":c=0;"front"===g?c=1028:"back"===g&&(c=1029);q(!!c,"cull.face");g=v(a);C(g,".push(",c,");");L(g,".pop();");break;case "lineWidth":c=m.lineWidthDims;q("number"===typeof g&&g>=c[0]&&g<=c[1],"invalid line width, must positive number between "+
c[0]+" and "+c[1]);K(a,g);break;case "frontFace":c=0;"cw"===g?c=2304:"ccw"===g&&(c=2305);q(!!c,"frontFace");g=v(a);C(g,".push(",c,");");L(g,".pop();");break;case "colorMask":q(Array.isArray(g)&&4===g.length,"color mask must be length 4 array");a=v(a);C(a,".push(",g.map(function(a){return!!a}).join(),");");L(a,".pop();");break;case "sample.coverage":q.type(g,"object",a);c="value"in g?g.value:1;g=!!g.invert;q("number"===typeof c&&0<=c&&1>=c,"sample value");a=v(a);C(a,".push(",c,",",g,");");L(a,".pop();");
break;case "viewport":case "scissor.box":q("object"===typeof g&&g,a+" is an object");var c=g.x||0,f=g.y||0,n=e=-1;q("number"===typeof c&&0<=c,a+".x must be a positive int");q("number"===typeof f&&0<=f,a+".y must be a positive int");"w"in g&&(e=g.w,q("number"===typeof e&&0<=e,a+".w must be a positive int"));"h"in g&&(n=g.h,q("number"===typeof n&&0<=n,a+".h must be a positive int"));g=v(a);C(g,".push(",c,",",f,",",e,",",n,");");L(g,".pop();");break;default:q.raise("unsupported parameter "+a)}});if(va){if(b.frag&&
b.vert)F=b.frag,C(R,".push(",p(O.create(d.id(b.vert),d.id(F))),");");else{var F=C.def(I,"[",I,".length-1]"),oa=C.def(t,"[",t,".length-1]"),ua=p(O.create);C(R,".push(",ua,"(",oa,",",F,"));")}L(R,".pop();")}Object.keys(c).forEach(function(a){var g=p(l.def(a));a=c[a];a="function"===typeof a&&a._reglType?p(a):Array.isArray(a)?p(a.slice()):+a;C(g,".push(",a,");");L(g,".pop();")});Object.keys(n).forEach(function(a){var g=p(ca.def(a)),b=n[a];if("number"===typeof b)C(g,".pushVec(",+b,",0,0,0);");else if(q(!!b,
"invalid attribute: "+a),Array.isArray(b))C(g,".pushVec(",[b[0]||0,b[1]||0,b[2]||0,b[3]||0],");");else{var c=H.getBuffer(b),f=0,e=0,t=0,m=0,d=!1,r=5126;c?r=c.dtype:(q.type(b,"object",'invalid attribute "'+a+'"'),c=H.getBuffer(b.buffer),f=b.size||0,e=b.stride||0,t=b.offset||0,m=b.divisor||0,d=b.normalized||!1,q(!!c,"invalid attribute "+a+".buffer"),r=c.dtype,"type"in b&&(q.parameter(b.type,A,"attribute type"),r=A[b.type]));q(!!c,"invalid attribute "+a+".buffer");q.nni(e,a+".stride");q.nni(t,a+".offset");
q.nni(m,a+".divisor");q.type(d,"boolean",a+".normalized");q.oneOf(f,[0,1,2,3,4],a+".size");C(g,".pushPtr(",[p(c),f,t,e,m,d,r].join(),");")}L(g,".pop();")});var N=B.block(),T=B.block(),wa,qa;J&&(wa=p(ha),qa=C.def());var sa={};Object.keys(h).sort(a).forEach(function(a){var g=V(h[a]);switch(a){case "framebuffer":a=v("viewport");var c=v("scissor.box");N("if(",ga,".push(",g,"&&",g,"._framebuffer)){",a,".setDirty();",c,".setDirty();","}");T("if(",ga,".pop()){",a,".setDirty();",c,".setDirty();","}");break;
case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=v(a);N(a,".push(",g,");");T(a,".pop();");break;case "count":case "offset":case "instances":a=D[a];N(a,".push(",g,");");T(a,".pop();");break;case "primitive":a=D.primitive;N(a,".push(",ra,"[",g,"]);");T(a,".pop();");break;case "depth.func":a=v(a);N(a,".push(",W,"[",g,"]);");T(a,
".pop();");break;case "blend.func":a=v(a);c=p(Q);N(a,".push(",c,'["srcRGB" in ',g,"?",g,".srcRGB:",g,".src],",c,'["dstRGB" in ',g,"?",g,".dstRGB:",g,".dst],",c,'["srcAlpha" in ',g,"?",g,".srcAlpha:",g,".src],",c,'["dstAlpha" in ',g,"?",g,".dstAlpha:",g,".dst]);");T(a,".pop();");break;case "blend.equation":a=v(a);c=p(E);N("if(typeof ",g,'==="string"){',a,".push(",c,"[",g,"],",c,"[",g,"]);","}else{",a,".push(",c,"[",g,".rgb],",c,"[",g,".alpha]);","}");T(a,".pop();");break;case "blend.color":a=v(a);
N(a,".push(",g,"[0],",g,"[1],",g,"[2],",g,"[3]);");T(a,".pop();");break;case "stencil.mask":a=v(a);N(a,".push(",g,");");T(a,".pop();");break;case "stencil.func":a=v(a);N(a,".push(",W,"[",g,".cmp],",g,".ref|0,",'"mask" in ',g,"?",g,".mask:-1);");T(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=v(a);N(a,".push(",ta,"[",g,'.fail||"keep"],',ta,"[",g,'.zfail||"keep"],',ta,"[",g,'.pass||"keep"]);');T(a,".pop();");break;case "polygonOffset.offset":a=v(a);N(a,".push(",g,".factor||0,",g,
".units||0);");T(a,".pop();");break;case "cull.face":a=v(a);N(a,".push(",g,'==="front"?',1028,":",1029,");");T(a,".pop();");break;case "frontFace":a=v(a);N(a,".push(",g,'==="cw"?',2304,":",2305,");");T(a,".pop();");break;case "colorMask":a=v(a);N(a,".push(",g,"[0],",g,"[1],",g,"[2],",g,"[3]);");T(a,".pop();");break;case "sample.coverage":a=v(a);N(a,".push(",g,".value,",g,".invert);");T(a,".pop();");break;case "scissor.box":case "viewport":a=v(a);N(a,".push(",g,".x||0,",g,".y||0,",'"w" in ',g,"?",
g,".w:-1,",'"h" in ',g,"?",g,".h:-1);");T(a,".pop();");break;case "elements":a=!("primitive"in h)&&!("primitive"in b);var c=!("count"in h)&&!("count"in b),f=!("offset"in h)&&!("offset"in b),e=N.def();N("if(",g,"){",e,"=",g,"._elements;",ka,".push(",e,");",a?D.primitive+".push("+e+".primType);":"",c?D.count+".push("+e+".vertCount);":"",f?D.offset+".push("+e+".offset);":"","}else{",ka,".push(null);","}");T(ka,".pop();","if(",g,"){",a?D.primitive+".pop();":"",c?D.count+".pop();":"",f?D.offset+".pop();":
"","}");break;default:q.raise("unsupported dynamic option: "+a)}});Object.keys(x).forEach(function(a){var g=p(l.def(a));a=V(x[a]);N(g,".push(",a,");");T(g,".pop();")});Object.keys(w).forEach(function(a){var g=p(ca.def(a));a=V(w[a]);N(g,".pushDyn(",a,");");T(g,".pop();")});F=G("scope");oa=F.arg();ua=F.arg();F(C);J&&F(qa,"=",oa,";",N);F(ua,"();",J?T:"",L);F=G("draw");F(C);J&&F(qa,"=",F.arg(),";",N);oa=e(R);F(g,"();","if(",oa,")",oa,".draw(",J?qa:"",");",J?T:"",L);var pa=G("batch");pa(C);J=pa.def(e(R));
G=p(function(a,g,c){var f=a.batchCache[Y];f||(f=a.batchCache[Y]=ea(a,h,x,w,b));return f(g,c)});pa("if(",J,"){",g,"();",G,"(",J,",",pa.arg(),",",pa.arg(),");");Object.keys(h).forEach(function(a){(a=ba[a])&&pa(a,".setDirty();")});pa("}",L);return B.compile()}}}},{"./check":4,"./codegen":6,"./constants/dtypes.json":9,"./constants/primitives.json":10}],8:[function(d,h,l){h.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,
"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],9:[function(d,h,l){h.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],10:[function(d,h,l){h.exports={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],11:[function(d,h,l){function b(b,f){function e(){var c=window.innerWidth,f=window.innerHeight;b!==document.body&&
(f=b.getBoundingClientRect(),c=f.right-f.left,f=f.top-f.bottom);d.width=l*c;d.height=l*f;a(d.style,{width:c+"px",height:f+"px"})}var d=document.createElement("canvas"),h=c(d,f);a(d.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(d);b===document.body&&(d.style.position="absolute",a(b.style,{margin:0,padding:0}));var l=+h.options.pixelRatio;window.addEventListener("resize",e,!1);var y=h.options.onDestroy;h.options=a(a({},h.options),{onDestroy:function(){window.removeEventListener("resize",
e);b.removeChild(d);y&&y()}});e();return h}function c(b,c){function d(a){try{return b.getContext(a,h)}catch(c){return null}}var h=c.glOptions||{},Q=d("webgl")||d("experimental-webgl")||d("webgl-experimental");e(Q,"webgl not supported");return{gl:Q,options:a({pixelRatio:window.devicePixelRatio},c)}}var e=d("./check"),a=d("./extend");h.exports=function(e){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:e[0],options:e[1]||{}};var f=document.body,d=e[1]||{};if("string"===
typeof e[0])f=document.querySelector(e[0])||document.body;else if("object"===typeof e[0])if(e[0]instanceof HTMLElement)f=e[0];else{if(e[0]instanceof WebGLRenderingContext)return{gl:e[0],options:a({pixelRatio:1},d)};d=e[0]}return f.nodeName&&"CANVAS"===f.nodeName.toUpperCase()?c(f,d):b(f,d)}},{"./check":4,"./extend":15}],12:[function(d,h,l){h.exports=function(b){return{primitive:[4],count:[0],offset:[0],instances:[0]}}},{}],13:[function(d,h,l){function b(a,b){this.id=e++;this.func=a;this.data=b}function c(a,
e){switch(typeof a){case "boolean":case "number":case "string":return new b(!1,a);case "function":return new b(!0,a);default:return c}}var e=0;h.exports={define:c,isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof b},unbox:function(a,e){return a instanceof b?a:"function"===typeof a&&a!==c?new b(!0,a):new b(!1,e)}}},{}],14:[function(d,h,l){var b=d("./check"),c=d("./is-typed-array"),e=d("./is-ndarray"),a=d("./constants/primitives.json");h.exports=function(d,f,h){function A(){this.buffer=
null;this.primType=4;this.type=this.vertCount=0}A.prototype.bind=function(){this.buffer.bind()};return{create:function(d){function q(d){var h=f.oes_element_index_uint;if(d)if("number"===typeof d)n(d);else{var m=null,k="static",u=0;Array.isArray(d)||c(d)||e(d)?m=d:(b.type(d,"object","invalid arguments for elements"),"data"in d&&(m=d.data),"usage"in d&&(k=d.usage),"length"in d&&(u=d.length));Array.isArray(m)||e(m)&&"array"===m.dtype||"type"in d?n({type:d.type||(h?"uint32":"uint16"),usage:k,data:m,length:u}):
n({usage:k,data:m,length:u});if(Array.isArray(m)||c(m))n.dimension=3}else n();m=y.buffer.byteLength;k=0;switch(y.buffer.dtype){case 5121:case 5120:k=5121;break;case 5123:case 5122:k=5123;m>>=1;break;case 5125:case 5124:b(h,"32 bit element buffers not supported");k=5125;m>>=2;break;default:b.raise("invalid element buffer type")}h=4;u=y.buffer.dimension;1===u&&(h=0);2===u&&(h=1);3===u&&(h=4);"object"===typeof d&&("primitive"in d&&(h=d.primitive,b.parameter(h,a),h=a[h]),"count"in d&&(m=d.vertCount|0));
y.primType=h;y.vertCount=m;y.type=k;return q}var y=new A,n=h.create(null,34963,!0);y.buffer=n._buffer;q(d);q._reglType="elements";q._elements=y;q.destroy=function(){b(null!==y.buffer,"must not double destroy elements");n.destroy();y.buffer=null};return q},elements:[null],getElements:function(a){return a&&a._elements instanceof A?a._elements:null}}}},{"./check":4,"./constants/primitives.json":10,"./is-ndarray":18,"./is-typed-array":19}],15:[function(d,h,l){h.exports=function(b,c){for(var e=Object.keys(c),
a=0;a<e.length;++a)b[e[a]]=c[e[a]];return b}},{}],16:[function(d,h,l){h.exports=function(b){function c(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{e[a]=
b.getExtension(a)}catch(c){}})}var e={};c();return{extensions:e,refresh:c}}},{}],17:[function(d,h,l){var b=d("./check"),c=d("./values"),e=d("./extend"),a=[1029];h.exports=function(d,f,h,A,l){function M(a,b,c,f){this.target=a;this.level=b;this.texture=c;this.renderbuffer=f}function y(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function n(a,c,f){if(a.texture)b.oneOf(a.texture._texture.params.internalformat,c,"unsupported texture format for attachment");
else b.oneOf(a.renderbuffer._renderbuffer.format,f,"unsupported renderbuffer format for attachment")}function r(a,c){var f=c.width,e=c.height;if(a.texture){var d=a.texture._texture,m=Math.max(1,d.params.width>>a.level),n=Math.max(1,d.params.height>>a.level),f=f||m,e=e||n;b(m===f&&n===e,"inconsistent width/height for supplied texture");b(0>d.pollId,"polling fbo textures not supported")}else d=a.renderbuffer._renderbuffer,f=f||d.width,e=e||d.height,b(d.width===f&&d.height===e,"inconsistent width/height for renderbuffer"),
b(0<=da.indexOf(d.format),"renderbuffer format not compatible with color channels");d.refCount+=1;c.width=f;c.height=e}function x(a,b){b?b.texture?d.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):d.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):d.framebufferTexture2D(36160,a,3553,null,0)}function m(a){var c=3553,f=0,d=null,e=null,m=a;"object"===typeof a&&(m=a.data,"level"in a&&(f=a.level|0),"target"in a&&(c=a.target|0));b.type(m,"function",
"invalid attachment data");m=a._reglType;"texture"===m?(d=a,34067===d._texture.target?b(34069<=c&&34075>c,"invalid cube map target"):b(3553===c)):"renderbuffer"===m?(e=a,c=36161,f=0):b.raise("invalid regl object for attachment");return new M(c,f,d,e)}function H(a){return a&&(a.texture||a.renderbuffer)}function u(){this.id=S++;X[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=
this.ownsColor=!1}function J(a){d.isFramebuffer(a.framebuffer)||(a.framebuffer=d.createFramebuffer());v=!0;d.bindFramebuffer(36160,a.framebuffer);for(var c=a.colorAttachments,e=0;e<c.length;++e)x(36064+e,c[e]);for(e=c.length;e<h.maxColorAttachments;++e)x(36064+e,null);x(36096,a.depthAttachment);x(36128,a.stencilAttachment);x(33306,a.depthStencilAttachment);f.webgl_draw_buffers&&f.webgl_draw_buffers.drawBuffersWEBGL(Z[c.length]);a=d.checkFramebufferStatus(36160);36053!==a&&b.raise("framebuffer configuration not supported, status = "+
na[a])}function U(a){a=a.framebuffer;b(a,"must not double destroy framebuffer");d.isFramebuffer(a)&&d.deleteFramebuffer(a)}function w(){return la[la.length-1]}var na={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},ca={rgba:6408},O={rgba4:32854,rgb565:36194,"rgb5 a1":32855};f.ext_srgb&&(O.srgba=35907);f.ext_color_buffer_half_float&&(O.rgba16f=34842,O.rgb16f=34843);f.webgl_color_buffer_float&&(O.rgba32f=34836);
var aa=[33189],ha=[36168],ma=[34041],ea=[],ia=[],E=[];f.webgl_depth_texture&&(ea.push(6402),E.push(34041));var P=e(e({},ca),O),ja=c(ca),da=c(O),O=5121,fa={uint8:5121};f.oes_texture_half_float&&(O=fa["half float"]=36193);f.oes_texture_float&&(O=fa["float"]=5126);fa.best=O;var Z=function(){for(var a=Array(h.maxDrawbuffers),b=0;b<=h.maxDrawbuffers;++b)for(var c=a[b]=Array(b),f=0;f<b;++f)c[f]=36064+f;return a}(),S=0,X={},la=[null],v=!0;return{top:w,dirty:function(){return v},push:function(a){a=a||null;
v=v||a!==w();la.push(a);return v},pop:function(){var a=w();la.pop();return v=v||a!==w()},getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof u)?a:null},poll:function(){if(v){var b=la[la.length-1],c=f.webgl_draw_buffers;b?(d.bindFramebuffer(36160,b.framebuffer),c&&c.drawBuffersWEBGL(Z[b.colorAttachments.length])):(d.bindFramebuffer(36160,null),c&&c.drawBuffersWEBGL(a));v=!1}},create:function(a){function c(a){var h,k=a||{};h=f.webgl_draw_buffers;
var u=0,g=0;"shape"in k?(a=k.shape,b(Array.isArray(a)&&2<=a.length,"invalid shape for framebuffer"),u=a[0],g=a[1]):("radius"in k&&(u=g=k.radius),"width"in k&&(u=k.width),"height"in k&&(g=k.height));var I=null;a=!1;if("colorBuffers"in k||"colorBuffer"in k){I=k.colorBuffers||k.colorBuffer;Array.isArray(I)||(I=[I]);e.width=u;e.height=g;1<I.length&&b(h,"multiple render targets not supported");b(0<=I.length,"must specify at least one color attachment");I=I.map(m);for(h=0;h<I.length;++h)u=I[h],n(u,ja,da),
r(u,e);u=e.width;g=e.height}else{var t=!0,R="rgba",ga="uint8",D=1;a=!0;e.width=u||d.drawingBufferWidth;e.height=g||d.drawingBufferHeight;"format"in k&&(R=k.format,b.parameter(R,P,"invalid color format"),t=R in ca);"type"in k&&(b(t,"colorType can not be set for renderbuffer targets"),ga=k.type,b.parameter(ga,fa,"invalid color type"));"colorCount"in k&&(D=k.colorCount|0,b(0<=D,"color count must be positive"));if(e.ownsColor)for(I=e.colorAttachments;I.length>D;)y(I.pop());else I=[];for(h=0;h<I.length;++h){var x;
a:{x=I[h];var w=t,W=R,v=u,ba=g;if(x.texture){var C=x.texture;if(w){C({format:W,type:ga,width:v,height:ba});C._texture.refCount+=1;x=!0;break a}}else if(C=x.renderbuffer,!w){C({format:W,width:v,height:ba});C._renderbuffer.refCount+=1;x=!0;break a}y(x);x=!1}x||(I[h--]=I[I.length-1],I.pop())}for(;I.length<D;)t?I.push(new M(3553,0,A.create({format:R,type:ga,width:u,height:g},3553),null)):I.push(new M(36161,0,null,l.create({format:R,width:u,height:g})))}b(0<I.length,"must specify at least one color buffer");
e.width=u;e.height=g;R=t=h=null;ga=!1;D=0;"depthBuffer"in k&&(h=m(k.depthBuffer),n(h,ea,aa),D+=1);"stencilBuffer"in k&&(t=m(k.stencilBuffer),n(t,ia,ha),D+=1);"depthStencilBuffer"in k&&(R=m(k.depthStencilBuffer),n(R,E,ma),D+=1);if(h||t||R)b(1===D,"can specify only one of depth, stencil or depthStencil attachment"),r(h||t||R,e);else if(D=!0,w=x=!1,"depth"in k&&(D=!!k.depth),"stencil"in k&&(x=!!k.stencil),"depthTexture"in k&&(w=!!k.depthTexture),k=e.depthAttachment||e.stencilAttachment||e.depthStencilAttachment,
W=null,D||x)ga=!0,w?(b(f.webgl_depth_texture,"depth texture extension not supported"),b(D,"stencil only textures not supported"),w=x?"depth stencil":"depth",e.ownsDepthStencil&&k.texture?(k.texture({format:w,width:u,height:g}),k.texture._texture.refCount+=1,W=k):W=new M(3553,0,A.create({format:w,width:u,height:g},3553),null)):(w=D?x?"depth stencil":"depth":"stencil",e.ownsDepthStencil&&k.renderbuffer?(k.renderbuffer({format:w,width:u,height:g}),k.renderbuffer._renderbuffer.refCount+=1,W=k):W=new M(36161,
0,null,l.create({format:w,width:u,height:g}))),D?x?R=W:h=W:t=W;u=e;u.colorAttachments.forEach(y);y(u.depthAttachment);y(u.stencilAttachment);y(u.depthStencilAttachment);e.colorAttachments=I;e.depthAttachment=h;e.stencilAttachment=t;e.depthStencilAttachment=R;e.ownsColor=a;e.ownsDepthStencil=ga;c.color=I.map(H);c.depth=H(h);c.stencil=H(t);c.depthStencil=H(R);J(e);c.width=e.width;c.height=e.height;return c}var e=new u;c(a);c._reglType="framebuffer";c._framebuffer=e;c._destroy=function(){U(e)};return c},
clear:function(){c(X).forEach(U)},refresh:function(){c(X).forEach(J)}}}},{"./check":4,"./extend":15,"./values":33}],18:[function(d,h,l){var b=d("./is-typed-array");h.exports=function(c){return"object"===typeof c&&Array.isArray(c.shape)&&Array.isArray(c.stride)&&"number"===typeof c.offset&&c.shape.length===c.stride.length&&(Array.isArray(c.data)||b(c.data))}},{"./is-typed-array":19}],19:[function(d,h,l){var b=d("./constants/arraytypes.json");h.exports=function(c){return Object.prototype.toString.call(c)in
b}},{"./constants/arraytypes.json":8}],20:[function(d,h,l){h.exports=function(b,c){var e=1;c.ext_texture_filter_anisotropic&&(e=b.getParameter(34047));var a=1,d=1;c.webgl_draw_buffers&&(a=b.getParameter(34852),d=b.getParameter(36063));return{colorBits:[b.getParameter(3410),b.getParameter(3411),b.getParameter(3412),b.getParameter(3413)],depthBits:b.getParameter(3414),stencilBits:b.getParameter(3415),subpixelBits:b.getParameter(3408),extensions:Object.keys(c).filter(function(a){return!!c[a]}),maxAnisotropic:e,
maxDrawbuffers:a,maxColorAttachments:d,pointSizeDims:b.getParameter(33901),lineWidthDims:b.getParameter(33902),maxViewportDims:b.getParameter(3386),maxCombinedTextureUnits:b.getParameter(35661),maxCubeMapSize:b.getParameter(34076),maxRenderbufferSize:b.getParameter(34024),maxTextureUnits:b.getParameter(34930),maxTextureSize:b.getParameter(3379),maxAttributes:b.getParameter(34921),maxVertexUniforms:b.getParameter(36347),maxVertexTextureUnits:b.getParameter(35660),maxVaryingVectors:b.getParameter(36348),
maxFragmentUniforms:b.getParameter(36349),glsl:b.getParameter(35724),renderer:b.getParameter(7937),vendor:b.getParameter(7936),version:b.getParameter(7938)}}},{}],21:[function(d,h,l){h.exports=function(b,c){if("undefined"!==typeof document){var e;e=(e=/\.(\w+)(\?.*)?$/.exec(b))&&e[1]?e[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(e))return e=document.createElement("video"),e.autoplay=!0,e.loop=!0,c&&(e.crossOrigin=c),e.src=
b,e;if(0<=["dds"].indexOf(e))return e=new XMLHttpRequest,e.responseType="arraybuffer",e.open("GET",b,!0),e.send(),e;e=new Image;c&&(e.crossOrigin=c);e.src=b;return e}return null}},{}],22:[function(d,h,l){var b=d("./check");h.exports=function(d){function h(a){for(var b=da,c=fa,e=0;e<v;++e){var f=Math.max(1,b+3>>2)*Math.max(1,c+3>>2)*X;V.pixels.push({target:a,miplevel:e,width:b,height:c,data:new Uint8Array(d,K,f)});K+=f;b>>=1;c>>=1}}var l=new Int32Array(d);b(l[0]===c,"invalid magic number for dds header");
var ja=l[na];b(ja&x,"unsupported dds format");var da=l[O],fa=l[ca],Z=M,S=0,X=0,la=4;switch(l[ma]){case H:X=8;ja&m?(la=3,S=q):S=f;break;case u:X=16;S=k;break;case J:X=16;S=A;break;case U:X=8;S=Q;break;default:b.raise("unsupported dds texture format")}var v=1;l[ha]&y&&(v=Math.max(1,l[aa]));var K=l[w]+4,V={width:da,height:fa,channels:la,format:S,type:Z,compressed:!0,cube:!1,pixels:[]},l=l[ea];if(l&n)for(b((l&r)===r,"missing cubemap faces"),V.cube=!0,l=0;6>l;++l)h(a+l);else h(e);return V};var c=542327876,
e=3553,a=34069,q=33776,f=33777,k=33778,A=33779,Q=36196,M=5121,y=131072,n=512,r=64512,x=4,m=64,H=827611204,u=861165636,J=894720068,U=826496069,w=1,na=2,ca=3,O=4,aa=7,ha=20,ma=21,ea=28},{"./check":4}],23:[function(d,h,l){h.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(b){return requestAnimationFrame(b)},cancel:function(b){return cancelAnimationFrame(b)}}:{next:function(b){setTimeout(b,30)},cancel:clearTimeout}},{}],24:[function(d,h,l){var b=
d("./check"),c=d("./is-typed-array");h.exports=function(e,a,d){return function(f){var k=f||{};c(f)?k={data:k}:2===arguments.length?k={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof f&&(k={});a();var h=k.x||0,l=k.y||0,M=k.width||d.width,y=k.height||d.height,n=M*y*4,k=k.data||new Uint8Array(n);b.isTypedArray(k);b(k.byteLength>=n,"data buffer too small");e.pixelStorei(3333,4);e.readPixels(h,l,M,y,6408,5121,k);return k}}},{"./check":4,"./is-typed-array":19}],25:[function(d,h,l){var b=d("./check"),
c=d("./values");h.exports=function(e,a,d){function f(){this.id=M++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function h(a){e.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=e.createRenderbuffer());e.bindRenderbuffer(36161,a.renderbuffer);e.renderbufferStorage(36161,a.format,a.width,a.height)}function A(a){var c=a.renderbuffer;b(c,"must not double destroy renderbuffer");e.bindRenderbuffer(36161,null);e.isRenderbuffer(c)&&e.deleteRenderbuffer(c);a.renderbuffer=
null;a.refCount=0;delete y[a.id]}var l={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};a.ext_srgb&&(l.srgba=35907);a.ext_color_buffer_half_float&&(l.rgba16f=34842,l.rgb16f=34843);a.webgl_color_buffer_float&&(l.rgba32f=34836);var M=0,y={};f.prototype.decRef=function(){0===--this.refCount&&A(this)};return{create:function(a){function c(a){a=a||{};var f=0,n=0;"shape"in a?(n=a.shape,b(Array.isArray(n)&&2<=n.length,"invalid renderbuffer shape"),f=n[0]|0,n=n[1]|
0):("radius"in a&&(f=n=a.radius|0),"width"in a&&(f=a.width|0),"height"in a&&(n=a.height|0));var A=d.maxRenderbufferSize;b(0<=f&&0<=n&&f<=A&&n<=A,"invalid renderbuffer size");c.width=e.width=Math.max(f,1);c.height=e.height=Math.max(n,1);e.format=32854;"format"in a&&(a=a.format,b.parameter(a,l,"invalid render buffer format"),e.format=l[a]);h(e);return c}var e=new f;y[e.id]=e;c(a);c._reglType="renderbuffer";c._renderbuffer=e;c.destroy=function(){e.decRef()};return c},refresh:function(){c(y).forEach(h)},
clear:function(){c(y).forEach(A)}}}},{"./check":4,"./values":33}],26:[function(d,h,l){function b(a,b,c){this.name=a;this.location=b;this.info=c}var c=d("./check"),e=d("./values");h.exports=function(a,d,f,h,A){function l(b,e){var f=35632===b?n:r,d=f[e];if(!d){var m=A.str(e),d=a.createShader(b);a.shaderSource(d,m);a.compileShader(d);c.shaderError(a,d,m,b);f[e]=d}return d}function M(a,b){this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];this.draw=function(){};this.batchCache=
{}}function y(e){var m,n;m=l(35632,e.fragId);n=l(35633,e.vertId);var r=e.program=a.createProgram();a.attachShader(r,m);a.attachShader(r,n);a.linkProgram(r);c.linkError(a,r);var A=a.getProgramParameter(r,35718),x=e.uniforms=[];for(m=0;m<A;++m)if(n=a.getActiveUniform(r,m))if(1<n.size)for(var y=0;y<n.size;++y){var O=n.name.replace("[0]","["+y+"]");f.def(O);x.push(new b(O,a.getUniformLocation(r,O),n))}else f.def(n.name),x.push(new b(n.name,a.getUniformLocation(r,n.name),n));A=a.getProgramParameter(r,
35721);x=e.attributes=[];for(m=0;m<A;++m)if(n=a.getActiveAttrib(r,m))d.def(n.name),x.push(new b(n.name,a.getAttribLocation(r,n.name),n));e.draw=h(e);e.batchCache={}}var n={},r={},x={},m=[];return{create:function(a,b){var c=x[b];c||(c=x[b]={});var e=c[a];e||(e=new M(b,a),y(e),c[a]=e,m.push(e));return e},clear:function(){var b=a.deleteShader.bind(a);e(n).forEach(b);n={};e(r).forEach(b);r={};m.forEach(function(b){a.deleteProgram(b.program)});m.length=0;x={}},refresh:function(){n={};r={};m.forEach(y)},
programs:[null],fragShaders:[A.id("void main(){gl_FragColor=vec4(0,0,0,0);}")],vertShaders:[A.id("void main(){gl_Position=vec4(0,0,0,0);}")]}}},{"./check":4,"./values":33}],27:[function(d,h,l){h.exports=function(b,c){var e=b.length,a=b.slice(),d=b.slice(),f=!1,h=!0;return{push:function(){f=!1;for(var b=0;b<e;++b){var c=arguments[b];f=f||c!==d[b];a.push(c)}},pop:function(){f=!1;a.length-=e;for(var b=0;b<e;++b)f=f||a[a.length-e+b]!==d[b]},poll:function(){var b=a.length-e;if(f||h){switch(e){case 1:c(a[b]);
break;case 2:c(a[b],a[b+1]);break;case 3:c(a[b],a[b+1],a[b+2]);break;case 4:c(a[b],a[b+1],a[b+2],a[b+3]);break;case 5:c(a[b],a[b+1],a[b+2],a[b+3],a[b+4]);break;case 6:c(a[b],a[b+1],a[b+2],a[b+3],a[b+4],a[b+5]);break;default:c.apply(null,a.slice(b,a.length))}for(var l=0;l<e;++l)d[l]=a[b+l];h=f=!1}},setDirty:function(){h=!0}}}},{}],28:[function(d,h,l){var b=d("./stack"),c=d("./codegen");h.exports=function(e,a,d){function f(a,c){var d=b([!!c],function(b){b?e.enable(a):e.disable(a)});d.flag=a;return d}
var h={dither:f(3024),"blend.enable":f(3042),"blend.color":b([0,0,0,0],function(a,b,c,d){e.blendColor(a,b,c,d)}),"blend.equation":b([32774,32774],function(a,b){e.blendEquationSeparate(a,b)}),"blend.func":b([1,0,1,0],function(a,b,c,d){e.blendFuncSeparate(a,b,c,d)}),"depth.enable":f(2929,!0),"depth.func":b([513],function(a){e.depthFunc(a)}),"depth.range":b([0,1],function(a,b){e.depthRange(a,b)}),"depth.mask":b([!0],function(a){e.depthMask(a)}),"cull.enable":f(2884),"cull.face":b([1029],function(a){e.cullFace(a)}),
frontFace:b([2305],function(a){e.frontFace(a)}),colorMask:b([!0,!0,!0,!0],function(a,b,c,d){e.colorMask(a,b,c,d)}),lineWidth:b([1],function(a){e.lineWidth(a)}),"polygonOffset.enable":f(32823),"polygonOffset.offset":b([0,0],function(a,b){e.polygonOffset(a,b)}),"sample.alpha":f(32926),"sample.enable":f(32928),"sample.coverage":b([1,!1],function(a,b){e.sampleCoverage(a,b)}),"stencil.enable":f(2960),"stencil.mask":b([-1],function(a){e.stencilMask(a)}),"stencil.func":b([519,0,-1],function(a,b,c){e.stencilFunc(a,
b,c)}),"stencil.opFront":b([7680,7680,7680],function(a,b,c){e.stencilOpSeparate(1028,a,b,c)}),"stencil.opBack":b([7680,7680,7680],function(a,b,c){e.stencilOpSeparate(1029,a,b,c)}),"scissor.enable":f(3089),"scissor.box":b([0,0,-1,-1],function(b,c,d,f){var h=d,k=a.top();0>d&&(h=k?k.width-b:e.drawingBufferWidth-b);d=f;0>f&&(d=k?k.height-c:e.drawingBufferHeight-c);e.scissor(b,c,h,d)}),viewport:b([0,0,-1,-1],function(b,c,f,h){var k=f,l=a.top();0>f&&(k=l?l.width-b:e.drawingBufferWidth-b);f=h;0>h&&(f=l?
l.height-c:e.drawingBufferHeight-c);e.viewport(b,c,k,f);d.width=k;d.height=f})},l=c(),Q=l.proc("poll"),M=l.proc("refresh");Object.keys(h).forEach(function(a){a=l.link(h[a]);Q(a,".poll();");M(a,".setDirty();")});var y=l.compile();return{contextState:h,viewport:d,poll:y.poll,refresh:y.refresh,notifyViewportChanged:function(){h.viewport.setDirty();h["scissor.box"].setDirty()}}}},{"./codegen":6,"./stack":27}],29:[function(d,h,l){h.exports=function(){var b={},c=[""];return{id:function(e){var a=b[e];if(a)return a;
a=b[e]=c.length;c.push(e);return a},str:function(b){return c[b]}}}},{}],30:[function(d,h,l){function b(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function c(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,e=1;e<b;++e)if(!Array.isArray(a[e])||a[e].length!==c)return!1;return!0}function e(a){return Object.prototype.toString.call(a)}function a(a){return"[object HTMLCanvasElement]"===e(a)}function q(a){return"[object CanvasRenderingContext2D]"===
e(a)}var f=d("./check"),k=d("./extend"),A=d("./values"),Q=d("./is-typed-array"),M=d("./is-ndarray"),y=d("./load-texture"),n=d("./to-half-float"),r=d("./parse-dds"),x=[9984,9986,9985,9987];h.exports=function(d,h,l,J,U){function w(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=this.miplevel=0;
this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function na(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ca(a,b){var c,d,e=0,k=0,m=0,n=0,q=0,l=0,p=!1,w=!1,r=!1,u=0,y=[0,0,0,0,0,0],A=0,v=!1;for(c=0;c<b.length;++c){d=b[c];var n=n||d.width<<d.miplevel,q=
q||d.height<<d.miplevel,e=e||d.type,k=k||d.format,m=m||d.internalformat,l=l||d.channels,w=w||d.needsPoll,r=r||d.needsListeners,p=p||d.compressed,B=d.miplevel;d=d.target;v=v||0<B;3553===d?u|=1<<B:(d-=34069,y[d]|=1<<B,A|=1<<d)}a.needsPoll=w;a.needsListeners=r;a.width=n;a.height=q;a.format=k;a.internalformat=m;a.type=e;w=v?(n<<1)-1:1;if(3553===a.target)f(0===A,"pixmap type must not contain cubemap faces"),f(u===w,"missing mip map data");else for(f(63===A,"missing cubemap faces"),c=0;6>c;++c)f(y[c]===
w,"missing mip map data");c=0<=x.indexOf(a.minFilter);a.genMipmaps=!v&&(a.genMipmaps||c);v=v||a.genMipmaps;a.minFilter?f(v===c,"min filter inconsistent with mipmap data"):a.minFilter=v?9987:9728;v&&f(n===q&&!(n&n-1)&&!!n,"must be a square power of 2 to support mipmaps");a.genMipmaps&&f(!p,"mipmap generation not supported for compressed textures");a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;33071===a.wrapS&&33071===a.wrapT||f(!(n&n-1)&&!!n&&!(q&q-1)&&!!q&&!A,"incompatible size for wrap mode, image must be a power of 2");
(5126===e&&!h.oes_texture_float_linear||36193===e&&!h.oes_texture_half_float_linear)&&f(9728===this.magFilter&&9728===this.minFilter,"unsupported filter mode for float texture");for(c=0;c<b.length;++c)d=b[c],p=d.miplevel,d.width&&f(d.width<<p===n,"inconsistent width"),d.height&&f(d.height<<p===q,"inconsistent width"),d.channels?f(d.channels===l,"inconsistent channels"):d.channels=l,d.format?f(d.format===k,"inconsistent format"):d.format=k,d.internalformat?f(d.internalformat===m,"inconsistent internalformat"):
d.internalformat=m,d.type?f(d.type===e,"inconsistent type"):d.type=e,d.copy&&f(5121===d.type&&6408===d.internalformat,"incompatible format/type for copyTexImage2D")}function O(a){this.id=B++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new na(a);this.pixels=[]}function aa(a,b){function c(a,g){var d=g.mipmap,e;if(Array.isArray(d))for(var f=0;f<d.length;++f)e=new w(a),e.parseFlags(b),e.parseFlags(g),e.parse(d[f],f),h.push(e);
else e=new w(a),e.parseFlags(b),e.parse(g,0),h.push(e)}var d;ea(a);var e=a.params;na.call(e,a.target);var h=a.pixels;h.length=0;e.parse(b);if(3553===a.target)c(3553,b);else{var k=b.faces||b;if(Array.isArray(k))for(f(6===k.length,"invalid number of faces in cube map"),d=0;6>d;++d)c(34069+d,k[d]);else if("string"!==typeof k)for(d=0;6>d;++d)c(34069+d,{})}ca(e,h);e.needsListeners&&ma(a);e.needsPoll&&(a.pollId=F.length,F.push(a));ha(a)}function ha(a){d.isTexture(a.texture)||(a.texture=d.createTexture());
var b=a.target,c=a.unit;0<=c?(d.activeTexture(33984+c),V=c):d.bindTexture(b,a.texture);for(var b=a.pixels,e=a.params,f=0;f<b.length;++f)b[f].upload(e);e.upload();0>c&&((c=Y[V])?d.bindTexture(c.target,c.texture):(a.unit=V,Y[V]=a))}function ma(a){function b(c,d,h){var k=r(h);f(k.format in K,"unsupported dds texture format");k.cube?(f(34067===a.target),f.raise("cube map DDS not yet implemented")):f(3553===a.target);d&&f(1===k.pixels.length,"number of mip levels inconsistent");k.pixels.forEach(function(a){var b=
new w(k.cube?a.target:c);b.channels=k.channels;b.compressed=k.compressed;b.type=k.type;b.internalformat=k.format;b.format=K[k.format];b.width=a.width;b.height=a.height;b.miplevel=a.miplevel||d;b.data=a.data;e.push(b)})}function c(){for(var f=0;f<e.length;++f){var h=e[f],k=h.image,t=h.video,n=h.xhr;k&&k.complete?(h.width=k.naturalWidth,h.height=k.naturalHeight):t&&2<t.readyState?(h.width=t.width,h.height=t.height):n&&4===n.readyState&&(e[f]=e[e.length-1],e.pop(),n.removeEventListener("readystatechange",
ha),b(h.target,h.miplevel,n.response))}ca(d,e);ha(a)}var d=a.params,e=a.pixels;e.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){e.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function ea(a){var b=
a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((F[b]=F[F.length-1]).id=b,F.pop(),a.pollId=-1)}function ia(a){var b=a.texture;f(b,"must not double destroy texture");var c=a.unit,e=a.target;0<=c&&(d.activeTexture(33984+c),V=c,d.bindTexture(e,null),Y[c]=null);ea(a);d.isTexture(b)&&d.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete p[a.id]}var E={"don't care":4352,"dont care":4352,nice:4354,fast:4353},P={repeat:10497,clamp:33071,mirror:33648},ja={nearest:9728,
linear:9729},da=k({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ja),fa={none:0,browser:37444},Z={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},S={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},X={};h.ext_srgb&&(S.srgb=35904,S.srgba=35906);h.oes_texture_float&&(Z["float"]=5126);h.oes_texture_half_float&&(Z["half float"]=36193);h.webgl_depth_texture&&
(k(S,{depth:6402,"depth stencil":34041}),k(Z,{uint16:5123,uint32:5125,"depth stencil":34042}));h.webgl_compressed_texture_s3tc&&k(X,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});h.webgl_compressed_texture_atc&&k(X,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});h.webgl_compressed_texture_pvrtc&&k(X,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});h.webgl_compressed_texture_etc1&&
(X["rgb etc1"]=36196);var la=Array.prototype.slice.call(d.getParameter(34467));Object.keys(X).forEach(function(a){var b=X[a];0<=la.indexOf(b)&&(S[a]=b)});var v=Object.keys(S);l.textureFormats=v;var K=v.reduce(function(a,b){var c=S[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});k(w.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in a&&(f.type(a.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),
this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(f.type(a.flipY,"boolean","invalid texture flip"),this.flipY=a.flipY);"alignment"in a&&(f.oneOf(a.alignment,[1,2,4,8],"invalid texture unpack alignment"),this.unpackAlignment=a.alignment);"colorSpace"in a&&(f.parameter(a.colorSpace,fa,"invalid colorSpace"),this.colorSpace=fa[a.colorSpace]);if("format"in a){var b=a.format;f.parameter(b,S,"invalid texture format");this.internalformat=S[b];b in Z&&(this.type=Z[b]);b in X&&(this.compressed=!0)}"type"in
a&&(b=a.type,f.parameter(b,Z,"invalid texture type"),this.type=Z[b]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(f(Array.isArray(a.shape)&&2<=a.shape.length,"shape must be an array"),b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,f(Array.isArray(b)&&2<=b.length,"invalid stride vector"),
this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(d,k){this.miplevel=k;this.width>>=k;this.height>>=k;var t=d;switch(typeof d){case "string":break;case "object":if(!d)return;this.parseFlags(d);var m=d.data;if("string"===typeof m||m&&(Q(m)||b(m)||M(m)||a(m)||
q(m)||"[object HTMLImageElement]"===e(m)||"[object HTMLVideoElement]"===e(m)||c(m)))t=d.data;break;case "undefined":return;default:f.raise("invalid pixel data type")}"string"===typeof t&&(t=y(t,this.crossOrigin));var m=null,p=!1;this.compressed&&f(t instanceof Uint8Array||"[object XMLHttpRequest]"===e(t),"compressed texture data must be stored in a uint8array");if(null!==t)if(Q(t))this.data=t;else if(b(t))m=t,p=!0;else if(M(t)){Array.isArray(t.data)?(m=t.data,p=!0):this.data=t.data;var l=t.shape;
this.width=l[0];this.height=l[1];this.channels=3===l.length?l[2]:1;l=t.stride;this.strideX=t.stride[0];this.strideY=t.stride[1];this.strideC=3===l.length?t.stride[2]:1;this.offset=t.offset;this.needsTranspose=!0}else if(a(t)||q(t))a(t)?this.canvas=t:this.canvas=t.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===e(t))this.image=t,t.complete?(this.width=t.naturalWidth,this.height=t.naturalHeight):(this.width=this.width||
t.naturalWidth,this.height=this.height||t.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();else if("[object HTMLVideoElement]"===e(t))this.video=t,1<t.readyState?(this.width=t.width,this.height=t.height):(this.width=this.width||t.width,this.height=this.height||t.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===e(t))this.xhr=t,this.needsListeners=!0;else if(c(t)){var p=t.length,l=t[0].length,w=1,r,u,v,A;if(Array.isArray(t[0][0]))for(w=
t[0][0].length,f(0<=w&&4>=w,"invalid number of channels for image data"),m=Array(p*l*w),u=A=0;u<l;++u)for(r=0;r<p;++r)for(v=0;v<w;++v)m[A++]=t[r][u][v];else for(m=Array(p*l),u=A=0;u<l;++u)for(r=0;r<p;++r)m[A++]=t[r][u];this.width=p;this.height=l;this.channels=w;p=!0}else d.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||U.width)|0,this.height=(this.height||U.height)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:
this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=[6409,6410,6407,6408][(this.channels=this.channels||4)-1],f(this.internalformat,"invalid number of channels"));l=this.internalformat;if(6402===l||34041===l)f(h.webgl_depth_texture,"depth/stencil texture not supported"),6402===l&&f(5123===this.type||5125,"depth texture type must be uint16 or uint32"),34041===l&&f(34042===this.type,"depth stencil texture format must match type"),
f(!this.data&&!m&&!this.image&&!this.video&&!this.canvas,"depth/stencil textures are for rendering only");t=this.format=K[l];if(!this.channels)switch(t){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}t=this.type;5126===t?f(h.oes_texture_float,"float texture not supported"):36193===t?f(h.oes_texture_half_float,"half float texture not supported"):t||(t=6402===l?5125:5121);this.type=t;if(p)switch(t){case 5121:this.data=
new Uint8Array(m);break;case 5123:this.data=new Uint16Array(m);break;case 5125:this.data=new Uint32Array(m);break;case 5126:this.data=new Float32Array(m);break;case 36193:this.data=n(m);break;case 33635:case 32820:case 32819:case 34042:f.raise("unsupported format for automatic conversion");break;default:f.raise("unsupported type conversion")}if(this.data){if(this.needsTranspose){m=this.data;p=this.width;l=this.height;w=this.channels;r=this.strideX;u=this.strideY;v=this.strideC;A=this.offset;for(var x=
new m.constructor(p*l*w),B=0,E=0;E<l;++E)for(var F=0;F<p;++F)for(var G=0;G<w;++G)x[B++]=m[u*E+r*F+v*G+A];this.data=x}switch(t){case 5121:f(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray,"incompatible pixel type");break;case 33635:case 32820:case 32819:case 5123:case 36193:f(this.data instanceof Uint16Array,"incompatible pixel type");break;case 5125:f(this.data instanceof Uint32Array,"incompatible pixel type");break;case 5126:f(this.data instanceof Float32Array,"incompatible pixel type");
break;default:f.raise("bad or missing pixel type")}}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){d.pixelStorei(37440,this.flipY);d.pixelStorei(37441,this.premultiplyAlpha);d.pixelStorei(37443,this.colorSpace);d.pixelStorei(3317,this.unpackAlignment);var b=this.target,c=this.miplevel,e=this.image,f=this.canvas,h=this.video,k=this.data,n=this.internalformat,l=this.format,p=this.type,q=this.width||
Math.max(1,a.width>>c);a=this.height||Math.max(1,a.height>>c);h&&2<h.readyState?d.texImage2D(b,c,l,l,p,h):e&&e.complete?d.texImage2D(b,c,l,l,p,e):f?d.texImage2D(b,c,l,l,p,f):this.compressed?d.compressedTexImage2D(b,c,n,q,a,0,k):this.copy?(J(),d.copyTexImage2D(b,c,l,this.x,this.y,q,a,0)):k?d.texImage2D(b,c,l,q,a,0,l,p,k):d.texImage2D(b,c,l,q||1,a||1,0,l,p,null)}});k(na.prototype,{parse:function(a){if("object"===typeof a&&a){if("min"in a){var b=a.min;f.parameter(b,da);this.minFilter=da[b]}"mag"in a&&
(b=a.mag,f.parameter(b,ja),this.magFilter=ja[b]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var d=a.wrap;"string"===typeof d?(f.parameter(d,P),b=c=P[d]):Array.isArray(d)&&(f.parameter(d[0],P),f.parameter(d[1],P),b=P[d[0]],c=P[d[1]])}else"wrapS"in a&&(b=a.wrapS,f.parameter(b,P),b=P[b]),"wrapT"in a&&(c=a.wrapT,f.parameter(c,P),c=P[c]);this.wrapS=b;this.wrapT=c;"anisotropic"in a&&(b=a.anisotropic,f("number"===typeof b&&1<=b&&b<=l.maxAnisotropic,"aniso samples must be between 1 and "),this.anisotropic=
a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":f.parameter(a,E,"invalid mipmap hint");this.mipmapHint=E[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a;break;case "object":break;default:f.raise("invalid mipmap type")}}},upload:function(){var a=this.target;d.texParameteri(a,10241,this.minFilter);d.texParameteri(a,10240,this.magFilter);d.texParameteri(a,10242,this.wrapS);d.texParameteri(a,10243,this.wrapT);h.ext_texture_filter_anisotropic&&d.texParameteri(a,
34046,this.anisotropic);this.genMipmaps&&(d.hint(33170,this.mipmapHint),d.generateMipmap(a))}});var V=0,B=0,p={},F=[],G=l.maxTextureUnits,Y=Array(G).map(function(){return null});k(O.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<G;++b){var c=Y[b];if(c){if(0<c.bindCount)continue;c.unit=-1}Y[b]=this;a=b;break}a>=G&&f.raise("insufficient number of texture units");this.unit=a;d.activeTexture(33984+a);d.bindTexture(this.target,this.texture);V=a}return a},unbind:function(){--this.bindCount},
decRef:function(){0===--this.refCount&&ia(this)}});return{create:function(a,b){function c(a,e,f,g,h,k){var m=a||{};34067===b&&6===arguments.length&&(m=[a,e,f,g,h,k]);aa(d,m);c.width=d.params.width;c.height=d.params.height;return c}var d=new O(b);p[d.id]=d;c(a);c._reglType="texture";c._texture=d;c.destroy=function(){d.decRef()};return c},refresh:function(){A(p).forEach(ha);for(var a=0;a<G;++a)Y[a]=null;V=0;d.activeTexture(33984)},clear:function(){for(var a=0;a<G;++a)d.activeTexture(33984+a),d.bindTexture(3553,
null),Y[a]=null;d.activeTexture(33984);V=0;A(p).forEach(ia)},poll:function(){F.forEach(ha)},getTexture:function(a){return null}}}},{"./check":4,"./extend":15,"./is-ndarray":18,"./is-typed-array":19,"./load-texture":21,"./parse-dds":22,"./to-half-float":31,"./values":33}],31:[function(d,h,l){h.exports=function(b){for(var c=new Float32Array(b),c=new Uint32Array(c.buffer),d=new Uint16Array(b.length),a=0;a<b.length;++a)if(isNaN(b[a]))d[a]=65535;else if(Infinity===b[a])d[a]=31744;else if(-Infinity===b[a])d[a]=
64512;else{var h=c[a],f=h>>>31<<15,k=(h<<1>>>24)-127,h=h>>13&1023;d[a]=-24>k?f:-14>k?f+(h+1024>>-14-k):15<k?f+31744:f+(k+15<<10)+h}return d}},{}],32:[function(d,h,l){h.exports=function(b){var c={};return{def:function(d){d=b.id(d);var a=c[d];a||(a=c[d]=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]);return a}}}},{}],33:[function(d,h,l){h.exports=function(b){return Object.keys(b).map(function(c){return b[c]})}},{}],34:[function(d,h,l){h.exports=function(c,d){function a(a){var b=!1;"altKey"in a&&(b=b||a.altKey!==
u.alt,u.alt=!!a.altKey);"shiftKey"in a&&(b=b||a.shiftKey!==u.shift,u.shift=!!a.shiftKey);"ctrlKey"in a&&(b=b||a.ctrlKey!==u.control,u.control=!!a.ctrlKey);"metaKey"in a&&(b=b||a.metaKey!==u.meta,u.meta=!!a.metaKey);return b}function h(c,f){var k=b.x(f),l=b.y(f);"buttons"in f&&(c=f.buttons|0);if(c!==x||k!==m||l!==H||a(f))x=c|0,m=k||0,H=l||0,d&&d(x,m,H,u)}function f(a){h(0,a)}function k(){if(x||m||H||u.shift||u.alt||u.meta||u.control)x=m=H=0,u.shift=u.alt=u.control=u.meta=!1,d&&d(0,0,0,u)}function l(b){a(b)&&
d&&d(x,m,H,u)}function Q(a){0===b.buttons(a)?h(0,a):h(x,a)}function M(a){h(x|b.buttons(a),a)}function y(a){h(x&~b.buttons(a),a)}function n(){J||(J=!0,c.addEventListener("mousemove",Q),c.addEventListener("mousedown",M),c.addEventListener("mouseup",y),c.addEventListener("mouseleave",f),c.addEventListener("mouseenter",f),c.addEventListener("mouseout",f),c.addEventListener("mouseover",f),c.addEventListener("blur",k),c.addEventListener("keyup",l),c.addEventListener("keydown",l),c.addEventListener("keypress",
l),c!==window&&(window.addEventListener("blur",k),window.addEventListener("keyup",l),window.addEventListener("keydown",l),window.addEventListener("keypress",l)))}function r(){J&&(J=!1,c.removeEventListener("mousemove",Q),c.removeEventListener("mousedown",M),c.removeEventListener("mouseup",y),c.removeEventListener("mouseleave",f),c.removeEventListener("mouseenter",f),c.removeEventListener("mouseout",f),c.removeEventListener("mouseover",f),c.removeEventListener("blur",k),c.removeEventListener("keyup",
l),c.removeEventListener("keydown",l),c.removeEventListener("keypress",l),c!==window&&(window.removeEventListener("blur",k),window.removeEventListener("keyup",l),window.removeEventListener("keydown",l),window.removeEventListener("keypress",l)))}d||(d=c,c=window);var x=0,m=0,H=0,u={shift:!1,alt:!1,control:!1,meta:!1},J=!1;n();var U={element:c};Object.defineProperties(U,{enabled:{get:function(){return J},set:function(a){a?n():r},enumerable:!0},buttons:{get:function(){return x},enumerable:!0},x:{get:function(){return m},
enumerable:!0},y:{get:function(){return H},enumerable:!0},mods:{get:function(){return u},enumerable:!0}});return U};var b=d("mouse-event")},{"mouse-event":35}],35:[function(d,h,l){function b(b){return b.target||b.srcElement||window}l.buttons=function(b){if("object"===typeof b){if("buttons"in b)return b.buttons;if("which"in b){b=b.which;if(2===b)return 4;if(3===b)return 2;if(0<b)return 1<<b-1}else if("button"in b){b=b.button;if(1===b)return 4;if(2===b)return 2;if(0<=b)return 1<<b}}return 0};l.element=
b;l.x=function(c){if("object"===typeof c){if("offsetX"in c)return c.offsetX;var d=b(c).getBoundingClientRect();return c.clientX-d.left}return 0};l.y=function(c){if("object"===typeof c){if("offsetY"in c)return c.offsetY;var d=b(c).getBoundingClientRect();return c.clientY-d.top}return 0}},{}],36:[function(d,h,l){var b=d("./lib/check"),c=d("./lib/extend"),e=d("./lib/context"),a=d("./lib/strings"),q=d("./lib/extension"),f=d("./lib/limits"),k=d("./lib/buffer"),A=d("./lib/elements"),Q=d("./lib/texture"),
M=d("./lib/renderbuffer"),y=d("./lib/framebuffer"),n=d("./lib/uniform"),r=d("./lib/attribute"),x=d("./lib/shader"),m=d("./lib/draw"),H=d("./lib/state"),u=d("./lib/compile"),J=d("./lib/read"),U=d("./lib/dynamic"),w=d("./lib/raf"),na=d("./lib/clock");h.exports=function(){function d(){R=w.next(d);G.count+=1;if(G.width!==E.drawingBufferWidth||G.height!==E.drawingBufferHeight)G.width=E.drawingBufferWidth,G.height=E.drawingBufferHeight,Y.notifyViewportChanged();var a=na();G.dt=a-G.t;G.t=a;B.poll();for(var b=
0;b<t.length;++b)(0,t[b])(G.count,G.t,G.dt);G.renderTime=na()-a}function h(){R&&(w.cancel(d),R=0)}function l(a){h();a.preventDefault();if(P.onContextLost)P.onContextLost()}function ha(a){E.getError();ja.refresh();S.refresh();B.refresh();p.refresh();F.refresh();K.refresh();Y.refresh();if(P.onContextRestored)P.onContextRestored();d()}function ma(a){function d(a){var b={},c={};Object.keys(a).forEach(function(d){var f=a[d];U.isDynamic(f)?(e=!0,c[d]=U.unbox(f,d)):b[d]=f});return{dynamic:c,"static":b}}
b(!!a,"invalid args to regl({...})");b.type(a,"object","invalid args to regl({...})");var e=!1,f=d(a.uniforms||{}),h=d(a.attributes||{});a=d(function(a){function b(a){if(a in d){var c=d[a];delete d[a];Object.keys(c).forEach(function(b){d[a+"."+b]=c[b]})}}var d=c({},a);delete d.uniforms;delete d.attributes;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return d}(a));var f=g.command(a["static"],f["static"],h["static"],a.dynamic,f.dynamic,h.dynamic,e),k=f.draw,
l=f.batch,m=f.scope,n=[];return function(a,b){if("number"===typeof a){for(var c=a|0;n.length<c;)n.push(null);return l(a|0,n)}return Array.isArray(a)?l(a.length,a):"function"===typeof a?m(null,a):"function"===typeof b?m(a,b):k(a)}}function ea(){F.poll();Y.poll()}var ia=e(Array.prototype.slice.call(arguments)),E=ia.gl,P=ia.options,ia=a(),ja=q(E),da=ja.extensions,fa={width:E.drawingBufferWidth,height:E.drawingBufferHeight},Z=f(E,da),S=k(E),X=A(E,da,S),la=n(ia),v=r(E,da,Z,S,ia),K=x(E,v,la,function(a){return g.draw(a)},
ia),V=m(E,da,S),B=Q(E,da,Z,ea,fa),p=M(E,da,Z),F=y(E,da,Z,B,p),G={count:0,start:na(),dt:0,t:na(),renderTime:0,width:E.drawingBufferWidth,height:E.drawingBufferHeight,pixelRatio:P.pixelRatio},Y=H(E,F,fa),fa=J(E,ea,fa),g=u(E,ia,da,Z,S,X,B,F,Y,la,v,K,V,G,ea),I=E.canvas,t=[],R=0;I&&(I.addEventListener("webglcontextlost",l,!1),I.addEventListener("webglcontextrestored",ha,!1));return c(ma,{clear:function(a){var c=0;ea();var d=a.color;d&&(E.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in
a&&(E.clearDepth(+a.depth),c|=256);"stencil"in a&&(E.clearStencil(a.stencil|0),c|=1024);b(!!c,"called regl.clear with no buffer specified");E.clear(c)},prop:U.define,draw:ma({}),elements:function(a){return X.create(a)},buffer:function(a){return S.create(a,34962)},texture:function(a){return B.create(a,3553)},cube:function(a){return 6===arguments.length?B.create(Array.prototype.slice.call(arguments),34067):B.create(a,34067)},renderbuffer:function(a){return p.create(a)},framebuffer:function(a){return F.create(a)},
framebufferCube:function(a){b.raise("framebuffer cube not yet implemented")},frame:function(a){t.push(a);!R&&0<t.length&&d();return{cancel:function(){var b=t.find(function(b){return b===a});0>b||(t.splice(b,1),0>=t.length&&h())}}},stats:G,limits:Z,read:fa,destroy:function(){h();I&&(I.removeEventListener("webglcontextlost",l),I.removeEventListener("webglcontextrestored",ha));K.clear();F.clear();p.clear();B.clear();S.clear();if(P.onDestroy)P.onDestroy()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/check":4,
"./lib/clock":5,"./lib/compile":7,"./lib/context":11,"./lib/draw":12,"./lib/dynamic":13,"./lib/elements":14,"./lib/extend":15,"./lib/extension":16,"./lib/framebuffer":17,"./lib/limits":20,"./lib/raf":23,"./lib/read":24,"./lib/renderbuffer":25,"./lib/shader":26,"./lib/state":28,"./lib/strings":29,"./lib/texture":30,"./lib/uniform":32}]},{},[1]);
