(function e$$0(q,v,g){function a(b,f){if(!v[b]){if(!q[b]){var e="function"==typeof require&&require;if(!f&&e)return e(b,!0);if(l)return l(b,!0);e=Error("Cannot find module '"+b+"'");throw e.code="MODULE_NOT_FOUND",e;}e=v[b]={exports:{}};q[b][0].call(e.exports,function(f){var e=q[b][1][f];return a(e?e:f)},e,e.exports,e$$0,q,v,g)}return v[b].exports}for(var l="function"==typeof require&&require,e=0;e<g.length;e++)a(g[e]);return a})({1:[function(h,q,v){var g=h("../regl")(),a=h("mouse-change")(),l=g.texture(),
e=g({frag:"\n  precision mediump float;\n  uniform sampler2D texture;\n  uniform vec2 mouse;\n  uniform float t;\n  varying vec2 uv;\n  void main () {\n    float dist = length(gl_FragCoord.xy - mouse);\n    gl_FragColor = vec4(0.98 * texture2D(texture,\n      uv + cos(t) * vec2(0.5 - uv.y, uv.x - 0.5) - sin(2.0 * t) * (uv - 0.5)).rgb, 1) +\n      exp(-0.01 * dist) * vec4(\n        1.0 + cos(2.0 * t),\n        1.0 + cos(2.0 * t + 1.5),\n        1.0 + cos(2.0 * t + 3.0),\n        0.0);\n  }",vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main () {\n    uv = position;\n    gl_Position = vec4(2.0 * position - 1.0, 0, 1);\n  }",
attributes:{position:[-2,0,0,-2,2,2]},uniforms:{texture:l,mouse:function(b){var f=b.pixelRatio;return[a.x*f,b.viewportHeight-a.y*f]},t:function(a){return.01*a.tick}},count:3});g.frame(function(){g.updateTimer();g.clear({color:[0,0,0,1]});e();l({copy:!0})})},{"../regl":35,"mouse-change":33}],2:[function(h,q,v){function g(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}q.exports=function(a,l,e,b,f){a=e.maxAttributes;
l=Array(a);for(e=0;e<a;++e)l[e]=new g;return{Record:g,scope:{},state:l}}},{}],3:[function(h,q,v){function g(a){return w[Object.prototype.toString.call(a)]|0}function a(a,b){for(var f=0;f<b.length;++f)a[f]=b[f]}function l(a,b,f,e,g,l,c){for(var h=0,p=0;p<f;++p)for(var K=0;K<e;++K)a[h++]=b[g*p+l*K+c]}function e(a,b,f){for(var e=0,g=0;g<b.length;++g)for(var l=b[g],c=0;c<f;++c)a[e++]=l[c]}var b=h("./util/is-typed-array"),f=h("./util/is-ndarray"),z=h("./util/values"),D=h("./util/pool"),w=h("./constants/arraytypes.json"),
x=h("./constants/dtypes.json"),F=h("./constants/usage.json");q.exports=function(h,q){function t(a){this.id=c++;this.buffer=h.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121}function u(a,b,f){a.byteLength=b.byteLength;h.bufferData(a.type,b,f)}function B(c,p,h,k,t){c.usage=h;if(Array.isArray(p))c.dtype=k||5126,0<p.length&&(Array.isArray(p[0])?(c.dimension=p[0].length,k=D.allocType(c.dtype,p.length*c.dimension),e(k,p,c.dimension),u(c,k,h),D.freeType(k)):
"number"===typeof p[0]?(c.dimension=t,k=D.allocType(c.dtype,p.length),a(k,p),u(c,k,h),D.freeType(k)):b(p[0])&&(c.dimension=p[0].length,c.dtype=k||g(p[0])||5126,k=D.allocType(c.dtype,p.length*c.dimension),e(k,p,c.dimension),u(c,k,h),D.freeType(k)));else if(b(p))c.dtype=k||g(p),c.dimension=t,u(c,p,h);else if(f(p)){var z=p.shape,E=p.stride;t=p.offset;var F=0,C=0,q=0,N=0;1===z.length?(F=z[0],C=1,q=E[0],N=0):2===z.length&&(F=z[0],C=z[1],q=E[0],N=E[1]);c.dtype=k||g(p.data)||5126;c.dimension=C;k=D.allocType(c.dtype,
F*C);l(k,p.data,F,C,q,N,t);u(c,k,h);D.freeType(k)}}function k(a){q.bufferCount--;h.deleteBuffer(a.buffer);a.buffer=null;delete T[a.id]}var c=0,T={};t.prototype.bind=function(){h.bindBuffer(this.type,this.buffer)};t.prototype.destroy=function(){k(this)};var p=[];return{create:function(c,p,u){function z(a){var c=35044,e=null,p=0,g=0,k=1;Array.isArray(a)||b(a)||f(a)?e=a:"number"===typeof a?p=a|0:a&&("data"in a&&(e=a.data),"usage"in a&&(c=F[a.usage]),"type"in a&&(g=x[a.type]),"dimension"in a&&(k=a.dimension|
0),"length"in a&&(p=a.length|0));w.bind();e?B(w,e,c,g,k):(h.bufferData(w.type,p,c),w.dtype=g||5121,w.usage=c,w.dimension=k,w.byteLength=p);return z}q.bufferCount++;var w=new t(p);T[w.id]=w;u||z(c);z._reglType="buffer";z._buffer=w;z.subdata=function(c,p){var k=(p||0)|0;w.bind();if(Array.isArray(c)){if(0<c.length)if("number"===typeof c[0]){var K=D.allocType(w.dtype,c.length);a(K,c);h.bufferSubData(w.type,k,K);D.freeType(K)}else if(Array.isArray(c[0])||b(c[0])){var K=c[0].length,t=D.allocType(w.dtype,
c.length*K);e(t,c,K);h.bufferSubData(w.type,k,t);D.freeType(t)}}else if(b(c))h.bufferSubData(w.type,k,c);else if(f(c)){var u=c.shape,F=c.stride,q=t=K=0,B=0;1===u.length?(K=u[0],t=1,q=F[0],B=0):2===u.length&&(K=u[0],t=u[1],q=F[0],B=F[1]);u=Array.isArray(c.data)?w.dtype:g(c.data);u=D.allocType(u,K*t);l(u,c.data,K,t,q,B,c.offset);h.bufferSubData(w.type,k,u);D.freeType(u)}return z};z.destroy=function(){k(w)};return z},createStream:function(a,c){var b=p.pop();b||(b=new t(a),b.buffer=h.createBuffer());
b.bind();B(b,c,35040,0,1);return b},destroyStream:function(a){p.push(a)},clear:function(){z(T).forEach(k)},getBuffer:function(a){return a&&a._buffer instanceof t?a._buffer:null},_initBuffer:B}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],4:[function(h,q,v){q.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,
"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(h,q,v){q.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(h,q,v){q.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(h,q,v){q.exports={"static":35044,
dynamic:35048,stream:35040}},{}],8:[function(h,q,v){function g(a){return Array.isArray(a)||w(a)||x(a)}function a(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function l(a,b,c,f){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=f}function e(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function b(a){return new l(!1,!1,!1,a)}function f(a,b){var c=a.type;return 0===c?(c=a.data.length,new l(!0,1<=c,2<=c,b)):new l(3===c,2===c,1===c,b)}var z=h("./util/codegen"),
D=h("./util/loop"),w=h("./util/is-typed-array"),x=h("./util/is-ndarray"),F=h("./util/is-array-like"),C=h("./constants/primitives.json"),M=h("./constants/dtypes.json"),t=["x","y","z","w"],u={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},
B={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},k={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},c={cw:2304,ccw:2305},T=new l(!1,!1,!1,function(){});q.exports=function(p,h,q,w,x,v,ea,E,H,W,aa,N,fa,ka){function R(a){return a.replace(".","_")}function L(a,d,c){var b=R(a);za.push(a);xa[b]=r[b]=!!c;na[b]=
d}function I(a,d,b){var c=R(a);za.push(a);Array.isArray(b)?(r[c]=b.slice(),xa[c]=b.slice()):r[c]=xa[c]=b;oa[c]=d}function X(){var a=z(),d=a.link,b=a.global;a.id=Ka++;a.batchId="0";var c=d(Ha),A=a.shared={props:"a0"};Object.keys(Ha).forEach(function(n){A[n]=b.def(c,".",n)});var J=a.next={},f=a.current={};Object.keys(oa).forEach(function(n){Array.isArray(r[n])&&(J[n]=b.def(A.next,".",n),f[n]=b.def(A.current,".",n))});var n=a.constants={};Object.keys(Aa).forEach(function(a){n[a]=b.def(JSON.stringify(Aa[a]))});
a.invoke=function(n,b){switch(b.type){case 0:var c=["this",A.context,A.props,a.batchId];return n.def(d(b.data),".call(",c.slice(0,Math.max(b.data.length+1,4)),")");case 1:return n.def(A.props,b.data);case 2:return n.def(A.context,b.data);case 3:return n.def("this",b.data)}};a.attribCache={};var Fa={};a.scopeAttrib=function(n){n=h.id(n);if(n in Fa)return Fa[n];var a=W.scope[n];a||(a=W.scope[n]=new la);return Fa[n]=d(a)};return a}function ha(a){var d=a["static"];a=a.dynamic;if("framebuffer"in d){var c=
d.framebuffer;return c?(c=E.getFramebuffer(c),b(function(a,d){var m=a.link(c),n=a.shared;d.set(n.framebuffer,".next",m);n=n.context;d.set(n,".framebufferWidth",m+".width");d.set(n,".framebufferHeight",m+".height");return m})):b(function(a,d){var m=a.shared;d.set(m.framebuffer,".next","null");m=m.context;d.set(m,".framebufferWidth",m+".drawingBufferWidth");d.set(m,".framebufferHeight",m+".drawingBufferHeight");return"null"})}if("framebuffer"in a){var e=a.framebuffer;return f(e,function(a,d){var m=
a.invoke(d,e),n=a.shared,b=n.framebuffer,m=d.def(b,".getFramebuffer(",m,")");d.set(b,".next",m);n=n.context;d.set(n,".framebufferWidth",m+"?"+m+".width:"+n+".drawingBufferWidth");d.set(n,".framebufferHeight",m+"?"+m+".height:"+n+".drawingBufferHeight");return m})}return null}function pa(a,d){function b(a){if(a in c){var m=c[a];a=!0;var Ia=m.x|0,J=m.y|0,e,ra;"width"in m?e=m.width|0:a=!1;"height"in m?ra=m.height|0:a=!1;return new l(!a&&d&&d.thisDep,!a&&d&&d.contextDep,!a&&d&&d.propDep,function(a,n){var d=
a.shared.context,b=e;"width"in m||(b=n.def(d,".","framebufferWidth","-",Ia));var c=ra;"height"in m||(c=n.def(d,".","framebufferHeight","-",J));return[Ia,J,b,c]})}if(a in A){var r=A[a];a=f(r,function(a,n){var d=a.invoke(n,r),m=a.shared.context,b=n.def(d,".x|0"),c=n.def(d,".y|0"),G=n.def('"width" in ',d,"?",d,".width|0:","(",m,".","framebufferWidth","-",b,")"),d=n.def('"height" in ',d,"?",d,".height|0:","(",m,".","framebufferHeight","-",c,")");return[b,c,G,d]});d&&(a.thisDep=a.thisDep||d.thisDep,a.contextDep=
a.contextDep||d.contextDep,a.propDep=a.propDep||d.propDep);return a}return d?new l(d.thisDep,d.contextDep,d.propDep,function(a,n){var d=a.shared.context;return[0,0,n.def(d,".","framebufferWidth"),n.def(d,".","framebufferHeight")]}):null}var c=a["static"],A=a.dynamic,J=b("viewport");if(J)var e=J,J=new l(J.thisDep,J.contextDep,J.propDep,function(a,d){var m=e.append(a,d),b=a.shared.context;d.set(b,".viewportWidth",m[2]);d.set(b,".viewportHeight",m[3]);return m});return{viewport:J,scissor_box:b("scissor.box")}}
function sa(a){function d(a){if(a in c){var m=h.id(c[a]);a=b(function(){return m});a.id=m;return a}if(a in r){var G=r[a];return f(G,function(a,d){var n=a.invoke(d,G);return d.def(a.shared.strings,".id(",n,")")})}return null}var c=a["static"],r=a.dynamic,A=d("frag"),J=d("vert"),g=null;e(A)&&e(J)?(g=aa.program(J.id,A.id),a=b(function(a,d){return a.link(g)})):a=new l(A&&A.thisDep||J&&J.thisDep,A&&A.contextDep||J&&J.contextDep,A&&A.propDep||J&&J.propDep,function(a,d){var m=a.shared.shader,b;b=A?A.append(a,
d):d.def(m,".","frag");var c;c=J?J.append(a,d):d.def(m,".","vert");return d.def(m+".program("+c+","+b+")")});return{frag:A,vert:J,progVar:a,program:g}}function ia(a){function d(a,n){if(a in c){var m=c[a]|0;return b(function(a,d){n&&(a.OFFSET=m);return m})}if(a in r){var G=r[a];return f(G,function(a,d){var m=a.invoke(d,G);n&&(a.OFFSET=m);return m})}return n&&A?b(function(a,d){a.OFFSET="0";return 0}):null}var c=a["static"],r=a.dynamic,A=function(){if("elements"in c){var a=c.elements;g(a)?a=v.getElements(v.create(a)):
a&&(a=v.getElements(a));var d=b(function(d,n){if(a){var m=d.link(a);return d.ELEMENTS=m}return d.ELEMENTS=null});d.value=a;return d}if("elements"in r){var m=r.elements;return f(m,function(a,d){var n=a.shared,c=n.isBufferArgs,n=n.elements,b=a.invoke(d,m),G=d.def("null"),c=d.def(c,"(",b,")"),b=a.cond(c).then(G,"=",n,".createStream(",b,");")["else"](G,"=",n,".getElements(",b,");");d.entry(b);d.exit(a.cond(c).then(n,".destroyStream(",G,");"));return a.ELEMENTS=G})}return null}(),J=d("offset",!0);return{elements:A,
primitive:function(){if("primitive"in c){var a=c.primitive;return b(function(d,n){return C[a]})}if("primitive"in r){var d=r.primitive;return f(d,function(a,m){var c=a.constants.primTypes,b=a.invoke(m,d);return m.def(c,"[",b,"]")})}return A?e(A)?A.value?b(function(a,d){return d.def(a.ELEMENTS,".primType")}):b(function(){return 4}):new l(A.thisDep,A.contextDep,A.propDep,function(a,d){var n=a.ELEMENTS;return d.def(n,"?",n,".primType:",4)}):null}(),count:function(){if("count"in c){var a=c.count|0;return b(function(){return a})}if("count"in
r){var d=r.count;return f(d,function(a,m){return a.invoke(m,d)})}return A?e(A)?A?J?new l(J.thisDep,J.contextDep,J.propDep,function(a,d){return d.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):b(function(a,d){return d.def(a.ELEMENTS,".vertCount")}):b(function(){return-1}):new l(A.thisDep||J.thisDep,A.contextDep||J.contextDep,A.propDep||J.propDep,function(a,d){var n=a.ELEMENTS;return a.OFFSET?d.def(n,"?",n,".vertCount-",a.OFFSET,":-1"):d.def(n,"?",n,".vertCount:-1")}):null}(),instances:d("instances",!1),
offset:J}}function qa(a){var d=a["static"],e=a.dynamic,r={};za.forEach(function(a){function m(n,c){if(a in d){var J=n(d[a]);r[g]=b(function(){return J})}else if(a in e){var k=e[a];r[g]=f(k,function(a,d){return c(a,d,a.invoke(d,k))})}}var g=R(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return m(function(a){return a},function(a,
d,m){return m});case "depth.func":return m(function(a){return B[a]},function(a,d,m){return d.def(a.constants.compareFuncs,"[",m,"]")});case "depth.range":return m(function(a){return a},function(a,d,m){a=d.def("+",m,"[0]");d=d.def("+",m,"[1]");return[a,d]});case "blend.func":return m(function(a){return[u["srcRGB"in a?a.srcRGB:a.src],u["dstRGB"in a?a.dstRGB:a.dst],u["srcAlpha"in a?a.srcAlpha:a.src],u["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,d,m){function c(a,n){var G=d.def('"',a,n,'" in ',m,"?",
m,".",a,n,":",m,".",a);return d.def(b,"[",G,"]")}var b=a.constants.blendFuncs;a=c("src","RGB");var G=c("src","Alpha"),f=c("dst","RGB"),e=c("dst","Alpha");return[a,f,G,e]});case "blend.equation":return m(function(a){if("string"===typeof a)return[ba[a],ba[a]];if("object"===typeof a)return[ba[a.rgb],ba[a.alpha]]},function(a,d,m){var c=a.constants.blendEquations,b=d.def(),G=d.def();a=a.cond("typeof ",m,'==="string"');a.then(b,"=",G,"=",c,"[",m,"];");a["else"](b,"=",c,"[",m,".rgb];",G,"=",c,"[",m,".alpha];");
d(a);return[b,G]});case "blend.color":return m(function(a){return D(4,function(d){return+a[d]})},function(a,d,m){return D(4,function(a){return d.def("+",m,"[",a,"]")})});case "stencil.mask":return m(function(a){return a|0},function(a,d,m){return d.def(m,"|0")});case "stencil.func":return m(function(a){return[B[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,d,m){a=d.def('"cmp" in ',m,"?",a.constants.compareFuncs,"[",m,".cmp]",":",7680);var c=d.def(m,".ref|0");d=d.def('"mask" in ',m,"?",
m,".mask|0:-1");return[a,c,d]});case "stencil.opFront":case "stencil.opBack":return m(function(d){return["stencil.opBack"===a?1029:1028,k[d.fail||"keep"],k[d.zfail||"keep"],k[d.pass||"keep"]]},function(d,m,c){function b(a){return m.def('"',a,'" in ',c,"?",G,"[",c,".",a,"]:",7680)}var G=d.constants.stencilOps;return["stencil.opBack"===a?1029:1028,b("fail"),b("zfail"),b("pass")]});case "polygonOffset.offset":return m(function(a){return[a.factor|0,a.units|0]},function(a,d,m){a=d.def(m,".factor|0");d=
d.def(m,".units|0");return[a,d]});case "cull.face":return m(function(a){var d=0;"front"===a?d=1028:"back"===a&&(d=1029);return d},function(a,d,m){return d.def(m,'==="front"?',1028,":",1029)});case "lineWidth":return m(function(a){return a},function(a,d,m){return m});case "frontFace":return m(function(a){return c[a]},function(a,d,m){return d.def(m+'==="cw"?2304:2305')});case "colorMask":return m(function(a){return a.map(function(a){return!!a})},function(a,d,m){return D(4,function(a){return"!!"+m+"["+
a+"]"})});case "sample.coverage":return m(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,d,m){a=d.def('"value" in ',m,"?+",m,".value:1");d=d.def("!!",m,".invert");return[a,d]})}});return r}function ma(a){var d=a["static"],c=a.dynamic,e={};Object.keys(d).forEach(function(a){var m=d[a],c;"number"===typeof m||"boolean"===typeof m?c=b(function(){return m}):"function"!==typeof m||"texture2d"!==m._reglType&&"textureCube"!==m._reglType?F(m)&&(c=b(function(a){return a.global.def("[",D(m.length,
function(a){return m[a]}),"]")})):c=b(function(a){return a.link(m)});c.value=m;e[a]=c});Object.keys(c).forEach(function(a){var d=c[a];e[a]=f(d,function(a,m){return a.invoke(m,d)})});return e}function Y(a){var d=a["static"],c=a.dynamic,e={};Object.keys(d).forEach(function(a){var m=d[a],c=h.id(a),n=new la;if(g(m))n.state=1,n.buffer=x.getBuffer(x.create(m,34962,!1)),n.type=n.buffer.dtype;else{var f=x.getBuffer(m);if(f)n.state=1,n.buffer=f,n.type=f.dtype;else if(m.constant){var r=m.constant;n.state=2;
"number"===typeof r?n.x=r:t.forEach(function(a,d){d<r.length&&(n[a]=r[d])})}else{var f=x.getBuffer(m.buffer),k=m.offset|0,ra=m.stride|0,p=m.size|0,y=!!m.normalized,l=0;"type"in m&&(l=M[m.type]);m=m.divisor|0;n.buffer=f;n.state=1;n.size=p;n.normalized=y;n.type=l||f.dtype;n.offset=k;n.stride=ra;n.divisor=m}}e[a]=b(function(a,d){var m=a.attribCache;if(c in m)return m[c];var b={isStream:!1};Object.keys(n).forEach(function(a){b[a]=n[a]});n.buffer&&(b.buffer=a.link(n.buffer));return m[c]=b})});Object.keys(c).forEach(function(a){var d=
c[a];e[a]=f(d,function(a,m){function c(a){m(r[a],"=",b,".",a,"|0;")}var b=a.invoke(m,d),G=a.shared,f=G.isBufferArgs,e=G.buffer,r={isStream:m.def(!1)},g=new la;g.state=1;Object.keys(g).forEach(function(a){r[a]=m.def(""+g[a])});var A=r.buffer,k=r.type;m("if(",f,"(",b,")){",r.isStream,"=true;",A,"=",e,".createStream(",34962,",",b,");",k,"=",A,".dtype;","}else{",A,"=",e,".getBuffer(",b,");","if(",A,"){",k,"=",A,".dtype;","}else if(",b,".constant){",r.state,"=",2,";",t.map(function(a,d){return r[a]+"="+
b+".length>="+d+"?"+b+"["+d+"]:0;"}).join(""),"}else{",A,"=",e,".getBuffer(",b,".buffer);",k,'="type" in ',b,"?",G.glTypes,"[",b,".type]:",A,".dtype;",r.normalized,"=!!",b,".normalized;");c("size");c("offset");c("stride");c("divisor");m("}}");return r})});return e}function ga(a){var d=a["static"],c=a.dynamic,e={};Object.keys(d).forEach(function(a){var m=d[a];e[a]=b(function(a,d){return"number"===typeof m||"boolean"===typeof m?""+m:a.link(m)})});Object.keys(c).forEach(function(a){var d=c[a];e[a]=f(d,
function(a,m){return a.invoke(m,d)})});return e}function Z(a,d,c){var b=a.shared.context,e=a.scope();Object.keys(c).forEach(function(f){d.save(b,"."+f);e(b,".",f,"=",c[f].append(a,d),";")});d(e)}function S(a,d,c){var b=a.shared,e=b.gl,f=b.framebuffer,r;y&&(r=d.def(b.extensions,".webgl_draw_buffers"));var n=a.constants,b=n.drawBuffer,n=n.backBuffer;a=c?c.append(a,d):d.def(f,".next");d("if(",f,".dirty||",a,"!==",f,".cur){","if(",a,"){",e,".bindFramebuffer(",36160,",",a,".framebuffer);");y&&d(r,".drawBuffersWEBGL(",
b,"[",a,".colorAttachments.length]);");d("}else{",e,".bindFramebuffer(",36160,",null);");y&&d(r,".drawBuffersWEBGL(",n,");");d("}",f,".cur=",a,";",f,".dirty=false;","}")}function O(a,d,c){var b=a.shared,f=b.gl,e=a.current,g=a.next,n=b.current,k=b.next,p=a.cond(n,".dirty");za.forEach(function(d){d=R(d);if(!(d in c.state)){var b,G;if(d in g){b=g[d];G=e[d];var y=D(r[d].length,function(a){return p.def(b,"[",a,"]")});p(a.cond(y.map(function(a,d){return a+"!=="+G+"["+d+"]"}).join("||")).then(f,".",oa[d],
"(",y,");",y.map(function(a,d){return G+"["+d+"]="+a}).join(";"),";"))}else b=p.def(k,".",d),y=a.cond(b,"!==",n,".",d),p(y),d in na?y(a.cond(b).then(f,".enable(",na[d],");")["else"](f,".disable(",na[d],");"),n,".",d,"=",b,";"):y(f,".",oa[d],"(",b,");",n,".",d,"=",b,";")}});0===Object.keys(c.state).length&&p(n,".dirty=false;");d(p)}function P(d,c,b,f){var r=d.shared,g=d.current,k=r.current,n=r.gl;a(Object.keys(b)).forEach(function(a){var r=b[a];if(!f||f(r)){var p=r.append(d,c);if(na[a]){var y=na[a];
e(r)?p?c(n,".enable(",y,");"):c(n,".disable(",y,");"):c(d.cond(p).then(n,".enable(",y,");")["else"](n,".disable(",y,");"));c(k,".",a,"=",p,";")}else if(F(p)){var A=g[a];c(n,".",oa[a],"(",p,");",p.map(function(a,d){return A+"["+d+"]="+a}).join(";"),";")}else c(n,".",oa[a],"(",p,");",k,".",a,"=",p,";")}})}function ta(a,c){d&&!a.instancing&&(a.instancing=c.def(a.shared.extensions,".angle_instanced_arrays"))}function Ba(a,d,c){c=a.stats;a=a.shared;ka&&d(a.timer,".beginQuery(",c,");")}function ja(a,d,
c){a=a.shared;ka&&d(a.timer,".endQuery();")}function ca(a,c,b,f,e){function r(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function g(b,f,e){function r(){c("if(!",A,".pointer){",p,".enableVertexAttribArray(",y,");",A,".pointer=true;}");var b=e.type,n;n=e.size?c.def(e.size,"||",f):f;c("if(",A,".type!==",b,"||",A,".size!==",n,"||",ra.map(function(a){return A+"."+a+"!=="+e[a]}).join("||"),
"){",p,".bindBuffer(",34962,",",h,".buffer);",p,".vertexAttribPointer(",[y,n,b,e.normalized,e.stride,e.offset],");",A,".type=",b,";",A,".size=",n,";",ra.map(function(a){return A+"."+a+"="+e[a]+";"}).join(""),"}");d&&(b=e.divisor,c("if(",A,".divisor!==",b,"){",a.instancing,".vertexAttribDivisorANGLE(",[y,b],");",A,".divisor=",b,";}"))}function k(){c("if(",A,".pointer){",p,".disableVertexAttribArray(",y,");",A,".pointer=false;","}if(",t.map(function(a,d){return A+"."+a+"!=="+l[d]}).join("||"),"){",
p,".vertexAttrib4f(",y,",",l,");",t.map(function(a,d){return A+"."+a+"="+l[d]+";"}).join(""),"}")}var p=n.gl,y=c.def(b,".location"),A=c.def(n.attributes,"[",y,"]");b=e.state;var h=e.buffer,l=[e.x,e.y,e.z,e.w],ra=["buffer","normalized","offset","stride"];1===b?r():2===b?k():(c("if(",b,"===",1,"){"),r(),c("}else{"),k(),c("}"))}var n=a.shared;f.forEach(function(d){var f=d.name,n=b.attributes[f],p;if(n){if(!e(n))return;p=n.append(a,c)}else{if(!e(T))return;var k=a.scopeAttrib(f);p={};Object.keys(new la).forEach(function(a){p[a]=
c.def(k,".",a)})}g(a.link(d),r(d.info.type),p)})}function da(a,d,c,b,f){for(var r=a.shared,p=r.gl,n,g=0;g<b.length;++g){var k=b[g],y=k.name,l=k.info.type,u=c.uniforms[y],k=a.link(k)+".location",t;if(u){if(!f(u))continue;if(e(u)){y=u.value;if(35678===l||35680===l)l=a.link(y._texture),d(p,".uniform1i(",k,",",l+".bind());"),d.exit(l,".unbind();");else if(35674===l||35675===l||35676===l)y=a.global.def("new Float32Array(["+Array.prototype.slice.call(y)+"])"),u=2,35675===l?u=3:35676===l&&(u=4),d(p,".uniformMatrix",
u,"fv(",k,",false,",y,");");else{switch(l){case 5126:n="1f";break;case 35664:n="2f";break;case 35665:n="3f";break;case 35666:n="4f";break;case 35670:n="1i";break;case 5124:n="1i";break;case 35671:n="2i";break;case 35667:n="2i";break;case 35672:n="3i";break;case 35668:n="3i";break;case 35673:n="4i";break;case 35669:n="4i"}d(p,".uniform",n,"(",k,",",F(y)?Array.prototype.slice.call(y):y,");")}continue}else t=u.append(a,d)}else{if(!f(T))continue;t=d.def(r.uniforms,"[",h.id(y),"]")}y=1;switch(l){case 35678:case 35680:l=
d.def(t,"._texture");d(p,".uniform1i(",k,",",l,".bind());");d.exit(l,".unbind();");continue;case 5124:case 35670:n="1i";break;case 35667:case 35671:n="2i";y=2;break;case 35668:case 35672:n="3i";y=3;break;case 35669:case 35673:n="4i";y=4;break;case 5126:n="1f";break;case 35664:n="2f";y=2;break;case 35665:n="3f";y=3;break;case 35666:n="4f";y=4;break;case 35674:n="Matrix2fv";break;case 35675:n="Matrix3fv";break;case 35676:n="Matrix4fv"}d(p,".uniform",n,"(",k,",");if("M"===n.charAt(0)){var k=Math.pow(l-
35674+2,2),z=a.global.def("new Float32Array(",k,")");d("false,(Array.isArray(",t,")||",t," instanceof Float32Array)?",t,":(",D(k,function(a){return z+"["+a+"]="+t+"["+a+"]"}),",",z,")")}else 1<y?d(D(y,function(a){return t+"["+a+"]"})):d(t);d(");")}}function ya(a,c,b,f){function r(d){var e=l[d];return e?e.contextDep&&f.contextDynamic||e.propDep?e.append(a,b):e.append(a,c):c.def(g,".",d)}function y(){function a(){b(K,".drawElementsInstancedANGLE(",[u,z,q,t+"<<(("+q+"-5121)>>1)",E],");")}function d(){b(K,
".drawArraysInstancedANGLE(",[u,t,z,E],");")}h?F?a():(b("if(",h,"){"),a(),b("}else{"),d(),b("}")):d()}function k(){function a(){b(p+".drawElements("+[u,z,q,t+"<<(("+q+"-5121)>>1)"]+");")}function d(){b(p+".drawArrays("+[u,t,z]+");")}h?F?a():(b("if(",h,"){"),a(),b("}else{"),d(),b("}")):d()}var n=a.shared,p=n.gl,g=n.draw,l=f.draw,h=function(){var d=l.elements,e=c;if(d){if(d.contextDep&&f.contextDynamic||d.propDep)e=b;d=d.append(a,e)}else d=e.def(g,".","elements");d&&e("if("+d+")"+p+".bindBuffer(34963,"+
d+".buffer.buffer);");return d}(),u=r("primitive"),t=r("offset"),z=function(){var d=l.count,e=c;if(d){if(d.contextDep&&f.contextDynamic||d.propDep)e=b;d=d.append(a,e)}else d=e.def(g,".","count");return d}();if("number"===typeof z){if(0===z)return}else b("if(",z,"){"),b.exit("}");var E,K;d&&(E=r("instances"),K=a.instancing);var q=h+".type",F=l.elements&&e(l.elements);d&&("number"!==typeof E||0<=E)?"string"===typeof E?(b("if(",E,">0){"),y(),b("}else if(",E,"<0){"),k(),b("}")):y():k()}function va(a,
b,c,e,f){b=X();f=b.proc("body",f);d&&(b.instancing=f.def(b.shared.extensions,".angle_instanced_arrays"));a(b,f,c,e);return b.compile().body}function Ca(a,d,b,c){ta(a,d);ca(a,d,b,c.attributes,function(){return!0});da(a,d,b,c.uniforms,function(){return!0});ya(a,d,d,b)}function Da(a,d){var b=a.proc("draw",1);ta(a,b);Z(a,b,d.context);S(a,b,d.framebuffer);O(a,b,d);P(a,b,d.state);Ba(a,b,d);var c=d.shader.progVar.append(a,b);b(a.shared.gl,".useProgram(",c,".program);");if(d.shader.program)Ca(a,b,d,d.shader.program);
else{var e=a.global.def("{}"),f=b.def(c,".id"),r=b.def(e,"[",f,"]");b(a.cond(r).then(r,".call(this,a0);")["else"](r,"=",e,"[",f,"]=",a.link(function(b){return va(Ca,a,d,b,1)}),"(",c,");",r,".call(this,a0);"))}0<Object.keys(d.state).length&&b(a.shared.current,".dirty=true;");ja(a,b,d)}function Ea(a,d,b,c){function e(){return!0}a.batchId="a1";ta(a,d);ca(a,d,b,c.attributes,e);da(a,d,b,c.uniforms,e);ya(a,d,d,b)}function ua(a,d,b,c){function e(a){return a.contextDep&&r||a.propDep}function f(a){return!e(a)}
ta(a,d);var r=b.contextDep,n=d.def(),y=d.def();a.shared.props=y;a.batchId=n;var k=a.scope(),p=a.scope();d(k.entry,"for(",n,"=0;",n,"<","a1",";++",n,"){",y,"=","a0","[",n,"];",p,"}",k.exit);b.needsContext&&Z(a,p,b.context);b.needsFramebuffer&&S(a,p,b.framebuffer);P(a,p,b.state,e);c?(ca(a,k,b,c.attributes,f),ca(a,p,b,c.attributes,e),da(a,k,b,c.uniforms,f),da(a,p,b,c.uniforms,e),ya(a,k,p,b)):(d=a.global.def("{}"),c=b.shader.progVar.append(a,p),y=p.def(c,".id"),k=p.def(d,"[",y,"]"),p(a.shared.gl,".useProgram(",
c,".program);","if(!",k,"){",k,"=",d,"[",y,"]=",a.link(function(d){return va(Ea,a,b,d,2)}),"(",c,");}",k,".call(this,a0[",n,"],",n,");"))}function Ga(a,d){var b=a.proc("batch",2);a.batchId="0";ta(a,b);var c=!1,e=!0;Object.keys(d.context).forEach(function(a){c=c||d.context[a].propDep});c||(Z(a,b,d.context),e=!1);var f=d.framebuffer,r=!1;f?(f.propDep?c=r=!0:f.contextDep&&c&&(r=!0),r||S(a,b,f)):S(a,b,null);d.state.viewport&&d.state.viewport.propDep&&(c=!0);O(a,b,d);P(a,b,d.state,function(a){return!(a.contextDep&&
c||a.propDep)});Ba(a,b,d);d.contextDep=c;d.needsContext=e;d.needsFramebuffer=r;e=d.shader.progVar;if(e.contextDep&&c||e.propDep)ua(a,b,d,null);else if(e=e.append(a,b),b(a.shared.gl,".useProgram(",e,".program);"),d.shader.program)ua(a,b,d,d.shader.program);else{var f=a.global.def("{}"),r=b.def(e,".id"),n=b.def(f,"[",r,"]");b(a.cond(n).then(n,".call(this,a0,a1);")["else"](n,"=",f,"[",r,"]=",a.link(function(b){return va(ua,a,d,b,2)}),"(",e,");",n,".call(this,a0,a1);"))}0<Object.keys(d.state).length&&
b(a.shared.current,".dirty=true;");ja(a,b,d)}function wa(d,b){function c(a){var r=b.shader[a];r&&e.set(f.shader,"."+a,r.append(d,e))}var e=d.proc("scope",3);d.batchId="a2";var f=d.shared,r=f.current,p=f.timer,n;ka&&(n=e.def(p,".getNumPendingQueries()"));Z(d,e,b.context);b.framebuffer&&b.framebuffer.append(d,e);a(Object.keys(b.state)).forEach(function(a){var c=b.state[a].append(d,e);F(c)?c.forEach(function(b,c){e.set(d.next[a],"["+c+"]",b)}):e.set(f.next,"."+a,c)});["elements","offset","count","instances",
"primitive"].forEach(function(a){var c=b.draw[a];c&&e.set(f.draw,"."+a,""+c.append(d,e))});Object.keys(b.uniforms).forEach(function(a){e.set(f.uniforms,"["+h.id(a)+"]",b.uniforms[a].append(d,e))});Object.keys(b.attributes).forEach(function(a){var c=b.attributes[a].append(d,e),f=d.scopeAttrib(a);Object.keys(new la).forEach(function(a){e.set(f,"."+a,c[a])})});c("vert");c("frag");0<Object.keys(b.state).length&&(e(r,".dirty=true;"),e.exit(r,".dirty=true;"));e("a1(",d.shared.context,",a0,0);");if(ka){var y=
d.stats,r=e.def(p,".getNumPendingQueries()-1");e(p,".pushScopeStats(",n,",",r,",",y,");")}}var la=W.Record,ba={add:32774,subtract:32778,"reverse subtract":32779};q.ext_blend_minmax&&(ba.min=32775,ba.max=32776);var d=q.angle_instanced_arrays,y=q.webgl_draw_buffers,r={dirty:!0},xa={},za=[],na={},oa={};L("dither",3024);L("blend.enable",3042);I("blend.color","blendColor",[0,0,0,0]);I("blend.equation","blendEquationSeparate",[32774,32774]);I("blend.func","blendFuncSeparate",[1,0,1,0]);L("depth.enable",
2929,!0);I("depth.func","depthFunc",513);I("depth.range","depthRange",[0,1]);I("depth.mask","depthMask",!0);I("colorMask","colorMask",[!0,!0,!0,!0]);L("cull.enable",2884);I("cull.face","cullFace",1029);I("frontFace","frontFace",2305);I("lineWidth","lineWidth",1);L("polygonOffset.enable",32823);I("polygonOffset.offset","polygonOffset",[0,0]);L("sample.alpha",32926);L("sample.enable",32928);I("sample.coverage","sampleCoverage",[1,!1]);L("stencil.enable",2960);I("stencil.mask","stencilMask",-1);I("stencil.func",
"stencilFunc",[519,0,-1]);I("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);I("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);L("scissor.enable",3089);I("scissor.box","scissor",[0,0,p.drawingBufferWidth,p.drawingBufferHeight]);I("viewport","viewport",[0,0,p.drawingBufferWidth,p.drawingBufferHeight]);var Ha={gl:p,context:fa,strings:h,next:xa,current:r,draw:N,elements:v,buffer:x,shader:aa,attributes:W.state,uniforms:H,framebuffer:E,extensions:q,timer:ka,isBufferArgs:g},Aa={primTypes:C,
compareFuncs:B,blendFuncs:u,blendEquations:ba,stencilOps:k,glTypes:M,orientationType:c};y&&(Aa.backBuffer=[1029],Aa.drawBuffer=D(w.maxDrawbuffers,function(a){return 0===a?[0]:D(a,function(a){return 36064+a})}));var Ka=0;return{next:xa,current:r,procs:function(){var a=X(),d=a.proc("poll"),b=a.proc("refresh"),c=a.block();d(c);b(c);var e=a.shared,f=e.gl,p=e.next,n=e.current;c(n,".dirty=false;");S(a,d);b(e.framebuffer,".dirty=true;");S(a,b);Object.keys(na).forEach(function(e){var r=na[e],y=c.def(p,".",
e),k=a.block();k("if(",y,"){",f,".enable(",r,")}else{",f,".disable(",r,")}",n,".",e,"=",y,";");b(k);d("if(",y,"!==",n,".",e,"){",k,"}")});Object.keys(oa).forEach(function(e){var y=oa[e],k=r[e],g,l,h=a.block();h(f,".",y,"(");F(k)?(y=k.length,g=a.global.def(p,".",e),l=a.global.def(n,".",e),h(D(y,function(a){return g+"["+a+"]"}),");",D(y,function(a){return l+"["+a+"]="+g+"["+a+"];"}).join("")),d("if(",D(y,function(a){return g+"["+a+"]!=="+l+"["+a+"]"}).join("||"),"){",h,"}")):(g=c.def(p,".",e),l=c.def(n,
".",e),h(g,");",n,".",e,"=",g,";"),d("if(",g,"!==",l,"){",h,"}"));b(h)});return a.compile()}(),compile:function(a,d,b,c,e){var f=X();f.stats=f.link(e);e=ha(a);var r=pa(a,e),y=ia(a),p=qa(a);a=sa(a);var k=r.viewport;k&&(p.viewport=k);k=R("scissor.box");(r=r[k])&&(p[k]=r);r=0<Object.keys(p).length;e={framebuffer:e,draw:y,shader:a,state:p,dirty:r};e.uniforms=ma(b);e.attributes=Y(d);e.context=ga(c);Da(f,e);wa(f,e);Ga(f,e);return f.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,
"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],9:[function(h,q,v){function g(a,f){this.id=e++;this.type=a;this.data=f}function a(b){if(0===b.length)return[];var e=b.charAt(0),g=b.charAt(b.length-1);if(1<b.length&&e===g&&('"'===e||"'"===e))return['"'+b.substr(1,b.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(e=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return a(b.substr(0,e.index)).concat(a(e[1])).concat(a(b.substr(e.index+
e[0].length)));e=b.split(".");if(1===e.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(g=0;g<e.length;++g)b=b.concat(a(e[g]));return b}function l(b){return"["+a(b).join("][")+"]"}var e=0;q.exports={define:function(a,e){switch(typeof e){case "boolean":case "number":case "string":return new g(a,l(e+""));case "undefined":return new g(a|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof g},unbox:function(a,e){if(a instanceof g){if(a.type&
128)return new g(a.type&-129,l(e))}else if("function"===typeof a)return new g(0,a);return a},accessor:l}},{}],10:[function(h,q,v){var g=h("./util/is-typed-array"),a=h("./util/is-ndarray"),l=h("./util/values"),e=h("./constants/primitives.json"),b=h("./constants/usage.json");q.exports=function(f,h,q,w){function x(a){this.id=t++;M[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function F(b,c,e,f,l,u,t){(u=t)||g(c)&&(!a(c)||g(c.data))||(u=h.oes_element_index_uint?5125:5123);b.buffer.bind();
q._initBuffer(b.buffer,c,e,u,3);c=t;if(!t){switch(b.buffer.dtype){case 5121:case 5120:c=5121;break;case 5123:case 5122:c=5123;break;case 5125:case 5124:c=5125}b.buffer.dtype=c}b.type=c;0>l&&(l=b.buffer.byteLength,5123===c?l>>=1:5125===c&&(l>>=2));b.vertCount=l;l=f;0>f&&(l=4,f=b.buffer.dimension,1===f&&(l=0),2===f&&(l=1),3===f&&(l=4));b.primType=l}function C(a){w.elementsCount--;delete M[a.id];a.buffer.destroy();a.buffer=null}var M={},t=0,u={uint8:5121,uint16:5123};h.oes_element_index_uint&&(u.uint32=
5125);x.prototype.bind=function(){this.buffer.bind()};var B=[];return{create:function(k){function c(k){if(k)if("number"===typeof k)l(k),p.primType=4,p.vertCount=k|0,p.type=5121;else{var h=null,t=35044,q=-1,z=-1,C=0,E=0;Array.isArray(k)||g(k)||a(k)?h=k:("data"in k&&(h=k.data),"usage"in k&&(t=b[k.usage]),"primitive"in k&&(q=e[k.primitive]),"count"in k&&(z=k.count|0),"length"in k&&(C=k.length|0),"type"in k&&(E=u[k.type]));h?F(p,h,t,q,z,C,E):(k=p.buffer,k.bind(),f.bufferData(34963,C,t),k.dtype=E||5121,
k.usage=t,k.dimension=3,k.byteLength=C,p.primType=0>q?4:q,p.vertCount=0>z?0:z,p.type=k.dtype)}else l(),p.primType=4,p.vertCount=0,p.type=5121;return c}var l=q.create(null,34963,!0),p=new x(l._buffer);w.elementsCount++;c(k);c._reglType="elements";c._elements=p;c.subdata=function(a,b){l.subdata(a,b);return c};c.destroy=function(){C(p)};return c},createStream:function(a){var b=B.pop();b||(b=new x(q.create(null,34963,!0)._buffer));F(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){B.push(a)},
getElements:function(a){return"function"===typeof a&&a._elements instanceof x?a._elements:null},clear:function(){l(M).forEach(C)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],11:[function(h,q,v){q.exports=function(g){function a(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb ext_disjoint_timer_query angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{l[a]=
g.getExtension(a)}catch(b){}})}var l={};a();return{extensions:l,refresh:a}}},{}],12:[function(h,q,v){var g=h("./util/values"),a=h("./util/extend");q.exports=function(l,e,b,f,h,q){function w(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var e=a=0;b?(a=b.width,e=b.height):c&&(a=c.width,e=c.height);this.width=a;this.height=e}function x(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function F(a,b,c){a&&(a.texture?a.texture._texture.refCount+=
1:a.renderbuffer._renderbuffer.refCount+=1)}function C(a,b){b?b.texture?l.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,0):l.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):l.framebufferTexture2D(36160,a,3553,null,0)}function M(a){var b=3553,c=null,e=null,f=a;"object"===typeof a&&(f=a.data);a=f._reglType;"texture2d"===a?c=f:"textureCube"===a?c=f:"renderbuffer"===a&&(e=f,b=36161);return new w(b,c,e)}function t(a,b,c,e,k){if(c)return a=f.create2D({width:a,
height:b,format:e,type:k}),a._texture.refCount=0,new w(3553,a,null);a=h.create({width:a,height:b,format:e});a._renderbuffer.refCount=0;return new w(36161,null,a)}function u(a){return a&&(a.texture||a.renderbuffer)}function B(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function k(){this.id=U++;ea[this.id]=this;this.framebuffer=l.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=
null}function c(a){a.colorAttachments.forEach(x);x(a.depthAttachment);x(a.stencilAttachment);x(a.depthStencilAttachment)}function v(a){l.deleteFramebuffer(a.framebuffer);a.framebuffer=null;q.framebufferCount--;delete ea[a.id]}function p(a){var c;l.bindFramebuffer(36160,a.framebuffer);var e=a.colorAttachments;for(c=0;c<e.length;++c)C(36064+c,e[c]);for(c=e.length;c<b.maxColorAttachments;++c)C(36064+c,null);C(36096,a.depthAttachment);C(36128,a.stencilAttachment);C(33306,a.depthStencilAttachment);l.checkFramebufferStatus(36160);
l.bindFramebuffer(36160,K.next);K.current=K.next}var K={current:null,next:null,dirty:!1},Ja=["rgba"],Q=["rgba4","rgb565","rgb5 a1"];e.ext_srgb&&Q.push("srgba");e.ext_color_buffer_half_float&&Q.push("rgba16f","rgb16f");e.webgl_color_buffer_float&&Q.push("rgba32f");var V=["uint8"];e.oes_texture_half_float&&V.push("half float");e.oes_texture_float&&V.push("float");var U=0,ea={};return a(K,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof
k)?a:null},create:function(a,b){function f(a,b){var k,l=0,h=0,q=!0,z=!0;k=null;var C=!0,D="rgba",B="uint8",w=1,x=null,v=null,K=null,T=!1;if("number"===typeof a)l=a|0,h=b|0||l;else if(a){"shape"in a?(h=a.shape,l=h[0],h=h[1]):("radius"in a&&(l=h=a.radius),"width"in a&&(l=a.width),"height"in a&&(h=a.height));if("color"in a||"colors"in a)k=a.color||a.colors,Array.isArray(k);k||("colorCount"in a&&(w=a.colorCount|0),"colorTexture"in a&&(C=!!a.colorTexture,D="rgba4"),"colorType"in a&&(B=a.colorType,C||("half float"===
B?e.ext_color_buffer_half_float&&(D="rgba16f"):"float"===B&&e.webgl_color_buffer_float&&(D="rgba32f"))),"colorFormat"in a&&(D=a.colorFormat,0<=Ja.indexOf(D)?C=!0:0<=Q.indexOf(D)&&(C=!1)));if("depthTexture"in a||"depthStencilTexture"in a)T=!(!a.depthTexture&&!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?q=a.depth:(x=a.depth,z=!1));"stencil"in a&&("boolean"===typeof a.stencil?z=a.stencil:(v=a.stencil,q=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?q=z=a.depthStencil:
(K=a.depthStencil,z=q=!1))}else l=h=1;var E=null,H=null,O=null,P=null;if(Array.isArray(k))E=k.map(M);else if(k)E=[M(k)];else for(E=Array(w),k=0;k<w;++k)E[k]=t(l,h,C,D,B);l=l||E[0].width;h=h||E[0].height;x?H=M(x):q&&!z&&(H=t(l,h,T,"depth","uint32"));v?O=M(v):z&&!q&&(O=t(l,h,!1,"stencil","uint8"));K?P=M(K):!x&&!v&&z&&q&&(P=t(l,h,T,"depth stencil","depth stencil"));for(k=0;k<E.length;++k)F(E[k],l,h);F(H,l,h);F(O,l,h);F(P,l,h);c(g);g.width=l;g.height=h;g.colorAttachments=E;g.depthAttachment=H;g.stencilAttachment=
O;g.depthStencilAttachment=P;f.color=E.map(u);f.depth=u(H);f.stencil=u(O);f.depthStencil=u(P);f.width=g.width;f.height=g.height;p(g);return f}var g=new k;q.framebufferCount++;f(a,b);f.resize=function(a,b){var c=a|0,e=b|0||c;if(c===g.width&&e===g.height)return f;for(var k=g.colorAttachments,l=0;l<k.length;++l)B(k[l],c,e);B(g.depthAttachment,c,e);B(g.stencilAttachment,c,e);B(g.depthStencilAttachment,c,e);g.width=f.width=c;g.height=f.height=e;p(g);return f};f._reglType="framebuffer";f._framebuffer=g;
f.destroy=function(){v(g);c(g)};return f},clear:function(){g(ea).forEach(v)}})}},{"./util/extend":23,"./util/values":31}],13:[function(h,q,v){q.exports=function(g,a){var l=1;a.ext_texture_filter_anisotropic&&(l=g.getParameter(34047));var e=1,b=1;a.webgl_draw_buffers&&(e=g.getParameter(34852),b=g.getParameter(36063));return{colorBits:[g.getParameter(3410),g.getParameter(3411),g.getParameter(3412),g.getParameter(3413)],depthBits:g.getParameter(3414),stencilBits:g.getParameter(3415),subpixelBits:g.getParameter(3408),
extensions:Object.keys(a).filter(function(b){return!!a[b]}),maxAnisotropic:l,maxDrawbuffers:e,maxColorAttachments:b,pointSizeDims:g.getParameter(33901),lineWidthDims:g.getParameter(33902),maxViewportDims:g.getParameter(3386),maxCombinedTextureUnits:g.getParameter(35661),maxCubeMapSize:g.getParameter(34076),maxRenderbufferSize:g.getParameter(34024),maxTextureUnits:g.getParameter(34930),maxTextureSize:g.getParameter(3379),maxAttributes:g.getParameter(34921),maxVertexUniforms:g.getParameter(36347),maxVertexTextureUnits:g.getParameter(35660),
maxVaryingVectors:g.getParameter(36348),maxFragmentUniforms:g.getParameter(36349),glsl:g.getParameter(35724),renderer:g.getParameter(7937),vendor:g.getParameter(7936),version:g.getParameter(7938)}}},{}],14:[function(h,q,v){var g=h("./util/is-typed-array");q.exports=function(a,l,e){return function(b){var f=0,h=0,q=e.framebufferWidth,w=e.framebufferHeight,x=null;g(b)?x=b:2===arguments.length?(q=arguments[0]|0,w=arguments[1]|0):b&&(f=b.x|0,h=b.y|0,q=b.width||e.framebufferWidth,w=b.height||e.framebufferHeight,
x=b.data||null);l();x=x||new Uint8Array(q*w*4);a.pixelStorei(3333,4);a.readPixels(f,h,q,w,6408,5121,x);return x}}},{"./util/is-typed-array":26}],15:[function(h,q,v){var g=h("./util/values");q.exports=function(a,l,e,b){function f(a){this.id=w++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0}function h(e){var f=e.renderbuffer;a.bindRenderbuffer(36161,null);a.deleteRenderbuffer(f);e.renderbuffer=null;e.refCount=0;delete x[e.id];b.renderbufferCount--}var q={rgba4:32854,
rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};l.ext_srgb&&(q.srgba=35907);l.ext_color_buffer_half_float&&(q.rgba16f=34842,q.rgb16f=34843);l.webgl_color_buffer_float&&(q.rgba32f=34836);var w=0,x={};f.prototype.decRef=function(){0>=--this.refCount&&h(this)};return{create:function(e,g){function l(b,e){var f=0,c=0,g=32854;"object"===typeof b&&b?("shape"in b?(c=b.shape,f=c[0]|0,c=c[1]|0):("radius"in b&&(f=c=b.radius|0),"width"in b&&(f=b.width|0),"height"in b&&(c=b.height|
0)),"format"in b&&(g=q[b.format])):"number"===typeof b?(f=b|0,c="number"===typeof e?e|0:f):b||(f=c=1);if(f!==h.width||c!==h.height||g!==h.format)return l.width=h.width=f,l.height=h.height=c,h.format=g,a.bindRenderbuffer(36161,h.renderbuffer),a.renderbufferStorage(36161,g,f,c),l}var h=new f(a.createRenderbuffer());x[h.id]=h;b.renderbufferCount++;l(e,g);l.resize=function(b,e){var f=b|0,c=e|0||f;if(f===h.width&&c===h.height)return l;l.width=h.width=f;l.height=h.height=c;a.bindRenderbuffer(36161,h.renderbuffer);
a.renderbufferStorage(36161,h.format,f,c);return l};l._reglType="renderbuffer";l._renderbuffer=h;l.destroy=function(){h.decRef()};return l},clear:function(){g(x).forEach(h)}}}},{"./util/values":31}],16:[function(h,q,v){var g=h("./util/values");q.exports=function(a,l,e){function b(a,b,e,f){this.name=a;this.id=b;this.location=e;this.info=f}function f(a,b){for(var e=0;e<a.length;++e)if(a[e].id===b.id){a[e].location=b.location;return}a.push(b)}function h(b,e,f){f=35632===b?w:x;var g=f[e];if(!g){var c=
l.str(e),g=a.createShader(b);a.shaderSource(g,c);a.compileShader(g);f[e]=g}return g}function q(a,b){this.id=v++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[]}var w={},x={},F={},C=[],v=0;return{clear:function(){var b=a.deleteShader.bind(a);g(w).forEach(b);w={};g(x).forEach(b);x={};C.forEach(function(b){a.deleteProgram(b.program)});C.length=0;F={};e.shaderCount=0},program:function(g,u,w){e.shaderCount++;(w=F[u])||(w=F[u]={});var k=w[g];if(!k){var c=k=new q(u,g),x,
p;x=h(35632,c.fragId);p=h(35633,c.vertId);u=c.program=a.createProgram();a.attachShader(u,x);a.attachShader(u,p);a.linkProgram(u);var v=a.getProgramParameter(u,35718),M=c.uniforms;for(x=0;x<v;++x)if(p=a.getActiveUniform(u,x))if(1<p.size)for(var Q=0;Q<p.size;++Q){var V=p.name.replace("[0]","["+Q+"]");f(M,new b(V,l.id(V),a.getUniformLocation(u,V),p))}else f(M,new b(p.name,l.id(p.name),a.getUniformLocation(u,p.name),p));v=a.getProgramParameter(u,35721);c=c.attributes;for(x=0;x<v;++x)(p=a.getActiveAttrib(u,
x))&&f(c,new b(p.name,l.id(p.name),a.getAttribLocation(u,p.name),p));w[g]=k;C.push(k)}return k},shader:h,frag:null,vert:null}}},{"./util/values":31}],17:[function(h,q,v){q.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0}}},{}],18:[function(h,q,v){q.exports=function(){var g={"":0},a=[""];return{id:function(l){var e=g[l];if(e)return e;e=g[l]=a.length;a.push(l);return e},str:function(g){return a[g]}}}},{}],19:[function(h,
q,v){function g(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function a(a){return Array.isArray(a)&&0!==a.length&&C(a[0])?!0:!1}function l(a){return Object.prototype.toString.call(a)}function e(b){if(!b)return!1;var e=l(b);return 0<=k.indexOf(e)?!0:g(b)||a(b)||w(b)}function b(a,b){36193===a.type?(a.data=F(b),x.freeType(b)):a.data=b}var f=h("./util/extend"),z=h("./util/values"),D=h("./util/is-typed-array"),w=h("./util/is-ndarray"),x=h("./util/pool"),F=h("./util/to-half-float"),
C=h("./util/is-array-like");v=h("./constants/arraytypes.json");var M=h("./constants/arraytypes.json"),t=[9984,9986,9985,9987],u=[0,6409,6410,6407,6408],B={};B[6409]=B[6406]=B[6402]=1;B[34041]=B[6410]=2;B[6407]=3;B[6408]=4;var k=Object.keys(v).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]);q.exports=function(c,h,k,q,v,Q){function V(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=
this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function U(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function ea(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=
b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=Ba[b.colorSpace]);"type"in b&&(a.type=ja[b.type]);var c=a.width,e=a.height,f=a.channels,g=!1;"shape"in b?(c=b.shape[0],e=b.shape[1],3===b.shape.length&&(f=b.shape[2],g=!0)):("radius"in b&&(c=e=b.radius),"width"in b&&(c=b.width),"height"in b&&(e=b.height),"channels"in b&&(f=b.channels,g=!0));a.width=c|0;a.height=e|0;a.channels=f|0;c=!1;"format"in b&&(c=b.format,e=a.internalformat=ca[c],a.format=Ca[e],c in ja&&
!("type"in b)&&(a.type=ja[c]),c in da&&(a.compressed=!0),c=!0);!g&&c?a.channels=B[a.format]:g&&!c&&a.channels!==u[a.format]&&(a.format=a.internalformat=u[a.channels])}}function E(a){c.pixelStorei(37440,a.flipY);c.pixelStorei(37441,a.premultiplyAlpha);c.pixelStorei(37443,a.colorSpace);c.pixelStorei(3317,a.unpackAlignment)}function H(){V.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function W(d,c){var f=null;e(c)?f=c:c&&(ea(d,c),"x"in c&&
(d.xOffset=c.x|0),"y"in c&&(d.yOffset=c.y|0),e(c.data)&&(f=c.data));if(c.copy){var h=v.viewportWidth,k=v.viewportHeight;d.width=d.width||h-d.xOffset;d.height=d.height||k-d.yOffset;d.needsCopy=!0}else if(!f)d.width=d.width||1,d.height=d.height||1;else if(D(f))d.data=f,"type"in c||5121!==d.type||(d.type=M[Object.prototype.toString.call(f)]|0);else if(g(f)){h=f;k=d.width*d.height*d.channels;switch(d.type){case 5121:case 5123:case 5125:case 5126:k=x.allocType(d.type,k);k.set(h);d.data=k;break;case 36193:d.data=
F(h)}d.alignment=1;d.needsFree=!0}else if(w(f)){h=f.data;Array.isArray(h)||5121!==d.type||(d.type=M[Object.prototype.toString.call(h)]|0);var k=f.shape,p=f.stride,q,z,t,B;3===k.length?(t=k[2],B=p[2]):B=t=1;q=k[0];z=k[1];k=p[0];p=p[1];d.alignment=1;d.width=q;d.height=z;d.channels=t;d.format=d.internalformat=u[t];d.needsFree=!0;q=B;f=f.offset;t=d.width;B=d.height;z=d.channels;for(var m=x.allocType(36193===d.type?5126:d.type,t*B*z),G=0,K=0;K<B;++K)for(var P=0;P<t;++P)for(var A=0;A<z;++A)m[G++]=h[k*P+
p*K+q*A+f];b(d,m)}else if("[object HTMLCanvasElement]"===l(f)||"[object CanvasRenderingContext2D]"===l(f))"[object HTMLCanvasElement]"===l(f)?d.element=f:d.element=f.canvas,d.width=d.element.width,d.height=d.element.height;else if("[object HTMLImageElement]"===l(f))d.element=f,d.width=f.naturalWidth,d.height=f.naturalHeight;else if("[object HTMLVideoElement]"===l(f))d.element=f,d.width=f.videoWidth,d.height=f.videoHeight,d.needsPoll=!0;else if(a(f)){h=f[0].length;k=f.length;p=1;if(C(f[0][0])){q=p=
f[0][0].length;t=x.allocType(36193===d.type?5126:d.type,h*k*q);for(z=B=0;z<k;++z)for(m=f[z],G=0;G<h;++G)for(K=m[G],P=0;P<q;++P)t[B++]=K[P];b(d,t)}else{q=x.allocType(36193===d.type?5126:d.type,h*k);for(B=t=0;B<k;++B)for(z=f[B],m=0;m<h;++m)q[t++]=z[m];b(d,q)}d.alignment=1;d.width=h;d.height=k;d.channels=p;d.format=d.internalformat=u[p];d.needsFree=!0}}function aa(a,b,e,f,g){var h=a.element,k=a.data,l=a.internalformat,p=a.format,z=a.type,m=a.width,t=a.height;E(a);h?c.texSubImage2D(b,g,e,f,p,z,h):a.compressed?
c.compressedTexSubImage2D(b,g,e,f,l,m,t,k):a.needsCopy?(q(),c.copyTexSubImage2D(b,g,e,f,a.xOffset,a.yOffset,m,t)):c.texSubImage2D(b,g,e,f,m,t,p,z,k)}function N(){return Da.pop()||new H}function fa(a){a.needsFree&&x.freeType(a.data);H.call(a);Da.push(a)}function ka(){V.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function R(a,b,c){var e=a.images[0]=N();a.mipmask=1;e.width=a.width=b;e.height=a.height=c}function L(a,b){var c=null;if(e(b))c=a.images[0]=N(),U(c,
a),W(c,b),a.mipmask=1;else if(ea(a,b),Array.isArray(b.mipmap))for(var f=b.mipmap,g=0;g<f.length;++g)c=a.images[g]=N(),U(c,a),c.width>>=g,c.height>>=g,W(c,f[g]),a.mipmask|=1<<g;else c=a.images[0]=N(),U(c,a),W(c,b),a.mipmask=1;U(a,a.images[0])}function I(a,b){for(var e=a.images,f=0;f<e.length&&e[f];++f){var g=e[f],h=b,k=f,l=g.element,p=g.data,z=g.internalformat,m=g.format,t=g.type,u=g.width,C=g.height;E(g);l?c.texImage2D(h,k,m,m,t,l):g.compressed?c.compressedTexImage2D(h,k,z,u,C,0,p):g.needsCopy?(q(),
c.copyTexImage2D(h,k,m,g.xOffset,g.yOffset,u,C,0)):c.texImage2D(h,k,m,u,C,0,m,t,p)}}function X(){var a=Ea.pop()||new ka;V.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function ha(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&fa(b[c]),b[c]=null;Ea.push(a)}function pa(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function sa(a,b){"min"in b&&(a.minFilter=ta[b.min],0<=t.indexOf(a.minFilter)&&(a.genMipmaps=
!0));"mag"in b&&(a.magFilter=P[b.mag]);var c=a.wrapS,e=a.wrapT;if("wrap"in b){var f=b.wrap;"string"===typeof f?c=e=O[f]:Array.isArray(f)&&(c=O[f[0]],e=O[f[1]])}else"wrapS"in b&&(c=O[b.wrapS]),"wrapT"in b&&(e=O[b.wrapT]);a.wrapS=c;a.wrapT=e;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=S[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=
9984)}}function ia(a,b){c.texParameteri(b,10241,a.minFilter);c.texParameteri(b,10240,a.magFilter);c.texParameteri(b,10242,a.wrapS);c.texParameteri(b,10243,a.wrapT);h.ext_texture_filter_anisotropic&&c.texParameteri(b,34046,a.anisotropic);a.genMipmaps&&(c.hint(33170,a.mipmapHint),c.generateMipmap(b))}function qa(){var a=ua.pop()||new pa;pa.call(a);return a}function ma(a){V.call(this);this.mipmask=0;this.internalformat=6408;this.id=Ga++;this.refCount=1;this.target=a;this.texture=c.createTexture();this.unit=
-1;this.bindCount=0}function Y(a){c.activeTexture(33984);c.bindTexture(a.target,a.texture)}function ga(){var a=ba[0];a?c.bindTexture(a.target,a.texture):c.bindTexture(3553,null)}function Z(a){var b=a.texture,e=a.unit,f=a.target;0<=e&&(c.activeTexture(33984+e),c.bindTexture(f,null),ba[e]=null);c.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete wa[a.id];Q.textureCount--}var S={"don't care":4352,"dont care":4352,nice:4354,fast:4353},O={repeat:10497,clamp:33071,mirror:33648},
P={nearest:9728,linear:9729},ta=f({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},P),Ba={none:0,browser:37444},ja={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},ca={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},da={};h.ext_srgb&&(ca.srgb=35904,ca.srgba=35906);h.oes_texture_float&&(ja["float"]=5126);h.oes_texture_half_float&&(ja.float16=ja["half float"]=
36193);h.webgl_depth_texture&&(f(ca,{depth:6402,"depth stencil":34041}),f(ja,{uint16:5123,uint32:5125,"depth stencil":34042}));h.webgl_compressed_texture_s3tc&&f(da,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});h.webgl_compressed_texture_atc&&f(da,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});h.webgl_compressed_texture_pvrtc&&f(da,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});
h.webgl_compressed_texture_etc1&&(da["rgb etc1"]=36196);var ya=Array.prototype.slice.call(c.getParameter(34467));Object.keys(da).forEach(function(a){var b=da[a];0<=ya.indexOf(b)&&(ca[a]=b)});var va=Object.keys(ca);k.textureFormats=va;var Ca=va.reduce(function(a,b){var c=ca[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),Da=[],Ea=[],ua=[],Ga=0,wa={},la=k.maxTextureUnits,ba=Array(la).map(function(){return null});
f(ma.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<la;++b){var e=ba[b];if(e){if(0<e.bindCount)continue;e.unit=-1}ba[b]=this;a=b;break}this.unit=a;c.activeTexture(33984+a);c.bindTexture(this.target,this.texture)}return a},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&Z(this)}});return{create2D:function(a,b){function e(a,b){var c=qa(),d=X();"number"===typeof a?"number"===typeof b?R(d,a|0,b|0):R(d,a|0,a|0):a?(sa(c,a),L(d,a)):R(d,1,1);c.genMipmaps&&
(d.mipmask=(d.width<<1)-1);f.mipmask=d.mipmask;U(f,d);f.internalformat=d.internalformat;e.width=d.width;e.height=d.height;Y(f);I(d,3553);ia(c,3553);ga();ua.push(c);ha(d);return e}var f=new ma(3553);wa[f.id]=f;Q.textureCount++;e(a,b);e.subimage=function(a,b,d,c){b|=0;d|=0;c|=0;var g=N();U(g,f);g.width>>=c;g.height>>=c;g.width-=b;g.height-=d;W(g,a);Y(f);aa(g,3553,b,d,c);ga();fa(g);return e};e.resize=function(a,b){var d=a|0,g=b|0||d;if(d===f.width&&g===f.height)return e;e.width=f.width=d;e.height=f.height=
g;Y(f);c.texImage2D(3553,0,f.format,d,g,0,f.format,f.type,null);ga();return e};e._reglType="texture2d";e._texture=f;e.destroy=function(){f.decRef()};return e},createCube:function(a,b,e,f,g,h){function k(a,b,d,c,e,f){var g,h=qa();for(g=0;6>g;++g)p[g]=X();if("number"===typeof a||!a)for(a=a|0||1,g=0;6>g;++g)R(p[g],a,a);else if("object"===typeof a)if(b)L(p[0],a),L(p[1],b),L(p[2],d),L(p[3],c),L(p[4],e),L(p[5],f);else if(sa(h,a),ea(l,a),"faces"in a)for(a=a.faces,g=0;6>g;++g)U(p[g],l),L(p[g],a[g]);else for(g=
0;6>g;++g)L(p[g],a);U(l,p[0]);l.mipmask=h.genMipmaps?(p[0].width<<1)-1:p[0].mipmask;l.internalformat=p[0].internalformat;k.width=p[0].width;k.height=p[0].height;Y(l);for(g=0;6>g;++g)I(p[g],34069+g);ia(h,34067);ga();ua.push(h);for(g=0;6>g;++g)ha(p[g]);return k}var l=new ma(34067);wa[l.id]=l;Q.cubeCount++;var p=Array(6);k(a,b,e,f,g,h);k.subimage=function(a,b,d,c,e){d|=0;c|=0;e|=0;var f=N();U(f,l);f.width>>=e;f.height>>=e;f.width-=d;f.height-=c;W(f,b);Y(l);aa(f,34069+a,d,c,e);ga();fa(f);return k};k.resize=
function(a,b){var d=a|0,e=b|0||d;if(d===l.width&&e===l.height)return k;k.width=l.width=d;k.height=l.height=e;Y(l);for(var f=0;6>f;++f)c.texImage2D(34069+f,0,l.format,d,e,0,l.format,l.type,null);ga();return k};k._reglType="textureCube";k._texture=l;k.destroy=function(){l.decRef()};return k},clear:function(){for(var a=0;a<la;++a)c.activeTexture(33984+a),c.bindTexture(3553,null),ba[a]=null;z(wa).forEach(Z);Q.cubeCount=0;Q.textureCount=0},getTexture:function(a){return null}}}},{"./constants/arraytypes.json":4,
"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/to-half-float":30,"./util/values":31}],20:[function(h,q,v){q.exports=function(g,a){function h(){this.endQueryIndex=this.startQueryIndex=-1;this.stats=null}var e=a.ext_disjoint_timer_query;if(!e)return null;var b=[],f=[],q,D,w=[],x=[];return{beginQuery:function(a){q=a;D=w.pop()||e.createQueryEXT();e.beginQueryEXT(e.TIME_ELAPSED_EXT,D)},endQuery:function(){e.endQueryEXT(e.TIME_ELAPSED_EXT);
var a=x.pop()||new h;a.startQueryIndex=b.length;a.endQueryIndex=a.startQueryIndex;a.stats=q;f.push(a);b.push(D)},update:function(){if(0!==b.length){var a=[],g,h;for(g=0;g<b.length;g++)a[g]=1E-6*e.getQueryObjectEXT(b[g],e.QUERY_RESULT_EXT),w.push(b[g]);b=[];for(g=0;g<f.length;g++){var l=f[g];for(h=l.startQueryIndex;h<=l.endQueryIndex;h++)l.stats.gpuTime+=a[h];x.push(l)}f=[]}},getNumPendingQueries:function(){return b.length},pushScopeStats:function(a,b,e){var g=x.pop()||new h;g.startQueryIndex=a;g.endQueryIndex=
b;g.stats=e;f.push(g)},clear:function(){for(var a=0;a<w.length;a++)e.deleteQueryEXT(w[a])}}}},{}],21:[function(h,q,v){q.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(h,q,v){function g(a){return Array.prototype.slice.call(a)}function a(a){return g(a).join("")}var l=h("./extend");q.exports=function(){function e(){var b=[],e=[];return l(function(){b.push.apply(b,g(arguments))},{def:function(){var a="v"+f++;
e.push(a);0<arguments.length&&(b.push(a,"="),b.push.apply(b,g(arguments)),b.push(";"));return a},toString:function(){return a([0<e.length?"var "+e+";":"",a(b)])}})}function b(){function a(e,g){f(e,g,"=",b.def(e,g),";")}var b=e(),f=e(),g=b.toString,h=f.toString;return l(b,{entry:b,exit:f,save:a,set:function(e,f,c){a(e,f);b(e,f,"=",c,";")},toString:function(){return g()+h()}})}var f=0,h=[],q=[],w=e(),x={};return{global:w,link:function(a){for(var b=0;b<q.length;++b)if(q[b]===a)return h[b];b="g"+f++;
h.push(b);q.push(a);return b},block:e,proc:function(e,f){function g(){var a="a"+h.length;h.push(a);return a}var h=[];f=f||0;for(var q=0;q<f;++q)g();var q=b(),z=q.toString;return x[e]=l(q,{arg:g,toString:function(){return a(["function(",h.join(),"){",z(),"}"])}})},scope:b,cond:function(){var e=a(arguments),f=b(),h=b(),q=f.toString,z=h.toString;return l(f,{then:function(){f.apply(f,g(arguments));return this},"else":function(){h.apply(h,g(arguments));return this},toString:function(){var b=z();b&&(b=
"else{"+b+"}");return a(["if(",e,"){",q(),"}",b])}})},compile:function(){var b=['"use strict";',w,"return {"];Object.keys(x).forEach(function(a){b.push('"',a,'":',x[a].toString(),",")});b.push("}");var e=a(b).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,h.concat(e)).apply(null,q)}}}},{"./extend":23}],23:[function(h,q,v){q.exports=function(g,a){for(var h=Object.keys(a),e=0;e<h.length;++e)g[h[e]]=a[h[e]];return g}},{}],24:[function(h,q,v){var g=h("./is-typed-array");
q.exports=function(a){return Array.isArray(a)||g(a)}},{"./is-typed-array":26}],25:[function(h,q,v){var g=h("./is-typed-array");q.exports=function(a){return!!a&&"object"===typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"===typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||g(a.data))}},{"./is-typed-array":26}],26:[function(h,q,v){var g=h("../constants/arraytypes.json");q.exports=function(a){return Object.prototype.toString.call(a)in g}},{"../constants/arraytypes.json":4}],
27:[function(h,q,v){q.exports=function(g,a){for(var h=Array(g),e=0;e<g;++e)h[e]=a(e);return h}},{}],28:[function(h,q,v){function g(a){var e,g;e=(65535<a)<<4;a>>>=e;g=(255<a)<<3;a>>>=g;e|=g;g=(15<a)<<2;a>>>=g;e|=g;g=(3<a)<<1;return e|g|a>>>g>>1}function a(a){a:{for(var f=16;268435456>=f;f*=16)if(a<=f){a=f;break a}a=0}f=e[g(a)>>2];return 0<f.length?f.pop():new ArrayBuffer(a)}function l(a){e[g(a.byteLength)>>2].push(a)}var e=h("./loop")(8,function(){return[]});q.exports={alloc:a,free:l,allocType:function(b,
e){var g=null;switch(b){case 5120:g=new Int8Array(a(e),0,e);break;case 5121:g=new Uint8Array(a(e),0,e);break;case 5122:g=new Int16Array(a(2*e),0,e);break;case 5123:g=new Uint16Array(a(2*e),0,e);break;case 5124:g=new Int32Array(a(4*e),0,e);break;case 5125:g=new Uint32Array(a(4*e),0,e);break;case 5126:g=new Float32Array(a(4*e),0,e);break;default:return null}return g.length!==e?g.subarray(0,e):g},freeType:function(a){l(a.buffer)}}},{"./loop":27}],29:[function(h,q,v){q.exports="function"===typeof requestAnimationFrame&&
"function"===typeof cancelAnimationFrame?{next:function(g){return requestAnimationFrame(g)},cancel:function(g){return cancelAnimationFrame(g)}}:{next:function(g){setTimeout(g,30)},cancel:clearTimeout}},{}],30:[function(h,q,v){var g=h("./pool"),a=new Float32Array(1),l=new Uint32Array(a.buffer);q.exports=function(e){for(var b=g.allocType(5123,e.length),f=0;f<e.length;++f)if(isNaN(e[f]))b[f]=65535;else if(Infinity===e[f])b[f]=31744;else if(-Infinity===e[f])b[f]=64512;else{a[0]=e[f];var h=l[0],q=h>>>
31<<15,w=(h<<1>>>24)-127,h=h>>13&1023;b[f]=-24>w?q:-14>w?q+(h+1024>>-14-w):15<w?q+31744:q+(w+15<<10)+h}return b}},{"./pool":28}],31:[function(h,q,v){q.exports=function(g){return Object.keys(g).map(function(a){return g[a]})}},{}],32:[function(h,q,v){function g(e,b){function f(){var a=window.innerWidth,b=window.innerHeight;e!==document.body&&(b=e.getBoundingClientRect(),a=b.right-b.left,b=b.top-b.bottom);g.width=q*a;g.height=q*b;l(g.style,{width:a+"px",height:b+"px"})}var g=document.createElement("canvas"),
h=a(g,b);l(g.style,{border:0,margin:0,padding:0,top:0,left:0});e.appendChild(g);e===document.body&&(g.style.position="absolute",l(e.style,{margin:0,padding:0}));var q=+h.options.pixelRatio;window.addEventListener("resize",f,!1);var x=h.options.onDestroy;h.options=l(l({},h.options),{onDestroy:function(){window.removeEventListener("resize",f);e.removeChild(g);x&&x()}});f();return h}function a(a,b){function f(b){try{return a.getContext(b,g)}catch(f){return null}}var g=b.glOptions||{};return{gl:f("webgl")||
f("experimental-webgl")||f("webgl-experimental"),options:l({pixelRatio:window.devicePixelRatio},b)}}var l=h("./util/extend");q.exports=function(e){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:e[0],options:e[1]||{}};var b=document.body,f=e[1]||{};if("string"===typeof e[0])b=document.querySelector(e[0])||document.body;else if("object"===typeof e[0])if(e[0]instanceof HTMLElement)b=e[0];else{if(e[0]instanceof WebGLRenderingContext)return{gl:e[0],options:l({pixelRatio:1},
f)};f=e[0]}return b.nodeName&&"CANVAS"===b.nodeName.toUpperCase()?a(b,f):g(b,f)}},{"./util/extend":23}],33:[function(h,q,v){q.exports=function(a,h){function e(a){var b=!1;"altKey"in a&&(b=b||a.altKey!==k.alt,k.alt=!!a.altKey);"shiftKey"in a&&(b=b||a.shiftKey!==k.shift,k.shift=!!a.shiftKey);"ctrlKey"in a&&(b=b||a.ctrlKey!==k.control,k.control=!!a.ctrlKey);"metaKey"in a&&(b=b||a.metaKey!==k.meta,k.meta=!!a.metaKey);return b}function b(a,b){var c=g.x(b),f=g.y(b);"buttons"in b&&(a=b.buttons|0);if(a!==
t||c!==u||f!==B||e(b))t=a|0,u=c||0,B=f||0,h&&h(t,u,B,k)}function f(a){b(0,a)}function q(){if(t||u||B||k.shift||k.alt||k.meta||k.control)t=u=B=0,k.shift=k.alt=k.control=k.meta=!1,h&&h(0,0,0,k)}function v(a){e(a)&&h&&h(t,u,B,k)}function w(a){0===g.buttons(a)?b(0,a):b(t,a)}function x(a){b(t|g.buttons(a),a)}function F(a){b(t&~g.buttons(a),a)}function C(){c||(c=!0,a.addEventListener("mousemove",w),a.addEventListener("mousedown",x),a.addEventListener("mouseup",F),a.addEventListener("mouseleave",f),a.addEventListener("mouseenter",
f),a.addEventListener("mouseout",f),a.addEventListener("mouseover",f),a.addEventListener("blur",q),a.addEventListener("keyup",v),a.addEventListener("keydown",v),a.addEventListener("keypress",v),a!==window&&(window.addEventListener("blur",q),window.addEventListener("keyup",v),window.addEventListener("keydown",v),window.addEventListener("keypress",v)))}function M(){c&&(c=!1,a.removeEventListener("mousemove",w),a.removeEventListener("mousedown",x),a.removeEventListener("mouseup",F),a.removeEventListener("mouseleave",
f),a.removeEventListener("mouseenter",f),a.removeEventListener("mouseout",f),a.removeEventListener("mouseover",f),a.removeEventListener("blur",q),a.removeEventListener("keyup",v),a.removeEventListener("keydown",v),a.removeEventListener("keypress",v),a!==window&&(window.removeEventListener("blur",q),window.removeEventListener("keyup",v),window.removeEventListener("keydown",v),window.removeEventListener("keypress",v)))}h||(h=a,a=window);var t=0,u=0,B=0,k={shift:!1,alt:!1,control:!1,meta:!1},c=!1;C();
var T={element:a};Object.defineProperties(T,{enabled:{get:function(){return c},set:function(a){a?C():M},enumerable:!0},buttons:{get:function(){return t},enumerable:!0},x:{get:function(){return u},enumerable:!0},y:{get:function(){return B},enumerable:!0},mods:{get:function(){return k},enumerable:!0}});return T};var g=h("mouse-event")},{"mouse-event":34}],34:[function(h,q,v){function g(a){return a.target||a.srcElement||window}v.buttons=function(a){if("object"===typeof a){if("buttons"in a)return a.buttons;
if("which"in a){a=a.which;if(2===a)return 4;if(3===a)return 2;if(0<a)return 1<<a-1}else if("button"in a){a=a.button;if(1===a)return 4;if(2===a)return 2;if(0<=a)return 1<<a}}return 0};v.element=g;v.x=function(a){if("object"===typeof a){if("offsetX"in a)return a.offsetX;var h=g(a).getBoundingClientRect();return a.clientX-h.left}return 0};v.y=function(a){if("object"===typeof a){if("offsetY"in a)return a.offsetY;var h=g(a).getBoundingClientRect();return a.clientY-h.top}return 0}},{}],35:[function(h,q,
v){var g=h("./lib/util/extend"),a=h("./lib/dynamic"),l=h("./lib/util/raf"),e=h("./lib/util/clock"),b=h("./lib/strings"),f=h("./lib/webgl"),z=h("./lib/extension"),D=h("./lib/limits"),w=h("./lib/buffer"),x=h("./lib/elements"),F=h("./lib/texture"),C=h("./lib/renderbuffer"),M=h("./lib/framebuffer"),t=h("./lib/attribute"),u=h("./lib/shader"),B=h("./lib/read"),k=h("./lib/core"),c=h("./lib/stats"),T=h("./lib/timer");q.exports=function(){function h(){O=l.next(h);I.tick+=1;I.time=(e()-ka)/1E3;U();for(var a=
0;a<S.length;++a)(0,S[a])(I,null,0);H.flush()}function q(a){}function v(a){}function Q(b){function c(b){var e={},f={};Object.keys(b).forEach(function(c){var g=b[c];a.isDynamic(g)?f[c]=a.unbox(g,c):e[c]=g});return{dynamic:f,"static":e}}function e(a){for(;u.length<a;)u.push(null);return u}var f=c(b.context||{}),h=c(b.uniforms||{}),k=c(b.attributes||{}),l=c(function(a){function b(a){if(a in c){var e=c[a];delete c[a];Object.keys(e).forEach(function(b){c[a+"."+b]=e[b]})}}var c=g({},a);delete c.uniforms;
delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(b));b={gpuTime:0};var f=Y.compile(l,k,h,f,b),p=f.draw,q=f.batch,t=f.scope,u=[];return g(function(a,b){var c;if("function"===typeof a)return t.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(c=0;c<a;++c)t.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)t.call(this,a[c],b,c);else return t.call(this,a,b,0);else if("number"===
typeof a){if(0<a)return q.call(this,e(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return q.call(this,a,a.length)}else return p.call(this,a)},{stats:b})}function V(){var a=ga.viewport,b=ga.scissor_box;a[0]=a[1]=b[0]=b[1]=0;I.viewportWidth=I.framebufferWidth=I.drawingBufferWidth=a[2]=b[2]=H.drawingBufferWidth;I.viewportHeight=I.framebufferHeight=I.drawingBufferHeight=a[3]=b[3]=H.drawingBufferHeight}function U(){V();Y.procs.poll()}function ea(){V();Y.procs.refresh()}var E=f(Array.prototype.slice.call(arguments)),
H=E.gl,W=E.options,E=b(),aa=c(),N=z(H).extensions,fa=T(H,N),ka=e(),R=H.drawingBufferWidth,L=H.drawingBufferHeight,I={tick:0,time:0,viewportWidth:R,viewportHeight:L,framebufferWidth:R,framebufferHeight:L,drawingBufferWidth:R,drawingBufferHeight:L,pixelRatio:W.pixelRatio},X=D(H,N),ha=w(H,aa),pa=x(H,N,ha,aa),R=t(H,N,X,ha,E),sa=u(H,E,aa),ia=F(H,N,X,U,I,aa),qa=C(H,N,X,aa),ma=M(H,N,X,ia,qa,aa),L=B(H,U,I),Y=k(H,E,N,X,ha,pa,ia,ma,{},R,sa,{elements:null,primitive:4,count:-1,offset:0,instances:-1},I,fa),ga=
Y.next,Z=H.canvas,S=[],O=0;Z&&(Z.addEventListener("webglcontextlost",q,!1),Z.addEventListener("webglcontextrestored",v,!1));ea();return g(Q,{clear:function(a){var b=0;Y.procs.poll();var c=a.color;c&&(H.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(H.clearDepth(+a.depth),b|=256);"stencil"in a&&(H.clearStencil(a.stencil|0),b|=1024);H.clear(b)},prop:a.define.bind(null,1),context:a.define.bind(null,2),"this":a.define.bind(null,3),draw:Q({}),buffer:function(a){return ha.create(a,
34962)},elements:pa.create,texture:ia.create2D,cube:ia.createCube,renderbuffer:qa.create,framebuffer:ma.create,framebufferCube:function(a){},attributes:H.getContextAttributes(),frame:function(a){S.push(a);!O&&0<S.length&&h();return{cancel:function(){var b=S.find(function(b){return b===a});0>b||(S.splice(b,1),0>=S.length&&O&&(l.cancel(h),O=0))}}},limits:X,hasExtension:function(a){return 0<=X.extensions.indexOf(a.toLowerCase())},read:L,destroy:function(){O&&(l.cancel(h),O=0);Z&&(Z.removeEventListener("webglcontextlost",
q),Z.removeEventListener("webglcontextrestored",v));sa.clear();ma.clear();qa.clear();ia.clear();pa.clear();ha.clear();fa&&fa.clear();if(W.onDestroy)W.onDestroy()},_gl:H,_refresh:ea,stats:aa,updateTimer:function(){fa&&fa.update()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,
"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},{},[1]);
