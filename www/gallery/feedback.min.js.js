(function e$$0(n,q,e){function a(p,h){if(!q[p]){if(!n[p]){var K="function"==typeof require&&require;if(!h&&K)return K(p,!0);if(b)return b(p,!0);K=Error("Cannot find module '"+p+"'");throw K.code="MODULE_NOT_FOUND",K;}K=q[p]={exports:{}};n[p][0].call(K.exports,function(b){var e=n[p][1][b];return a(e?e:b)},K,K.exports,e$$0,n,q,e)}return q[p].exports}for(var b="function"==typeof require&&require,h=0;h<e.length;h++)a(e[h]);return a})({1:[function(k,n,q){var e=k("../regl")(),a=k("mouse-change")(),b=e.texture(),
h=e({frag:"\n  precision mediump float;\n  uniform sampler2D texture;\n  uniform vec2 mouse;\n  uniform float t;\n  varying vec2 uv;\n  void main () {\n    float dist = length(gl_FragCoord.xy - mouse);\n    gl_FragColor = vec4(0.98 * texture2D(texture,\n      uv + cos(t) * vec2(0.5 - uv.y, uv.x - 0.5) - sin(2.0 * t) * (uv - 0.5)).rgb, 1) +\n      exp(-0.01 * dist) * vec4(\n        1.0 + cos(2.0 * t),\n        1.0 + cos(2.0 * t + 1.5),\n        1.0 + cos(2.0 * t + 3.0),\n        0.0);\n  }",vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main () {\n    uv = position;\n    gl_Position = vec4(2.0 * position - 1.0, 0, 1);\n  }",
attributes:{position:[-2,0,0,-2,2,2]},uniforms:{texture:b,mouse:function(b){var e=b.pixelRatio;return[a.x*e,b.viewportHeight-a.y*e]},t:function(a){return.01*a.count}},count:3});e.frame(function(){e.clear({color:[0,0,0,1]});h();b({copy:!0})})},{"../regl":32,"mouse-change":30}],2:[function(k,n,q){function e(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}n.exports=function(a,b,h,p,g){a=h.maxAttributes;b=
Array(a);for(h=0;h<a;++h)b[h]=new e;return{Record:e,scope:{},state:b}}},{}],3:[function(k,n,q){function e(a,b){switch(a){case 5121:return new Uint8Array(b);case 5123:return new Uint16Array(b);case 5125:return new Uint32Array(b);case 5120:return new Int8Array(b);case 5122:return new Int16Array(b);case 5124:return new Int32Array(b);case 5126:return new Float32Array(b);default:return null}}var a=k("./util/is-typed-array"),b=k("./util/is-ndarray"),h=k("./constants/arraytypes.json"),p=k("./constants/dtypes.json"),
g=k("./util/values"),K={"static":35044,dynamic:35048,stream:35040};n.exports=function(k){function n(a){this.id=E++;this.buffer=null;this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function z(a){k.isBuffer(a.buffer)||(a.buffer=k.createBuffer());a.bind();k.bufferData(a.type,a.data||a.byteLength,a.usage)}function r(a){var b=a.buffer;k.isBuffer(b)&&k.deleteBuffer(b);a.buffer=null;delete d[a.id]}function v(g,k,m){function v(d){var g=d||{};if(Array.isArray(g)||
a(g)||b(g))g={data:g};else if("number"===typeof g)g={length:g|0};else if(null===g||void 0===g)g={};E.usage="usage"in g?K[g.usage]:35044;d=0;"type"in g&&(d=p[g.type]);var k=g.dimension|0||1,x=0,m=null;if("data"in g)if(m=g.data,null===m)x=g.length|0;else{if(b(m)){var k=m.shape,x=m.stride,g=m.offset,u=0,w=0,r=0,n=0;1===k.length?(u=k[0],w=1,r=x[0],n=0):2===k.length&&(u=k[0],w=k[1],r=x[0],n=x[1]);d=d||h[Object.prototype.toString.call(m.data)]|0||5126;for(var k=w,x=e(d,u*w),m=m.data,G=0,aa=0;aa<u;++aa)for(var L=
0;L<w;++L)x[G++]=m[r*aa+n*L+g];m=x}else if(Array.isArray(m))if(0<m.length&&Array.isArray(m[0])){k=m[0].length;d=d||5126;g=e(d,m.length*k);x=m;m=k;for(u=n=0;u<x.length;++u)for(r=x[u],w=0;w<m;++w)g[n++]=r[w];m=g}else d=d||5126,m=e(d,m);else d=d||h[Object.prototype.toString.call(m)]|0;x=m.byteLength}else"length"in g&&(x=g.length|0);E.data=m;E.dtype=d||5121;E.byteLength=x;E.dimension=k;z(E);return v}var E=new n(k);d[E.id]=E;m||v(g);v._reglType="buffer";v._buffer=E;v.destroy=function(){r(E)};return v}
var E=0,d={};n.prototype.bind=function(){k.bindBuffer(this.type,this.buffer)};return{create:v,createStream:function(a){return v({data:a,usage:"stream"},34962,!1)._buffer},destroyStream:function(a){r(a)},clear:function(){g(d).forEach(r)},refresh:function(){g(d).forEach(z)},getBuffer:function(a){return a&&a._buffer instanceof n?a._buffer:null}}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./util/is-ndarray":21,"./util/is-typed-array":22,"./util/values":28}],4:[function(k,n,q){n.exports=
{"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(k,n,q){n.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],6:[function(k,n,q){n.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,
triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(k,n,q){function e(a){return Array.isArray(a)||L(a)||z(a)}function a(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function b(a,b,d,e){this.thisDep=a;this.contextDep=b;this.propDep=d;this.append=e}function h(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function p(a){return new b(!1,!1,!1,a)}function g(a,d){var e=a.type;return 0===e?(e=a.data.length,new b(!0,1<=e,2<=e,d)):new b(3===e,2===e,1===
e,d)}var K=k("./util/codegen"),G=k("./util/loop"),L=k("./util/is-typed-array"),z=k("./util/is-ndarray"),r=k("./constants/primitives.json"),v=k("./constants/dtypes.json"),E=["x","y","z","w"],d={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},
x={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},w={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},m={cw:2304,ccw:2305},X=new b(!1,!1,!1,function(){});n.exports=function(k,n,z,q,Q,C,u,Z,ga,S,Y,aa,M){function P(a){return a.replace(".","_")}function F(a,f,b){var c=P(a);pa.push(a);la[c]=ha[c]=!!b;ia[c]=f}
function A(a,f,c){var b=P(a);pa.push(a);Array.isArray(c)?(ha[b]=c.slice(),la[b]=c.slice()):ha[b]=la[b]=c;ja[b]=f}function R(){var a=K(),f=a.link,c=a.global;a.id=Aa++;a.batchId="0";var b=f(xa),d=a.shared={props:"a0"};Object.keys(xa).forEach(function(l){d[l]=c.def(b,".",l)});var D=a.next={},e=a.current={};Object.keys(ja).forEach(function(l){Array.isArray(ha[l])&&(D[l]=c.def(d.next,".",l),e[l]=c.def(d.current,".",l))});var l=a.constants={};Object.keys(qa).forEach(function(a){l[a]=c.def(JSON.stringify(qa[a]))});
a.invoke=function(l,W){switch(W.type){case 0:var c=["this",d.context,d.props,a.batchId];return l.def(f(W.data),".call(",c.slice(0,Math.max(W.data.length+1,4)),")");case 1:return l.def(d.props,W.data);case 2:return l.def(d.context,W.data);case 3:return l.def("this",W.data)}};a.attribCache={};var W={};a.scopeAttrib=function(l){l=n.id(l);if(l in W)return W[l];var a=S.scope[l];a||(a=S.scope[l]=new ma);return W[l]=f(a)};return a}function ea(a){var f=a["static"];a=a.dynamic;if("framebuffer"in f){var c=
f.framebuffer;return c?(c=Z.getFramebuffer(c),p(function(a,f){var b=a.link(c),l=a.shared;f.set(l.framebuffer,".next",b);l=l.context;f.set(l,".framebufferWidth",b+".width");f.set(l,".framebufferHeight",b+".height");return b})):p(function(a,f){var c=a.shared;f.set(c.framebuffer,".next","null");c=c.context;f.set(c,".framebufferWidth",c+".drawingBufferWidth");f.set(c,".framebufferHeight",c+".drawingBufferHeight");return null})}if("framebuffer"in a){var b=a.framebuffer;return g(b,function(a,f){var c=a.invoke(f,
b),l=a.shared,W=l.framebuffer,c=f.def(W,".getFramebuffer(",c,")");f.set(W,".next",c);l=l.context;f.set(l,".framebufferWidth",c+"?"+c+".width:"+l+".drawingBufferWidth");f.set(l,".framebufferHeight",c+"?"+c+".height:"+l+".drawingBufferHeight");return c})}return null}function ba(a,f){function c(l){if(l in d){var a=d[l];l=!0;var y=a.x|0,ya=a.y|0,D,p;"w"in a?D=a.w|0:l=!1;"h"in a?p=a.h|0:l=!1;return new b(l&&f&&f.thisDep,l&&f&&f.contextDep,l&&f&&f.propDep,function(l,f){var c=l.shared.context,b=D;"w"in a||
(b=f.def(c,".","framebufferWidth","-",y));var d=p;"h"in a||(d=f.def(c,".","framebufferHeight","-",ya));return[y,ya,b,d]})}if(l in e){var t=e[l];l=g(t,function(l,a){var f=l.invoke(a,t),c=l.shared.context,W=a.def(f,".x|0"),b=a.def(f,".y|0"),y=a.def('"w" in ',f,"?",f,".w|0:","(",c,".","framebufferWidth","-",W,")"),f=a.def('"h" in ',f,"?",f,".h|0:","(",c,".","framebufferHeight","-",b,")");return[W,b,y,f]});f&&(l.thisDep=l.thisDep||f.thisDep,l.contextDep=l.contextDep||f.contextDep,l.propDep=l.propDep||
f.prpoDep);return l}return f?new b(f.thisDep,f.contextDep,f.propDep,function(l,a){var f=l.shared.context;return[0,0,a.def(f,".","framebufferWidth"),a.def(f,".","framebufferHeight")]}):null}var d=a["static"],e=a.dynamic,D=c("viewport");if(D)var p=D,D=new b(D.thisDep,D.contextDep,D.propDep,function(l,a){var f=p.append(l,a),c=l.shared.context;a.set(c,".viewportWidth",f[2]);a.set(c,".viewportHeight",f[3]);return f});return{viewport:D,scissor_box:c("scissor.box")}}function J(a){function f(l){if(l in c){var a=
n.id(c[l]);l=p(function(){return a});l.id=a;return l}if(l in d){var b=d[l];return g(b,function(l,a){var f=l.invoke(a,b);return a.def(l.shared.strings,".id(",f,")")})}return null}var c=a["static"],d=a.dynamic,e=f("frag"),D=f("vert"),t=null;h(e)&&h(D)?(t=Y.program(D.id,e.id),a=p(function(l,a){return l.link(t)})):a=new b(e&&e.thisDep||D&&D.thisDep,e&&e.contextDep||D&&D.contextDep,e&&e.propDep||D&&D.propDep,function(l,a){var f=l.shared.shader,c;c=e?e.append(l,a):a.def(f,".","frag");var b;b=D?D.append(l,
a):a.def(f,".","vert");return a.def(f+".program("+b+","+c+")")});return{frag:e,vert:D,progVar:a,program:t}}function I(a){function f(a,l){if(a in c){var b=c[a]|0;return p(function(a,f){l&&(a.OFFSET=b);return b})}if(a in d){var y=d[a];return g(y,function(a,f){var c=a.invoke(f,y);l&&(a.OFFSET=c);return c})}return l&&t?p(function(a,l){a.OFFSET="0";return 0}):null}var c=a["static"],d=a.dynamic,t=function(){if("elements"in c){var a=c.elements;e(a)?a=C.getElements(C.create(a)):a&&(a=C.getElements(a));var l=
p(function(l,f){if(a){var c=l.link(a);return l.ELEMENTS=c}return l.ELEMENTS=null});l.value=a;return l}if("elements"in d){var f=d.elements;return g(f,function(a,l){var c=a.shared,b=c.isBufferArgs,c=c.elements,d=a.invoke(l,f),y=l.def("null"),b=l.def(b,"(",d,")"),d=a.cond(b).then(y,"=",c,".createStream(",d,");")["else"](y,"=",c,".getElements(",d,");");l.entry(d);l.exit(a.cond(b).then(c,".destroyStream(",y,");"));return a.ELEMENTS=y})}return null}(),D=f("offset",!0);return{elements:t,primitive:function(){if("primitive"in
c){var a=c.primitive;return p(function(l,f){return r[a]})}if("primitive"in d){var l=d.primitive;return g(l,function(a,f){var c=a.constants.primTypes,b=a.invoke(f,l);return f.def(c,"[",b,"]")})}return t?h(t)?t.value?p(function(a,l){return l.def(a.ELEMENTS,".primType")}):p(function(){return 4}):new b(t.thisDep,t.contextDep,t.propDep,function(a,l){var f=a.ELEMENTS;return l.def(f,"?",f,".primType:",4)}):null}(),count:function(){if("count"in c){var a=c.count|0;return p(function(){return a})}if("count"in
d){var l=d.count;return g(l,function(a,f){return a.invoke(f,l)})}return t?h(t)?t?D?new b(D.thisDep,D.contextDep,D.propDep,function(a,l){return l.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):p(function(a,l){return l.def(a.ELEMENTS,".vertCount")}):p(function(){return-1}):new b(t.thisDep||D.thisDep,t.contextDep||D.contextDep,t.propDep||D.propDep,function(a,l){var f=a.ELEMENTS;return a.OFFSET?l.def(f,"?",f,".vertCount-",a.OFFSET,":-1"):l.def(f,"?",f,".vertCount:-1")}):null}(),instances:f("instances",!1),
offset:D}}function na(a){var f=a["static"],c=a.dynamic,b={};pa.forEach(function(a){function y(l,d){if(a in f){var t=l(f[a]);b[e]=p(function(){return t})}else if(a in c){var D=c[a];b[e]=g(D,function(a,l){return d(a,l,a.invoke(l,D))})}}var e=P(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return y(function(a){return a},function(a,
f,c){return c});case "depth.func":return y(function(a){return x[a]},function(a,f,c){return f.def(a.constants.compareFuncs,"[",c,"]")});case "depth.range":return y(function(a){return a},function(a,f,c){a=f.def("+",c,"[0]");f=f.def("+",c,"[1]");return[a,f]});case "blend.func":return y(function(a){return[d["srcRGB"in a?a.srcRGB:a.src],d["dstRGB"in a?a.dstRGB:a.dst],d["srcAlpha"in a?a.srcAlpha:a.src],d["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,f,c){function b(a,l){var y=f.def('"',a,l,'" in ',c,"?",
c,".",a,l,":",c,".",a);return f.def(d,"[",y,"]")}var d=a.constants.blendFuncs;a=b("src","RGB");var y=b("src","Alpha"),e=b("dst","RGB"),t=b("dst","Alpha");return[a,e,y,t]});case "blend.equation":return y(function(a){if("string"===typeof a)return[ka[a],ka[a]];if("object"===typeof a)return[ka[a.rgb],ka[a.alpha]]},function(a,f,c){var b=a.constants.blendEquations,d=f.def(),y=f.def();a=a.cond("typeof ",c,'==="string"');a.then(d,"=",y,"=",b,"[",c,"];");a["else"](d,"=",b,"[",c,".rgb];",y,"=",b,"[",c,".alpha];");
f(a);return[d,y]});case "blend.color":return y(function(a){return G(4,function(f){return+a[f]})},function(a,f,c){return G(4,function(a){return f.def("+",c,"[",a,"]")})});case "stencil.mask":return y(function(a){return a|0},function(a,f,c){return f.def(c,"|0")});case "stencil.func":return y(function(a){return[x[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,f,c){a=f.def('"cmp" in ',c,"?",a.constants.compareFuncs,"[",c,".cmp]",":",7680);var b=f.def(c,".ref|0");f=f.def('"mask" in ',c,"?",
c,".mask|0:-1");return[a,b,f]});case "stencil.opFront":case "stencil.opBack":return y(function(f){return["stencil.opBack"===a?1029:1028,w[f.fail||"keep"],w[f.zfail||"keep"],w[f.pass||"keep"]]},function(f,c,b){function d(a){return c.def('"',a,'" in ',b,"?",y,"[",b,".",a,"]:",7680)}var y=f.constants.stencilOps;return["stencil.opBack"===a?1029:1028,d("fail"),d("zfail"),d("pass")]});case "polygonOffset.offset":return y(function(a){return[a.factor|0,a.units|0]},function(a,f,c){a=f.def(c,".factor|0");f=
f.def(c,".units|0");return[a,f]});case "cull.face":return y(function(a){var f=0;"front"===a?f=1028:"back"===a&&(f=1029);return f},function(a,f,c){return f.def(c,'==="front"?',1028,":",1029)});case "lineWidth":return y(function(a){return a},function(a,f,c){return c});case "frontFace":return y(function(a){return m[a]},function(a,f,c){return f.def(c+'==="cw"?2304:2305')});case "colorMask":return y(function(a){return a.map(function(a){return!!a})},function(a,f,c){return G(4,function(a){return"!!"+c+"["+
a+"]"})});case "sample.coverage":return y(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,f,c){a=f.def('"value" in ',c,"?+",c,".value:1");f=f.def("!!",c,".invert");return[a,f]})}});return b}function T(a){var f=a["static"],c=a.dynamic,b={};Object.keys(f).forEach(function(a){var c=f[a],d;if("number"===typeof c||"boolean"===typeof c)d=p(function(){return c});else if("function"===typeof c&&"texture"===c._reglType)d=p(function(a){return a.link(c)});else if(Array.isArray(c)||L(c))d=p(function(a){return a.global.def("[",
G(c.length,function(a){return c[a]}),"]")});d.value=c;b[a]=d});Object.keys(c).forEach(function(a){var f=c[a];b[a]=g(f,function(a,c){return a.invoke(c,f)})});return b}function ca(a){var f=a["static"],c=a.dynamic,b={};Object.keys(f).forEach(function(a){var c=f[a],d=n.id(a),l=new ma;if(e(c))l.state=1,l.buffer=Q.getBuffer(Q.create(c,34962,!1)),l.type=l.buffer.dtype;else{var y=Q.getBuffer(c);if(y)l.state=1,l.buffer=y,l.type=y.dtype;else if(c.constant){var t=c.constant;l.state=2;"number"===typeof t?l.x=
t:E.forEach(function(a,f){f<t.length&&(l[a]=t[f])})}else{var y=Q.getBuffer(c.buffer),g=c.offset|0,h=c.stride|0,m=c.size|0,k=!!c.normalized,U=0;"type"in c&&(U=v[c.type]);c=c.divisor|0;l.buffer=y;l.state=1;l.size=m;l.normalized=k;l.type=U||y.dtype;l.offset=g;l.stride=h;l.divisor=c}}b[a]=p(function(a,f){var c=a.attribCache;if(d in c)return c[d];var b={isStream:!1};Object.keys(l).forEach(function(a){b[a]=l[a]});l.buffer&&(b.buffer=a.link(l.buffer));return c[d]=b})});Object.keys(c).forEach(function(a){var f=
c[a];b[a]=g(f,function(a,c){function b(a){c(g[a],"=",d,".",a,"|0;")}var d=a.invoke(c,f),y=a.shared,e=y.isBufferArgs,t=y.buffer,g={isStream:c.def(!1)},da=new ma;da.state=1;Object.keys(da).forEach(function(a){g[a]=c.def(""+da[a])});var p=g.buffer,h=g.type;c("if(",e,"(",d,")){",g.isStream,"=true;",p,"=",t,".createStream(",d,");",h,"=",p,".dtype;","}else{",p,"=",t,".getBuffer(",d,");","if(",p,"){",h,"=",p,".dtype;","}else if(",d,".constant){",g.state,"=",2,";",E.map(function(a,f){return g[a]+"="+d+".length>="+
f+"?"+d+"["+f+"]:0;"}).join(""),"}else{",p,"=",t,".getBuffer(",d,".buffer);",h,'="type" in ',d,"?",y.glTypes,"[",d,".type]:",p,".dtype;",g.normalized,"=!!",d,".normalized;");b("size");b("offset");b("stride");b("divisor");c("}}");return g})});return b}function N(a){var f=a["static"],c=a.dynamic,b={};Object.keys(f).forEach(function(a){var c=f[a];b[a]=p(function(a,f){return"number"===typeof c||"boolean"===typeof c?""+c:a.link(c)})});Object.keys(c).forEach(function(a){var f=c[a];b[a]=g(f,function(a,c){return a.invoke(c,
f)})});return b}function O(a,f,c){var b=a.shared.context,d=a.scope();Object.keys(c).forEach(function(e){f.save(b,"."+e);d(b,".",e,"=",c[e].append(a,f),";")});f(d)}function f(a,f,c){var b=a.shared,d=b.gl,e=b.framebuffer,t;ra&&(t=f.def(b.extensions,".webgl_draw_buffers"));var l=a.constants,b=l.drawBuffers,l=l.backBuffer;a=c?c.append(a,f):f.def(e,".next");f("if(",e,".dirty||",a,"!==",e,".cur){","if(",a,"){",d,".bindFramebuffer(",36160,",",a,".framebuffer);");ra&&f(t,".drawBuffersWEBGL(",b,"[",a,".colorAttachments.length]);");
f("}else{",d,".bindFramebuffer(",36160,",null);");ra&&f(t,".drawBuffersWEBGL(",l,");");f("}",e,".cur=",a,";",e,".dirty=false;","}")}function t(a,f,c){var b=a.shared,d=b.gl,e=a.current,t=a.next,l=b.current,g=b.next,p=a.cond(l,".dirty");pa.forEach(function(f){f=P(f);if(!(f in c.state)){var b,h;if(f in t){b=t[f];h=e[f];var da=G(ha[f].length,function(a){return p.def(b,"[",a,"]")});p(a.cond(da.map(function(a,f){return a+"==="+h+"["+f+"]"}).join("&&")).then(d,".",ja[f],"(",da,");",da.map(function(a,f){return h+
"["+f+"]="+a}).join(";"),";"))}else b=p.def(g,".",f),da=a.cond(b,"!==",l,".",f),p(da),f in ia?da(a.cond(b).then(d,".enable(",ia[f],");")["else"](d,".disable(",ia[f],");"),l,".",f,"=",b,";"):da(d,".",ja[f],"(",b,");",l,".",f,"=",b,";")}});0===Object.keys(c.state).length&&p(l,".dirty=false;");f(p)}function c(f,c,b,d){var e=f.shared,t=f.current,g=e.current,l=e.gl;a(Object.keys(b)).forEach(function(a){var e=b[a];if(!d||d(e)){var p=e.append(f,c);if(ia[a]){var m=ia[a];h(e)?p?c(l,".enable(",m,");"):c(l,
".disable(",m,");"):c(f.cond(p).then(l,".enable(",m,");")["else"](l,".disable(",m,");"));c(g,".",a,"=",p,";")}else if(Array.isArray(p)){var k=t[a];c(l,".",ja[a],"(",p,");",p.map(function(a,f){return k+"["+f+"]="+a}).join(";"),";")}else c(l,".",ja[a],"(",p,");",g,".",a,"=",p,";")}})}function U(a,f){oa&&!a.instancing&&(a.instancing=f.def(a.shared.extensions,".angle_instanced_arrays"))}function sa(a,f,c,b,d){function e(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;
case 35666:case 35669:case 35673:return 4;default:return 1}}function t(c,b,d){function e(){f("if(!",m,".pointer){",g,".enableVertexAttribArray(",h,");",m,".pointer=true;}");var c=d.type,l;l=d.size?f.def(d.size,"||",b):b;f("if(",m,".type!==",c,"||",m,".size!==",l,"||",x.map(function(a){return m+"."+a+"!=="+d[a]}).join("||"),"){",g,".bindBuffer(",34962,",",k,".buffer);",g,".vertexAttribPointer(",[h,l,c,d.normalized,d.stride,d.offset],");",m,".type=",c,";",m,".size=",l,";",x.map(function(a){return m+
"."+a+"="+d[a]+";"}).join(""),"}");oa&&(c=d.divisor,f("if(",m,".divisor!==",c,"){",a.instancing,".vertexAttribDivisorANGLE(",[h,c],");",m,".divisor=",c,";}"))}function p(){f("if(",m,".pointer){",g,".disableVertexAttribArray(",h,");",m,".pointer=false;","}if(",E.map(function(a,f){return m+"."+a+"!=="+U[f]}).join("||"),"){",g,".vertexAttrib4f(",h,",",U,");",E.map(function(a,f){return m+"."+a+"="+U[f]+";"}).join(""),"}")}var g=l.gl,h=f.def(c,".location"),m=f.def(l.attributes,"[",h,"]");c=d.state;var k=
d.buffer,U=[d.x,d.y,d.z,d.w],x=["buffer","normalized","offset","stride"];1===c?e():2===c?p():(f("if(",c,"===",1,"){"),e(),f("}else{"),p(),f("}"))}var l=a.shared;b.forEach(function(b){var l=b.name,g=c.attributes[l],p;if(g){if(!d(g))return;p=g.append(a,f)}else{if(!d(X))return;var h=a.scopeAttrib(l);p={};Object.keys(new ma).forEach(function(a){p[a]=f.def(h,".",a)})}t(a.link(b),e(b.info.type),p)})}function ta(a,f,c,b,d){for(var e=a.shared,t=e.gl,l,g=0;g<b.length;++g){var p=b[g],h=p.name,m=p.info.type,
k=c.uniforms[h],p=a.link(p)+".location";if(k){if(!d(k))continue;if(k["static"]){h=k.value;if(35678===m||35680===m)m=a.link(h._texture),f(t,".uniform1i(",p,m+".bind());"),f.exit(m,".unbind()");else if(35674===m||35675===m||35676===m)h=a.global.def("["+h+"]"),k=2,35675===m?k=3:35676===m&&(k=4),f(t,".uniformMatrix",k,"fv(",p,",false,",h,");");else{switch(m){case 5126:l="1f";break;case 35664:l="2f";break;case 35665:l="3f";break;case 35666:l="4f";break;case 35670:l="1i";break;case 5124:l="1i";break;case 35671:l=
"2i";break;case 35667:l="2i";break;case 35672:l="3i";break;case 35668:l="3i";break;case 35673:l="4i";break;case 35669:l="4i"}f(t,".uniform",l,"(",p,",",h,");")}continue}else h=k.append(a,f)}else{if(!d(X))continue;h=f.def(e.uniforms,"[",n.id(h),"]")}k=",";switch(m){case 35678:case 35680:m=f.def(h,"._texture");f(t,".uniform1i(",p,",",m,".bind());");f.exit(m,".unbind();");continue;case 5124:case 35670:l="1i";break;case 35667:case 35671:l="2iv";break;case 35668:case 35672:l="3iv";break;case 35669:case 35673:l=
"4iv";break;case 5126:l="1f";break;case 35664:l="2fv";break;case 35665:l="3fv";break;case 35666:l="4fv";break;case 35674:l="Matrix2fv";k=",false,";break;case 35675:l="Matrix3fv";k=",false,";break;case 35676:l="Matrix4fv",k=",false,"}f(t,".uniform",l,"(",p,k,h,");")}}function ua(a,f,c,b){function d(b){var l=m[b];return l?l.batchStatic?l.append(a,f):l.append(a,c):f.def(g,".",b)}function e(){function a(){c(v,".drawElementsInstancedANGLE(",[U,u,n,x+"<<(("+n+"-5121)>>1)",w],");")}function f(){c(v,".drawArraysInstancedANGLE(",
[U,x,u,w],");")}k?r?a():(c("if(",k,"){"),a(),c("}else{"),f(),c("}")):f()}function t(){function a(){c(p+".drawElements("+[U,u,n,x+"<<(("+n+"-5121)>>1)"]+");")}function f(){c(p+".drawArrays("+[U,x,u]+");")}k?r?a():(c("if(",k,"){"),a(),c("}else{"),f(),c("}")):f()}var l=a.shared,p=l.gl,g=l.draw,m=b.draw,k=function(){var b=m.elements,d=f;b?(b.batchStatic||(d=c),b=b.append(a,d)):b=d.def(g,".","elements");b&&d("if("+b+")"+p+".bindBuffer(34963,"+b+".buffer.buffer);");return b}(),U=d("primitive"),x=d("offset"),
u=function(){var b=m.count,d=f;b?(b.batchStatic||(d=c),b=b.append(a,d)):b=d.def(g,".","count");return b}();if("number"===typeof u){if(0===u)return}else c("if(",u,"){"),c.exit("}");var w,v;oa&&(w=d("instances"),v=a.instancing);var n=k+".type",r=m.elements&&h(m.elements);oa&&("number"!==typeof w||0<=w)?"string"===typeof w?(c("if(",w,">0){"),e(),c("}else if(",w,"<0){"),t(),c("}")):e():t()}function va(a,f,c,b,d){f=R();d=f.proc("body",d);oa&&(f.instancing=d.def(f.shared.extensions,".angle_instanced_arrays"));
a(f,d,c,b);return f.compile().body}function za(a,f,c,b){U(a,f);sa(a,f,c,b.attributes,function(){return!0});ta(a,f,c,b.uniforms,function(){return!0});ua(a,f,f,c)}function Ba(a,b){var d=a.proc("draw",1);U(a,d);O(a,d,b.context);f(a,d,b.framebuffer);t(a,d,b);c(a,d,b.state);var e=b.shader.progVar.append(a,d);d(a.shared.gl,".useProgram(",e,".program);");if(b.shader.program)za(a,d,b,b.shader.program);else{var p=a.global.def("{}"),g=d.def(e,".id"),m=d.def(p,"[",g,"]");d(a.cond(m).then(m,".call(this,a0);")["else"](m,
"=",p,"[",g,"]=",a.link(function(f){return va(za,a,b,f,1)}),"(",e,");",m,".call(this,a0);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}function Ca(a,f,c,b){function d(){return!0}a.batchId="a1";U(a,f);sa(a,f,c,b.attributes,d);ta(a,f,c,b.uniforms,d);ua(a,f,f,c)}function wa(a,b,d,e){function p(a){return a.contextDep&&g||a.propDep}function t(a){return!p(a)}U(a,b);var g=d.contextDynamic,l=b.def(),m=b.def();a.shared.props=m;a.batchId=l;var h=a.scope(),k=a.scope();b(h.entry,"for(",
l,"=0;",l,"<","a1",";++",l,"){",m,"=","a0","[",l,"];",k,"}",h.exit);d.needsContext&&O(a,k,d.context);d.needsFramebuffer&&f(a,k,d.framebuffer);c(a,k,d.state,p);e?(sa(a,h,d,e.attributes,t),sa(a,k,d,e.attributes,p),ta(a,h,d,e.uniforms,t),ta(a,k,d,e.uniforms,p),ua(a,h,k,d)):(b=a.global.def("{}"),e=d.shader.progVar.append(a,k),m=k.def(e,".id"),h=k.def(b,"[",m,"]"),k(a.shared.gl,".useProgram(",e,".program);","if(!",h,"){",h,"=",b,"[",m,"]=",a.link(function(f){return va(Ca,a,d,f,2)}),"(",e,");}",h,".call(this,a0[",
l,"],",l,");"))}function Da(a,b){var d=a.proc("batch",2);a.batchId="0";U(a,d);var e=!1,p=!0;Object.keys(b.context).forEach(function(a){e=e||b.context[a].propDep});e||(O(a,d,b.context),p=!1);var g=b.framebuffer,m=!1;g&&(g.propDep?e=m=!0:g.contextDep&&e&&(m=!0),m||f(a,d,g));b.state.viewport&&b.state.viewport.propDynamic&&(e=!0);t(a,d,b);c(a,d,b.state,function(a){return!(a.contextDep&&e||a.propDep)});b.contextDep=e;b.needsContext=p;b.needsFramebuffer=m;p=b.shader.progVar;if(p.contextDep&&e||p.propDep)wa(a,
d,b,null);else if(p=p.append(a,d),d(a.shared.gl,".useProgram(",p,".program);"),b.shader.program)wa(a,d,b,b.shader.program);else{var g=a.global.def("{}"),m=d.def(p,".id"),l=d.def(g,"[",m,"]");d(a.cond(l).then(l,".call(this,a0,a1);")["else"](l,"=",g,"[",m,"]=",a.link(function(f){return va(wa,a,b,f,2)}),"(",p,");",l,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}function Ea(f,c){function b(a){var l=c.shader[a];l&&d.set(e.shader,"."+a,l.append(f,d))}var d=f.proc("scope",
3);f.batchId="a2";var e=f.shared,p=e.current;O(f,d,c.context);c.framebuffer&&c.framebuffer.append(f,d);a(Object.keys(c.state)).forEach(function(a){var b=c.state[a].append(f,d);Array.isArray(b)?b.forEach(function(c,b){d.set(f.next[a],"["+b+"]",c)}):d.set(e.next,"."+a,b)});["elements","offset","count","instances","primitive"].forEach(function(a){var b=c.draw[a];b&&d.set(e.draw,"."+a,""+b.append(f,d))});Object.keys(c.uniforms).forEach(function(a){d.set(e.uniforms,"["+n.id(a)+"]",c.uniforms[a].append(f,
d))});Object.keys(c.attributes).forEach(function(a){var b=c.attributes[a].append(f,d),e=f.scopeAttrib(a);Object.keys(new ma).forEach(function(a){d.set(e,"."+a,b[a])})});b("vert");b("frag");0<Object.keys(c.state).length&&(d(p,".dirty=true;"),d.exit(p,".dirty=true;"));d("a1(",f.shared.context,",a0,0);")}var ma=S.Record,ka={add:32774,subtract:32778,"reverse subtract":32779};z.ext_blend_minmax&&(ka.min=32775,ka.max=32776);var oa=z.angle_instanced_arrays,ra=z.webgl_draw_buffers,ha={dirty:!0},la={},pa=
[],ia={},ja={};F("dither",3024);F("blend.enable",3042);A("blend.color","blendColor",[0,0,0,0]);A("blend.equation","blendEquationSeparate",[32774,32774]);A("blend.func","blendFuncSeparate",[1,0,1,0]);F("depth.enable",2929,!0);A("depth.func","depthFunc",513);A("depth.range","depthRange",[0,1]);A("depth.mask","depthMask",!0);A("colorMask","colorMask",[!0,!0,!0,!0]);F("cull.enable",2884);A("cull.face","cullFace",1029);A("frontFace","frontFace",2305);A("lineWidth","lineWidth",1);F("polygonOffset.enable",
32823);A("polygonOffset.offset","polygonOffset",[0,0]);F("sample.alpha",32926);F("sample.enable",32928);A("sample.coverage","sampleCoverage",[1,!1]);F("stencil.enable",2960);A("stencil.mask","stencilMask",-1);A("stencil.func","stencilFunc",[519,0,-1]);A("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);A("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);F("scissor.enable",3089);A("scissor.box","scissor",[0,0,k.drawingBufferWidth,k.drawingBufferHeight]);A("viewport","viewport",
[0,0,k.drawingBufferWidth,k.drawingBufferHeight]);var xa={gl:k,context:M,strings:n,next:la,current:ha,draw:aa,elements:C,buffer:Q,shader:Y,attributes:S.state,uniforms:ga,framebuffer:Z,extensions:z,isBufferArgs:e},qa={primTypes:r,compareFuncs:x,blendFuncs:d,blendEquations:ka,stencilOps:w,glTypes:v,orientationType:m};ra&&(qa.backBuffer=[1029],qa.drawBuffer=G(q.maxDrawbuffers,function(a){return G(a,function(a){return 36064+a})}));var Aa=0;return{next:la,current:ha,procs:function(){var a=R(),c=a.proc("poll"),
b=a.proc("refresh"),d=a.block();c(d);b(d);var e=a.shared,p=e.gl,g=e.next,l=e.current;d(l,".dirty=false;");f(a,c);b(e.framebuffer,".dirty=true;");f(a,b);Object.keys(ia).forEach(function(f){var e=ia[f],t=d.def(g,".",f),m=a.block();m("if(",t,"){",p,".enable(",e,")}else{",p,".disable(",e,")}",l,".",f,"=",t,";");b(m);c("if(",t,"!==",l,".",f,"){",m,"}")});Object.keys(ja).forEach(function(f){var e=ja[f],t=ha[f],m,h,k=a.block();k(p,".",e,"(");Array.isArray(t)?(e=t.length,m=a.global.def(g,".",f),h=a.global.def(l,
".",f),k(G(e,function(a){return m+"["+a+"]"}),");",G(e,function(a){return h+"["+a+"]="+m+"["+a+"];"}).join("")),c("if(",G(e,function(a){return m+"["+a+"]!=="+h+"["+a+"]"}).join("||"),"){",k,"}")):(m=d.def(g,".",f),h=d.def(l,".",f),k(m,");",l,".",f,"=",m,";"),c("if(",m,"!==",h,"){",k,"}"));b(k)});return a.compile()}(),compile:function(a,f,c,b){var d=R(),e;e=ea(a);var p=ba(a,e),l=I(a),t=na(a);a=J(a);var g=p.viewport;g&&(t.viewport=g);g=P("scissor.box");(p=p[g])&&(t[g]=p);p=0<Object.keys(t).length;e=
{framebuffer:e,draw:l,shader:a,state:t,dirty:p};e.uniforms=T(c);e.attributes=ca(f);e.context=N(b);Ba(d,e);Ea(d,e);Da(d,e);return d.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":19,"./util/is-ndarray":21,"./util/is-typed-array":22,"./util/loop":24}],8:[function(k,n,q){function e(a,b){this.id=h++;this.type=a;this.data=b}function a(b){if(0===b.length)return[];var e=b.charAt(0),h=b.charAt(b.length-1);if(1<b.length&&e===h&&('"'===e||"'"===e))return['"'+b.substr(1,
b.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(e=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return a(b.substr(0,e.index)).concat(a(e[1])).concat(a(b.substr(e.index+e[0].length)));e=b.split(".");if(1===e.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(h=0;h<e.length;++h)b=b.concat(a(e[h]));return b}function b(b){return"["+a(b).join("][")+"]"}var h=0;n.exports={define:function(a,g){switch(typeof g){case "boolean":case "number":case "string":return new e(a,
b(g+""));case "undefined":return new e(a|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof e},unbox:function(a,g){if(a instanceof e){if(a.type&128)return new e(a.type&-129,b(g))}else if("function"===typeof a)return new e(0,a);return a},accessor:b}},{}],9:[function(k,n,q){var e=k("./util/is-typed-array"),a=k("./util/is-ndarray"),b=k("./constants/primitives.json");n.exports=function(h,p,g){function k(){this.buffer=null;this.primType=4;this.type=this.vertCount=
0}function n(h){function G(g){var d=p.oes_element_index_uint;if(g)if("number"===typeof g)v(g);else{var h=null,k="static";Array.isArray(g)||e(g)||a(g)?h=g:("data"in g&&(h=g.data),"usage"in g&&(k=g.usage));Array.isArray(h)||a(h)&&Array.isArray(h.data)||"type"in g?v({type:g.type||(d?"uint32":"uint16"),usage:k,data:h}):v({usage:k,data:h});if(Array.isArray(h)||e(h))v.dimension=3}else v();d=r.buffer.byteLength;h=0;switch(r.buffer.dtype){case 5121:case 5120:h=5121;break;case 5123:case 5122:h=5123;d>>=1;
break;case 5125:case 5124:h=5125,d>>=2}var k=4,m=r.buffer.dimension;1===m&&(k=0);2===m&&(k=1);3===m&&(k=4);"object"===typeof g&&("primitive"in g&&(k=b[g.primitive]),"count"in g&&(d=g.vertCount|0));r.primType=k;r.vertCount=d;r.type=h;return G}var r=new k,v=g.create(null,34963,!0);r.buffer=v._buffer;G(h);G._reglType="elements";G._elements=r;G.destroy=function(){v.destroy();r.buffer=null};return G}k.prototype.bind=function(){this.buffer.bind()};return{create:n,createStream:function(a){return n({usage:"stream",
data:a})._elements},destroyStream:function(a){g.destroyStream(a.buffer)},getElements:function(a){return"function"===typeof a&&a._elements instanceof k?a._elements:null}}}},{"./constants/primitives.json":6,"./util/is-ndarray":21,"./util/is-typed-array":22}],10:[function(k,n,q){n.exports=function(e){function a(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{b[a]=
e.getExtension(a)}catch(p){}})}var b={};a();return{extensions:b,refresh:a}}},{}],11:[function(k,n,q){var e=k("./util/values"),a=k("./util/extend");n.exports=function(b,h,p,g,k){function n(a,b,d,e){this.target=a;this.level=b;this.texture=d;this.renderbuffer=e}function q(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function z(a,b){var d=b.width,e=b.height;if(a.texture)var g=a.texture._texture,h=Math.max(1,g.params.width>>a.level),m=Math.max(1,
g.params.height>>a.level),d=d||h,e=e||m;else g=a.renderbuffer._renderbuffer,d=d||g.width,e=e||g.height;g.refCount+=1;b.width=d;b.height=e}function r(a,d){d?d.texture?b.framebufferTexture2D(36160,a,d.target,d.texture._texture.texture,d.level):b.framebufferRenderbuffer(36160,a,36161,d.renderbuffer._renderbuffer.renderbuffer):b.framebufferTexture2D(36160,a,3553,null,0)}function v(a){var b=3553,d=0,e=null,g=null;"object"===typeof a&&("level"in a&&(d=a.level|0),"target"in a&&(b=a.target|0));var h=a._reglType;
"texture"===h?e=a:"renderbuffer"===h&&(g=a,b=36161,d=0);return new n(b,d,e,g)}function E(a){return a&&(a.texture||a.renderbuffer)}function d(){this.id=Q++;C[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function x(a){b.isFramebuffer(a.framebuffer)||(a.framebuffer=b.createFramebuffer());m.dirty=!0;b.bindFramebuffer(36160,a.framebuffer);for(var d=
a.colorAttachments,e=0;e<d.length;++e)r(36064+e,d[e]);for(e=d.length;e<p.maxColorAttachments;++e)r(36064+e,null);r(36096,a.depthAttachment);r(36128,a.stencilAttachment);r(33306,a.depthStencilAttachment);h.webgl_draw_buffers&&h.webgl_draw_buffers.drawBuffersWEBGL(fa[d.length]);b.checkFramebufferStatus(36160)}function w(a){a=a.framebuffer;b.isFramebuffer(a)&&b.deleteFramebuffer(a)}var m={current:null,next:null,dirty:!1},X={rgba:6408},H={rgba4:32854,rgb565:36194,"rgb5 a1":32855};h.ext_srgb&&(H.srgba=
35907);h.ext_color_buffer_half_float&&(H.rgba16f=34842,H.rgb16f=34843);h.webgl_color_buffer_float&&(H.rgba32f=34836);var B=[],V=[];h.webgl_depth_texture&&(B.push(6402),V.push(34041));a(a({},X),H);e(X);e(H);H=5121;B={uint8:5121};h.oes_texture_half_float&&(H=B["half float"]=36193);h.oes_texture_float&&(H=B["float"]=5126);B.best=H;var fa=function(){for(var a=Array(p.maxDrawbuffers),b=0;b<=p.maxDrawbuffers;++b)for(var d=a[b]=Array(b),e=0;e<b;++e)d[e]=36064+e;return a}(),Q=0,C={};return a(m,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof d)?a:null},create:function(a){function e(a){var d,m=a||{},p=a=0;if("shape"in m){var w=m.shape;a=w[0];p=w[1]}else"radius"in m&&(a=p=m.radius),"width"in m&&(a=m.width),"height"in m&&(p=m.height);var r=null,w=!1;if("colorBuffers"in m||"colorBuffer"in m){r=m.colorBuffers||m.colorBuffer;Array.isArray(r)||(r=[r]);h.width=a;h.height=p;r=r.map(v);for(d=0;d<r.length;++d)z(r[d],h);a=h.width;p=h.height}else{var B=!0,u="rgba",V="uint8",H=1,
w=!0;h.width=a=a||b.drawingBufferWidth;h.height=p=p||b.drawingBufferHeight;"format"in m&&(u=m.format,B=u in X);"type"in m&&(V=m.type);"colorCount"in m&&(H=m.colorCount|0);if(h.ownsColor)for(r=h.colorAttachments;r.length>H;)q(r.pop());else r=[];for(d=0;d<r.length;++d){var J;a:{J=r[d];var I=B,C=u,T=a,Q=p;if(J.texture){var N=J.texture;if(I){N({format:C,type:V,width:T,height:Q});N._texture.refCount+=1;J=!0;break a}}else if(N=J.renderbuffer,!I){N({format:C,width:T,height:Q});N._renderbuffer.refCount+=
1;J=!0;break a}q(J);J=!1}J||(r[d--]=r[r.length-1],r.pop())}for(;r.length<H;)B?r.push(new n(3553,0,g.create({format:u,type:V,width:a,height:p},3553),null)):r.push(new n(36161,0,null,k.create({format:u,width:a,height:p})))}h.width=a;h.height=p;u=B=d=null;V=!1;"depthBuffer"in m&&(d=v(m.depthBuffer));"stencilBuffer"in m&&(B=v(m.stencilBuffer));"depthStencilBuffer"in m&&(u=v(m.depthStencilBuffer));if(d||B||u)z(d||B||u,h);else if(H=!0,I=J=!1,"depth"in m&&(H=!!m.depth),"stencil"in m&&(J=!!m.stencil),"depthTexture"in
m&&(I=!!m.depthTexture),m=h.depthAttachment||h.stencilAttachment||h.depthStencilAttachment,C=null,H||J)V=!0,I?(I=J?"depth stencil":"depth",h.ownsDepthStencil&&m.texture?(m.texture({format:I,width:a,height:p}),m.texture._texture.refCount+=1,C=m):C=new n(3553,0,g.create({format:I,width:a,height:p},3553),null)):(I=H?J?"depth stencil":"depth":"stencil",h.ownsDepthStencil&&m.renderbuffer?(m.renderbuffer({format:I,width:a,height:p}),m.renderbuffer._renderbuffer.refCount+=1,C=m):C=new n(36161,0,null,k.create({format:I,
width:a,height:p}))),H?J?u=C:d=C:B=C;a=h;a.colorAttachments.forEach(q);q(a.depthAttachment);q(a.stencilAttachment);q(a.depthStencilAttachment);h.colorAttachments=r;h.depthAttachment=d;h.stencilAttachment=B;h.depthStencilAttachment=u;h.ownsColor=w;h.ownsDepthStencil=V;e.color=r.map(E);e.depth=E(d);e.stencil=E(B);e.depthStencil=E(u);x(h);e.width=h.width;e.height=h.height;return e}var h=new d;e(a);e._reglType="framebuffer";e._framebuffer=h;e._destroy=function(){w(h)};return e},clear:function(){e(C).forEach(w)},
refresh:function(){e(C).forEach(x)}})}},{"./util/extend":20,"./util/values":28}],12:[function(k,n,q){n.exports=function(e,a){var b=1;a.ext_texture_filter_anisotropic&&(b=e.getParameter(34047));var h=1,p=1;a.webgl_draw_buffers&&(h=e.getParameter(34852),p=e.getParameter(36063));return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(a).filter(function(b){return!!a[b]}),
maxAnisotropic:b,maxDrawbuffers:h,maxColorAttachments:p,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),
maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}}},{}],13:[function(k,n,q){var e=k("./util/is-typed-array");n.exports=function(a,b,h){return function(p){var g=p||{};e(p)?g={data:g}:2===arguments.length?g={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof p&&(g={});b();var k=g.x||0,n=g.y||0,q=g.width||h.viewportWidth,z=g.height||h.viewportHeight,g=g.data||new Uint8Array(q*z*4);a.pixelStorei(3333,
4);a.readPixels(k,n,q,z,6408,5121,g);return g}}},{"./util/is-typed-array":22}],14:[function(k,n,q){var e=k("./util/values");n.exports=function(a,b,h){function p(){this.id=q++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function g(b){a.isRenderbuffer(b.renderbuffer)||(b.renderbuffer=a.createRenderbuffer());a.bindRenderbuffer(36161,b.renderbuffer);a.renderbufferStorage(36161,b.format,b.width,b.height)}function k(b){var e=b.renderbuffer;a.bindRenderbuffer(36161,
null);a.isRenderbuffer(e)&&a.deleteRenderbuffer(e);b.renderbuffer=null;b.refCount=0;delete z[b.id]}var n={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};b.ext_srgb&&(n.srgba=35907);b.ext_color_buffer_half_float&&(n.rgba16f=34842,n.rgb16f=34843);b.webgl_color_buffer_float&&(n.rgba32f=34836);var q=0,z={};p.prototype.decRef=function(){0===--this.refCount&&k(this)};return{create:function(a){function b(a){a=a||{};var h=0,p=0;"shape"in a?(p=a.shape,h=p[0]|0,p=
p[1]|0):("radius"in a&&(h=p=a.radius|0),"width"in a&&(h=a.width|0),"height"in a&&(p=a.height|0));b.width=e.width=Math.max(h,1);b.height=e.height=Math.max(p,1);e.format=32854;"format"in a&&(e.format=n[a.format]);g(e);return b}var e=new p;z[e.id]=e;b(a);b._reglType="renderbuffer";b._renderbuffer=e;b.destroy=function(){e.decRef()};return b},refresh:function(){e(z).forEach(g)},clear:function(){e(z).forEach(k)}}}},{"./util/values":28}],15:[function(k,n,q){var e=k("./util/values");n.exports=function(a,
b){function h(a,b,e,m){this.name=a;this.id=b;this.location=e;this.info=m}function p(a,b){for(var e=0;e<a.length;++e)if(a[e].id===b.id){a[e].location=b.location;return}a.push(b)}function g(d,e,h){h=35632===d?q:z;var m=h[e];if(!m){var g=b.str(e),m=a.createShader(d);a.shaderSource(m,g);a.compileShader(m);h[e]=m}return m}function k(a,b){this.id=E++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[]}function n(d,e){var k,m;k=g(35632,d.fragId);m=g(35633,d.vertId);var r=d.program=
a.createProgram();a.attachShader(r,k);a.attachShader(r,m);a.linkProgram(r);var v=a.getProgramParameter(r,35718),B=d.uniforms;for(k=0;k<v;++k)if(m=a.getActiveUniform(r,k))if(1<m.size)for(var q=0;q<m.size;++q){var G=m.name.replace("[0]","["+q+"]");p(B,new h(G,b.id(G),a.getUniformLocation(r,G),m))}else p(B,new h(m.name,b.id(m.name),a.getUniformLocation(r,m.name),m));v=a.getProgramParameter(r,35721);B=d.attributes;for(k=0;k<v;++k)(m=a.getActiveAttrib(r,k))&&p(B,new h(m.name,b.id(m.name),a.getAttribLocation(r,
m.name),m))}var q={},z={},r={},v=[],E=0;return{clear:function(){var b=a.deleteShader.bind(a);e(q).forEach(b);q={};e(z).forEach(b);z={};v.forEach(function(b){a.deleteProgram(b.program)});v.length=0;r={}},refresh:function(){q={};z={};v.forEach(n)},program:function(a,b,e){var h=r[b];h||(h=r[b]={});var g=h[a];g||(g=new k(b,a),n(g,e),h[a]=g,v.push(g));return g},shader:g,frag:null,vert:null}}},{"./util/values":28}],16:[function(k,n,q){n.exports=function(){var e={"":0},a=[""];return{id:function(b){var h=
e[b];if(h)return h;h=e[b]=a.length;a.push(b);return h},str:function(b){return a[b]}}}},{}],17:[function(k,n,q){function e(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function a(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var e=a[0].length,h=1;h<b;++h)if(!Array.isArray(a[h])||a[h].length!==e)return!1;return!0}function b(a){return Object.prototype.toString.call(a)}function h(a){return"[object HTMLCanvasElement]"===b(a)}function p(a){return"[object CanvasRenderingContext2D]"===
b(a)}var g=k("./util/extend"),K=k("./util/values"),G=k("./util/is-typed-array"),L=k("./util/is-ndarray"),z=k("./util/load-texture"),r=k("./util/to-half-float"),v=k("./util/parse-dds"),E=[9984,9986,9985,9987];n.exports=function(d,k,n,m,q){function H(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=
this.miplevel=0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function B(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function V(a,b){var c,d,e=0,h=0,m=0,g=0,k=0,p=0,n=!1,r=!1,v=!1;for(c=0;c<b.length;++c)d=b[c],g=g||d.width<<d.miplevel,k=k||d.height<<d.miplevel,
e=e||d.type,h=h||d.format,m=m||d.internalformat,p=p||d.channels,n=n||d.needsPoll,r=r||d.needsListeners,d=d.miplevel,v=v||0<d;a.needsPoll=n;a.needsListeners=r;a.width=g;a.height=k;a.format=h;a.internalformat=m;a.type=e;if(3553!==a.target)for(c=0;6>c;++c);c=0<=E.indexOf(a.minFilter);a.genMipmaps=!v&&(a.genMipmaps||c);v=v||a.genMipmaps;a.minFilter||(a.minFilter=v?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(c=0;c<b.length;++c)d=b[c],d.channels||(d.channels=p),d.format||(d.format=h),d.internalformat||
(d.internalformat=m),d.type||(d.type=e)}function fa(a){this.id=na++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new B(a);this.pixels=[]}function Q(a,b){function c(a,f){var c=f.mipmap,d;if(Array.isArray(c))for(var e=0;e<c.length;++e)d=new H(a),d.parseFlags(b),d.parseFlags(f),d.parse(c[e],e),h.push(d);else d=new H(a),d.parseFlags(b),d.parse(f,0),h.push(d)}var d;Z(a);var e=a.params;B.call(e,a.target);var h=a.pixels;h.length=
0;e.parse(b);if(3553===a.target)c(3553,b);else{var m=b.faces||b;if(Array.isArray(m))for(d=0;6>d;++d)c(34069+d,m[d]);else if("string"!==typeof m)for(d=0;6>d;++d)c(34069+d,{})}V(e,h);e.needsListeners&&u(a);e.needsPoll&&(a.pollId=ca.length,ca.push(a));C(a)}function C(a){d.isTexture(a.texture)||(a.texture=d.createTexture());var b=a.target,c=a.unit;0<=c?(d.activeTexture(33984+c),I=c):d.bindTexture(b,a.texture);for(var b=a.pixels,e=a.params,h=0;h<b.length;++h)b[h].upload(e);e.upload();0>c&&((c=O[I])?d.bindTexture(c.target,
c.texture):(a.unit=I,O[I]=a))}function u(a){function b(a,f,c){var d=v(c);d.pixels.forEach(function(b){var c=new H(d.cube?b.target:a);c.channels=d.channels;c.compressed=d.compressed;c.type=d.type;c.internalformat=d.format;c.format=J[d.format];c.width=b.width;c.height=b.height;c.miplevel=b.miplevel||f;c.data=b.data;e.push(c)})}function c(){for(var c=0;c<e.length;++c){var h=e[c],m=h.image,g=h.video,k=h.xhr;m&&m.complete?(h.width=m.naturalWidth,h.height=m.naturalHeight):g&&2<g.readyState?(h.width=g.width,
h.height=g.height):k&&4===k.readyState&&(e[c]=e[e.length-1],e.pop(),k.removeEventListener("readystatechange",C),b(h.target,h.miplevel,k.response))}V(d,e);C(a)}var d=a.params,e=a.pixels;e.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){e.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",
c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function Z(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((ca[b]=ca[ca.length-1]).id=b,ca.pop(),a.pollId=-1)}function ga(a){var b=a.texture,c=a.unit,e=a.target;0<=c&&(d.activeTexture(33984+c),I=c,d.bindTexture(e,null),O[c]=null);Z(a);d.isTexture(b)&&d.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete T[a.id]}var S={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
Y={repeat:10497,clamp:33071,mirror:33648},aa={nearest:9728,linear:9729},M=g({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},aa),P={none:0,browser:37444},F={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},A={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},R={};k.ext_srgb&&(A.srgb=35904,A.srgba=35906);k.oes_texture_float&&(F["float"]=5126);k.oes_texture_half_float&&
(F["half float"]=36193);k.webgl_depth_texture&&(g(A,{depth:6402,"depth stencil":34041}),g(F,{uint16:5123,uint32:5125,"depth stencil":34042}));k.webgl_compressed_texture_s3tc&&g(R,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});k.webgl_compressed_texture_atc&&g(R,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});k.webgl_compressed_texture_pvrtc&&g(R,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});k.webgl_compressed_texture_etc1&&(R["rgb etc1"]=36196);var ea=Array.prototype.slice.call(d.getParameter(34467));Object.keys(R).forEach(function(a){var b=R[a];0<=ea.indexOf(b)&&(A[a]=b)});var ba=Object.keys(A);n.textureFormats=ba;var J=ba.reduce(function(a,b){var c=A[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});g(H.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=P[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=A[b];b in F&&(this.type=F[b]);b in R&&(this.compressed=!0)}"type"in a&&(this.type=F[a.type]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),
"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(d,m){this.miplevel=m;this.width>>=m;this.height>>=m;var c=d;switch(typeof d){case "object":if(!d)return;
this.parseFlags(d);var g=d.data;if("string"===typeof g||g&&(G(g)||e(g)||L(g)||h(g)||p(g)||"[object HTMLImageElement]"===b(g)||"[object HTMLVideoElement]"===b(g)||a(g)))c=d.data;break;case "undefined":return}"string"===typeof c&&(c=z(c,this.crossOrigin));var g=null,k=!1;if(null!==c)if(G(c))this.data=c;else if(e(c))g=c,k=!0;else if(L(c)){Array.isArray(c.data)?(g=c.data,k=!0):this.data=c.data;var n=c.shape;this.width=n[0];this.height=n[1];this.channels=3===n.length?n[2]:1;n=c.stride;this.strideX=c.stride[0];
this.strideY=c.stride[1];this.strideC=3===n.length?c.stride[2]:1;this.offset=c.offset;this.needsTranspose=!0}else if(h(c)||p(c))h(c)?this.canvas=c:this.canvas=c.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===b(c))this.image=c,c.complete?(this.width=c.naturalWidth,this.height=c.naturalHeight):(this.width=this.width||c.naturalWidth,this.height=this.height||c.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===b(c))this.video=c,1<c.readyState?(this.width=c.width,this.height=c.height):(this.width=this.width||c.width,this.height=this.height||c.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===b(c))this.xhr=c,this.needsListeners=!0;else if(a(c)){var k=c[0].length,n=c.length,v=1,B,u,w,x;if(Array.isArray(c[0][0]))for(v=c[0][0].length,g=Array(k*n*v),u=x=0;u<n;++u)for(B=0;B<k;++B)for(w=0;w<v;++w)g[x++]=c[u][B][w];
else for(g=Array(k*n),u=x=0;u<n;++u)for(B=0;B<k;++B)g[x++]=c[u][B];this.width=k;this.height=n;this.channels=v;k=!0}else d.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||q.viewportWidth)|0,this.height=(this.height||q.viewportHeight)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=
[6409,6410,6407,6408][(this.channels=this.channels||4)-1]);c=this.internalformat;n=this.format=J[c];if(!this.channels)switch(n){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}n=this.type;5126!==n&&36193!==n&&(n||(n=6402===c?5125:5121));this.type=n;if(k)switch(n){case 5121:this.data=new Uint8Array(g);break;case 5123:this.data=new Uint16Array(g);break;case 5125:this.data=new Uint32Array(g);break;
case 5126:this.data=new Float32Array(g);break;case 36193:this.data=r(g)}if(this.data&&this.needsTranspose){g=this.data;c=this.width;k=this.height;n=this.channels;v=this.strideX;B=this.strideY;u=this.strideC;w=this.offset;x=new g.constructor(c*k*n);for(var E=0,K=0;K<k;++K)for(var A=0;A<c;++A)for(var C=0;C<n;++C)x[E++]=g[B*K+v*A+u*C+w];this.data=x}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){d.pixelStorei(37440,
this.flipY);d.pixelStorei(37441,this.premultiplyAlpha);d.pixelStorei(37443,this.colorSpace);d.pixelStorei(3317,this.unpackAlignment);var b=this.target,c=this.miplevel,e=this.image,h=this.canvas,g=this.video,k=this.data,p=this.internalformat,n=this.format,r=this.type,v=this.width||Math.max(1,a.width>>c);a=this.height||Math.max(1,a.height>>c);g&&2<g.readyState?d.texImage2D(b,c,n,n,r,g):e&&e.complete?d.texImage2D(b,c,n,n,r,e):h?d.texImage2D(b,c,n,n,r,h):this.compressed?d.compressedTexImage2D(b,c,p,v,
a,0,k):this.copy?(m(),d.copyTexImage2D(b,c,n,this.x,this.y,v,a,0)):k?d.texImage2D(b,c,n,v,a,0,n,r,k):d.texImage2D(b,c,n,v||1,a||1,0,n,r,null)}});g(B.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=M[a.min]);"mag"in a&&(this.magFilter=aa[a.mag]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var d=a.wrap;"string"===typeof d?b=c=Y[d]:Array.isArray(d)&&(b=Y[d[0]],c=Y[d[1]])}else"wrapS"in a&&(b=Y[a.wrapS]),"wrapT"in a&&(c=Y[a.wrapT]);this.wrapS=b;this.wrapT=c;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=S[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;d.texParameteri(a,10241,this.minFilter);d.texParameteri(a,10240,this.magFilter);d.texParameteri(a,10242,this.wrapS);d.texParameteri(a,10243,this.wrapT);k.ext_texture_filter_anisotropic&&d.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(d.hint(33170,this.mipmapHint),d.generateMipmap(a))}});
var I=0,na=0,T={},ca=[],N=n.maxTextureUnits,O=Array(N).map(function(){return null});g(fa.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<N;++b){var c=O[b];if(c){if(0<c.bindCount)continue;c.unit=-1}O[b]=this;a=b;break}this.unit=a;d.activeTexture(33984+a);d.bindTexture(this.target,this.texture);I=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&ga(this)}});return{create:function(a,b){function c(a,e,f,h,g,m){var k=a||{};34067===
b&&6===arguments.length&&(k=[a,e,f,h,g,m]);Q(d,k);c.width=d.params.width;c.height=d.params.height;return c}var d=new fa(b);T[d.id]=d;c(a);c._reglType="texture";c._texture=d;c.destroy=function(){d.decRef()};return c},refresh:function(){K(T).forEach(C);for(var a=0;a<N;++a)O[a]=null;I=0;d.activeTexture(33984)},clear:function(){for(var a=0;a<N;++a)d.activeTexture(33984+a),d.bindTexture(3553,null),O[a]=null;d.activeTexture(33984);I=0;K(T).forEach(ga)},poll:function(){ca.forEach(C)},getTexture:function(a){return null}}}},
{"./util/extend":20,"./util/is-ndarray":21,"./util/is-typed-array":22,"./util/load-texture":23,"./util/parse-dds":25,"./util/to-half-float":27,"./util/values":28}],18:[function(k,n,q){n.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],19:[function(k,n,q){function e(a){return Array.prototype.slice.call(a)}function a(a){return e(a).join("")}var b=k("./extend");n.exports=function(){function h(){var h=[],k=[];return b(function(){h.push.apply(h,
e(arguments))},{def:function(){var a="v"+g++;k.push(a);0<arguments.length&&(h.push(a,"="),h.push.apply(h,e(arguments)),h.push(";"));return a},toString:function(){return a([0<k.length?"var "+k+";":"",a(h)])}})}function k(){function a(b,d){g(b,d,"=",e.def(b,d),";")}var e=h(),g=h(),d=e.toString,p=g.toString;return b(e,{entry:e,exit:g,save:a,set:function(b,d,h){a(b,d);e(b,d,"=",h,";")},toString:function(){return d()+p()}})}var g=0,n=[],q=[],L=h(),z={};return{global:L,link:function(a){for(var b=0;b<q.length;++b)if(q[b]===
a)return n[b];b="g"+g++;n.push(b);q.push(a);return b},block:h,proc:function(e,h){function g(){var a="a"+d.length;d.push(a);return a}var d=[];h=h||0;for(var n=0;n<h;++n)g();var n=k(),q=n.toString;return z[e]=b(n,{arg:g,toString:function(){return a(["function(",d.join(),"){",q(),"}"])}})},scope:k,cond:function(){var h=a(arguments),g=k(),n=k(),d=g.toString,q=n.toString;return b(g,{then:function(){g.apply(g,e(arguments));return this},"else":function(){n.apply(n,e(arguments));return this},toString:function(){var b=
q();b&&(b="else{"+b+"}");return a(["if(",h,"){",d(),"}",b])}})},compile:function(){var b=['"use strict";',L,"return {"];Object.keys(z).forEach(function(a){b.push('"',a,'":',z[a].toString(),",")});b.push("}");var e=a(b).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(e)).apply(null,q)}}}},{"./extend":20}],20:[function(k,n,q){n.exports=function(e,a){for(var b=Object.keys(a),h=0;h<b.length;++h)e[b[h]]=a[b[h]];return e}},{}],21:[function(k,n,q){var e=k("./is-typed-array");
n.exports=function(a){return!!a&&"object"===typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"===typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||e(a.data))}},{"./is-typed-array":22}],22:[function(k,n,q){var e=k("../constants/arraytypes.json");n.exports=function(a){return Object.prototype.toString.call(a)in e}},{"../constants/arraytypes.json":4}],23:[function(k,n,q){n.exports=function(e,a){if("undefined"!==typeof document){var b;b=(b=/\.(\w+)(\?.*)?$/.exec(e))&&
b[1]?b[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(b))return b=document.createElement("video"),b.autoplay=!0,b.loop=!0,a&&(b.crossOrigin=a),b.src=e,b;if(0<=["dds"].indexOf(b))return b=new XMLHttpRequest,b.responseType="arraybuffer",b.open("GET",e,!0),b.send(),b;b=new Image;a&&(b.crossOrigin=a);b.src=e;return b}return null}},{}],24:[function(k,n,q){n.exports=function(e,a){for(var b=Array(e),h=0;h<e;++h)b[h]=a(h);return b}},
{}],25:[function(k,n,q){n.exports=function(k){function n(a){for(var b=S,d=Y,e=0;e<A;++e){var h=Math.max(1,b+3>>2)*Math.max(1,d+3>>2)*P;ea.pixels.push({target:a,miplevel:e,width:b,height:d,data:new Uint8Array(k,R,h)});R+=h;b>>=1;d>>=1}}var q=new Int32Array(k),ga=q[m],S=q[H],Y=q[X],aa=G,M=0,P=0,F=4;switch(q[fa]){case v:P=8;ga&r?(F=3,M=b):M=h;break;case E:P=16;M=p;break;case d:P=16;M=g;break;case x:P=8,M=K}var A=1;q[V]&L&&(A=Math.max(1,q[B]));var R=q[w]+4,ea={width:S,height:Y,channels:F,format:M,type:aa,
compressed:!0,cube:!1,pixels:[]};if(q[Q]&z)for(ea.cube=!0,q=0;6>q;++q)n(a+q);else n(e);return ea};var e=3553,a=34069,b=33776,h=33777,p=33778,g=33779,K=36196,G=5121,L=131072,z=512,r=64,v=827611204,E=861165636,d=894720068,x=826496069,w=1,m=2,X=3,H=4,B=7,V=20,fa=21,Q=28},{}],26:[function(k,n,q){n.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:{next:function(e){setTimeout(e,
30)},cancel:clearTimeout}},{}],27:[function(k,n,q){n.exports=function(e){for(var a=new Float32Array(e),a=new Uint32Array(a.buffer),b=new Uint16Array(e.length),h=0;h<e.length;++h)if(isNaN(e[h]))b[h]=65535;else if(Infinity===e[h])b[h]=31744;else if(-Infinity===e[h])b[h]=64512;else{var k=a[h],g=k>>>31<<15,n=(k<<1>>>24)-127,k=k>>13&1023;b[h]=-24>n?g:-14>n?g+(k+1024>>-14-n):15<n?g+31744:g+(n+15<<10)+k}return b}},{}],28:[function(k,n,q){n.exports=function(e){return Object.keys(e).map(function(a){return e[a]})}},
{}],29:[function(k,n,q){function e(e,k){function g(){var a=window.innerWidth,g=window.innerHeight;e!==document.body&&(g=e.getBoundingClientRect(),a=g.right-g.left,g=g.top-g.bottom);n.width=L*a;n.height=L*g;b(n.style,{width:a+"px",height:g+"px"})}var n=document.createElement("canvas"),q=a(n,k);b(n.style,{border:0,margin:0,padding:0,top:0,left:0});e.appendChild(n);e===document.body&&(n.style.position="absolute",b(e.style,{margin:0,padding:0}));var L=+q.options.pixelRatio;window.addEventListener("resize",
g,!1);var z=q.options.onDestroy;q.options=b(b({},q.options),{onDestroy:function(){window.removeEventListener("resize",g);e.removeChild(n);z&&z()}});g();return q}function a(a,e){function g(b){try{return a.getContext(b,k)}catch(e){return null}}var k=e.glOptions||{};return{gl:g("webgl")||g("experimental-webgl")||g("webgl-experimental"),options:b({pixelRatio:window.devicePixelRatio},e)}}var b=k("./util/extend");n.exports=function(h){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:h[0],
options:h[1]||{}};var k=document.body,g=h[1]||{};if("string"===typeof h[0])k=document.querySelector(h[0])||document.body;else if("object"===typeof h[0])if(h[0]instanceof HTMLElement)k=h[0];else{if(h[0]instanceof WebGLRenderingContext)return{gl:h[0],options:b({pixelRatio:1},g)};g=h[0]}return k.nodeName&&"CANVAS"===k.nodeName.toUpperCase()?a(k,g):e(k,g)}},{"./util/extend":20}],30:[function(k,n,q){n.exports=function(a,b){function h(a){var b=!1;"altKey"in a&&(b=b||a.altKey!==m.alt,m.alt=!!a.altKey);"shiftKey"in
a&&(b=b||a.shiftKey!==m.shift,m.shift=!!a.shiftKey);"ctrlKey"in a&&(b=b||a.ctrlKey!==m.control,m.control=!!a.ctrlKey);"metaKey"in a&&(b=b||a.metaKey!==m.meta,m.meta=!!a.metaKey);return b}function k(a,g){var n=e.x(g),p=e.y(g);"buttons"in g&&(a=g.buttons|0);if(a!==d||n!==x||p!==w||h(g))d=a|0,x=n||0,w=p||0,b&&b(d,x,w,m)}function g(a){k(0,a)}function n(){if(d||x||w||m.shift||m.alt||m.meta||m.control)d=x=w=0,m.shift=m.alt=m.control=m.meta=!1,b&&b(0,0,0,m)}function q(a){h(a)&&b&&b(d,x,w,m)}function L(a){0===
e.buttons(a)?k(0,a):k(d,a)}function z(a){k(d|e.buttons(a),a)}function r(a){k(d&~e.buttons(a),a)}function v(){X||(X=!0,a.addEventListener("mousemove",L),a.addEventListener("mousedown",z),a.addEventListener("mouseup",r),a.addEventListener("mouseleave",g),a.addEventListener("mouseenter",g),a.addEventListener("mouseout",g),a.addEventListener("mouseover",g),a.addEventListener("blur",n),a.addEventListener("keyup",q),a.addEventListener("keydown",q),a.addEventListener("keypress",q),a!==window&&(window.addEventListener("blur",
n),window.addEventListener("keyup",q),window.addEventListener("keydown",q),window.addEventListener("keypress",q)))}function E(){X&&(X=!1,a.removeEventListener("mousemove",L),a.removeEventListener("mousedown",z),a.removeEventListener("mouseup",r),a.removeEventListener("mouseleave",g),a.removeEventListener("mouseenter",g),a.removeEventListener("mouseout",g),a.removeEventListener("mouseover",g),a.removeEventListener("blur",n),a.removeEventListener("keyup",q),a.removeEventListener("keydown",q),a.removeEventListener("keypress",
q),a!==window&&(window.removeEventListener("blur",n),window.removeEventListener("keyup",q),window.removeEventListener("keydown",q),window.removeEventListener("keypress",q)))}b||(b=a,a=window);var d=0,x=0,w=0,m={shift:!1,alt:!1,control:!1,meta:!1},X=!1;v();var H={element:a};Object.defineProperties(H,{enabled:{get:function(){return X},set:function(a){a?v():E},enumerable:!0},buttons:{get:function(){return d},enumerable:!0},x:{get:function(){return x},enumerable:!0},y:{get:function(){return w},enumerable:!0},
mods:{get:function(){return m},enumerable:!0}});return H};var e=k("mouse-event")},{"mouse-event":31}],31:[function(k,n,q){function e(a){return a.target||a.srcElement||window}q.buttons=function(a){if("object"===typeof a){if("buttons"in a)return a.buttons;if("which"in a){a=a.which;if(2===a)return 4;if(3===a)return 2;if(0<a)return 1<<a-1}else if("button"in a){a=a.button;if(1===a)return 4;if(2===a)return 2;if(0<=a)return 1<<a}}return 0};q.element=e;q.x=function(a){if("object"===typeof a){if("offsetX"in
a)return a.offsetX;var b=e(a).getBoundingClientRect();return a.clientX-b.left}return 0};q.y=function(a){if("object"===typeof a){if("offsetY"in a)return a.offsetY;var b=e(a).getBoundingClientRect();return a.clientY-b.top}return 0}},{}],32:[function(k,n,q){var e=k("./lib/util/extend"),a=k("./lib/dynamic"),b=k("./lib/util/raf"),h=k("./lib/util/clock"),p=k("./lib/strings"),g=k("./lib/webgl"),K=k("./lib/extension"),G=k("./lib/limits"),L=k("./lib/buffer"),z=k("./lib/elements"),r=k("./lib/texture"),v=k("./lib/renderbuffer"),
E=k("./lib/framebuffer"),d=k("./lib/attribute"),x=k("./lib/shader"),w=k("./lib/read"),m=k("./lib/core");n.exports=function(){function k(){f=b.next(k);F.count+=1;var a=ca.viewport,c=ca.scissor_box;a[0]=a[1]=c[0]=c[1]=0;F.viewportWidth=F.frameBufferWidth=F.drawingBufferWidth=a[2]=c[2]=u.drawingBufferWidth;F.viewportHeight=F.frameBufferWidth=F.drawingBufferHeight=a[3]=c[3]=u.drawingBufferHeight;a=h();F.deltaTime=(a-aa)/1E3;F.time=(a-Y)/1E3;aa=a;T.procs.refresh();ba.poll();for(a=0;a<O.length;++a)(0,O[a])(F,
null,0)}function n(){f&&(b.cancel(k),f=0)}function q(a){n();a.preventDefault();if(Z.onContextLost)Z.onContextLost()}function V(a){u.getError();ga.refresh();T.procs.refresh();A.refresh();ba.refresh();J.refresh();I.refresh();ea.refresh();if(Z.onContextRestored)Z.onContextRestored();k()}function fa(b){function c(b){var c={},d={};Object.keys(b).forEach(function(e){var f=b[e];a.isDynamic(f)?d[e]=a.unbox(f,e):c[e]=f});return{dynamic:d,"static":c}}function d(a){for(;p.length<a;)p.push(null);return p}var f=
c(b.context||{}),g=c(b.uniforms||{}),h=c(b.attributes||{});b=c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=e({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(b));var f=T.compile(b,h,g,f),k=f.draw,m=f.batch,n=f.scope,p=[];return function(a,b){var c;if("function"===typeof a)return n.call(this,null,a,0);if("function"===
typeof b)if("number"===typeof a)for(c=0;c<a;++c)n.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)n.call(this,a[c],b,c);else return n.call(this,a,b,0);else if("number"===typeof a){if(0<a)return m.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return m.call(this,a,a.length)}else return k.call(this,a)}}function Q(){T.procs.poll()}var C=g(Array.prototype.slice.call(arguments)),u=C.gl,Z=C.options,C=p(),ga=K(u),S=ga.extensions,Y=h(),aa=Y,M=u.drawingBufferWidth,P=u.drawingBufferHeight,
F={count:0,deltaTime:0,time:0,viewportWidth:M,viewportHeight:P,framebufferWidth:M,framebufferHeight:P,drawingBufferWidth:M,drawingBufferHeight:P,pixelRatio:Z.pixelRatio},M=G(u,S),A=L(u),R=z(u,S,A),P=d(u,S,M,A,C),ea=x(u,C),ba=r(u,S,M,Q,F),J=v(u,S,M),I=E(u,S,M,ba,J),na=w(u,Q,F),T=m(u,C,S,M,A,R,ba,I,{},P,ea,{elements:null,primitive:4,count:-1,offset:0,instances:-1},F),ca=T.next,N=u.canvas,O=[],f=0;N&&(N.addEventListener("webglcontextlost",q,!1),N.addEventListener("webglcontextrestored",V,!1));T.procs.refresh();
return e(fa,{clear:function(a){var b=0;Q();var d=a.color;d&&(u.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),b|=16384);"depth"in a&&(u.clearDepth(+a.depth),b|=256);"stencil"in a&&(u.clearStencil(a.stencil|0),b|=1024);u.clear(b)},prop:a.define.bind(null,1),context:a.define.bind(null,2),"this":a.define.bind(null,3),draw:fa({}),elements:function(a){return R.create(a)},buffer:function(a){return A.create(a,34962)},texture:function(a){return ba.create(a,3553)},cube:function(a){return 6===arguments.length?
ba.create(Array.prototype.slice.call(arguments),34067):ba.create(a,34067)},renderbuffer:function(a){return J.create(a)},framebuffer:function(a){return I.create(a)},framebufferCube:function(a){},attributes:u.getContextAttributes(),frame:function(a){O.push(a);!f&&0<O.length&&k();return{cancel:function(){var b=O.find(function(b){return b===a});0>b||(O.splice(b,1),0>=O.length&&n())}}},limits:M,read:na,destroy:function(){n();N&&(N.removeEventListener("webglcontextlost",q),N.removeEventListener("webglcontextrestored",
V));ea.clear();I.clear();J.clear();ba.clear();A.clear();if(Z.onDestroy)Z.onDestroy()},_gl:u,_refresh:function(){T.procs.refresh()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":7,"./lib/dynamic":8,"./lib/elements":9,"./lib/extension":10,"./lib/framebuffer":11,"./lib/limits":12,"./lib/read":13,"./lib/renderbuffer":14,"./lib/shader":15,"./lib/strings":16,"./lib/texture":17,"./lib/util/clock":18,"./lib/util/extend":20,"./lib/util/raf":26,"./lib/webgl":29}]},{},[1]);
