(function e$$0(n,q,f){function a(c,d){if(!q[c]){if(!n[c]){var l="function"==typeof require&&require;if(!d&&l)return l(c,!0);if(p)return p(c,!0);l=Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l;}l=q[c]={exports:{}};n[c][0].call(l.exports,function(d){var f=n[c][1][d];return a(f?f:d)},l,l.exports,e$$0,n,q,f)}return q[c].exports}for(var p="function"==typeof require&&require,l=0;l<f.length;l++)a(f[l]);return a})({1:[function(h,n,q){var f=h("../regl")(),a=h("mouse-change")(),p=f.texture(),
l=f({frag:"\n  precision mediump float;\n  uniform sampler2D texture;\n  uniform vec2 mouse;\n  uniform float t;\n  varying vec2 uv;\n  void main () {\n    float dist = length(gl_FragCoord.xy - mouse);\n    gl_FragColor = vec4(0.98 * texture2D(texture,\n      uv + cos(t) * vec2(0.5 - uv.y, uv.x - 0.5) - sin(2.0 * t) * (uv - 0.5)).rgb, 1) +\n      exp(-0.01 * dist) * vec4(\n        1.0 + cos(2.0 * t),\n        1.0 + cos(2.0 * t + 1.5),\n        1.0 + cos(2.0 * t + 3.0),\n        0.0);\n  }",vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main () {\n    uv = position;\n    gl_Position = vec4(2.0 * position - 1.0, 0, 1);\n  }",
attributes:{position:[-2,0,0,-2,2,2]},uniforms:{texture:p,mouse:function(c){var d=c.pixelRatio;return[a.x*d,c.viewportHeight-a.y*d]},t:function(a){return.01*a.count}},count:3});f.frame(function(){f.clear({color:[0,0,0,1]});l();p({copy:!0})})},{"../regl":32,"mouse-change":30}],2:[function(h,n,q){function f(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}n.exports=function(a,p,l,c,d){a=l.maxAttributes;p=
Array(a);for(l=0;l<a;++l)p[l]=new f;return{Record:f,scope:{},state:p}}},{}],3:[function(h,n,q){function f(a){return M[Object.prototype.toString.call(a)]|0}function a(a,c){for(var d=0;d<c.length;++d)a[d]=c[d]}function p(a,c,d,f,l,b,p){for(var h=0,w=0;w<d;++w)for(var N=0;N<f;++N)a[h++]=c[l*w+b*N+p]}function l(a,c,d){for(var f=0,l=0;l<c.length;++l)for(var b=c[l],p=0;p<d;++p)a[f++]=b[p]}var c=h("./util/is-typed-array"),d=h("./util/is-ndarray"),A=h("./util/values"),v=h("./util/pool"),M=h("./constants/arraytypes.json"),
B=h("./constants/dtypes.json"),F=h("./constants/usage.json");n.exports=function(u){function h(a){this.id=b++;this.buffer=u.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121}function y(a,c,d){a.byteLength=c.byteLength;u.bufferData(a.type,c,d)}function r(b,g,u,h,r){b.usage=u;if(Array.isArray(g))b.dtype=h||5126,0<g.length&&(Array.isArray(g[0])?(b.dimension=g[0].length,h=v.allocType(b.dtype,g.length*b.dimension),l(h,g,b.dimension),y(b,h,u),v.freeType(h)):"number"===
typeof g[0]?(b.dimension=r,h=v.allocType(b.dtype,g.length),a(h,g),y(b,h,u),v.freeType(h)):c(g[0])&&(b.dimension=g[0].length,b.dtype=h||f(g[0])||5126,h=v.allocType(b.dtype,g.length*b.dimension),l(h,g,b.dimension),y(b,h,u),v.freeType(h)));else if(c(g))b.dtype=h||f(g),b.dimension=r,y(b,g,u);else if(d(g)){var z=g.shape,A=g.stride;r=g.offset;var P=0,D=0,L=0,S=0;1===z.length?(P=z[0],D=1,L=A[0],S=0):2===z.length&&(P=z[0],D=z[1],L=A[0],S=A[1]);b.dtype=h||f(g.data)||5126;b.dimension=D;h=v.allocType(b.dtype,
P*D);p(h,g.data,P,D,L,S,r);y(b,h,u);v.freeType(h)}}function g(a){var c=a.buffer;u.isBuffer(c)&&u.deleteBuffer(c);a.buffer=null;delete L[a.id]}var b=0,L={};h.prototype.bind=function(){u.bindBuffer(this.type,this.buffer)};var n=[];return{create:function(b,y,A){function n(a){var b=35044,g=null,f=0,l=0,p=1;Array.isArray(a)||c(a)||d(a)?g=a:"number"===typeof a?f=a|0:a&&("data"in a&&(g=a.data),"usage"in a&&(b=F[a.usage]),"type"in a&&(l=B[a.type]),"dimension"in a&&(p=a.dimension|0),"length"in a&&(f=a.length|
0));C.bind();g?r(C,g,b,l,p):(u.bufferData(C.type,f,b),C.dtype=l||5121,C.usage=b,C.dimension=p,C.byteLength=f);return n}var C=new h(y);L[C.id]=C;A||n(b);n._reglType="buffer";n._buffer=C;n.subdata=function(b,g){var h=(g||0)|0;C.bind();if(Array.isArray(b)){if(0<b.length)if("number"===typeof b[0]){var r=v.allocType(C.dtype,b.length);a(r,b);u.bufferSubData(C.type,h,r);v.freeType(r)}else if(Array.isArray(b[0])||c(b[0])){var r=b[0].length,y=v.allocType(C.dtype,b.length*r);l(y,b,r);u.bufferSubData(C.type,
h,y);v.freeType(y)}}else if(c(b))u.bufferSubData(C.type,h,b);else if(d(b)){var w=b.shape,A=b.stride,D=y=r=0,L=0;1===w.length?(r=w[0],y=1,D=A[0],L=0):2===w.length&&(r=w[0],y=w[1],D=A[0],L=A[1]);w=Array.isArray(b.data)?C.dtype:f(b.data);w=v.allocType(w,r*y);p(w,b.data,r,y,D,L,b.offset);u.bufferSubData(C.type,h,w);v.freeType(w)}return n};n.destroy=function(){g(C)};return n},createStream:function(a,b){var c=n.pop();c||(c=new h(a),c.buffer=u.createBuffer());c.bind();r(c,b,35040,0,1);return c},destroyStream:function(a){n.push(a)},
clear:function(){A(L).forEach(g)},getBuffer:function(a){return a&&a._buffer instanceof h?a._buffer:null},_initBuffer:r}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/pool":25,"./util/values":28}],4:[function(h,n,q){n.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,
"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(h,n,q){n.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(h,n,q){n.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(h,n,q){n.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(h,n,q){function f(a){return Array.isArray(a)||
M(a)||B(a)}function a(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function p(a,b,c,d){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=d}function l(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function c(a){return new p(!1,!1,!1,a)}function d(a,b){var c=a.type;return 0===c?(c=a.data.length,new p(!0,1<=c,2<=c,b)):new p(3===c,2===c,1===c,b)}var A=h("./util/codegen"),v=h("./util/loop"),M=h("./util/is-typed-array"),B=h("./util/is-ndarray"),F=h("./constants/primitives.json"),
u=h("./constants/dtypes.json"),D=["x","y","z","w"],y={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},r={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,
"!=":517,"!==":517,gequal:518,">=":518,always:519},g={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},b={cw:2304,ccw:2305},L=new p(!1,!1,!1,function(){});n.exports=function(h,w,n,q,B,G,z,fa,P,ca,W,S,ga){function K(m){return m.replace(".","_")}function I(m,a,b){var c=K(m);x.push(m);t[c]=e[c]=!!b;ja[c]=a}function J(m,a,b){var c=K(m);x.push(m);Array.isArray(b)?(e[c]=b.slice(),t[c]=b.slice()):e[c]=t[c]=b;ka[c]=a}function ha(){var m=
A(),a=m.link,b=m.global;m.id=Fa++;m.batchId="0";var c=a(Ea),d=m.shared={props:"a0"};Object.keys(Ea).forEach(function(k){d[k]=b.def(c,".",k)});var E=m.next={},wa=m.current={};Object.keys(ka).forEach(function(k){Array.isArray(e[k])&&(E[k]=b.def(d.next,".",k),wa[k]=b.def(d.current,".",k))});var k=m.constants={};Object.keys(ya).forEach(function(a){k[a]=b.def(JSON.stringify(ya[a]))});m.invoke=function(k,e){switch(e.type){case 0:var b=["this",d.context,d.props,m.batchId];return k.def(a(e.data),".call(",
b.slice(0,Math.max(e.data.length+1,4)),")");case 1:return k.def(d.props,e.data);case 2:return k.def(d.context,e.data);case 3:return k.def("this",e.data)}};m.attribCache={};var Ca={};m.scopeAttrib=function(k){k=w.id(k);if(k in Ca)return Ca[k];var m=ca.scope[k];m||(m=ca.scope[k]=new qa);return Ca[k]=a(m)};return m}function da(a){var e=a["static"];a=a.dynamic;if("framebuffer"in e){var b=e.framebuffer;return b?(b=fa.getFramebuffer(b),c(function(a,m){var e=a.link(b),k=a.shared;m.set(k.framebuffer,".next",
e);k=k.context;m.set(k,".framebufferWidth",e+".width");m.set(k,".framebufferHeight",e+".height");return e})):c(function(a,m){var e=a.shared;m.set(e.framebuffer,".next","null");e=e.context;m.set(e,".framebufferWidth",e+".drawingBufferWidth");m.set(e,".framebufferHeight",e+".drawingBufferHeight");return null})}if("framebuffer"in a){var g=a.framebuffer;return d(g,function(a,m){var e=a.invoke(m,g),k=a.shared,b=k.framebuffer,e=m.def(b,".getFramebuffer(",e,")");m.set(b,".next",e);k=k.context;m.set(k,".framebufferWidth",
e+"?"+e+".width:"+k+".drawingBufferWidth");m.set(k,".framebufferHeight",e+"?"+e+".height:"+k+".drawingBufferHeight");return e})}return null}function la(a,e){function b(k){if(k in c){var a=c[k];k=!0;var m=a.x|0,E=a.y|0,pa,f;"w"in a?pa=a.w|0:k=!1;"h"in a?f=a.h|0:k=!1;return new p(k&&e&&e.thisDep,k&&e&&e.contextDep,k&&e&&e.propDep,function(k,e){var b=k.shared.context,c=pa;"w"in a||(c=e.def(b,".","framebufferWidth","-",m));var H=f;"h"in a||(H=e.def(b,".","framebufferHeight","-",E));return[m,E,c,H]})}if(k in
g){var l=g[k];k=d(l,function(k,a){var e=k.invoke(a,l),m=k.shared.context,b=a.def(e,".x|0"),c=a.def(e,".y|0"),H=a.def('"w" in ',e,"?",e,".w|0:","(",m,".","framebufferWidth","-",b,")"),e=a.def('"h" in ',e,"?",e,".h|0:","(",m,".","framebufferHeight","-",c,")");return[b,c,H,e]});e&&(k.thisDep=k.thisDep||e.thisDep,k.contextDep=k.contextDep||e.contextDep,k.propDep=k.propDep||e.prpoDep);return k}return e?new p(e.thisDep,e.contextDep,e.propDep,function(k,a){var e=k.shared.context;return[0,0,a.def(e,".","framebufferWidth"),
a.def(e,".","framebufferHeight")]}):null}var c=a["static"],g=a.dynamic,E=b("viewport");if(E)var f=E,E=new p(E.thisDep,E.contextDep,E.propDep,function(k,a){var e=f.append(k,a),m=k.shared.context;a.set(m,".viewportWidth",e[2]);a.set(m,".viewportHeight",e[3]);return e});return{viewport:E,scissor_box:b("scissor.box")}}function ma(a){function e(k){if(k in b){var a=w.id(b[k]);k=c(function(){return a});k.id=a;return k}if(k in g){var m=g[k];return d(m,function(k,a){var e=k.invoke(a,m);return a.def(k.shared.strings,
".id(",e,")")})}return null}var b=a["static"],g=a.dynamic,f=e("frag"),E=e("vert"),wa=null;l(f)&&l(E)?(wa=W.program(E.id,f.id),a=c(function(k,a){return k.link(wa)})):a=new p(f&&f.thisDep||E&&E.thisDep,f&&f.contextDep||E&&E.contextDep,f&&f.propDep||E&&E.propDep,function(k,a){var e=k.shared.shader,m;m=f?f.append(k,a):a.def(e,".","frag");var b;b=E?E.append(k,a):a.def(e,".","vert");return a.def(e+".program("+b+","+m+")")});return{frag:f,vert:E,progVar:a,program:wa}}function sa(a){function e(a,k){if(a in
b){var m=b[a]|0;return c(function(a,e){k&&(a.OFFSET=m);return m})}if(a in g){var H=g[a];return d(H,function(a,e){var m=a.invoke(e,H);k&&(a.OFFSET=m);return m})}return k&&x?c(function(k,a){k.OFFSET="0";return 0}):null}var b=a["static"],g=a.dynamic,x=function(){if("elements"in b){var a=b.elements;f(a)?a=G.getElements(G.create(a)):a&&(a=G.getElements(a));var k=c(function(k,e){if(a){var m=k.link(a);return k.ELEMENTS=m}return k.ELEMENTS=null});k.value=a;return k}if("elements"in g){var e=g.elements;return d(e,
function(k,a){var m=k.shared,b=m.isBufferArgs,m=m.elements,c=k.invoke(a,e),H=a.def("null"),b=a.def(b,"(",c,")"),c=k.cond(b).then(H,"=",m,".createStream(",c,");")["else"](H,"=",m,".getElements(",c,");");a.entry(c);a.exit(k.cond(b).then(m,".destroyStream(",H,");"));return k.ELEMENTS=H})}return null}(),E=e("offset",!0);return{elements:x,primitive:function(){if("primitive"in b){var a=b.primitive;return c(function(k,e){return F[a]})}if("primitive"in g){var k=g.primitive;return d(k,function(a,e){var m=
a.constants.primTypes,b=a.invoke(e,k);return e.def(m,"[",b,"]")})}return x?l(x)?x.value?c(function(k,a){return a.def(k.ELEMENTS,".primType")}):c(function(){return 4}):new p(x.thisDep,x.contextDep,x.propDep,function(k,a){var e=k.ELEMENTS;return a.def(e,"?",e,".primType:",4)}):null}(),count:function(){if("count"in b){var a=b.count|0;return c(function(){return a})}if("count"in g){var k=g.count;return d(k,function(a,e){return a.invoke(e,k)})}return x?l(x)?x?E?new p(E.thisDep,E.contextDep,E.propDep,function(a,
k){return k.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):c(function(a,k){return k.def(a.ELEMENTS,".vertCount")}):c(function(){return-1}):new p(x.thisDep||E.thisDep,x.contextDep||E.contextDep,x.propDep||E.propDep,function(a,k){var e=a.ELEMENTS;return a.OFFSET?k.def(e,"?",e,".vertCount-",a.OFFSET,":-1"):k.def(e,"?",e,".vertCount:-1")}):null}(),instances:e("instances",!1),offset:E}}function Q(a){var e=a["static"],f=a.dynamic,l={};x.forEach(function(a){function m(k,b){if(a in e){var g=k(e[a]);l[x]=c(function(){return g})}else if(a in
f){var E=f[a];l[x]=d(E,function(a,k){return b(a,k,a.invoke(k,E))})}}var x=K(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return m(function(a){return a},function(a,e,m){return m});case "depth.func":return m(function(a){return r[a]},function(a,e,m){return e.def(a.constants.compareFuncs,"[",m,"]")});case "depth.range":return m(function(a){return a},
function(a,e,m){a=e.def("+",m,"[0]");e=e.def("+",m,"[1]");return[a,e]});case "blend.func":return m(function(a){return[y["srcRGB"in a?a.srcRGB:a.src],y["dstRGB"in a?a.dstRGB:a.dst],y["srcAlpha"in a?a.srcAlpha:a.src],y["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,e,m){function b(a,k){var H=e.def('"',a,k,'" in ',m,"?",m,".",a,k,":",m,".",a);return e.def(c,"[",H,"]")}var c=a.constants.blendFuncs;a=b("src","RGB");var H=b("src","Alpha"),d=b("dst","RGB"),g=b("dst","Alpha");return[a,d,H,g]});case "blend.equation":return m(function(a){if("string"===
typeof a)return[X[a],X[a]];if("object"===typeof a)return[X[a.rgb],X[a.alpha]]},function(a,e,m){var b=a.constants.blendEquations,c=e.def(),H=e.def();a=a.cond("typeof ",m,'==="string"');a.then(c,"=",H,"=",b,"[",m,"];");a["else"](c,"=",b,"[",m,".rgb];",H,"=",b,"[",m,".alpha];");e(a);return[c,H]});case "blend.color":return m(function(a){return v(4,function(e){return+a[e]})},function(a,e,m){return v(4,function(a){return e.def("+",m,"[",a,"]")})});case "stencil.mask":return m(function(a){return a|0},function(a,
e,m){return e.def(m,"|0")});case "stencil.func":return m(function(a){return[r[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,e,m){a=e.def('"cmp" in ',m,"?",a.constants.compareFuncs,"[",m,".cmp]",":",7680);var b=e.def(m,".ref|0");e=e.def('"mask" in ',m,"?",m,".mask|0:-1");return[a,b,e]});case "stencil.opFront":case "stencil.opBack":return m(function(e){return["stencil.opBack"===a?1029:1028,g[e.fail||"keep"],g[e.zfail||"keep"],g[e.pass||"keep"]]},function(e,m,b){function c(a){return m.def('"',
a,'" in ',b,"?",H,"[",b,".",a,"]:",7680)}var H=e.constants.stencilOps;return["stencil.opBack"===a?1029:1028,c("fail"),c("zfail"),c("pass")]});case "polygonOffset.offset":return m(function(a){return[a.factor|0,a.units|0]},function(a,e,m){a=e.def(m,".factor|0");e=e.def(m,".units|0");return[a,e]});case "cull.face":return m(function(a){var e=0;"front"===a?e=1028:"back"===a&&(e=1029);return e},function(a,e,m){return e.def(m,'==="front"?',1028,":",1029)});case "lineWidth":return m(function(a){return a},
function(a,e,m){return m});case "frontFace":return m(function(a){return b[a]},function(a,e,m){return e.def(m+'==="cw"?2304:2305')});case "colorMask":return m(function(a){return a.map(function(a){return!!a})},function(a,e,m){return v(4,function(a){return"!!"+m+"["+a+"]"})});case "sample.coverage":return m(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,e,m){a=e.def('"value" in ',m,"?+",m,".value:1");e=e.def("!!",m,".invert");return[a,e]})}});return l}function na(a){var e=a["static"],
b=a.dynamic,g={};Object.keys(e).forEach(function(a){var m=e[a],b;if("number"===typeof m||"boolean"===typeof m)b=c(function(){return m});else if("function"===typeof m&&("texture2d"===m._reglType||"textureCube"===m._reglTYpe))b=c(function(a){return a.link(m)});else if(Array.isArray(m)||M(m))b=c(function(a){return a.global.def("[",v(m.length,function(a){return m[a]}),"]")});b.value=m;g[a]=b});Object.keys(b).forEach(function(a){var e=b[a];g[a]=d(e,function(a,m){return a.invoke(m,e)})});return g}function V(a){var e=
a["static"],b=a.dynamic,g={};Object.keys(e).forEach(function(a){var m=e[a],b=w.id(a),k=new qa;if(f(m))k.state=1,k.buffer=B.getBuffer(B.create(m,34962,!1)),k.type=k.buffer.dtype;else{var d=B.getBuffer(m);if(d)k.state=1,k.buffer=d,k.type=d.dtype;else if(m.constant){var x=m.constant;k.state=2;"number"===typeof x?k.x=x:D.forEach(function(a,e){e<x.length&&(k[a]=x[e])})}else{var d=B.getBuffer(m.buffer),l=m.offset|0,t=m.stride|0,h=m.size|0,pa=!!m.normalized,p=0;"type"in m&&(p=u[m.type]);m=m.divisor|0;k.buffer=
d;k.state=1;k.size=h;k.normalized=pa;k.type=p||d.dtype;k.offset=l;k.stride=t;k.divisor=m}}g[a]=c(function(a,e){var m=a.attribCache;if(b in m)return m[b];var c={isStream:!1};Object.keys(k).forEach(function(a){c[a]=k[a]});k.buffer&&(c.buffer=a.link(k.buffer));return m[b]=c})});Object.keys(b).forEach(function(a){var e=b[a];g[a]=d(e,function(a,m){function b(a){m(f[a],"=",c,".",a,"|0;")}var c=a.invoke(m,e),H=a.shared,d=H.isBufferArgs,g=H.buffer,f={isStream:m.def(!1)},x=new qa;x.state=1;Object.keys(x).forEach(function(a){f[a]=
m.def(""+x[a])});var l=f.buffer,t=f.type;m("if(",d,"(",c,")){",f.isStream,"=true;",l,"=",g,".createStream(",34962,",",c,");",t,"=",l,".dtype;","}else{",l,"=",g,".getBuffer(",c,");","if(",l,"){",t,"=",l,".dtype;","}else if(",c,".constant){",f.state,"=",2,";",D.map(function(a,e){return f[a]+"="+c+".length>="+e+"?"+c+"["+e+"]:0;"}).join(""),"}else{",l,"=",g,".getBuffer(",c,".buffer);",t,'="type" in ',c,"?",H.glTypes,"[",c,".type]:",l,".dtype;",f.normalized,"=!!",c,".normalized;");b("size");b("offset");
b("stride");b("divisor");m("}}");return f})});return g}function O(a){var e=a["static"],b=a.dynamic,g={};Object.keys(e).forEach(function(a){var m=e[a];g[a]=c(function(a,e){return"number"===typeof m||"boolean"===typeof m?""+m:a.link(m)})});Object.keys(b).forEach(function(a){var e=b[a];g[a]=d(e,function(a,m){return a.invoke(m,e)})});return g}function T(a,e,b){var c=a.shared.context,d=a.scope();Object.keys(b).forEach(function(g){e.save(c,"."+g);d(c,".",g,"=",b[g].append(a,e),";")});e(d)}function Z(a,
e,b){var c=a.shared,d=c.gl,g=c.framebuffer,f;ea&&(f=e.def(c.extensions,".webgl_draw_buffers"));var k=a.constants,c=k.drawBuffer,k=k.backBuffer;a=b?b.append(a,e):e.def(g,".next");e("if(",g,".dirty||",a,"!==",g,".cur){","if(",a,"){",d,".bindFramebuffer(",36160,",",a,".framebuffer);");ea&&e(f,".drawBuffersWEBGL(",c,"[",a,".colorAttachments.length]);");e("}else{",d,".bindFramebuffer(",36160,",null);");ea&&e(f,".drawBuffersWEBGL(",k,");");e("}",g,".cur=",a,";",g,".dirty=false;","}")}function oa(a,b,c){var d=
a.shared,g=d.gl,f=a.current,l=a.next,k=d.current,t=d.next,h=a.cond(k,".dirty");x.forEach(function(b){b=K(b);if(!(b in c.state)){var d,H;if(b in l){d=l[b];H=f[b];var x=v(e[b].length,function(a){return h.def(d,"[",a,"]")});h(a.cond(x.map(function(a,e){return a+"==="+H+"["+e+"]"}).join("&&")).then(g,".",ka[b],"(",x,");",x.map(function(a,e){return H+"["+e+"]="+a}).join(";"),";"))}else d=h.def(t,".",b),x=a.cond(d,"!==",k,".",b),h(x),b in ja?x(a.cond(d).then(g,".enable(",ja[b],");")["else"](g,".disable(",
ja[b],");"),k,".",b,"=",d,";"):x(g,".",ka[b],"(",d,");",k,".",b,"=",d,";")}});0===Object.keys(c.state).length&&h(k,".dirty=false;");b(h)}function ta(e,b,c,d){var g=e.shared,f=e.current,x=g.current,k=g.gl;a(Object.keys(c)).forEach(function(a){var g=c[a];if(!d||d(g)){var h=g.append(e,b);if(ja[a]){var t=ja[a];l(g)?h?b(k,".enable(",t,");"):b(k,".disable(",t,");"):b(e.cond(h).then(k,".enable(",t,");")["else"](k,".disable(",t,");"));b(x,".",a,"=",h,";")}else if(Array.isArray(h)){var p=f[a];b(k,".",ka[a],
"(",h,");",h.map(function(a,e){return p+"["+e+"]="+a}).join(";"),";")}else b(k,".",ka[a],"(",h,");",x,".",a,"=",h,";")}})}function ra(a,e){ia&&!a.instancing&&(a.instancing=e.def(a.shared.extensions,".angle_instanced_arrays"))}function ua(a,e,b,c,d){function g(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function f(b,c,d){function g(){e("if(!",t,".pointer){",l,".enableVertexAttribArray(",
h,");",t,".pointer=true;}");var b=d.type,k;k=d.size?e.def(d.size,"||",c):c;e("if(",t,".type!==",b,"||",t,".size!==",k,"||",pa.map(function(a){return t+"."+a+"!=="+d[a]}).join("||"),"){",l,".bindBuffer(",34962,",",p,".buffer);",l,".vertexAttribPointer(",[h,k,b,d.normalized,d.stride,d.offset],");",t,".type=",b,";",t,".size=",k,";",pa.map(function(a){return t+"."+a+"="+d[a]+";"}).join(""),"}");ia&&(b=d.divisor,e("if(",t,".divisor!==",b,"){",a.instancing,".vertexAttribDivisorANGLE(",[h,b],");",t,".divisor=",
b,";}"))}function x(){e("if(",t,".pointer){",l,".disableVertexAttribArray(",h,");",t,".pointer=false;","}if(",D.map(function(a,e){return t+"."+a+"!=="+u[e]}).join("||"),"){",l,".vertexAttrib4f(",h,",",u,");",D.map(function(a,e){return t+"."+a+"="+u[e]+";"}).join(""),"}")}var l=k.gl,h=e.def(b,".location"),t=e.def(k.attributes,"[",h,"]");b=d.state;var p=d.buffer,u=[d.x,d.y,d.z,d.w],pa=["buffer","normalized","offset","stride"];1===b?g():2===b?x():(e("if(",b,"===",1,"){"),g(),e("}else{"),x(),e("}"))}
var k=a.shared;c.forEach(function(k){var c=k.name,x=b.attributes[c],l;if(x){if(!d(x))return;l=x.append(a,e)}else{if(!d(L))return;var t=a.scopeAttrib(c);l={};Object.keys(new qa).forEach(function(a){l[a]=e.def(t,".",a)})}f(a.link(k),g(k.info.type),l)})}function Y(a,e,b,c,d){for(var g=a.shared,f=g.gl,k,x=0;x<c.length;++x){var l=c[x],t=l.name,h=l.info.type,p=b.uniforms[t],l=a.link(l)+".location";if(p){if(!d(p))continue;if(p["static"]){t=p.value;if(35678===h||35680===h)h=a.link(t._texture),e(f,".uniform1i(",
l,h+".bind());"),e.exit(h,".unbind()");else if(35674===h||35675===h||35676===h)t=a.global.def("["+t+"]"),p=2,35675===h?p=3:35676===h&&(p=4),e(f,".uniformMatrix",p,"fv(",l,",false,",t,");");else{switch(h){case 5126:k="1f";break;case 35664:k="2f";break;case 35665:k="3f";break;case 35666:k="4f";break;case 35670:k="1i";break;case 5124:k="1i";break;case 35671:k="2i";break;case 35667:k="2i";break;case 35672:k="3i";break;case 35668:k="3i";break;case 35673:k="4i";break;case 35669:k="4i"}e(f,".uniform",k,
"(",l,",",t,");")}continue}else t=p.append(a,e)}else{if(!d(L))continue;t=e.def(g.uniforms,"[",w.id(t),"]")}p=",";switch(h){case 35678:case 35680:h=e.def(t,"._texture");e(f,".uniform1i(",l,",",h,".bind());");e.exit(h,".unbind();");continue;case 5124:case 35670:k="1i";break;case 35667:case 35671:k="2iv";break;case 35668:case 35672:k="3iv";break;case 35669:case 35673:k="4iv";break;case 5126:k="1f";break;case 35664:k="2fv";break;case 35665:k="3fv";break;case 35666:k="4fv";break;case 35674:k="Matrix2fv";
p=",false,";break;case 35675:k="Matrix3fv";p=",false,";break;case 35676:k="Matrix4fv",p=",false,"}e(f,".uniform",k,"(",l,p,t,");")}}function aa(a,e,b,c){function d(k){var c=h[k];return c?c.batchStatic?c.append(a,e):c.append(a,b):e.def(t,".",k)}function g(){function a(){b(A,".drawElementsInstancedANGLE(",[u,y,n,r+"<<(("+n+"-5121)>>1)",z],");")}function e(){b(A,".drawArraysInstancedANGLE(",[u,r,y,z],");")}p?v?a():(b("if(",p,"){"),a(),b("}else{"),e(),b("}")):e()}function f(){function a(){b(x+".drawElements("+
[u,y,n,r+"<<(("+n+"-5121)>>1)"]+");")}function e(){b(x+".drawArrays("+[u,r,y]+");")}p?v?a():(b("if(",p,"){"),a(),b("}else{"),e(),b("}")):e()}var k=a.shared,x=k.gl,t=k.draw,h=c.draw,p=function(){var k=h.elements,c=e;k?(k.batchStatic||(c=b),k=k.append(a,c)):k=c.def(t,".","elements");k&&c("if("+k+")"+x+".bindBuffer(34963,"+k+".buffer.buffer);");return k}(),u=d("primitive"),r=d("offset"),y=function(){var k=h.count,c=e;k?(k.batchStatic||(c=b),k=k.append(a,c)):k=c.def(t,".","count");return k}();if("number"===
typeof y){if(0===y)return}else b("if(",y,"){"),b.exit("}");var z,A;ia&&(z=d("instances"),A=a.instancing);var n=p+".type",v=h.elements&&l(h.elements);ia&&("number"!==typeof z||0<=z)?"string"===typeof z?(b("if(",z,">0){"),g(),b("}else if(",z,"<0){"),f(),b("}")):g():f()}function ba(a,e,b,c,d){e=ha();d=e.proc("body",d);ia&&(e.instancing=d.def(e.shared.extensions,".angle_instanced_arrays"));a(e,d,b,c);return e.compile().body}function za(a,e,b,c){ra(a,e);ua(a,e,b,c.attributes,function(){return!0});Y(a,
e,b,c.uniforms,function(){return!0});aa(a,e,e,b)}function Aa(a,e){var b=a.proc("draw",1);ra(a,b);T(a,b,e.context);Z(a,b,e.framebuffer);oa(a,b,e);ta(a,b,e.state);var c=e.shader.progVar.append(a,b);b(a.shared.gl,".useProgram(",c,".program);");if(e.shader.program)za(a,b,e,e.shader.program);else{var d=a.global.def("{}"),g=b.def(c,".id"),f=b.def(d,"[",g,"]");b(a.cond(f).then(f,".call(this,a0);")["else"](f,"=",d,"[",g,"]=",a.link(function(b){return ba(za,a,e,b,1)}),"(",c,");",f,".call(this,a0);"))}0<Object.keys(e.state).length&&
b(a.shared.current,".dirty=true;")}function Da(a,e,b,c){function d(){return!0}a.batchId="a1";ra(a,e);ua(a,e,b,c.attributes,d);Y(a,e,b,c.uniforms,d);aa(a,e,e,b)}function va(a,e,b,c){function d(a){return a.contextDep&&f||a.propDep}function g(a){return!d(a)}ra(a,e);var f=b.contextDynamic,k=e.def(),x=e.def();a.shared.props=x;a.batchId=k;var l=a.scope(),t=a.scope();e(l.entry,"for(",k,"=0;",k,"<","a1",";++",k,"){",x,"=","a0","[",k,"];",t,"}",l.exit);b.needsContext&&T(a,t,b.context);b.needsFramebuffer&&
Z(a,t,b.framebuffer);ta(a,t,b.state,d);c?(ua(a,l,b,c.attributes,g),ua(a,t,b,c.attributes,d),Y(a,l,b,c.uniforms,g),Y(a,t,b,c.uniforms,d),aa(a,l,t,b)):(e=a.global.def("{}"),c=b.shader.progVar.append(a,t),x=t.def(c,".id"),l=t.def(e,"[",x,"]"),t(a.shared.gl,".useProgram(",c,".program);","if(!",l,"){",l,"=",e,"[",x,"]=",a.link(function(e){return ba(Da,a,b,e,2)}),"(",c,");}",l,".call(this,a0[",k,"],",k,");"))}function Ba(a,e){var b=a.proc("batch",2);a.batchId="0";ra(a,b);var c=!1,d=!0;Object.keys(e.context).forEach(function(a){c=
c||e.context[a].propDep});c||(T(a,b,e.context),d=!1);var g=e.framebuffer,f=!1;g&&(g.propDep?c=f=!0:g.contextDep&&c&&(f=!0),f||Z(a,b,g));e.state.viewport&&e.state.viewport.propDynamic&&(c=!0);oa(a,b,e);ta(a,b,e.state,function(a){return!(a.contextDep&&c||a.propDep)});e.contextDep=c;e.needsContext=d;e.needsFramebuffer=f;d=e.shader.progVar;if(d.contextDep&&c||d.propDep)va(a,b,e,null);else if(d=d.append(a,b),b(a.shared.gl,".useProgram(",d,".program);"),e.shader.program)va(a,b,e,e.shader.program);else{var g=
a.global.def("{}"),f=b.def(d,".id"),k=b.def(g,"[",f,"]");b(a.cond(k).then(k,".call(this,a0,a1);")["else"](k,"=",g,"[",f,"]=",a.link(function(b){return ba(va,a,e,b,2)}),"(",d,");",k,".call(this,a0,a1);"))}0<Object.keys(e.state).length&&b(a.shared.current,".dirty=true;")}function xa(e,b){function c(a){var k=b.shader[a];k&&d.set(g.shader,"."+a,k.append(e,d))}var d=e.proc("scope",3);e.batchId="a2";var g=e.shared,f=g.current;T(e,d,b.context);b.framebuffer&&b.framebuffer.append(e,d);a(Object.keys(b.state)).forEach(function(a){var c=
b.state[a].append(e,d);Array.isArray(c)?c.forEach(function(b,c){d.set(e.next[a],"["+c+"]",b)}):d.set(g.next,"."+a,c)});["elements","offset","count","instances","primitive"].forEach(function(a){var c=b.draw[a];c&&d.set(g.draw,"."+a,""+c.append(e,d))});Object.keys(b.uniforms).forEach(function(a){d.set(g.uniforms,"["+w.id(a)+"]",b.uniforms[a].append(e,d))});Object.keys(b.attributes).forEach(function(a){var c=b.attributes[a].append(e,d),g=e.scopeAttrib(a);Object.keys(new qa).forEach(function(a){d.set(g,
"."+a,c[a])})});c("vert");c("frag");0<Object.keys(b.state).length&&(d(f,".dirty=true;"),d.exit(f,".dirty=true;"));d("a1(",e.shared.context,",a0,0);")}var qa=ca.Record,X={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(X.min=32775,X.max=32776);var ia=n.angle_instanced_arrays,ea=n.webgl_draw_buffers,e={dirty:!0},t={},x=[],ja={},ka={};I("dither",3024);I("blend.enable",3042);J("blend.color","blendColor",[0,0,0,0]);J("blend.equation","blendEquationSeparate",[32774,32774]);J("blend.func",
"blendFuncSeparate",[1,0,1,0]);I("depth.enable",2929,!0);J("depth.func","depthFunc",513);J("depth.range","depthRange",[0,1]);J("depth.mask","depthMask",!0);J("colorMask","colorMask",[!0,!0,!0,!0]);I("cull.enable",2884);J("cull.face","cullFace",1029);J("frontFace","frontFace",2305);J("lineWidth","lineWidth",1);I("polygonOffset.enable",32823);J("polygonOffset.offset","polygonOffset",[0,0]);I("sample.alpha",32926);I("sample.enable",32928);J("sample.coverage","sampleCoverage",[1,!1]);I("stencil.enable",
2960);J("stencil.mask","stencilMask",-1);J("stencil.func","stencilFunc",[519,0,-1]);J("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);J("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);I("scissor.enable",3089);J("scissor.box","scissor",[0,0,h.drawingBufferWidth,h.drawingBufferHeight]);J("viewport","viewport",[0,0,h.drawingBufferWidth,h.drawingBufferHeight]);var Ea={gl:h,context:ga,strings:w,next:t,current:e,draw:S,elements:G,buffer:B,shader:W,attributes:ca.state,uniforms:P,
framebuffer:fa,extensions:n,isBufferArgs:f},ya={primTypes:F,compareFuncs:r,blendFuncs:y,blendEquations:X,stencilOps:g,glTypes:u,orientationType:b};ea&&(ya.backBuffer=[1029],ya.drawBuffer=v(q.maxDrawbuffers,function(a){return 0===a?[0]:v(a,function(a){return 36064+a})}));var Fa=0;return{next:t,current:e,procs:function(){var a=ha(),b=a.proc("poll"),c=a.proc("refresh"),d=a.block();b(d);c(d);var g=a.shared,f=g.gl,x=g.next,k=g.current;d(k,".dirty=false;");Z(a,b);c(g.framebuffer,".dirty=true;");Z(a,c);
Object.keys(ja).forEach(function(e){var g=ja[e],t=d.def(x,".",e),l=a.block();l("if(",t,"){",f,".enable(",g,")}else{",f,".disable(",g,")}",k,".",e,"=",t,";");c(l);b("if(",t,"!==",k,".",e,"){",l,"}")});Object.keys(ka).forEach(function(g){var t=ka[g],l=e[g],h,p,u=a.block();u(f,".",t,"(");Array.isArray(l)?(t=l.length,h=a.global.def(x,".",g),p=a.global.def(k,".",g),u(v(t,function(a){return h+"["+a+"]"}),");",v(t,function(a){return p+"["+a+"]="+h+"["+a+"];"}).join("")),b("if(",v(t,function(a){return h+
"["+a+"]!=="+p+"["+a+"]"}).join("||"),"){",u,"}")):(h=d.def(x,".",g),p=d.def(k,".",g),u(h,");",k,".",g,"=",h,";"),b("if(",h,"!==",p,"){",u,"}"));c(u)});return a.compile()}(),compile:function(a,e,b,c){var d=ha(),g;g=da(a);var f=la(a,g),k=sa(a),t=Q(a);a=ma(a);var l=f.viewport;l&&(t.viewport=l);l=K("scissor.box");(f=f[l])&&(t[l]=f);f=0<Object.keys(t).length;g={framebuffer:g,draw:k,shader:a,state:t,dirty:f};g.uniforms=na(b);g.attributes=V(e);g.context=O(c);Aa(d,g);xa(d,g);Ba(d,g);return d.compile()}}}},
{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":20,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/loop":24}],9:[function(h,n,q){function f(a,d){this.id=l++;this.type=a;this.data=d}function a(c){if(0===c.length)return[];var d=c.charAt(0),f=c.charAt(c.length-1);if(1<c.length&&d===f&&('"'===d||"'"===d))return['"'+c.substr(1,c.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(d=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(c))return a(c.substr(0,d.index)).concat(a(d[1])).concat(a(c.substr(d.index+
d[0].length)));d=c.split(".");if(1===d.length)return['"'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];c=[];for(f=0;f<d.length;++f)c=c.concat(a(d[f]));return c}function p(c){return"["+a(c).join("][")+"]"}var l=0;n.exports={define:function(a,d){switch(typeof d){case "boolean":case "number":case "string":return new f(a,p(d+""));case "undefined":return new f(a|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof f},unbox:function(a,d){if(a instanceof f){if(a.type&
128)return new f(a.type&-129,p(d))}else if("function"===typeof a)return new f(0,a);return a},accessor:p}},{}],10:[function(h,n,q){var f=h("./util/is-typed-array"),a=h("./util/is-ndarray"),p=h("./constants/primitives.json"),l=h("./constants/usage.json");n.exports=function(c,d,h){function n(a){this.buffer=a;this.primType=4;this.type=this.vertCount=0}function M(c,l,p,r,g,b,n){(b=n)||f(l)&&(!a(l)||f(l.data))||(b=d.oes_element_index_uint?5125:5123);c.buffer.bind();h._initBuffer(c.buffer,l,p,b,3);l=n;if(!n){switch(c.buffer.dtype){case 5121:case 5120:l=
5121;break;case 5123:case 5122:l=5123;break;case 5125:case 5124:l=5125}c.buffer.dtype=l}c.type=l;0>g&&(g=c.buffer.byteLength,5123===l?g>>=1:5125===l&&(g>>=2));c.vertCount=g;g=r;0>r&&(g=4,r=c.buffer.dimension,1===r&&(g=0),2===r&&(g=1),3===r&&(g=4));c.primType=g}var B={uint8:5121,uint16:5123};d.oes_element_index_uint&&(B.uint32=5125);n.prototype.bind=function(){this.buffer.bind()};var F=[];return{create:function(d){function D(d){if(d)if("number"===typeof d)y(d),r.primType=4,r.vertCount=d|0,r.type=5121;
else{var b=null,h=35044,u=-1,n=-1,v=0,A=0;Array.isArray(d)||f(d)||a(d)?b=d:("data"in d&&(b=d.data),"usage"in d&&(h=l[d.usage]),"primitive"in d&&(u=p[d.primitive]),"count"in d&&(n=d.count|0),"length"in d&&(v=d.length|0),"type"in d&&(A=B[d.type]));b?M(r,b,h,u,n,v,A):(d=r.buffer,d.bind(),c.bufferData(34963,v,h),d.dtype=A||5121,d.usage=h,d.dimension=3,d.byteLength=v,r.primType=0>u?4:u,r.vertCount=0>n?0:n,r.type=d.dtype)}else y(),r.primType=4,r.vertCount=0,r.type=5121;return D}var y=h.create(null,34963,
!0),r=new n(y._buffer);D(d);D._reglType="elements";D._elements=r;D.subdata=function(a,b){y.subdata(a,b);return D};D.destroy=function(){y.destroy();r.buffer=null};return D},createStream:function(a){var c=F.pop();c||(c=new n(h.create(null,34963,!0)._buffer));M(c,a,35040,-1,-1,0,0);return c},destroyStream:function(a){F.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof n?a._elements:null}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":22,
"./util/is-typed-array":23}],11:[function(h,n,q){n.exports=function(f){function a(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{h[a]=
f.getExtension(a)}catch(c){}})}var h={};a();return{extensions:h,refresh:a}}},{}],12:[function(h,n,q){var f=h("./util/values"),a=h("./util/extend");n.exports=function(h,l,c,d,n){function v(a,b,c,d){this.target=a;this.level=b;this.texture=c;this.renderbuffer=d}function M(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function B(a,b){var c=b.width,d=b.height;if(a.texture)var g=a.texture._texture,f=Math.max(1,g.params.width>>a.level),l=Math.max(1,
g.params.height>>a.level),c=c||f,d=d||l;else g=a.renderbuffer._renderbuffer,c=c||g.width,d=d||g.height;g.refCount+=1;b.width=c;b.height=d}function F(a,b){b?b.texture?h.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):h.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):h.framebufferTexture2D(36160,a,3553,null,0)}function u(a){var b=3553,c=0,d=null,g=null;"object"===typeof a&&("level"in a&&(c=a.level|0),"target"in a&&(b=a.target|0));var f=a._reglType;
"texture"===f?d=a:"renderbuffer"===f&&(g=a,b=36161,c=0);return new v(b,c,d,g)}function D(a){return a&&(a.texture||a.renderbuffer)}function y(){this.id=R++;G[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function r(a){h.isFramebuffer(a.framebuffer)||(a.framebuffer=h.createFramebuffer());b.dirty=!0;h.bindFramebuffer(36160,a.framebuffer);for(var d=
a.colorAttachments,g=0;g<d.length;++g)F(36064+g,d[g]);for(g=d.length;g<c.maxColorAttachments;++g)F(36064+g,null);F(36096,a.depthAttachment);F(36128,a.stencilAttachment);F(33306,a.depthStencilAttachment);l.webgl_draw_buffers&&l.webgl_draw_buffers.drawBuffersWEBGL(U[d.length]);h.checkFramebufferStatus(36160)}function g(a){a=a.framebuffer;h.isFramebuffer(a)&&h.deleteFramebuffer(a)}var b={current:null,next:null,dirty:!1},L={rgba:6408},C={rgba4:32854,rgb565:36194,"rgb5 a1":32855};l.ext_srgb&&(C.srgba=
35907);l.ext_color_buffer_half_float&&(C.rgba16f=34842,C.rgb16f=34843);l.webgl_color_buffer_float&&(C.rgba32f=34836);var w=[],q=[];l.webgl_depth_texture&&(w.push(6402),q.push(34041));a(a({},L),C);f(L);f(C);C=5121;w={uint8:5121};l.oes_texture_half_float&&(C=w["half float"]=36193);l.oes_texture_float&&(C=w["float"]=5126);w.best=C;var U=function(){for(var a=Array(c.maxDrawbuffers),b=0;b<=c.maxDrawbuffers;++b)for(var d=a[b]=Array(b),g=0;g<b;++g)d[g]=36064+g;return a}(),R=0,G={};return a(b,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof y)?a:null},create:function(a){function b(a){var g,f=a||{},l=a=0;if("shape"in f){var y=f.shape;a=y[0];l=y[1]}else"radius"in f&&(a=l=f.radius),"width"in f&&(a=f.width),"height"in f&&(l=f.height);var w=null,y=!1;if("colorBuffers"in f||"colorBuffer"in f){w=f.colorBuffers||f.colorBuffer;Array.isArray(w)||(w=[w]);c.width=a;c.height=l;w=w.map(u);for(g=0;g<w.length;++g)B(w[g],c);a=c.width;l=c.height}else{var F=!0,q="rgba",C="uint8",z=1,
y=!0;c.width=a=a||h.drawingBufferWidth;c.height=l=l||h.drawingBufferHeight;"format"in f&&(q=f.format,F=q in L);"type"in f&&(C=f.type);"colorCount"in f&&(z=f.colorCount|0);if(c.ownsColor)for(w=c.colorAttachments;w.length>z;)M(w.pop());else w=[];for(g=0;g<w.length;++g){var N;a:{N=w[g];var G=F,Q=q,U=a,R=l;if(N.texture){var O=N.texture;if(G){O({format:Q,type:C,width:U,height:R});O._texture.refCount+=1;N=!0;break a}}else if(O=N.renderbuffer,!G){O({format:Q,width:U,height:R});O._renderbuffer.refCount+=
1;N=!0;break a}M(N);N=!1}N||(w[g--]=w[w.length-1],w.pop())}for(;w.length<z;)F?w.push(new v(3553,0,d.create2D({format:q,type:C,width:a,height:l},3553),null)):w.push(new v(36161,0,null,n.create({format:q,width:a,height:l})))}c.width=a;c.height=l;q=F=g=null;C=!1;"depthBuffer"in f&&(g=u(f.depthBuffer));"stencilBuffer"in f&&(F=u(f.stencilBuffer));"depthStencilBuffer"in f&&(q=u(f.depthStencilBuffer));if(g||F||q)B(g||F||q,c);else if(z=!0,G=N=!1,"depth"in f&&(z=!!f.depth),"stencil"in f&&(N=!!f.stencil),"depthTexture"in
f&&(G=!!f.depthTexture),f=c.depthAttachment||c.stencilAttachment||c.depthStencilAttachment,Q=null,z||N)C=!0,G?(G=N?"depth stencil":"depth",c.ownsDepthStencil&&f.texture?(f.texture({format:G,width:a,height:l}),f.texture._texture.refCount+=1,Q=f):Q=new v(3553,0,d.create({format:G,width:a,height:l},3553),null)):(G=z?N?"depth stencil":"depth":"stencil",c.ownsDepthStencil&&f.renderbuffer?(f.renderbuffer({format:G,width:a,height:l}),f.renderbuffer._renderbuffer.refCount+=1,Q=f):Q=new v(36161,0,null,n.create({format:G,
width:a,height:l}))),z?N?q=Q:g=Q:F=Q;a=c;a.colorAttachments.forEach(M);M(a.depthAttachment);M(a.stencilAttachment);M(a.depthStencilAttachment);c.colorAttachments=w;c.depthAttachment=g;c.stencilAttachment=F;c.depthStencilAttachment=q;c.ownsColor=y;c.ownsDepthStencil=C;b.color=w.map(D);b.depth=D(g);b.stencil=D(F);b.depthStencil=D(q);r(c);b.width=c.width;b.height=c.height;return b}var c=new y;b(a);b._reglType="framebuffer";b._framebuffer=c;b._destroy=function(){g(c)};return b},clear:function(){f(G).forEach(g)},
refresh:function(){f(G).forEach(r)}})}},{"./util/extend":21,"./util/values":28}],13:[function(h,n,q){n.exports=function(f,a){var h=1;a.ext_texture_filter_anisotropic&&(h=f.getParameter(34047));var l=1,c=1;a.webgl_draw_buffers&&(l=f.getParameter(34852),c=f.getParameter(36063));return{colorBits:[f.getParameter(3410),f.getParameter(3411),f.getParameter(3412),f.getParameter(3413)],depthBits:f.getParameter(3414),stencilBits:f.getParameter(3415),subpixelBits:f.getParameter(3408),extensions:Object.keys(a).filter(function(c){return!!a[c]}),
maxAnisotropic:h,maxDrawbuffers:l,maxColorAttachments:c,pointSizeDims:f.getParameter(33901),lineWidthDims:f.getParameter(33902),maxViewportDims:f.getParameter(3386),maxCombinedTextureUnits:f.getParameter(35661),maxCubeMapSize:f.getParameter(34076),maxRenderbufferSize:f.getParameter(34024),maxTextureUnits:f.getParameter(34930),maxTextureSize:f.getParameter(3379),maxAttributes:f.getParameter(34921),maxVertexUniforms:f.getParameter(36347),maxVertexTextureUnits:f.getParameter(35660),maxVaryingVectors:f.getParameter(36348),
maxFragmentUniforms:f.getParameter(36349),glsl:f.getParameter(35724),renderer:f.getParameter(7937),vendor:f.getParameter(7936),version:f.getParameter(7938)}}},{}],14:[function(h,n,q){var f=h("./util/is-typed-array");n.exports=function(a,h,l){return function(c){var d=c||{};f(c)?d={data:d}:2===arguments.length?d={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof c&&(d={});h();var n=d.x||0,v=d.y||0,q=d.width||l.viewportWidth,B=d.height||l.viewportHeight,d=d.data||new Uint8Array(q*B*4);a.pixelStorei(3333,
4);a.readPixels(n,v,q,B,6408,5121,d);return d}}},{"./util/is-typed-array":23}],15:[function(h,n,q){var f=h("./util/values");n.exports=function(a,h,l){function c(){this.id=q++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function d(c){a.isRenderbuffer(c.renderbuffer)||(c.renderbuffer=a.createRenderbuffer());a.bindRenderbuffer(36161,c.renderbuffer);a.renderbufferStorage(36161,c.format,c.width,c.height)}function n(c){var d=c.renderbuffer;a.bindRenderbuffer(36161,
null);a.isRenderbuffer(d)&&a.deleteRenderbuffer(d);c.renderbuffer=null;c.refCount=0;delete B[c.id]}var v={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};h.ext_srgb&&(v.srgba=35907);h.ext_color_buffer_half_float&&(v.rgba16f=34842,v.rgb16f=34843);h.webgl_color_buffer_float&&(v.rgba32f=34836);var q=0,B={};c.prototype.decRef=function(){0===--this.refCount&&n(this)};return{create:function(a){function f(a){a=a||{};var c=0,g=0;"shape"in a?(g=a.shape,c=g[0]|0,g=
g[1]|0):("radius"in a&&(c=g=a.radius|0),"width"in a&&(c=a.width|0),"height"in a&&(g=a.height|0));f.width=l.width=Math.max(c,1);f.height=l.height=Math.max(g,1);l.format=32854;"format"in a&&(l.format=v[a.format]);d(l);return f}var l=new c;B[l.id]=l;f(a);f._reglType="renderbuffer";f._renderbuffer=l;f.destroy=function(){l.decRef()};return f},refresh:function(){f(B).forEach(d)},clear:function(){f(B).forEach(n)}}}},{"./util/values":28}],16:[function(h,n,q){var f=h("./util/values");n.exports=function(a,
h){function l(a,c,d,b){this.name=a;this.id=c;this.location=d;this.info=b}function c(a,c){for(var d=0;d<a.length;++d)if(a[d].id===c.id){a[d].location=c.location;return}a.push(c)}function d(c,d,f){f=35632===c?q:B;var b=f[d];if(!b){var l=h.str(d),b=a.createShader(c);a.shaderSource(b,l);a.compileShader(b);f[d]=b}return b}function n(a,c){this.id=D++;this.fragId=a;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[]}function v(f,n){var g,b;g=d(35632,f.fragId);b=d(35633,f.vertId);var u=f.program=
a.createProgram();a.attachShader(u,g);a.attachShader(u,b);a.linkProgram(u);var v=a.getProgramParameter(u,35718),w=f.uniforms;for(g=0;g<v;++g)if(b=a.getActiveUniform(u,g))if(1<b.size)for(var A=0;A<b.size;++A){var q=b.name.replace("[0]","["+A+"]");c(w,new l(q,h.id(q),a.getUniformLocation(u,q),b))}else c(w,new l(b.name,h.id(b.name),a.getUniformLocation(u,b.name),b));v=a.getProgramParameter(u,35721);w=f.attributes;for(g=0;g<v;++g)(b=a.getActiveAttrib(u,g))&&c(w,new l(b.name,h.id(b.name),a.getAttribLocation(u,
b.name),b))}var q={},B={},F={},u=[],D=0;return{clear:function(){var c=a.deleteShader.bind(a);f(q).forEach(c);q={};f(B).forEach(c);B={};u.forEach(function(c){a.deleteProgram(c.program)});u.length=0;F={}},refresh:function(){q={};B={};u.forEach(v)},program:function(a,c,d){var b=F[c];b||(b=F[c]={});var f=b[a];f||(f=new n(c,a),v(f,d),b[a]=f,u.push(f));return f},shader:d,frag:null,vert:null}}},{"./util/values":28}],17:[function(h,n,q){n.exports=function(){var f={"":0},a=[""];return{id:function(h){var l=
f[h];if(l)return l;l=f[h]=a.length;a.push(h);return l},str:function(f){return a[f]}}}},{}],18:[function(h,n,q){function f(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function a(a){if(!Array.isArray(a))return!1;var c=a.length;if(0===c||!Array.isArray(a[0]))return!1;for(var d=a[0].length,f=1;f<c;++f)if(!Array.isArray(a[f])||a[f].length!==d)return!1;return!0}function p(a){return Object.prototype.toString.call(a)}function l(b){if(!b)return!1;var c=p(b);return 0<=g.indexOf(c)?!0:
f(b)||a(b)||M(b)}function c(a,c){36193===a.type?(a.data=F(c),B.freeType(c)):a.data=c}var d=h("./util/extend"),A=h("./util/values"),v=h("./util/is-typed-array"),M=h("./util/is-ndarray"),B=h("./util/pool"),F=h("./util/to-half-float");q=h("./constants/arraytypes.json");var u=h("./constants/arraytypes.json"),D=[9984,9986,9985,9987],y=[0,6409,6410,6407,6408],r={};r[6409]=r[6406]=r[6402]=1;r[34041]=r[6410]=2;r[6407]=3;r[6408]=4;var g=Object.keys(q).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]",
"[object HTMLImageElement]","[object HTMLVideoElement]"]);n.exports=function(b,g,h,n,q){function U(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function R(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;
a.width=b.width;a.height=b.height;a.channels=b.channels}function G(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=ua[b.colorSpace]);"type"in b&&(a.type=Y[b.type]);var c=a.width,d=a.height,f=a.channels,g=!1;"shape"in b?(c=b.shape[0],d=b.shape[1],3===b.shape.length&&(f=b.shape[2],g=!0)):("radius"in b&&(c=d=b.radius),"width"in b&&(c=b.width),
"height"in b&&(d=b.height),"channels"in b&&(f=b.channels,g=!0));a.width=c|0;a.height=d|0;a.channels=f|0;c=!1;"format"in b&&(c=b.format,d=a.internalformat=aa[c],a.format=Da[d],c in Y&&!("type"in b)&&(a.type=Y[c]),c in ba&&(a.compressed=!0),c=!0);!g&&c?a.channels=r[a.format]:g&&!c&&a.channels!==y[a.format]&&(a.format=a.internalformat=y[a.channels])}}function z(a){b.pixelStorei(37440,a.flipY);b.pixelStorei(37441,a.premultiplyAlpha);b.pixelStorei(37443,a.colorSpace);b.pixelStorei(3317,a.unpackAlignment)}
function fa(){U.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function P(e,b){var d=null;l(b)?d=b:b&&(G(e,b),"x"in b&&(e.xOffset=b.x|0),"y"in b&&(e.yOffset=b.y|0),l(b.data)&&(d=b.data));if(b.copy){var g=q.viewportWidth,h=q.viewportHeight;e.width=e.width||g-e.xOffset;e.height=e.height||h-e.yOffset;e.needsCopy=!0}else if(!d)e.width=e.width||1,e.height=e.height||1;else if(v(d))e.data=d,"type"in b||5121!==e.type||(e.type=u[Object.prototype.toString.call(d)]|
0);else if(f(d)){g=d;h=e.width*e.height*e.channels;switch(e.type){case 5121:case 5123:case 5125:case 5126:h=B.allocType(e.type,h);h.set(g);e.data=h;break;case 36193:e.data=F(g)}e.alignment=1;e.needsFree=!0}else if(M(d)){g=d.data;Array.isArray(g)||5121!==e.type||(e.type=u[Object.prototype.toString.call(g)]|0);var h=d.shape,n=d.stride,w,r,m,A;3===h.length?(m=h[2],A=n[2]):A=m=1;w=h[0];r=h[1];h=n[0];n=n[1];e.alignment=1;e.width=w;e.height=r;e.channels=m;e.format=e.internalformat=y[m];e.needsFree=!0;w=
A;d=d.offset;m=e.width;A=e.height;r=e.channels;for(var D=B.allocType(36193===e.type?5126:e.type,m*A*r),z=0,C=0;C<A;++C)for(var E=0;E<m;++E)for(var Z=0;Z<r;++Z)D[z++]=g[h*E+n*C+w*Z+d];c(e,D)}else if("[object HTMLCanvasElement]"===p(d)||"[object CanvasRenderingContext2D]"===p(d))"[object HTMLCanvasElement]"===p(d)?e.element=d:e.element=d.canvas,e.width=e.element.width,e.height=e.element.height;else if("[object HTMLImageElement]"===p(d))e.element=d,e.width=d.naturalWidth,e.height=d.naturalHeight;else if("[object HTMLVideoElement]"===
p(d))e.element=d,e.width=d.videoWidth,e.height=d.videoHeight,e.needsPoll=!0;else if(a(d)){g=d[0].length;h=d.length;n=1;if(Array.isArray(d[0][0])){w=n=d[0][0].length;m=B.allocType(36193===e.type?5126:e.type,g*h*w);for(r=A=0;r<h;++r)for(D=d[r],z=0;z<g;++z)for(C=D[z],E=0;E<w;++E)m[A++]=C[E];c(e,m)}else{w=B.allocType(36193===e.type?5126:e.type,g*h);for(A=m=0;A<h;++A)for(r=d[A],D=0;D<g;++D)w[m++]=r[D];c(e,w)}e.alignment=1;e.width=g;e.height=h;e.channels=n;e.format=e.internalformat=y[n];e.needsFree=!0}}
function ca(a,c,d,f,g){var h=a.element,l=a.data,p=a.internalformat,m=a.format,u=a.type,r=a.width,A=a.height;z(a);h?b.texSubImage2D(c,g,d,f,m,u,h):a.compressed?b.compressedTexSubImage2D(c,g,d,f,p,r,A,l):a.needsCopy?(n(),b.copyTexSubImage2D(c,g,d,f,a.xOffset,a.yOffset,r,A)):b.texSubImage2D(c,g,d,f,r,A,m,u,l)}function W(){return va.pop()||new fa}function S(a){a.needsFree&&B.freeType(a.data);fa.call(a);va.push(a)}function ga(){U.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=
Array(16)}function K(a,b,c){var d=a.images[0]=W();a.mipmask=1;d.width=a.width=b;d.height=a.height=c}function I(a,b){var c=null;if(l(b))c=a.images[0]=W(),P(c,b),a.mipmask=1;else if(G(a,b),Array.isArray(b.mipmap))for(var d=b.mipmap,f=0;f<d.length;++f)c=a.images[f]=W(),R(c,a),c.width>>=f,c.height>>=f,P(c,d[f]),a.mipmask|=1<<f;else c=a.images[0]=W(),R(c,a),P(c,b),a.mipmask=1;R(a,a.images[0])}function J(a,c){for(var d=a.images,f=0;f<d.length&&d[f];++f){var g=d[f],h=c,l=f,p=g.element,m=g.data,u=g.internalformat,
r=g.format,A=g.type,v=g.width,q=g.height;z(g);p?b.texImage2D(h,l,r,r,A,p):g.compressed?b.compressedTexImage2D(h,l,u,v,q,0,m):g.needsCopy?(n(),b.copyTexImage2D(h,l,r,g.xOffset,g.yOffset,v,q,0)):b.texImage2D(h,l,r,v,q,0,r,A,m)}}function ha(){var a=Ba.pop()||new ga;U.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function da(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&S(b[c]),b[c]=null;Ba.push(a)}function la(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=
1;this.genMipmaps=!1;this.mipmapHint=4352}function ma(a,b){"min"in b&&(a.minFilter=ra[b.min],0<=D.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=ta[b.mag]);var c=a.wrapS,d=a.wrapT;if("wrap"in b){var f=b.wrap;"string"===typeof f?c=d=oa[f]:Array.isArray(f)&&(c=oa[f[0]],d=oa[f[1]])}else"wrapS"in b&&(c=oa[b.wrapS]),"wrapT"in b&&(d=oa[b.wrapT]);a.wrapS=c;a.wrapT=d;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=
Z[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function sa(a,c){b.texParameteri(c,10241,a.minFilter);b.texParameteri(c,10240,a.magFilter);b.texParameteri(c,10242,a.wrapS);b.texParameteri(c,10243,a.wrapT);g.ext_texture_filter_anisotropic&&b.texParameteri(c,34046,a.anisotropic);a.genMipmaps&&(b.hint(33170,a.mipmapHint),b.generateMipmap(c))}function Q(){var a=xa.pop()||new la;la.call(a);return a}function na(a){U.call(this);
this.mipmask=0;this.id=qa++;this.refCount=1;this.target=a;this.texture=b.createTexture();this.unit=-1;this.bindCount=0}function V(a){b.activeTexture(33984);b.bindTexture(a.target,a.texture)}function O(){var a=ea[0];a?b.bindTexture(a.target,a.texture):b.bindTexture(3553,null)}function T(a){var c=a.texture,d=a.unit,f=a.target;0<=d&&(b.activeTexture(33984+d),b.bindTexture(f,null),ea[d]=null);b.deleteTexture(c);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete X[a.id]}var Z={"don't care":4352,
"dont care":4352,nice:4354,fast:4353},oa={repeat:10497,clamp:33071,mirror:33648},ta={nearest:9728,linear:9729},ra=d({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ta),ua={none:0,browser:37444},Y={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},aa={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ba={};g.ext_srgb&&(aa.srgb=35904,aa.srgba=35906);g.oes_texture_float&&
(Y["float"]=5126);g.oes_texture_half_float&&(Y.float16=Y["half float"]=36193);g.webgl_depth_texture&&(d(aa,{depth:6402,"depth stencil":34041}),d(Y,{uint16:5123,uint32:5125,"depth stencil":34042}));g.webgl_compressed_texture_s3tc&&d(ba,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});g.webgl_compressed_texture_atc&&d(ba,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});g.webgl_compressed_texture_pvrtc&&d(ba,{"rgb pvrtc 4bppv1":35840,
"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});g.webgl_compressed_texture_etc1&&(ba["rgb etc1"]=36196);var za=Array.prototype.slice.call(b.getParameter(34467));Object.keys(ba).forEach(function(a){var b=ba[a];0<=za.indexOf(b)&&(aa[a]=b)});var Aa=Object.keys(aa);h.textureFormats=Aa;var Da=Aa.reduce(function(a,b){var c=aa[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),va=[],Ba=[],
xa=[],qa=0,X={},ia=h.maxTextureUnits,ea=Array(ia).map(function(){return null});d(na.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var c=0;c<ia;++c){var d=ea[c];if(d){if(0<d.bindCount)continue;d.unit=-1}ea[c]=this;a=c;break}this.unit=a;b.activeTexture(33984+a);b.bindTexture(this.target,this.texture)}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&T(this)}});return{create2D:function(a,b){function c(a,b){var e=Q(),f=ha();"number"===typeof a?
"number"===typeof b?K(f,a|0,b|0):K(f,a|0,a|0):a?(ma(e,a),I(f,a)):K(f,1,1);e.genMipmaps&&(f.mipmask=(f.width<<1)-1);d.mipmask=f.mipmask;R(d,f);c.width=f.width;c.height=f.height;V(d);J(f,3553);sa(e,3553);O();xa.push(e);da(f);return c}var d=new na(3553);X[d.id]=d;c(a,b);c.subimage=function(a,b,e,f){b|=0;e|=0;f|=0;var g=W();R(g,d);g.width>>=f;g.height>>=f;g.width-=b;g.height-=e;P(g,a);V(d);ca(g,3553,b,e,f);O();S(g);return c};c._reglType="texture2d";c._texture=d;c.destroy=function(){d.decRef()};return c},
createCube:function(a,b,c,d,f,g){function h(a,b,c,d,e,f){var g,p=Q();for(g=0;6>g;++g)m[g]=ha();if("number"===typeof a||!a)for(a=a|0||1,g=0;6>g;++g)K(m[g],a,a);else if("object"===typeof a)if(b)I(m[0],a),I(m[1],b),I(m[2],c),I(m[3],d),I(m[4],e),I(m[5],f);else if(ma(p,a),G(l,a),"faces"in a)for(a=a.faces,g=0;6>g;++g)R(m[g],l),I(m[g],a[g]);else for(g=0;6>g;++g)I(m[g],a);R(l,m[0]);l.mipmask=p.genMipmaps?(m[0].width<<1)-1:m[0].mipmask;h.width=m[0].width;h.height=m[0].height;V(l);for(g=0;6>g;++g)J(m[g],34069+
g);sa(p,34067);O();xa.push(p);for(g=0;6>g;++g)da(m[g]);return h}var l=new na(34067);X[l.id]=l;var m=Array(6);h(a,b,c,d,f,g);h.subimage=function(a,b,c,d,e){c|=0;d|=0;e|=0;var f=W();R(f,l);f.width>>=e;f.height>>=e;f.width-=c;f.height-=d;P(f,b);V(l);ca(f,34069+a,c,d,e);O();S(f);return h};h._reglType="textureCube";h._texture=l;h.destroy=function(){l.decRef()};return h},clear:function(){for(var a=0;a<ia;++a)b.activeTexture(33984+a),b.bindTexture(3553,null),ea[a]=null;A(X).forEach(T)},getTexture:function(a){return null}}}},
{"./constants/arraytypes.json":4,"./util/extend":21,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/pool":25,"./util/to-half-float":27,"./util/values":28}],19:[function(h,n,q){n.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],20:[function(h,n,q){function f(a){return Array.prototype.slice.call(a)}function a(a){return f(a).join("")}var p=h("./extend");n.exports=function(){function h(){var c=[],l=[];return p(function(){c.push.apply(c,
f(arguments))},{def:function(){var a="v"+d++;l.push(a);0<arguments.length&&(c.push(a,"="),c.push.apply(c,f(arguments)),c.push(";"));return a},toString:function(){return a([0<l.length?"var "+l+";":"",a(c)])}})}function c(){function a(f,b){d(f,b,"=",c.def(f,b),";")}var c=h(),d=h(),f=c.toString,n=d.toString;return p(c,{entry:c,exit:d,save:a,set:function(d,b,f){a(d,b);c(d,b,"=",f,";")},toString:function(){return f()+n()}})}var d=0,n=[],v=[],q=h(),B={};return{global:q,link:function(a){for(var c=0;c<v.length;++c)if(v[c]===
a)return n[c];c="g"+d++;n.push(c);v.push(a);return c},block:h,proc:function(d,f){function h(){var a="a"+l.length;l.push(a);return a}var l=[];f=f||0;for(var n=0;n<f;++n)h();var n=c(),g=n.toString;return B[d]=p(n,{arg:h,toString:function(){return a(["function(",l.join(),"){",g(),"}"])}})},scope:c,cond:function(){var d=a(arguments),h=c(),l=c(),n=h.toString,r=l.toString;return p(h,{then:function(){h.apply(h,f(arguments));return this},"else":function(){l.apply(l,f(arguments));return this},toString:function(){var c=
r();c&&(c="else{"+c+"}");return a(["if(",d,"){",n(),"}",c])}})},compile:function(){var c=['"use strict";',q,"return {"];Object.keys(B).forEach(function(a){c.push('"',a,'":',B[a].toString(),",")});c.push("}");var d=a(c).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(d)).apply(null,v)}}}},{"./extend":21}],21:[function(h,n,q){n.exports=function(f,a){for(var h=Object.keys(a),l=0;l<h.length;++l)f[h[l]]=a[h[l]];return f}},{}],22:[function(h,n,q){var f=h("./is-typed-array");
n.exports=function(a){return!!a&&"object"===typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"===typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||f(a.data))}},{"./is-typed-array":23}],23:[function(h,n,q){var f=h("../constants/arraytypes.json");n.exports=function(a){return Object.prototype.toString.call(a)in f}},{"../constants/arraytypes.json":4}],24:[function(h,n,q){n.exports=function(f,a){for(var h=Array(f),l=0;l<f;++l)h[l]=a(l);return h}},{}],25:[function(h,
n,q){function f(a){var d,f;d=(65535<a)<<4;a>>>=d;f=(255<a)<<3;a>>>=f;d|=f;f=(15<a)<<2;a>>>=f;d|=f;f=(3<a)<<1;return d|f|a>>>f>>1}function a(a){a:{for(var d=16;268435456>=d;d*=16)if(a<=d){a=d;break a}a=0}d=l[f(a)>>2];return 0<d.length?d.pop():new ArrayBuffer(a)}function p(a){l[f(a.byteLength)>>2].push(a)}var l=h("./loop")(8,function(){return[]});n.exports={alloc:a,free:p,allocType:function(c,d){var f=null;switch(c){case 5120:f=new Int8Array(a(d),0,d);break;case 5121:f=new Uint8Array(a(d),0,d);break;
case 5122:f=new Int16Array(a(2*d),0,d);break;case 5123:f=new Uint16Array(a(2*d),0,d);break;case 5124:f=new Int32Array(a(4*d),0,d);break;case 5125:f=new Uint32Array(a(4*d),0,d);break;case 5126:f=new Float32Array(a(4*d),0,d);break;default:return null}return f.length!==d?f.subarray(0,d):f},freeType:function(a){p(a.buffer)}}},{"./loop":24}],26:[function(h,n,q){n.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(f){return requestAnimationFrame(f)},
cancel:function(f){return cancelAnimationFrame(f)}}:{next:function(f){setTimeout(f,30)},cancel:clearTimeout}},{}],27:[function(h,n,q){var f=h("./pool"),a=new Float32Array(1),p=new Uint32Array(a.buffer);n.exports=function(h){for(var c=f.allocType(5123,h.length),d=0;d<h.length;++d)if(isNaN(h[d]))c[d]=65535;else if(Infinity===h[d])c[d]=31744;else if(-Infinity===h[d])c[d]=64512;else{a[0]=h[d];var n=p[0],v=n>>>31<<15,q=(n<<1>>>24)-127,n=n>>13&1023;c[d]=-24>q?v:-14>q?v+(n+1024>>-14-q):15<q?v+31744:v+(q+
15<<10)+n}return c}},{"./pool":25}],28:[function(h,n,q){n.exports=function(f){return Object.keys(f).map(function(a){return f[a]})}},{}],29:[function(h,n,q){function f(f,c){function d(){var a=window.innerWidth,c=window.innerHeight;f!==document.body&&(c=f.getBoundingClientRect(),a=c.right-c.left,c=c.top-c.bottom);h.width=q*a;h.height=q*c;p(h.style,{width:a+"px",height:c+"px"})}var h=document.createElement("canvas"),n=a(h,c);p(h.style,{border:0,margin:0,padding:0,top:0,left:0});f.appendChild(h);f===
document.body&&(h.style.position="absolute",p(f.style,{margin:0,padding:0}));var q=+n.options.pixelRatio;window.addEventListener("resize",d,!1);var B=n.options.onDestroy;n.options=p(p({},n.options),{onDestroy:function(){window.removeEventListener("resize",d);f.removeChild(h);B&&B()}});d();return n}function a(a,c){function d(c){try{return a.getContext(c,f)}catch(d){return null}}var f=c.glOptions||{};return{gl:d("webgl")||d("experimental-webgl")||d("webgl-experimental"),options:p({pixelRatio:window.devicePixelRatio},
c)}}var p=h("./util/extend");n.exports=function(h){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:h[0],options:h[1]||{}};var c=document.body,d=h[1]||{};if("string"===typeof h[0])c=document.querySelector(h[0])||document.body;else if("object"===typeof h[0])if(h[0]instanceof HTMLElement)c=h[0];else{if(h[0]instanceof WebGLRenderingContext)return{gl:h[0],options:p({pixelRatio:1},d)};d=h[0]}return c.nodeName&&"CANVAS"===c.nodeName.toUpperCase()?a(c,d):f(c,d)}},{"./util/extend":21}],
30:[function(h,n,q){n.exports=function(a,h){function l(a){var c=!1;"altKey"in a&&(c=c||a.altKey!==b.alt,b.alt=!!a.altKey);"shiftKey"in a&&(c=c||a.shiftKey!==b.shift,b.shift=!!a.shiftKey);"ctrlKey"in a&&(c=c||a.ctrlKey!==b.control,b.control=!!a.ctrlKey);"metaKey"in a&&(c=c||a.metaKey!==b.meta,b.meta=!!a.metaKey);return c}function c(a,c){var d=f.x(c),n=f.y(c);"buttons"in c&&(a=c.buttons|0);if(a!==y||d!==r||n!==g||l(c))y=a|0,r=d||0,g=n||0,h&&h(y,r,g,b)}function d(a){c(0,a)}function n(){if(y||r||g||b.shift||
b.alt||b.meta||b.control)y=r=g=0,b.shift=b.alt=b.control=b.meta=!1,h&&h(0,0,0,b)}function q(a){l(a)&&h&&h(y,r,g,b)}function M(a){0===f.buttons(a)?c(0,a):c(y,a)}function B(a){c(y|f.buttons(a),a)}function F(a){c(y&~f.buttons(a),a)}function u(){L||(L=!0,a.addEventListener("mousemove",M),a.addEventListener("mousedown",B),a.addEventListener("mouseup",F),a.addEventListener("mouseleave",d),a.addEventListener("mouseenter",d),a.addEventListener("mouseout",d),a.addEventListener("mouseover",d),a.addEventListener("blur",
n),a.addEventListener("keyup",q),a.addEventListener("keydown",q),a.addEventListener("keypress",q),a!==window&&(window.addEventListener("blur",n),window.addEventListener("keyup",q),window.addEventListener("keydown",q),window.addEventListener("keypress",q)))}function D(){L&&(L=!1,a.removeEventListener("mousemove",M),a.removeEventListener("mousedown",B),a.removeEventListener("mouseup",F),a.removeEventListener("mouseleave",d),a.removeEventListener("mouseenter",d),a.removeEventListener("mouseout",d),a.removeEventListener("mouseover",
d),a.removeEventListener("blur",n),a.removeEventListener("keyup",q),a.removeEventListener("keydown",q),a.removeEventListener("keypress",q),a!==window&&(window.removeEventListener("blur",n),window.removeEventListener("keyup",q),window.removeEventListener("keydown",q),window.removeEventListener("keypress",q)))}h||(h=a,a=window);var y=0,r=0,g=0,b={shift:!1,alt:!1,control:!1,meta:!1},L=!1;u();var C={element:a};Object.defineProperties(C,{enabled:{get:function(){return L},set:function(a){a?u():D},enumerable:!0},
buttons:{get:function(){return y},enumerable:!0},x:{get:function(){return r},enumerable:!0},y:{get:function(){return g},enumerable:!0},mods:{get:function(){return b},enumerable:!0}});return C};var f=h("mouse-event")},{"mouse-event":31}],31:[function(h,n,q){function f(a){return a.target||a.srcElement||window}q.buttons=function(a){if("object"===typeof a){if("buttons"in a)return a.buttons;if("which"in a){a=a.which;if(2===a)return 4;if(3===a)return 2;if(0<a)return 1<<a-1}else if("button"in a){a=a.button;
if(1===a)return 4;if(2===a)return 2;if(0<=a)return 1<<a}}return 0};q.element=f;q.x=function(a){if("object"===typeof a){if("offsetX"in a)return a.offsetX;var h=f(a).getBoundingClientRect();return a.clientX-h.left}return 0};q.y=function(a){if("object"===typeof a){if("offsetY"in a)return a.offsetY;var h=f(a).getBoundingClientRect();return a.clientY-h.top}return 0}},{}],32:[function(h,n,q){var f=h("./lib/util/extend"),a=h("./lib/dynamic"),p=h("./lib/util/raf"),l=h("./lib/util/clock"),c=h("./lib/strings"),
d=h("./lib/webgl"),A=h("./lib/extension"),v=h("./lib/limits"),M=h("./lib/buffer"),B=h("./lib/elements"),F=h("./lib/texture"),u=h("./lib/renderbuffer"),D=h("./lib/framebuffer"),y=h("./lib/attribute"),r=h("./lib/shader"),g=h("./lib/read"),b=h("./lib/core");n.exports=function(){function h(){T=p.next(h);K.count+=1;var a=l();K.deltaTime=(a-W)/1E3;K.time=(a-ca)/1E3;W=a;R();for(a=0;a<O.length;++a)(0,O[a])(K,null,0)}function n(a){}function q(a){}function N(b){function c(b){var d={},f={};Object.keys(b).forEach(function(c){var g=
b[c];a.isDynamic(g)?f[c]=a.unbox(g,c):d[c]=g});return{dynamic:f,"static":d}}function d(a){for(;r.length<a;)r.push(null);return r}var g=c(b.context||{}),h=c(b.uniforms||{}),l=c(b.attributes||{});b=c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=f({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(b));var g=Q.compile(b,
l,h,g),n=g.draw,p=g.batch,q=g.scope,r=[];return function(a,b){var c;if("function"===typeof a)return q.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(c=0;c<a;++c)q.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)q.call(this,a[c],b,c);else return q.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return n.call(this,a)}}function U(){Q.procs.poll()}
function R(){var a=na.viewport,b=na.scissor_box;a[0]=a[1]=b[0]=b[1]=0;K.viewportWidth=K.frameBufferWidth=K.drawingBufferWidth=a[2]=b[2]=z.drawingBufferWidth;K.viewportHeight=K.frameBufferWidth=K.drawingBufferHeight=a[3]=b[3]=z.drawingBufferHeight;Q.procs.refresh()}var G=d(Array.prototype.slice.call(arguments)),z=G.gl,fa=G.options,G=c(),P=A(z).extensions,ca=l(),W=ca,S=z.drawingBufferWidth,ga=z.drawingBufferHeight,K={count:0,deltaTime:0,time:0,viewportWidth:S,viewportHeight:ga,framebufferWidth:S,framebufferHeight:ga,
drawingBufferWidth:S,drawingBufferHeight:ga,pixelRatio:fa.pixelRatio},I=v(z,P),J=M(z),S=B(z,P,J),ga=y(z,P,I,J,G),ha=r(z,G),da=F(z,P,I,U,K),la=u(z,P,I),ma=D(z,P,I,da,la),sa=g(z,U,K),Q=b(z,G,P,I,J,S,da,ma,{},ga,ha,{elements:null,primitive:4,count:-1,offset:0,instances:-1},K),na=Q.next,V=z.canvas,O=[],T=0;V&&(V.addEventListener("webglcontextlost",n,!1),V.addEventListener("webglcontextrestored",q,!1));R();return f(N,{clear:function(a){var b=0;U();var c=a.color;c&&(z.clearColor(+c[0]||0,+c[1]||0,+c[2]||
0,+c[3]||0),b|=16384);"depth"in a&&(z.clearDepth(+a.depth),b|=256);"stencil"in a&&(z.clearStencil(a.stencil|0),b|=1024);z.clear(b)},prop:a.define.bind(null,1),context:a.define.bind(null,2),"this":a.define.bind(null,3),draw:N({}),buffer:function(a){return J.create(a,34962)},elements:S.create,texture:da.create2D,cube:da.createCube,renderbuffer:la.create,framebuffer:ma.create,framebufferCube:function(a){},attributes:z.getContextAttributes(),frame:function(a){O.push(a);!T&&0<O.length&&h();return{cancel:function(){var b=
O.find(function(b){return b===a});0>b||(O.splice(b,1),0>=O.length&&T&&(p.cancel(h),T=0))}}},limits:I,hasExtension:function(a){return 0<=I.extensions.indexOf(a.toLowerCase())},read:sa,destroy:function(){T&&(p.cancel(h),T=0);V&&(V.removeEventListener("webglcontextlost",n),V.removeEventListener("webglcontextrestored",q));ha.clear();ma.clear();la.clear();da.clear();J.clear();if(fa.onDestroy)fa.onDestroy()},_gl:z,_refresh:R})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,
"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/strings":17,"./lib/texture":18,"./lib/util/clock":19,"./lib/util/extend":21,"./lib/util/raf":26,"./lib/webgl":29}]},{},[1]);
