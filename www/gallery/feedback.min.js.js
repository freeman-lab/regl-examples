(function e$$0(m,x,l){function a(e,g){if(!x[e]){if(!m[e]){var c="function"==typeof require&&require;if(!g&&c)return c(e,!0);if(u)return u(e,!0);c=Error("Cannot find module '"+e+"'");throw c.code="MODULE_NOT_FOUND",c;}c=x[e]={exports:{}};m[e][0].call(c.exports,function(g){var c=m[e][1][g];return a(c?c:g)},c,c.exports,e$$0,m,x,l)}return x[e].exports}for(var u="function"==typeof require&&require,y=0;y<l.length;y++)a(l[y]);return a})({1:[function(k,m,x){var l=k("../regl")(),a=k("mouse-change")(),u=l.texture(),
y=l({frag:"\n  precision mediump float;\n  uniform sampler2D texture;\n  uniform vec2 mouse;\n  uniform float t;\n  varying vec2 uv;\n  void main () {\n    float dist = length(gl_FragCoord.xy - mouse);\n    gl_FragColor = vec4(0.98 * texture2D(texture,\n      uv + cos(t) * vec2(0.5 - uv.y, uv.x - 0.5) - sin(2.0 * t) * (uv - 0.5)).rgb, 1) +\n      exp(-0.01 * dist) * vec4(\n        1.0 + cos(2.0 * t),\n        1.0 + cos(2.0 * t + 1.5),\n        1.0 + cos(2.0 * t + 3.0),\n        0.0);\n  }",vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main () {\n    uv = position;\n    gl_Position = vec4(2.0 * position - 1.0, 0, 1);\n  }",
attributes:{position:[-2,0,0,-2,2,2]},uniforms:{texture:u,mouse:function(e){var g=e.pixelRatio;return[a.x*g,e.viewportHeight-a.y*g]},t:function(a){return.01*a.tick}},count:3});l.frame(function(){l.clear({color:[0,0,0,1]});y();u({copy:!0})})},{"../regl":35,"mouse-change":33}],2:[function(k,m,x){function l(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}m.exports=function(a,u,y,e,g){a=y.maxAttributes;u=
Array(a);for(y=0;y<a;++y)u[y]=new l;return{Record:l,scope:{},state:u}}},{}],3:[function(k,m,x){function l(a){return D[Object.prototype.toString.call(a)]|0}function a(a,e){for(var g=0;g<e.length;++g)a[g]=e[g]}function u(a,e,g,c,h,l,u){for(var q=0,b=0;b<g;++b)for(var f=0;f<c;++f)a[q++]=e[h*b+l*f+u]}function y(a,e,g){for(var c=0,h=0;h<e.length;++h)for(var l=e[h],u=0;u<g;++u)a[c++]=l[u]}var e=k("./util/is-typed-array"),g=k("./util/is-ndarray"),c=k("./util/values"),t=k("./util/pool"),D=k("./constants/arraytypes.json"),
G=k("./constants/dtypes.json"),C=k("./constants/usage.json"),f=[];f[5120]=1;f[5122]=2;f[5124]=4;f[5121]=1;f[5123]=2;f[5125]=4;f[5126]=4;m.exports=function(k,w,H){function n(a){this.id=q++;this.buffer=k.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;H.profile&&(this.stats={size:0})}function h(a,e,g){a.byteLength=e.byteLength;k.bufferData(a.type,e,g)}function J(b,c,n,f,q,k){b.usage=n;if(Array.isArray(c))b.dtype=f||5126,0<c.length&&
(Array.isArray(c[0])?(b.dimension=c[0].length,f=t.allocType(b.dtype,c.length*b.dimension),y(f,c,b.dimension),h(b,f,n),k?b.persistentData=f:t.freeType(f)):"number"===typeof c[0]?(b.dimension=q,f=t.allocType(b.dtype,c.length),a(f,c),h(b,f,n),k?b.persistentData=f:t.freeType(f)):e(c[0])&&(b.dimension=c[0].length,b.dtype=f||l(c[0])||5126,f=t.allocType(b.dtype,c.length*b.dimension),y(f,c,b.dimension),h(b,f,n),k?b.persistentData=f:t.freeType(f)));else if(e(c))b.dtype=f||l(c),b.dimension=q,h(b,c,n),k&&(b.persistentData=
new Uint8Array(new Uint8Array(c.buffer)));else if(g(c)){var V=c.shape,L=c.stride;q=c.offset;var w=0,I=0,p=0,R=0;1===V.length?(w=V[0],I=1,p=L[0],R=0):2===V.length&&(w=V[0],I=V[1],p=L[0],R=L[1]);b.dtype=f||l(c.data)||5126;b.dimension=I;f=t.allocType(b.dtype,w*I);u(f,c.data,w,I,p,R,q);h(b,f,n);k?b.persistentData=f:t.freeType(f)}}function F(a){w.bufferCount--;k.deleteBuffer(a.buffer);a.buffer=null;delete b[a.id]}var q=0,b={};n.prototype.bind=function(){k.bindBuffer(this.type,this.buffer)};n.prototype.destroy=
function(){F(this)};var V=[];H.profile&&(w.getTotalBufferSize=function(){var a=0;Object.keys(b).forEach(function(e){a+=b[e].stats.size});return a});return{create:function(c,h,q,V){function m(a){var b=35044,c=null,h=0,p=0,l=1;Array.isArray(a)||e(a)||g(a)?c=a:"number"===typeof a?h=a|0:a&&("data"in a&&(c=a.data),"usage"in a&&(b=C[a.usage]),"type"in a&&(p=G[a.type]),"dimension"in a&&(l=a.dimension|0),"length"in a&&(h=a.length|0));D.bind();c?J(D,c,b,p,l,V):(k.bufferData(D.type,h,b),D.dtype=p||5121,D.usage=
b,D.dimension=l,D.byteLength=h);H.profile&&(D.stats.size=D.byteLength*f[D.dtype]);return m}w.bufferCount++;var D=new n(h);b[D.id]=D;q||m(c);m._reglType="buffer";m._buffer=D;m.subdata=function(b,c){var h=(c||0)|0;D.bind();if(Array.isArray(b)){if(0<b.length)if("number"===typeof b[0]){var f=t.allocType(D.dtype,b.length);a(f,b);k.bufferSubData(D.type,h,f);t.freeType(f)}else if(Array.isArray(b[0])||e(b[0])){var f=b[0].length,p=t.allocType(D.dtype,b.length*f);y(p,b,f);k.bufferSubData(D.type,h,p);t.freeType(p)}}else if(e(b))k.bufferSubData(D.type,
h,b);else if(g(b)){var n=b.shape,q=b.stride,V=p=f=0,w=0;1===n.length?(f=n[0],p=1,V=q[0],w=0):2===n.length&&(f=n[0],p=n[1],V=q[0],w=q[1]);n=Array.isArray(b.data)?D.dtype:l(b.data);n=t.allocType(n,f*p);u(n,b.data,f,p,V,w,b.offset);k.bufferSubData(D.type,h,n);t.freeType(n)}return m};H.profile&&(m.stats=D.stats);m.destroy=function(){F(D)};return m},createStream:function(a,b){var e=V.pop();e||(e=new n(a));e.bind();J(e,b,35040,0,1,!1);return e},destroyStream:function(a){V.push(a)},clear:function(){c(b).forEach(F);
V.forEach(F)},getBuffer:function(a){return a&&a._buffer instanceof n?a._buffer:null},restore:function(){c(b).forEach(function(a){a.buffer=k.createBuffer();k.bindBuffer(a.type,a.buffer);k.bufferData(a.type,a.persistentData||a.byteLength,a.usage)})},_initBuffer:J}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],4:[function(k,m,x){m.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,
"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(k,m,x){m.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(k,m,x){m.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},
{}],7:[function(k,m,x){m.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(k,m,x){function l(a){return Array.isArray(a)||D(a)||G(a)}function a(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function u(a,b,e,c){this.thisDep=a;this.contextDep=b;this.propDep=e;this.append=c}function y(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function e(a){return new u(!1,!1,!1,a)}function g(a,b){var e=a.type;return 0===e?(e=a.data.length,new u(!0,1<=e,
2<=e,b)):4===e?(e=a.data,new u(e.thisDep,e.contextDep,e.propDep,b)):new u(3===e,2===e,1===e,b)}var c=k("./util/codegen"),t=k("./util/loop"),D=k("./util/is-typed-array"),G=k("./util/is-ndarray"),C=k("./util/is-array-like"),f=k("./dynamic"),I=k("./constants/primitives.json"),w=k("./constants/dtypes.json"),H=["x","y","z","w"],n="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),h={0:0,1:1,zero:0,one:1,"src color":768,
"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},J={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},F={0:0,zero:0,keep:7680,replace:7681,increment:7682,
decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},q={cw:2304,ccw:2305},b=new u(!1,!1,!1,function(){});m.exports=function(k,m,D,G,x,U,ma,O,L,na,sa,p,R,aa,ha){function W(a){return a.replace(".","_")}function N(a,d,b){var e=W(a);Ha.push(a);Ba[e]=ta[e]=!!b;ua[e]=d}function E(a,d,b){var e=W(a);Ha.push(a);Array.isArray(b)?(ta[e]=b.slice(),Ba[e]=b.slice()):ta[e]=Ba[e]=b;va[e]=d}function wa(){var a=c(),d=a.link,b=a.global;a.id=Na++;a.batchId="0";var e=d(Ma),g=a.shared={props:"a0"};
Object.keys(Ma).forEach(function(a){g[a]=b.def(e,".",a)});var h=a.next={},S=a.current={};Object.keys(va).forEach(function(a){Array.isArray(ta[a])&&(h[a]=b.def(g.next,".",a),S[a]=b.def(g.current,".",a))});var Oa=a.constants={};Object.keys(Ia).forEach(function(a){Oa[a]=b.def(JSON.stringify(Ia[a]))});a.invoke=function(z,K){switch(K.type){case 0:var b=["this",g.context,g.props,a.batchId];return z.def(d(K.data),".call(",b.slice(0,Math.max(K.data.length+1,4)),")");case 1:return z.def(g.props,K.data);case 2:return z.def(g.context,
K.data);case 3:return z.def("this",K.data);case 4:return K.data.append(a,z),K.data.ref}};a.attribCache={};var z={};a.scopeAttrib=function(a){a=m.id(a);if(a in z)return z[a];var B=na.scope[a];B||(B=na.scope[a]=new v);return z[a]=d(B)};return a}function oa(a){var d=a["static"];a=a.dynamic;var b;if("profile"in d){var c=!!d.profile;b=e(function(a,d){return c});b.enable=c}else if("profile"in a){var h=a.profile;b=g(h,function(a,d){return a.invoke(d,h)})}return b}function xa(a,d){var b=a["static"],c=a.dynamic;
if("framebuffer"in b){var h=b.framebuffer;return h?(h=O.getFramebuffer(h),e(function(a,d){var z=a.link(h),b=a.shared;d.set(b.framebuffer,".next",z);b=b.context;d.set(b,".framebufferWidth",z+".width");d.set(b,".framebufferHeight",z+".height");return z})):e(function(a,d){var z=a.shared;d.set(z.framebuffer,".next","null");z=z.context;d.set(z,".framebufferWidth",z+".drawingBufferWidth");d.set(z,".framebufferHeight",z+".drawingBufferHeight");return"null"})}if("framebuffer"in c){var f=c.framebuffer;return g(f,
function(a,d){var z=a.invoke(d,f),b=a.shared,K=b.framebuffer,z=d.def(K,".getFramebuffer(",z,")");d.set(K,".next",z);b=b.context;d.set(b,".framebufferWidth",z+"?"+z+".width:"+b+".drawingBufferWidth");d.set(b,".framebufferHeight",z+"?"+z+".height:"+b+".drawingBufferHeight");return z})}return null}function Q(a,d,b){function e(a){if(a in c){var z=c[a];a=!0;var b=z.x|0,K=z.y|0,B,f;"width"in z?B=z.width|0:a=!1;"height"in z?f=z.height|0:a=!1;return new u(!a&&d&&d.thisDep,!a&&d&&d.contextDep,!a&&d&&d.propDep,
function(a,d){var e=a.shared.context,A=B;"width"in z||(A=d.def(e,".","framebufferWidth","-",b));var c=f;"height"in z||(c=d.def(e,".","framebufferHeight","-",K));return[b,K,A,c]})}if(a in h){var S=h[a];a=g(S,function(a,d){var z=a.invoke(d,S),b=a.shared.context,K=d.def(z,".x|0"),B=d.def(z,".y|0"),e=d.def('"width" in ',z,"?",z,".width|0:","(",b,".","framebufferWidth","-",K,")"),z=d.def('"height" in ',z,"?",z,".height|0:","(",b,".","framebufferHeight","-",B,")");return[K,B,e,z]});d&&(a.thisDep=a.thisDep||
d.thisDep,a.contextDep=a.contextDep||d.contextDep,a.propDep=a.propDep||d.propDep);return a}return d?new u(d.thisDep,d.contextDep,d.propDep,function(a,d){var z=a.shared.context;return[0,0,d.def(z,".","framebufferWidth"),d.def(z,".","framebufferHeight")]}):null}var c=a["static"],h=a.dynamic;if(a=e("viewport")){var f=a;a=new u(a.thisDep,a.contextDep,a.propDep,function(a,d){var b=f.append(a,d),K=a.shared.context;d.set(K,".viewportWidth",b[2]);d.set(K,".viewportHeight",b[3]);return b})}return{viewport:a,
scissor_box:e("scissor.box")}}function ca(a){function d(a){if(a in b){var z=m.id(b[a]);a=e(function(){return z});a.id=z;return a}if(a in c){var B=c[a];return g(B,function(a,d){var z=a.invoke(d,B);return d.def(a.shared.strings,".id(",z,")")})}return null}var b=a["static"],c=a.dynamic,h=d("frag"),f=d("vert"),S=null;y(h)&&y(f)?(S=sa.program(f.id,h.id),a=e(function(a,d){return a.link(S)})):a=new u(h&&h.thisDep||f&&f.thisDep,h&&h.contextDep||f&&f.contextDep,h&&h.propDep||f&&f.propDep,function(a,d){var b=
a.shared.shader,K;K=h?h.append(a,d):d.def(b,".","frag");var B;B=f?f.append(a,d):d.def(b,".","vert");return d.def(b+".program("+B+","+K+")")});return{frag:h,vert:f,progVar:a,program:S}}function da(a,d){function b(a,d){if(a in c){var B=c[a]|0;return e(function(a,b){d&&(a.OFFSET=B);return B})}if(a in h){var K=h[a];return g(K,function(a,b){var B=a.invoke(b,K);d&&(a.OFFSET=B);return B})}return d&&f?e(function(a,d){a.OFFSET="0";return 0}):null}var c=a["static"],h=a.dynamic,f=function(){if("elements"in c){var a=
c.elements;l(a)?a=U.getElements(U.create(a,!0)):a&&(a=U.getElements(a));var d=e(function(d,b){if(a){var z=d.link(a);return d.ELEMENTS=z}return d.ELEMENTS=null});d.value=a;return d}if("elements"in h){var b=h.elements;return g(b,function(a,d){var z=a.shared,B=z.isBufferArgs,z=z.elements,e=a.invoke(d,b),A=d.def("null"),B=d.def(B,"(",e,")"),e=a.cond(B).then(A,"=",z,".createStream(",e,");")["else"](A,"=",z,".getElements(",e,");");d.entry(e);d.exit(a.cond(B).then(z,".destroyStream(",A,");"));return a.ELEMENTS=
A})}return null}(),S=b("offset",!0);return{elements:f,primitive:function(){if("primitive"in c){var a=c.primitive;return e(function(d,b){return I[a]})}if("primitive"in h){var d=h.primitive;return g(d,function(a,b){var B=a.constants.primTypes,e=a.invoke(b,d);return b.def(B,"[",e,"]")})}return f?y(f)?f.value?e(function(a,d){return d.def(a.ELEMENTS,".primType")}):e(function(){return 4}):new u(f.thisDep,f.contextDep,f.propDep,function(a,d){var b=a.ELEMENTS;return d.def(b,"?",b,".primType:",4)}):null}(),
count:function(){if("count"in c){var a=c.count|0;return e(function(){return a})}if("count"in h){var d=h.count;return g(d,function(a,b){return a.invoke(b,d)})}return f?y(f)?f?S?new u(S.thisDep,S.contextDep,S.propDep,function(a,d){return d.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):e(function(a,d){return d.def(a.ELEMENTS,".vertCount")}):e(function(){return-1}):new u(f.thisDep||S.thisDep,f.contextDep||S.contextDep,f.propDep||S.propDep,function(a,d){var b=a.ELEMENTS;return a.OFFSET?d.def(b,"?",b,".vertCount-",
a.OFFSET,":-1"):d.def(b,"?",b,".vertCount:-1")}):null}(),instances:b("instances",!1),offset:S}}function qa(a,d){var b=a["static"],c=a.dynamic,f={};Ha.forEach(function(a){function d(z,A){if(a in b){var K=z(b[a]);f[B]=e(function(){return K})}else if(a in c){var h=c[a];f[B]=g(h,function(a,d){return A(a,d,a.invoke(d,h))})}}var B=W(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return d(function(a){return a},
function(a,d,b){return b});case "depth.func":return d(function(a){return J[a]},function(a,d,b){return d.def(a.constants.compareFuncs,"[",b,"]")});case "depth.range":return d(function(a){return a},function(a,d,b){a=d.def("+",b,"[0]");d=d.def("+",b,"[1]");return[a,d]});case "blend.func":return d(function(a){return[h["srcRGB"in a?a.srcRGB:a.src],h["dstRGB"in a?a.dstRGB:a.dst],h["srcAlpha"in a?a.srcAlpha:a.src],h["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,d,b){function B(a,z){return d.def('"',a,z,
'" in ',b,"?",b,".",a,z,":",b,".",a)}a=a.constants.blendFuncs;var e=B("src","RGB"),A=B("dst","RGB"),e=d.def(a,"[",e,"]"),c=d.def(a,"[",B("src","Alpha"),"]"),A=d.def(a,"[",A,"]");a=d.def(a,"[",B("dst","Alpha"),"]");return[e,A,c,a]});case "blend.equation":return d(function(a){if("string"===typeof a)return[ia[a],ia[a]];if("object"===typeof a)return[ia[a.rgb],ia[a.alpha]]},function(a,d,b){var B=a.constants.blendEquations,e=d.def(),A=d.def();a=a.cond("typeof ",b,'==="string"');a.then(e,"=",A,"=",B,"[",
b,"];");a["else"](e,"=",B,"[",b,".rgb];",A,"=",B,"[",b,".alpha];");d(a);return[e,A]});case "blend.color":return d(function(a){return t(4,function(d){return+a[d]})},function(a,d,b){return t(4,function(a){return d.def("+",b,"[",a,"]")})});case "stencil.mask":return d(function(a){return a|0},function(a,d,b){return d.def(b,"|0")});case "stencil.func":return d(function(a){return[J[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,d,b){a=d.def('"cmp" in ',b,"?",a.constants.compareFuncs,"[",b,".cmp]",
":",7680);var B=d.def(b,".ref|0");d=d.def('"mask" in ',b,"?",b,".mask|0:-1");return[a,B,d]});case "stencil.opFront":case "stencil.opBack":return d(function(d){return["stencil.opBack"===a?1029:1028,F[d.fail||"keep"],F[d.zfail||"keep"],F[d.zpass||"keep"]]},function(d,b,B){function e(a){return b.def('"',a,'" in ',B,"?",A,"[",B,".",a,"]:",7680)}var A=d.constants.stencilOps;return["stencil.opBack"===a?1029:1028,e("fail"),e("zfail"),e("zpass")]});case "polygonOffset.offset":return d(function(a){return[a.factor|
0,a.units|0]},function(a,d,b){a=d.def(b,".factor|0");d=d.def(b,".units|0");return[a,d]});case "cull.face":return d(function(a){var d=0;"front"===a?d=1028:"back"===a&&(d=1029);return d},function(a,d,b){return d.def(b,'==="front"?',1028,":",1029)});case "lineWidth":return d(function(a){return a},function(a,d,b){return b});case "frontFace":return d(function(a){return q[a]},function(a,d,b){return d.def(b+'==="cw"?2304:2305')});case "colorMask":return d(function(a){return a.map(function(a){return!!a})},
function(a,d,b){return t(4,function(a){return"!!"+b+"["+a+"]"})});case "sample.coverage":return d(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,d,b){a=d.def('"value" in ',b,"?+",b,".value:1");d=d.def("!!",b,".invert");return[a,d]})}});return f}function ea(a,d){var b=a["static"],c=a.dynamic,f={};Object.keys(b).forEach(function(a){var d=b[a],B;if("number"===typeof d||"boolean"===typeof d)B=e(function(){return d});else if("function"===typeof d){var A=d._reglType;if("texture2d"===A||
"textureCube"===A)B=e(function(a){return a.link(d)});else if("framebuffer"===A||"framebufferCube"===A)B=e(function(a){return a.link(d.color[0])})}else C(d)&&(B=e(function(a){return a.global.def("[",t(d.length,function(a){return d[a]}),"]")}));B.value=d;f[a]=B});Object.keys(c).forEach(function(a){var d=c[a];f[a]=g(d,function(a,b){return a.invoke(b,d)})});return f}function X(a,d){var b=a["static"],c=a.dynamic,f={};Object.keys(b).forEach(function(a){var d=b[a],B=m.id(a),A=new v;if(l(d))A.state=1,A.buffer=
x.getBuffer(x.create(d,34962,!1,!0)),A.type=A.buffer.dtype;else{var c=x.getBuffer(d);if(c)A.state=1,A.buffer=c,A.type=c.dtype;else if(d.constant){var h=d.constant;A.buffer="null";A.state=2;"number"===typeof h?A.x=h:H.forEach(function(a,d){d<h.length&&(A[a]=h[d])})}else{var c=l(d.buffer)?x.getBuffer(x.create(d.buffer,34962,!1,!0)):x.getBuffer(d.buffer),g=d.offset|0,r=d.stride|0,n=d.size|0,p=!!d.normalized,k=0;"type"in d&&(k=w[d.type]);d=d.divisor|0;A.buffer=c;A.state=1;A.size=n;A.normalized=p;A.type=
k||c.dtype;A.offset=g;A.stride=r;A.divisor=d}}f[a]=e(function(a,d){var b=a.attribCache;if(B in b)return b[B];var e={isStream:!1};Object.keys(A).forEach(function(a){e[a]=A[a]});A.buffer&&(e.buffer=a.link(A.buffer));return b[B]=e})});Object.keys(c).forEach(function(a){var d=c[a];f[a]=g(d,function(a,b){function B(a){b(h[a],"=",A,".",a,"|0;")}var A=a.invoke(b,d),e=a.shared,c=e.isBufferArgs,f=e.buffer,h={isStream:b.def(!1)},g=new v;g.state=1;Object.keys(g).forEach(function(a){h[a]=b.def(""+g[a])});var r=
h.buffer,n=h.type;b("if(",c,"(",A,")){",h.isStream,"=true;",r,"=",f,".createStream(",34962,",",A,");",n,"=",r,".dtype;","}else{",r,"=",f,".getBuffer(",A,");","if(",r,"){",n,"=",r,".dtype;",'}else if("constant" in ',A,"){",h.state,"=",2,";","if(typeof "+A+'.constant === "number"){',h[H[0]],"=",A,".constant;",H.slice(1).map(function(a){return h[a]}).join("="),"=0;","}else{",H.map(function(a,d){return h[a]+"="+A+".constant.length>="+d+"?"+A+".constant["+d+"]:0;"}).join(""),"}}else{","if(",c,"(",A,".buffer)){",
r,"=",f,".createStream(",34962,",",A,".buffer);","}else{",r,"=",f,".getBuffer(",A,".buffer);","}",n,'="type" in ',A,"?",e.glTypes,"[",A,".type]:",r,".dtype;",h.normalized,"=!!",A,".normalized;");B("size");B("offset");B("stride");B("divisor");b("}}");b.exit("if(",h.isStream,"){",f,".destroyStream(",r,");","}");return h})});return f}function ra(a){var d=a["static"],b=a.dynamic,c={};Object.keys(d).forEach(function(a){var b=d[a];c[a]=e(function(a,d){return"number"===typeof b||"boolean"===typeof b?""+
b:a.link(b)})});Object.keys(b).forEach(function(a){var d=b[a];c[a]=g(d,function(a,b){return a.invoke(b,d)})});return c}function pa(a,d,b,e,c){var h=xa(a,c),f=Q(a,h,c),g=da(a,c),r=qa(a,c),n=ca(a,c),v=f.viewport;v&&(r.viewport=v);v=W("scissor.box");(f=f[v])&&(r[v]=f);f=0<Object.keys(r).length;h={framebuffer:h,draw:g,shader:n,state:r,dirty:f};h.profile=oa(a,c);h.uniforms=ea(b,c);h.attributes=X(d,c);h.context=ra(e,c);return h}function M(a,d,b){var e=a.shared.context,c=a.scope();Object.keys(b).forEach(function(h){d.save(e,
"."+h);c(e,".",h,"=",b[h].append(a,d),";")});d(c)}function fa(a,d,b,e){var c=a.shared,h=c.gl,f=c.framebuffer,g;Ja&&(g=d.def(c.extensions,".webgl_draw_buffers"));var r=a.constants,c=r.drawBuffer,r=r.backBuffer;a=b?b.append(a,d):d.def(f,".next");e||d("if(",a,"!==",f,".cur){");d("if(",a,"){",h,".bindFramebuffer(",36160,",",a,".framebuffer);");Ja&&d(g,".drawBuffersWEBGL(",c,"[",a,".colorAttachments.length]);");d("}else{",h,".bindFramebuffer(",36160,",null);");Ja&&d(g,".drawBuffersWEBGL(",r,");");d("}",
f,".cur=",a,";");e||d("}")}function ja(a,d,b){var e=a.shared,c=e.gl,h=a.current,f=a.next,g=e.current,r=e.next,v=a.cond(g,".dirty");Ha.forEach(function(d){d=W(d);if(!(d in b.state)){var e,A;if(d in f){e=f[d];A=h[d];var n=t(ta[d].length,function(a){return v.def(e,"[",a,"]")});v(a.cond(n.map(function(a,d){return a+"!=="+A+"["+d+"]"}).join("||")).then(c,".",va[d],"(",n,");",n.map(function(a,d){return A+"["+d+"]="+a}).join(";"),";"))}else e=v.def(r,".",d),n=a.cond(e,"!==",g,".",d),v(n),d in ua?n(a.cond(e).then(c,
".enable(",ua[d],");")["else"](c,".disable(",ua[d],");"),g,".",d,"=",e,";"):n(c,".",va[d],"(",e,");",g,".",d,"=",e,";")}});0===Object.keys(b.state).length&&v(g,".dirty=false;");d(v)}function P(d,b,e,c){var h=d.shared,f=d.current,g=h.current,r=h.gl;a(Object.keys(e)).forEach(function(a){var h=e[a];if(!c||c(h)){var v=h.append(d,b);if(ua[a]){var n=ua[a];y(h)?v?b(r,".enable(",n,");"):b(r,".disable(",n,");"):b(d.cond(v).then(r,".enable(",n,");")["else"](r,".disable(",n,");"));b(g,".",a,"=",v,";")}else if(C(v)){var p=
f[a];b(r,".",va[a],"(",v,");",v.map(function(a,d){return p+"["+d+"]="+a}).join(";"),";")}else b(r,".",va[a],"(",v,");",g,".",a,"=",v,";")}})}function T(a,d){Ca&&(a.instancing=d.def(a.shared.extensions,".angle_instanced_arrays"))}function Y(a,d,b,e,c){function h(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function f(a){k=d.def();a(k,"=",h(),";");"string"===typeof c?a(n,".count+=",c,";"):a(n,".count++;");aa&&(e?(q=d.def(),a(q,"=",l,".getNumPendingQueries();")):a(l,".beginQuery(",
n,");"))}function g(a){a(n,".cpuTime+=",h(),"-",k,";");aa&&(e?a(l,".pushScopeStats(",q,",",l,".getNumPendingQueries(),",n,");"):a(l,".endQuery();"))}function r(a){var b=d.def(p,".profile");d(p,".profile=",a,";");d.exit(p,".profile=",b,";")}var v=a.shared,n=a.stats,p=v.current,l=v.timer;b=b.profile;var k,q;if(b){if(y(b)){b.enable?(f(d),g(d.exit),r("true")):r("false");return}b=b.append(a,d);r(b)}else b=d.def(p,".profile");v=a.block();f(v);d("if(",b,"){",v,"}");a=a.block();g(a);d.exit("if(",b,"){",a,
"}")}function Z(a,d,e,c,h){function f(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function g(b,e,c){function h(){d("if(!",p,".buffer){",v,".enableVertexAttribArray(",n,");}");var b=c.type,f;f=c.size?d.def(c.size,"||",e):e;d("if(",p,".type!==",b,"||",p,".size!==",f,"||",q.map(function(a){return p+"."+a+"!=="+c[a]}).join("||"),"){",v,".bindBuffer(",34962,",",l,".buffer);",v,".vertexAttribPointer(",
[n,f,b,c.normalized,c.stride,c.offset],");",p,".type=",b,";",p,".size=",f,";",q.map(function(a){return p+"."+a+"="+c[a]+";"}).join(""),"}");Ca&&(b=c.divisor,d("if(",p,".divisor!==",b,"){",a.instancing,".vertexAttribDivisorANGLE(",[n,b],");",p,".divisor=",b,";}"))}function f(){d("if(",p,".buffer){",v,".disableVertexAttribArray(",n,");","}if(",H.map(function(a,d){return p+"."+a+"!=="+k[d]}).join("||"),"){",v,".vertexAttrib4f(",n,",",k,");",H.map(function(a,d){return p+"."+a+"="+k[d]+";"}).join(""),
"}")}var v=r.gl,n=d.def(b,".location"),p=d.def(r.attributes,"[",n,"]");b=c.state;var l=c.buffer,k=[c.x,c.y,c.z,c.w],q=["buffer","normalized","offset","stride"];1===b?h():2===b?f():(d("if(",b,"===",1,"){"),h(),d("}else{"),f(),d("}"))}var r=a.shared;c.forEach(function(c){var r=c.name,n=e.attributes[r],p;if(n){if(!h(n))return;p=n.append(a,d)}else{if(!h(b))return;var l=a.scopeAttrib(r);p={};Object.keys(new v).forEach(function(a){p[a]=d.def(l,".",a)})}g(a.link(c),f(c.info.type),p)})}function ba(a,d,c,
e,h){for(var f=a.shared,g=f.gl,r,n=0;n<e.length;++n){var v=e[n],p=v.name,l=v.info.type,k=c.uniforms[p],v=a.link(v)+".location",q;if(k){if(!h(k))continue;if(y(k)){p=k.value;if(35678===l||35680===l)l=a.link(p._texture||p.color[0]._texture),d(g,".uniform1i(",v,",",l+".bind());"),d.exit(l,".unbind();");else if(35674===l||35675===l||35676===l)p=a.global.def("new Float32Array(["+Array.prototype.slice.call(p)+"])"),k=2,35675===l?k=3:35676===l&&(k=4),d(g,".uniformMatrix",k,"fv(",v,",false,",p,");");else{switch(l){case 5126:r=
"1f";break;case 35664:r="2f";break;case 35665:r="3f";break;case 35666:r="4f";break;case 35670:r="1i";break;case 5124:r="1i";break;case 35671:r="2i";break;case 35667:r="2i";break;case 35672:r="3i";break;case 35668:r="3i";break;case 35673:r="4i";break;case 35669:r="4i"}d(g,".uniform",r,"(",v,",",C(p)?Array.prototype.slice.call(p):p,");")}continue}else q=k.append(a,d)}else{if(!h(b))continue;q=d.def(f.uniforms,"[",m.id(p),"]")}35678===l?d("if(",q,"&&",q,'._reglType==="framebuffer"){',q,"=",q,".color[0];",
"}"):35680===l&&d("if(",q,"&&",q,'._reglType==="framebufferCube"){',q,"=",q,".color[0];","}");p=1;switch(l){case 35678:case 35680:l=d.def(q,"._texture");d(g,".uniform1i(",v,",",l,".bind());");d.exit(l,".unbind();");continue;case 5124:case 35670:r="1i";break;case 35667:case 35671:r="2i";p=2;break;case 35668:case 35672:r="3i";p=3;break;case 35669:case 35673:r="4i";p=4;break;case 5126:r="1f";break;case 35664:r="2f";p=2;break;case 35665:r="3f";p=3;break;case 35666:r="4f";p=4;break;case 35674:r="Matrix2fv";
break;case 35675:r="Matrix3fv";break;case 35676:r="Matrix4fv"}d(g,".uniform",r,"(",v,",");if("M"===r.charAt(0)){var v=Math.pow(l-35674+2,2),u=a.global.def("new Float32Array(",v,")");d("false,(Array.isArray(",q,")||",q," instanceof Float32Array)?",q,":(",t(v,function(a){return u+"["+a+"]="+q+"["+a+"]"}),",",u,")")}else 1<p?d(t(p,function(a){return q+"["+a+"]"})):d(q);d(");")}}function ga(a,d,b,c){function e(h){var f=p[h];return f?f.contextDep&&c.contextDynamic||f.propDep?f.append(a,b):f.append(a,d):
d.def(v,".",h)}function h(){function a(){b(ia,".drawElementsInstancedANGLE(",[l,k,t,q+"<<(("+t+"-5121)>>1)",u],");")}function d(){b(ia,".drawArraysInstancedANGLE(",[l,q,k,u],");")}n?R?a():(b("if(",n,"){"),a(),b("}else{"),d(),b("}")):d()}function f(){function a(){b(r+".drawElements("+[l,k,t,q+"<<(("+t+"-5121)>>1)"]+");")}function d(){b(r+".drawArrays("+[l,q,k]+");")}n?R?a():(b("if(",n,"){"),a(),b("}else{"),d(),b("}")):d()}var g=a.shared,r=g.gl,v=g.draw,p=c.draw,n=function(){var e=p.elements,h=d;if(e){if(e.contextDep&&
c.contextDynamic||e.propDep)h=b;e=e.append(a,h)}else e=h.def(v,".","elements");e&&h("if("+e+")"+r+".bindBuffer(34963,"+e+".buffer.buffer);");return e}(),l=e("primitive"),q=e("offset"),k=function(){var e=p.count,h=d;if(e){if(e.contextDep&&c.contextDynamic||e.propDep)h=b;e=e.append(a,h)}else e=h.def(v,".","count");return e}();if("number"===typeof k){if(0===k)return}else b("if(",k,"){"),b.exit("}");var u,ia;Ca&&(u=e("instances"),ia=a.instancing);var t=n+".type",R=p.elements&&y(p.elements);Ca&&("number"!==
typeof u||0<=u)?"string"===typeof u?(b("if(",u,">0){"),h(),b("}else if(",u,"<0){"),f(),b("}")):h():f()}function Da(a,d,b,e,c){d=wa();c=d.proc("body",c);Ca&&(d.instancing=c.def(d.shared.extensions,".angle_instanced_arrays"));a(d,c,b,e);return d.compile().body}function Ea(a,d,b,e){T(a,d);Z(a,d,b,e.attributes,function(){return!0});ba(a,d,b,e.uniforms,function(){return!0});ga(a,d,d,b)}function Ka(a,d){var b=a.proc("draw",1);T(a,b);M(a,b,d.context);fa(a,b,d.framebuffer);ja(a,b,d);P(a,b,d.state);Y(a,b,
d,!1,!0);var e=d.shader.progVar.append(a,b);b(a.shared.gl,".useProgram(",e,".program);");if(d.shader.program)Ea(a,b,d,d.shader.program);else{var c=a.global.def("{}"),h=b.def(e,".id"),f=b.def(c,"[",h,"]");b(a.cond(f).then(f,".call(this,a0);")["else"](f,"=",c,"[",h,"]=",a.link(function(b){return Da(Ea,a,d,b,1)}),"(",e,");",f,".call(this,a0);"))}0<Object.keys(d.state).length&&b(a.shared.current,".dirty=true;")}function La(a,d,b,e){function c(){return!0}a.batchId="a1";T(a,d);Z(a,d,b,e.attributes,c);ba(a,
d,b,e.uniforms,c);ga(a,d,d,b)}function ka(a,d,b,e){function c(a){return a.contextDep&&f||a.propDep}function h(a){return!c(a)}T(a,d);var f=b.contextDep,g=d.def(),r=d.def();a.shared.props=r;a.batchId=g;var v=a.scope(),p=a.scope();d(v.entry,"for(",g,"=0;",g,"<","a1",";++",g,"){",r,"=","a0","[",g,"];",p,"}",v.exit);b.needsContext&&M(a,p,b.context);b.needsFramebuffer&&fa(a,p,b.framebuffer);P(a,p,b.state,c);b.profile&&c(b.profile)&&Y(a,p,b,!1,!0);e?(Z(a,v,b,e.attributes,h),Z(a,p,b,e.attributes,c),ba(a,
v,b,e.uniforms,h),ba(a,p,b,e.uniforms,c),ga(a,v,p,b)):(d=a.global.def("{}"),e=b.shader.progVar.append(a,p),r=p.def(e,".id"),v=p.def(d,"[",r,"]"),p(a.shared.gl,".useProgram(",e,".program);","if(!",v,"){",v,"=",d,"[",r,"]=",a.link(function(d){return Da(La,a,b,d,2)}),"(",e,");}",v,".call(this,a0[",g,"],",g,");"))}function Fa(a,d){function b(a){return a.contextDep&&c||a.propDep}var e=a.proc("batch",2);a.batchId="0";T(a,e);var c=!1,h=!0;Object.keys(d.context).forEach(function(a){c=c||d.context[a].propDep});
c||(M(a,e,d.context),h=!1);var f=d.framebuffer,g=!1;f?(f.propDep?c=g=!0:f.contextDep&&c&&(g=!0),g||fa(a,e,f)):fa(a,e,null);d.state.viewport&&d.state.viewport.propDep&&(c=!0);ja(a,e,d);P(a,e,d.state,function(a){return!b(a)});d.profile&&b(d.profile)||Y(a,e,d,!1,"a1");d.contextDep=c;d.needsContext=h;d.needsFramebuffer=g;h=d.shader.progVar;if(h.contextDep&&c||h.propDep)ka(a,e,d,null);else if(h=h.append(a,e),e(a.shared.gl,".useProgram(",h,".program);"),d.shader.program)ka(a,e,d,d.shader.program);else{var f=
a.global.def("{}"),g=e.def(h,".id"),r=e.def(f,"[",g,"]");e(a.cond(r).then(r,".call(this,a0,a1);")["else"](r,"=",f,"[",g,"]=",a.link(function(b){return Da(ka,a,d,b,2)}),"(",h,");",r,".call(this,a0,a1);"))}0<Object.keys(d.state).length&&e(a.shared.current,".dirty=true;")}function za(d,b){function e(a){var f=b.shader[a];f&&c.set(h.shader,"."+a,f.append(d,c))}var c=d.proc("scope",3);d.batchId="a2";var h=d.shared,f=h.current;M(d,c,b.context);b.framebuffer&&b.framebuffer.append(d,c);a(Object.keys(b.state)).forEach(function(a){var e=
b.state[a].append(d,c);C(e)?e.forEach(function(b,e){c.set(d.next[a],"["+e+"]",b)}):c.set(h.next,"."+a,e)});Y(d,c,b,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(a){var e=b.draw[a];e&&c.set(h.draw,"."+a,""+e.append(d,c))});Object.keys(b.uniforms).forEach(function(a){c.set(h.uniforms,"["+m.id(a)+"]",b.uniforms[a].append(d,c))});Object.keys(b.attributes).forEach(function(a){var e=b.attributes[a].append(d,c),h=d.scopeAttrib(a);Object.keys(new v).forEach(function(a){c.set(h,
"."+a,e[a])})});e("vert");e("frag");0<Object.keys(b.state).length&&(c(f,".dirty=true;"),c.exit(f,".dirty=true;"));c("a1(",d.shared.context,",a0,",d.batchId,");")}function d(a){if("object"===typeof a&&!C(a)){for(var d=Object.keys(a),b=0;b<d.length;++b)if(f.isDynamic(a[d[b]]))return!0;return!1}}function r(a,b,e){function c(a,d){v.forEach(function(b){var e=h[b];f.isDynamic(e)&&(e=a.invoke(d,e),d(k,".",b,"=",e,";"))})}var h=b["static"][e];if(h&&d(h)){var r=a.global,v=Object.keys(h),p=!1,n=!1,l=!1,k=a.global.def("{}");
v.forEach(function(d){var b=h[d];if(f.isDynamic(b))"function"===typeof b&&(b=h[d]=f.unbox(b)),d=g(b,null),p=p||d.thisDep,l=l||d.propDep,n=n||d.contextDep;else{r(k,".",d,"=");switch(typeof b){case "number":r(b);break;case "string":r('"',b,'"');break;case "object":Array.isArray(b)&&r("[",b.join(),"]");break;default:r(a.link(b))}r(";")}});b.dynamic[e]=new f.DynamicVariable(4,{thisDep:p,contextDep:n,propDep:l,ref:k,append:c});delete b["static"][e]}}var v=na.Record,ia={add:32774,subtract:32778,"reverse subtract":32779};
D.ext_blend_minmax&&(ia.min=32775,ia.max=32776);var Ca=D.angle_instanced_arrays,Ja=D.webgl_draw_buffers,ta={dirty:!0,profile:ha.profile},Ba={},Ha=[],ua={},va={};N("dither",3024);N("blend.enable",3042);E("blend.color","blendColor",[0,0,0,0]);E("blend.equation","blendEquationSeparate",[32774,32774]);E("blend.func","blendFuncSeparate",[1,0,1,0]);N("depth.enable",2929,!0);E("depth.func","depthFunc",513);E("depth.range","depthRange",[0,1]);E("depth.mask","depthMask",!0);E("colorMask","colorMask",[!0,!0,
!0,!0]);N("cull.enable",2884);E("cull.face","cullFace",1029);E("frontFace","frontFace",2305);E("lineWidth","lineWidth",1);N("polygonOffset.enable",32823);E("polygonOffset.offset","polygonOffset",[0,0]);N("sample.alpha",32926);N("sample.enable",32928);E("sample.coverage","sampleCoverage",[1,!1]);N("stencil.enable",2960);E("stencil.mask","stencilMask",-1);E("stencil.func","stencilFunc",[519,0,-1]);E("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);E("stencil.opBack","stencilOpSeparate",
[1029,7680,7680,7680]);N("scissor.enable",3089);E("scissor.box","scissor",[0,0,k.drawingBufferWidth,k.drawingBufferHeight]);E("viewport","viewport",[0,0,k.drawingBufferWidth,k.drawingBufferHeight]);var Ma={gl:k,context:R,strings:m,next:Ba,current:ta,draw:p,elements:U,buffer:x,shader:sa,attributes:na.state,uniforms:L,framebuffer:O,extensions:D,timer:aa,isBufferArgs:l},Ia={primTypes:I,compareFuncs:J,blendFuncs:h,blendEquations:ia,stencilOps:F,glTypes:w,orientationType:q};Ja&&(Ia.backBuffer=[1029],Ia.drawBuffer=
t(G.maxDrawbuffers,function(a){return 0===a?[0]:t(a,function(a){return 36064+a})}));var Na=0;return{next:Ba,current:ta,procs:function(){var a=wa(),d=a.proc("poll"),b=a.proc("refresh"),e=a.block();d(e);b(e);var c=a.shared,h=c.gl,f=c.next,g=c.current;e(g,".dirty=false;");fa(a,d);fa(a,b,null,!0);var r=k.getExtension("angle_instanced_arrays"),v;r&&(v=a.link(r));for(var p=0;p<G.maxAttributes;++p){var n=b.def(c.attributes,"[",p,"]"),l=a.cond(n,".buffer");l.then(h,".enableVertexAttribArray(",p,");",h,".bindBuffer(",
34962,",",n,".buffer.buffer);",h,".vertexAttribPointer(",p,",",n,".size,",n,".type,",n,".normalized,",n,".stride,",n,".offset);")["else"](h,".disableVertexAttribArray(",p,");",h,".vertexAttrib4f(",p,",",n,".x,",n,".y,",n,".z,",n,".w);",n,".buffer=null;");b(l);r&&b(v,".vertexAttribDivisorANGLE(",p,",",n,".divisor);")}Object.keys(ua).forEach(function(c){var r=ua[c],p=e.def(f,".",c),v=a.block();v("if(",p,"){",h,".enable(",r,")}else{",h,".disable(",r,")}",g,".",c,"=",p,";");b(v);d("if(",p,"!==",g,".",
c,"){",v,"}")});Object.keys(va).forEach(function(c){var r=va[c],p=ta[c],v,n,l=a.block();l(h,".",r,"(");C(p)?(r=p.length,v=a.global.def(f,".",c),n=a.global.def(g,".",c),l(t(r,function(a){return v+"["+a+"]"}),");",t(r,function(a){return n+"["+a+"]="+v+"["+a+"];"}).join("")),d("if(",t(r,function(a){return v+"["+a+"]!=="+n+"["+a+"]"}).join("||"),"){",l,"}")):(v=e.def(f,".",c),n=e.def(g,".",c),l(v,");",g,".",c,"=",v,";"),d("if(",v,"!==",n,"){",l,"}"));b(l)});return a.compile()}(),compile:function(a,d,
b,e,c){var h=wa();h.stats=h.link(c);Object.keys(d["static"]).forEach(function(a){r(h,d,a)});n.forEach(function(d){r(h,a,d)});b=pa(a,d,b,e,h);Ka(h,b);za(h,b);Fa(h,b);return h.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],9:[function(k,m,x){function l(a,g){this.id=y++;this.type=a;this.data=g}function a(e){if(0===e.length)return[];var g=e.charAt(0),
c=e.charAt(e.length-1);if(1<e.length&&g===c&&('"'===g||"'"===g))return['"'+e.substr(1,e.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(g=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e))return a(e.substr(0,g.index)).concat(a(g[1])).concat(a(e.substr(g.index+g[0].length)));g=e.split(".");if(1===g.length)return['"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];e=[];for(c=0;c<g.length;++c)e=e.concat(a(g[c]));return e}function u(e){return"["+a(e).join("][")+"]"}var y=0;m.exports={DynamicVariable:l,
define:function(a,g){return new l(a,u(g+""))},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof l},unbox:function(a,g){return"function"===typeof a?new l(0,a):a},accessor:u}},{}],10:[function(k,m,x){var l=k("./util/is-typed-array"),a=k("./util/is-ndarray"),u=k("./util/values"),y=k("./constants/primitives.json"),e=k("./constants/usage.json");m.exports=function(g,c,k,m){function G(a){this.id=w++;I[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function C(e,
f,g,n,b,u,y){(u=y)||l(f)&&(!a(f)||l(f.data))||(u=c.oes_element_index_uint?5125:5123);e.buffer.bind();k._initBuffer(e.buffer,f,g,u,3);f=y;if(!y){switch(e.buffer.dtype){case 5121:case 5120:f=5121;break;case 5123:case 5122:f=5123;break;case 5125:case 5124:f=5125}e.buffer.dtype=f}e.type=f;0>b&&(b=e.buffer.byteLength,5123===f?b>>=1:5125===f&&(b>>=2));e.vertCount=b;b=n;0>n&&(b=4,n=e.buffer.dimension,1===n&&(b=0),2===n&&(b=1),3===n&&(b=4));e.primType=b}function f(a){m.elementsCount--;delete I[a.id];a.buffer.destroy();
a.buffer=null}var I={},w=0,H={uint8:5121,uint16:5123};c.oes_element_index_uint&&(H.uint32=5125);G.prototype.bind=function(){this.buffer.bind()};var n=[];return{create:function(c,n){function u(c){if(c)if("number"===typeof c)q(c),b.primType=4,b.vertCount=c|0,b.type=5121;else{var h=null,f=35044,n=-1,k=-1,t=0,m=0;Array.isArray(c)||l(c)||a(c)?h=c:("data"in c&&(h=c.data),"usage"in c&&(f=e[c.usage]),"primitive"in c&&(n=y[c.primitive]),"count"in c&&(k=c.count|0),"length"in c&&(t=c.length|0),"type"in c&&(m=
H[c.type]));h?C(b,h,f,n,k,t,m):(c=b.buffer,c.bind(),g.bufferData(34963,t,f),c.dtype=m||5121,c.usage=f,c.dimension=3,c.byteLength=t,b.primType=0>n?4:n,b.vertCount=0>k?0:k,b.type=c.dtype)}else q(),b.primType=4,b.vertCount=0,b.type=5121;return u}var q=k.create(null,34963,!0),b=new G(q._buffer);m.elementsCount++;u(c);u._reglType="elements";u._elements=b;u.subdata=function(a,b){q.subdata(a,b);return u};u.destroy=function(){f(b)};return u},createStream:function(a){var c=n.pop();c||(c=new G(k.create(null,
34963,!0,!1)._buffer));C(c,a,35040,-1,-1,0,0);return c},destroyStream:function(a){n.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof G?a._elements:null},clear:function(){u(I).forEach(f)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],11:[function(k,m,x){m.exports=function(l,a){function k(a){a=a.toLowerCase();var e;try{e=y[a]=l.getExtension(a)}catch(g){}return!!e}for(var y={},
e=0;e<a.extensions.length;++e){var g=a.extensions[e];if(!k(g))return a.onDestroy(),a.onDone('"'+g+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}a.optionalExtensions.forEach(k);return{extensions:y,restore:function(){Object.keys(y).forEach(function(a){if(!k(a))throw Error("(regl): error restoring extension "+a);})}}}},{}],12:[function(k,m,x){var l=k("./util/values"),a=k("./util/extend"),u=[];u[6408]=4;var y=[];y[5121]=1;y[5126]=4;
y[36193]=2;m.exports=function(e,g,c,k,m,G){function C(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var e=a=0;b?(a=b.width,e=b.height):c&&(a=c.width,e=c.height);this.width=a;this.height=e}function f(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function I(a,b,c){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function w(a,b){b?b.texture?e.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,
0):e.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):e.framebufferTexture2D(36160,a,3553,null,0)}function H(a){var b=3553,c=null,e=null,h=a;"object"===typeof a&&(h=a.data,"target"in a&&(b=a.target|0));a=h._reglType;"texture2d"===a?c=h:"textureCube"===a?c=h:"renderbuffer"===a&&(e=h,b=36161);return new C(b,c,e)}function n(a,b,c,e,h){if(c)return a=k.create2D({width:a,height:b,format:e,type:h}),a._texture.refCount=0,new C(3553,a,null);a=m.create({width:a,height:b,format:e});
a._renderbuffer.refCount=0;return new C(36161,null,a)}function h(a){return a&&(a.texture||a.renderbuffer)}function J(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function F(){this.id=ma++;O[this.id]=this;this.framebuffer=e.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function q(a){a.colorAttachments.forEach(f);f(a.depthAttachment);f(a.stencilAttachment);f(a.depthStencilAttachment)}
function b(a){e.deleteFramebuffer(a.framebuffer);a.framebuffer=null;G.framebufferCount--;delete O[a.id]}function x(a){var b;e.bindFramebuffer(36160,a.framebuffer);var h=a.colorAttachments;for(b=0;b<h.length;++b)w(36064+b,h[b]);for(b=h.length;b<c.maxColorAttachments;++b)w(36064+b,null);w(36096,a.depthAttachment);w(36128,a.stencilAttachment);w(33306,a.depthStencilAttachment);e.checkFramebufferStatus(36160);e.bindFramebuffer(36160,la.next);la.cur=la.next;e.getError()}function Aa(c,e){function f(a,b){var c,
e=0,l=0,k=!0,t=!0;c=null;var m=!0,w="rgba",C="uint8",D=1,F=null,G=null,J=null,Aa=!1;if("number"===typeof a)e=a|0,l=b|0||e;else if(a){"shape"in a?(l=a.shape,e=l[0],l=l[1]):("radius"in a&&(e=l=a.radius),"width"in a&&(e=a.width),"height"in a&&(l=a.height));if("color"in a||"colors"in a)c=a.color||a.colors,Array.isArray(c);if(!c){"colorCount"in a&&(D=a.colorCount|0);"colorTexture"in a&&(m=!!a.colorTexture,w="rgba4");if("colorType"in a&&(C=a.colorType,!m))if("half float"===C||"float16"===C)w="rgba16f";
else if("float"===C||"float32"===C)w="rgba32f";"colorFormat"in a&&(w=a.colorFormat,0<=Ga.indexOf(w)?m=!0:0<=ya.indexOf(w)&&(m=!1))}if("depthTexture"in a||"depthStencilTexture"in a)Aa=!(!a.depthTexture&&!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?k=a.depth:(F=a.depth,t=!1));"stencil"in a&&("boolean"===typeof a.stencil?t=a.stencil:(G=a.stencil,k=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?k=t=a.depthStencil:(J=a.depthStencil,t=k=!1))}else e=l=1;var L=null,la=null,
M=null,U=null;if(Array.isArray(c))L=c.map(H);else if(c)L=[H(c)];else for(L=Array(D),c=0;c<D;++c)L[c]=n(e,l,m,w,C);e=e||L[0].width;l=l||L[0].height;F?la=H(F):k&&!t&&(la=n(e,l,Aa,"depth","uint32"));G?M=H(G):t&&!k&&(M=n(e,l,!1,"stencil","uint8"));J?U=H(J):!F&&!G&&t&&k&&(U=n(e,l,Aa,"depth stencil","depth stencil"));k=null;for(c=0;c<L.length;++c)I(L[c],e,l),L[c]&&L[c].texture&&(t=u[L[c].texture._texture.format]*y[L[c].texture._texture.type],null===k&&(k=t));I(la,e,l);I(M,e,l);I(U,e,l);q(g);g.width=e;g.height=
l;g.colorAttachments=L;g.depthAttachment=la;g.stencilAttachment=M;g.depthStencilAttachment=U;f.color=L.map(h);f.depth=h(la);f.stencil=h(M);f.depthStencil=h(U);f.width=g.width;f.height=g.height;x(g);return f}var g=new F;G.framebufferCount++;f(c,e);return a(f,{resize:function(a,b){var c=a|0,e=b|0||c;if(c===g.width&&e===g.height)return f;for(var h=g.colorAttachments,n=0;n<h.length;++n)J(h[n],c,e);J(g.depthAttachment,c,e);J(g.stencilAttachment,c,e);J(g.depthStencilAttachment,c,e);g.width=f.width=c;g.height=
f.height=e;x(g);return f},_reglType:"framebuffer",_framebuffer:g,destroy:function(){b(g);q(g)}})}var la={cur:null,next:null,dirty:!1},Ga=["rgba"],ya=["rgba4","rgb565","rgb5 a1"];g.ext_srgb&&ya.push("srgba");g.ext_color_buffer_half_float&&ya.push("rgba16f","rgb16f");g.webgl_color_buffer_float&&ya.push("rgba32f");var U=["uint8"];g.oes_texture_half_float&&U.push("half float","float16");g.oes_texture_float&&U.push("float","float32");var ma=0,O={};return a(la,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof F)?a:null},create:Aa,createCube:function(b){function c(b){var h,f={color:null},g=0,n=null;h="rgba";var l="uint8",q=1;if("number"===typeof b)g=b|0;else if(b){"shape"in b?g=b.shape[0]:("radius"in b&&(g=b.radius|0),"width"in b?g=b.width|0:"height"in b&&(g=b.height|0));if("color"in b||"colors"in b)n=b.color||b.colors,Array.isArray(n);n||("colorCount"in b&&(q=b.colorCount|0),"colorType"in b&&(l=b.colorType),"colorFormat"in b&&(h=b.colorFormat));
"depth"in b&&(f.depth=b.depth);"stencil"in b&&(f.stencil=b.stencil);"depthStencil"in b&&(f.depthStencil=b.depthStencil)}else g=1;if(n)if(Array.isArray(n))for(b=[],h=0;h<n.length;++h)b[h]=n[h];else b=[n];else for(b=Array(q),n={radius:g,format:h,type:l},h=0;h<q;++h)b[h]=k.createCube(n);f.color=Array(b.length);for(h=0;h<b.length;++h)q=b[h],g=g||q.width,f.color[h]={target:34069,data:b[h]};for(h=0;6>h;++h){for(q=0;q<b.length;++q)f.color[q].target=34069+h;0<h&&(f.depth=e[0].depth,f.stencil=e[0].stencil,
f.depthStencil=e[0].depthStencil);if(e[h])e[h](f);else e[h]=Aa(f)}return a(c,{width:g,height:g,color:b})}var e=Array(6);c(b);return a(c,{faces:e,resize:function(a){var b=a|0;if(b===c.width)return c;var h=c.color;for(a=0;a<h.length;++a)h[a].resize(b);for(a=0;6>a;++a)e[a].resize(b);c.width=c.height=b;return c},_reglType:"framebufferCube",destroy:function(){e.forEach(function(a){a.destroy()})}})},clear:function(){l(O).forEach(b)},restore:function(){l(O).forEach(function(a){a.framebuffer=e.createFramebuffer();
x(a)})}})}},{"./util/extend":23,"./util/values":31}],13:[function(k,m,x){m.exports=function(l,a){var k=1;a.ext_texture_filter_anisotropic&&(k=l.getParameter(34047));var y=1,e=1;a.webgl_draw_buffers&&(y=l.getParameter(34852),e=l.getParameter(36063));return{colorBits:[l.getParameter(3410),l.getParameter(3411),l.getParameter(3412),l.getParameter(3413)],depthBits:l.getParameter(3414),stencilBits:l.getParameter(3415),subpixelBits:l.getParameter(3408),extensions:Object.keys(a).filter(function(e){return!!a[e]}),
maxAnisotropic:k,maxDrawbuffers:y,maxColorAttachments:e,pointSizeDims:l.getParameter(33901),lineWidthDims:l.getParameter(33902),maxViewportDims:l.getParameter(3386),maxCombinedTextureUnits:l.getParameter(35661),maxCubeMapSize:l.getParameter(34076),maxRenderbufferSize:l.getParameter(34024),maxTextureUnits:l.getParameter(34930),maxTextureSize:l.getParameter(3379),maxAttributes:l.getParameter(34921),maxVertexUniforms:l.getParameter(36347),maxVertexTextureUnits:l.getParameter(35660),maxVaryingVectors:l.getParameter(36348),
maxFragmentUniforms:l.getParameter(36349),glsl:l.getParameter(35724),renderer:l.getParameter(7937),vendor:l.getParameter(7936),version:l.getParameter(7938)}}},{}],14:[function(k,m,x){var l=k("./util/is-typed-array");m.exports=function(a,k,y,e,g,c){return function(c){var g;g=null===k.next?5121:k.next.colorAttachments[0].texture._texture.type;var m=0,C=0,f=e.framebufferWidth,I=e.framebufferHeight,w=null;l(c)?w=c:c&&(m=c.x|0,C=c.y|0,f=(c.width||e.framebufferWidth-m)|0,I=(c.height||e.framebufferHeight-
C)|0,w=c.data||null);y();c=f*I*4;w||(5121===g?w=new Uint8Array(c):5126===g&&(w=w||new Float32Array(c)));a.pixelStorei(3333,4);a.readPixels(m,C,f,I,6408,g,w);return w}}},{"./util/is-typed-array":26}],15:[function(k,m,x){var l=k("./util/values"),a=[];a[32854]=2;a[32855]=2;a[36194]=2;a[33189]=2;a[36168]=1;a[34041]=4;a[35907]=4;a[34836]=16;a[34842]=8;a[34843]=6;m.exports=function(k,m,e,g,c){function t(a){this.id=C++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;c.profile&&
(this.stats={size:0})}function D(a){var c=a.renderbuffer;k.bindRenderbuffer(36161,null);k.deleteRenderbuffer(c);a.renderbuffer=null;a.refCount=0;delete f[a.id];g.renderbufferCount--}var G={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};m.ext_srgb&&(G.srgba=35907);m.ext_color_buffer_half_float&&(G.rgba16f=34842,G.rgb16f=34843);m.webgl_color_buffer_float&&(G.rgba32f=34836);var C=0,f={};t.prototype.decRef=function(){0>=--this.refCount&&D(this)};c.profile&&(g.getTotalRenderbufferSize=
function(){var a=0;Object.keys(f).forEach(function(c){a+=f[c].stats.size});return a});return{create:function(e,l){function m(e,f){var g=0,l=0,b=32854;"object"===typeof e&&e?("shape"in e?(l=e.shape,g=l[0]|0,l=l[1]|0):("radius"in e&&(g=l=e.radius|0),"width"in e&&(g=e.width|0),"height"in e&&(l=e.height|0)),"format"in e&&(b=G[e.format])):"number"===typeof e?(g=e|0,l="number"===typeof f?f|0:g):e||(g=l=1);if(g!==n.width||l!==n.height||b!==n.format)return m.width=n.width=g,m.height=n.height=l,n.format=b,
k.bindRenderbuffer(36161,n.renderbuffer),k.renderbufferStorage(36161,b,g,l),c.profile&&(n.stats.size=a[n.format]*n.width*n.height),m}var n=new t(k.createRenderbuffer());f[n.id]=n;g.renderbufferCount++;m(e,l);m.resize=function(e,f){var g=e|0,l=f|0||g;if(g===n.width&&l===n.height)return m;m.width=n.width=g;m.height=n.height=l;k.bindRenderbuffer(36161,n.renderbuffer);k.renderbufferStorage(36161,n.format,g,l);c.profile&&(n.stats.size=a[n.format]*n.width*n.height);return m};m._reglType="renderbuffer";
m._renderbuffer=n;c.profile&&(m.stats=n.stats);m.destroy=function(){n.decRef()};return m},clear:function(){l(f).forEach(D)},restore:function(){l(f).forEach(function(a){a.renderbuffer=k.createRenderbuffer();k.bindRenderbuffer(36161,a.renderbuffer);k.renderbufferStorage(36161,a.format,a.width,a.height)});k.bindRenderbuffer(36161,null)}}}},{"./util/values":31}],16:[function(k,m,x){var l=k("./util/values");m.exports=function(a,k,m,e){function g(a,c,e,f){this.name=a;this.id=c;this.location=e;this.info=
f}function c(a,c){for(var e=0;e<a.length;++e)if(a[e].id===c.id){a[e].location=c.location;return}a.push(c)}function t(c,e,g){g=35632===c?C:f;var l=g[e];if(!l){var q=k.str(e),l=a.createShader(c);a.shaderSource(l,q);a.compileShader(l);g[e]=l}return l}function D(a,c){this.id=H++;this.fragId=a;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[];e.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function G(f,h){var l,m;l=t(35632,f.fragId);m=t(35633,f.vertId);var q=f.program=a.createProgram();
a.attachShader(q,l);a.attachShader(q,m);a.linkProgram(q);var b=a.getProgramParameter(q,35718);e.profile&&(f.stats.uniformsCount=b);var y=f.uniforms;for(l=0;l<b;++l)if(m=a.getActiveUniform(q,l))if(1<m.size)for(var w=0;w<m.size;++w){var C=m.name.replace("[0]","["+w+"]");c(y,new g(C,k.id(C),a.getUniformLocation(q,C),m))}else c(y,new g(m.name,k.id(m.name),a.getUniformLocation(q,m.name),m));b=a.getProgramParameter(q,35721);e.profile&&(f.stats.attributesCount=b);y=f.attributes;for(l=0;l<b;++l)(m=a.getActiveAttrib(q,
l))&&c(y,new g(m.name,k.id(m.name),a.getAttribLocation(q,m.name),m))}var C={},f={},I={},w=[],H=0;e.profile&&(m.getMaxUniformsCount=function(){var a=0;w.forEach(function(c){c.stats.uniformsCount>a&&(a=c.stats.uniformsCount)});return a},m.getMaxAttributesCount=function(){var a=0;w.forEach(function(c){c.stats.attributesCount>a&&(a=c.stats.attributesCount)});return a});return{clear:function(){var c=a.deleteShader.bind(a);l(C).forEach(c);C={};l(f).forEach(c);f={};w.forEach(function(c){a.deleteProgram(c.program)});
w.length=0;I={};m.shaderCount=0},program:function(a,c,e){m.shaderCount++;var f=I[c];f||(f=I[c]={});var g=f[a];g||(g=new D(c,a),G(g,e),f[a]=g,w.push(g));return g},restore:function(){C={};f={};for(var a=0;a<w.length;++a)G(w[a])},shader:t,frag:-1,vert:-1}}},{"./util/values":31}],17:[function(k,m,x){m.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(k,m,x){m.exports=function(){var l=
{"":0},a=[""];return{id:function(k){var m=l[k];if(m)return m;m=l[k]=a.length;a.push(k);return m},str:function(l){return a[l]}}}},{}],19:[function(k,m,x){function l(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function a(a){return Array.isArray(a)&&0!==a.length&&I(a[0])?!0:!1}function u(a){return Object.prototype.toString.call(a)}function y(b){if(!b)return!1;var c=u(b);return 0<=J.indexOf(c)?!0:l(b)||a(b)||G(b)}function e(a,c){36193===a.type?(a.data=f(c),C.freeType(c)):a.data=
c}function g(a,c,e,f,g,l){a="undefined"!==typeof q[a]?q[a]:h[a]*F[c];l&&(a*=6);if(g){for(f=0;1<=e;)f+=a*e*e,e/=2;return f}return a*e*f}var c=k("./util/extend"),t=k("./util/values"),D=k("./util/is-typed-array"),G=k("./util/is-ndarray"),C=k("./util/pool"),f=k("./util/to-half-float"),I=k("./util/is-array-like");x=k("./constants/arraytypes.json");var w=k("./constants/arraytypes.json"),H=[9984,9986,9985,9987],n=[0,6409,6410,6407,6408],h={};h[6409]=h[6406]=h[6402]=1;h[34041]=h[6410]=2;h[6407]=h[35904]=
3;h[6408]=h[35906]=4;var J=Object.keys(x).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),F=[];F[5121]=1;F[5126]=4;F[36193]=2;F[5123]=2;F[5125]=4;var q=[];q[32854]=2;q[32855]=2;q[36194]=2;q[34041]=4;q[33776]=.5;q[33777]=.5;q[33778]=1;q[33779]=1;q[35986]=.5;q[35987]=1;q[34798]=1;q[35840]=.5;q[35841]=.25;q[35842]=.5;q[35843]=.25;q[36196]=.5;m.exports=function(b,k,m,q,x,J,F){function ma(){this.format=this.internalformat=
6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function O(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function L(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=
b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=P[b.colorSpace]);"type"in b&&(a.type=T[b.type]);var c=a.width,e=a.height,f=a.channels,g=!1;"shape"in b?(c=b.shape[0],e=b.shape[1],3===b.shape.length&&(f=b.shape[2],g=!0)):("radius"in b&&(c=e=b.radius),"width"in b&&(c=b.width),"height"in b&&(e=b.height),"channels"in b&&(f=b.channels,g=!0));a.width=c|0;a.height=e|0;a.channels=f|0;c=!1;"format"in b&&(c=b.format,e=a.internalformat=
Y[c],a.format=Da[e],c in T&&!("type"in b)&&(a.type=T[c]),c in Z&&(a.compressed=!0),c=!0);!g&&c?a.channels=h[a.format]:g&&!c&&a.channels!==n[a.format]&&(a.format=a.internalformat=n[a.channels])}}function na(a){b.pixelStorei(37440,a.flipY);b.pixelStorei(37441,a.premultiplyAlpha);b.pixelStorei(37443,a.colorSpace);b.pixelStorei(3317,a.unpackAlignment)}function sa(){ma.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function p(d,b){var c=null;
y(b)?c=b:b&&(L(d,b),"x"in b&&(d.xOffset=b.x|0),"y"in b&&(d.yOffset=b.y|0),y(b.data)&&(c=b.data));if(b.copy){var g=x.viewportWidth,h=x.viewportHeight;d.width=d.width||g-d.xOffset;d.height=d.height||h-d.yOffset;d.needsCopy=!0}else if(!c)d.width=d.width||1,d.height=d.height||1;else if(D(c))d.data=c,"type"in b||5121!==d.type||(d.type=w[Object.prototype.toString.call(c)]|0);else if(l(c)){g=c;h=d.width*d.height*d.channels;switch(d.type){case 5121:case 5123:case 5125:case 5126:h=C.allocType(d.type,h);h.set(g);
d.data=h;break;case 36193:d.data=f(g)}d.alignment=1;d.needsFree=!0}else if(G(c)){g=c.data;Array.isArray(g)||5121!==d.type||(d.type=w[Object.prototype.toString.call(g)]|0);var h=c.shape,k=c.stride,m,p,q,t;3===h.length?(q=h[2],t=k[2]):t=q=1;m=h[0];p=h[1];h=k[0];k=k[1];d.alignment=1;d.width=m;d.height=p;d.channels=q;d.format=d.internalformat=n[q];d.needsFree=!0;m=t;c=c.offset;q=d.width;t=d.height;p=d.channels;for(var H=C.allocType(36193===d.type?5126:d.type,q*t*p),ga=0,E=0;E<t;++E)for(var F=0;F<q;++F)for(var B=
0;B<p;++B)H[ga++]=g[h*F+k*E+m*B+c];e(d,H)}else if("[object HTMLCanvasElement]"===u(c)||"[object CanvasRenderingContext2D]"===u(c))"[object HTMLCanvasElement]"===u(c)?d.element=c:d.element=c.canvas,d.width=d.element.width,d.height=d.element.height;else if("[object HTMLImageElement]"===u(c))d.element=c,d.width=c.naturalWidth,d.height=c.naturalHeight;else if("[object HTMLVideoElement]"===u(c))d.element=c,d.width=c.videoWidth,d.height=c.videoHeight,d.needsPoll=!0;else if(a(c)){g=c[0].length;h=c.length;
k=1;if(I(c[0][0])){m=k=c[0][0].length;q=C.allocType(36193===d.type?5126:d.type,g*h*m);for(p=t=0;p<h;++p)for(H=c[p],ga=0;ga<g;++ga)for(E=H[ga],F=0;F<m;++F)q[t++]=E[F];e(d,q)}else{m=C.allocType(36193===d.type?5126:d.type,g*h);for(t=q=0;t<h;++t)for(p=c[t],H=0;H<g;++H)m[q++]=p[H];e(d,m)}d.alignment=1;d.width=g;d.height=h;d.channels=k;d.format=d.internalformat=n[k];d.needsFree=!0}}function R(a,c,e,f,g){var h=a.element,l=a.data,k=a.internalformat,n=a.format,m=a.type,p=a.width,t=a.height;na(a);h?b.texSubImage2D(c,
g,e,f,n,m,h):a.compressed?b.compressedTexSubImage2D(c,g,e,f,k,p,t,l):a.needsCopy?(q(),b.copyTexSubImage2D(c,g,e,f,a.xOffset,a.yOffset,p,t)):b.texSubImage2D(c,g,e,f,p,t,n,m,l)}function aa(){return Ea.pop()||new sa}function ha(a){a.needsFree&&C.freeType(a.data);sa.call(a);Ea.push(a)}function W(){ma.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function N(a,b,c){var e=a.images[0]=aa();a.mipmask=1;e.width=a.width=b;e.height=a.height=c}function E(a,b){var c=null;
if(y(b))c=a.images[0]=aa(),O(c,a),p(c,b),a.mipmask=1;else if(L(a,b),Array.isArray(b.mipmap))for(var e=b.mipmap,f=0;f<e.length;++f)c=a.images[f]=aa(),O(c,a),c.width>>=f,c.height>>=f,p(c,e[f]),a.mipmask|=1<<f;else c=a.images[0]=aa(),O(c,a),p(c,b),a.mipmask=1;O(a,a.images[0])}function wa(a,c){for(var e=a.images,f=0;f<e.length&&e[f];++f){var g=e[f],h=c,l=f,k=g.element,n=g.data,m=g.internalformat,p=g.format,t=g.type,u=g.width,w=g.height;na(g);k?b.texImage2D(h,l,p,p,t,k):g.compressed?b.compressedTexImage2D(h,
l,m,u,w,0,n):g.needsCopy?(q(),b.copyTexImage2D(h,l,p,g.xOffset,g.yOffset,u,w,0)):b.texImage2D(h,l,p,u,w,0,p,t,n)}}function oa(){var a=Ka.pop()||new W;ma.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function xa(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&ha(b[c]),b[c]=null;Ka.push(a)}function Q(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ca(a,b){"min"in b&&(a.minFilter=ja[b.min],0<=H.indexOf(a.minFilter)&&
(a.genMipmaps=!0));"mag"in b&&(a.magFilter=fa[b.mag]);var c=a.wrapS,e=a.wrapT;if("wrap"in b){var f=b.wrap;"string"===typeof f?c=e=M[f]:Array.isArray(f)&&(c=M[f[0]],e=M[f[1]])}else"wrapS"in b&&(c=M[b.wrapS]),"wrapT"in b&&(e=M[b.wrapT]);a.wrapS=c;a.wrapT=e;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=pa[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in
b||(a.minFilter=9984)}}function da(a,c){b.texParameteri(c,10241,a.minFilter);b.texParameteri(c,10240,a.magFilter);b.texParameteri(c,10242,a.wrapS);b.texParameteri(c,10243,a.wrapT);k.ext_texture_filter_anisotropic&&b.texParameteri(c,34046,a.anisotropic);a.genMipmaps&&(b.hint(33170,a.mipmapHint),b.generateMipmap(c))}function qa(a){ma.call(this);this.mipmask=0;this.internalformat=6408;this.id=La++;this.refCount=1;this.target=a;this.texture=b.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=
new Q;F.profile&&(this.stats={size:0})}function ea(a){b.activeTexture(33984);b.bindTexture(a.target,a.texture)}function X(){var a=za[0];a?b.bindTexture(a.target,a.texture):b.bindTexture(3553,null)}function ra(a){var c=a.texture,e=a.unit,f=a.target;0<=e&&(b.activeTexture(33984+e),b.bindTexture(f,null),za[e]=null);b.deleteTexture(c);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete ka[a.id];J.textureCount--}var pa={"don't care":4352,"dont care":4352,nice:4354,fast:4353},M={repeat:10497,
clamp:33071,mirror:33648},fa={nearest:9728,linear:9729},ja=c({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},fa),P={none:0,browser:37444},T={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Y={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Z={};k.ext_srgb&&(Y.srgb=35904,Y.srgba=35906);k.oes_texture_float&&(T.float32=T["float"]=5126);k.oes_texture_half_float&&
(T.float16=T["half float"]=36193);k.webgl_depth_texture&&(c(Y,{depth:6402,"depth stencil":34041}),c(T,{uint16:5123,uint32:5125,"depth stencil":34042}));k.webgl_compressed_texture_s3tc&&c(Z,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});k.webgl_compressed_texture_atc&&c(Z,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});k.webgl_compressed_texture_pvrtc&&c(Z,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});k.webgl_compressed_texture_etc1&&(Z["rgb etc1"]=36196);var ba=Array.prototype.slice.call(b.getParameter(34467));Object.keys(Z).forEach(function(a){var b=Z[a];0<=ba.indexOf(b)&&(Y[a]=b)});var ga=Object.keys(Y);m.textureFormats=ga;var Da=ga.reduce(function(a,b){var c=Y[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),Ea=[],Ka=[],La=0,ka={},Fa=m.maxTextureUnits,za=Array(Fa).map(function(){return null});
c(qa.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var c=0;c<Fa;++c){var e=za[c];if(e){if(0<e.bindCount)continue;e.unit=-1}za[c]=this;a=c;break}F.profile&&J.maxTextureUnits<a+1&&(J.maxTextureUnits=a+1);this.unit=a;b.activeTexture(33984+a);b.bindTexture(this.target,this.texture)}return a},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&ra(this)}});F.profile&&(J.getTotalTextureSize=function(){var a=0;Object.keys(ka).forEach(function(b){a+=ka[b].stats.size});
return a});return{create2D:function(a,c){function e(a,b){var c=f.texInfo;Q.call(c);var d=oa();"number"===typeof a?"number"===typeof b?N(d,a|0,b|0):N(d,a|0,a|0):a?(ca(c,a),E(d,a)):N(d,1,1);c.genMipmaps&&(d.mipmask=(d.width<<1)-1);f.mipmask=d.mipmask;O(f,d);f.internalformat=d.internalformat;e.width=d.width;e.height=d.height;ea(f);wa(d,3553);da(c,3553);X();xa(d);F.profile&&(f.stats.size=g(f.internalformat,f.type,d.width,d.height,c.genMipmaps,!1));return e}var f=new qa(3553);ka[f.id]=f;J.textureCount++;
e(a,c);e.subimage=function(a,b,c,d){b|=0;c|=0;d|=0;var g=aa();O(g,f);g.width>>=d;g.height>>=d;g.width-=b;g.height-=c;p(g,a);ea(f);R(g,3553,b,c,d);X();ha(g);return e};e.resize=function(a,c){var d=a|0,h=c|0||d;if(d===f.width&&h===f.height)return e;e.width=f.width=d;e.height=f.height=h;ea(f);for(var l=0;f.mipmask>>l;++l)b.texImage2D(3553,l,f.format,d>>l,h>>l,0,f.format,f.type,null);X();F.profile&&(f.stats.size=g(f.internalformat,f.type,d,h,!1,!1));return e};e._reglType="texture2d";e._texture=f;F.profile&&
(e.stats=f.stats);e.destroy=function(){f.decRef()};return e},createCube:function(a,c,e,f,h,l){function k(a,b,c,d,e,f){var h,l=n.texInfo;Q.call(l);for(h=0;6>h;++h)m[h]=oa();if("number"===typeof a||!a)for(a=a|0||1,h=0;6>h;++h)N(m[h],a,a);else if("object"===typeof a)if(b)E(m[0],a),E(m[1],b),E(m[2],c),E(m[3],d),E(m[4],e),E(m[5],f);else if(ca(l,a),L(n,a),"faces"in a)for(a=a.faces,h=0;6>h;++h)O(m[h],n),E(m[h],a[h]);else for(h=0;6>h;++h)E(m[h],a);O(n,m[0]);n.mipmask=l.genMipmaps?(m[0].width<<1)-1:m[0].mipmask;
n.internalformat=m[0].internalformat;k.width=m[0].width;k.height=m[0].height;ea(n);for(h=0;6>h;++h)wa(m[h],34069+h);da(l,34067);X();F.profile&&(n.stats.size=g(n.internalformat,n.type,k.width,k.height,l.genMipmaps,!0));for(h=0;6>h;++h)xa(m[h]);return k}var n=new qa(34067);ka[n.id]=n;J.cubeCount++;var m=Array(6);k(a,c,e,f,h,l);k.subimage=function(a,b,c,d,e){c|=0;d|=0;e|=0;var f=aa();O(f,n);f.width>>=e;f.height>>=e;f.width-=c;f.height-=d;p(f,b);ea(n);R(f,34069+a,c,d,e);X();ha(f);return k};k.resize=function(a){a|=
0;if(a!==n.width){k.width=n.width=a;k.height=n.height=a;ea(n);for(var c=0;6>c;++c)for(var d=0;n.mipmask>>d;++d)b.texImage2D(34069+c,d,n.format,a>>d,a>>d,0,n.format,n.type,null);X();F.profile&&(n.stats.size=g(n.internalformat,n.type,k.width,k.height,!1,!0));return k}};k._reglType="textureCube";k._texture=n;F.profile&&(k.stats=n.stats);k.destroy=function(){n.decRef()};return k},clear:function(){for(var a=0;a<Fa;++a)b.activeTexture(33984+a),b.bindTexture(3553,null),za[a]=null;t(ka).forEach(ra);J.cubeCount=
0;J.textureCount=0},getTexture:function(a){return null},restore:function(){t(ka).forEach(function(a){a.texture=b.createTexture();b.bindTexture(a.target,a.texture);for(var c=0;32>c;++c)if(0!==(a.mipmask&1<<c))if(3553===a.target)b.texImage2D(3553,c,a.internalformat,a.width>>c,a.height>>c,0,a.internalformat,a.type,null);else for(var e=0;6>e;++e)b.texImage2D(34069+e,c,a.internalformat,a.width>>c,a.height>>c,0,a.internalformat,a.type,null);da(a.texInfo,a.target)})}}}},{"./constants/arraytypes.json":4,
"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/to-half-float":30,"./util/values":31}],20:[function(k,m,x){m.exports=function(l,a){function k(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function m(a,c,e){var g=t.pop()||new k;g.startQueryIndex=a;g.endQueryIndex=c;g.sum=0;g.stats=e;D.push(g)}var e=a.ext_disjoint_timer_query;if(!e)return null;var g=[],c=[],t=[],D=[],G=[],C=[];return{beginQuery:function(a){var l=
g.pop()||e.createQueryEXT();e.beginQueryEXT(35007,l);c.push(l);m(c.length-1,c.length,a)},endQuery:function(){e.endQueryEXT(35007)},pushScopeStats:m,update:function(){var a,l;a=c.length;if(0!==a){C.length=Math.max(C.length,a+1);G.length=Math.max(G.length,a+1);G[0]=0;var k=C[0]=0;for(l=a=0;l<c.length;++l){var m=c[l];e.getQueryObjectEXT(m,34919)?(k+=e.getQueryObjectEXT(m,34918),g.push(m)):c[a++]=m;G[l+1]=k;C[l+1]=a}c.length=a;for(l=a=0;l<D.length;++l){var k=D[l],n=k.startQueryIndex,m=k.endQueryIndex;
k.sum+=G[m]-G[n];n=C[n];m=C[m];m===n?(k.stats.gpuTime+=k.sum/1E6,t.push(k)):(k.startQueryIndex=n,k.endQueryIndex=m,D[a++]=k)}D.length=a}},getNumPendingQueries:function(){return c.length},clear:function(){g.push.apply(g,c);for(var a=0;a<g.length;a++)e.deleteQueryEXT(g[a]);c.length=0;g.length=0},restore:function(){c.length=0;g.length=0}}}},{}],21:[function(k,m,x){m.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(k,
m,x){function l(a){return Array.prototype.slice.call(a)}function a(a){return l(a).join("")}var u=k("./extend");m.exports=function(){function k(){var c=[],e=[];return u(function(){c.push.apply(c,l(arguments))},{def:function(){var a="v"+g++;e.push(a);0<arguments.length&&(c.push(a,"="),c.push.apply(c,l(arguments)),c.push(";"));return a},toString:function(){return a([0<e.length?"var "+e+";":"",a(c)])}})}function e(){function a(g,h){e(g,h,"=",c.def(g,h),";")}var c=k(),e=k(),g=c.toString,m=e.toString;return u(function(){c.apply(c,
l(arguments))},{def:c.def,entry:c,exit:e,save:a,set:function(e,g,l){a(e,g);c(e,g,"=",l,";")},toString:function(){return g()+m()}})}var g=0,c=[],m=[],D=k(),G={};return{global:D,link:function(a){for(var e=0;e<m.length;++e)if(m[e]===a)return c[e];e="g"+g++;c.push(e);m.push(a);return e},block:k,proc:function(c,f){function g(){var a="a"+l.length;l.push(a);return a}var l=[];f=f||0;for(var k=0;k<f;++k)g();var k=e(),n=k.toString;return G[c]=u(k,{arg:g,toString:function(){return a(["function(",l.join(),"){",
n(),"}"])}})},scope:e,cond:function(){var c=a(arguments),g=e(),k=e(),m=g.toString,t=k.toString;return u(g,{then:function(){g.apply(g,l(arguments));return this},"else":function(){k.apply(k,l(arguments));return this},toString:function(){var e=t();e&&(e="else{"+e+"}");return a(["if(",c,"){",m(),"}",e])}})},compile:function(){var e=['"use strict";',D,"return {"];Object.keys(G).forEach(function(a){e.push('"',a,'":',G[a].toString(),",")});e.push("}");var g=a(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,
"{\n");return Function.apply(null,c.concat(g)).apply(null,m)}}}},{"./extend":23}],23:[function(k,m,x){m.exports=function(k,a){for(var m=Object.keys(a),y=0;y<m.length;++y)k[m[y]]=a[m[y]];return k}},{}],24:[function(k,m,x){var l=k("./is-typed-array");m.exports=function(a){return Array.isArray(a)||l(a)}},{"./is-typed-array":26}],25:[function(k,m,x){var l=k("./is-typed-array");m.exports=function(a){return!!a&&"object"===typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"===typeof a.offset&&
a.shape.length===a.stride.length&&(Array.isArray(a.data)||l(a.data))}},{"./is-typed-array":26}],26:[function(k,m,x){var l=k("../constants/arraytypes.json");m.exports=function(a){return Object.prototype.toString.call(a)in l}},{"../constants/arraytypes.json":4}],27:[function(k,m,x){m.exports=function(k,a){for(var m=Array(k),y=0;y<k;++y)m[y]=a(y);return m}},{}],28:[function(k,m,x){function l(a){var g,c;g=(65535<a)<<4;a>>>=g;c=(255<a)<<3;a>>>=c;g|=c;c=(15<a)<<2;a>>>=c;g|=c;c=(3<a)<<1;return g|c|a>>>c>>
1}function a(a){a:{for(var g=16;268435456>=g;g*=16)if(a<=g){a=g;break a}a=0}g=y[l(a)>>2];return 0<g.length?g.pop():new ArrayBuffer(a)}function u(a){y[l(a.byteLength)>>2].push(a)}var y=k("./loop")(8,function(){return[]});m.exports={alloc:a,free:u,allocType:function(e,g){var c=null;switch(e){case 5120:c=new Int8Array(a(g),0,g);break;case 5121:c=new Uint8Array(a(g),0,g);break;case 5122:c=new Int16Array(a(2*g),0,g);break;case 5123:c=new Uint16Array(a(2*g),0,g);break;case 5124:c=new Int32Array(a(4*g),
0,g);break;case 5125:c=new Uint32Array(a(4*g),0,g);break;case 5126:c=new Float32Array(a(4*g),0,g);break;default:return null}return c.length!==g?c.subarray(0,g):c},freeType:function(a){u(a.buffer)}}},{"./loop":27}],29:[function(k,m,x){m.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(k){return requestAnimationFrame(k)},cancel:function(k){return cancelAnimationFrame(k)}}:{next:function(k){return setTimeout(k,16)},cancel:clearTimeout}},{}],30:[function(k,
m,x){var l=k("./pool"),a=new Float32Array(1),u=new Uint32Array(a.buffer);m.exports=function(k){for(var e=l.allocType(5123,k.length),g=0;g<k.length;++g)if(isNaN(k[g]))e[g]=65535;else if(Infinity===k[g])e[g]=31744;else if(-Infinity===k[g])e[g]=64512;else{a[0]=k[g];var c=u[0],m=c>>>31<<15,D=(c<<1>>>24)-127,c=c>>13&1023;e[g]=-24>D?m:-14>D?m+(c+1024>>-14-D):15<D?m+31744:m+(D+15<<10)+c}return e}},{"./pool":28}],31:[function(k,m,x){m.exports=function(k){return Object.keys(k).map(function(a){return k[a]})}},
{}],32:[function(k,m,x){function l(a,c,k){function l(){var c=window.innerWidth,f=window.innerHeight;a!==document.body&&(f=a.getBoundingClientRect(),c=f.right-f.left,f=f.top-f.bottom);m.width=k*c;m.height=k*f;e(m.style,{width:c+"px",height:f+"px"})}var m=document.createElement("canvas");e(m.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(m);a===document.body&&(m.style.position="absolute",e(a.style,{margin:0,padding:0}));window.addEventListener("resize",l,!1);l();return{canvas:m,onDestroy:function(){window.removeEventListener("resize",
l);a.removeChild(m)}}}function a(a,c){function e(k){try{return a.getContext(k,c)}catch(l){return null}}return e("webgl")||e("experimental-webgl")||e("webgl-experimental")}function u(a){return"string"===typeof a?a.split():a}function y(a){return"string"===typeof a?document.querySelector(a):a}var e=k("./util/extend");m.exports=function(e){var c=e||{},k,m,x,C;e={};var f=[],I=[],w="undefined"===typeof window?1:window.devicePixelRatio,H=!1,n=function(a){},h=function(){};"string"===typeof c?k=document.querySelector(c):
"object"===typeof c&&("string"===typeof c.nodeName&&"function"===typeof c.appendChild&&"function"===typeof c.getBoundingClientRect?k=c:"function"===typeof c.drawArrays||"function"===typeof c.drawElements?(C=c,x=C.canvas):("gl"in c?C=c.gl:"canvas"in c?x=y(c.canvas):"container"in c&&(m=y(c.container)),"attributes"in c&&(e=c.attributes),"extensions"in c&&(f=u(c.extensions)),"optionalExtensions"in c&&(I=u(c.optionalExtensions)),"onDone"in c&&(n=c.onDone),"profile"in c&&(H=!!c.profile),"pixelRatio"in c&&
(w=+c.pixelRatio)));k&&("canvas"===k.nodeName.toLowerCase()?x=k:m=k);if(!C){if(!x){k=l(m||document.body,n,w);if(!k)return null;x=k.canvas;h=k.onDestroy}C=a(x,e)}return C?{gl:C,canvas:x,container:m,extensions:f,optionalExtensions:I,pixelRatio:w,profile:H,onDone:n,onDestroy:h}:(h(),n("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/extend":23}],33:[function(k,m,x){m.exports=function(a,k){function m(a){var b=!1;"altKey"in a&&(b=b||a.altKey!==
h.alt,h.alt=!!a.altKey);"shiftKey"in a&&(b=b||a.shiftKey!==h.shift,h.shift=!!a.shiftKey);"ctrlKey"in a&&(b=b||a.ctrlKey!==h.control,h.control=!!a.ctrlKey);"metaKey"in a&&(b=b||a.metaKey!==h.meta,h.meta=!!a.metaKey);return b}function e(a,b){var c=l.x(b),e=l.y(b);"buttons"in b&&(a=b.buttons|0);if(a!==w||c!==H||e!==n||m(b))w=a|0,H=c||0,n=e||0,k&&k(w,H,n,h)}function g(a){e(0,a)}function c(){if(w||H||n||h.shift||h.alt||h.meta||h.control)w=H=n=0,h.shift=h.alt=h.control=h.meta=!1,k&&k(0,0,0,h)}function t(a){m(a)&&
k&&k(w,H,n,h)}function x(a){0===l.buttons(a)?e(0,a):e(w,a)}function G(a){e(w|l.buttons(a),a)}function C(a){e(w&~l.buttons(a),a)}function f(){J||(J=!0,a.addEventListener("mousemove",x),a.addEventListener("mousedown",G),a.addEventListener("mouseup",C),a.addEventListener("mouseleave",g),a.addEventListener("mouseenter",g),a.addEventListener("mouseout",g),a.addEventListener("mouseover",g),a.addEventListener("blur",c),a.addEventListener("keyup",t),a.addEventListener("keydown",t),a.addEventListener("keypress",
t),a!==window&&(window.addEventListener("blur",c),window.addEventListener("keyup",t),window.addEventListener("keydown",t),window.addEventListener("keypress",t)))}function I(){J&&(J=!1,a.removeEventListener("mousemove",x),a.removeEventListener("mousedown",G),a.removeEventListener("mouseup",C),a.removeEventListener("mouseleave",g),a.removeEventListener("mouseenter",g),a.removeEventListener("mouseout",g),a.removeEventListener("mouseover",g),a.removeEventListener("blur",c),a.removeEventListener("keyup",
t),a.removeEventListener("keydown",t),a.removeEventListener("keypress",t),a!==window&&(window.removeEventListener("blur",c),window.removeEventListener("keyup",t),window.removeEventListener("keydown",t),window.removeEventListener("keypress",t)))}k||(k=a,a=window);var w=0,H=0,n=0,h={shift:!1,alt:!1,control:!1,meta:!1},J=!1;f();var F={element:a};Object.defineProperties(F,{enabled:{get:function(){return J},set:function(a){a?f():I},enumerable:!0},buttons:{get:function(){return w},enumerable:!0},x:{get:function(){return H},
enumerable:!0},y:{get:function(){return n},enumerable:!0},mods:{get:function(){return h},enumerable:!0}});return F};var l=k("mouse-event")},{"mouse-event":34}],34:[function(k,m,x){function l(a){return a.target||a.srcElement||window}x.buttons=function(a){if("object"===typeof a){if("buttons"in a)return a.buttons;if("which"in a){a=a.which;if(2===a)return 4;if(3===a)return 2;if(0<a)return 1<<a-1}else if("button"in a){a=a.button;if(1===a)return 4;if(2===a)return 2;if(0<=a)return 1<<a}}return 0};x.element=
l;x.x=function(a){if("object"===typeof a){if("offsetX"in a)return a.offsetX;var k=l(a).getBoundingClientRect();return a.clientX-k.left}return 0};x.y=function(a){if("object"===typeof a){if("offsetY"in a)return a.offsetY;var k=l(a).getBoundingClientRect();return a.clientY-k.top}return 0}},{}],35:[function(k,m,x){function l(a,c){for(var e=0;e<a.length;++e)if(a[e]===c)return e;return-1}var a=k("./lib/util/extend"),u=k("./lib/dynamic"),y=k("./lib/util/raf"),e=k("./lib/util/clock"),g=k("./lib/strings"),
c=k("./lib/webgl"),t=k("./lib/extension"),D=k("./lib/limits"),G=k("./lib/buffer"),C=k("./lib/elements"),f=k("./lib/texture"),I=k("./lib/renderbuffer"),w=k("./lib/framebuffer"),H=k("./lib/attribute"),n=k("./lib/shader"),h=k("./lib/read"),J=k("./lib/core"),F=k("./lib/stats"),q=k("./lib/timer");m.exports=function(b){function k(){if(0===P.length)E&&E.update(),ba=null;else{ba=y.next(k);L();for(var a=P.length-1;0<=a;--a){var b=P[a];b&&b(Q,null,0)}p.flush();E&&E.update()}}function m(){!ba&&0<P.length&&(ba=
y.next(k))}function x(){ba&&(y.cancel(k),ba=null)}function Ga(a){a.preventDefault();x();T.forEach(function(a){a()})}function ya(a){p.getError();aa.restore();ea.restore();da.restore();X.restore();ra.restore();pa.restore();E&&E.restore();M.procs.refresh();m();Y.forEach(function(a){a()})}function U(b){function c(a){var b={},d={};Object.keys(a).forEach(function(c){var e=a[c];u.isDynamic(e)?d[c]=u.unbox(e,c):b[c]=e});return{dynamic:d,"static":b}}function e(a){for(;n.length<a;)n.push(null);return n}var f=
c(b.context||{}),g=c(b.uniforms||{}),h=c(b.attributes||{}),k=c(function(b){function c(a){if(a in d){var b=d[a];delete d[a];Object.keys(b).forEach(function(c){d[a+"."+c]=b[c]})}}var d=a({},b);delete d.uniforms;delete d.attributes;delete d.context;"stencil"in d&&d.stencil.op&&(d.stencil.opBack=d.stencil.opFront=d.stencil.op,delete d.stencil.op);c("blend");c("depth");c("cull");c("stencil");c("polygonOffset");c("scissor");c("sample");return d}(b));b={gpuTime:0,cpuTime:0,count:0};var f=M.compile(k,h,g,
f,b),l=f.draw,d=f.batch,m=f.scope,n=[];return a(function(a,b){var c;if("function"===typeof a)return m.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(c=0;c<a;++c)m.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)m.call(this,a[c],b,c);else return m.call(this,a,b,0);else if("number"===typeof a){if(0<a)return d.call(this,e(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return d.call(this,a,a.length)}else return l.call(this,a)},{stats:b})}function ma(a){P.push(a);
m();return{cancel:function(){function b(){var a=l(P,b);P[a]=P[P.length-1];--P.length;0>=P.length&&x()}var c=l(P,a);P[c]=b}}}function O(){var a=fa.viewport,b=fa.scissor_box;a[0]=a[1]=b[0]=b[1]=0;Q.viewportWidth=Q.framebufferWidth=Q.drawingBufferWidth=a[2]=b[2]=p.drawingBufferWidth;Q.viewportHeight=Q.framebufferHeight=Q.drawingBufferHeight=a[3]=b[3]=p.drawingBufferHeight}function L(){Q.tick+=1;Q.time=sa();O();M.procs.poll()}function na(){O();M.procs.refresh();E&&E.update()}function sa(){return(e()-
wa)/1E3}b=c(b);if(!b)return null;var p=b.gl,R=p.getContextAttributes();p.isContextLost();var aa=t(p,b);if(!aa)return null;var ha=g(),W=F(),N=aa.extensions,E=q(p,N),wa=e(),oa=p.drawingBufferWidth,xa=p.drawingBufferHeight,Q={tick:0,time:0,viewportWidth:oa,viewportHeight:xa,framebufferWidth:oa,framebufferHeight:xa,drawingBufferWidth:oa,drawingBufferHeight:xa,pixelRatio:b.pixelRatio},ca=D(p,N),da=G(p,W,b),qa=C(p,N,da,W),oa=H(p,N,ca,da,ha),ea=n(p,ha,W,b),X=f(p,N,ca,function(){M.procs.poll()},Q,W,b),ra=
I(p,N,ca,W,b),pa=w(p,N,ca,X,ra,W),M=J(p,ha,N,ca,da,qa,X,pa,{},oa,ea,{elements:null,primitive:4,count:-1,offset:0,instances:-1},Q,E,b),ha=h(p,pa,M.procs.poll,Q,R,N),fa=M.next,ja=p.canvas,P=[],T=[],Y=[],Z=[b.onDestroy],ba=null;ja&&(ja.addEventListener("webglcontextlost",Ga,!1),ja.addEventListener("webglcontextrestored",ya,!1));na();R=a(U,{clear:function(a){var b=0;M.procs.poll();var c=a.color;c&&(p.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(p.clearDepth(+a.depth),b|=256);
"stencil"in a&&(p.clearStencil(a.stencil|0),b|=1024);p.clear(b)},prop:u.define.bind(null,1),context:u.define.bind(null,2),"this":u.define.bind(null,3),draw:U({}),buffer:function(a){return da.create(a,34962,!1,!1)},elements:function(a){return qa.create(a,!1)},texture:X.create2D,cube:X.createCube,renderbuffer:ra.create,framebuffer:pa.create,framebufferCube:pa.createCube,attributes:R,frame:ma,on:function(a,b){var c;switch(a){case "frame":return ma(b);case "lost":c=T;break;case "restore":c=Y;break;case "destroy":c=
Z}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:ca,hasExtension:function(a){return 0<=ca.extensions.indexOf(a.toLowerCase())},read:ha,destroy:function(){P.length=0;x();ja&&(ja.removeEventListener("webglcontextlost",Ga),ja.removeEventListener("webglcontextrestored",ya));ea.clear();pa.clear();ra.clear();X.clear();qa.clear();da.clear();E&&E.clear();Z.forEach(function(a){a()})},_gl:p,_refresh:na,poll:function(){L();E&&E.update()},
now:sa,stats:W});b.onDone(null,R);return R}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},{},[1]);
