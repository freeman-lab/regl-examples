<!DOCTYPE html>
      <html>
        <head>
          <title>example/graph.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(l,n,k){function a(b,f){if(!n[b]){if(!l[b]){var h="function"==typeof require&&require;if(!f&&h)return h(b,!0);if(c)return c(b,!0);h=Error("Cannot find module '"+b+"'");throw h.code="MODULE_NOT_FOUND",h;}h=n[b]={exports:{}};l[b][0].call(h.exports,function(c){var f=l[b][1][c];return a(f?f:c)},h,h.exports,e$$0,l,n,k)}return n[b].exports}for(var c="function"==typeof require&&require,h=0;h<k.length;h++)a(k[h]);return a})({1:[function(e,l,n){function k(a){return[a%64,a/64|0]}function a(a){var b=
a.tick;E({framebuffer:B[0]},function(){c.clear({color:[0,0,0,1]});d();C({vertexState:u[(b+1)%2].color[0]})});for(a=0;4>a;++a)F({dest:B[(a+1)%2],src:B[a%2],axis:a%2});K({dest:B[1],src:B[0].color[0]});p({dest:u[(b+1)%2],src:u[b%2].color[0]});v({dest:u[b%2],src:u[(b+1)%2].color[0],field:B[1].color[0]})}var c=e("../regl")(),h=e("mouse-change")();e=.5/64;var b=new Float32Array(16384),f=new Float32Array(8192);(function(){for(var a=0;64>a;++a)for(var c=0;64>c;++c){var q=64*a+c;f[2*q]=a/64;f[2*q+1]=c/64;
b[4*q]=Math.random();b[4*q+1]=Math.random()}})();l=c.buffer(f);var u=[c.framebuffer({color:c.texture({radius:64,data:b,type:"float"}),depthStencil:!1}),c.framebuffer({radius:64,colorType:"float",depthStencil:!1})],t=[];(function(){for(var a=0;64>a;++a)for(var b=0;64>b;++b){if(63>a){var c=a+64*b,f=a+1+64*b;t.push([c,f],[f,c])}63>b&&(c=a+64*b,f=a+64*(b+1),t.push([c,f],[f,c]))}})();var B=[c.framebuffer({color:c.texture({type:"float",wrap:"repeat",radius:1024}),depthStencil:!1}),c.framebuffer({color:c.texture({type:"float",
wrap:"repeat",radius:1024}),depthStencil:!1})],E=c({framebuffer:c.prop("framebuffer")}),C=c({vert:"\n  precision highp float;\n  attribute vec2 id;\n  uniform sampler2D vertexState;\n  void main () {\n    vec4 state = texture2D(vertexState, id);\n    gl_Position = vec4(2.0 * fract(state.xy) - 1.0, 0, 1);\n  }",frag:"\n  precision highp float;\n  void main () {\n    gl_FragColor = vec4(1, 0, 0, 0);\n  }",attributes:{id:l},uniforms:{vertexState:c.prop("vertexState")},blend:{enable:!0,func:{src:1,dst:1},
equation:"add"},depth:{enable:!1,mask:!1},primitive:"points",count:4096,elements:null}),F=c({framebuffer:c.prop("dest"),vert:"\n  precision highp float;\n  attribute vec2 p;\n  varying vec2 uv;\n  void main () {\n    uv = 0.5 * (p + 1.0);\n    gl_Position = vec4(p, 0, 1);\n  }",frag:"\n  precision highp float;\n  uniform sampler2D src;\n  uniform vec2 axis;\n  varying vec2 uv;\n  void main () {\n    float f = 0.0;\n    for (int i = -16; i <= 16; ++i) {\n      f += (17.0 - abs(float(i))) / 33.0 *\n          texture2D(src, axis * float(i) + uv).r;\n    }\n    gl_FragColor = vec4(f, 0, 0, 1);\n  }",
attributes:{p:[-4,0,4,4,4,-4]},uniforms:{src:function(a,b){return b.src.color[0]},axis:function(a,b){var c=[0,0];c[b.axis]=1/1024;return c}},depth:{enable:!1,mask:!1},count:3}),K=c({framebuffer:c.prop("dest"),vert:"\n  precision highp float;\n  attribute vec2 p;\n  varying vec2 uv;\n  void main () {\n    uv = 0.5 * (p + 1.0);\n    gl_Position = vec4(p, 0, 1);\n  }",frag:"\n  precision highp float;\n  uniform sampler2D src;\n  uniform vec2 deriv;\n  varying vec2 uv;\n  void main () {\n    float f01 = texture2D(src, uv - vec2(deriv.x, 0)).x;\n    float f21 = texture2D(src, uv + vec2(deriv.x, 0)).x;\n    float f10 = texture2D(src, uv - vec2(0, deriv.y)).x;\n    float f12 = texture2D(src, uv + vec2(0, deriv.y)).x;\n    gl_FragColor = vec4(f21 - f01, f12 - f10, 0, 1);\n  }",
attributes:{p:[-4,0,4,4,4,-4]},uniforms:{src:c.prop("src"),deriv:function(a,b){return[1/b.src.width,1/b.src.height]}},depth:{enable:!1,mask:!1},count:3}),p=c({framebuffer:c.prop("dest"),vert:"\n  precision highp float;\n  attribute vec4 edge;\n  varying vec2 force;\n  uniform sampler2D vertexState;\n  uniform float restLength, stiffness;\n  void main () {\n    vec4 s0 = texture2D(vertexState, edge.rg);\n    vec4 s1 = texture2D(vertexState, edge.ba);\n    vec2 d = s1.xy - s0.xy;\n    float l = max(length(d), 0.001);\n    force = stiffness * log(l / restLength) * d / l;\n    gl_Position = vec4(2.0 * edge.xy - 1.0 + 1.0 / 64.0, 0, 1);\n  }",
frag:"\n  precision highp float;\n  varying vec2 force;\n  void main () {\n    gl_FragColor = vec4(0, 0, force);\n  }",attributes:{edge:t.map(function(a){var b=k(a[0]);a=k(a[1]);return[b[0]/64,b[1]/64,a[0]/64,a[1]/64]})},uniforms:{vertexState:c.prop("src"),restLength:e,stiffness:.08},blend:{enable:!0,func:{src:1,dst:1},equation:"add"},depth:{enable:!1,mask:!1},count:t.length,primitive:"points"}),v=c({framebuffer:c.prop("dest"),vert:"\n  precision highp float;\n  attribute vec2 p;\n  varying vec2 id;\n  void main () {\n    id = 0.5 * (p + 1.0);\n    gl_Position = vec4(p, 0, 1);\n  }",
frag:"\n  precision highp float;\n  uniform sampler2D vertexState, field;\n  uniform float temperature, t;\n  varying vec2 id;\n\n  float rnd (vec2 co) {\n  \treturn fract(sin(t*0.1+dot(co.xy, vec2(12.9898,78.233))) * 43758.5453);\n  }\n\n  void main () {\n    vec4 state = texture2D(vertexState, id);\n    vec2 p = state.rg;\n    vec2 v = state.ba;\n    vec2 force = texture2D(field, p).xy;\n    p += 1.0E-4 * v;\n    v = float(0.98) * (v - float(0.05) * force);\n    vec2 jitter = vec2(rnd(id), rnd(id + 1000.0)) - 0.5;\n    gl_FragColor = vec4(p + temperature * jitter, v);\n  }",
attributes:{p:[-4,0,4,-4,4,4]},uniforms:{vertexState:c.prop("src"),field:c.prop("field"),temperature:function(a){return 1/(.5*a.tick+20)},t:c.context("tick")},count:3}),A=c({vert:"\n  precision highp float;\n  attribute vec2 id;\n  uniform sampler2D vertexState;\n  void main () {\n    vec4 state = texture2D(vertexState, id);\n    gl_PointSize = 2.0;\n    gl_Position = vec4(2.0 * fract(state.xy) - 1.0, 0, 1);\n  }",frag:"\n  precision highp float;\n  void main () {\n    gl_FragColor = vec4(0, 0, 0, 1);\n  }",
attributes:{id:l},uniforms:{vertexState:function(a){return u[a.tick%2].color[0]}},depth:{enable:!1,mask:!1},primitive:"points",count:4096,elements:null}),m=c({vert:"\n  precision highp float;\n  attribute vec4 id;\n  attribute float arcDir;\n  uniform float dir;\n  uniform sampler2D vertexState;\n  void main () {\n    float side = arcDir + dir - 2.0 * dir * arcDir;\n    vec2 s0 = texture2D(vertexState, id.rg).xy;\n    vec2 s1 = texture2D(vertexState, id.ba).xy;\n    vec2 shift = mix(fract(s0) - s0, fract(s1) - s1, side);\n    gl_Position = vec4(2.0 * (s0.xy + shift) - 1.0, 0, 1);\n  }",
frag:"\n  void main () {\n    gl_FragColor = vec4(0.1, 0, 1, 1);\n  }",attributes:{id:t.map(function(a){var b=k(a[0]);a=k(a[1]);return[b[0]/64,b[1]/64,a[0]/64,a[1]/64]}),arcDir:t.map(function(a,b){return b%2})},uniforms:{vertexState:function(a){return u[a.tick%2].color[0]},dir:c.prop("dir")},depth:{enable:!1,mask:!1},count:t.length,primitive:"lines",lineWidth:2}),d=c({vert:"\n  uniform vec2 mouse;\n  attribute float p;\n  void main () {\n    gl_PointSize = 32.0;\n    gl_Position = vec4(mouse, p, 1);\n  }",
frag:"\n  precision highp float;\n  uniform float strength;\n  void main () {\n    float s = strength * exp(-16.0 * dot(gl_PointCoord.xy, gl_PointCoord.xy));\n    gl_FragColor = vec4(s, 0, 0, 1);\n  }",attributes:{p:[0]},uniforms:{mouse:function(a){var b=a.pixelRatio;return[2*b*h.x/a.drawingBufferWidth-1,1-2*b*h.y/a.drawingBufferHeight]},strength:function(){return h.buttons?5:1}},count:1,primitive:"points"});c.frame(function(b){c.updateTimer();a(b);c.clear({color:[1,1,1,1]});m([{dir:0},{dir:1}]);
A()})},{"../regl":35,"mouse-change":33}],2:[function(e,l,n){function k(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}l.exports=function(a,c,h,b,f){a=h.maxAttributes;c=Array(a);for(h=0;h<a;++h)c[h]=new k;return{Record:k,scope:{},state:c}}},{}],3:[function(e,l,n){function k(a){return B[Object.prototype.toString.call(a)]|0}function a(a,b){for(var c=0;c<b.length;++c)a[c]=b[c]}function c(a,b,c,f,h,k,d){for(var e=
0,y=0;y<c;++y)for(var q=0;q<f;++q)a[e++]=b[h*y+k*q+d]}function h(a,b,c){for(var f=0,h=0;h<b.length;++h)for(var k=b[h],d=0;d<c;++d)a[f++]=k[d]}var b=e("./util/is-typed-array"),f=e("./util/is-ndarray"),u=e("./util/values"),t=e("./util/pool"),B=e("./constants/arraytypes.json"),E=e("./constants/dtypes.json"),C=e("./constants/usage.json");l.exports=function(e,l){function p(a){this.id=d++;this.buffer=e.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121}function v(a,
b,c){a.byteLength=b.byteLength;e.bufferData(a.type,b,c)}function A(q,d,y,e,m){q.usage=y;if(Array.isArray(d))q.dtype=e||5126,0<d.length&&(Array.isArray(d[0])?(q.dimension=d[0].length,e=t.allocType(q.dtype,d.length*q.dimension),h(e,d,q.dimension),v(q,e,y),t.freeType(e)):"number"===typeof d[0]?(q.dimension=m,e=t.allocType(q.dtype,d.length),a(e,d),v(q,e,y),t.freeType(e)):b(d[0])&&(q.dimension=d[0].length,q.dtype=e||k(d[0])||5126,e=t.allocType(q.dtype,d.length*q.dimension),h(e,d,q.dimension),v(q,e,y),
t.freeType(e)));else if(b(d))q.dtype=e||k(d),q.dimension=m,v(q,d,y);else if(f(d)){var p=d.shape,J=d.stride;m=d.offset;var u=0,C=0,F=0,N=0;1===p.length?(u=p[0],C=1,F=J[0],N=0):2===p.length&&(u=p[0],C=p[1],F=J[0],N=J[1]);q.dtype=e||k(d.data)||5126;q.dimension=C;e=t.allocType(q.dtype,u*C);c(e,d.data,u,C,F,N,m);v(q,e,y);t.freeType(e)}}function m(a){l.bufferCount--;e.deleteBuffer(a.buffer);a.buffer=null;delete B[a.id]}var d=0,B={};p.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)};p.prototype.destroy=
function(){m(this)};var y=[];return{create:function(d,y,v){function u(a){var c=35044,d=null,h=0,q=0,k=1;Array.isArray(a)||b(a)||f(a)?d=a:"number"===typeof a?h=a|0:a&&("data"in a&&(d=a.data),"usage"in a&&(c=C[a.usage]),"type"in a&&(q=E[a.type]),"dimension"in a&&(k=a.dimension|0),"length"in a&&(h=a.length|0));n.bind();d?A(n,d,c,q,k):(e.bufferData(n.type,h,c),n.dtype=q||5121,n.usage=c,n.dimension=k,n.byteLength=h);return u}l.bufferCount++;var n=new p(y);B[n.id]=n;v||u(d);u._reglType="buffer";u._buffer=
n;u.subdata=function(d,q){var y=(q||0)|0;n.bind();if(Array.isArray(d)){if(0<d.length)if("number"===typeof d[0]){var m=t.allocType(n.dtype,d.length);a(m,d);e.bufferSubData(n.type,y,m);t.freeType(m)}else if(Array.isArray(d[0])||b(d[0])){var m=d[0].length,p=t.allocType(n.dtype,d.length*m);h(p,d,m);e.bufferSubData(n.type,y,p);t.freeType(p)}}else if(b(d))e.bufferSubData(n.type,y,d);else if(f(d)){var v=d.shape,C=d.stride,l=p=m=0,A=0;1===v.length?(m=v[0],p=1,l=C[0],A=0):2===v.length&&(m=v[0],p=v[1],l=C[0],
A=C[1]);v=Array.isArray(d.data)?n.dtype:k(d.data);v=t.allocType(v,m*p);c(v,d.data,m,p,l,A,d.offset);e.bufferSubData(n.type,y,v);t.freeType(v)}return u};u.destroy=function(){m(n)};return u},createStream:function(a,b){var d=y.pop();d||(d=new p(a),d.buffer=e.createBuffer());d.bind();A(d,b,35040,0,1);return d},destroyStream:function(a){y.push(a)},clear:function(){u(B).forEach(m)},getBuffer:function(a){return a&&a._buffer instanceof p?a._buffer:null},_initBuffer:A}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,
"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],4:[function(e,l,n){l.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(e,l,n){l.exports={int8:5120,int16:5122,int32:5124,uint8:5121,
uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(e,l,n){l.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(e,l,n){l.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(e,l,n){function k(a){return Array.isArray(a)||B(a)||E(a)}function a(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function c(a,b,d,c){this.thisDep=a;this.contextDep=
b;this.propDep=d;this.append=c}function h(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function b(a){return new c(!1,!1,!1,a)}function f(a,b){var d=a.type;return 0===d?(d=a.data.length,new c(!0,1<=d,2<=d,b)):new c(3===d,2===d,1===d,b)}var u=e("./util/codegen"),t=e("./util/loop"),B=e("./util/is-typed-array"),E=e("./util/is-ndarray"),C=e("./util/is-array-like"),F=e("./constants/primitives.json"),K=e("./constants/dtypes.json"),p=["x","y","z","w"],v={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,
"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},A={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},m={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,
"increment wrap":34055,"decrement wrap":34056,invert:5386},d={cw:2304,ccw:2305},T=new c(!1,!1,!1,function(){});l.exports=function(e,q,l,n,B,E,da,J,I,V,Z,N,ea,ka){function Q(a){return a.replace(".","_")}function L(a,g,b){var d=Q(a);za.push(a);xa[d]=r[d]=!!b;na[d]=g}function D(a,g,b){var d=Q(a);za.push(a);Array.isArray(b)?(r[d]=b.slice(),xa[d]=b.slice()):r[d]=xa[d]=b;oa[d]=g}function W(){var a=u(),g=a.link,b=a.global;a.id=Ka++;a.batchId="0";var d=g(Ha),c=a.shared={props:"a0"};Object.keys(Ha).forEach(function(a){c[a]=
b.def(d,".",a)});var H=a.next={},f=a.current={};Object.keys(oa).forEach(function(a){Array.isArray(r[a])&&(H[a]=b.def(c.next,".",a),f[a]=b.def(c.current,".",a))});var w=a.constants={};Object.keys(Aa).forEach(function(a){w[a]=b.def(JSON.stringify(Aa[a]))});a.invoke=function(w,b){switch(b.type){case 0:var d=["this",c.context,c.props,a.batchId];return w.def(g(b.data),".call(",d.slice(0,Math.max(b.data.length+1,4)),")");case 1:return w.def(c.props,b.data);case 2:return w.def(c.context,b.data);case 3:return w.def("this",
b.data)}};a.attribCache={};var Fa={};a.scopeAttrib=function(a){a=q.id(a);if(a in Fa)return Fa[a];var w=V.scope[a];w||(w=V.scope[a]=new la);return Fa[a]=g(w)};return a}function ha(a){var g=a["static"];a=a.dynamic;if("framebuffer"in g){var d=g.framebuffer;return d?(d=J.getFramebuffer(d),b(function(a,b){var g=a.link(d),w=a.shared;b.set(w.framebuffer,".next",g);w=w.context;b.set(w,".framebufferWidth",g+".width");b.set(w,".framebufferHeight",g+".height");return g})):b(function(a,g){var b=a.shared;g.set(b.framebuffer,
".next","null");b=b.context;g.set(b,".framebufferWidth",b+".drawingBufferWidth");g.set(b,".framebufferHeight",b+".drawingBufferHeight");return"null"})}if("framebuffer"in a){var c=a.framebuffer;return f(c,function(a,b){var g=a.invoke(b,c),w=a.shared,d=w.framebuffer,g=b.def(d,".getFramebuffer(",g,")");b.set(d,".next",g);w=w.context;b.set(w,".framebufferWidth",g+"?"+g+".width:"+w+".drawingBufferWidth");b.set(w,".framebufferHeight",g+"?"+g+".height:"+w+".drawingBufferHeight");return g})}return null}function pa(a,
b){function g(a){if(a in d){var x=d[a];a=!0;var Ia=x.x|0,H=x.y|0,h,ga;"width"in x?h=x.width|0:a=!1;"height"in x?ga=x.height|0:a=!1;return new c(!a&&b&&b.thisDep,!a&&b&&b.contextDep,!a&&b&&b.propDep,function(a,b){var w=a.shared.context,g=h;"width"in x||(g=b.def(w,".","framebufferWidth","-",Ia));var d=ga;"height"in x||(d=b.def(w,".","framebufferHeight","-",H));return[Ia,H,g,d]})}if(a in G){var e=G[a];a=f(e,function(a,b){var w=a.invoke(b,e),g=a.shared.context,d=b.def(w,".x|0"),x=b.def(w,".y|0"),c=b.def('"width" in ',
w,"?",w,".width|0:","(",g,".","framebufferWidth","-",d,")"),w=b.def('"height" in ',w,"?",w,".height|0:","(",g,".","framebufferHeight","-",x,")");return[d,x,c,w]});b&&(a.thisDep=a.thisDep||b.thisDep,a.contextDep=a.contextDep||b.contextDep,a.propDep=a.propDep||b.propDep);return a}return b?new c(b.thisDep,b.contextDep,b.propDep,function(a,b){var w=a.shared.context;return[0,0,b.def(w,".","framebufferWidth"),b.def(w,".","framebufferHeight")]}):null}var d=a["static"],G=a.dynamic,H=g("viewport");if(H)var h=
H,H=new c(H.thisDep,H.contextDep,H.propDep,function(a,b){var g=h.append(a,b),d=a.shared.context;b.set(d,".viewportWidth",g[2]);b.set(d,".viewportHeight",g[3]);return g});return{viewport:H,scissor_box:g("scissor.box")}}function sa(a){function g(a){if(a in d){var x=q.id(d[a]);a=b(function(){return x});a.id=x;return a}if(a in e){var c=e[a];return f(c,function(a,b){var g=a.invoke(b,c);return b.def(a.shared.strings,".id(",g,")")})}return null}var d=a["static"],e=a.dynamic,G=g("frag"),H=g("vert"),r=null;
h(G)&&h(H)?(r=Z.program(H.id,G.id),a=b(function(a,b){return a.link(r)})):a=new c(G&&G.thisDep||H&&H.thisDep,G&&G.contextDep||H&&H.contextDep,G&&G.propDep||H&&H.propDep,function(a,b){var g=a.shared.shader,d;d=G?G.append(a,b):b.def(g,".","frag");var x;x=H?H.append(a,b):b.def(g,".","vert");return b.def(g+".program("+x+","+d+")")});return{frag:G,vert:H,progVar:a,program:r}}function ia(a){function g(a,w){if(a in d){var x=d[a]|0;return b(function(a,b){w&&(a.OFFSET=x);return x})}if(a in e){var c=e[a];return f(c,
function(a,b){var g=a.invoke(b,c);w&&(a.OFFSET=g);return g})}return w&&G?b(function(a,b){a.OFFSET="0";return 0}):null}var d=a["static"],e=a.dynamic,G=function(){if("elements"in d){var a=d.elements;k(a)?a=E.getElements(E.create(a)):a&&(a=E.getElements(a));var g=b(function(b,g){if(a){var w=b.link(a);return b.ELEMENTS=w}return b.ELEMENTS=null});g.value=a;return g}if("elements"in e){var x=e.elements;return f(x,function(a,b){var g=a.shared,w=g.isBufferArgs,g=g.elements,d=a.invoke(b,x),c=b.def("null"),
w=b.def(w,"(",d,")"),d=a.cond(w).then(c,"=",g,".createStream(",d,");")["else"](c,"=",g,".getElements(",d,");");b.entry(d);b.exit(a.cond(w).then(g,".destroyStream(",c,");"));return a.ELEMENTS=c})}return null}(),H=g("offset",!0);return{elements:G,primitive:function(){if("primitive"in d){var a=d.primitive;return b(function(b,g){return F[a]})}if("primitive"in e){var g=e.primitive;return f(g,function(a,b){var d=a.constants.primTypes,x=a.invoke(b,g);return b.def(d,"[",x,"]")})}return G?h(G)?G.value?b(function(a,
b){return b.def(a.ELEMENTS,".primType")}):b(function(){return 4}):new c(G.thisDep,G.contextDep,G.propDep,function(a,b){var g=a.ELEMENTS;return b.def(g,"?",g,".primType:",4)}):null}(),count:function(){if("count"in d){var a=d.count|0;return b(function(){return a})}if("count"in e){var g=e.count;return f(g,function(a,b){return a.invoke(b,g)})}return G?h(G)?G?H?new c(H.thisDep,H.contextDep,H.propDep,function(a,b){return b.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):b(function(a,b){return b.def(a.ELEMENTS,
".vertCount")}):b(function(){return-1}):new c(G.thisDep||H.thisDep,G.contextDep||H.contextDep,G.propDep||H.propDep,function(a,b){var g=a.ELEMENTS;return a.OFFSET?b.def(g,"?",g,".vertCount-",a.OFFSET,":-1"):b.def(g,"?",g,".vertCount:-1")}):null}(),instances:g("instances",!1),offset:H}}function qa(a){var g=a["static"],c=a.dynamic,h={};za.forEach(function(a){function x(w,d){if(a in g){var H=w(g[a]);h[e]=b(function(){return H})}else if(a in c){var r=c[a];h[e]=f(r,function(a,b){return d(a,b,a.invoke(b,
r))})}}var e=Q(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return x(function(a){return a},function(a,b,g){return g});case "depth.func":return x(function(a){return A[a]},function(a,b,g){return b.def(a.constants.compareFuncs,"[",g,"]")});case "depth.range":return x(function(a){return a},function(a,b,g){a=b.def("+",g,"[0]");b=b.def("+",
g,"[1]");return[a,b]});case "blend.func":return x(function(a){return[v["srcRGB"in a?a.srcRGB:a.src],v["dstRGB"in a?a.dstRGB:a.dst],v["srcAlpha"in a?a.srcAlpha:a.src],v["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,b,g){function d(a,w){var c=b.def('"',a,w,'" in ',g,"?",g,".",a,w,":",g,".",a);return b.def(x,"[",c,"]")}var x=a.constants.blendFuncs;a=d("src","RGB");var c=d("src","Alpha"),ra=d("dst","RGB"),f=d("dst","Alpha");return[a,ra,c,f]});case "blend.equation":return x(function(a){if("string"===typeof a)return[aa[a],
aa[a]];if("object"===typeof a)return[aa[a.rgb],aa[a.alpha]]},function(a,b,g){var d=a.constants.blendEquations,x=b.def(),c=b.def();a=a.cond("typeof ",g,'==="string"');a.then(x,"=",c,"=",d,"[",g,"];");a["else"](x,"=",d,"[",g,".rgb];",c,"=",d,"[",g,".alpha];");b(a);return[x,c]});case "blend.color":return x(function(a){return t(4,function(b){return+a[b]})},function(a,b,g){return t(4,function(a){return b.def("+",g,"[",a,"]")})});case "stencil.mask":return x(function(a){return a|0},function(a,b,g){return b.def(g,
"|0")});case "stencil.func":return x(function(a){return[A[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,b,g){a=b.def('"cmp" in ',g,"?",a.constants.compareFuncs,"[",g,".cmp]",":",7680);var d=b.def(g,".ref|0");b=b.def('"mask" in ',g,"?",g,".mask|0:-1");return[a,d,b]});case "stencil.opFront":case "stencil.opBack":return x(function(b){return["stencil.opBack"===a?1029:1028,m[b.fail||"keep"],m[b.zfail||"keep"],m[b.pass||"keep"]]},function(b,g,d){function x(a){return g.def('"',a,'" in ',d,"?",
c,"[",d,".",a,"]:",7680)}var c=b.constants.stencilOps;return["stencil.opBack"===a?1029:1028,x("fail"),x("zfail"),x("pass")]});case "polygonOffset.offset":return x(function(a){return[a.factor|0,a.units|0]},function(a,b,g){a=b.def(g,".factor|0");b=b.def(g,".units|0");return[a,b]});case "cull.face":return x(function(a){var b=0;"front"===a?b=1028:"back"===a&&(b=1029);return b},function(a,b,g){return b.def(g,'==="front"?',1028,":",1029)});case "lineWidth":return x(function(a){return a},function(a,b,g){return g});
case "frontFace":return x(function(a){return d[a]},function(a,b,g){return b.def(g+'==="cw"?2304:2305')});case "colorMask":return x(function(a){return a.map(function(a){return!!a})},function(a,b,g){return t(4,function(a){return"!!"+g+"["+a+"]"})});case "sample.coverage":return x(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,b,g){a=b.def('"value" in ',g,"?+",g,".value:1");b=b.def("!!",g,".invert");return[a,b]})}});return h}function ma(a){var g=a["static"],d=a.dynamic,c={};Object.keys(g).forEach(function(a){var d=
g[a],x;"number"===typeof d||"boolean"===typeof d?x=b(function(){return d}):"function"!==typeof d||"texture2d"!==d._reglType&&"textureCube"!==d._reglType?C(d)&&(x=b(function(a){return a.global.def("[",t(d.length,function(a){return d[a]}),"]")})):x=b(function(a){return a.link(d)});x.value=d;c[a]=x});Object.keys(d).forEach(function(a){var b=d[a];c[a]=f(b,function(a,g){return a.invoke(g,b)})});return c}function X(a){var g=a["static"],d=a.dynamic,c={};Object.keys(g).forEach(function(a){var d=g[a],x=q.id(a),
w=new la;if(k(d))w.state=1,w.buffer=B.getBuffer(B.create(d,34962,!1)),w.type=w.buffer.dtype;else{var f=B.getBuffer(d);if(f)w.state=1,w.buffer=f,w.type=f.dtype;else if(d.constant){var h=d.constant;w.state=2;"number"===typeof h?w.x=h:p.forEach(function(a,b){b<h.length&&(w[a]=h[b])})}else{var f=B.getBuffer(d.buffer),e=d.offset|0,r=d.stride|0,ga=d.size|0,z=!!d.normalized,m=0;"type"in d&&(m=K[d.type]);d=d.divisor|0;w.buffer=f;w.state=1;w.size=ga;w.normalized=z;w.type=m||f.dtype;w.offset=e;w.stride=r;w.divisor=
d}}c[a]=b(function(a,b){var g=a.attribCache;if(x in g)return g[x];var d={isStream:!1};Object.keys(w).forEach(function(a){d[a]=w[a]});w.buffer&&(d.buffer=a.link(w.buffer));return g[x]=d})});Object.keys(d).forEach(function(a){var b=d[a];c[a]=f(b,function(a,g){function d(a){g(h[a],"=",x,".",a,"|0;")}var x=a.invoke(g,b),c=a.shared,ra=c.isBufferArgs,f=c.buffer,h={isStream:g.def(!1)},e=new la;e.state=1;Object.keys(e).forEach(function(a){h[a]=g.def(""+e[a])});var r=h.buffer,ga=h.type;g("if(",ra,"(",x,")){",
h.isStream,"=true;",r,"=",f,".createStream(",34962,",",x,");",ga,"=",r,".dtype;","}else{",r,"=",f,".getBuffer(",x,");","if(",r,"){",ga,"=",r,".dtype;","}else if(",x,".constant){",h.state,"=",2,";",p.map(function(a,b){return h[a]+"="+x+".length>="+b+"?"+x+"["+b+"]:0;"}).join(""),"}else{",r,"=",f,".getBuffer(",x,".buffer);",ga,'="type" in ',x,"?",c.glTypes,"[",x,".type]:",r,".dtype;",h.normalized,"=!!",x,".normalized;");d("size");d("offset");d("stride");d("divisor");g("}}");return h})});return c}function fa(a){var g=
a["static"],d=a.dynamic,c={};Object.keys(g).forEach(function(a){var d=g[a];c[a]=b(function(a,b){return"number"===typeof d||"boolean"===typeof d?""+d:a.link(d)})});Object.keys(d).forEach(function(a){var b=d[a];c[a]=f(b,function(a,g){return a.invoke(g,b)})});return c}function M(a,b,g){var d=a.shared.context,c=a.scope();Object.keys(g).forEach(function(f){b.save(d,"."+f);c(d,".",f,"=",g[f].append(a,b),";")});b(c)}function R(a,b,g){var d=a.shared,c=d.gl,f=d.framebuffer,h;z&&(h=b.def(d.extensions,".webgl_draw_buffers"));
var e=a.constants,d=e.drawBuffer,e=e.backBuffer;a=g?g.append(a,b):b.def(f,".next");b("if(",f,".dirty||",a,"!==",f,".cur){","if(",a,"){",c,".bindFramebuffer(",36160,",",a,".framebuffer);");z&&b(h,".drawBuffersWEBGL(",d,"[",a,".colorAttachments.length]);");b("}else{",c,".bindFramebuffer(",36160,",null);");z&&b(h,".drawBuffersWEBGL(",e,");");b("}",f,".cur=",a,";",f,".dirty=false;","}")}function O(a,b,g){var d=a.shared,c=d.gl,f=a.current,h=a.next,e=d.current,k=d.next,z=a.cond(e,".dirty");za.forEach(function(b){b=
Q(b);if(!(b in g.state)){var d,ra;if(b in h){d=h[b];ra=f[b];var m=t(r[b].length,function(a){return z.def(d,"[",a,"]")});z(a.cond(m.map(function(a,b){return a+"!=="+ra+"["+b+"]"}).join("||")).then(c,".",oa[b],"(",m,");",m.map(function(a,b){return ra+"["+b+"]="+a}).join(";"),";"))}else d=z.def(k,".",b),m=a.cond(d,"!==",e,".",b),z(m),b in na?m(a.cond(d).then(c,".enable(",na[b],");")["else"](c,".disable(",na[b],");"),e,".",b,"=",d,";"):m(c,".",oa[b],"(",d,");",e,".",b,"=",d,";")}});0===Object.keys(g.state).length&&
z(e,".dirty=false;");b(z)}function P(b,g,d,c){var f=b.shared,e=b.current,r=f.current,w=f.gl;a(Object.keys(d)).forEach(function(a){var f=d[a];if(!c||c(f)){var k=f.append(b,g);if(na[a]){var z=na[a];h(f)?k?g(w,".enable(",z,");"):g(w,".disable(",z,");"):g(b.cond(k).then(w,".enable(",z,");")["else"](w,".disable(",z,");"));g(r,".",a,"=",k,";")}else if(C(k)){var m=e[a];g(w,".",oa[a],"(",k,");",k.map(function(a,b){return m+"["+b+"]="+a}).join(";"),";")}else g(w,".",oa[a],"(",k,");",r,".",a,"=",k,";")}})}
function ta(a,b){g&&!a.instancing&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function Ba(a,b,g){g=a.stats;a=a.shared;ka&&b(a.timer,".beginQuery(",g,");")}function ja(a,b,g){a=a.shared;ka&&b(a.timer,".endQuery();")}function ba(a,b,d,c,f){function h(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function e(d,c,f){function h(){b("if(!",q,".pointer){",z,".enableVertexAttribArray(",
m,");",q,".pointer=true;}");var d=f.type,e;e=f.size?b.def(f.size,"||",c):c;b("if(",q,".type!==",d,"||",q,".size!==",e,"||",G.map(function(a){return q+"."+a+"!=="+f[a]}).join("||"),"){",z,".bindBuffer(",34962,",",ga,".buffer);",z,".vertexAttribPointer(",[m,e,d,f.normalized,f.stride,f.offset],");",q,".type=",d,";",q,".size=",e,";",G.map(function(a){return q+"."+a+"="+f[a]+";"}).join(""),"}");g&&(d=f.divisor,b("if(",q,".divisor!==",d,"){",a.instancing,".vertexAttribDivisorANGLE(",[m,d],");",q,".divisor=",
d,";}"))}function k(){b("if(",q,".pointer){",z,".disableVertexAttribArray(",m,");",q,".pointer=false;","}if(",p.map(function(a,b){return q+"."+a+"!=="+v[b]}).join("||"),"){",z,".vertexAttrib4f(",m,",",v,");",p.map(function(a,b){return q+"."+a+"="+v[b]+";"}).join(""),"}")}var z=r.gl,m=b.def(d,".location"),q=b.def(r.attributes,"[",m,"]");d=f.state;var ga=f.buffer,v=[f.x,f.y,f.z,f.w],G=["buffer","normalized","offset","stride"];1===d?h():2===d?k():(b("if(",d,"===",1,"){"),h(),b("}else{"),k(),b("}"))}
var r=a.shared;c.forEach(function(g){var c=g.name,r=d.attributes[c],k;if(r){if(!f(r))return;k=r.append(a,b)}else{if(!f(T))return;var z=a.scopeAttrib(c);k={};Object.keys(new la).forEach(function(a){k[a]=b.def(z,".",a)})}e(a.link(g),h(g.info.type),k)})}function ca(a,b,g,d,c){for(var f=a.shared,e=f.gl,r,k=0;k<d.length;++k){var z=d[k],m=z.name,v=z.info.type,p=g.uniforms[m],z=a.link(z)+".location",y;if(p){if(!c(p))continue;if(h(p)){m=p.value;if(35678===v||35680===v)v=a.link(m._texture),b(e,".uniform1i(",
z,",",v+".bind());"),b.exit(v,".unbind();");else if(35674===v||35675===v||35676===v)m=a.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])"),p=2,35675===v?p=3:35676===v&&(p=4),b(e,".uniformMatrix",p,"fv(",z,",false,",m,");");else{switch(v){case 5126:r="1f";break;case 35664:r="2f";break;case 35665:r="3f";break;case 35666:r="4f";break;case 35670:r="1i";break;case 5124:r="1i";break;case 35671:r="2i";break;case 35667:r="2i";break;case 35672:r="3i";break;case 35668:r="3i";break;case 35673:r=
"4i";break;case 35669:r="4i"}b(e,".uniform",r,"(",z,",",C(m)?Array.prototype.slice.call(m):m,");")}continue}else y=p.append(a,b)}else{if(!c(T))continue;y=b.def(f.uniforms,"[",q.id(m),"]")}m=1;switch(v){case 35678:case 35680:v=b.def(y,"._texture");b(e,".uniform1i(",z,",",v,".bind());");b.exit(v,".unbind();");continue;case 5124:case 35670:r="1i";break;case 35667:case 35671:r="2i";m=2;break;case 35668:case 35672:r="3i";m=3;break;case 35669:case 35673:r="4i";m=4;break;case 5126:r="1f";break;case 35664:r=
"2f";m=2;break;case 35665:r="3f";m=3;break;case 35666:r="4f";m=4;break;case 35674:r="Matrix2fv";break;case 35675:r="Matrix3fv";break;case 35676:r="Matrix4fv"}b(e,".uniform",r,"(",z,",");if("M"===r.charAt(0)){var z=Math.pow(v-35674+2,2),u=a.global.def("new Float32Array(",z,")");b("false,(Array.isArray(",y,")||",y," instanceof Float32Array)?",y,":(",t(z,function(a){return u+"["+a+"]="+y+"["+a+"]"}),",",u,")")}else 1<m?b(t(m,function(a){return y+"["+a+"]"})):b(y);b(");")}}function ya(a,b,d,c){function f(g){var r=
q[g];return r?r.contextDep&&c.contextDynamic||r.propDep?r.append(a,d):r.append(a,b):b.def(k,".",g)}function r(){function a(){d(J,".drawElementsInstancedANGLE(",[p,u,C,y+"<<(("+C+"-5121)>>1)",t],");")}function b(){d(J,".drawArraysInstancedANGLE(",[p,y,u,t],");")}v?l?a():(d("if(",v,"){"),a(),d("}else{"),b(),d("}")):b()}function e(){function a(){d(m+".drawElements("+[p,u,C,y+"<<(("+C+"-5121)>>1)"]+");")}function b(){d(m+".drawArrays("+[p,y,u]+");")}v?l?a():(d("if(",v,"){"),a(),d("}else{"),b(),d("}")):
b()}var z=a.shared,m=z.gl,k=z.draw,q=c.draw,v=function(){var g=q.elements,f=b;if(g){if(g.contextDep&&c.contextDynamic||g.propDep)f=d;g=g.append(a,f)}else g=f.def(k,".","elements");g&&f("if("+g+")"+m+".bindBuffer(34963,"+g+".buffer.buffer);");return g}(),p=f("primitive"),y=f("offset"),u=function(){var g=q.count,f=b;if(g){if(g.contextDep&&c.contextDynamic||g.propDep)f=d;g=g.append(a,f)}else g=f.def(k,".","count");return g}();if("number"===typeof u){if(0===u)return}else d("if(",u,"){"),d.exit("}");var t,
J;g&&(t=f("instances"),J=a.instancing);var C=v+".type",l=q.elements&&h(q.elements);g&&("number"!==typeof t||0<=t)?"string"===typeof t?(d("if(",t,">0){"),r(),d("}else if(",t,"<0){"),e(),d("}")):r():e()}function va(a,b,d,c,f){b=W();f=b.proc("body",f);g&&(b.instancing=f.def(b.shared.extensions,".angle_instanced_arrays"));a(b,f,d,c);return b.compile().body}function Ca(a,b,g,d){ta(a,b);ba(a,b,g,d.attributes,function(){return!0});ca(a,b,g,d.uniforms,function(){return!0});ya(a,b,b,g)}function Da(a,b){var g=
a.proc("draw",1);ta(a,g);M(a,g,b.context);R(a,g,b.framebuffer);O(a,g,b);P(a,g,b.state);Ba(a,g,b);var d=b.shader.progVar.append(a,g);g(a.shared.gl,".useProgram(",d,".program);");if(b.shader.program)Ca(a,g,b,b.shader.program);else{var c=a.global.def("{}"),f=g.def(d,".id"),r=g.def(c,"[",f,"]");g(a.cond(r).then(r,".call(this,a0);")["else"](r,"=",c,"[",f,"]=",a.link(function(g){return va(Ca,a,b,g,1)}),"(",d,");",r,".call(this,a0);"))}0<Object.keys(b.state).length&&g(a.shared.current,".dirty=true;");ja(a,
g,b)}function Ea(a,b,g,d){function c(){return!0}a.batchId="a1";ta(a,b);ba(a,b,g,d.attributes,c);ca(a,b,g,d.uniforms,c);ya(a,b,b,g)}function ua(a,b,g,d){function c(a){return a.contextDep&&r||a.propDep}function f(a){return!c(a)}ta(a,b);var r=g.contextDep,e=b.def(),h=b.def();a.shared.props=h;a.batchId=e;var m=a.scope(),z=a.scope();b(m.entry,"for(",e,"=0;",e,"<","a1",";++",e,"){",h,"=","a0","[",e,"];",z,"}",m.exit);g.needsContext&&M(a,z,g.context);g.needsFramebuffer&&R(a,z,g.framebuffer);P(a,z,g.state,
c);d?(ba(a,m,g,d.attributes,f),ba(a,z,g,d.attributes,c),ca(a,m,g,d.uniforms,f),ca(a,z,g,d.uniforms,c),ya(a,m,z,g)):(b=a.global.def("{}"),d=g.shader.progVar.append(a,z),h=z.def(d,".id"),m=z.def(b,"[",h,"]"),z(a.shared.gl,".useProgram(",d,".program);","if(!",m,"){",m,"=",b,"[",h,"]=",a.link(function(b){return va(Ea,a,g,b,2)}),"(",d,");}",m,".call(this,a0[",e,"],",e,");"))}function Ga(a,b){var g=a.proc("batch",2);a.batchId="0";ta(a,g);var d=!1,c=!0;Object.keys(b.context).forEach(function(a){d=d||b.context[a].propDep});
d||(M(a,g,b.context),c=!1);var f=b.framebuffer,r=!1;f?(f.propDep?d=r=!0:f.contextDep&&d&&(r=!0),r||R(a,g,f)):R(a,g,null);b.state.viewport&&b.state.viewport.propDep&&(d=!0);O(a,g,b);P(a,g,b.state,function(a){return!(a.contextDep&&d||a.propDep)});Ba(a,g,b);b.contextDep=d;b.needsContext=c;b.needsFramebuffer=r;c=b.shader.progVar;if(c.contextDep&&d||c.propDep)ua(a,g,b,null);else if(c=c.append(a,g),g(a.shared.gl,".useProgram(",c,".program);"),b.shader.program)ua(a,g,b,b.shader.program);else{var f=a.global.def("{}"),
r=g.def(c,".id"),e=g.def(f,"[",r,"]");g(a.cond(e).then(e,".call(this,a0,a1);")["else"](e,"=",f,"[",r,"]=",a.link(function(g){return va(ua,a,b,g,2)}),"(",c,");",e,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&g(a.shared.current,".dirty=true;");ja(a,g,b)}function wa(b,g){function d(a){var r=g.shader[a];r&&c.set(f.shader,"."+a,r.append(b,c))}var c=b.proc("scope",3);b.batchId="a2";var f=b.shared,r=f.current,e=f.timer,h;ka&&(h=c.def(e,".getNumPendingQueries()"));M(b,c,g.context);g.framebuffer&&
g.framebuffer.append(b,c);a(Object.keys(g.state)).forEach(function(a){var d=g.state[a].append(b,c);C(d)?d.forEach(function(g,d){c.set(b.next[a],"["+d+"]",g)}):c.set(f.next,"."+a,d)});["elements","offset","count","instances","primitive"].forEach(function(a){var d=g.draw[a];d&&c.set(f.draw,"."+a,""+d.append(b,c))});Object.keys(g.uniforms).forEach(function(a){c.set(f.uniforms,"["+q.id(a)+"]",g.uniforms[a].append(b,c))});Object.keys(g.attributes).forEach(function(a){var d=g.attributes[a].append(b,c),
f=b.scopeAttrib(a);Object.keys(new la).forEach(function(a){c.set(f,"."+a,d[a])})});d("vert");d("frag");0<Object.keys(g.state).length&&(c(r,".dirty=true;"),c.exit(r,".dirty=true;"));c("a1(",b.shared.context,",a0,0);");if(ka){var z=b.stats,r=c.def(e,".getNumPendingQueries()-1");c(e,".pushScopeStats(",h,",",r,",",z,");")}}var la=V.Record,aa={add:32774,subtract:32778,"reverse subtract":32779};l.ext_blend_minmax&&(aa.min=32775,aa.max=32776);var g=l.angle_instanced_arrays,z=l.webgl_draw_buffers,r={dirty:!0},
xa={},za=[],na={},oa={};L("dither",3024);L("blend.enable",3042);D("blend.color","blendColor",[0,0,0,0]);D("blend.equation","blendEquationSeparate",[32774,32774]);D("blend.func","blendFuncSeparate",[1,0,1,0]);L("depth.enable",2929,!0);D("depth.func","depthFunc",513);D("depth.range","depthRange",[0,1]);D("depth.mask","depthMask",!0);D("colorMask","colorMask",[!0,!0,!0,!0]);L("cull.enable",2884);D("cull.face","cullFace",1029);D("frontFace","frontFace",2305);D("lineWidth","lineWidth",1);L("polygonOffset.enable",
32823);D("polygonOffset.offset","polygonOffset",[0,0]);L("sample.alpha",32926);L("sample.enable",32928);D("sample.coverage","sampleCoverage",[1,!1]);L("stencil.enable",2960);D("stencil.mask","stencilMask",-1);D("stencil.func","stencilFunc",[519,0,-1]);D("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);D("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);L("scissor.enable",3089);D("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);D("viewport","viewport",
[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var Ha={gl:e,context:ea,strings:q,next:xa,current:r,draw:N,elements:E,buffer:B,shader:Z,attributes:V.state,uniforms:I,framebuffer:J,extensions:l,timer:ka,isBufferArgs:k},Aa={primTypes:F,compareFuncs:A,blendFuncs:v,blendEquations:aa,stencilOps:m,glTypes:K,orientationType:d};z&&(Aa.backBuffer=[1029],Aa.drawBuffer=t(n.maxDrawbuffers,function(a){return 0===a?[0]:t(a,function(a){return 36064+a})}));var Ka=0;return{next:xa,current:r,procs:function(){var a=
W(),b=a.proc("poll"),g=a.proc("refresh"),d=a.block();b(d);g(d);var c=a.shared,f=c.gl,e=c.next,h=c.current;d(h,".dirty=false;");R(a,b);g(c.framebuffer,".dirty=true;");R(a,g);Object.keys(na).forEach(function(c){var r=na[c],z=d.def(e,".",c),m=a.block();m("if(",z,"){",f,".enable(",r,")}else{",f,".disable(",r,")}",h,".",c,"=",z,";");g(m);b("if(",z,"!==",h,".",c,"){",m,"}")});Object.keys(oa).forEach(function(c){var z=oa[c],m=r[c],k,q,v=a.block();v(f,".",z,"(");C(m)?(z=m.length,k=a.global.def(e,".",c),q=
a.global.def(h,".",c),v(t(z,function(a){return k+"["+a+"]"}),");",t(z,function(a){return q+"["+a+"]="+k+"["+a+"];"}).join("")),b("if(",t(z,function(a){return k+"["+a+"]!=="+q+"["+a+"]"}).join("||"),"){",v,"}")):(k=d.def(e,".",c),q=d.def(h,".",c),v(k,");",h,".",c,"=",k,";"),b("if(",k,"!==",q,"){",v,"}"));g(v)});return a.compile()}(),compile:function(a,b,g,d,c){var f=W();f.stats=f.link(c);c=ha(a);var r=pa(a,c),e=ia(a),h=qa(a);a=sa(a);var z=r.viewport;z&&(h.viewport=z);z=Q("scissor.box");(r=r[z])&&(h[z]=
r);r=0<Object.keys(h).length;c={framebuffer:c,draw:e,shader:a,state:h,dirty:r};c.uniforms=ma(g);c.attributes=X(b);c.context=fa(d);Da(f,c);wa(f,c);Ga(f,c);return f.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],9:[function(e,l,n){function k(a,c){this.id=h++;this.type=a;this.data=c}function a(b){if(0===b.length)return[];var c=b.charAt(0),e=b.charAt(b.length-
1);if(1<b.length&&c===e&&('"'===c||"'"===c))return['"'+b.substr(1,b.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(c=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return a(b.substr(0,c.index)).concat(a(c[1])).concat(a(b.substr(c.index+c[0].length)));c=b.split(".");if(1===c.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(e=0;e<c.length;++e)b=b.concat(a(c[e]));return b}function c(b){return"["+a(b).join("][")+"]"}var h=0;l.exports={define:function(a,f){switch(typeof f){case "boolean":case "number":case "string":return new k(a,
c(f+""));case "undefined":return new k(a|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof k},unbox:function(a,f){if(a instanceof k){if(a.type&128)return new k(a.type&-129,c(f))}else if("function"===typeof a)return new k(0,a);return a},accessor:c}},{}],10:[function(e,l,n){var k=e("./util/is-typed-array"),a=e("./util/is-ndarray"),c=e("./util/values"),h=e("./constants/primitives.json"),b=e("./constants/usage.json");l.exports=function(f,e,t,l){function n(a){this.id=
p++;K[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function C(b,d,c,f,h,v,p){(v=p)||k(d)&&(!a(d)||k(d.data))||(v=e.oes_element_index_uint?5125:5123);b.buffer.bind();t._initBuffer(b.buffer,d,c,v,3);d=p;if(!p){switch(b.buffer.dtype){case 5121:case 5120:d=5121;break;case 5123:case 5122:d=5123;break;case 5125:case 5124:d=5125}b.buffer.dtype=d}b.type=d;0>h&&(h=b.buffer.byteLength,5123===d?h>>=1:5125===d&&(h>>=2));b.vertCount=h;h=f;0>f&&(h=4,f=b.buffer.dimension,1===f&&(h=0),2===
f&&(h=1),3===f&&(h=4));b.primType=h}function F(a){l.elementsCount--;delete K[a.id];a.buffer.destroy();a.buffer=null}var K={},p=0,v={uint8:5121,uint16:5123};e.oes_element_index_uint&&(v.uint32=5125);n.prototype.bind=function(){this.buffer.bind()};var A=[];return{create:function(c){function d(c){if(c)if("number"===typeof c)e(c),p.primType=4,p.vertCount=c|0,p.type=5121;else{var m=null,u=35044,t=-1,l=-1,F=0,J=0;Array.isArray(c)||k(c)||a(c)?m=c:("data"in c&&(m=c.data),"usage"in c&&(u=b[c.usage]),"primitive"in
c&&(t=h[c.primitive]),"count"in c&&(l=c.count|0),"length"in c&&(F=c.length|0),"type"in c&&(J=v[c.type]));m?C(p,m,u,t,l,F,J):(c=p.buffer,c.bind(),f.bufferData(34963,F,u),c.dtype=J||5121,c.usage=u,c.dimension=3,c.byteLength=F,p.primType=0>t?4:t,p.vertCount=0>l?0:l,p.type=c.dtype)}else e(),p.primType=4,p.vertCount=0,p.type=5121;return d}var e=t.create(null,34963,!0),p=new n(e._buffer);l.elementsCount++;d(c);d._reglType="elements";d._elements=p;d.subdata=function(a,b){e.subdata(a,b);return d};d.destroy=
function(){F(p)};return d},createStream:function(a){var b=A.pop();b||(b=new n(t.create(null,34963,!0)._buffer));C(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){A.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof n?a._elements:null},clear:function(){c(K).forEach(F)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],11:[function(e,l,n){l.exports=function(e){function a(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb ext_disjoint_timer_query angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{c[a]=
e.getExtension(a)}catch(b){}})}var c={};a();return{extensions:c,refresh:a}}},{}],12:[function(e,l,n){var k=e("./util/values"),a=e("./util/extend");l.exports=function(c,e,b,f,u,t){function l(a,b,d){this.target=a;this.texture=b;this.renderbuffer=d;var c=a=0;b?(a=b.width,c=b.height):d&&(a=d.width,c=d.height);this.width=a;this.height=c}function n(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function C(a,b,d){a&&(a.texture?a.texture._texture.refCount+=
1:a.renderbuffer._renderbuffer.refCount+=1)}function F(a,b){b?b.texture?c.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,0):c.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):c.framebufferTexture2D(36160,a,3553,null,0)}function K(a){var b=3553,d=null,c=null,f=a;"object"===typeof a&&(f=a.data);a=f._reglType;"texture2d"===a?d=f:"textureCube"===a?d=f:"renderbuffer"===a&&(c=f,b=36161);return new l(b,d,c)}function p(a,b,d,c,e){if(d)return a=f.create2D({width:a,
height:b,format:c,type:e}),a._texture.refCount=0,new l(3553,a,null);a=u.create({width:a,height:b,format:c});a._renderbuffer.refCount=0;return new l(36161,null,a)}function v(a){return a&&(a.texture||a.renderbuffer)}function A(a,b,d){a&&(a.texture?a.texture.resize(b,d):a.renderbuffer&&a.renderbuffer.resize(b,d))}function m(){this.id=S++;da[this.id]=this;this.framebuffer=c.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=
null}function d(a){a.colorAttachments.forEach(n);n(a.depthAttachment);n(a.stencilAttachment);n(a.depthStencilAttachment)}function T(a){c.deleteFramebuffer(a.framebuffer);a.framebuffer=null;t.framebufferCount--;delete da[a.id]}function y(a){var d;c.bindFramebuffer(36160,a.framebuffer);var f=a.colorAttachments;for(d=0;d<f.length;++d)F(36064+d,f[d]);for(d=f.length;d<b.maxColorAttachments;++d)F(36064+d,null);F(36096,a.depthAttachment);F(36128,a.stencilAttachment);F(33306,a.depthStencilAttachment);c.checkFramebufferStatus(36160);
c.bindFramebuffer(36160,q.next);q.current=q.next}var q={current:null,next:null,dirty:!1},Ja=["rgba"],Y=["rgba4","rgb565","rgb5 a1"];e.ext_srgb&&Y.push("srgba");e.ext_color_buffer_half_float&&Y.push("rgba16f","rgb16f");e.webgl_color_buffer_float&&Y.push("rgba32f");var U=["uint8"];e.oes_texture_half_float&&U.push("half float");e.oes_texture_float&&U.push("float");var S=0,da={};return a(q,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof
m)?a:null},create:function(a,b){function c(a,b){var k,m=0,u=0,t=!0,q=!0;k=null;var l=!0,F="rgba",n="uint8",A=1,B=null,E=null,T=null,I=!1;if("number"===typeof a)m=a|0,u=b|0||m;else if(a){"shape"in a?(u=a.shape,m=u[0],u=u[1]):("radius"in a&&(m=u=a.radius),"width"in a&&(m=a.width),"height"in a&&(u=a.height));if("color"in a||"colors"in a)k=a.color||a.colors,Array.isArray(k);k||("colorCount"in a&&(A=a.colorCount|0),"colorTexture"in a&&(l=!!a.colorTexture,F="rgba4"),"colorType"in a&&(n=a.colorType,l||("half float"===
n?e.ext_color_buffer_half_float&&(F="rgba16f"):"float"===n&&e.webgl_color_buffer_float&&(F="rgba32f"))),"colorFormat"in a&&(F=a.colorFormat,0<=Ja.indexOf(F)?l=!0:0<=Y.indexOf(F)&&(l=!1)));if("depthTexture"in a||"depthStencilTexture"in a)I=!(!a.depthTexture&&!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?t=a.depth:(B=a.depth,q=!1));"stencil"in a&&("boolean"===typeof a.stencil?q=a.stencil:(E=a.stencil,t=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?t=q=a.depthStencil:
(T=a.depthStencil,q=t=!1))}else m=u=1;var M=null,J=null,O=null,P=null;if(Array.isArray(k))M=k.map(K);else if(k)M=[K(k)];else for(M=Array(A),k=0;k<A;++k)M[k]=p(m,u,l,F,n);m=m||M[0].width;u=u||M[0].height;B?J=K(B):t&&!q&&(J=p(m,u,I,"depth","uint32"));E?O=K(E):q&&!t&&(O=p(m,u,!1,"stencil","uint8"));T?P=K(T):!B&&!E&&q&&t&&(P=p(m,u,I,"depth stencil","depth stencil"));for(k=0;k<M.length;++k)C(M[k],m,u);C(J,m,u);C(O,m,u);C(P,m,u);d(f);f.width=m;f.height=u;f.colorAttachments=M;f.depthAttachment=J;f.stencilAttachment=
O;f.depthStencilAttachment=P;c.color=M.map(v);c.depth=v(J);c.stencil=v(O);c.depthStencil=v(P);c.width=f.width;c.height=f.height;y(f);return c}var f=new m;t.framebufferCount++;c(a,b);c.resize=function(a,b){var d=a|0,e=b|0||d;if(d===f.width&&e===f.height)return c;for(var h=f.colorAttachments,k=0;k<h.length;++k)A(h[k],d,e);A(f.depthAttachment,d,e);A(f.stencilAttachment,d,e);A(f.depthStencilAttachment,d,e);f.width=c.width=d;f.height=c.height=e;y(f);return c};c._reglType="framebuffer";c._framebuffer=f;
c.destroy=function(){T(f);d(f)};return c},clear:function(){k(da).forEach(T)}})}},{"./util/extend":23,"./util/values":31}],13:[function(e,l,n){l.exports=function(e,a){var c=1;a.ext_texture_filter_anisotropic&&(c=e.getParameter(34047));var h=1,b=1;a.webgl_draw_buffers&&(h=e.getParameter(34852),b=e.getParameter(36063));return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),
extensions:Object.keys(a).filter(function(b){return!!a[b]}),maxAnisotropic:c,maxDrawbuffers:h,maxColorAttachments:b,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),
maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}}},{}],14:[function(e,l,n){var k=e("./util/is-typed-array");l.exports=function(a,c,e){return function(b){var f=0,u=0,t=e.framebufferWidth,l=e.framebufferHeight,n=null;k(b)?n=b:2===arguments.length?(t=arguments[0]|0,l=arguments[1]|0):b&&(f=b.x|0,u=b.y|0,t=b.width||e.framebufferWidth,l=b.height||e.framebufferHeight,
n=b.data||null);c();n=n||new Uint8Array(t*l*4);a.pixelStorei(3333,4);a.readPixels(f,u,t,l,6408,5121,n);return n}}},{"./util/is-typed-array":26}],15:[function(e,l,n){var k=e("./util/values");l.exports=function(a,c,e,b){function f(a){this.id=l++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0}function u(c){var f=c.renderbuffer;a.bindRenderbuffer(36161,null);a.deleteRenderbuffer(f);c.renderbuffer=null;c.refCount=0;delete n[c.id];b.renderbufferCount--}var t={rgba4:32854,
rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};c.ext_srgb&&(t.srgba=35907);c.ext_color_buffer_half_float&&(t.rgba16f=34842,t.rgb16f=34843);c.webgl_color_buffer_float&&(t.rgba32f=34836);var l=0,n={};f.prototype.decRef=function(){0>=--this.refCount&&u(this)};return{create:function(c,e){function h(b,c){var f=0,d=0,e=32854;"object"===typeof b&&b?("shape"in b?(d=b.shape,f=d[0]|0,d=d[1]|0):("radius"in b&&(f=d=b.radius|0),"width"in b&&(f=b.width|0),"height"in b&&(d=b.height|
0)),"format"in b&&(e=t[b.format])):"number"===typeof b?(f=b|0,d="number"===typeof c?c|0:f):b||(f=d=1);if(f!==k.width||d!==k.height||e!==k.format)return h.width=k.width=f,h.height=k.height=d,k.format=e,a.bindRenderbuffer(36161,k.renderbuffer),a.renderbufferStorage(36161,e,f,d),h}var k=new f(a.createRenderbuffer());n[k.id]=k;b.renderbufferCount++;h(c,e);h.resize=function(b,c){var f=b|0,d=c|0||f;if(f===k.width&&d===k.height)return h;h.width=k.width=f;h.height=k.height=d;a.bindRenderbuffer(36161,k.renderbuffer);
a.renderbufferStorage(36161,k.format,f,d);return h};h._reglType="renderbuffer";h._renderbuffer=k;h.destroy=function(){k.decRef()};return h},clear:function(){k(n).forEach(u)}}}},{"./util/values":31}],16:[function(e,l,n){var k=e("./util/values");l.exports=function(a,c,e){function b(a,b,c,f){this.name=a;this.id=b;this.location=c;this.info=f}function f(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function u(b,f,e){e=35632===b?l:n;var h=e[f];if(!h){var d=
c.str(f),h=a.createShader(b);a.shaderSource(h,d);a.compileShader(h);e[f]=h}return h}function t(a,b){this.id=K++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[]}var l={},n={},C={},F=[],K=0;return{clear:function(){var b=a.deleteShader.bind(a);k(l).forEach(b);l={};k(n).forEach(b);n={};F.forEach(function(b){a.deleteProgram(b.program)});F.length=0;C={};e.shaderCount=0},program:function(k,l,n){e.shaderCount++;(n=C[l])||(n=C[l]={});var m=n[k];if(!m){var d=m=new t(l,k),B,
y;B=u(35632,d.fragId);y=u(35633,d.vertId);l=d.program=a.createProgram();a.attachShader(l,B);a.attachShader(l,y);a.linkProgram(l);var q=a.getProgramParameter(l,35718),K=d.uniforms;for(B=0;B<q;++B)if(y=a.getActiveUniform(l,B))if(1<y.size)for(var E=0;E<y.size;++E){var U=y.name.replace("[0]","["+E+"]");f(K,new b(U,c.id(U),a.getUniformLocation(l,U),y))}else f(K,new b(y.name,c.id(y.name),a.getUniformLocation(l,y.name),y));q=a.getProgramParameter(l,35721);d=d.attributes;for(B=0;B<q;++B)(y=a.getActiveAttrib(l,
B))&&f(d,new b(y.name,c.id(y.name),a.getAttribLocation(l,y.name),y));n[k]=m;F.push(m)}return m},shader:u,frag:null,vert:null}}},{"./util/values":31}],17:[function(e,l,n){l.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0}}},{}],18:[function(e,l,n){l.exports=function(){var e={"":0},a=[""];return{id:function(c){var h=e[c];if(h)return h;h=e[c]=a.length;a.push(c);return h},str:function(c){return a[c]}}}},{}],19:[function(e,
l,n){function k(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function a(a){return Array.isArray(a)&&0!==a.length&&F(a[0])?!0:!1}function c(a){return Object.prototype.toString.call(a)}function h(b){if(!b)return!1;var f=c(b);return 0<=m.indexOf(f)?!0:k(b)||a(b)||B(b)}function b(a,b){36193===a.type?(a.data=C(b),E.freeType(b)):a.data=b}var f=e("./util/extend"),u=e("./util/values"),t=e("./util/is-typed-array"),B=e("./util/is-ndarray"),E=e("./util/pool"),C=e("./util/to-half-float"),
F=e("./util/is-array-like");n=e("./constants/arraytypes.json");var K=e("./constants/arraytypes.json"),p=[9984,9986,9985,9987],v=[0,6409,6410,6407,6408],A={};A[6409]=A[6406]=A[6402]=1;A[34041]=A[6410]=2;A[6407]=3;A[6408]=4;var m=Object.keys(n).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]);l.exports=function(d,e,m,l,n,Y){function U(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=
this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function S(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function da(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=
b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=Ba[b.colorSpace]);"type"in b&&(a.type=ja[b.type]);var d=a.width,c=a.height,f=a.channels,e=!1;"shape"in b?(d=b.shape[0],c=b.shape[1],3===b.shape.length&&(f=b.shape[2],e=!0)):("radius"in b&&(d=c=b.radius),"width"in b&&(d=b.width),"height"in b&&(c=b.height),"channels"in b&&(f=b.channels,e=!0));a.width=d|0;a.height=c|0;a.channels=f|0;d=!1;"format"in b&&(d=b.format,c=a.internalformat=ba[d],a.format=Ca[c],d in ja&&
!("type"in b)&&(a.type=ja[d]),d in ca&&(a.compressed=!0),d=!0);!e&&d?a.channels=A[a.format]:e&&!d&&a.channels!==v[a.format]&&(a.format=a.internalformat=v[a.channels])}}function J(a){d.pixelStorei(37440,a.flipY);d.pixelStorei(37441,a.premultiplyAlpha);d.pixelStorei(37443,a.colorSpace);d.pixelStorei(3317,a.unpackAlignment)}function I(){U.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function V(g,d){var f=null;h(d)?f=d:d&&(da(g,d),"x"in d&&
(g.xOffset=d.x|0),"y"in d&&(g.yOffset=d.y|0),h(d.data)&&(f=d.data));if(d.copy){var e=n.viewportWidth,m=n.viewportHeight;g.width=g.width||e-g.xOffset;g.height=g.height||m-g.yOffset;g.needsCopy=!0}else if(!f)g.width=g.width||1,g.height=g.height||1;else if(t(f))g.data=f,"type"in d||5121!==g.type||(g.type=K[Object.prototype.toString.call(f)]|0);else if(k(f)){e=f;m=g.width*g.height*g.channels;switch(g.type){case 5121:case 5123:case 5125:case 5126:m=E.allocType(g.type,m);m.set(e);g.data=m;break;case 36193:g.data=
C(e)}g.alignment=1;g.needsFree=!0}else if(B(f)){e=f.data;Array.isArray(e)||5121!==g.type||(g.type=K[Object.prototype.toString.call(e)]|0);var m=f.shape,l=f.stride,u,q,p,y;3===m.length?(p=m[2],y=l[2]):y=p=1;u=m[0];q=m[1];m=l[0];l=l[1];g.alignment=1;g.width=u;g.height=q;g.channels=p;g.format=g.internalformat=v[p];g.needsFree=!0;u=y;f=f.offset;p=g.width;y=g.height;q=g.channels;for(var x=E.allocType(36193===g.type?5126:g.type,p*y*q),A=0,P=0;P<y;++P)for(var D=0;D<p;++D)for(var G=0;G<q;++G)x[A++]=e[m*D+
l*P+u*G+f];b(g,x)}else if("[object HTMLCanvasElement]"===c(f)||"[object CanvasRenderingContext2D]"===c(f))"[object HTMLCanvasElement]"===c(f)?g.element=f:g.element=f.canvas,g.width=g.element.width,g.height=g.element.height;else if("[object HTMLImageElement]"===c(f))g.element=f,g.width=f.naturalWidth,g.height=f.naturalHeight;else if("[object HTMLVideoElement]"===c(f))g.element=f,g.width=f.videoWidth,g.height=f.videoHeight,g.needsPoll=!0;else if(a(f)){e=f[0].length;m=f.length;l=1;if(F(f[0][0])){u=l=
f[0][0].length;p=E.allocType(36193===g.type?5126:g.type,e*m*u);for(q=y=0;q<m;++q)for(x=f[q],A=0;A<e;++A)for(P=x[A],D=0;D<u;++D)p[y++]=P[D];b(g,p)}else{u=E.allocType(36193===g.type?5126:g.type,e*m);for(y=p=0;y<m;++y)for(q=f[y],x=0;x<e;++x)u[p++]=q[x];b(g,u)}g.alignment=1;g.width=e;g.height=m;g.channels=l;g.format=g.internalformat=v[l];g.needsFree=!0}}function Z(a,b,c,f,e){var h=a.element,k=a.data,m=a.internalformat,u=a.format,t=a.type,p=a.width,y=a.height;J(a);h?d.texSubImage2D(b,e,c,f,u,t,h):a.compressed?
d.compressedTexSubImage2D(b,e,c,f,m,p,y,k):a.needsCopy?(l(),d.copyTexSubImage2D(b,e,c,f,a.xOffset,a.yOffset,p,y)):d.texSubImage2D(b,e,c,f,p,y,u,t,k)}function N(){return Da.pop()||new I}function ea(a){a.needsFree&&E.freeType(a.data);I.call(a);Da.push(a)}function ka(){U.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function Q(a,b,d){var c=a.images[0]=N();a.mipmask=1;c.width=a.width=b;c.height=a.height=d}function L(a,b){var d=null;if(h(b))d=a.images[0]=N(),S(d,
a),V(d,b),a.mipmask=1;else if(da(a,b),Array.isArray(b.mipmap))for(var c=b.mipmap,f=0;f<c.length;++f)d=a.images[f]=N(),S(d,a),d.width>>=f,d.height>>=f,V(d,c[f]),a.mipmask|=1<<f;else d=a.images[0]=N(),S(d,a),V(d,b),a.mipmask=1;S(a,a.images[0])}function D(a,b){for(var c=a.images,f=0;f<c.length&&c[f];++f){var e=c[f],h=b,k=f,m=e.element,u=e.data,t=e.internalformat,p=e.format,y=e.type,n=e.width,v=e.height;J(e);m?d.texImage2D(h,k,p,p,y,m):e.compressed?d.compressedTexImage2D(h,k,t,n,v,0,u):e.needsCopy?(l(),
d.copyTexImage2D(h,k,p,e.xOffset,e.yOffset,n,v,0)):d.texImage2D(h,k,p,n,v,0,p,y,u)}}function W(){var a=Ea.pop()||new ka;U.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function ha(a){for(var b=a.images,d=0;d<b.length;++d)b[d]&&ea(b[d]),b[d]=null;Ea.push(a)}function pa(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function sa(a,b){"min"in b&&(a.minFilter=ta[b.min],0<=p.indexOf(a.minFilter)&&(a.genMipmaps=
!0));"mag"in b&&(a.magFilter=P[b.mag]);var d=a.wrapS,c=a.wrapT;if("wrap"in b){var f=b.wrap;"string"===typeof f?d=c=O[f]:Array.isArray(f)&&(d=O[f[0]],c=O[f[1]])}else"wrapS"in b&&(d=O[b.wrapS]),"wrapT"in b&&(c=O[b.wrapT]);a.wrapS=d;a.wrapT=c;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){d=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=R[b.mipmap];d=a.genMipmaps=!0;break;case "boolean":d=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,d=!0}!d||"min"in b||(a.minFilter=
9984)}}function ia(a,b){d.texParameteri(b,10241,a.minFilter);d.texParameteri(b,10240,a.magFilter);d.texParameteri(b,10242,a.wrapS);d.texParameteri(b,10243,a.wrapT);e.ext_texture_filter_anisotropic&&d.texParameteri(b,34046,a.anisotropic);a.genMipmaps&&(d.hint(33170,a.mipmapHint),d.generateMipmap(b))}function qa(){var a=ua.pop()||new pa;pa.call(a);return a}function ma(a){U.call(this);this.mipmask=0;this.internalformat=6408;this.id=Ga++;this.refCount=1;this.target=a;this.texture=d.createTexture();this.unit=
-1;this.bindCount=0}function X(a){d.activeTexture(33984);d.bindTexture(a.target,a.texture)}function fa(){var a=aa[0];a?d.bindTexture(a.target,a.texture):d.bindTexture(3553,null)}function M(a){var b=a.texture,c=a.unit,f=a.target;0<=c&&(d.activeTexture(33984+c),d.bindTexture(f,null),aa[c]=null);d.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete wa[a.id];Y.textureCount--}var R={"don't care":4352,"dont care":4352,nice:4354,fast:4353},O={repeat:10497,clamp:33071,mirror:33648},
P={nearest:9728,linear:9729},ta=f({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},P),Ba={none:0,browser:37444},ja={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},ba={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ca={};e.ext_srgb&&(ba.srgb=35904,ba.srgba=35906);e.oes_texture_float&&(ja["float"]=5126);e.oes_texture_half_float&&(ja.float16=ja["half float"]=
36193);e.webgl_depth_texture&&(f(ba,{depth:6402,"depth stencil":34041}),f(ja,{uint16:5123,uint32:5125,"depth stencil":34042}));e.webgl_compressed_texture_s3tc&&f(ca,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});e.webgl_compressed_texture_atc&&f(ca,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});e.webgl_compressed_texture_pvrtc&&f(ca,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});
e.webgl_compressed_texture_etc1&&(ca["rgb etc1"]=36196);var ya=Array.prototype.slice.call(d.getParameter(34467));Object.keys(ca).forEach(function(a){var b=ca[a];0<=ya.indexOf(b)&&(ba[a]=b)});var va=Object.keys(ba);m.textureFormats=va;var Ca=va.reduce(function(a,b){var d=ba[b];6409===d||6406===d||6409===d||6410===d||6402===d||34041===d?a[d]=d:32855===d||0<=b.indexOf("rgba")?a[d]=6408:a[d]=6407;return a},{}),Da=[],Ea=[],ua=[],Ga=0,wa={},la=m.maxTextureUnits,aa=Array(la).map(function(){return null});
f(ma.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<la;++b){var c=aa[b];if(c){if(0<c.bindCount)continue;c.unit=-1}aa[b]=this;a=b;break}this.unit=a;d.activeTexture(33984+a);d.bindTexture(this.target,this.texture)}return a},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&M(this)}});return{create2D:function(a,b){function c(a,b){var d=qa(),g=W();"number"===typeof a?"number"===typeof b?Q(g,a|0,b|0):Q(g,a|0,a|0):a?(sa(d,a),L(g,a)):Q(g,1,1);d.genMipmaps&&
(g.mipmask=(g.width<<1)-1);f.mipmask=g.mipmask;S(f,g);f.internalformat=g.internalformat;c.width=g.width;c.height=g.height;X(f);D(g,3553);ia(d,3553);fa();ua.push(d);ha(g);return c}var f=new ma(3553);wa[f.id]=f;Y.textureCount++;c(a,b);c.subimage=function(a,b,d,g){b|=0;d|=0;g|=0;var e=N();S(e,f);e.width>>=g;e.height>>=g;e.width-=b;e.height-=d;V(e,a);X(f);Z(e,3553,b,d,g);fa();ea(e);return c};c.resize=function(a,b){var g=a|0,e=b|0||g;if(g===f.width&&e===f.height)return c;c.width=f.width=g;c.height=f.height=
e;X(f);d.texImage2D(3553,0,f.format,g,e,0,f.format,f.type,null);fa();return c};c._reglType="texture2d";c._texture=f;c.destroy=function(){f.decRef()};return c},createCube:function(a,b,c,f,e,h){function k(a,b,d,c,f,g){var e,h=qa();for(e=0;6>e;++e)l[e]=W();if("number"===typeof a||!a)for(a=a|0||1,e=0;6>e;++e)Q(l[e],a,a);else if("object"===typeof a)if(b)L(l[0],a),L(l[1],b),L(l[2],d),L(l[3],c),L(l[4],f),L(l[5],g);else if(sa(h,a),da(m,a),"faces"in a)for(a=a.faces,e=0;6>e;++e)S(l[e],m),L(l[e],a[e]);else for(e=
0;6>e;++e)L(l[e],a);S(m,l[0]);m.mipmask=h.genMipmaps?(l[0].width<<1)-1:l[0].mipmask;m.internalformat=l[0].internalformat;k.width=l[0].width;k.height=l[0].height;X(m);for(e=0;6>e;++e)D(l[e],34069+e);ia(h,34067);fa();ua.push(h);for(e=0;6>e;++e)ha(l[e]);return k}var m=new ma(34067);wa[m.id]=m;Y.cubeCount++;var l=Array(6);k(a,b,c,f,e,h);k.subimage=function(a,b,d,c,f){d|=0;c|=0;f|=0;var e=N();S(e,m);e.width>>=f;e.height>>=f;e.width-=d;e.height-=c;V(e,b);X(m);Z(e,34069+a,d,c,f);fa();ea(e);return k};k.resize=
function(a,b){var c=a|0,f=b|0||c;if(c===m.width&&f===m.height)return k;k.width=m.width=c;k.height=m.height=f;X(m);for(var e=0;6>e;++e)d.texImage2D(34069+e,0,m.format,c,f,0,m.format,m.type,null);fa();return k};k._reglType="textureCube";k._texture=m;k.destroy=function(){m.decRef()};return k},clear:function(){for(var a=0;a<la;++a)d.activeTexture(33984+a),d.bindTexture(3553,null),aa[a]=null;u(wa).forEach(M);Y.cubeCount=0;Y.textureCount=0},getTexture:function(a){return null}}}},{"./constants/arraytypes.json":4,
"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/to-half-float":30,"./util/values":31}],20:[function(e,l,n){l.exports=function(e,a){function c(){this.endQueryIndex=this.startQueryIndex=-1;this.stats=null}var h=a.ext_disjoint_timer_query;if(!h)return null;var b=[],f=[],l,t,n=[],E=[];return{beginQuery:function(a){l=a;t=n.pop()||h.createQueryEXT();h.beginQueryEXT(h.TIME_ELAPSED_EXT,t)},endQuery:function(){h.endQueryEXT(h.TIME_ELAPSED_EXT);
var a=E.pop()||new c;a.startQueryIndex=b.length;a.endQueryIndex=a.startQueryIndex;a.stats=l;f.push(a);b.push(t)},update:function(){if(0!==b.length){var a=[],c,e;for(c=0;c<b.length;c++)a[c]=1E-6*h.getQueryObjectEXT(b[c],h.QUERY_RESULT_EXT),n.push(b[c]);b=[];for(c=0;c<f.length;c++){var k=f[c];for(e=k.startQueryIndex;e<=k.endQueryIndex;e++)k.stats.gpuTime+=a[e];E.push(k)}f=[]}},getNumPendingQueries:function(){return b.length},pushScopeStats:function(a,b,e){var h=E.pop()||new c;h.startQueryIndex=a;h.endQueryIndex=
b;h.stats=e;f.push(h)},clear:function(){for(var a=0;a<n.length;a++)h.deleteQueryEXT(n[a])}}}},{}],21:[function(e,l,n){l.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(e,l,n){function k(a){return Array.prototype.slice.call(a)}function a(a){return k(a).join("")}var c=e("./extend");l.exports=function(){function e(){var b=[],h=[];return c(function(){b.push.apply(b,k(arguments))},{def:function(){var a="v"+f++;
h.push(a);0<arguments.length&&(b.push(a,"="),b.push.apply(b,k(arguments)),b.push(";"));return a},toString:function(){return a([0<h.length?"var "+h+";":"",a(b)])}})}function b(){function a(c,e){f(c,e,"=",b.def(c,e),";")}var b=e(),f=e(),k=b.toString,l=f.toString;return c(b,{entry:b,exit:f,save:a,set:function(c,e,d){a(c,e);b(c,e,"=",d,";")},toString:function(){return k()+l()}})}var f=0,l=[],t=[],n=e(),E={};return{global:n,link:function(a){for(var b=0;b<t.length;++b)if(t[b]===a)return l[b];b="g"+f++;
l.push(b);t.push(a);return b},block:e,proc:function(e,f){function h(){var a="a"+k.length;k.push(a);return a}var k=[];f=f||0;for(var l=0;l<f;++l)h();var l=b(),u=l.toString;return E[e]=c(l,{arg:h,toString:function(){return a(["function(",k.join(),"){",u(),"}"])}})},scope:b,cond:function(){var e=a(arguments),f=b(),h=b(),l=f.toString,u=h.toString;return c(f,{then:function(){f.apply(f,k(arguments));return this},"else":function(){h.apply(h,k(arguments));return this},toString:function(){var b=u();b&&(b=
"else{"+b+"}");return a(["if(",e,"){",l(),"}",b])}})},compile:function(){var b=['"use strict";',n,"return {"];Object.keys(E).forEach(function(a){b.push('"',a,'":',E[a].toString(),",")});b.push("}");var c=a(b).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,l.concat(c)).apply(null,t)}}}},{"./extend":23}],23:[function(e,l,n){l.exports=function(e,a){for(var c=Object.keys(a),h=0;h<c.length;++h)e[c[h]]=a[c[h]];return e}},{}],24:[function(e,l,n){var k=e("./is-typed-array");
l.exports=function(a){return Array.isArray(a)||k(a)}},{"./is-typed-array":26}],25:[function(e,l,n){var k=e("./is-typed-array");l.exports=function(a){return!!a&&"object"===typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"===typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||k(a.data))}},{"./is-typed-array":26}],26:[function(e,l,n){var k=e("../constants/arraytypes.json");l.exports=function(a){return Object.prototype.toString.call(a)in k}},{"../constants/arraytypes.json":4}],
27:[function(e,l,n){l.exports=function(e,a){for(var c=Array(e),h=0;h<e;++h)c[h]=a(h);return c}},{}],28:[function(e,l,n){function k(a){var c,e;c=(65535<a)<<4;a>>>=c;e=(255<a)<<3;a>>>=e;c|=e;e=(15<a)<<2;a>>>=e;c|=e;e=(3<a)<<1;return c|e|a>>>e>>1}function a(a){a:{for(var c=16;268435456>=c;c*=16)if(a<=c){a=c;break a}a=0}c=h[k(a)>>2];return 0<c.length?c.pop():new ArrayBuffer(a)}function c(a){h[k(a.byteLength)>>2].push(a)}var h=e("./loop")(8,function(){return[]});l.exports={alloc:a,free:c,allocType:function(b,
c){var e=null;switch(b){case 5120:e=new Int8Array(a(c),0,c);break;case 5121:e=new Uint8Array(a(c),0,c);break;case 5122:e=new Int16Array(a(2*c),0,c);break;case 5123:e=new Uint16Array(a(2*c),0,c);break;case 5124:e=new Int32Array(a(4*c),0,c);break;case 5125:e=new Uint32Array(a(4*c),0,c);break;case 5126:e=new Float32Array(a(4*c),0,c);break;default:return null}return e.length!==c?e.subarray(0,c):e},freeType:function(a){c(a.buffer)}}},{"./loop":27}],29:[function(e,l,n){l.exports="function"===typeof requestAnimationFrame&&
"function"===typeof cancelAnimationFrame?{next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:{next:function(e){setTimeout(e,30)},cancel:clearTimeout}},{}],30:[function(e,l,n){var k=e("./pool"),a=new Float32Array(1),c=new Uint32Array(a.buffer);l.exports=function(e){for(var b=k.allocType(5123,e.length),f=0;f<e.length;++f)if(isNaN(e[f]))b[f]=65535;else if(Infinity===e[f])b[f]=31744;else if(-Infinity===e[f])b[f]=64512;else{a[0]=e[f];var l=c[0],t=l>>>
31<<15,n=(l<<1>>>24)-127,l=l>>13&1023;b[f]=-24>n?t:-14>n?t+(l+1024>>-14-n):15<n?t+31744:t+(n+15<<10)+l}return b}},{"./pool":28}],31:[function(e,l,n){l.exports=function(e){return Object.keys(e).map(function(a){return e[a]})}},{}],32:[function(e,l,n){function k(e,b){function f(){var a=window.innerWidth,b=window.innerHeight;e!==document.body&&(b=e.getBoundingClientRect(),a=b.right-b.left,b=b.top-b.bottom);k.width=n*a;k.height=n*b;c(k.style,{width:a+"px",height:b+"px"})}var k=document.createElement("canvas"),
l=a(k,b);c(k.style,{border:0,margin:0,padding:0,top:0,left:0});e.appendChild(k);e===document.body&&(k.style.position="absolute",c(e.style,{margin:0,padding:0}));var n=+l.options.pixelRatio;window.addEventListener("resize",f,!1);var E=l.options.onDestroy;l.options=c(c({},l.options),{onDestroy:function(){window.removeEventListener("resize",f);e.removeChild(k);E&&E()}});f();return l}function a(a,b){function e(b){try{return a.getContext(b,k)}catch(c){return null}}var k=b.glOptions||{};return{gl:e("webgl")||
e("experimental-webgl")||e("webgl-experimental"),options:c({pixelRatio:window.devicePixelRatio},b)}}var c=e("./util/extend");l.exports=function(e){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:e[0],options:e[1]||{}};var b=document.body,f=e[1]||{};if("string"===typeof e[0])b=document.querySelector(e[0])||document.body;else if("object"===typeof e[0])if(e[0]instanceof HTMLElement)b=e[0];else{if(e[0]instanceof WebGLRenderingContext)return{gl:e[0],options:c({pixelRatio:1},
f)};f=e[0]}return b.nodeName&&"CANVAS"===b.nodeName.toUpperCase()?a(b,f):k(b,f)}},{"./util/extend":23}],33:[function(e,l,n){l.exports=function(a,c){function e(a){var b=!1;"altKey"in a&&(b=b||a.altKey!==m.alt,m.alt=!!a.altKey);"shiftKey"in a&&(b=b||a.shiftKey!==m.shift,m.shift=!!a.shiftKey);"ctrlKey"in a&&(b=b||a.ctrlKey!==m.control,m.control=!!a.ctrlKey);"metaKey"in a&&(b=b||a.metaKey!==m.meta,m.meta=!!a.metaKey);return b}function b(a,b){var d=k.x(b),f=k.y(b);"buttons"in b&&(a=b.buttons|0);if(a!==
p||d!==v||f!==A||e(b))p=a|0,v=d||0,A=f||0,c&&c(p,v,A,m)}function f(a){b(0,a)}function l(){if(p||v||A||m.shift||m.alt||m.meta||m.control)p=v=A=0,m.shift=m.alt=m.control=m.meta=!1,c&&c(0,0,0,m)}function n(a){e(a)&&c&&c(p,v,A,m)}function B(a){0===k.buttons(a)?b(0,a):b(p,a)}function E(a){b(p|k.buttons(a),a)}function C(a){b(p&~k.buttons(a),a)}function F(){d||(d=!0,a.addEventListener("mousemove",B),a.addEventListener("mousedown",E),a.addEventListener("mouseup",C),a.addEventListener("mouseleave",f),a.addEventListener("mouseenter",
f),a.addEventListener("mouseout",f),a.addEventListener("mouseover",f),a.addEventListener("blur",l),a.addEventListener("keyup",n),a.addEventListener("keydown",n),a.addEventListener("keypress",n),a!==window&&(window.addEventListener("blur",l),window.addEventListener("keyup",n),window.addEventListener("keydown",n),window.addEventListener("keypress",n)))}function K(){d&&(d=!1,a.removeEventListener("mousemove",B),a.removeEventListener("mousedown",E),a.removeEventListener("mouseup",C),a.removeEventListener("mouseleave",
f),a.removeEventListener("mouseenter",f),a.removeEventListener("mouseout",f),a.removeEventListener("mouseover",f),a.removeEventListener("blur",l),a.removeEventListener("keyup",n),a.removeEventListener("keydown",n),a.removeEventListener("keypress",n),a!==window&&(window.removeEventListener("blur",l),window.removeEventListener("keyup",n),window.removeEventListener("keydown",n),window.removeEventListener("keypress",n)))}c||(c=a,a=window);var p=0,v=0,A=0,m={shift:!1,alt:!1,control:!1,meta:!1},d=!1;F();
var T={element:a};Object.defineProperties(T,{enabled:{get:function(){return d},set:function(a){a?F():K},enumerable:!0},buttons:{get:function(){return p},enumerable:!0},x:{get:function(){return v},enumerable:!0},y:{get:function(){return A},enumerable:!0},mods:{get:function(){return m},enumerable:!0}});return T};var k=e("mouse-event")},{"mouse-event":34}],34:[function(e,l,n){function k(a){return a.target||a.srcElement||window}n.buttons=function(a){if("object"===typeof a){if("buttons"in a)return a.buttons;
if("which"in a){a=a.which;if(2===a)return 4;if(3===a)return 2;if(0<a)return 1<<a-1}else if("button"in a){a=a.button;if(1===a)return 4;if(2===a)return 2;if(0<=a)return 1<<a}}return 0};n.element=k;n.x=function(a){if("object"===typeof a){if("offsetX"in a)return a.offsetX;var c=k(a).getBoundingClientRect();return a.clientX-c.left}return 0};n.y=function(a){if("object"===typeof a){if("offsetY"in a)return a.offsetY;var c=k(a).getBoundingClientRect();return a.clientY-c.top}return 0}},{}],35:[function(e,l,
n){var k=e("./lib/util/extend"),a=e("./lib/dynamic"),c=e("./lib/util/raf"),h=e("./lib/util/clock"),b=e("./lib/strings"),f=e("./lib/webgl"),u=e("./lib/extension"),t=e("./lib/limits"),B=e("./lib/buffer"),E=e("./lib/elements"),C=e("./lib/texture"),F=e("./lib/renderbuffer"),K=e("./lib/framebuffer"),p=e("./lib/attribute"),v=e("./lib/shader"),A=e("./lib/read"),m=e("./lib/core"),d=e("./lib/stats"),T=e("./lib/timer");l.exports=function(){function e(){O=c.next(e);D.tick+=1;D.time=(h()-ka)/1E3;S();for(var a=
0;a<R.length;++a)(0,R[a])(D,null,0);I.flush()}function l(a){}function n(a){}function Y(b){function c(b){var d={},e={};Object.keys(b).forEach(function(c){var f=b[c];a.isDynamic(f)?e[c]=a.unbox(f,c):d[c]=f});return{dynamic:e,"static":d}}function d(a){for(;q.length<a;)q.push(null);return q}var e=c(b.context||{}),f=c(b.uniforms||{}),h=c(b.attributes||{}),l=c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=k({},a);delete c.uniforms;
delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(b));b={gpuTime:0};var e=X.compile(l,h,f,e,b),m=e.draw,n=e.batch,p=e.scope,q=[];return k(function(a,b){var c;if("function"===typeof a)return p.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(c=0;c<a;++c)p.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)p.call(this,a[c],b,c);else return p.call(this,a,b,0);else if("number"===
typeof a){if(0<a)return n.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return n.call(this,a,a.length)}else return m.call(this,a)},{stats:b})}function U(){var a=fa.viewport,b=fa.scissor_box;a[0]=a[1]=b[0]=b[1]=0;D.viewportWidth=D.framebufferWidth=D.drawingBufferWidth=a[2]=b[2]=I.drawingBufferWidth;D.viewportHeight=D.framebufferHeight=D.drawingBufferHeight=a[3]=b[3]=I.drawingBufferHeight}function S(){U();X.procs.poll()}function da(){U();X.procs.refresh()}var J=f(Array.prototype.slice.call(arguments)),
I=J.gl,V=J.options,J=b(),Z=d(),N=u(I).extensions,ea=T(I,N),ka=h(),Q=I.drawingBufferWidth,L=I.drawingBufferHeight,D={tick:0,time:0,viewportWidth:Q,viewportHeight:L,framebufferWidth:Q,framebufferHeight:L,drawingBufferWidth:Q,drawingBufferHeight:L,pixelRatio:V.pixelRatio},W=t(I,N),ha=B(I,Z),pa=E(I,N,ha,Z),Q=p(I,N,W,ha,J),sa=v(I,J,Z),ia=C(I,N,W,S,D,Z),qa=F(I,N,W,Z),ma=K(I,N,W,ia,qa,Z),L=A(I,S,D),X=m(I,J,N,W,ha,pa,ia,ma,{},Q,sa,{elements:null,primitive:4,count:-1,offset:0,instances:-1},D,ea),fa=X.next,
M=I.canvas,R=[],O=0;M&&(M.addEventListener("webglcontextlost",l,!1),M.addEventListener("webglcontextrestored",n,!1));da();return k(Y,{clear:function(a){var b=0;X.procs.poll();var c=a.color;c&&(I.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(I.clearDepth(+a.depth),b|=256);"stencil"in a&&(I.clearStencil(a.stencil|0),b|=1024);I.clear(b)},prop:a.define.bind(null,1),context:a.define.bind(null,2),"this":a.define.bind(null,3),draw:Y({}),buffer:function(a){return ha.create(a,34962)},
elements:pa.create,texture:ia.create2D,cube:ia.createCube,renderbuffer:qa.create,framebuffer:ma.create,framebufferCube:function(a){},attributes:I.getContextAttributes(),frame:function(a){R.push(a);!O&&0<R.length&&e();return{cancel:function(){var b=R.find(function(b){return b===a});0>b||(R.splice(b,1),0>=R.length&&O&&(c.cancel(e),O=0))}}},limits:W,hasExtension:function(a){return 0<=W.extensions.indexOf(a.toLowerCase())},read:L,destroy:function(){O&&(c.cancel(e),O=0);M&&(M.removeEventListener("webglcontextlost",
l),M.removeEventListener("webglcontextrestored",n));sa.clear();ma.clear();qa.clear();ia.clear();pa.clear();ha.clear();ea&&ea.clear();if(V.onDestroy)V.onDestroy()},_gl:I,_refresh:da,stats:Z,updateTimer:function(){ea&&ea.update()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,
"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},{},[1]);

        </script>
        </body>
      </html>