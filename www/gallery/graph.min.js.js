(function e$$0(n,r,l){function a(d,m){if(!r[d]){if(!n[d]){var c="function"==typeof require&&require;if(!m&&c)return c(d,!0);if(g)return g(d,!0);c=Error("Cannot find module '"+d+"'");throw c.code="MODULE_NOT_FOUND",c;}c=r[d]={exports:{}};n[d][0].call(c.exports,function(m){var c=n[d][1][m];return a(c?c:m)},c,c.exports,e$$0,n,r,l)}return r[d].exports}for(var g="function"==typeof require&&require,C=0;C<l.length;C++)a(l[C]);return a})({1:[function(h,n,r){function l(a){return[a%64,a/64|0]}function a(a){var d=
a.tick;G({framebuffer:I[0]},function(){g.clear({color:[0,0,0,1]});B();z({vertexState:c[(d+1)%2]})});for(a=0;4>a;++a)t({dest:I[(a+1)%2],src:I[a%2],axis:a%2});H({dest:I[1],src:I[0]});v({dest:c[(d+1)%2],src:c[d%2]});D({dest:c[d%2],src:c[(d+1)%2],field:I[1]})}var g=h("../regl")({extensions:["webgl_draw_buffers","oes_texture_float"]}),C=h("mouse-change")();h=.5/64;var d=new Float32Array(16384),m=new Float32Array(8192);(function(){for(var a=0;64>a;++a)for(var f=0;64>f;++f){var b=64*a+f;m[2*b]=a/64;m[2*
b+1]=f/64;d[4*b]=Math.random();d[4*b+1]=Math.random()}})();n=g.buffer(m);var c=[g.framebuffer({color:g.texture({radius:64,data:d,type:"float"}),depthStencil:!1}),g.framebuffer({radius:64,colorType:"float",depthStencil:!1})],w=[];(function(){for(var a=0;64>a;++a)for(var d=0;64>d;++d){if(63>a){var b=a+64*d,m=a+1+64*d;w.push([b,m],[m,b])}63>d&&(b=a+64*d,m=a+64*(d+1),w.push([b,m],[m,b]))}})();var I=[g.framebuffer({color:g.texture({type:"float",wrap:"repeat",radius:1024}),depthStencil:!1}),g.framebuffer({color:g.texture({type:"float",
wrap:"repeat",radius:1024}),depthStencil:!1})],G=g({framebuffer:g.prop("framebuffer")}),z=g({vert:"\n  precision highp float;\n  attribute vec2 id;\n  uniform sampler2D vertexState;\n  void main () {\n    vec4 state = texture2D(vertexState, id);\n    gl_Position = vec4(2.0 * fract(state.xy) - 1.0, 0, 1);\n  }",frag:"\n  precision highp float;\n  void main () {\n    gl_FragColor = vec4(1, 0, 0, 0);\n  }",attributes:{id:n},uniforms:{vertexState:g.prop("vertexState")},blend:{enable:!0,func:{src:1,dst:1},
equation:"add"},depth:{enable:!1,mask:!1},primitive:"points",count:4096,elements:null}),t=g({framebuffer:g.prop("dest"),vert:"\n  precision highp float;\n  attribute vec2 p;\n  varying vec2 uv;\n  void main () {\n    uv = 0.5 * (p + 1.0);\n    gl_Position = vec4(p, 0, 1);\n  }",frag:"\n  precision highp float;\n  uniform sampler2D src;\n  uniform vec2 axis;\n  varying vec2 uv;\n  void main () {\n    float f = 0.0;\n    for (int i = -16; i <= 16; ++i) {\n      f += (17.0 - abs(float(i))) / 33.0 *\n          texture2D(src, axis * float(i) + uv).r;\n    }\n    gl_FragColor = vec4(f, 0, 0, 1);\n  }",
attributes:{p:[-4,0,4,4,4,-4]},uniforms:{src:function(a,d){return d.src},axis:function(a,d){var b=[0,0];b[d.axis]=1/1024;return b}},depth:{enable:!1,mask:!1},count:3}),H=g({framebuffer:g.prop("dest"),vert:"\n  precision highp float;\n  attribute vec2 p;\n  varying vec2 uv;\n  void main () {\n    uv = 0.5 * (p + 1.0);\n    gl_Position = vec4(p, 0, 1);\n  }",frag:"\n  precision highp float;\n  uniform sampler2D src;\n  uniform vec2 deriv;\n  varying vec2 uv;\n  void main () {\n    float f01 = texture2D(src, uv - vec2(deriv.x, 0)).x;\n    float f21 = texture2D(src, uv + vec2(deriv.x, 0)).x;\n    float f10 = texture2D(src, uv - vec2(0, deriv.y)).x;\n    float f12 = texture2D(src, uv + vec2(0, deriv.y)).x;\n    gl_FragColor = vec4(f21 - f01, f12 - f10, 0, 1);\n  }",
attributes:{p:[-4,0,4,4,4,-4]},uniforms:{src:g.prop("src"),deriv:function(a,d){return[1/d.src.width,1/d.src.height]}},depth:{enable:!1,mask:!1},count:3}),v=g({framebuffer:g.prop("dest"),vert:"\n  precision highp float;\n  attribute vec4 edge;\n  varying vec2 force;\n  uniform sampler2D vertexState;\n  uniform float restLength, stiffness;\n  void main () {\n    vec4 s0 = texture2D(vertexState, edge.rg);\n    vec4 s1 = texture2D(vertexState, edge.ba);\n    vec2 d = s1.xy - s0.xy;\n    float l = max(length(d), 0.001);\n    force = stiffness * log(l / restLength) * d / l;\n    gl_Position = vec4(2.0 * edge.xy - 1.0 + 1.0 / 64.0, 0, 1);\n  }",
frag:"\n  precision highp float;\n  varying vec2 force;\n  void main () {\n    gl_FragColor = vec4(0, 0, force);\n  }",attributes:{edge:w.map(function(a){var d=l(a[0]);a=l(a[1]);return[d[0]/64,d[1]/64,a[0]/64,a[1]/64]})},uniforms:{vertexState:g.prop("src"),restLength:h,stiffness:.08},blend:{enable:!0,func:{src:1,dst:1},equation:"add"},depth:{enable:!1,mask:!1},count:w.length,primitive:"points"}),D=g({framebuffer:g.prop("dest"),vert:"\n  precision highp float;\n  attribute vec2 p;\n  varying vec2 id;\n  void main () {\n    id = 0.5 * (p + 1.0);\n    gl_Position = vec4(p, 0, 1);\n  }",
frag:"\n  precision highp float;\n  uniform sampler2D vertexState, field;\n  uniform float temperature, t;\n  varying vec2 id;\n\n  float rnd (vec2 co) {\n  \treturn fract(sin(t*0.1+dot(co.xy, vec2(12.9898,78.233))) * 43758.5453);\n  }\n\n  void main () {\n    vec4 state = texture2D(vertexState, id);\n    vec2 p = state.rg;\n    vec2 v = state.ba;\n    vec2 force = texture2D(field, p).xy;\n    p += 1.0E-4 * v;\n    v = float(0.98) * (v - float(0.05) * force);\n    vec2 jitter = vec2(rnd(id), rnd(id + 1000.0)) - 0.5;\n    gl_FragColor = vec4(p + temperature * jitter, v);\n  }",
attributes:{p:[-4,0,4,-4,4,4]},uniforms:{vertexState:g.prop("src"),field:g.prop("field"),temperature:function(a){return 1/(.5*a.tick+20)},t:g.context("tick")},count:3}),k=g({vert:"\n  precision highp float;\n  attribute vec2 id;\n  uniform sampler2D vertexState;\n  void main () {\n    vec4 state = texture2D(vertexState, id);\n    gl_PointSize = 2.0;\n    gl_Position = vec4(2.0 * fract(state.xy) - 1.0, 0, 1);\n  }",frag:"\n  precision highp float;\n  void main () {\n    gl_FragColor = vec4(0, 0, 0, 1);\n  }",
attributes:{id:n},uniforms:{vertexState:function(a){return c[a.tick%2]}},depth:{enable:!1,mask:!1},primitive:"points",count:4096,elements:null}),f=g({vert:"\n  precision highp float;\n  attribute vec4 id;\n  attribute float arcDir;\n  uniform float dir;\n  uniform sampler2D vertexState;\n  void main () {\n    float side = arcDir + dir - 2.0 * dir * arcDir;\n    vec2 s0 = texture2D(vertexState, id.rg).xy;\n    vec2 s1 = texture2D(vertexState, id.ba).xy;\n    vec2 shift = mix(fract(s0) - s0, fract(s1) - s1, side);\n    gl_Position = vec4(2.0 * (s0.xy + shift) - 1.0, 0, 1);\n  }",
frag:"\n  void main () {\n    gl_FragColor = vec4(0.1, 0, 1, 1);\n  }",attributes:{id:w.map(function(a){var d=l(a[0]);a=l(a[1]);return[d[0]/64,d[1]/64,a[0]/64,a[1]/64]}),arcDir:w.map(function(a,d){return d%2})},uniforms:{vertexState:function(a){return c[a.tick%2]},dir:g.prop("dir")},depth:{enable:!1,mask:!1},count:w.length,primitive:"lines",lineWidth:2}),B=g({vert:"\n  uniform vec2 mouse;\n  attribute float p;\n  void main () {\n    gl_PointSize = 32.0;\n    gl_Position = vec4(mouse, p, 1);\n  }",
frag:"\n  precision highp float;\n  uniform float strength;\n  void main () {\n    float s = strength * exp(-16.0 * dot(gl_PointCoord.xy, gl_PointCoord.xy));\n    gl_FragColor = vec4(s, 0, 0, 1);\n  }",attributes:{p:[0]},uniforms:{mouse:function(a){var d=a.pixelRatio;return[2*d*C.x/a.drawingBufferWidth-1,1-2*d*C.y/a.drawingBufferHeight]},strength:function(){return C.buttons?5:1}},count:1,primitive:"points"});g.frame(function(d){a(d);g.clear({color:[1,1,1,1]});f([{dir:0},{dir:1}]);k()})},{"../regl":35,
"mouse-change":33}],2:[function(h,n,r){function l(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}n.exports=function(a,g,C,d,m){a=C.maxAttributes;g=Array(a);for(C=0;C<a;++C)g[C]=new l;return{Record:l,scope:{},state:g}}},{}],3:[function(h,n,r){function l(a){return I[Object.prototype.toString.call(a)]|0}function a(a,d){for(var m=0;m<d.length;++m)a[m]=d[m]}function g(a,d,m,c,f,g,l){for(var w=0,b=0;b<m;++b)for(var F=
0;F<c;++F)a[w++]=d[f*b+g*F+l]}function C(a,d,m){for(var c=0,f=0;f<d.length;++f)for(var g=d[f],l=0;l<m;++l)a[c++]=g[l]}var d=h("./util/is-typed-array"),m=h("./util/is-ndarray"),c=h("./util/values"),w=h("./util/pool"),I=h("./constants/arraytypes.json"),G=h("./constants/dtypes.json"),z=h("./constants/usage.json"),t=[];t[5120]=1;t[5122]=2;t[5124]=4;t[5121]=1;t[5123]=2;t[5125]=4;t[5126]=4;n.exports=function(h,v,n){function k(a){this.id=q++;this.buffer=h.createBuffer();this.type=a;this.usage=35044;this.byteLength=
0;this.dimension=1;this.dtype=5121;this.persistentData=null;n.profile&&(this.stats={size:0})}function f(a,d,b){a.byteLength=d.byteLength;h.bufferData(a.type,d,b)}function B(b,c,h,k,q,F){b.usage=h;if(Array.isArray(c))b.dtype=k||5126,0<c.length&&(Array.isArray(c[0])?(b.dimension=c[0].length,k=w.allocType(b.dtype,c.length*b.dimension),C(k,c,b.dimension),f(b,k,h),F?b.persistentData=k:w.freeType(k)):"number"===typeof c[0]?(b.dimension=q,k=w.allocType(b.dtype,c.length),a(k,c),f(b,k,h),F?b.persistentData=
k:w.freeType(k)):d(c[0])&&(b.dimension=c[0].length,b.dtype=k||l(c[0])||5126,k=w.allocType(b.dtype,c.length*b.dimension),C(k,c,b.dimension),f(b,k,h),F?b.persistentData=k:w.freeType(k)));else if(d(c))b.dtype=k||l(c),b.dimension=q,f(b,c,h),F&&(b.persistentData=new Uint8Array(new Uint8Array(c.buffer)));else if(m(c)){var t=c.shape,v=c.stride;q=c.offset;var B=0,z=0,p=0,W=0;1===t.length?(B=t[0],z=1,p=v[0],W=0):2===t.length&&(B=t[0],z=t[1],p=v[0],W=v[1]);b.dtype=k||l(c.data)||5126;b.dimension=z;k=w.allocType(b.dtype,
B*z);g(k,c.data,B,z,p,W,q);f(b,k,h);F?b.persistentData=k:w.freeType(k)}}function A(a){v.bufferCount--;h.deleteBuffer(a.buffer);a.buffer=null;delete b[a.id]}var q=0,b={};k.prototype.bind=function(){h.bindBuffer(this.type,this.buffer)};k.prototype.destroy=function(){A(this)};var F=[];n.profile&&(v.getTotalBufferSize=function(){var a=0;Object.keys(b).forEach(function(d){a+=b[d].stats.size});return a});return{create:function(c,f,F,q){function I(a){var b=35044,c=null,f=0,g=0,k=1;Array.isArray(a)||d(a)||
m(a)?c=a:"number"===typeof a?f=a|0:a&&("data"in a&&(c=a.data),"usage"in a&&(b=z[a.usage]),"type"in a&&(g=G[a.type]),"dimension"in a&&(k=a.dimension|0),"length"in a&&(f=a.length|0));r.bind();c?B(r,c,b,g,k,q):(h.bufferData(r.type,f,b),r.dtype=g||5121,r.usage=b,r.dimension=k,r.byteLength=f);n.profile&&(r.stats.size=r.byteLength*t[r.dtype]);return I}v.bufferCount++;var r=new k(f);b[r.id]=r;F||I(c);I._reglType="buffer";I._buffer=r;I.subdata=function(b,c){var f=(c||0)|0;r.bind();if(Array.isArray(b)){if(0<
b.length)if("number"===typeof b[0]){var k=w.allocType(r.dtype,b.length);a(k,b);h.bufferSubData(r.type,f,k);w.freeType(k)}else if(Array.isArray(b[0])||d(b[0])){var k=b[0].length,p=w.allocType(r.dtype,b.length*k);C(p,b,k);h.bufferSubData(r.type,f,p);w.freeType(p)}}else if(d(b))h.bufferSubData(r.type,f,b);else if(m(b)){var F=b.shape,q=b.stride,t=p=k=0,v=0;1===F.length?(k=F[0],p=1,t=q[0],v=0):2===F.length&&(k=F[0],p=F[1],t=q[0],v=q[1]);F=Array.isArray(b.data)?r.dtype:l(b.data);F=w.allocType(F,k*p);g(F,
b.data,k,p,t,v,b.offset);h.bufferSubData(r.type,f,F);w.freeType(F)}return I};n.profile&&(I.stats=r.stats);I.destroy=function(){A(r)};return I},createStream:function(a,b){var d=F.pop();d||(d=new k(a));d.bind();B(d,b,35040,0,1,!1);return d},destroyStream:function(a){F.push(a)},clear:function(){c(b).forEach(A);F.forEach(A)},getBuffer:function(a){return a&&a._buffer instanceof k?a._buffer:null},restore:function(){c(b).forEach(function(a){a.buffer=h.createBuffer();h.bindBuffer(a.type,a.buffer);h.bufferData(a.type,
a.persistentData||a.byteLength,a.usage)})},_initBuffer:B}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],4:[function(h,n,r){n.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,
"[object ArrayBuffer]":5121}},{}],5:[function(h,n,r){n.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(h,n,r){n.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(h,n,r){n.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(h,n,r){function l(a){return Array.isArray(a)||I(a)||G(a)}function a(a){return a.sort(function(a,
b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function g(a,b,d,c){this.thisDep=a;this.contextDep=b;this.propDep=d;this.append=c}function C(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function d(a){return new g(!1,!1,!1,a)}function m(a,b){var d=a.type;return 0===d?(d=a.data.length,new g(!0,1<=d,2<=d,b)):4===d?(d=a.data,new g(d.thisDep,d.contextDep,d.propDep,b)):new g(3===d,2===d,1===d,b)}var c=h("./util/codegen"),w=h("./util/loop"),I=h("./util/is-typed-array"),G=h("./util/is-ndarray"),
z=h("./util/is-array-like"),t=h("./dynamic"),H=h("./constants/primitives.json"),v=h("./constants/dtypes.json"),D=["x","y","z","w"],k="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),f={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,
"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},B={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},A={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},q={cw:2304,ccw:2305},b=new g(!1,!1,!1,function(){});n.exports=function(h,n,r,I,G,ka,la,N,ta,ma,ua,p,W,X,ga){function T(a){return a.replace(".",
"_")}function K(a,e,b){var d=T(a);Ga.push(a);x[d]=y[d]=!!b;va[d]=e}function E(a,e,b){var d=T(a);Ga.push(a);Array.isArray(b)?(y[d]=b.slice(),x[d]=b.slice()):y[d]=x[d]=b;wa[d]=e}function xa(){var a=c(),e=a.link,b=a.global;a.id=Pa++;a.batchId="0";var d=e(Na),m=a.shared={props:"a0"};Object.keys(Na).forEach(function(a){m[a]=b.def(d,".",a)});var f=a.next={},M=a.current={};Object.keys(wa).forEach(function(a){Array.isArray(y[a])&&(f[a]=b.def(m.next,".",a),M[a]=b.def(m.current,".",a))});var Qa=a.constants=
{};Object.keys(Ha).forEach(function(a){Qa[a]=b.def(JSON.stringify(Ha[a]))});a.invoke=function(O,b){switch(b.type){case 0:var d=["this",m.context,m.props,a.batchId];return O.def(e(b.data),".call(",d.slice(0,Math.max(b.data.length+1,4)),")");case 1:return O.def(m.props,b.data);case 2:return O.def(m.context,b.data);case 3:return O.def("this",b.data);case 4:return b.data.append(a,O),b.data.ref}};a.attribCache={};var O={};a.scopeAttrib=function(a){a=n.id(a);if(a in O)return O[a];var b=ma.scope[a];b||(b=
ma.scope[a]=new aa);return O[a]=e(b)};return a}function na(a){var e=a["static"];a=a.dynamic;var b;if("profile"in e){var c=!!e.profile;b=d(function(a,e){return c});b.enable=c}else if("profile"in a){var f=a.profile;b=m(f,function(a,e){return a.invoke(e,f)})}return b}function ya(a,e){var b=a["static"],c=a.dynamic;if("framebuffer"in b){var f=b.framebuffer;return f?(f=N.getFramebuffer(f),d(function(a,e){var b=a.link(f),u=a.shared;e.set(u.framebuffer,".next",b);u=u.context;e.set(u,".framebufferWidth",b+
".width");e.set(u,".framebufferHeight",b+".height");return b})):d(function(a,e){var b=a.shared;e.set(b.framebuffer,".next","null");b=b.context;e.set(b,".framebufferWidth",b+".drawingBufferWidth");e.set(b,".framebufferHeight",b+".drawingBufferHeight");return"null"})}if("framebuffer"in c){var Oa=c.framebuffer;return m(Oa,function(a,e){var b=a.invoke(e,Oa),u=a.shared,d=u.framebuffer,b=e.def(d,".getFramebuffer(",b,")");e.set(d,".next",b);u=u.context;e.set(u,".framebufferWidth",b+"?"+b+".width:"+u+".drawingBufferWidth");
e.set(u,".framebufferHeight",b+"?"+b+".height:"+u+".drawingBufferHeight");return b})}return null}function Q(a,e,b){function d(a){if(a in c){var b=c[a];a=!0;var u=b.x|0,Aa=b.y|0,M,Ma;"width"in b?M=b.width|0:a=!1;"height"in b?Ma=b.height|0:a=!1;return new g(!a&&e&&e.thisDep,!a&&e&&e.contextDep,!a&&e&&e.propDep,function(a,e){var d=a.shared.context,L=M;"width"in b||(L=e.def(d,".","framebufferWidth","-",u));var c=Ma;"height"in b||(c=e.def(d,".","framebufferHeight","-",Aa));return[u,Aa,L,c]})}if(a in f){var k=
f[a];a=m(k,function(a,e){var b=a.invoke(e,k),u=a.shared.context,d=e.def(b,".x|0"),O=e.def(b,".y|0"),Aa=e.def('"width" in ',b,"?",b,".width|0:","(",u,".","framebufferWidth","-",d,")"),b=e.def('"height" in ',b,"?",b,".height|0:","(",u,".","framebufferHeight","-",O,")");return[d,O,Aa,b]});e&&(a.thisDep=a.thisDep||e.thisDep,a.contextDep=a.contextDep||e.contextDep,a.propDep=a.propDep||e.propDep);return a}return e?new g(e.thisDep,e.contextDep,e.propDep,function(a,e){var b=a.shared.context;return[0,0,e.def(b,
".","framebufferWidth"),e.def(b,".","framebufferHeight")]}):null}var c=a["static"],f=a.dynamic;if(a=d("viewport")){var M=a;a=new g(a.thisDep,a.contextDep,a.propDep,function(a,e){var b=M.append(a,e),u=a.shared.context;e.set(u,".viewportWidth",b[2]);e.set(u,".viewportHeight",b[3]);return b})}return{viewport:a,scissor_box:d("scissor.box")}}function da(a){function e(a){if(a in b){var u=n.id(b[a]);a=d(function(){return u});a.id=u;return a}if(a in c){var L=c[a];return m(L,function(a,e){var b=a.invoke(e,
L);return e.def(a.shared.strings,".id(",b,")")})}return null}var b=a["static"],c=a.dynamic,f=e("frag"),k=e("vert"),M=null;C(f)&&C(k)?(M=ua.program(k.id,f.id),a=d(function(a,e){return a.link(M)})):a=new g(f&&f.thisDep||k&&k.thisDep,f&&f.contextDep||k&&k.contextDep,f&&f.propDep||k&&k.propDep,function(a,e){var b=a.shared.shader,u;u=f?f.append(a,e):e.def(b,".","frag");var d;d=k?k.append(a,e):e.def(b,".","vert");return e.def(b+".program("+d+","+u+")")});return{frag:f,vert:k,progVar:a,program:M}}function ea(a,
e){function b(a,e){if(a in c){var u=c[a]|0;return d(function(a,b){e&&(a.OFFSET=u);return u})}if(a in f){var Aa=f[a];return m(Aa,function(a,b){var u=a.invoke(b,Aa);e&&(a.OFFSET=u);return u})}return e&&k?d(function(a,e){a.OFFSET="0";return 0}):null}var c=a["static"],f=a.dynamic,k=function(){if("elements"in c){var a=c.elements;l(a)?a=ka.getElements(ka.create(a,!0)):a&&(a=ka.getElements(a));var e=d(function(e,b){if(a){var u=e.link(a);return e.ELEMENTS=u}return e.ELEMENTS=null});e.value=a;return e}if("elements"in
f){var b=f.elements;return m(b,function(a,e){var u=a.shared,d=u.isBufferArgs,u=u.elements,O=a.invoke(e,b),c=e.def("null"),d=e.def(d,"(",O,")"),O=a.cond(d).then(c,"=",u,".createStream(",O,");")["else"](c,"=",u,".getElements(",O,");");e.entry(O);e.exit(a.cond(d).then(u,".destroyStream(",c,");"));return a.ELEMENTS=c})}return null}(),M=b("offset",!0);return{elements:k,primitive:function(){if("primitive"in c){var a=c.primitive;return d(function(e,b){return H[a]})}if("primitive"in f){var e=f.primitive;
return m(e,function(a,b){var u=a.constants.primTypes,d=a.invoke(b,e);return b.def(u,"[",d,"]")})}return k?C(k)?k.value?d(function(a,e){return e.def(a.ELEMENTS,".primType")}):d(function(){return 4}):new g(k.thisDep,k.contextDep,k.propDep,function(a,e){var b=a.ELEMENTS;return e.def(b,"?",b,".primType:",4)}):null}(),count:function(){if("count"in c){var a=c.count|0;return d(function(){return a})}if("count"in f){var e=f.count;return m(e,function(a,b){return a.invoke(b,e)})}return k?C(k)?k?M?new g(M.thisDep,
M.contextDep,M.propDep,function(a,e){return e.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):d(function(a,e){return e.def(a.ELEMENTS,".vertCount")}):d(function(){return-1}):new g(k.thisDep||M.thisDep,k.contextDep||M.contextDep,k.propDep||M.propDep,function(a,e){var b=a.ELEMENTS;return a.OFFSET?e.def(b,"?",b,".vertCount-",a.OFFSET,":-1"):e.def(b,"?",b,".vertCount:-1")}):null}(),instances:b("instances",!1),offset:M}}function pa(a,e){var b=a["static"],c=a.dynamic,k={};Ga.forEach(function(a){function e(O,L){if(a in
b){var f=O(b[a]);k[u]=d(function(){return f})}else if(a in c){var M=c[a];k[u]=m(M,function(a,e){return L(a,e,a.invoke(e,M))})}}var u=T(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return e(function(a){return a},function(a,e,b){return b});case "depth.func":return e(function(a){return B[a]},function(a,e,b){return e.def(a.constants.compareFuncs,
"[",b,"]")});case "depth.range":return e(function(a){return a},function(a,e,b){a=e.def("+",b,"[0]");e=e.def("+",b,"[1]");return[a,e]});case "blend.func":return e(function(a){return[f["srcRGB"in a?a.srcRGB:a.src],f["dstRGB"in a?a.dstRGB:a.dst],f["srcAlpha"in a?a.srcAlpha:a.src],f["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,e,b){function u(a,d){return e.def('"',a,d,'" in ',b,"?",b,".",a,d,":",b,".",a)}a=a.constants.blendFuncs;var d=u("src","RGB"),c=u("dst","RGB"),d=e.def(a,"[",d,"]"),L=e.def(a,"[",
u("src","Alpha"),"]"),c=e.def(a,"[",c,"]");a=e.def(a,"[",u("dst","Alpha"),"]");return[d,c,L,a]});case "blend.equation":return e(function(a){if("string"===typeof a)return[ha[a],ha[a]];if("object"===typeof a)return[ha[a.rgb],ha[a.alpha]]},function(a,e,b){var u=a.constants.blendEquations,d=e.def(),c=e.def();a=a.cond("typeof ",b,'==="string"');a.then(d,"=",c,"=",u,"[",b,"];");a["else"](d,"=",u,"[",b,".rgb];",c,"=",u,"[",b,".alpha];");e(a);return[d,c]});case "blend.color":return e(function(a){return w(4,
function(e){return+a[e]})},function(a,e,b){return w(4,function(a){return e.def("+",b,"[",a,"]")})});case "stencil.mask":return e(function(a){return a|0},function(a,e,b){return e.def(b,"|0")});case "stencil.func":return e(function(a){return[B[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,e,b){a=e.def('"cmp" in ',b,"?",a.constants.compareFuncs,"[",b,".cmp]",":",7680);var u=e.def(b,".ref|0");e=e.def('"mask" in ',b,"?",b,".mask|0:-1");return[a,u,e]});case "stencil.opFront":case "stencil.opBack":return e(function(e){return["stencil.opBack"===
a?1029:1028,A[e.fail||"keep"],A[e.zfail||"keep"],A[e.zpass||"keep"]]},function(e,b,u){function d(a){return b.def('"',a,'" in ',u,"?",c,"[",u,".",a,"]:",7680)}var c=e.constants.stencilOps;return["stencil.opBack"===a?1029:1028,d("fail"),d("zfail"),d("zpass")]});case "polygonOffset.offset":return e(function(a){return[a.factor|0,a.units|0]},function(a,e,b){a=e.def(b,".factor|0");e=e.def(b,".units|0");return[a,e]});case "cull.face":return e(function(a){var e=0;"front"===a?e=1028:"back"===a&&(e=1029);return e},
function(a,e,b){return e.def(b,'==="front"?',1028,":",1029)});case "lineWidth":return e(function(a){return a},function(a,e,b){return b});case "frontFace":return e(function(a){return q[a]},function(a,e,b){return e.def(b+'==="cw"?2304:2305')});case "colorMask":return e(function(a){return a.map(function(a){return!!a})},function(a,e,b){return w(4,function(a){return"!!"+b+"["+a+"]"})});case "sample.coverage":return e(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,e,b){a=e.def('"value" in ',
b,"?+",b,".value:1");e=e.def("!!",b,".invert");return[a,e]})}});return k}function fa(a,e){var b=a["static"],c=a.dynamic,f={};Object.keys(b).forEach(function(a){var e=b[a],u;if("number"===typeof e||"boolean"===typeof e)u=d(function(){return e});else if("function"===typeof e){var c=e._reglType;if("texture2d"===c||"textureCube"===c)u=d(function(a){return a.link(e)});else if("framebuffer"===c||"framebufferCube"===c)u=d(function(a){return a.link(e.color[0])})}else z(e)&&(u=d(function(a){return a.global.def("[",
w(e.length,function(a){return e[a]}),"]")}));u.value=e;f[a]=u});Object.keys(c).forEach(function(a){var e=c[a];f[a]=m(e,function(a,b){return a.invoke(b,e)})});return f}function U(a,e){var b=a["static"],c=a.dynamic,f={};Object.keys(b).forEach(function(a){var e=b[a],u=n.id(a),c=new aa;if(l(e))c.state=1,c.buffer=G.getBuffer(G.create(e,34962,!1,!0)),c.type=0;else{var L=G.getBuffer(e);if(L)c.state=1,c.buffer=L,c.type=0;else if(e.constant){var k=e.constant;c.buffer="null";c.state=2;"number"===typeof k?c.x=
k:D.forEach(function(a,e){e<k.length&&(c[a]=k[e])})}else{var L=l(e.buffer)?G.getBuffer(G.create(e.buffer,34962,!1,!0)):G.getBuffer(e.buffer),m=e.offset|0,g=e.stride|0,x=e.size|0,y=!!e.normalized,p=0;"type"in e&&(p=v[e.type]);e=e.divisor|0;c.buffer=L;c.state=1;c.size=x;c.normalized=y;c.type=p||L.dtype;c.offset=m;c.stride=g;c.divisor=e}}f[a]=d(function(a,e){var b=a.attribCache;if(u in b)return b[u];var d={isStream:!1};Object.keys(c).forEach(function(a){d[a]=c[a]});c.buffer&&(d.buffer=a.link(c.buffer),
d.type=d.type||d.buffer+".dtype");return b[u]=d})});Object.keys(c).forEach(function(a){var e=c[a];f[a]=m(e,function(a,b){function u(a){b(k[a],"=",d,".",a,"|0;")}var d=a.invoke(b,e),c=a.shared,L=c.isBufferArgs,f=c.buffer,k={isStream:b.def(!1)},m=new aa;m.state=1;Object.keys(m).forEach(function(a){k[a]=b.def(""+m[a])});var g=k.buffer,x=k.type;b("if(",L,"(",d,")){",k.isStream,"=true;",g,"=",f,".createStream(",34962,",",d,");",x,"=",g,".dtype;","}else{",g,"=",f,".getBuffer(",d,");","if(",g,"){",x,"=",
g,".dtype;",'}else if("constant" in ',d,"){",k.state,"=",2,";","if(typeof "+d+'.constant === "number"){',k[D[0]],"=",d,".constant;",D.slice(1).map(function(a){return k[a]}).join("="),"=0;","}else{",D.map(function(a,e){return k[a]+"="+d+".constant.length>="+e+"?"+d+".constant["+e+"]:0;"}).join(""),"}}else{","if(",L,"(",d,".buffer)){",g,"=",f,".createStream(",34962,",",d,".buffer);","}else{",g,"=",f,".getBuffer(",d,".buffer);","}",x,'="type" in ',d,"?",c.glTypes,"[",d,".type]:",g,".dtype;",k.normalized,
"=!!",d,".normalized;");u("size");u("offset");u("stride");u("divisor");b("}}");b.exit("if(",k.isStream,"){",f,".destroyStream(",g,");","}");return k})});return f}function qa(a){var e=a["static"],b=a.dynamic,c={};Object.keys(e).forEach(function(a){var b=e[a];c[a]=d(function(a,e){return"number"===typeof b||"boolean"===typeof b?""+b:a.link(b)})});Object.keys(b).forEach(function(a){var e=b[a];c[a]=m(e,function(a,b){return a.invoke(b,e)})});return c}function oa(a,e,b,d,c){var f=ya(a,c),k=Q(a,f,c),m=ea(a,
c),g=pa(a,c),x=da(a,c),y=k.viewport;y&&(g.viewport=y);y=T("scissor.box");(k=k[y])&&(g[y]=k);k=0<Object.keys(g).length;f={framebuffer:f,draw:m,shader:x,state:g,dirty:k};f.profile=na(a,c);f.uniforms=fa(b,c);f.attributes=U(e,c);f.context=qa(d,c);return f}function J(a,e,b){var d=a.shared.context,c=a.scope();Object.keys(b).forEach(function(f){e.save(d,"."+f);c(d,".",f,"=",b[f].append(a,e),";")});e(c)}function Y(a,b,d,c){var f=a.shared,k=f.gl,m=f.framebuffer,g;e&&(g=b.def(f.extensions,".webgl_draw_buffers"));
var x=a.constants,f=x.drawBuffer,x=x.backBuffer;a=d?d.append(a,b):b.def(m,".next");c||b("if(",a,"!==",m,".cur){");b("if(",a,"){",k,".bindFramebuffer(",36160,",",a,".framebuffer);");e&&b(g,".drawBuffersWEBGL(",f,"[",a,".colorAttachments.length]);");b("}else{",k,".bindFramebuffer(",36160,",null);");e&&b(g,".drawBuffersWEBGL(",x,");");b("}",m,".cur=",a,";");c||b("}")}function ba(a,e,b){var d=a.shared,c=d.gl,f=a.current,k=a.next,m=d.current,g=d.next,x=a.cond(m,".dirty");Ga.forEach(function(e){e=T(e);
if(!(e in b.state)){var d,L;if(e in k){d=k[e];L=f[e];var p=w(y[e].length,function(a){return x.def(d,"[",a,"]")});x(a.cond(p.map(function(a,e){return a+"!=="+L+"["+e+"]"}).join("||")).then(c,".",wa[e],"(",p,");",p.map(function(a,e){return L+"["+e+"]="+a}).join(";"),";"))}else d=x.def(g,".",e),p=a.cond(d,"!==",m,".",e),x(p),e in va?p(a.cond(d).then(c,".enable(",va[e],");")["else"](c,".disable(",va[e],");"),m,".",e,"=",d,";"):p(c,".",wa[e],"(",d,");",m,".",e,"=",d,";")}});0===Object.keys(b.state).length&&
x(m,".dirty=false;");e(x)}function P(e,b,d,c){var f=e.shared,k=e.current,m=f.current,g=f.gl;a(Object.keys(d)).forEach(function(a){var f=d[a];if(!c||c(f)){var x=f.append(e,b);if(va[a]){var y=va[a];C(f)?x?b(g,".enable(",y,");"):b(g,".disable(",y,");"):b(e.cond(x).then(g,".enable(",y,");")["else"](g,".disable(",y,");"));b(m,".",a,"=",x,";")}else if(z(x)){var p=k[a];b(g,".",wa[a],"(",x,");",x.map(function(a,e){return p+"["+e+"]="+a}).join(";"),";")}else b(g,".",wa[a],"(",x,");",m,".",a,"=",x,";")}})}
function R(a,e){ia&&(a.instancing=e.def(a.shared.extensions,".angle_instanced_arrays"))}function S(a,e,b,d,c){function f(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function k(a){h=e.def();a(h,"=",f(),";");"string"===typeof c?a(y,".count+=",c,";"):a(y,".count++;");X&&(d?(q=e.def(),a(q,"=",l,".getNumPendingQueries();")):a(l,".beginQuery(",y,");"))}function m(a){a(y,".cpuTime+=",f(),"-",h,";");X&&(d?a(l,".pushScopeStats(",q,",",l,".getNumPendingQueries(),",y,");"):a(l,
".endQuery();"))}function g(a){var b=e.def(p,".profile");e(p,".profile=",a,";");e.exit(p,".profile=",b,";")}var x=a.shared,y=a.stats,p=x.current,l=x.timer;b=b.profile;var h,q;if(b){if(C(b)){b.enable?(k(e),m(e.exit),g("true")):g("false");return}b=b.append(a,e);g(b)}else b=e.def(p,".profile");x=a.block();k(x);e("if(",b,"){",x,"}");a=a.block();m(a);e.exit("if(",b,"){",a,"}")}function V(a,e,d,c,f){function k(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;
case 35666:case 35669:case 35673:return 4;default:return 1}}function m(b,d,c){function f(){e("if(!",p,".buffer){",g,".enableVertexAttribArray(",y,");}");var b=c.type,k;k=c.size?e.def(c.size,"||",d):d;e("if(",p,".type!==",b,"||",p,".size!==",k,"||",q.map(function(a){return p+"."+a+"!=="+c[a]}).join("||"),"){",g,".bindBuffer(",34962,",",l,".buffer);",g,".vertexAttribPointer(",[y,k,b,c.normalized,c.stride,c.offset],");",p,".type=",b,";",p,".size=",k,";",q.map(function(a){return p+"."+a+"="+c[a]+";"}).join(""),
"}");ia&&(b=c.divisor,e("if(",p,".divisor!==",b,"){",a.instancing,".vertexAttribDivisorANGLE(",[y,b],");",p,".divisor=",b,";}"))}function k(){e("if(",p,".buffer){",g,".disableVertexAttribArray(",y,");","}if(",D.map(function(a,e){return p+"."+a+"!=="+h[e]}).join("||"),"){",g,".vertexAttrib4f(",y,",",h,");",D.map(function(a,e){return p+"."+a+"="+h[e]+";"}).join(""),"}")}var g=x.gl,y=e.def(b,".location"),p=e.def(x.attributes,"[",y,"]");b=c.state;var l=c.buffer,h=[c.x,c.y,c.z,c.w],q=["buffer","normalized",
"offset","stride"];1===b?f():2===b?k():(e("if(",b,"===",1,"){"),f(),e("}else{"),k(),e("}"))}var x=a.shared;c.forEach(function(c){var g=c.name,x=d.attributes[g],y;if(x){if(!f(x))return;y=x.append(a,e)}else{if(!f(b))return;var p=a.scopeAttrib(g);y={};Object.keys(new aa).forEach(function(a){y[a]=e.def(p,".",a)})}m(a.link(c),k(c.info.type),y)})}function ca(a,e,d,c,f){for(var k=a.shared,m=k.gl,g,x=0;x<c.length;++x){var y=c[x],p=y.name,l=y.info.type,h=d.uniforms[p],y=a.link(y)+".location",q;if(h){if(!f(h))continue;
if(C(h)){p=h.value;if(35678===l||35680===l)l=a.link(p._texture||p.color[0]._texture),e(m,".uniform1i(",y,",",l+".bind());"),e.exit(l,".unbind();");else if(35674===l||35675===l||35676===l)p=a.global.def("new Float32Array(["+Array.prototype.slice.call(p)+"])"),h=2,35675===l?h=3:35676===l&&(h=4),e(m,".uniformMatrix",h,"fv(",y,",false,",p,");");else{switch(l){case 5126:g="1f";break;case 35664:g="2f";break;case 35665:g="3f";break;case 35666:g="4f";break;case 35670:g="1i";break;case 5124:g="1i";break;case 35671:g=
"2i";break;case 35667:g="2i";break;case 35672:g="3i";break;case 35668:g="3i";break;case 35673:g="4i";break;case 35669:g="4i"}e(m,".uniform",g,"(",y,",",z(p)?Array.prototype.slice.call(p):p,");")}continue}else q=h.append(a,e)}else{if(!f(b))continue;q=e.def(k.uniforms,"[",n.id(p),"]")}35678===l?e("if(",q,"&&",q,'._reglType==="framebuffer"){',q,"=",q,".color[0];","}"):35680===l&&e("if(",q,"&&",q,'._reglType==="framebufferCube"){',q,"=",q,".color[0];","}");p=1;switch(l){case 35678:case 35680:l=e.def(q,
"._texture");e(m,".uniform1i(",y,",",l,".bind());");e.exit(l,".unbind();");continue;case 5124:case 35670:g="1i";break;case 35667:case 35671:g="2i";p=2;break;case 35668:case 35672:g="3i";p=3;break;case 35669:case 35673:g="4i";p=4;break;case 5126:g="1f";break;case 35664:g="2f";p=2;break;case 35665:g="3f";p=3;break;case 35666:g="4f";p=4;break;case 35674:g="Matrix2fv";break;case 35675:g="Matrix3fv";break;case 35676:g="Matrix4fv"}e(m,".uniform",g,"(",y,",");if("M"===g.charAt(0)){var y=Math.pow(l-35674+
2,2),t=a.global.def("new Float32Array(",y,")");e("false,(Array.isArray(",q,")||",q," instanceof Float32Array)?",q,":(",w(y,function(a){return t+"["+a+"]="+q+"["+a+"]"}),",",t,")")}else 1<p?e(w(p,function(a){return q+"["+a+"]"})):e(q);e(");")}}function Z(a,e,b,d){function c(f){var k=y[f];return k?k.contextDep&&d.contextDynamic||k.propDep?k.append(a,b):k.append(a,e):e.def(x,".",f)}function f(){function a(){b(w,".drawElementsInstancedANGLE(",[l,q,v,h+"<<(("+v+"-5121)>>1)",t],");")}function e(){b(w,".drawArraysInstancedANGLE(",
[l,h,q,t],");")}p?F?a():(b("if(",p,"){"),a(),b("}else{"),e(),b("}")):e()}function k(){function a(){b(m+".drawElements("+[l,q,v,h+"<<(("+v+"-5121)>>1)"]+");")}function e(){b(m+".drawArrays("+[l,h,q]+");")}p?F?a():(b("if(",p,"){"),a(),b("}else{"),e(),b("}")):e()}var g=a.shared,m=g.gl,x=g.draw,y=d.draw,p=function(){var c=y.elements,f=e;if(c){if(c.contextDep&&d.contextDynamic||c.propDep)f=b;c=c.append(a,f)}else c=f.def(x,".","elements");c&&f("if("+c+")"+m+".bindBuffer(34963,"+c+".buffer.buffer);");return c}(),
l=c("primitive"),h=c("offset"),q=function(){var c=y.count,f=e;if(c){if(c.contextDep&&d.contextDynamic||c.propDep)f=b;c=c.append(a,f)}else c=f.def(x,".","count");return c}();if("number"===typeof q){if(0===q)return}else b("if(",q,"){"),b.exit("}");var t,w;ia&&(t=c("instances"),w=a.instancing);var v=p+".type",F=y.elements&&C(y.elements);ia&&("number"!==typeof t||0<=t)?"string"===typeof t?(b("if(",t,">0){"),f(),b("}else if(",t,"<0){"),k(),b("}")):f():k()}function Ba(a,e,b,d,c){e=xa();c=e.proc("body",
c);ia&&(e.instancing=c.def(e.shared.extensions,".angle_instanced_arrays"));a(e,c,b,d);return e.compile().body}function Ca(a,e,b,c){R(a,e);V(a,e,b,c.attributes,function(){return!0});ca(a,e,b,c.uniforms,function(){return!0});Z(a,e,e,b)}function Da(a,e){var b=a.proc("draw",1);R(a,b);J(a,b,e.context);Y(a,b,e.framebuffer);ba(a,b,e);P(a,b,e.state);S(a,b,e,!1,!0);var c=e.shader.progVar.append(a,b);b(a.shared.gl,".useProgram(",c,".program);");if(e.shader.program)Ca(a,b,e,e.shader.program);else{var d=a.global.def("{}"),
f=b.def(c,".id"),k=b.def(d,"[",f,"]");b(a.cond(k).then(k,".call(this,a0);")["else"](k,"=",d,"[",f,"]=",a.link(function(b){return Ba(Ca,a,e,b,1)}),"(",c,");",k,".call(this,a0);"))}0<Object.keys(e.state).length&&b(a.shared.current,".dirty=true;")}function Ea(a,e,b,c){function d(){return!0}a.batchId="a1";R(a,e);V(a,e,b,c.attributes,d);ca(a,e,b,c.uniforms,d);Z(a,e,e,b)}function ra(a,e,b,c){function d(a){return a.contextDep&&k||a.propDep}function f(a){return!d(a)}R(a,e);var k=b.contextDep,g=e.def(),m=
e.def();a.shared.props=m;a.batchId=g;var x=a.scope(),y=a.scope();e(x.entry,"for(",g,"=0;",g,"<","a1",";++",g,"){",m,"=","a0","[",g,"];",y,"}",x.exit);b.needsContext&&J(a,y,b.context);b.needsFramebuffer&&Y(a,y,b.framebuffer);P(a,y,b.state,d);b.profile&&d(b.profile)&&S(a,y,b,!1,!0);c?(V(a,x,b,c.attributes,f),V(a,y,b,c.attributes,d),ca(a,x,b,c.uniforms,f),ca(a,y,b,c.uniforms,d),Z(a,x,y,b)):(e=a.global.def("{}"),c=b.shader.progVar.append(a,y),m=y.def(c,".id"),x=y.def(e,"[",m,"]"),y(a.shared.gl,".useProgram(",
c,".program);","if(!",x,"){",x,"=",e,"[",m,"]=",a.link(function(e){return Ba(Ea,a,b,e,2)}),"(",c,");}",x,".call(this,a0[",g,"],",g,");"))}function La(a,e){function b(a){return a.contextDep&&d||a.propDep}var c=a.proc("batch",2);a.batchId="0";R(a,c);var d=!1,f=!0;Object.keys(e.context).forEach(function(a){d=d||e.context[a].propDep});d||(J(a,c,e.context),f=!1);var k=e.framebuffer,g=!1;k?(k.propDep?d=g=!0:k.contextDep&&d&&(g=!0),g||Y(a,c,k)):Y(a,c,null);e.state.viewport&&e.state.viewport.propDep&&(d=
!0);ba(a,c,e);P(a,c,e.state,function(a){return!b(a)});e.profile&&b(e.profile)||S(a,c,e,!1,"a1");e.contextDep=d;e.needsContext=f;e.needsFramebuffer=g;f=e.shader.progVar;if(f.contextDep&&d||f.propDep)ra(a,c,e,null);else if(f=f.append(a,c),c(a.shared.gl,".useProgram(",f,".program);"),e.shader.program)ra(a,c,e,e.shader.program);else{var k=a.global.def("{}"),g=c.def(f,".id"),m=c.def(k,"[",g,"]");c(a.cond(m).then(m,".call(this,a0,a1);")["else"](m,"=",k,"[",g,"]=",a.link(function(b){return Ba(ra,a,e,b,2)}),
"(",f,");",m,".call(this,a0,a1);"))}0<Object.keys(e.state).length&&c(a.shared.current,".dirty=true;")}function Ia(e,b){function c(a){var k=b.shader[a];k&&d.set(f.shader,"."+a,k.append(e,d))}var d=e.proc("scope",3);e.batchId="a2";var f=e.shared,k=f.current;J(e,d,b.context);b.framebuffer&&b.framebuffer.append(e,d);a(Object.keys(b.state)).forEach(function(a){var c=b.state[a].append(e,d);z(c)?c.forEach(function(b,c){d.set(e.next[a],"["+c+"]",b)}):d.set(f.next,"."+a,c)});S(e,d,b,!0,!0);["elements","offset",
"count","instances","primitive"].forEach(function(a){var c=b.draw[a];c&&d.set(f.draw,"."+a,""+c.append(e,d))});Object.keys(b.uniforms).forEach(function(a){d.set(f.uniforms,"["+n.id(a)+"]",b.uniforms[a].append(e,d))});Object.keys(b.attributes).forEach(function(a){var c=b.attributes[a].append(e,d),f=e.scopeAttrib(a);Object.keys(new aa).forEach(function(a){d.set(f,"."+a,c[a])})});c("vert");c("frag");0<Object.keys(b.state).length&&(d(k,".dirty=true;"),d.exit(k,".dirty=true;"));d("a1(",e.shared.context,
",a0,",e.batchId,");")}function Ja(a){if("object"===typeof a&&!z(a)){for(var e=Object.keys(a),b=0;b<e.length;++b)if(t.isDynamic(a[e[b]]))return!0;return!1}}function Ka(a,e,b){function c(a,e){k.forEach(function(b){var c=d[b];t.isDynamic(c)&&(c=a.invoke(e,c),e(p,".",b,"=",c,";"))})}var d=e["static"][b];if(d&&Ja(d)){var f=a.global,k=Object.keys(d),g=!1,y=!1,x=!1,p=a.global.def("{}");k.forEach(function(e){var b=d[e];if(t.isDynamic(b))"function"===typeof b&&(b=d[e]=t.unbox(b)),e=m(b,null),g=g||e.thisDep,
x=x||e.propDep,y=y||e.contextDep;else{f(p,".",e,"=");switch(typeof b){case "number":f(b);break;case "string":f('"',b,'"');break;case "object":Array.isArray(b)&&f("[",b.join(),"]");break;default:f(a.link(b))}f(";")}});e.dynamic[b]=new t.DynamicVariable(4,{thisDep:g,contextDep:y,propDep:x,ref:p,append:c});delete e["static"][b]}}var aa=ma.Record,ha={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(ha.min=32775,ha.max=32776);var ia=r.angle_instanced_arrays,e=r.webgl_draw_buffers,
y={dirty:!0,profile:ga.profile},x={},Ga=[],va={},wa={};K("dither",3024);K("blend.enable",3042);E("blend.color","blendColor",[0,0,0,0]);E("blend.equation","blendEquationSeparate",[32774,32774]);E("blend.func","blendFuncSeparate",[1,0,1,0]);K("depth.enable",2929,!0);E("depth.func","depthFunc",513);E("depth.range","depthRange",[0,1]);E("depth.mask","depthMask",!0);E("colorMask","colorMask",[!0,!0,!0,!0]);K("cull.enable",2884);E("cull.face","cullFace",1029);E("frontFace","frontFace",2305);E("lineWidth",
"lineWidth",1);K("polygonOffset.enable",32823);E("polygonOffset.offset","polygonOffset",[0,0]);K("sample.alpha",32926);K("sample.enable",32928);E("sample.coverage","sampleCoverage",[1,!1]);K("stencil.enable",2960);E("stencil.mask","stencilMask",-1);E("stencil.func","stencilFunc",[519,0,-1]);E("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);E("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);K("scissor.enable",3089);E("scissor.box","scissor",[0,0,h.drawingBufferWidth,h.drawingBufferHeight]);
E("viewport","viewport",[0,0,h.drawingBufferWidth,h.drawingBufferHeight]);var Na={gl:h,context:W,strings:n,next:x,current:y,draw:p,elements:ka,buffer:G,shader:ua,attributes:ma.state,uniforms:ta,framebuffer:N,extensions:r,timer:X,isBufferArgs:l},Ha={primTypes:H,compareFuncs:B,blendFuncs:f,blendEquations:ha,stencilOps:A,glTypes:v,orientationType:q};e&&(Ha.backBuffer=[1029],Ha.drawBuffer=w(I.maxDrawbuffers,function(a){return 0===a?[0]:w(a,function(a){return 36064+a})}));var Pa=0;return{next:x,current:y,
procs:function(){var a=xa(),e=a.proc("poll"),b=a.proc("refresh"),c=a.block();e(c);b(c);var d=a.shared,f=d.gl,k=d.next,g=d.current;c(g,".dirty=false;");Y(a,e);Y(a,b,null,!0);var m=h.getExtension("angle_instanced_arrays"),x;m&&(x=a.link(m));for(var p=0;p<I.maxAttributes;++p){var l=b.def(d.attributes,"[",p,"]"),q=a.cond(l,".buffer");q.then(f,".enableVertexAttribArray(",p,");",f,".bindBuffer(",34962,",",l,".buffer.buffer);",f,".vertexAttribPointer(",p,",",l,".size,",l,".type,",l,".normalized,",l,".stride,",
l,".offset);")["else"](f,".disableVertexAttribArray(",p,");",f,".vertexAttrib4f(",p,",",l,".x,",l,".y,",l,".z,",l,".w);",l,".buffer=null;");b(q);m&&b(x,".vertexAttribDivisorANGLE(",p,",",l,".divisor);")}Object.keys(va).forEach(function(d){var m=va[d],x=c.def(k,".",d),y=a.block();y("if(",x,"){",f,".enable(",m,")}else{",f,".disable(",m,")}",g,".",d,"=",x,";");b(y);e("if(",x,"!==",g,".",d,"){",y,"}")});Object.keys(wa).forEach(function(d){var m=wa[d],x=y[d],p,l,q=a.block();q(f,".",m,"(");z(x)?(m=x.length,
p=a.global.def(k,".",d),l=a.global.def(g,".",d),q(w(m,function(a){return p+"["+a+"]"}),");",w(m,function(a){return l+"["+a+"]="+p+"["+a+"];"}).join("")),e("if(",w(m,function(a){return p+"["+a+"]!=="+l+"["+a+"]"}).join("||"),"){",q,"}")):(p=c.def(k,".",d),l=c.def(g,".",d),q(p,");",g,".",d,"=",p,";"),e("if(",p,"!==",l,"){",q,"}"));b(q)});return a.compile()}(),compile:function(a,e,b,c,d){var f=xa();f.stats=f.link(d);Object.keys(e["static"]).forEach(function(a){Ka(f,e,a)});k.forEach(function(e){Ka(f,
a,e)});b=oa(a,e,b,c,f);Da(f,b);Ia(f,b);La(f,b);return f.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],9:[function(h,n,r){function l(a,g){this.id=C++;this.type=a;this.data=g}function a(d){if(0===d.length)return[];var g=d.charAt(0),c=d.charAt(d.length-1);if(1<d.length&&g===c&&('"'===g||"'"===g))return['"'+d.substr(1,d.length-2).replace(/\\/g,"\\\\").replace(/"/g,
'\\"')+'"'];if(g=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(d))return a(d.substr(0,g.index)).concat(a(g[1])).concat(a(d.substr(g.index+g[0].length)));g=d.split(".");if(1===g.length)return['"'+d.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];d=[];for(c=0;c<g.length;++c)d=d.concat(a(g[c]));return d}function g(d){return"["+a(d).join("][")+"]"}var C=0;n.exports={DynamicVariable:l,define:function(a,m){return new l(a,g(m+""))},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof
l},unbox:function(a,g){return"function"===typeof a?new l(0,a):a},accessor:g}},{}],10:[function(h,n,r){var l=h("./util/is-typed-array"),a=h("./util/is-ndarray"),g=h("./util/values"),C=h("./constants/primitives.json"),d=h("./constants/usage.json");n.exports=function(m,c,h,n){function r(a){this.id=v++;H[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function z(d,k,g,m,b,t,v){(t=v)||l(k)&&(!a(k)||l(k.data))||(t=c.oes_element_index_uint?5125:5123);d.buffer.bind();h._initBuffer(d.buffer,
k,g,t,3);k=v;if(!v){switch(d.buffer.dtype){case 5121:case 5120:k=5121;break;case 5123:case 5122:k=5123;break;case 5125:case 5124:k=5125}d.buffer.dtype=k}d.type=k;0>b&&(b=d.buffer.byteLength,5123===k?b>>=1:5125===k&&(b>>=2));d.vertCount=b;b=m;0>m&&(b=4,m=d.buffer.dimension,1===m&&(b=0),2===m&&(b=1),3===m&&(b=4));d.primType=b}function t(a){n.elementsCount--;delete H[a.id];a.buffer.destroy();a.buffer=null}var H={},v=0,D={uint8:5121,uint16:5123};c.oes_element_index_uint&&(D.uint32=5125);r.prototype.bind=
function(){this.buffer.bind()};var k=[];return{create:function(c,k){function g(c){if(c)if("number"===typeof c)q(c),b.primType=4,b.vertCount=c|0,b.type=5121;else{var f=null,k=35044,h=-1,t=-1,v=0,w=0;Array.isArray(c)||l(c)||a(c)?f=c:("data"in c&&(f=c.data),"usage"in c&&(k=d[c.usage]),"primitive"in c&&(h=C[c.primitive]),"count"in c&&(t=c.count|0),"length"in c&&(v=c.length|0),"type"in c&&(w=D[c.type]));f?z(b,f,k,h,t,v,w):(c=b.buffer,c.bind(),m.bufferData(34963,v,k),c.dtype=w||5121,c.usage=k,c.dimension=
3,c.byteLength=v,b.primType=0>h?4:h,b.vertCount=0>t?0:t,b.type=c.dtype)}else q(),b.primType=4,b.vertCount=0,b.type=5121;return g}var q=h.create(null,34963,!0),b=new r(q._buffer);n.elementsCount++;g(c);g._reglType="elements";g._elements=b;g.subdata=function(a,b){q.subdata(a,b);return g};g.destroy=function(){t(b)};return g},createStream:function(a){var c=k.pop();c||(c=new r(h.create(null,34963,!0,!1)._buffer));z(c,a,35040,-1,-1,0,0);return c},destroyStream:function(a){k.push(a)},getElements:function(a){return"function"===
typeof a&&a._elements instanceof r?a._elements:null},clear:function(){g(H).forEach(t)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],11:[function(h,n,r){n.exports=function(l,a){function g(a){a=a.toLowerCase();var d;try{d=h[a]=l.getExtension(a)}catch(g){}return!!d}for(var h={},d=0;d<a.extensions.length;++d){var m=a.extensions[d];if(!g(m))return a.onDestroy(),a.onDone('"'+m+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),
null}a.optionalExtensions.forEach(g);return{extensions:h,restore:function(){Object.keys(h).forEach(function(a){if(!g(a))throw Error("(regl): error restoring extension "+a);})}}}},{}],12:[function(h,n,r){var l=h("./util/values"),a=h("./util/extend"),g=[];g[6408]=4;var C=[];C[5121]=1;C[5126]=4;C[36193]=2;n.exports=function(d,m,c,h,n,r){function z(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var d=a=0;b?(a=b.width,d=b.height):c&&(a=c.width,d=c.height);this.width=a;this.height=d}function t(a){a&&
(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function H(a,b,c){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function v(a,b){b?b.texture?d.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,0):d.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):d.framebufferTexture2D(36160,a,3553,null,0)}function D(a){var b=3553,c=null,d=null,f=a;"object"===typeof a&&(f=a.data,"target"in
a&&(b=a.target|0));a=f._reglType;"texture2d"===a?c=f:"textureCube"===a?c=f:"renderbuffer"===a&&(d=f,b=36161);return new z(b,c,d)}function k(a,b,c,d,f){if(c)return a=h.create2D({width:a,height:b,format:d,type:f}),a._texture.refCount=0,new z(3553,a,null);a=n.create({width:a,height:b,format:d});a._renderbuffer.refCount=0;return new z(36161,null,a)}function f(a){return a&&(a.texture||a.renderbuffer)}function B(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function A(){this.id=
la++;N[this.id]=this;this.framebuffer=d.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function q(a){a.colorAttachments.forEach(t);t(a.depthAttachment);t(a.stencilAttachment);t(a.depthStencilAttachment)}function b(a){d.deleteFramebuffer(a.framebuffer);a.framebuffer=null;r.framebufferCount--;delete N[a.id]}function F(a){var b;d.bindFramebuffer(36160,a.framebuffer);var f=a.colorAttachments;for(b=0;b<
f.length;++b)v(36064+b,f[b]);for(b=f.length;b<c.maxColorAttachments;++b)v(36064+b,null);v(36096,a.depthAttachment);v(36128,a.stencilAttachment);v(33306,a.depthStencilAttachment);d.checkFramebufferStatus(36160);d.bindFramebuffer(36160,ja.next);ja.cur=ja.next;d.getError()}function sa(c,d){function m(a,b){var c,d=0,l=0,h=!0,t=!0;c=null;var v=!0,w="rgba",n="uint8",z=1,r=null,B=null,I=null,G=!1;if("number"===typeof a)d=a|0,l=b|0||d;else if(a){"shape"in a?(l=a.shape,d=l[0],l=l[1]):("radius"in a&&(d=l=a.radius),
"width"in a&&(d=a.width),"height"in a&&(l=a.height));if("color"in a||"colors"in a)c=a.color||a.colors,Array.isArray(c);if(!c){"colorCount"in a&&(z=a.colorCount|0);"colorTexture"in a&&(v=!!a.colorTexture,w="rgba4");if("colorType"in a&&(n=a.colorType,!v))if("half float"===n||"float16"===n)w="rgba16f";else if("float"===n||"float32"===n)w="rgba32f";"colorFormat"in a&&(w=a.colorFormat,0<=Fa.indexOf(w)?v=!0:0<=za.indexOf(w)&&(v=!1))}if("depthTexture"in a||"depthStencilTexture"in a)G=!(!a.depthTexture&&
!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?h=a.depth:(r=a.depth,t=!1));"stencil"in a&&("boolean"===typeof a.stencil?t=a.stencil:(B=a.stencil,h=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?h=t=a.depthStencil:(I=a.depthStencil,t=h=!1))}else d=l=1;var A=null,sa=null,J=null,ja=null;if(Array.isArray(c))A=c.map(D);else if(c)A=[D(c)];else for(A=Array(z),c=0;c<z;++c)A[c]=k(d,l,v,w,n);d=d||A[0].width;l=l||A[0].height;r?sa=D(r):h&&!t&&(sa=k(d,l,G,"depth","uint32"));B?J=
D(B):t&&!h&&(J=k(d,l,!1,"stencil","uint8"));I?ja=D(I):!r&&!B&&t&&h&&(ja=k(d,l,G,"depth stencil","depth stencil"));h=null;for(c=0;c<A.length;++c)H(A[c],d,l),A[c]&&A[c].texture&&(t=g[A[c].texture._texture.format]*C[A[c].texture._texture.type],null===h&&(h=t));H(sa,d,l);H(J,d,l);H(ja,d,l);q(p);p.width=d;p.height=l;p.colorAttachments=A;p.depthAttachment=sa;p.stencilAttachment=J;p.depthStencilAttachment=ja;m.color=A.map(f);m.depth=f(sa);m.stencil=f(J);m.depthStencil=f(ja);m.width=p.width;m.height=p.height;
F(p);return m}var p=new A;r.framebufferCount++;m(c,d);return a(m,{resize:function(a,b){var c=a|0,d=b|0||c;if(c===p.width&&d===p.height)return m;for(var f=p.colorAttachments,k=0;k<f.length;++k)B(f[k],c,d);B(p.depthAttachment,c,d);B(p.stencilAttachment,c,d);B(p.depthStencilAttachment,c,d);p.width=m.width=c;p.height=m.height=d;F(p);return m},_reglType:"framebuffer",_framebuffer:p,destroy:function(){b(p);q(p)}})}var ja={cur:null,next:null,dirty:!1},Fa=["rgba"],za=["rgba4","rgb565","rgb5 a1"];m.ext_srgb&&
za.push("srgba");m.ext_color_buffer_half_float&&za.push("rgba16f","rgb16f");m.webgl_color_buffer_float&&za.push("rgba32f");var ka=["uint8"];m.oes_texture_half_float&&ka.push("half float","float16");m.oes_texture_float&&ka.push("float","float32");var la=0,N={};return a(ja,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof A)?a:null},create:sa,createCube:function(b){function c(b){var f,k={color:null},g=0,m=null;f="rgba";var l="uint8",
q=1;if("number"===typeof b)g=b|0;else if(b){"shape"in b?g=b.shape[0]:("radius"in b&&(g=b.radius|0),"width"in b?g=b.width|0:"height"in b&&(g=b.height|0));if("color"in b||"colors"in b)m=b.color||b.colors,Array.isArray(m);m||("colorCount"in b&&(q=b.colorCount|0),"colorType"in b&&(l=b.colorType),"colorFormat"in b&&(f=b.colorFormat));"depth"in b&&(k.depth=b.depth);"stencil"in b&&(k.stencil=b.stencil);"depthStencil"in b&&(k.depthStencil=b.depthStencil)}else g=1;if(m)if(Array.isArray(m))for(b=[],f=0;f<m.length;++f)b[f]=
m[f];else b=[m];else for(b=Array(q),m={radius:g,format:f,type:l},f=0;f<q;++f)b[f]=h.createCube(m);k.color=Array(b.length);for(f=0;f<b.length;++f)q=b[f],g=g||q.width,k.color[f]={target:34069,data:b[f]};for(f=0;6>f;++f){for(q=0;q<b.length;++q)k.color[q].target=34069+f;0<f&&(k.depth=d[0].depth,k.stencil=d[0].stencil,k.depthStencil=d[0].depthStencil);if(d[f])d[f](k);else d[f]=sa(k)}return a(c,{width:g,height:g,color:b})}var d=Array(6);c(b);return a(c,{faces:d,resize:function(a){var b=a|0;if(b===c.width)return c;
var f=c.color;for(a=0;a<f.length;++a)f[a].resize(b);for(a=0;6>a;++a)d[a].resize(b);c.width=c.height=b;return c},_reglType:"framebufferCube",destroy:function(){d.forEach(function(a){a.destroy()})}})},clear:function(){l(N).forEach(b)},restore:function(){l(N).forEach(function(a){a.framebuffer=d.createFramebuffer();F(a)})}})}},{"./util/extend":23,"./util/values":31}],13:[function(h,n,r){n.exports=function(l,a){var g=1;a.ext_texture_filter_anisotropic&&(g=l.getParameter(34047));var h=1,d=1;a.webgl_draw_buffers&&
(h=l.getParameter(34852),d=l.getParameter(36063));return{colorBits:[l.getParameter(3410),l.getParameter(3411),l.getParameter(3412),l.getParameter(3413)],depthBits:l.getParameter(3414),stencilBits:l.getParameter(3415),subpixelBits:l.getParameter(3408),extensions:Object.keys(a).filter(function(d){return!!a[d]}),maxAnisotropic:g,maxDrawbuffers:h,maxColorAttachments:d,pointSizeDims:l.getParameter(33901),lineWidthDims:l.getParameter(33902),maxViewportDims:l.getParameter(3386),maxCombinedTextureUnits:l.getParameter(35661),
maxCubeMapSize:l.getParameter(34076),maxRenderbufferSize:l.getParameter(34024),maxTextureUnits:l.getParameter(34930),maxTextureSize:l.getParameter(3379),maxAttributes:l.getParameter(34921),maxVertexUniforms:l.getParameter(36347),maxVertexTextureUnits:l.getParameter(35660),maxVaryingVectors:l.getParameter(36348),maxFragmentUniforms:l.getParameter(36349),glsl:l.getParameter(35724),renderer:l.getParameter(7937),vendor:l.getParameter(7936),version:l.getParameter(7938)}}},{}],14:[function(h,n,r){var l=
h("./util/is-typed-array");n.exports=function(a,g,h,d,m,c){return function(c){var m;m=null===g.next?5121:g.next.colorAttachments[0].texture._texture.type;var n=0,z=0,t=d.framebufferWidth,r=d.framebufferHeight,v=null;l(c)?v=c:c&&(n=c.x|0,z=c.y|0,t=(c.width||d.framebufferWidth-n)|0,r=(c.height||d.framebufferHeight-z)|0,v=c.data||null);h();c=t*r*4;v||(5121===m?v=new Uint8Array(c):5126===m&&(v=v||new Float32Array(c)));a.pixelStorei(3333,4);a.readPixels(n,z,t,r,6408,m,v);return v}}},{"./util/is-typed-array":26}],
15:[function(h,n,r){var l=h("./util/values"),a=[];a[32854]=2;a[32855]=2;a[36194]=2;a[33189]=2;a[36168]=1;a[34041]=4;a[35907]=4;a[34836]=16;a[34842]=8;a[34843]=6;n.exports=function(g,h,d,m,c){function w(a){this.id=t++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;c.profile&&(this.stats={size:0})}function n(a){var c=a.renderbuffer;g.bindRenderbuffer(36161,null);g.deleteRenderbuffer(c);a.renderbuffer=null;a.refCount=0;delete H[a.id];m.renderbufferCount--}var r={rgba4:32854,
rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};h.ext_srgb&&(r.srgba=35907);h.ext_color_buffer_half_float&&(r.rgba16f=34842,r.rgb16f=34843);h.webgl_color_buffer_float&&(r.rgba32f=34836);var z=[];Object.keys(r).forEach(function(a){z[r[a]]=a});var t=0,H={};w.prototype.decRef=function(){0>=--this.refCount&&n(this)};c.profile&&(m.getTotalRenderbufferSize=function(){var a=0;Object.keys(H).forEach(function(c){a+=H[c].stats.size});return a});return{create:function(d,l){function k(d,
m){var l=0,b=0,h=32854;"object"===typeof d&&d?("shape"in d?(b=d.shape,l=b[0]|0,b=b[1]|0):("radius"in d&&(l=b=d.radius|0),"width"in d&&(l=d.width|0),"height"in d&&(b=d.height|0)),"format"in d&&(h=r[d.format])):"number"===typeof d?(l=d|0,b="number"===typeof m?m|0:l):d||(l=b=1);if(l!==f.width||b!==f.height||h!==f.format)return k.width=f.width=l,k.height=f.height=b,f.format=h,g.bindRenderbuffer(36161,f.renderbuffer),g.renderbufferStorage(36161,h,l,b),c.profile&&(f.stats.size=a[f.format]*f.width*f.height),
k.format=z[f.format],k}var f=new w(g.createRenderbuffer());H[f.id]=f;m.renderbufferCount++;k(d,l);k.resize=function(d,m){var l=d|0,b=m|0||l;if(l===f.width&&b===f.height)return k;k.width=f.width=l;k.height=f.height=b;g.bindRenderbuffer(36161,f.renderbuffer);g.renderbufferStorage(36161,f.format,l,b);c.profile&&(f.stats.size=a[f.format]*f.width*f.height);return k};k._reglType="renderbuffer";k._renderbuffer=f;c.profile&&(k.stats=f.stats);k.destroy=function(){f.decRef()};return k},clear:function(){l(H).forEach(n)},
restore:function(){l(H).forEach(function(a){a.renderbuffer=g.createRenderbuffer();g.bindRenderbuffer(36161,a.renderbuffer);g.renderbufferStorage(36161,a.format,a.width,a.height)});g.bindRenderbuffer(36161,null)}}}},{"./util/values":31}],16:[function(h,n,r){var l=h("./util/values");n.exports=function(a,g,h,d){function m(a,c,d,g){this.name=a;this.id=c;this.location=d;this.info=g}function c(a,c){for(var d=0;d<a.length;++d)if(a[d].id===c.id){a[d].location=c.location;return}a.push(c)}function w(c,d,m){m=
35632===c?z:t;var l=m[d];if(!l){var h=g.str(d),l=a.createShader(c);a.shaderSource(l,h);a.compileShader(l);m[d]=l}return l}function n(a,c){this.id=D++;this.fragId=a;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[];d.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function r(k,f){var l,h;l=w(35632,k.fragId);h=w(35633,k.vertId);var q=k.program=a.createProgram();a.attachShader(q,l);a.attachShader(q,h);a.linkProgram(q);var b=a.getProgramParameter(q,35718);d.profile&&(k.stats.uniformsCount=
b);var t=k.uniforms;for(l=0;l<b;++l)if(h=a.getActiveUniform(q,l))if(1<h.size)for(var n=0;n<h.size;++n){var v=h.name.replace("[0]","["+n+"]");c(t,new m(v,g.id(v),a.getUniformLocation(q,v),h))}else c(t,new m(h.name,g.id(h.name),a.getUniformLocation(q,h.name),h));b=a.getProgramParameter(q,35721);d.profile&&(k.stats.attributesCount=b);t=k.attributes;for(l=0;l<b;++l)(h=a.getActiveAttrib(q,l))&&c(t,new m(h.name,g.id(h.name),a.getAttribLocation(q,h.name),h))}var z={},t={},H={},v=[],D=0;d.profile&&(h.getMaxUniformsCount=
function(){var a=0;v.forEach(function(c){c.stats.uniformsCount>a&&(a=c.stats.uniformsCount)});return a},h.getMaxAttributesCount=function(){var a=0;v.forEach(function(c){c.stats.attributesCount>a&&(a=c.stats.attributesCount)});return a});return{clear:function(){var c=a.deleteShader.bind(a);l(z).forEach(c);z={};l(t).forEach(c);t={};v.forEach(function(c){a.deleteProgram(c.program)});v.length=0;H={};h.shaderCount=0},program:function(a,c,d){h.shaderCount++;var g=H[c];g||(g=H[c]={});var m=g[a];m||(m=new n(c,
a),r(m,d),g[a]=m,v.push(m));return m},restore:function(){z={};t={};for(var a=0;a<v.length;++a)r(v[a])},shader:w,frag:-1,vert:-1}}},{"./util/values":31}],17:[function(h,n,r){n.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(h,n,r){n.exports=function(){var l={"":0},a=[""];return{id:function(g){var h=l[g];if(h)return h;h=l[g]=a.length;a.push(g);return h},str:function(g){return a[g]}}}},
{}],19:[function(h,n,r){function l(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function a(a){return Array.isArray(a)&&0!==a.length&&H(a[0])?!0:!1}function g(a){return Object.prototype.toString.call(a)}function C(b){if(!b)return!1;var c=g(b);return 0<=B.indexOf(c)?!0:l(b)||a(b)||G(b)}function d(a,c){36193===a.type?(a.data=t(c),z.freeType(c)):a.data=c}function m(a,c,d,g,m,k){a="undefined"!==typeof q[a]?q[a]:f[a]*A[c];k&&(a*=6);if(m){for(g=0;1<=d;)g+=a*d*d,d/=2;return g}return a*
d*g}var c=h("./util/extend"),w=h("./util/values"),I=h("./util/is-typed-array"),G=h("./util/is-ndarray"),z=h("./util/pool"),t=h("./util/to-half-float"),H=h("./util/is-array-like");r=h("./constants/arraytypes.json");var v=h("./constants/arraytypes.json"),D=[9984,9986,9985,9987],k=[0,6409,6410,6407,6408],f={};f[6409]=f[6406]=f[6402]=1;f[34041]=f[6410]=2;f[6407]=f[35904]=3;f[6408]=f[35906]=4;var B=Object.keys(r).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]",
"[object HTMLVideoElement]"]),A=[];A[5121]=1;A[5126]=4;A[36193]=2;A[5123]=2;A[5125]=4;var q=[];q[32854]=2;q[32855]=2;q[36194]=2;q[34041]=4;q[33776]=.5;q[33777]=.5;q[33778]=1;q[33779]=1;q[35986]=.5;q[35987]=1;q[34798]=1;q[35840]=.5;q[35841]=.25;q[35842]=.5;q[35843]=.25;q[36196]=.5;n.exports=function(b,h,q,n,r,A,B){function la(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=
4}function N(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function ta(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=
P[b.colorSpace]);"type"in b&&(a.type=R[b.type]);var c=a.width,d=a.height,g=a.channels,m=!1;"shape"in b?(c=b.shape[0],d=b.shape[1],3===b.shape.length&&(g=b.shape[2],m=!0)):("radius"in b&&(c=d=b.radius),"width"in b&&(c=b.width),"height"in b&&(d=b.height),"channels"in b&&(g=b.channels,m=!0));a.width=c|0;a.height=d|0;a.channels=g|0;c=!1;"format"in b&&(c=b.format,d=a.internalformat=S[c],a.format=La[d],c in R&&!("type"in b)&&(a.type=R[c]),c in V&&(a.compressed=!0),c=!0);!m&&c?a.channels=f[a.format]:m&&
!c&&a.channels!==k[a.format]&&(a.format=a.internalformat=k[a.channels])}}function ma(a){b.pixelStorei(37440,a.flipY);b.pixelStorei(37441,a.premultiplyAlpha);b.pixelStorei(37443,a.colorSpace);b.pixelStorei(3317,a.unpackAlignment)}function ua(){la.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function p(b,c){var f=null;C(c)?f=c:c&&(ta(b,c),"x"in c&&(b.xOffset=c.x|0),"y"in c&&(b.yOffset=c.y|0),C(c.data)&&(f=c.data));if(c.copy){var m=r.viewportWidth,
h=r.viewportHeight;b.width=b.width||m-b.xOffset;b.height=b.height||h-b.yOffset;b.needsCopy=!0}else if(!f)b.width=b.width||1,b.height=b.height||1;else if(I(f))b.data=f,"type"in c||5121!==b.type||(b.type=v[Object.prototype.toString.call(f)]|0);else if(l(f)){m=f;h=b.width*b.height*b.channels;switch(b.type){case 5121:case 5123:case 5125:case 5126:h=z.allocType(b.type,h);h.set(m);b.data=h;break;case 36193:b.data=t(m)}b.alignment=1;b.needsFree=!0}else if(G(f)){m=f.data;Array.isArray(m)||5121!==b.type||
(b.type=v[Object.prototype.toString.call(m)]|0);var h=f.shape,p=f.stride,q,n,w,u;3===h.length?(w=h[2],u=p[2]):u=w=1;q=h[0];n=h[1];h=p[0];p=p[1];b.alignment=1;b.width=q;b.height=n;b.channels=w;b.format=b.internalformat=k[w];b.needsFree=!0;q=u;f=f.offset;w=b.width;u=b.height;n=b.channels;for(var D=z.allocType(36193===b.type?5126:b.type,w*u*n),A=0,B=0;B<u;++B)for(var Z=0;Z<w;++Z)for(var F=0;F<n;++F)D[A++]=m[h*Z+p*B+q*F+f];d(b,D)}else if("[object HTMLCanvasElement]"===g(f)||"[object CanvasRenderingContext2D]"===
g(f))"[object HTMLCanvasElement]"===g(f)?b.element=f:b.element=f.canvas,b.width=b.element.width,b.height=b.element.height;else if("[object HTMLImageElement]"===g(f))b.element=f,b.width=f.naturalWidth,b.height=f.naturalHeight;else if("[object HTMLVideoElement]"===g(f))b.element=f,b.width=f.videoWidth,b.height=f.videoHeight,b.needsPoll=!0;else if(a(f)){m=f[0].length;h=f.length;p=1;if(H(f[0][0])){q=p=f[0][0].length;w=z.allocType(36193===b.type?5126:b.type,m*h*q);for(n=u=0;n<h;++n)for(D=f[n],A=0;A<m;++A)for(B=
D[A],Z=0;Z<q;++Z)w[u++]=B[Z];d(b,w)}else{q=z.allocType(36193===b.type?5126:b.type,m*h);for(u=w=0;u<h;++u)for(n=f[u],D=0;D<m;++D)q[w++]=n[D];d(b,q)}b.alignment=1;b.width=m;b.height=h;b.channels=p;b.format=b.internalformat=k[p];b.needsFree=!0}}function W(a,c,d,f,g){var m=a.element,k=a.data,h=a.internalformat,l=a.format,p=a.type,q=a.width,t=a.height;ma(a);m?b.texSubImage2D(c,g,d,f,l,p,m):a.compressed?b.compressedTexSubImage2D(c,g,d,f,h,q,t,k):a.needsCopy?(n(),b.copyTexSubImage2D(c,g,d,f,a.xOffset,a.yOffset,
q,t)):b.texSubImage2D(c,g,d,f,q,t,l,p,k)}function X(){return Ia.pop()||new ua}function ga(a){a.needsFree&&z.freeType(a.data);ua.call(a);Ia.push(a)}function T(){la.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function K(a,b,c){var d=a.images[0]=X();a.mipmask=1;d.width=a.width=b;d.height=a.height=c}function E(a,b){var c=null;if(C(b))c=a.images[0]=X(),N(c,a),p(c,b),a.mipmask=1;else if(ta(a,b),Array.isArray(b.mipmap))for(var d=b.mipmap,f=0;f<d.length;++f)c=a.images[f]=
X(),N(c,a),c.width>>=f,c.height>>=f,p(c,d[f]),a.mipmask|=1<<f;else c=a.images[0]=X(),N(c,a),p(c,b),a.mipmask=1;N(a,a.images[0])}function xa(a,c){for(var d=a.images,f=0;f<d.length&&d[f];++f){var g=d[f],m=c,k=f,h=g.element,l=g.data,p=g.internalformat,q=g.format,t=g.type,w=g.width,v=g.height;ma(g);h?b.texImage2D(m,k,q,q,t,h):g.compressed?b.compressedTexImage2D(m,k,p,w,v,0,l):g.needsCopy?(n(),b.copyTexImage2D(m,k,q,g.xOffset,g.yOffset,w,v,0)):b.texImage2D(m,k,q,w,v,0,q,t,l)}}function na(){var a=Ja.pop()||
new T;la.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function ya(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&ga(b[c]),b[c]=null;Ja.push(a)}function Q(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function da(a,b){"min"in b&&(a.minFilter=ba[b.min],0<=D.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=Y[b.mag]);var c=a.wrapS,d=a.wrapT;if("wrap"in b){var f=b.wrap;"string"===typeof f?
c=d=J[f]:Array.isArray(f)&&(c=J[f[0]],d=J[f[1]])}else"wrapS"in b&&(c=J[b.wrapS]),"wrapT"in b&&(d=J[b.wrapT]);a.wrapS=c;a.wrapT=d;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=oa[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function ea(a,c){b.texParameteri(c,10241,a.minFilter);b.texParameteri(c,10240,a.magFilter);b.texParameteri(c,
10242,a.wrapS);b.texParameteri(c,10243,a.wrapT);h.ext_texture_filter_anisotropic&&b.texParameteri(c,34046,a.anisotropic);a.genMipmaps&&(b.hint(33170,a.mipmapHint),b.generateMipmap(c))}function pa(a){la.call(this);this.mipmask=0;this.internalformat=6408;this.id=Ka++;this.refCount=1;this.target=a;this.texture=b.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new Q;B.profile&&(this.stats={size:0})}function fa(a){b.activeTexture(33984);b.bindTexture(a.target,a.texture)}function U(){var a=ia[0];
a?b.bindTexture(a.target,a.texture):b.bindTexture(3553,null)}function qa(a){var c=a.texture,d=a.unit,f=a.target;0<=d&&(b.activeTexture(33984+d),b.bindTexture(f,null),ia[d]=null);b.deleteTexture(c);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete aa[a.id];A.textureCount--}var oa={"don't care":4352,"dont care":4352,nice:4354,fast:4353},J={repeat:10497,clamp:33071,mirror:33648},Y={nearest:9728,linear:9729},ba=c({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,
"linear mipmap linear":9987},Y),P={none:0,browser:37444},R={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},S={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},V={};h.ext_srgb&&(S.srgb=35904,S.srgba=35906);h.oes_texture_float&&(R.float32=R["float"]=5126);h.oes_texture_half_float&&(R.float16=R["half float"]=36193);h.webgl_depth_texture&&(c(S,{depth:6402,"depth stencil":34041}),c(R,{uint16:5123,uint32:5125,"depth stencil":34042}));h.webgl_compressed_texture_s3tc&&
c(V,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});h.webgl_compressed_texture_atc&&c(V,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});h.webgl_compressed_texture_pvrtc&&c(V,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});h.webgl_compressed_texture_etc1&&(V["rgb etc1"]=36196);var ca=Array.prototype.slice.call(b.getParameter(34467));Object.keys(V).forEach(function(a){var b=
V[a];0<=ca.indexOf(b)&&(S[a]=b)});var Z=Object.keys(S);q.textureFormats=Z;var Ba=[];Object.keys(S).forEach(function(a){Ba[S[a]]=a});var Ca=[];Object.keys(R).forEach(function(a){Ca[R[a]]=a});var Da=[];Object.keys(Y).forEach(function(a){Da[Y[a]]=a});var Ea=[];Object.keys(ba).forEach(function(a){Ea[ba[a]]=a});var ra=[];Object.keys(J).forEach(function(a){ra[J[a]]=a});var La=Z.reduce(function(a,b){var c=S[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?
a[c]=6408:a[c]=6407;return a},{}),Ia=[],Ja=[],Ka=0,aa={},ha=q.maxTextureUnits,ia=Array(ha).map(function(){return null});c(pa.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var c=0;c<ha;++c){var d=ia[c];if(d){if(0<d.bindCount)continue;d.unit=-1}ia[c]=this;a=c;break}B.profile&&A.maxTextureUnits<a+1&&(A.maxTextureUnits=a+1);this.unit=a;b.activeTexture(33984+a);b.bindTexture(this.target,this.texture)}return a},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&
qa(this)}});B.profile&&(A.getTotalTextureSize=function(){var a=0;Object.keys(aa).forEach(function(b){a+=aa[b].stats.size});return a});return{create2D:function(a,c){function d(a,b){var c=f.texInfo;Q.call(c);var e=na();"number"===typeof a?"number"===typeof b?K(e,a|0,b|0):K(e,a|0,a|0):a?(da(c,a),E(e,a)):K(e,1,1);c.genMipmaps&&(e.mipmask=(e.width<<1)-1);f.mipmask=e.mipmask;N(f,e);f.internalformat=e.internalformat;d.width=e.width;d.height=e.height;fa(f);xa(e,3553);ea(c,3553);U();ya(e);B.profile&&(f.stats.size=
m(f.internalformat,f.type,e.width,e.height,c.genMipmaps,!1));d.format=Ba[f.internalformat];d.type=Ca[f.type];d.mag=Da[c.magFilter];d.min=Ea[c.minFilter];d.wrapS=ra[c.wrapS];d.wrapT=ra[c.wrapT];return d}var f=new pa(3553);aa[f.id]=f;A.textureCount++;d(a,c);d.subimage=function(a,b,c,e){b|=0;c|=0;e|=0;var g=X();N(g,f);g.width>>=e;g.height>>=e;g.width-=b;g.height-=c;p(g,a);fa(f);W(g,3553,b,c,e);U();ga(g);return d};d.resize=function(a,c){var e=a|0,g=c|0||e;if(e===f.width&&g===f.height)return d;d.width=
f.width=e;d.height=f.height=g;fa(f);for(var k=0;f.mipmask>>k;++k)b.texImage2D(3553,k,f.format,e>>k,g>>k,0,f.format,f.type,null);U();B.profile&&(f.stats.size=m(f.internalformat,f.type,e,g,!1,!1));return d};d._reglType="texture2d";d._texture=f;B.profile&&(d.stats=f.stats);d.destroy=function(){f.decRef()};return d},createCube:function(a,c,d,f,g,k){function h(a,b,c,d,e,f){var g,k=l.texInfo;Q.call(k);for(g=0;6>g;++g)q[g]=na();if("number"===typeof a||!a)for(a=a|0||1,g=0;6>g;++g)K(q[g],a,a);else if("object"===
typeof a)if(b)E(q[0],a),E(q[1],b),E(q[2],c),E(q[3],d),E(q[4],e),E(q[5],f);else if(da(k,a),ta(l,a),"faces"in a)for(a=a.faces,g=0;6>g;++g)N(q[g],l),E(q[g],a[g]);else for(g=0;6>g;++g)E(q[g],a);N(l,q[0]);l.mipmask=k.genMipmaps?(q[0].width<<1)-1:q[0].mipmask;l.internalformat=q[0].internalformat;h.width=q[0].width;h.height=q[0].height;fa(l);for(g=0;6>g;++g)xa(q[g],34069+g);ea(k,34067);U();B.profile&&(l.stats.size=m(l.internalformat,l.type,h.width,h.height,k.genMipmaps,!0));h.format=Ba[l.internalformat];
h.type=Ca[l.type];h.mag=Da[k.magFilter];h.min=Ea[k.minFilter];h.wrapS=ra[k.wrapS];h.wrapT=ra[k.wrapT];for(g=0;6>g;++g)ya(q[g]);return h}var l=new pa(34067);aa[l.id]=l;A.cubeCount++;var q=Array(6);h(a,c,d,f,g,k);h.subimage=function(a,b,c,d,e){c|=0;d|=0;e|=0;var f=X();N(f,l);f.width>>=e;f.height>>=e;f.width-=c;f.height-=d;p(f,b);fa(l);W(f,34069+a,c,d,e);U();ga(f);return h};h.resize=function(a){a|=0;if(a!==l.width){h.width=l.width=a;h.height=l.height=a;fa(l);for(var c=0;6>c;++c)for(var d=0;l.mipmask>>
d;++d)b.texImage2D(34069+c,d,l.format,a>>d,a>>d,0,l.format,l.type,null);U();B.profile&&(l.stats.size=m(l.internalformat,l.type,h.width,h.height,!1,!0));return h}};h._reglType="textureCube";h._texture=l;B.profile&&(h.stats=l.stats);h.destroy=function(){l.decRef()};return h},clear:function(){for(var a=0;a<ha;++a)b.activeTexture(33984+a),b.bindTexture(3553,null),ia[a]=null;w(aa).forEach(qa);A.cubeCount=0;A.textureCount=0},getTexture:function(a){return null},restore:function(){w(aa).forEach(function(a){a.texture=
b.createTexture();b.bindTexture(a.target,a.texture);for(var c=0;32>c;++c)if(0!==(a.mipmask&1<<c))if(3553===a.target)b.texImage2D(3553,c,a.internalformat,a.width>>c,a.height>>c,0,a.internalformat,a.type,null);else for(var d=0;6>d;++d)b.texImage2D(34069+d,c,a.internalformat,a.width>>c,a.height>>c,0,a.internalformat,a.type,null);ea(a.texInfo,a.target)})}}}},{"./constants/arraytypes.json":4,"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,
"./util/to-half-float":30,"./util/values":31}],20:[function(h,n,r){n.exports=function(h,a){function g(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function n(a,c,d){var m=w.pop()||new g;m.startQueryIndex=a;m.endQueryIndex=c;m.sum=0;m.stats=d;r.push(m)}var d=a.ext_disjoint_timer_query;if(!d)return null;var m=[],c=[],w=[],r=[],G=[],z=[];return{beginQuery:function(a){var g=m.pop()||d.createQueryEXT();d.beginQueryEXT(35007,g);c.push(g);n(c.length-1,c.length,a)},endQuery:function(){d.endQueryEXT(35007)},
pushScopeStats:n,update:function(){var a,g;a=c.length;if(0!==a){z.length=Math.max(z.length,a+1);G.length=Math.max(G.length,a+1);G[0]=0;var h=z[0]=0;for(g=a=0;g<c.length;++g){var l=c[g];d.getQueryObjectEXT(l,34919)?(h+=d.getQueryObjectEXT(l,34918),m.push(l)):c[a++]=l;G[g+1]=h;z[g+1]=a}c.length=a;for(g=a=0;g<r.length;++g){var h=r[g],k=h.startQueryIndex,l=h.endQueryIndex;h.sum+=G[l]-G[k];k=z[k];l=z[l];l===k?(h.stats.gpuTime+=h.sum/1E6,w.push(h)):(h.startQueryIndex=k,h.endQueryIndex=l,r[a++]=h)}r.length=
a}},getNumPendingQueries:function(){return c.length},clear:function(){m.push.apply(m,c);for(var a=0;a<m.length;a++)d.deleteQueryEXT(m[a]);c.length=0;m.length=0},restore:function(){c.length=0;m.length=0}}}},{}],21:[function(h,n,r){n.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(h,n,r){function l(a){return Array.prototype.slice.call(a)}function a(a){return l(a).join("")}var g=h("./extend");n.exports=function(){function h(){var c=
[],d=[];return g(function(){c.push.apply(c,l(arguments))},{def:function(){var a="v"+m++;d.push(a);0<arguments.length&&(c.push(a,"="),c.push.apply(c,l(arguments)),c.push(";"));return a},toString:function(){return a([0<d.length?"var "+d+";":"",a(c)])}})}function d(){function a(g,f){d(g,f,"=",c.def(g,f),";")}var c=h(),d=h(),m=c.toString,n=d.toString;return g(function(){c.apply(c,l(arguments))},{def:c.def,entry:c,exit:d,save:a,set:function(d,f,g){a(d,f);c(d,f,"=",g,";")},toString:function(){return m()+
n()}})}var m=0,c=[],n=[],r=h(),G={};return{global:r,link:function(a){for(var d=0;d<n.length;++d)if(n[d]===a)return c[d];d="g"+m++;c.push(d);n.push(a);return d},block:h,proc:function(c,m){function h(){var a="a"+l.length;l.push(a);return a}var l=[];m=m||0;for(var n=0;n<m;++n)h();var n=d(),k=n.toString;return G[c]=g(n,{arg:h,toString:function(){return a(["function(",l.join(),"){",k(),"}"])}})},scope:d,cond:function(){var c=a(arguments),m=d(),h=d(),n=m.toString,w=h.toString;return g(m,{then:function(){m.apply(m,
l(arguments));return this},"else":function(){h.apply(h,l(arguments));return this},toString:function(){var d=w();d&&(d="else{"+d+"}");return a(["if(",c,"){",n(),"}",d])}})},compile:function(){var d=['"use strict";',r,"return {"];Object.keys(G).forEach(function(a){d.push('"',a,'":',G[a].toString(),",")});d.push("}");var g=a(d).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,c.concat(g)).apply(null,n)}}}},{"./extend":23}],23:[function(h,n,r){n.exports=function(h,
a){for(var g=Object.keys(a),n=0;n<g.length;++n)h[g[n]]=a[g[n]];return h}},{}],24:[function(h,n,r){var l=h("./is-typed-array");n.exports=function(a){return Array.isArray(a)||l(a)}},{"./is-typed-array":26}],25:[function(h,n,r){var l=h("./is-typed-array");n.exports=function(a){return!!a&&"object"===typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"===typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||l(a.data))}},{"./is-typed-array":26}],26:[function(h,n,r){var l=
h("../constants/arraytypes.json");n.exports=function(a){return Object.prototype.toString.call(a)in l}},{"../constants/arraytypes.json":4}],27:[function(h,n,r){n.exports=function(h,a){for(var g=Array(h),n=0;n<h;++n)g[n]=a(n);return g}},{}],28:[function(h,n,r){function l(a){var g,c;g=(65535<a)<<4;a>>>=g;c=(255<a)<<3;a>>>=c;g|=c;c=(15<a)<<2;a>>>=c;g|=c;c=(3<a)<<1;return g|c|a>>>c>>1}function a(a){a:{for(var g=16;268435456>=g;g*=16)if(a<=g){a=g;break a}a=0}g=C[l(a)>>2];return 0<g.length?g.pop():new ArrayBuffer(a)}
function g(a){C[l(a.byteLength)>>2].push(a)}var C=h("./loop")(8,function(){return[]});n.exports={alloc:a,free:g,allocType:function(d,g){var c=null;switch(d){case 5120:c=new Int8Array(a(g),0,g);break;case 5121:c=new Uint8Array(a(g),0,g);break;case 5122:c=new Int16Array(a(2*g),0,g);break;case 5123:c=new Uint16Array(a(2*g),0,g);break;case 5124:c=new Int32Array(a(4*g),0,g);break;case 5125:c=new Uint32Array(a(4*g),0,g);break;case 5126:c=new Float32Array(a(4*g),0,g);break;default:return null}return c.length!==
g?c.subarray(0,g):c},freeType:function(a){g(a.buffer)}}},{"./loop":27}],29:[function(h,n,r){n.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(h){return requestAnimationFrame(h)},cancel:function(h){return cancelAnimationFrame(h)}}:{next:function(h){return setTimeout(h,16)},cancel:clearTimeout}},{}],30:[function(h,n,r){var l=h("./pool"),a=new Float32Array(1),g=new Uint32Array(a.buffer);n.exports=function(h){for(var d=l.allocType(5123,h.length),
m=0;m<h.length;++m)if(isNaN(h[m]))d[m]=65535;else if(Infinity===h[m])d[m]=31744;else if(-Infinity===h[m])d[m]=64512;else{a[0]=h[m];var c=g[0],n=c>>>31<<15,r=(c<<1>>>24)-127,c=c>>13&1023;d[m]=-24>r?n:-14>r?n+(c+1024>>-14-r):15<r?n+31744:n+(r+15<<10)+c}return d}},{"./pool":28}],31:[function(h,n,r){n.exports=function(h){return Object.keys(h).map(function(a){return h[a]})}},{}],32:[function(h,n,r){function l(a,c,g){function h(){var c=window.innerWidth,n=window.innerHeight;a!==document.body&&(n=a.getBoundingClientRect(),
c=n.right-n.left,n=n.top-n.bottom);l.width=g*c;l.height=g*n;d(l.style,{width:c+"px",height:n+"px"})}var l=document.createElement("canvas");d(l.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(l);a===document.body&&(l.style.position="absolute",d(a.style,{margin:0,padding:0}));window.addEventListener("resize",h,!1);h();return{canvas:l,onDestroy:function(){window.removeEventListener("resize",h);a.removeChild(l)}}}function a(a,c){function d(g){try{return a.getContext(g,c)}catch(h){return null}}
return d("webgl")||d("experimental-webgl")||d("webgl-experimental")}function g(a){return"string"===typeof a?a.split():a}function C(a){return"string"===typeof a?document.querySelector(a):a}var d=h("./util/extend");n.exports=function(d){var c=d||{},h,n,r,z;d={};var t=[],H=[],v="undefined"===typeof window?1:window.devicePixelRatio,D=!1,k=function(a){},f=function(){};"string"===typeof c?h=document.querySelector(c):"object"===typeof c&&("string"===typeof c.nodeName&&"function"===typeof c.appendChild&&
"function"===typeof c.getBoundingClientRect?h=c:"function"===typeof c.drawArrays||"function"===typeof c.drawElements?(z=c,r=z.canvas):("gl"in c?z=c.gl:"canvas"in c?r=C(c.canvas):"container"in c&&(n=C(c.container)),"attributes"in c&&(d=c.attributes),"extensions"in c&&(t=g(c.extensions)),"optionalExtensions"in c&&(H=g(c.optionalExtensions)),"onDone"in c&&(k=c.onDone),"profile"in c&&(D=!!c.profile),"pixelRatio"in c&&(v=+c.pixelRatio)));h&&("canvas"===h.nodeName.toLowerCase()?r=h:n=h);if(!z){if(!r){h=
l(n||document.body,k,v);if(!h)return null;r=h.canvas;f=h.onDestroy}z=a(r,d)}return z?{gl:z,canvas:r,container:n,extensions:t,optionalExtensions:H,pixelRatio:v,profile:D,onDone:k,onDestroy:f}:(f(),k("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/extend":23}],33:[function(h,n,r){n.exports=function(a,g){function h(a){var b=!1;"altKey"in a&&(b=b||a.altKey!==f.alt,f.alt=!!a.altKey);"shiftKey"in a&&(b=b||a.shiftKey!==f.shift,f.shift=!!a.shiftKey);
"ctrlKey"in a&&(b=b||a.ctrlKey!==f.control,f.control=!!a.ctrlKey);"metaKey"in a&&(b=b||a.metaKey!==f.meta,f.meta=!!a.metaKey);return b}function d(a,b){var c=l.x(b),d=l.y(b);"buttons"in b&&(a=b.buttons|0);if(a!==v||c!==D||d!==k||h(b))v=a|0,D=c||0,k=d||0,g&&g(v,D,k,f)}function m(a){d(0,a)}function c(){if(v||D||k||f.shift||f.alt||f.meta||f.control)v=D=k=0,f.shift=f.alt=f.control=f.meta=!1,g&&g(0,0,0,f)}function n(a){h(a)&&g&&g(v,D,k,f)}function r(a){0===l.buttons(a)?d(0,a):d(v,a)}function G(a){d(v|l.buttons(a),
a)}function z(a){d(v&~l.buttons(a),a)}function t(){B||(B=!0,a.addEventListener("mousemove",r),a.addEventListener("mousedown",G),a.addEventListener("mouseup",z),a.addEventListener("mouseleave",m),a.addEventListener("mouseenter",m),a.addEventListener("mouseout",m),a.addEventListener("mouseover",m),a.addEventListener("blur",c),a.addEventListener("keyup",n),a.addEventListener("keydown",n),a.addEventListener("keypress",n),a!==window&&(window.addEventListener("blur",c),window.addEventListener("keyup",n),
window.addEventListener("keydown",n),window.addEventListener("keypress",n)))}function H(){B&&(B=!1,a.removeEventListener("mousemove",r),a.removeEventListener("mousedown",G),a.removeEventListener("mouseup",z),a.removeEventListener("mouseleave",m),a.removeEventListener("mouseenter",m),a.removeEventListener("mouseout",m),a.removeEventListener("mouseover",m),a.removeEventListener("blur",c),a.removeEventListener("keyup",n),a.removeEventListener("keydown",n),a.removeEventListener("keypress",n),a!==window&&
(window.removeEventListener("blur",c),window.removeEventListener("keyup",n),window.removeEventListener("keydown",n),window.removeEventListener("keypress",n)))}g||(g=a,a=window);var v=0,D=0,k=0,f={shift:!1,alt:!1,control:!1,meta:!1},B=!1;t();var A={element:a};Object.defineProperties(A,{enabled:{get:function(){return B},set:function(a){a?t():H},enumerable:!0},buttons:{get:function(){return v},enumerable:!0},x:{get:function(){return D},enumerable:!0},y:{get:function(){return k},enumerable:!0},mods:{get:function(){return f},
enumerable:!0}});return A};var l=h("mouse-event")},{"mouse-event":34}],34:[function(h,n,r){function l(a){return a.target||a.srcElement||window}r.buttons=function(a){if("object"===typeof a){if("buttons"in a)return a.buttons;if("which"in a){a=a.which;if(2===a)return 4;if(3===a)return 2;if(0<a)return 1<<a-1}else if("button"in a){a=a.button;if(1===a)return 4;if(2===a)return 2;if(0<=a)return 1<<a}}return 0};r.element=l;r.x=function(a){if("object"===typeof a){if("offsetX"in a)return a.offsetX;var g=l(a).getBoundingClientRect();
return a.clientX-g.left}return 0};r.y=function(a){if("object"===typeof a){if("offsetY"in a)return a.offsetY;var g=l(a).getBoundingClientRect();return a.clientY-g.top}return 0}},{}],35:[function(h,n,r){function l(a,c){for(var d=0;d<a.length;++d)if(a[d]===c)return d;return-1}var a=h("./lib/util/extend"),g=h("./lib/dynamic"),C=h("./lib/util/raf"),d=h("./lib/util/clock"),m=h("./lib/strings"),c=h("./lib/webgl"),w=h("./lib/extension"),I=h("./lib/limits"),G=h("./lib/buffer"),z=h("./lib/elements"),t=h("./lib/texture"),
H=h("./lib/renderbuffer"),v=h("./lib/framebuffer"),D=h("./lib/attribute"),k=h("./lib/shader"),f=h("./lib/read"),B=h("./lib/core"),A=h("./lib/stats"),q=h("./lib/timer");n.exports=function(b){function h(){if(0===P.length)E&&E.update(),ca=null;else{ca=C.next(h);ta();for(var a=P.length-1;0<=a;--a){var b=P[a];b&&b(Q,null,0)}p.flush();E&&E.update()}}function n(){!ca&&0<P.length&&(ca=C.next(h))}function r(){ca&&(C.cancel(h),ca=null)}function Fa(a){a.preventDefault();r();R.forEach(function(a){a()})}function za(a){p.getError();
X.restore();fa.restore();ea.restore();U.restore();qa.restore();oa.restore();E&&E.restore();J.procs.refresh();n();S.forEach(function(a){a()})}function ka(b){function c(a){var b={},d={};Object.keys(a).forEach(function(c){var f=a[c];g.isDynamic(f)?d[c]=g.unbox(f,c):b[c]=f});return{dynamic:d,"static":b}}function d(a){for(;q.length<a;)q.push(null);return q}var f=c(b.context||{}),h=c(b.uniforms||{}),k=c(b.attributes||{}),l=c(function(b){function c(a){if(a in d){var b=d[a];delete d[a];Object.keys(b).forEach(function(c){d[a+
"."+c]=b[c]})}}var d=a({},b);delete d.uniforms;delete d.attributes;delete d.context;"stencil"in d&&d.stencil.op&&(d.stencil.opBack=d.stencil.opFront=d.stencil.op,delete d.stencil.op);c("blend");c("depth");c("cull");c("stencil");c("polygonOffset");c("scissor");c("sample");return d}(b));b={gpuTime:0,cpuTime:0,count:0};var f=J.compile(l,k,h,f,b),m=f.draw,n=f.batch,p=f.scope,q=[];return a(function(a,b){var c;if("function"===typeof a)return p.call(this,null,a,0);if("function"===typeof b)if("number"===
typeof a)for(c=0;c<a;++c)p.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)p.call(this,a[c],b,c);else return p.call(this,a,b,0);else if("number"===typeof a){if(0<a)return n.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return n.call(this,a,a.length)}else return m.call(this,a)},{stats:b})}function la(a){P.push(a);n();return{cancel:function(){function b(){var a=l(P,b);P[a]=P[P.length-1];--P.length;0>=P.length&&r()}var c=l(P,a);P[c]=b}}}function N(){var a=Y.viewport,
b=Y.scissor_box;a[0]=a[1]=b[0]=b[1]=0;Q.viewportWidth=Q.framebufferWidth=Q.drawingBufferWidth=a[2]=b[2]=p.drawingBufferWidth;Q.viewportHeight=Q.framebufferHeight=Q.drawingBufferHeight=a[3]=b[3]=p.drawingBufferHeight}function ta(){Q.tick+=1;Q.time=ua();N();J.procs.poll()}function ma(){N();J.procs.refresh();E&&E.update()}function ua(){return(d()-xa)/1E3}b=c(b);if(!b)return null;var p=b.gl,W=p.getContextAttributes();p.isContextLost();var X=w(p,b);if(!X)return null;var ga=m(),T=A(),K=X.extensions,E=q(p,
K),xa=d(),na=p.drawingBufferWidth,ya=p.drawingBufferHeight,Q={tick:0,time:0,viewportWidth:na,viewportHeight:ya,framebufferWidth:na,framebufferHeight:ya,drawingBufferWidth:na,drawingBufferHeight:ya,pixelRatio:b.pixelRatio},da=I(p,K),ea=G(p,T,b),pa=z(p,K,ea,T),na=D(p,K,da,ea,ga),fa=k(p,ga,T,b),U=t(p,K,da,function(){J.procs.poll()},Q,T,b),qa=H(p,K,da,T,b),oa=v(p,K,da,U,qa,T),J=B(p,ga,K,da,ea,pa,U,oa,{},na,fa,{elements:null,primitive:4,count:-1,offset:0,instances:-1},Q,E,b),ga=f(p,oa,J.procs.poll,Q,W,
K),Y=J.next,ba=p.canvas,P=[],R=[],S=[],V=[b.onDestroy],ca=null;ba&&(ba.addEventListener("webglcontextlost",Fa,!1),ba.addEventListener("webglcontextrestored",za,!1));ma();W=a(ka,{clear:function(a){var b=0;J.procs.poll();var c=a.color;c&&(p.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(p.clearDepth(+a.depth),b|=256);"stencil"in a&&(p.clearStencil(a.stencil|0),b|=1024);p.clear(b)},prop:g.define.bind(null,1),context:g.define.bind(null,2),"this":g.define.bind(null,3),draw:ka({}),
buffer:function(a){return ea.create(a,34962,!1,!1)},elements:function(a){return pa.create(a,!1)},texture:U.create2D,cube:U.createCube,renderbuffer:qa.create,framebuffer:oa.create,framebufferCube:oa.createCube,attributes:W,frame:la,on:function(a,b){var c;switch(a){case "frame":return la(b);case "lost":c=R;break;case "restore":c=S;break;case "destroy":c=V}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:da,hasExtension:function(a){return 0<=
da.extensions.indexOf(a.toLowerCase())},read:ga,destroy:function(){P.length=0;r();ba&&(ba.removeEventListener("webglcontextlost",Fa),ba.removeEventListener("webglcontextrestored",za));fa.clear();oa.clear();qa.clear();U.clear();pa.clear();ea.clear();E&&E.clear();V.forEach(function(a){a()})},_gl:p,_refresh:ma,poll:function(){ta();E&&E.update()},now:ua,stats:T});b.onDone(null,W);return W}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,
"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},{},[1]);
