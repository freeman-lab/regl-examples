<!DOCTYPE html>
      <html>
        <head>
          <title>example/instance-triangle.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(t,n,h){function c(b,g){if(!n[b]){if(!t[b]){var a="function"==typeof require&&require;if(!g&&a)return a(b,!0);if(u)return u(b,!0);a=Error("Cannot find module '"+b+"'");throw a.code="MODULE_NOT_FOUND",a;}a=n[b]={exports:{}};t[b][0].call(a.exports,function(g){var a=t[b][1][g];return c(a?a:g)},a,a.exports,e$$0,t,n,h)}return n[b].exports}for(var u="function"==typeof require&&require,l=0;l<h.length;l++)c(h[l]);return c})({1:[function(d,t,n){var h=d("../regl")({extensions:["angle_instanced_arrays"]}),
c=[];for(d=0;100>d;d++)c[d]=2*Math.random()*Math.PI;var u=h.buffer({length:4*c.length,type:"float",usage:"dynamic"}),l=h({frag:"\n  precision mediump float;\n\n  varying vec3 vColor;\n  void main() {\n    gl_FragColor = vec4(vColor, 1.0);\n  }",vert:"\n  precision mediump float;\n\n  attribute vec2 position;\n\n  // These three are instanced attributes.\n  attribute vec3 color;\n  attribute vec2 offset;\n  attribute float angle;\n\n  varying vec3 vColor;\n\n  void main() {\n    gl_Position = vec4(\n      cos(angle) * position.x + sin(angle) * position.y + offset.x,\n        -sin(angle) * position.x + cos(angle) * position.y + offset.y, 0, 1);\n    vColor = color;\n  }",
attributes:{position:[[0,-.05],[-.05,0],[.05,.05]],offset:{buffer:h.buffer(Array(100).fill().map(function(b,g){return[2*Math.floor(g/10)/10+-.9,g%10*2/10+-.9]})),divisor:1},color:{buffer:h.buffer(Array(100).fill().map(function(b,g){var a=Math.floor(g/10)/10,c=g%10/10;return[a,c,a*c+.2]})),divisor:1},angle:{buffer:u,divisor:1}},depth:{enable:!1},count:3,instances:100});h.frame(function(){h.clear({color:[0,0,0,1]});for(var b=0;100>b;b++)c[b]+=.01;u.subdata(c);l()})},{"../regl":33}],2:[function(d,t,
n){function h(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}t.exports=function(c,u,l,b,g){c=l.maxAttributes;u=Array(c);for(l=0;l<c;++l)u[l]=new h;return{Record:h,scope:{},state:u}}},{}],3:[function(d,t,n){function h(b){return K[Object.prototype.toString.call(b)]|0}function c(b,g){for(var c=0;c<g.length;++c)b[c]=g[c]}function u(b,g,c,a,h,m,u){for(var l=0,f=0;f<c;++f)for(var N=0;N<a;++N)b[l++]=g[h*f+m*
N+u]}function l(b,g,c){for(var a=0,h=0;h<g.length;++h)for(var m=g[h],u=0;u<c;++u)b[a++]=m[u]}var b=d("./util/is-typed-array"),g=d("./util/is-ndarray"),a=d("./util/values"),y=d("./util/pool"),K=d("./constants/arraytypes.json"),E=d("./constants/dtypes.json"),z=d("./constants/usage.json"),m=[];m[5120]=1;m[5122]=2;m[5124]=4;m[5121]=1;m[5123]=2;m[5125]=4;m[5126]=4;t.exports=function(d,C,H){function k(b){this.id=G++;this.buffer=d.createBuffer();this.type=b;this.usage=35044;this.byteLength=0;this.dimension=
1;this.dtype=5121;this.persistentData=null;H.profile&&(this.stats={size:0})}function q(b,g,c){b.byteLength=g.byteLength;d.bufferData(b.type,g,c)}function t(a,f,k,d,m,N){a.usage=k;if(Array.isArray(f))a.dtype=d||5126,0<f.length&&(Array.isArray(f[0])?(a.dimension=f[0].length,d=y.allocType(a.dtype,f.length*a.dimension),l(d,f,a.dimension),q(a,d,k),N?a.persistentData=d:y.freeType(d)):"number"===typeof f[0]?(a.dimension=m,d=y.allocType(a.dtype,f.length),c(d,f),q(a,d,k),N?a.persistentData=d:y.freeType(d)):
b(f[0])&&(a.dimension=f[0].length,a.dtype=d||h(f[0])||5126,d=y.allocType(a.dtype,f.length*a.dimension),l(d,f,a.dimension),q(a,d,k),N?a.persistentData=d:y.freeType(d)));else if(b(f))a.dtype=d||h(f),a.dimension=m,q(a,f,k),N&&(a.persistentData=new Uint8Array(new Uint8Array(f.buffer)));else if(g(f)){var F=f.shape,J=f.stride;m=f.offset;var B=0,G=0,p=0,U=0;1===F.length?(B=F[0],G=1,p=J[0],U=0):2===F.length&&(B=F[0],G=F[1],p=J[0],U=J[1]);a.dtype=d||h(f.data)||5126;a.dimension=G;d=y.allocType(a.dtype,B*G);
u(d,f.data,B,G,p,U,m);q(a,d,k);N?a.persistentData=d:y.freeType(d)}}function B(b){C.bufferCount--;d.deleteBuffer(b.buffer);b.buffer=null;delete f[b.id]}var G=0,f={};k.prototype.bind=function(){d.bindBuffer(this.type,this.buffer)};k.prototype.destroy=function(){B(this)};var N=[];H.profile&&(C.getTotalBufferSize=function(){var b=0;Object.keys(f).forEach(function(a){b+=f[a].stats.size});return b});return{create:function(a,q,N,G){function K(a){var f=35044,c=null,h=0,p=0,k=1;Array.isArray(a)||b(a)||g(a)?
c=a:"number"===typeof a?h=a|0:a&&("data"in a&&(c=a.data),"usage"in a&&(f=z[a.usage]),"type"in a&&(p=E[a.type]),"dimension"in a&&(k=a.dimension|0),"length"in a&&(h=a.length|0));n.bind();c?t(n,c,f,p,k,G):(d.bufferData(n.type,h,f),n.dtype=p||5121,n.usage=f,n.dimension=k,n.byteLength=h);H.profile&&(n.stats.size=n.byteLength*m[n.dtype]);return K}C.bufferCount++;var n=new k(q);f[n.id]=n;N||K(a);K._reglType="buffer";K._buffer=n;K.subdata=function(a,f){var k=(f||0)|0;n.bind();if(Array.isArray(a)){if(0<a.length)if("number"===
typeof a[0]){var m=y.allocType(n.dtype,a.length);c(m,a);d.bufferSubData(n.type,k,m);y.freeType(m)}else if(Array.isArray(a[0])||b(a[0])){var m=a[0].length,p=y.allocType(n.dtype,a.length*m);l(p,a,m);d.bufferSubData(n.type,k,p);y.freeType(p)}}else if(b(a))d.bufferSubData(n.type,k,a);else if(g(a)){var q=a.shape,N=a.stride,G=p=m=0,B=0;1===q.length?(m=q[0],p=1,G=N[0],B=0):2===q.length&&(m=q[0],p=q[1],G=N[0],B=N[1]);q=Array.isArray(a.data)?n.dtype:h(a.data);q=y.allocType(q,m*p);u(q,a.data,m,p,G,B,a.offset);
d.bufferSubData(n.type,k,q);y.freeType(q)}return K};H.profile&&(K.stats=n.stats);K.destroy=function(){B(n)};return K},createStream:function(a,b){var f=N.pop();f||(f=new k(a));f.bind();t(f,b,35040,0,1,!1);return f},destroyStream:function(a){N.push(a)},clear:function(){a(f).forEach(B);N.forEach(B)},getBuffer:function(a){return a&&a._buffer instanceof k?a._buffer:null},restore:function(){a(f).forEach(function(a){a.buffer=d.createBuffer();d.bindBuffer(a.type,a.buffer);d.bufferData(a.type,a.persistentData||
a.byteLength,a.usage)})},_initBuffer:t}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],4:[function(d,t,n){t.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,
"[object ArrayBuffer]":5121}},{}],5:[function(d,t,n){t.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(d,t,n){t.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(d,t,n){t.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(d,t,n){function h(a){return Array.isArray(a)||K(a)||E(a)}function c(a){return a.sort(function(a,
b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function u(a,b,f,g){this.thisDep=a;this.contextDep=b;this.propDep=f;this.append=g}function l(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function b(a){return new u(!1,!1,!1,a)}function g(a,b){var f=a.type;return 0===f?(f=a.data.length,new u(!0,1<=f,2<=f,b)):4===f?(f=a.data,new u(f.thisDep,f.contextDep,f.propDep,b)):new u(3===f,2===f,1===f,b)}var a=d("./util/codegen"),y=d("./util/loop"),K=d("./util/is-typed-array"),E=d("./util/is-ndarray"),
z=d("./util/is-array-like"),m=d("./dynamic"),F=d("./constants/primitives.json"),C=d("./constants/dtypes.json"),H=["x","y","z","w"],k="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),q={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,
"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},O={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},B={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},G={cw:2304,ccw:2305},f=new u(!1,!1,!1,function(){});t.exports=function(d,t,n,K,E,P,Ba,Q,J,na,ta,p,U,ca,ka){function X(r){return r.replace(".",
"_")}function M(r,a,e){var b=X(r);Ha.push(r);Ca[b]=ua[b]=!!e;va[b]=a}function D(r,a,e){var b=X(r);Ha.push(r);Array.isArray(e)?(ua[b]=e.slice(),Ca[b]=e.slice()):ua[b]=Ca[b]=e;wa[b]=a}function xa(){var r=a(),e=r.link,b=r.global;r.id=Na++;r.batchId="0";var f=e(Ma),g=r.shared={props:"a0"};Object.keys(Ma).forEach(function(v){g[v]=b.def(f,".",v)});var c=r.next={},V=r.current={};Object.keys(wa).forEach(function(v){Array.isArray(ua[v])&&(c[v]=b.def(g.next,".",v),V[v]=b.def(g.current,".",v))});var Oa=r.constants=
{};Object.keys(Ia).forEach(function(v){Oa[v]=b.def(JSON.stringify(Ia[v]))});r.invoke=function(v,a){switch(a.type){case 0:var b=["this",g.context,g.props,r.batchId];return v.def(e(a.data),".call(",b.slice(0,Math.max(a.data.length+1,4)),")");case 1:return v.def(g.props,a.data);case 2:return v.def(g.context,a.data);case 3:return v.def("this",a.data);case 4:return a.data.append(r,v),a.data.ref}};r.attribCache={};var v={};r.scopeAttrib=function(a){a=t.id(a);if(a in v)return v[a];var r=na.scope[a];r||(r=
na.scope[a]=new w);return v[a]=e(r)};return r}function oa(a){var e=a["static"];a=a.dynamic;var f;if("profile"in e){var c=!!e.profile;f=b(function(a,e){return c});f.enable=c}else if("profile"in a){var w=a.profile;f=g(w,function(a,e){return a.invoke(e,w)})}return f}function ya(a,e){var f=a["static"],c=a.dynamic;if("framebuffer"in f){var w=f.framebuffer;return w?(w=Q.getFramebuffer(w),b(function(a,e){var v=a.link(w),r=a.shared;e.set(r.framebuffer,".next",v);r=r.context;e.set(r,".framebufferWidth",v+
".width");e.set(r,".framebufferHeight",v+".height");return v})):b(function(a,e){var v=a.shared;e.set(v.framebuffer,".next","null");v=v.context;e.set(v,".framebufferWidth",v+".drawingBufferWidth");e.set(v,".framebufferHeight",v+".drawingBufferHeight");return"null"})}if("framebuffer"in c){var d=c.framebuffer;return g(d,function(a,e){var v=a.invoke(e,d),r=a.shared,R=r.framebuffer,v=e.def(R,".getFramebuffer(",v,")");e.set(R,".next",v);r=r.context;e.set(r,".framebufferWidth",v+"?"+v+".width:"+r+".drawingBufferWidth");
e.set(r,".framebufferHeight",v+"?"+v+".height:"+r+".drawingBufferHeight");return v})}return null}function T(a,e,b){function f(a){if(a in c){var v=c[a];a=!0;var r=v.x|0,R=v.y|0,b,d;"width"in v?b=v.width|0:a=!1;"height"in v?d=v.height|0:a=!1;return new u(!a&&e&&e.thisDep,!a&&e&&e.contextDep,!a&&e&&e.propDep,function(a,e){var A=a.shared.context,f=b;"width"in v||(f=e.def(A,".","framebufferWidth","-",r));var g=d;"height"in v||(g=e.def(A,".","framebufferHeight","-",R));return[r,R,f,g]})}if(a in w){var V=
w[a];a=g(V,function(a,e){var v=a.invoke(e,V),r=a.shared.context,R=e.def(v,".x|0"),b=e.def(v,".y|0"),A=e.def('"width" in ',v,"?",v,".width|0:","(",r,".","framebufferWidth","-",R,")"),v=e.def('"height" in ',v,"?",v,".height|0:","(",r,".","framebufferHeight","-",b,")");return[R,b,A,v]});e&&(a.thisDep=a.thisDep||e.thisDep,a.contextDep=a.contextDep||e.contextDep,a.propDep=a.propDep||e.propDep);return a}return e?new u(e.thisDep,e.contextDep,e.propDep,function(a,e){var v=a.shared.context;return[0,0,e.def(v,
".","framebufferWidth"),e.def(v,".","framebufferHeight")]}):null}var c=a["static"],w=a.dynamic;if(a=f("viewport")){var d=a;a=new u(a.thisDep,a.contextDep,a.propDep,function(a,e){var r=d.append(a,e),R=a.shared.context;e.set(R,".viewportWidth",r[2]);e.set(R,".viewportHeight",r[3]);return r})}return{viewport:a,scissor_box:f("scissor.box")}}function fa(a){function e(a){if(a in f){var v=t.id(f[a]);a=b(function(){return v});a.id=v;return a}if(a in c){var r=c[a];return g(r,function(a,e){var v=a.invoke(e,
r);return e.def(a.shared.strings,".id(",v,")")})}return null}var f=a["static"],c=a.dynamic,w=e("frag"),d=e("vert"),V=null;l(w)&&l(d)?(V=ta.program(d.id,w.id),a=b(function(a,e){return a.link(V)})):a=new u(w&&w.thisDep||d&&d.thisDep,w&&w.contextDep||d&&d.contextDep,w&&w.propDep||d&&d.propDep,function(a,e){var r=a.shared.shader,R;R=w?w.append(a,e):e.def(r,".","frag");var b;b=d?d.append(a,e):e.def(r,".","vert");return e.def(r+".program("+b+","+R+")")});return{frag:w,vert:d,progVar:a,program:V}}function ga(a,
e){function f(a,e){if(a in c){var r=c[a]|0;return b(function(a,R){e&&(a.OFFSET=r);return r})}if(a in w){var R=w[a];return g(R,function(a,r){var b=a.invoke(r,R);e&&(a.OFFSET=b);return b})}return e&&d?b(function(a,e){a.OFFSET="0";return 0}):null}var c=a["static"],w=a.dynamic,d=function(){if("elements"in c){var a=c.elements;h(a)?a=P.getElements(P.create(a,!0)):a&&(a=P.getElements(a));var e=b(function(e,v){if(a){var r=e.link(a);return e.ELEMENTS=r}return e.ELEMENTS=null});e.value=a;return e}if("elements"in
w){var r=w.elements;return g(r,function(a,e){var v=a.shared,b=v.isBufferArgs,v=v.elements,f=a.invoke(e,r),A=e.def("null"),b=e.def(b,"(",f,")"),f=a.cond(b).then(A,"=",v,".createStream(",f,");")["else"](A,"=",v,".getElements(",f,");");e.entry(f);e.exit(a.cond(b).then(v,".destroyStream(",A,");"));return a.ELEMENTS=A})}return null}(),V=f("offset",!0);return{elements:d,primitive:function(){if("primitive"in c){var a=c.primitive;return b(function(e,v){return F[a]})}if("primitive"in w){var e=w.primitive;
return g(e,function(a,r){var b=a.constants.primTypes,f=a.invoke(r,e);return r.def(b,"[",f,"]")})}return d?l(d)?d.value?b(function(a,e){return e.def(a.ELEMENTS,".primType")}):b(function(){return 4}):new u(d.thisDep,d.contextDep,d.propDep,function(a,e){var v=a.ELEMENTS;return e.def(v,"?",v,".primType:",4)}):null}(),count:function(){if("count"in c){var a=c.count|0;return b(function(){return a})}if("count"in w){var e=w.count;return g(e,function(a,r){return a.invoke(r,e)})}return d?l(d)?d?V?new u(V.thisDep,
V.contextDep,V.propDep,function(a,e){return e.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):b(function(a,e){return e.def(a.ELEMENTS,".vertCount")}):b(function(){return-1}):new u(d.thisDep||V.thisDep,d.contextDep||V.contextDep,d.propDep||V.propDep,function(a,e){var v=a.ELEMENTS;return a.OFFSET?e.def(v,"?",v,".vertCount-",a.OFFSET,":-1"):e.def(v,"?",v,".vertCount:-1")}):null}(),instances:f("instances",!1),offset:V}}function qa(a,e){var f=a["static"],d=a.dynamic,c={};Ha.forEach(function(a){function e(v,A){if(a in
f){var R=v(f[a]);c[r]=b(function(){return R})}else if(a in d){var w=d[a];c[r]=g(w,function(a,e){return A(a,e,a.invoke(e,w))})}}var r=X(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return e(function(a){return a},function(a,e,r){return r});case "depth.func":return e(function(a){return O[a]},function(a,e,r){return e.def(a.constants.compareFuncs,
"[",r,"]")});case "depth.range":return e(function(a){return a},function(a,e,r){a=e.def("+",r,"[0]");e=e.def("+",r,"[1]");return[a,e]});case "blend.func":return e(function(a){return[q["srcRGB"in a?a.srcRGB:a.src],q["dstRGB"in a?a.dstRGB:a.dst],q["srcAlpha"in a?a.srcAlpha:a.src],q["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,e,r){function b(a,v){return e.def('"',a,v,'" in ',r,"?",r,".",a,v,":",r,".",a)}a=a.constants.blendFuncs;var f=b("src","RGB"),A=b("dst","RGB"),f=e.def(a,"[",f,"]"),c=e.def(a,"[",
b("src","Alpha"),"]"),A=e.def(a,"[",A,"]");a=e.def(a,"[",b("dst","Alpha"),"]");return[f,A,c,a]});case "blend.equation":return e(function(a){if("string"===typeof a)return[I[a],I[a]];if("object"===typeof a)return[I[a.rgb],I[a.alpha]]},function(a,e,r){var b=a.constants.blendEquations,f=e.def(),A=e.def();a=a.cond("typeof ",r,'==="string"');a.then(f,"=",A,"=",b,"[",r,"];");a["else"](f,"=",b,"[",r,".rgb];",A,"=",b,"[",r,".alpha];");e(a);return[f,A]});case "blend.color":return e(function(a){return y(4,function(e){return+a[e]})},
function(a,e,r){return y(4,function(a){return e.def("+",r,"[",a,"]")})});case "stencil.mask":return e(function(a){return a|0},function(a,e,r){return e.def(r,"|0")});case "stencil.func":return e(function(a){return[O[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,e,r){a=e.def('"cmp" in ',r,"?",a.constants.compareFuncs,"[",r,".cmp]",":",7680);var b=e.def(r,".ref|0");e=e.def('"mask" in ',r,"?",r,".mask|0:-1");return[a,b,e]});case "stencil.opFront":case "stencil.opBack":return e(function(e){return["stencil.opBack"===
a?1029:1028,B[e.fail||"keep"],B[e.zfail||"keep"],B[e.zpass||"keep"]]},function(e,r,b){function f(a){return r.def('"',a,'" in ',b,"?",A,"[",b,".",a,"]:",7680)}var A=e.constants.stencilOps;return["stencil.opBack"===a?1029:1028,f("fail"),f("zfail"),f("zpass")]});case "polygonOffset.offset":return e(function(a){return[a.factor|0,a.units|0]},function(a,e,r){a=e.def(r,".factor|0");e=e.def(r,".units|0");return[a,e]});case "cull.face":return e(function(a){var e=0;"front"===a?e=1028:"back"===a&&(e=1029);return e},
function(a,e,r){return e.def(r,'==="front"?',1028,":",1029)});case "lineWidth":return e(function(a){return a},function(a,e,r){return r});case "frontFace":return e(function(a){return G[a]},function(a,e,r){return e.def(r+'==="cw"?2304:2305')});case "colorMask":return e(function(a){return a.map(function(a){return!!a})},function(a,e,r){return y(4,function(a){return"!!"+r+"["+a+"]"})});case "sample.coverage":return e(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,e,r){a=e.def('"value" in ',
r,"?+",r,".value:1");e=e.def("!!",r,".invert");return[a,e]})}});return c}function ha(a,e){var f=a["static"],c=a.dynamic,d={};Object.keys(f).forEach(function(a){var e=f[a],r;if("number"===typeof e||"boolean"===typeof e)r=b(function(){return e});else if("function"===typeof e){var A=e._reglType;if("texture2d"===A||"textureCube"===A)r=b(function(a){return a.link(e)});else if("framebuffer"===A||"framebufferCube"===A)r=b(function(a){return a.link(e.color[0])})}else z(e)&&(r=b(function(a){return a.global.def("[",
y(e.length,function(a){return e[a]}),"]")}));r.value=e;d[a]=r});Object.keys(c).forEach(function(a){var e=c[a];d[a]=g(e,function(a,r){return a.invoke(r,e)})});return d}function Y(a,e){var f=a["static"],c=a.dynamic,d={};Object.keys(f).forEach(function(a){var e=f[a],r=t.id(a),A=new w;if(h(e))A.state=1,A.buffer=E.getBuffer(E.create(e,34962,!1,!0)),A.type=A.buffer.dtype;else{var c=E.getBuffer(e);if(c)A.state=1,A.buffer=c,A.type=c.dtype;else if(e.constant){var g=e.constant;A.buffer="null";A.state=2;"number"===
typeof g?A.x=g:H.forEach(function(a,e){e<g.length&&(A[a]=g[e])})}else{var c=h(e.buffer)?E.getBuffer(E.create(e.buffer,34962,!1,!0)):E.getBuffer(e.buffer),x=e.offset|0,p=e.stride|0,k=e.size|0,m=!!e.normalized,q=0;"type"in e&&(q=C[e.type]);e=e.divisor|0;A.buffer=c;A.state=1;A.size=k;A.normalized=m;A.type=q||c.dtype;A.offset=x;A.stride=p;A.divisor=e}}d[a]=b(function(a,e){var b=a.attribCache;if(r in b)return b[r];var f={isStream:!1};Object.keys(A).forEach(function(a){f[a]=A[a]});A.buffer&&(f.buffer=a.link(A.buffer));
return b[r]=f})});Object.keys(c).forEach(function(a){var e=c[a];d[a]=g(e,function(a,r){function A(a){r(g[a],"=",b,".",a,"|0;")}var b=a.invoke(r,e),f=a.shared,c=f.isBufferArgs,d=f.buffer,g={isStream:r.def(!1)},x=new w;x.state=1;Object.keys(x).forEach(function(a){g[a]=r.def(""+x[a])});var p=g.buffer,k=g.type;r("if(",c,"(",b,")){",g.isStream,"=true;",p,"=",d,".createStream(",34962,",",b,");",k,"=",p,".dtype;","}else{",p,"=",d,".getBuffer(",b,");","if(",p,"){",k,"=",p,".dtype;",'}else if("constant" in ',
b,"){",g.state,"=",2,";","if(typeof "+b+'.constant === "number"){',g[H[0]],"=",b,".constant;",H.slice(1).map(function(a){return g[a]}).join("="),"=0;","}else{",H.map(function(a,e){return g[a]+"="+b+".constant.length>="+e+"?"+b+".constant["+e+"]:0;"}).join(""),"}}else{","if(",c,"(",b,".buffer)){",p,"=",d,".createStream(",34962,",",b,".buffer);","}else{",p,"=",d,".getBuffer(",b,".buffer);","}",k,'="type" in ',b,"?",f.glTypes,"[",b,".type]:",p,".dtype;",g.normalized,"=!!",b,".normalized;");A("size");
A("offset");A("stride");A("divisor");r("}}");r.exit("if(",g.isStream,"){",d,".destroyStream(",p,");","}");return g})});return d}function ra(a){var e=a["static"],f=a.dynamic,c={};Object.keys(e).forEach(function(a){var r=e[a];c[a]=b(function(a,e){return"number"===typeof r||"boolean"===typeof r?""+r:a.link(r)})});Object.keys(f).forEach(function(a){var e=f[a];c[a]=g(e,function(a,r){return a.invoke(r,e)})});return c}function pa(a,e,b,f,c){var g=ya(a,c),d=T(a,g,c),w=ga(a,c),v=qa(a,c),p=fa(a,c),x=d.viewport;
x&&(v.viewport=x);x=X("scissor.box");(d=d[x])&&(v[x]=d);d=0<Object.keys(v).length;g={framebuffer:g,draw:w,shader:p,state:v,dirty:d};g.profile=oa(a,c);g.uniforms=ha(b,c);g.attributes=Y(e,c);g.context=ra(f,c);return g}function L(a,e,b){var f=a.shared.context,c=a.scope();Object.keys(b).forEach(function(g){e.save(f,"."+g);c(f,".",g,"=",b[g].append(a,e),";")});e(c)}function ia(a,e,b,f){var c=a.shared,g=c.gl,d=c.framebuffer,w;Ja&&(w=e.def(c.extensions,".webgl_draw_buffers"));var v=a.constants,c=v.drawBuffer,
v=v.backBuffer;a=b?b.append(a,e):e.def(d,".next");f||e("if(",a,"!==",d,".cur){");e("if(",a,"){",g,".bindFramebuffer(",36160,",",a,".framebuffer);");Ja&&e(w,".drawBuffersWEBGL(",c,"[",a,".colorAttachments.length]);");e("}else{",g,".bindFramebuffer(",36160,",null);");Ja&&e(w,".drawBuffersWEBGL(",v,");");e("}",d,".cur=",a,";");f||e("}")}function la(a,e,b){var f=a.shared,c=f.gl,g=a.current,d=a.next,w=f.current,v=f.next,x=a.cond(w,".dirty");Ha.forEach(function(e){e=X(e);if(!(e in b.state)){var f,A;if(e in
d){f=d[e];A=g[e];var p=y(ua[e].length,function(a){return x.def(f,"[",a,"]")});x(a.cond(p.map(function(a,e){return a+"!=="+A+"["+e+"]"}).join("||")).then(c,".",wa[e],"(",p,");",p.map(function(a,e){return A+"["+e+"]="+a}).join(";"),";"))}else f=x.def(v,".",e),p=a.cond(f,"!==",w,".",e),x(p),e in va?p(a.cond(f).then(c,".enable(",va[e],");")["else"](c,".disable(",va[e],");"),w,".",e,"=",f,";"):p(c,".",wa[e],"(",f,");",w,".",e,"=",f,";")}});0===Object.keys(b.state).length&&x(w,".dirty=false;");e(x)}function S(a,
e,b,f){var g=a.shared,d=a.current,w=g.current,x=g.gl;c(Object.keys(b)).forEach(function(c){var g=b[c];if(!f||f(g)){var p=g.append(a,e);if(va[c]){var k=va[c];l(g)?p?e(x,".enable(",k,");"):e(x,".disable(",k,");"):e(a.cond(p).then(x,".enable(",k,");")["else"](x,".disable(",k,");"));e(w,".",c,"=",p,";")}else if(z(p)){var h=d[c];e(x,".",wa[c],"(",p,");",p.map(function(a,e){return h+"["+e+"]="+a}).join(";"),";")}else e(x,".",wa[c],"(",p,");",w,".",c,"=",p,";")}})}function W(a,e){Da&&!a.instancing&&(a.instancing=
e.def(a.shared.extensions,".angle_instanced_arrays"))}function Z(a,e,b,f,c){function g(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function d(a){m=e.def();a(m,"=",g(),";");"string"===typeof c?a(k,".count+=",c,";"):a(k,".count++;");ca&&(f?(I=e.def(),a(I,"=",q,".getNumPendingQueries();")):a(q,".beginQuery(",k,");"))}function w(a){a(k,".cpuTime+=",g(),"-",m,";");ca&&(f?a(q,".pushScopeStats(",I,",",q,".getNumPendingQueries(),",k,");"):a(q,".endQuery();"))}function x(a){var r=
e.def(h,".profile");e(h,".profile=",a,";");e.exit(h,".profile=",r,";")}var p=a.shared,k=a.stats,h=p.current,q=p.timer;b=b.profile;var m,I;if(b){if(l(b)){b.enable?(d(e),w(e.exit),x("true")):x("false");return}b=b.append(a,e);x(b)}else b=e.def(h,".profile");p=a.block();d(p);e("if(",b,"){",p,"}");a=a.block();w(a);e.exit("if(",b,"){",a,"}")}function aa(a,e,b,c,g){function d(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;
default:return 1}}function p(b,f,c){function g(){e("if(!",h,".buffer){",w,".enableVertexAttribArray(",k,");}");var b=c.type,d;d=c.size?e.def(c.size,"||",f):f;e("if(",h,".type!==",b,"||",h,".size!==",d,"||",I.map(function(a){return h+"."+a+"!=="+c[a]}).join("||"),"){",w,".bindBuffer(",34962,",",q,".buffer);",w,".vertexAttribPointer(",[k,d,b,c.normalized,c.stride,c.offset],");",h,".type=",b,";",h,".size=",d,";",I.map(function(a){return h+"."+a+"="+c[a]+";"}).join(""),"}");Da&&(b=c.divisor,e("if(",h,
".divisor!==",b,"){",a.instancing,".vertexAttribDivisorANGLE(",[k,b],");",h,".divisor=",b,";}"))}function d(){e("if(",h,".buffer){",w,".disableVertexAttribArray(",k,");","}if(",H.map(function(a,e){return h+"."+a+"!=="+m[e]}).join("||"),"){",w,".vertexAttrib4f(",k,",",m,");",H.map(function(a,e){return h+"."+a+"="+m[e]+";"}).join(""),"}")}var w=x.gl,k=e.def(b,".location"),h=e.def(x.attributes,"[",k,"]");b=c.state;var q=c.buffer,m=[c.x,c.y,c.z,c.w],I=["buffer","normalized","offset","stride"];1===b?g():
2===b?d():(e("if(",b,"===",1,"){"),g(),e("}else{"),d(),e("}"))}var x=a.shared;c.forEach(function(c){var x=c.name,k=b.attributes[x],h;if(k){if(!g(k))return;h=k.append(a,e)}else{if(!g(f))return;var q=a.scopeAttrib(x);h={};Object.keys(new w).forEach(function(a){h[a]=e.def(q,".",a)})}p(a.link(c),d(c.info.type),h)})}function da(a,e,b,c,g){for(var d=a.shared,w=d.gl,x,p=0;p<c.length;++p){var k=c[p],h=k.name,q=k.info.type,m=b.uniforms[h],k=a.link(k)+".location",I;if(m){if(!g(m))continue;if(l(m)){h=m.value;
if(35678===q||35680===q)q=a.link(h._texture||h.color[0]._texture),e(w,".uniform1i(",k,",",q+".bind());"),e.exit(q,".unbind();");else if(35674===q||35675===q||35676===q)h=a.global.def("new Float32Array(["+Array.prototype.slice.call(h)+"])"),m=2,35675===q?m=3:35676===q&&(m=4),e(w,".uniformMatrix",m,"fv(",k,",false,",h,");");else{switch(q){case 5126:x="1f";break;case 35664:x="2f";break;case 35665:x="3f";break;case 35666:x="4f";break;case 35670:x="1i";break;case 5124:x="1i";break;case 35671:x="2i";break;
case 35667:x="2i";break;case 35672:x="3i";break;case 35668:x="3i";break;case 35673:x="4i";break;case 35669:x="4i"}e(w,".uniform",x,"(",k,",",z(h)?Array.prototype.slice.call(h):h,");")}continue}else I=m.append(a,e)}else{if(!g(f))continue;I=e.def(d.uniforms,"[",t.id(h),"]")}35678===q?e("if(",I,"&&",I,'._reglType==="framebuffer"){',I,"=",I,".color[0];","}"):35680===q&&e("if(",I,"&&",I,'._reglType==="framebufferCube"){',I,"=",I,".color[0];","}");h=1;switch(q){case 35678:case 35680:q=e.def(I,"._texture");
e(w,".uniform1i(",k,",",q,".bind());");e.exit(q,".unbind();");continue;case 5124:case 35670:x="1i";break;case 35667:case 35671:x="2i";h=2;break;case 35668:case 35672:x="3i";h=3;break;case 35669:case 35673:x="4i";h=4;break;case 5126:x="1f";break;case 35664:x="2f";h=2;break;case 35665:x="3f";h=3;break;case 35666:x="4f";h=4;break;case 35674:x="Matrix2fv";break;case 35675:x="Matrix3fv";break;case 35676:x="Matrix4fv"}e(w,".uniform",x,"(",k,",");if("M"===x.charAt(0)){var k=Math.pow(q-35674+2,2),u=a.global.def("new Float32Array(",
k,")");e("false,(Array.isArray(",I,")||",I," instanceof Float32Array)?",I,":(",y(k,function(a){return u+"["+a+"]="+I+"["+a+"]"}),",",u,")")}else 1<h?e(y(h,function(a){return I+"["+a+"]"})):e(I);e(");")}}function ja(a,e,b,f){function c(g){var d=h[g];return d?d.contextDep&&f.contextDynamic||d.propDep?d.append(a,b):d.append(a,e):e.def(p,".",g)}function g(){function a(){b(U,".drawElementsInstancedANGLE(",[q,I,J,m+"<<(("+J+"-5121)>>1)",u],");")}function e(){b(U,".drawArraysInstancedANGLE(",[q,m,I,u],");")}
k?y?a():(b("if(",k,"){"),a(),b("}else{"),e(),b("}")):e()}function d(){function a(){b(x+".drawElements("+[q,I,J,m+"<<(("+J+"-5121)>>1)"]+");")}function e(){b(x+".drawArrays("+[q,m,I]+");")}k?y?a():(b("if(",k,"){"),a(),b("}else{"),e(),b("}")):e()}var w=a.shared,x=w.gl,p=w.draw,h=f.draw,k=function(){var c=h.elements,g=e;if(c){if(c.contextDep&&f.contextDynamic||c.propDep)g=b;c=c.append(a,g)}else c=g.def(p,".","elements");c&&g("if("+c+")"+x+".bindBuffer(34963,"+c+".buffer.buffer);");return c}(),q=c("primitive"),
m=c("offset"),I=function(){var c=h.count,g=e;if(c){if(c.contextDep&&f.contextDynamic||c.propDep)g=b;c=c.append(a,g)}else c=g.def(p,".","count");return c}();if("number"===typeof I){if(0===I)return}else b("if(",I,"){"),b.exit("}");var u,U;Da&&(u=c("instances"),U=a.instancing);var J=k+".type",y=h.elements&&l(h.elements);Da&&("number"!==typeof u||0<=u)?"string"===typeof u?(b("if(",u,">0){"),g(),b("}else if(",u,"<0){"),d(),b("}")):g():d()}function ea(a,e,b,f,c){e=xa();c=e.proc("body",c);Da&&(e.instancing=
c.def(e.shared.extensions,".angle_instanced_arrays"));a(e,c,b,f);return e.compile().body}function Ea(a,e,b,f){W(a,e);aa(a,e,b,f.attributes,function(){return!0});da(a,e,b,f.uniforms,function(){return!0});ja(a,e,e,b)}function Ka(a,e){var b=a.proc("draw",1);W(a,b);L(a,b,e.context);ia(a,b,e.framebuffer);la(a,b,e);S(a,b,e.state);Z(a,b,e,!1,!0);var f=e.shader.progVar.append(a,b);b(a.shared.gl,".useProgram(",f,".program);");if(e.shader.program)Ea(a,b,e,e.shader.program);else{var c=a.global.def("{}"),g=b.def(f,
".id"),d=b.def(c,"[",g,"]");b(a.cond(d).then(d,".call(this,a0);")["else"](d,"=",c,"[",g,"]=",a.link(function(b){return ea(Ea,a,e,b,1)}),"(",f,");",d,".call(this,a0);"))}0<Object.keys(e.state).length&&b(a.shared.current,".dirty=true;")}function La(a,e,b,f){function c(){return!0}a.batchId="a1";W(a,e);aa(a,e,b,f.attributes,c);da(a,e,b,f.uniforms,c);ja(a,e,e,b)}function ma(a,e,b,f){function c(a){return a.contextDep&&d||a.propDep}function g(a){return!c(a)}W(a,e);var d=b.contextDep,w=e.def(),x=e.def();
a.shared.props=x;a.batchId=w;var p=a.scope(),h=a.scope();e(p.entry,"for(",w,"=0;",w,"<","a1",";++",w,"){",x,"=","a0","[",w,"];",h,"}",p.exit);b.needsContext&&L(a,h,b.context);b.needsFramebuffer&&ia(a,h,b.framebuffer);S(a,h,b.state,c);b.profile&&c(b.profile)&&Z(a,h,b,!1,!0);f?(aa(a,p,b,f.attributes,g),aa(a,h,b,f.attributes,c),da(a,p,b,f.uniforms,g),da(a,h,b,f.uniforms,c),ja(a,p,h,b)):(e=a.global.def("{}"),f=b.shader.progVar.append(a,h),x=h.def(f,".id"),p=h.def(e,"[",x,"]"),h(a.shared.gl,".useProgram(",
f,".program);","if(!",p,"){",p,"=",e,"[",x,"]=",a.link(function(e){return ea(La,a,b,e,2)}),"(",f,");}",p,".call(this,a0[",w,"],",w,");"))}function Fa(a,e){function b(a){return a.contextDep&&c||a.propDep}var f=a.proc("batch",2);a.batchId="0";W(a,f);var c=!1,g=!0;Object.keys(e.context).forEach(function(a){c=c||e.context[a].propDep});c||(L(a,f,e.context),g=!1);var d=e.framebuffer,w=!1;d?(d.propDep?c=w=!0:d.contextDep&&c&&(w=!0),w||ia(a,f,d)):ia(a,f,null);e.state.viewport&&e.state.viewport.propDep&&(c=
!0);la(a,f,e);S(a,f,e.state,function(a){return!b(a)});e.profile&&b(e.profile)||Z(a,f,e,!1,"a1");e.contextDep=c;e.needsContext=g;e.needsFramebuffer=w;g=e.shader.progVar;if(g.contextDep&&c||g.propDep)ma(a,f,e,null);else if(g=g.append(a,f),f(a.shared.gl,".useProgram(",g,".program);"),e.shader.program)ma(a,f,e,e.shader.program);else{var d=a.global.def("{}"),w=f.def(g,".id"),x=f.def(d,"[",w,"]");f(a.cond(x).then(x,".call(this,a0,a1);")["else"](x,"=",d,"[",w,"]=",a.link(function(b){return ea(ma,a,e,b,2)}),
"(",g,");",x,".call(this,a0,a1);"))}0<Object.keys(e.state).length&&f(a.shared.current,".dirty=true;")}function Aa(a,e){function b(c){var d=e.shader[c];d&&f.set(g.shader,"."+c,d.append(a,f))}var f=a.proc("scope",3);a.batchId="a2";var g=a.shared,d=g.current;L(a,f,e.context);e.framebuffer&&e.framebuffer.append(a,f);c(Object.keys(e.state)).forEach(function(b){var c=e.state[b].append(a,f);z(c)?c.forEach(function(e,c){f.set(a.next[b],"["+c+"]",e)}):f.set(g.next,"."+b,c)});Z(a,f,e,!0,!0);["elements","offset",
"count","instances","primitive"].forEach(function(b){var c=e.draw[b];c&&f.set(g.draw,"."+b,""+c.append(a,f))});Object.keys(e.uniforms).forEach(function(b){f.set(g.uniforms,"["+t.id(b)+"]",e.uniforms[b].append(a,f))});Object.keys(e.attributes).forEach(function(b){var c=e.attributes[b].append(a,f),g=a.scopeAttrib(b);Object.keys(new w).forEach(function(a){f.set(g,"."+a,c[a])})});b("vert");b("frag");0<Object.keys(e.state).length&&(f(d,".dirty=true;"),f.exit(d,".dirty=true;"));f("a1(",a.shared.context,
",a0,",a.batchId,");")}function e(a){if("object"===typeof a&&!z(a)){for(var e=Object.keys(a),b=0;b<e.length;++b)if(m.isDynamic(a[e[b]]))return!0;return!1}}function x(a,b,f){function c(a,e){x.forEach(function(b){var f=d[b];m.isDynamic(f)&&(f=a.invoke(e,f),e(q,".",b,"=",f,";"))})}var d=b["static"][f];if(d&&e(d)){var w=a.global,x=Object.keys(d),h=!1,p=!1,k=!1,q=a.global.def("{}");x.forEach(function(e){var b=d[e];if(m.isDynamic(b))"function"===typeof b&&(b=d[e]=m.unbox(b)),e=g(b,null),h=h||e.thisDep,
k=k||e.propDep,p=p||e.contextDep;else{w(q,".",e,"=");switch(typeof b){case "number":w(b);break;case "string":w('"',b,'"');break;case "object":Array.isArray(b)&&w("[",b.join(),"]");break;default:w(a.link(b))}w(";")}});b.dynamic[f]=new m.DynamicVariable(4,{thisDep:h,contextDep:p,propDep:k,ref:q,append:c});delete b["static"][f]}}var w=na.Record,I={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(I.min=32775,I.max=32776);var Da=n.angle_instanced_arrays,Ja=n.webgl_draw_buffers,ua=
{dirty:!0,profile:ka.profile},Ca={},Ha=[],va={},wa={};M("dither",3024);M("blend.enable",3042);D("blend.color","blendColor",[0,0,0,0]);D("blend.equation","blendEquationSeparate",[32774,32774]);D("blend.func","blendFuncSeparate",[1,0,1,0]);M("depth.enable",2929,!0);D("depth.func","depthFunc",513);D("depth.range","depthRange",[0,1]);D("depth.mask","depthMask",!0);D("colorMask","colorMask",[!0,!0,!0,!0]);M("cull.enable",2884);D("cull.face","cullFace",1029);D("frontFace","frontFace",2305);D("lineWidth",
"lineWidth",1);M("polygonOffset.enable",32823);D("polygonOffset.offset","polygonOffset",[0,0]);M("sample.alpha",32926);M("sample.enable",32928);D("sample.coverage","sampleCoverage",[1,!1]);M("stencil.enable",2960);D("stencil.mask","stencilMask",-1);D("stencil.func","stencilFunc",[519,0,-1]);D("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);D("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);M("scissor.enable",3089);D("scissor.box","scissor",[0,0,d.drawingBufferWidth,d.drawingBufferHeight]);
D("viewport","viewport",[0,0,d.drawingBufferWidth,d.drawingBufferHeight]);var Ma={gl:d,context:U,strings:t,next:Ca,current:ua,draw:p,elements:P,buffer:E,shader:ta,attributes:na.state,uniforms:J,framebuffer:Q,extensions:n,timer:ca,isBufferArgs:h},Ia={primTypes:F,compareFuncs:O,blendFuncs:q,blendEquations:I,stencilOps:B,glTypes:C,orientationType:G};Ja&&(Ia.backBuffer=[1029],Ia.drawBuffer=y(K.maxDrawbuffers,function(a){return 0===a?[0]:y(a,function(a){return 36064+a})}));var Na=0;return{next:Ca,current:ua,
procs:function(){var a=xa(),e=a.proc("poll"),b=a.proc("refresh"),f=a.block();e(f);b(f);var c=a.shared,g=c.gl,w=c.next,x=c.current;f(x,".dirty=false;");ia(a,e);ia(a,b,null,!0);var h=d.getExtension("angle_instanced_arrays"),p;h&&(p=a.link(h));for(var k=0;k<K.maxAttributes;++k){var q=b.def(c.attributes,"[",k,"]"),m=a.cond(q,".buffer");m.then(g,".enableVertexAttribArray(",k,");",g,".bindBuffer(",34962,",",q,".buffer.buffer);",g,".vertexAttribPointer(",k,",",q,".size,",q,".type,",q,".normalized,",q,".stride,",
q,".offset);")["else"](g,".disableVertexAttribArray(",k,");",g,".vertexAttrib4f(",k,",",q,".x,",q,".y,",q,".z,",q,".w);",q,".buffer=null;");b(m);h&&b(p,".vertexAttribDivisorANGLE(",k,",",q,".divisor);")}Object.keys(va).forEach(function(c){var d=va[c],h=f.def(w,".",c),p=a.block();p("if(",h,"){",g,".enable(",d,")}else{",g,".disable(",d,")}",x,".",c,"=",h,";");b(p);e("if(",h,"!==",x,".",c,"){",p,"}")});Object.keys(wa).forEach(function(c){var d=wa[c],h=ua[c],p,k,q=a.block();q(g,".",d,"(");z(h)?(d=h.length,
p=a.global.def(w,".",c),k=a.global.def(x,".",c),q(y(d,function(a){return p+"["+a+"]"}),");",y(d,function(a){return k+"["+a+"]="+p+"["+a+"];"}).join("")),e("if(",y(d,function(a){return p+"["+a+"]!=="+k+"["+a+"]"}).join("||"),"){",q,"}")):(p=f.def(w,".",c),k=f.def(x,".",c),q(p,");",x,".",c,"=",p,";"),e("if(",p,"!==",k,"){",q,"}"));b(q)});return a.compile()}(),compile:function(a,e,b,f,c){var g=xa();g.stats=g.link(c);Object.keys(e["static"]).forEach(function(a){x(g,e,a)});k.forEach(function(e){x(g,a,
e)});b=pa(a,e,b,f,g);Ka(g,b);Aa(g,b);Fa(g,b);return g.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],9:[function(d,t,n){function h(b,c){this.id=l++;this.type=b;this.data=c}function c(b){if(0===b.length)return[];var g=b.charAt(0),a=b.charAt(b.length-1);if(1<b.length&&g===a&&('"'===g||"'"===g))return['"'+b.substr(1,b.length-2).replace(/\\/g,"\\\\").replace(/"/g,
'\\"')+'"'];if(g=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return c(b.substr(0,g.index)).concat(c(g[1])).concat(c(b.substr(g.index+g[0].length)));g=b.split(".");if(1===g.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(a=0;a<g.length;++a)b=b.concat(c(g[a]));return b}function u(b){return"["+c(b).join("][")+"]"}var l=0;t.exports={DynamicVariable:h,define:function(b,c){return new h(b,u(c+""))},isDynamic:function(b){return"function"===typeof b&&!b._reglType||b instanceof
h},unbox:function(b,c){return"function"===typeof b?new h(0,b):b},accessor:u}},{}],10:[function(d,t,n){var h=d("./util/is-typed-array"),c=d("./util/is-ndarray"),u=d("./util/values"),l=d("./constants/primitives.json"),b=d("./constants/usage.json");t.exports=function(g,a,d,t){function n(a){this.id=C++;F[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function z(b,g,k,m,f,u,l){(u=l)||h(g)&&(!c(g)||h(g.data))||(u=a.oes_element_index_uint?5125:5123);b.buffer.bind();d._initBuffer(b.buffer,
g,k,u,3);g=l;if(!l){switch(b.buffer.dtype){case 5121:case 5120:g=5121;break;case 5123:case 5122:g=5123;break;case 5125:case 5124:g=5125}b.buffer.dtype=g}b.type=g;0>f&&(f=b.buffer.byteLength,5123===g?f>>=1:5125===g&&(f>>=2));b.vertCount=f;f=m;0>m&&(f=4,m=b.buffer.dimension,1===m&&(f=0),2===m&&(f=1),3===m&&(f=4));b.primType=f}function m(a){t.elementsCount--;delete F[a.id];a.buffer.destroy();a.buffer=null}var F={},C=0,H={uint8:5121,uint16:5123};a.oes_element_index_uint&&(H.uint32=5125);n.prototype.bind=
function(){this.buffer.bind()};var k=[];return{create:function(a,k){function u(a){if(a)if("number"===typeof a)F(a),f.primType=4,f.vertCount=a|0,f.type=5121;else{var d=null,k=35044,q=-1,m=-1,y=0,t=0;Array.isArray(a)||h(a)||c(a)?d=a:("data"in a&&(d=a.data),"usage"in a&&(k=b[a.usage]),"primitive"in a&&(q=l[a.primitive]),"count"in a&&(m=a.count|0),"length"in a&&(y=a.length|0),"type"in a&&(t=H[a.type]));d?z(f,d,k,q,m,y,t):(a=f.buffer,a.bind(),g.bufferData(34963,y,k),a.dtype=t||5121,a.usage=k,a.dimension=
3,a.byteLength=y,f.primType=0>q?4:q,f.vertCount=0>m?0:m,f.type=a.dtype)}else F(),f.primType=4,f.vertCount=0,f.type=5121;return u}var F=d.create(null,34963,!0),f=new n(F._buffer);t.elementsCount++;u(a);u._reglType="elements";u._elements=f;u.subdata=function(a,b){F.subdata(a,b);return u};u.destroy=function(){m(f)};return u},createStream:function(a){var b=k.pop();b||(b=new n(d.create(null,34963,!0,!1)._buffer));z(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){k.push(a)},getElements:function(a){return"function"===
typeof a&&a._elements instanceof n?a._elements:null},clear:function(){u(F).forEach(m)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],11:[function(d,t,n){t.exports=function(d,c){function u(a){a=a.toLowerCase();var b;try{b=l[a]=d.getExtension(a)}catch(c){}return!!b}for(var l={},b=0;b<c.extensions.length;++b){var g=c.extensions[b];if(!u(g))return c.onDestroy(),c.onDone('"'+g+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),
null}c.optionalExtensions.forEach(u);return{extensions:l,restore:function(){Object.keys(l).forEach(function(a){if(!u(a))throw Error("(regl): error restoring extension "+a);})}}}},{}],12:[function(d,t,n){var h=d("./util/values"),c=d("./util/extend"),u=[];u[6408]=4;var l=[];l[5121]=1;l[5126]=4;l[36193]=2;t.exports=function(b,g,a,d,t,n){function z(a,b,f){this.target=a;this.texture=b;this.renderbuffer=f;var c=a=0;b?(a=b.width,c=b.height):f&&(a=f.width,c=f.height);this.width=a;this.height=c}function m(a){a&&
(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function F(a,b,f){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function C(a,f){f?f.texture?b.framebufferTexture2D(36160,a,f.target,f.texture._texture.texture,0):b.framebufferRenderbuffer(36160,a,36161,f.renderbuffer._renderbuffer.renderbuffer):b.framebufferTexture2D(36160,a,3553,null,0)}function H(a){var b=3553,f=null,c=null,g=a;"object"===typeof a&&(g=a.data,"target"in
a&&(b=a.target|0));a=g._reglType;"texture2d"===a?f=g:"textureCube"===a?f=g:"renderbuffer"===a&&(c=g,b=36161);return new z(b,f,c)}function k(a,b,f,c,g){if(f)return a=d.create2D({width:a,height:b,format:c,type:g}),a._texture.refCount=0,new z(3553,a,null);a=t.create({width:a,height:b,format:c});a._renderbuffer.refCount=0;return new z(36161,null,a)}function q(a){return a&&(a.texture||a.renderbuffer)}function O(a,b,f){a&&(a.texture?a.texture.resize(b,f):a.renderbuffer&&a.renderbuffer.resize(b,f))}function B(){this.id=
Ba++;Q[this.id]=this;this.framebuffer=b.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function G(a){a.colorAttachments.forEach(m);m(a.depthAttachment);m(a.stencilAttachment);m(a.depthStencilAttachment)}function f(a){b.deleteFramebuffer(a.framebuffer);a.framebuffer=null;n.framebufferCount--;delete Q[a.id]}function N(f){var c;b.bindFramebuffer(36160,f.framebuffer);var g=f.colorAttachments;for(c=0;c<
g.length;++c)C(36064+c,g[c]);for(c=g.length;c<a.maxColorAttachments;++c)C(36064+c,null);C(36096,f.depthAttachment);C(36128,f.stencilAttachment);C(33306,f.depthStencilAttachment);b.checkFramebufferStatus(36160);b.bindFramebuffer(36160,ba.next);ba.cur=ba.next;b.getError()}function sa(a,b){function g(a,b){var f,c=0,h=0,m=!0,y=!0;f=null;var t=!0,n="rgba",B="uint8",z=1,C=null,E=null,K=null,O=!1;if("number"===typeof a)c=a|0,h=b|0||c;else if(a){"shape"in a?(h=a.shape,c=h[0],h=h[1]):("radius"in a&&(c=h=a.radius),
"width"in a&&(c=a.width),"height"in a&&(h=a.height));if("color"in a||"colors"in a)f=a.color||a.colors,Array.isArray(f);if(!f){"colorCount"in a&&(z=a.colorCount|0);"colorTexture"in a&&(t=!!a.colorTexture,n="rgba4");if("colorType"in a&&(B=a.colorType,!t))if("half float"===B||"float16"===B)n="rgba16f";else if("float"===B||"float32"===B)n="rgba32f";"colorFormat"in a&&(n=a.colorFormat,0<=Ga.indexOf(n)?t=!0:0<=za.indexOf(n)&&(t=!1))}if("depthTexture"in a||"depthStencilTexture"in a)O=!(!a.depthTexture&&
!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?m=a.depth:(C=a.depth,y=!1));"stencil"in a&&("boolean"===typeof a.stencil?y=a.stencil:(E=a.stencil,m=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?m=y=a.depthStencil:(K=a.depthStencil,y=m=!1))}else c=h=1;var J=null,sa=null,L=null,ba=null;if(Array.isArray(f))J=f.map(H);else if(f)J=[H(f)];else for(J=Array(z),f=0;f<z;++f)J[f]=k(c,h,t,n,B);c=c||J[0].width;h=h||J[0].height;C?sa=H(C):m&&!y&&(sa=k(c,h,O,"depth","uint32"));E?L=
H(E):y&&!m&&(L=k(c,h,!1,"stencil","uint8"));K?ba=H(K):!C&&!E&&y&&m&&(ba=k(c,h,O,"depth stencil","depth stencil"));m=null;for(f=0;f<J.length;++f)F(J[f],c,h),J[f]&&J[f].texture&&(y=u[J[f].texture._texture.format]*l[J[f].texture._texture.type],null===m&&(m=y));F(sa,c,h);F(L,c,h);F(ba,c,h);G(d);d.width=c;d.height=h;d.colorAttachments=J;d.depthAttachment=sa;d.stencilAttachment=L;d.depthStencilAttachment=ba;g.color=J.map(q);g.depth=q(sa);g.stencil=q(L);g.depthStencil=q(ba);g.width=d.width;g.height=d.height;
N(d);return g}var d=new B;n.framebufferCount++;g(a,b);return c(g,{resize:function(a,b){var f=a|0,c=b|0||f;if(f===d.width&&c===d.height)return g;for(var h=d.colorAttachments,k=0;k<h.length;++k)O(h[k],f,c);O(d.depthAttachment,f,c);O(d.stencilAttachment,f,c);O(d.depthStencilAttachment,f,c);d.width=g.width=f;d.height=g.height=c;N(d);return g},_reglType:"framebuffer",_framebuffer:d,destroy:function(){f(d);G(d)}})}var ba={cur:null,next:null,dirty:!1},Ga=["rgba"],za=["rgba4","rgb565","rgb5 a1"];g.ext_srgb&&
za.push("srgba");g.ext_color_buffer_half_float&&za.push("rgba16f","rgb16f");g.webgl_color_buffer_float&&za.push("rgba32f");var P=["uint8"];g.oes_texture_half_float&&P.push("half float","float16");g.oes_texture_float&&P.push("float","float32");var Ba=0,Q={};return c(ba,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof B)?a:null},create:sa,createCube:function(a){function b(a){var g,h={color:null},k=0,m=null;g="rgba";var q="uint8",u=
1;if("number"===typeof a)k=a|0;else if(a){"shape"in a?k=a.shape[0]:("radius"in a&&(k=a.radius|0),"width"in a?k=a.width|0:"height"in a&&(k=a.height|0));if("color"in a||"colors"in a)m=a.color||a.colors,Array.isArray(m);m||("colorCount"in a&&(u=a.colorCount|0),"colorType"in a&&(q=a.colorType),"colorFormat"in a&&(g=a.colorFormat));"depth"in a&&(h.depth=a.depth);"stencil"in a&&(h.stencil=a.stencil);"depthStencil"in a&&(h.depthStencil=a.depthStencil)}else k=1;if(m)if(Array.isArray(m))for(a=[],g=0;g<m.length;++g)a[g]=
m[g];else a=[m];else for(a=Array(u),m={radius:k,format:g,type:q},g=0;g<u;++g)a[g]=d.createCube(m);h.color=Array(a.length);for(g=0;g<a.length;++g)u=a[g],k=k||u.width,h.color[g]={target:34069,data:a[g]};for(g=0;6>g;++g){for(u=0;u<a.length;++u)h.color[u].target=34069+g;0<g&&(h.depth=f[0].depth,h.stencil=f[0].stencil,h.depthStencil=f[0].depthStencil);if(f[g])f[g](h);else f[g]=sa(h)}return c(b,{width:k,height:k,color:a})}var f=Array(6);b(a);return c(b,{faces:f,resize:function(a){var c=a|0;if(c===b.width)return b;
var g=b.color;for(a=0;a<g.length;++a)g[a].resize(c);for(a=0;6>a;++a)f[a].resize(c);b.width=b.height=c;return b},_reglType:"framebufferCube",destroy:function(){f.forEach(function(a){a.destroy()})}})},clear:function(){h(Q).forEach(f)},restore:function(){h(Q).forEach(function(a){a.framebuffer=b.createFramebuffer();N(a)})}})}},{"./util/extend":23,"./util/values":31}],13:[function(d,t,n){t.exports=function(d,c){var u=1;c.ext_texture_filter_anisotropic&&(u=d.getParameter(34047));var l=1,b=1;c.webgl_draw_buffers&&
(l=d.getParameter(34852),b=d.getParameter(36063));return{colorBits:[d.getParameter(3410),d.getParameter(3411),d.getParameter(3412),d.getParameter(3413)],depthBits:d.getParameter(3414),stencilBits:d.getParameter(3415),subpixelBits:d.getParameter(3408),extensions:Object.keys(c).filter(function(b){return!!c[b]}),maxAnisotropic:u,maxDrawbuffers:l,maxColorAttachments:b,pointSizeDims:d.getParameter(33901),lineWidthDims:d.getParameter(33902),maxViewportDims:d.getParameter(3386),maxCombinedTextureUnits:d.getParameter(35661),
maxCubeMapSize:d.getParameter(34076),maxRenderbufferSize:d.getParameter(34024),maxTextureUnits:d.getParameter(34930),maxTextureSize:d.getParameter(3379),maxAttributes:d.getParameter(34921),maxVertexUniforms:d.getParameter(36347),maxVertexTextureUnits:d.getParameter(35660),maxVaryingVectors:d.getParameter(36348),maxFragmentUniforms:d.getParameter(36349),glsl:d.getParameter(35724),renderer:d.getParameter(7937),vendor:d.getParameter(7936),version:d.getParameter(7938)}}},{}],14:[function(d,t,n){var h=
d("./util/is-typed-array");t.exports=function(c,d,l,b,g,a){return function(a){var g;g=null===d.next?5121:d.next.colorAttachments[0].texture._texture.type;var t=0,n=0,m=b.framebufferWidth,F=b.framebufferHeight,C=null;h(a)?C=a:a&&(t=a.x|0,n=a.y|0,m=(a.width||b.framebufferWidth-t)|0,F=(a.height||b.framebufferHeight-n)|0,C=a.data||null);l();a=m*F*4;C||(5121===g?C=new Uint8Array(a):5126===g&&(C=C||new Float32Array(a)));c.pixelStorei(3333,4);c.readPixels(t,n,m,F,6408,g,C);return C}}},{"./util/is-typed-array":26}],
15:[function(d,t,n){var h=d("./util/values"),c=[];c[32854]=2;c[32855]=2;c[36194]=2;c[33189]=2;c[36168]=1;c[34041]=4;c[35907]=4;c[34836]=16;c[34842]=8;c[34843]=6;t.exports=function(d,l,b,g,a){function t(b){this.id=z++;this.refCount=1;this.renderbuffer=b;this.format=32854;this.height=this.width=0;a.profile&&(this.stats={size:0})}function n(a){var b=a.renderbuffer;d.bindRenderbuffer(36161,null);d.deleteRenderbuffer(b);a.renderbuffer=null;a.refCount=0;delete m[a.id];g.renderbufferCount--}var E={rgba4:32854,
rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};l.ext_srgb&&(E.srgba=35907);l.ext_color_buffer_half_float&&(E.rgba16f=34842,E.rgb16f=34843);l.webgl_color_buffer_float&&(E.rgba32f=34836);var z=0,m={};t.prototype.decRef=function(){0>=--this.refCount&&n(this)};a.profile&&(g.getTotalRenderbufferSize=function(){var a=0;Object.keys(m).forEach(function(b){a+=m[b].stats.size});return a});return{create:function(b,h){function l(b,g){var h=0,m=0,f=32854;"object"===typeof b&&b?("shape"in
b?(m=b.shape,h=m[0]|0,m=m[1]|0):("radius"in b&&(h=m=b.radius|0),"width"in b&&(h=b.width|0),"height"in b&&(m=b.height|0)),"format"in b&&(f=E[b.format])):"number"===typeof b?(h=b|0,m="number"===typeof g?g|0:h):b||(h=m=1);if(h!==k.width||m!==k.height||f!==k.format)return l.width=k.width=h,l.height=k.height=m,k.format=f,d.bindRenderbuffer(36161,k.renderbuffer),d.renderbufferStorage(36161,f,h,m),a.profile&&(k.stats.size=c[k.format]*k.width*k.height),l}var k=new t(d.createRenderbuffer());m[k.id]=k;g.renderbufferCount++;
l(b,h);l.resize=function(b,g){var h=b|0,m=g|0||h;if(h===k.width&&m===k.height)return l;l.width=k.width=h;l.height=k.height=m;d.bindRenderbuffer(36161,k.renderbuffer);d.renderbufferStorage(36161,k.format,h,m);a.profile&&(k.stats.size=c[k.format]*k.width*k.height);return l};l._reglType="renderbuffer";l._renderbuffer=k;a.profile&&(l.stats=k.stats);l.destroy=function(){k.decRef()};return l},clear:function(){h(m).forEach(n)},restore:function(){h(m).forEach(function(a){a.renderbuffer=d.createRenderbuffer();
d.bindRenderbuffer(36161,a.renderbuffer);d.renderbufferStorage(36161,a.format,a.width,a.height)});d.bindRenderbuffer(36161,null)}}}},{"./util/values":31}],16:[function(d,t,n){var h=d("./util/values");t.exports=function(c,d,l,b){function g(a,b,c,g){this.name=a;this.id=b;this.location=c;this.info=g}function a(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function t(a,b,g){g=35632===a?z:m;var h=g[b];if(!h){var l=d.str(b),h=c.createShader(a);c.shaderSource(h,
l);c.compileShader(h);g[b]=h}return h}function n(a,c){this.id=H++;this.fragId=a;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[];b.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function E(h,m){var l,n;l=t(35632,h.fragId);n=t(35633,h.vertId);var z=h.program=c.createProgram();c.attachShader(z,l);c.attachShader(z,n);c.linkProgram(z);var f=c.getProgramParameter(z,35718);b.profile&&(h.stats.uniformsCount=f);var F=h.uniforms;for(l=0;l<f;++l)if(n=c.getActiveUniform(z,l))if(1<
n.size)for(var C=0;C<n.size;++C){var E=n.name.replace("[0]","["+C+"]");a(F,new g(E,d.id(E),c.getUniformLocation(z,E),n))}else a(F,new g(n.name,d.id(n.name),c.getUniformLocation(z,n.name),n));f=c.getProgramParameter(z,35721);b.profile&&(h.stats.attributesCount=f);F=h.attributes;for(l=0;l<f;++l)(n=c.getActiveAttrib(z,l))&&a(F,new g(n.name,d.id(n.name),c.getAttribLocation(z,n.name),n))}var z={},m={},F={},C=[],H=0;b.profile&&(l.getMaxUniformsCount=function(){var a=0;C.forEach(function(b){b.stats.uniformsCount>
a&&(a=b.stats.uniformsCount)});return a},l.getMaxAttributesCount=function(){var a=0;C.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});return{clear:function(){var a=c.deleteShader.bind(c);h(z).forEach(a);z={};h(m).forEach(a);m={};C.forEach(function(a){c.deleteProgram(a.program)});C.length=0;F={};l.shaderCount=0},program:function(a,b,c){l.shaderCount++;var g=F[b];g||(g=F[b]={});var d=g[a];d||(d=new n(b,a),E(d,c),g[a]=d,C.push(d));return d},restore:function(){z=
{};m={};for(var a=0;a<C.length;++a)E(C[a])},shader:t,frag:-1,vert:-1}}},{"./util/values":31}],17:[function(d,t,n){t.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(d,t,n){t.exports=function(){var d={"":0},c=[""];return{id:function(u){var l=d[u];if(l)return l;l=d[u]=c.length;c.push(u);return l},str:function(d){return c[d]}}}},{}],19:[function(d,t,n){function h(a){return Array.isArray(a)&&
(0===a.length||"number"===typeof a[0])}function c(a){return Array.isArray(a)&&0!==a.length&&F(a[0])?!0:!1}function u(a){return Object.prototype.toString.call(a)}function l(a){if(!a)return!1;var b=u(a);return 0<=O.indexOf(b)?!0:h(a)||c(a)||E(a)}function b(a,b){36193===a.type?(a.data=m(b),z.freeType(b)):a.data=b}function g(a,b,c,g,d,h){a="undefined"!==typeof G[a]?G[a]:q[a]*B[b];h&&(a*=6);if(d){for(g=0;1<=c;)g+=a*c*c,c/=2;return g}return a*c*g}var a=d("./util/extend"),y=d("./util/values"),K=d("./util/is-typed-array"),
E=d("./util/is-ndarray"),z=d("./util/pool"),m=d("./util/to-half-float"),F=d("./util/is-array-like");n=d("./constants/arraytypes.json");var C=d("./constants/arraytypes.json"),H=[9984,9986,9985,9987],k=[0,6409,6410,6407,6408],q={};q[6409]=q[6406]=q[6402]=1;q[34041]=q[6410]=2;q[6407]=q[35904]=3;q[6408]=q[35906]=4;var O=Object.keys(n).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),B=[];B[5121]=1;B[5126]=4;B[36193]=2;B[5123]=
2;B[5125]=4;var G=[];G[32854]=2;G[32855]=2;G[36194]=2;G[34041]=4;G[33776]=.5;G[33777]=.5;G[33778]=1;G[33779]=1;G[35986]=.5;G[35987]=1;G[34798]=1;G[35840]=.5;G[35841]=.25;G[35842]=.5;G[35843]=.25;G[36196]=.5;t.exports=function(f,d,n,t,G,B,P){function O(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function Q(a,b){a.internalformat=b.internalformat;a.format=b.format;
a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function J(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=S[b.colorSpace]);"type"in b&&(a.type=W[b.type]);var c=a.width,f=a.height,
g=a.channels,d=!1;"shape"in b?(c=b.shape[0],f=b.shape[1],3===b.shape.length&&(g=b.shape[2],d=!0)):("radius"in b&&(c=f=b.radius),"width"in b&&(c=b.width),"height"in b&&(f=b.height),"channels"in b&&(g=b.channels,d=!0));a.width=c|0;a.height=f|0;a.channels=g|0;c=!1;"format"in b&&(c=b.format,f=a.internalformat=Z[c],a.format=ea[f],c in W&&!("type"in b)&&(a.type=W[c]),c in aa&&(a.compressed=!0),c=!0);!d&&c?a.channels=q[a.format]:d&&!c&&a.channels!==k[a.format]&&(a.format=a.internalformat=k[a.channels])}}
function na(a){f.pixelStorei(37440,a.flipY);f.pixelStorei(37441,a.premultiplyAlpha);f.pixelStorei(37443,a.colorSpace);f.pixelStorei(3317,a.unpackAlignment)}function ta(){O.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function p(a,f){var g=null;l(f)?g=f:f&&(J(a,f),"x"in f&&(a.xOffset=f.x|0),"y"in f&&(a.yOffset=f.y|0),l(f.data)&&(g=f.data));if(f.copy){var d=G.viewportWidth,p=G.viewportHeight;a.width=a.width||d-a.xOffset;a.height=a.height||
p-a.yOffset;a.needsCopy=!0}else if(!g)a.width=a.width||1,a.height=a.height||1;else if(K(g))a.data=g,"type"in f||5121!==a.type||(a.type=C[Object.prototype.toString.call(g)]|0);else if(h(g)){d=g;p=a.width*a.height*a.channels;switch(a.type){case 5121:case 5123:case 5125:case 5126:p=z.allocType(a.type,p);p.set(d);a.data=p;break;case 36193:a.data=m(d)}a.alignment=1;a.needsFree=!0}else if(E(g)){d=g.data;Array.isArray(d)||5121!==a.type||(a.type=C[Object.prototype.toString.call(d)]|0);var p=g.shape,q=g.stride,
n,t,y,H;3===p.length?(y=p[2],H=q[2]):H=y=1;n=p[0];t=p[1];p=q[0];q=q[1];a.alignment=1;a.width=n;a.height=t;a.channels=y;a.format=a.internalformat=k[y];a.needsFree=!0;n=H;g=g.offset;y=a.width;H=a.height;t=a.channels;for(var B=z.allocType(36193===a.type?5126:a.type,y*H*t),ja=0,D=0;D<H;++D)for(var ea=0;ea<y;++ea)for(var r=0;r<t;++r)B[ja++]=d[p*ea+q*D+n*r+g];b(a,B)}else if("[object HTMLCanvasElement]"===u(g)||"[object CanvasRenderingContext2D]"===u(g))"[object HTMLCanvasElement]"===u(g)?a.element=g:a.element=
g.canvas,a.width=a.element.width,a.height=a.element.height;else if("[object HTMLImageElement]"===u(g))a.element=g,a.width=g.naturalWidth,a.height=g.naturalHeight;else if("[object HTMLVideoElement]"===u(g))a.element=g,a.width=g.videoWidth,a.height=g.videoHeight,a.needsPoll=!0;else if(c(g)){d=g[0].length;p=g.length;q=1;if(F(g[0][0])){n=q=g[0][0].length;y=z.allocType(36193===a.type?5126:a.type,d*p*n);for(t=H=0;t<p;++t)for(B=g[t],ja=0;ja<d;++ja)for(D=B[ja],ea=0;ea<n;++ea)y[H++]=D[ea];b(a,y)}else{n=z.allocType(36193===
a.type?5126:a.type,d*p);for(H=y=0;H<p;++H)for(t=g[H],B=0;B<d;++B)n[y++]=t[B];b(a,n)}a.alignment=1;a.width=d;a.height=p;a.channels=q;a.format=a.internalformat=k[q];a.needsFree=!0}}function U(a,b,c,g,d){var h=a.element,m=a.data,k=a.internalformat,p=a.format,q=a.type,l=a.width,n=a.height;na(a);h?f.texSubImage2D(b,d,c,g,p,q,h):a.compressed?f.compressedTexSubImage2D(b,d,c,g,k,l,n,m):a.needsCopy?(t(),f.copyTexSubImage2D(b,d,c,g,a.xOffset,a.yOffset,l,n)):f.texSubImage2D(b,d,c,g,l,n,p,q,m)}function ca(){return Ea.pop()||
new ta}function ka(a){a.needsFree&&z.freeType(a.data);ta.call(a);Ea.push(a)}function X(){O.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function M(a,b,c){var g=a.images[0]=ca();a.mipmask=1;g.width=a.width=b;g.height=a.height=c}function D(a,b){var c=null;if(l(b))c=a.images[0]=ca(),Q(c,a),p(c,b),a.mipmask=1;else if(J(a,b),Array.isArray(b.mipmap))for(var g=b.mipmap,f=0;f<g.length;++f)c=a.images[f]=ca(),Q(c,a),c.width>>=f,c.height>>=f,p(c,g[f]),a.mipmask|=1<<
f;else c=a.images[0]=ca(),Q(c,a),p(c,b),a.mipmask=1;Q(a,a.images[0])}function xa(a,b){for(var c=a.images,g=0;g<c.length&&c[g];++g){var d=c[g],h=b,m=g,k=d.element,p=d.data,q=d.internalformat,l=d.format,n=d.type,u=d.width,y=d.height;na(d);k?f.texImage2D(h,m,l,l,n,k):d.compressed?f.compressedTexImage2D(h,m,q,u,y,0,p):d.needsCopy?(t(),f.copyTexImage2D(h,m,l,d.xOffset,d.yOffset,u,y,0)):f.texImage2D(h,m,l,u,y,0,l,n,p)}}function oa(){var a=Ka.pop()||new X;O.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=
null;return a}function ya(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&ka(b[c]),b[c]=null;Ka.push(a)}function T(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function fa(a,b){"min"in b&&(a.minFilter=la[b.min],0<=H.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=ia[b.mag]);var c=a.wrapS,g=a.wrapT;if("wrap"in b){var f=b.wrap;"string"===typeof f?c=g=L[f]:Array.isArray(f)&&(c=L[f[0]],g=L[f[1]])}else"wrapS"in
b&&(c=L[b.wrapS]),"wrapT"in b&&(g=L[b.wrapT]);a.wrapS=c;a.wrapT=g;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=pa[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function ga(a,b){f.texParameteri(b,10241,a.minFilter);f.texParameteri(b,10240,a.magFilter);f.texParameteri(b,10242,a.wrapS);f.texParameteri(b,10243,a.wrapT);d.ext_texture_filter_anisotropic&&
f.texParameteri(b,34046,a.anisotropic);a.genMipmaps&&(f.hint(33170,a.mipmapHint),f.generateMipmap(b))}function qa(a){O.call(this);this.mipmask=0;this.internalformat=6408;this.id=La++;this.refCount=1;this.target=a;this.texture=f.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new T;P.profile&&(this.stats={size:0})}function ha(a){f.activeTexture(33984);f.bindTexture(a.target,a.texture)}function Y(){var a=Aa[0];a?f.bindTexture(a.target,a.texture):f.bindTexture(3553,null)}function ra(a){var b=
a.texture,c=a.unit,g=a.target;0<=c&&(f.activeTexture(33984+c),f.bindTexture(g,null),Aa[c]=null);f.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete ma[a.id];B.textureCount--}var pa={"don't care":4352,"dont care":4352,nice:4354,fast:4353},L={repeat:10497,clamp:33071,mirror:33648},ia={nearest:9728,linear:9729},la=a({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ia),S={none:0,browser:37444},
W={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Z={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},aa={};d.ext_srgb&&(Z.srgb=35904,Z.srgba=35906);d.oes_texture_float&&(W.float32=W["float"]=5126);d.oes_texture_half_float&&(W.float16=W["half float"]=36193);d.webgl_depth_texture&&(a(Z,{depth:6402,"depth stencil":34041}),a(W,{uint16:5123,uint32:5125,"depth stencil":34042}));d.webgl_compressed_texture_s3tc&&a(aa,{"rgb s3tc dxt1":33776,
"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});d.webgl_compressed_texture_atc&&a(aa,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});d.webgl_compressed_texture_pvrtc&&a(aa,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});d.webgl_compressed_texture_etc1&&(aa["rgb etc1"]=36196);var da=Array.prototype.slice.call(f.getParameter(34467));Object.keys(aa).forEach(function(a){var b=aa[a];0<=
da.indexOf(b)&&(Z[a]=b)});var ja=Object.keys(Z);n.textureFormats=ja;var ea=ja.reduce(function(a,b){var c=Z[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),Ea=[],Ka=[],La=0,ma={},Fa=n.maxTextureUnits,Aa=Array(Fa).map(function(){return null});a(qa.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<Fa;++b){var c=Aa[b];if(c){if(0<c.bindCount)continue;c.unit=-1}Aa[b]=this;a=b;break}P.profile&&
B.maxTextureUnits<a+1&&(B.maxTextureUnits=a+1);this.unit=a;f.activeTexture(33984+a);f.bindTexture(this.target,this.texture)}return a},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&ra(this)}});P.profile&&(B.getTotalTextureSize=function(){var a=0;Object.keys(ma).forEach(function(b){a+=ma[b].stats.size});return a});return{create2D:function(a,b){function c(a,b){var e=d.texInfo;T.call(e);var f=oa();"number"===typeof a?"number"===typeof b?M(f,a|0,b|0):M(f,a|0,a|0):a?(fa(e,a),
D(f,a)):M(f,1,1);e.genMipmaps&&(f.mipmask=(f.width<<1)-1);d.mipmask=f.mipmask;Q(d,f);d.internalformat=f.internalformat;c.width=f.width;c.height=f.height;ha(d);xa(f,3553);ga(e,3553);Y();ya(f);P.profile&&(d.stats.size=g(d.internalformat,d.type,f.width,f.height,e.genMipmaps,!1));return c}var d=new qa(3553);ma[d.id]=d;B.textureCount++;c(a,b);c.subimage=function(a,b,e,f){b|=0;e|=0;f|=0;var g=ca();Q(g,d);g.width>>=f;g.height>>=f;g.width-=b;g.height-=e;p(g,a);ha(d);U(g,3553,b,e,f);Y();ka(g);return c};c.resize=
function(a,b){var e=a|0,h=b|0||e;if(e===d.width&&h===d.height)return c;c.width=d.width=e;c.height=d.height=h;ha(d);for(var m=0;d.mipmask>>m;++m)f.texImage2D(3553,m,d.format,e>>m,h>>m,0,d.format,d.type,null);Y();P.profile&&(d.stats.size=g(d.internalformat,d.type,e,h,!1,!1));return c};c._reglType="texture2d";c._texture=d;P.profile&&(c.stats=d.stats);c.destroy=function(){d.decRef()};return c},createCube:function(a,b,c,d,h,m){function k(a,b,c,e,f,d){var h,m=l.texInfo;T.call(m);for(h=0;6>h;++h)q[h]=oa();
if("number"===typeof a||!a)for(a=a|0||1,h=0;6>h;++h)M(q[h],a,a);else if("object"===typeof a)if(b)D(q[0],a),D(q[1],b),D(q[2],c),D(q[3],e),D(q[4],f),D(q[5],d);else if(fa(m,a),J(l,a),"faces"in a)for(a=a.faces,h=0;6>h;++h)Q(q[h],l),D(q[h],a[h]);else for(h=0;6>h;++h)D(q[h],a);Q(l,q[0]);l.mipmask=m.genMipmaps?(q[0].width<<1)-1:q[0].mipmask;l.internalformat=q[0].internalformat;k.width=q[0].width;k.height=q[0].height;ha(l);for(h=0;6>h;++h)xa(q[h],34069+h);ga(m,34067);Y();P.profile&&(l.stats.size=g(l.internalformat,
l.type,k.width,k.height,m.genMipmaps,!0));for(h=0;6>h;++h)ya(q[h]);return k}var l=new qa(34067);ma[l.id]=l;B.cubeCount++;var q=Array(6);k(a,b,c,d,h,m);k.subimage=function(a,b,c,e,g){c|=0;e|=0;g|=0;var f=ca();Q(f,l);f.width>>=g;f.height>>=g;f.width-=c;f.height-=e;p(f,b);ha(l);U(f,34069+a,c,e,g);Y();ka(f);return k};k.resize=function(a){a|=0;if(a!==l.width){k.width=l.width=a;k.height=l.height=a;ha(l);for(var b=0;6>b;++b)for(var c=0;l.mipmask>>c;++c)f.texImage2D(34069+b,c,l.format,a>>c,a>>c,0,l.format,
l.type,null);Y();P.profile&&(l.stats.size=g(l.internalformat,l.type,k.width,k.height,!1,!0));return k}};k._reglType="textureCube";k._texture=l;P.profile&&(k.stats=l.stats);k.destroy=function(){l.decRef()};return k},clear:function(){for(var a=0;a<Fa;++a)f.activeTexture(33984+a),f.bindTexture(3553,null),Aa[a]=null;y(ma).forEach(ra);B.cubeCount=0;B.textureCount=0},getTexture:function(a){return null},restore:function(){y(ma).forEach(function(a){a.texture=f.createTexture();f.bindTexture(a.target,a.texture);
for(var b=0;32>b;++b)if(0!==(a.mipmask&1<<b))if(3553===a.target)f.texImage2D(3553,b,a.internalformat,a.width>>b,a.height>>b,0,a.internalformat,a.type,null);else for(var c=0;6>c;++c)f.texImage2D(34069+c,b,a.internalformat,a.width>>b,a.height>>b,0,a.internalformat,a.type,null);ga(a.texInfo,a.target)})}}}},{"./constants/arraytypes.json":4,"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/to-half-float":30,"./util/values":31}],20:[function(d,
t,n){t.exports=function(d,c){function n(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function l(a,b,c){var g=t.pop()||new n;g.startQueryIndex=a;g.endQueryIndex=b;g.sum=0;g.stats=c;K.push(g)}var b=c.ext_disjoint_timer_query;if(!b)return null;var g=[],a=[],t=[],K=[],E=[],z=[];return{beginQuery:function(c){var d=g.pop()||b.createQueryEXT();b.beginQueryEXT(35007,d);a.push(d);l(a.length-1,a.length,c)},endQuery:function(){b.endQueryEXT(35007)},pushScopeStats:l,update:function(){var c,
d;c=a.length;if(0!==c){z.length=Math.max(z.length,c+1);E.length=Math.max(E.length,c+1);E[0]=0;var h=z[0]=0;for(d=c=0;d<a.length;++d){var l=a[d];b.getQueryObjectEXT(l,34919)?(h+=b.getQueryObjectEXT(l,34918),g.push(l)):a[c++]=l;E[d+1]=h;z[d+1]=c}a.length=c;for(d=c=0;d<K.length;++d){var h=K[d],k=h.startQueryIndex,l=h.endQueryIndex;h.sum+=E[l]-E[k];k=z[k];l=z[l];l===k?(h.stats.gpuTime+=h.sum/1E6,t.push(h)):(h.startQueryIndex=k,h.endQueryIndex=l,K[c++]=h)}K.length=c}},getNumPendingQueries:function(){return a.length},
clear:function(){g.push.apply(g,a);for(var c=0;c<g.length;c++)b.deleteQueryEXT(g[c]);a.length=0;g.length=0},restore:function(){a.length=0;g.length=0}}}},{}],21:[function(d,t,n){t.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(d,t,n){function h(c){return Array.prototype.slice.call(c)}function c(c){return h(c).join("")}var u=d("./extend");t.exports=function(){function d(){var a=[],b=[];return u(function(){a.push.apply(a,
h(arguments))},{def:function(){var c="v"+g++;b.push(c);0<arguments.length&&(a.push(c,"="),a.push.apply(a,h(arguments)),a.push(";"));return c},toString:function(){return c([0<b.length?"var "+b+";":"",c(a)])}})}function b(){function a(g,d){c(g,d,"=",b.def(g,d),";")}var b=d(),c=d(),g=b.toString,n=c.toString;return u(function(){b.apply(b,h(arguments))},{def:b.def,entry:b,exit:c,save:a,set:function(c,g,d){a(c,g);b(c,g,"=",d,";")},toString:function(){return g()+n()}})}var g=0,a=[],n=[],t=d(),E={};return{global:t,
link:function(b){for(var c=0;c<n.length;++c)if(n[c]===b)return a[c];c="g"+g++;a.push(c);n.push(b);return c},block:d,proc:function(a,g){function d(){var a="a"+h.length;h.push(a);return a}var h=[];g=g||0;for(var l=0;l<g;++l)d();var l=b(),k=l.toString;return E[a]=u(l,{arg:d,toString:function(){return c(["function(",h.join(),"){",k(),"}"])}})},scope:b,cond:function(){var a=c(arguments),g=b(),d=b(),l=g.toString,n=d.toString;return u(g,{then:function(){g.apply(g,h(arguments));return this},"else":function(){d.apply(d,
h(arguments));return this},toString:function(){var b=n();b&&(b="else{"+b+"}");return c(["if(",a,"){",l(),"}",b])}})},compile:function(){var b=['"use strict";',t,"return {"];Object.keys(E).forEach(function(a){b.push('"',a,'":',E[a].toString(),",")});b.push("}");var g=c(b).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,a.concat(g)).apply(null,n)}}}},{"./extend":23}],23:[function(d,t,n){t.exports=function(d,c){for(var n=Object.keys(c),l=0;l<n.length;++l)d[n[l]]=
c[n[l]];return d}},{}],24:[function(d,t,n){var h=d("./is-typed-array");t.exports=function(c){return Array.isArray(c)||h(c)}},{"./is-typed-array":26}],25:[function(d,t,n){var h=d("./is-typed-array");t.exports=function(c){return!!c&&"object"===typeof c&&Array.isArray(c.shape)&&Array.isArray(c.stride)&&"number"===typeof c.offset&&c.shape.length===c.stride.length&&(Array.isArray(c.data)||h(c.data))}},{"./is-typed-array":26}],26:[function(d,t,n){var h=d("../constants/arraytypes.json");t.exports=function(c){return Object.prototype.toString.call(c)in
h}},{"../constants/arraytypes.json":4}],27:[function(d,t,n){t.exports=function(d,c){for(var n=Array(d),l=0;l<d;++l)n[l]=c(l);return n}},{}],28:[function(d,t,n){function h(b){var c,a;c=(65535<b)<<4;b>>>=c;a=(255<b)<<3;b>>>=a;c|=a;a=(15<b)<<2;b>>>=a;c|=a;a=(3<b)<<1;return c|a|b>>>a>>1}function c(b){a:{for(var c=16;268435456>=c;c*=16)if(b<=c){b=c;break a}b=0}c=l[h(b)>>2];return 0<c.length?c.pop():new ArrayBuffer(b)}function u(b){l[h(b.byteLength)>>2].push(b)}var l=d("./loop")(8,function(){return[]});
t.exports={alloc:c,free:u,allocType:function(b,d){var a=null;switch(b){case 5120:a=new Int8Array(c(d),0,d);break;case 5121:a=new Uint8Array(c(d),0,d);break;case 5122:a=new Int16Array(c(2*d),0,d);break;case 5123:a=new Uint16Array(c(2*d),0,d);break;case 5124:a=new Int32Array(c(4*d),0,d);break;case 5125:a=new Uint32Array(c(4*d),0,d);break;case 5126:a=new Float32Array(c(4*d),0,d);break;default:return null}return a.length!==d?a.subarray(0,d):a},freeType:function(b){u(b.buffer)}}},{"./loop":27}],29:[function(d,
t,n){t.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(d){return requestAnimationFrame(d)},cancel:function(d){return cancelAnimationFrame(d)}}:{next:function(d){return setTimeout(d,16)},cancel:clearTimeout}},{}],30:[function(d,t,n){var h=d("./pool"),c=new Float32Array(1),u=new Uint32Array(c.buffer);t.exports=function(d){for(var b=h.allocType(5123,d.length),g=0;g<d.length;++g)if(isNaN(d[g]))b[g]=65535;else if(Infinity===d[g])b[g]=31744;else if(-Infinity===
d[g])b[g]=64512;else{c[0]=d[g];var a=u[0],n=a>>>31<<15,t=(a<<1>>>24)-127,a=a>>13&1023;b[g]=-24>t?n:-14>t?n+(a+1024>>-14-t):15<t?n+31744:n+(t+15<<10)+a}return b}},{"./pool":28}],31:[function(d,t,n){t.exports=function(d){return Object.keys(d).map(function(c){return d[c]})}},{}],32:[function(d,t,n){function h(c,a,d){function h(){var a=window.innerWidth,m=window.innerHeight;c!==document.body&&(m=c.getBoundingClientRect(),a=m.right-m.left,m=m.top-m.bottom);l.width=d*a;l.height=d*m;b(l.style,{width:a+"px",
height:m+"px"})}var l=document.createElement("canvas");b(l.style,{border:0,margin:0,padding:0,top:0,left:0});c.appendChild(l);c===document.body&&(l.style.position="absolute",b(c.style,{margin:0,padding:0}));window.addEventListener("resize",h,!1);h();return{canvas:l,onDestroy:function(){window.removeEventListener("resize",h);c.removeChild(l)}}}function c(b,a){function c(d){try{return b.getContext(d,a)}catch(h){return null}}return c("webgl")||c("experimental-webgl")||c("webgl-experimental")}function u(b){return"string"===
typeof b?b.split():b}function l(b){return"string"===typeof b?document.querySelector(b):b}var b=d("./util/extend");t.exports=function(b){var a=b||{},d,n,t,z;b={};var m=[],F=[],C="undefined"===typeof window?1:window.devicePixelRatio,H=!1,k=function(a){},q=function(){};"string"===typeof a?d=document.querySelector(a):"object"===typeof a&&("string"===typeof a.nodeName&&"function"===typeof a.appendChild&&"function"===typeof a.getBoundingClientRect?d=a:"function"===typeof a.drawArrays||"function"===typeof a.drawElements?
(z=a,t=z.canvas):("gl"in a?z=a.gl:"canvas"in a?t=l(a.canvas):"container"in a&&(n=l(a.container)),"attributes"in a&&(b=a.attributes),"extensions"in a&&(m=u(a.extensions)),"optionalExtensions"in a&&(F=u(a.optionalExtensions)),"onDone"in a&&(k=a.onDone),"profile"in a&&(H=!!a.profile),"pixelRatio"in a&&(C=+a.pixelRatio)));d&&("canvas"===d.nodeName.toLowerCase()?t=d:n=d);if(!z){if(!t){d=h(n||document.body,k,C);if(!d)return null;t=d.canvas;q=d.onDestroy}z=c(t,b)}return z?{gl:z,canvas:t,container:n,extensions:m,
optionalExtensions:F,pixelRatio:C,profile:H,onDone:k,onDestroy:q}:(q(),k("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/extend":23}],33:[function(d,t,n){function h(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var c=d("./lib/util/extend"),u=d("./lib/dynamic"),l=d("./lib/util/raf"),b=d("./lib/util/clock"),g=d("./lib/strings"),a=d("./lib/webgl"),y=d("./lib/extension"),K=d("./lib/limits"),E=d("./lib/buffer"),z=d("./lib/elements"),
m=d("./lib/texture"),F=d("./lib/renderbuffer"),C=d("./lib/framebuffer"),H=d("./lib/attribute"),k=d("./lib/shader"),q=d("./lib/read"),O=d("./lib/core"),B=d("./lib/stats"),G=d("./lib/timer");t.exports=function(d){function n(){if(0===S.length)D&&D.update(),da=null;else{da=l.next(n);J();for(var a=S.length-1;0<=a;--a){var b=S[a];b&&b(T,null,0)}p.flush();D&&D.update()}}function t(){!da&&0<S.length&&(da=l.next(n))}function ba(){da&&(l.cancel(n),da=null)}function Ga(a){a.preventDefault();ba();W.forEach(function(a){a()})}
function za(a){p.getError();ca.restore();ha.restore();ga.restore();Y.restore();ra.restore();pa.restore();D&&D.restore();L.procs.refresh();t();Z.forEach(function(a){a()})}function P(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];u.isDynamic(e)?d[b]=u.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function d(a){for(;n.length<a;)n.push(null);return n}var f=b(a.context||{}),g=b(a.uniforms||{}),h=b(a.attributes||{}),k=b(function(a){function b(a){if(a in d){var c=d[a];delete d[a];
Object.keys(c).forEach(function(b){d[a+"."+b]=c[b]})}}var d=c({},a);delete d.uniforms;delete d.attributes;delete d.context;"stencil"in d&&d.stencil.op&&(d.stencil.opBack=d.stencil.opFront=d.stencil.op,delete d.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return d}(a));a={gpuTime:0,cpuTime:0,count:0};var f=L.compile(k,h,g,f,a),l=f.draw,e=f.batch,m=f.scope,n=[];return c(function(a,b){var c;if("function"===typeof a)return m.call(this,null,a,0);
if("function"===typeof b)if("number"===typeof a)for(c=0;c<a;++c)m.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)m.call(this,a[c],b,c);else return m.call(this,a,b,0);else if("number"===typeof a){if(0<a)return e.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return e.call(this,a,a.length)}else return l.call(this,a)},{stats:a})}function Ba(a){S.push(a);t();return{cancel:function(){function b(){var a=h(S,b);S[a]=S[S.length-1];--S.length;0>=S.length&&ba()}var c=h(S,a);
S[c]=b}}}function Q(){var a=ia.viewport,b=ia.scissor_box;a[0]=a[1]=b[0]=b[1]=0;T.viewportWidth=T.framebufferWidth=T.drawingBufferWidth=a[2]=b[2]=p.drawingBufferWidth;T.viewportHeight=T.framebufferHeight=T.drawingBufferHeight=a[3]=b[3]=p.drawingBufferHeight}function J(){T.tick+=1;T.time=ta();Q();L.procs.poll()}function na(){Q();L.procs.refresh();D&&D.update()}function ta(){return(b()-xa)/1E3}d=a(d);if(!d)return null;var p=d.gl,U=p.getContextAttributes();p.isContextLost();var ca=y(p,d);if(!ca)return null;
var ka=g(),X=B(),M=ca.extensions,D=G(p,M),xa=b(),oa=p.drawingBufferWidth,ya=p.drawingBufferHeight,T={tick:0,time:0,viewportWidth:oa,viewportHeight:ya,framebufferWidth:oa,framebufferHeight:ya,drawingBufferWidth:oa,drawingBufferHeight:ya,pixelRatio:d.pixelRatio},fa=K(p,M),ga=E(p,X,d),qa=z(p,M,ga,X),oa=H(p,M,fa,ga,ka),ha=k(p,ka,X,d),Y=m(p,M,fa,function(){L.procs.poll()},T,X,d),ra=F(p,M,fa,X,d),pa=C(p,M,fa,Y,ra,X),L=O(p,ka,M,fa,ga,qa,Y,pa,{},oa,ha,{elements:null,primitive:4,count:-1,offset:0,instances:-1},
T,D,d),ka=q(p,pa,L.procs.poll,T,U,M),ia=L.next,la=p.canvas,S=[],W=[],Z=[],aa=[d.onDestroy],da=null;la&&(la.addEventListener("webglcontextlost",Ga,!1),la.addEventListener("webglcontextrestored",za,!1));na();U=c(P,{clear:function(a){var b=0;L.procs.poll();var c=a.color;c&&(p.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(p.clearDepth(+a.depth),b|=256);"stencil"in a&&(p.clearStencil(a.stencil|0),b|=1024);p.clear(b)},prop:u.define.bind(null,1),context:u.define.bind(null,2),"this":u.define.bind(null,
3),draw:P({}),buffer:function(a){return ga.create(a,34962,!1,!1)},elements:function(a){return qa.create(a,!1)},texture:Y.create2D,cube:Y.createCube,renderbuffer:ra.create,framebuffer:pa.create,framebufferCube:pa.createCube,attributes:U,frame:Ba,on:function(a,b){var c;switch(a){case "frame":return Ba(b);case "lost":c=W;break;case "restore":c=Z;break;case "destroy":c=aa}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:fa,hasExtension:function(a){return 0<=
fa.extensions.indexOf(a.toLowerCase())},read:ka,destroy:function(){S.length=0;ba();la&&(la.removeEventListener("webglcontextlost",Ga),la.removeEventListener("webglcontextrestored",za));ha.clear();pa.clear();ra.clear();Y.clear();qa.clear();ga.clear();D&&D.clear();aa.forEach(function(a){a()})},_gl:p,_refresh:na,poll:function(){J();D&&D.update()},now:ta,stats:X});d.onDone(null,U);return U}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,
"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},{},[1]);

        </script>
        </body>
      </html>