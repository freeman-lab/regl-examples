<!DOCTYPE html>
      <html>
        <head>
          <title>example/life.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(n,r,c){function f(p,h){if(!r[p]){if(!n[p]){var I="function"==typeof require&&require;if(!h&&I)return I(p,!0);if(a)return a(p,!0);I=Error("Cannot find module '"+p+"'");throw I.code="MODULE_NOT_FOUND",I;}I=r[p]={exports:{}};n[p][0].call(I.exports,function(a){var c=n[p][1][a];return f(c?c:a)},I,I.exports,e$$0,n,r,c)}return r[p].exports}for(var a="function"==typeof require&&require,h=0;h<c.length;h++)f(c[h]);return f})({1:[function(e,n,r){var c=e("../regl")(),f=Array(1048576).fill(0).map(function(){return.9<
Math.random()?255:0}),a=Array(2).fill().map(function(){return c.framebuffer({colorBuffer:c.texture({radius:512,data:f,wrap:"repeat"}),depth:!1})}),h=c({frag:"\n  precision mediump float;\n  uniform sampler2D prevState;\n  varying vec2 uv;\n  void main() {\n    float n = 0.0;\n    for(int dx=-1; dx<=1; ++dx)\n    for(int dy=-1; dy<=1; ++dy) {\n      n += texture2D(prevState, uv+vec2(dx,dy)/float(512)).r;\n    }\n    float s = texture2D(prevState, uv).r;\n    if(n > 3.0+s || n < 3.0) {\n      gl_FragColor = vec4(0,0,0,1);\n    } else {\n      gl_FragColor = vec4(1,1,1,1);\n    }\n  }",
framebuffer:function(c){return a[(c.count+1)%2]}}),p=c({frag:"\n  precision mediump float;\n  uniform sampler2D prevState;\n  varying vec2 uv;\n  void main() {\n    float state = texture2D(prevState, uv).r;\n    gl_FragColor = vec4(vec3(state), 1);\n  }",vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main() {\n    uv = 0.5 * (position + 1.0);\n    gl_Position = vec4(position, 0, 1);\n  }",attributes:{position:[-4,-4,4,-4,0,4]},uniforms:{prevState:function(c){return a[c.count%
2].color[0]}},depth:{enable:!1},count:3});c.frame(function(){p(function(){c.draw();h()})})},{"../regl":30}],2:[function(e,n,r){function c(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}n.exports=function(f,a,h,p,l){f=h.maxAttributes;a=Array(f);for(h=0;h<f;++h)a[h]=new c;return{Record:c,scope:{},state:a}}},{}],3:[function(e,n,r){function c(c,a){switch(c){case 5121:return new Uint8Array(a);case 5123:return new Uint16Array(a);
case 5125:return new Uint32Array(a);case 5120:return new Int8Array(a);case 5122:return new Int16Array(a);case 5124:return new Int32Array(a);case 5126:return new Float32Array(a);default:return null}}var f=e("./util/is-typed-array"),a=e("./util/is-ndarray"),h=e("./constants/arraytypes.json"),p=e("./constants/dtypes.json"),l=e("./util/values"),I={"static":35044,dynamic:35048,stream:35040};n.exports=function(e){function n(a){this.id=F++;this.buffer=null;this.type=a;this.usage=35044;this.byteLength=0;
this.dimension=1;this.data=null;this.dtype=5121}function B(a){e.isBuffer(a.buffer)||(a.buffer=e.createBuffer());a.bind();e.bufferData(a.type,a.data||a.byteLength,a.usage)}function v(a){var c=a.buffer;e.isBuffer(c)&&e.deleteBuffer(c);a.buffer=null;delete d[a.id]}function t(l,e,t){function F(d){var l=d||{};if(Array.isArray(l)||f(l)||a(l))l={data:l};else if("number"===typeof l)l={length:l|0};else if(null===l||void 0===l)l={};A.usage="usage"in l?I[l.usage]:35044;d=0;"type"in l&&(d=p[l.type]);var e=l.dimension|
0||1,t=0,u=null;if("data"in l)if(u=l.data,null===u)t=l.length|0;else{if(a(u)){var e=u.shape,t=u.stride,l=u.offset,w=0,G=0,v=0,y=0;1===e.length?(w=e[0],G=1,v=t[0],y=0):2===e.length&&(w=e[0],G=e[1],v=t[0],y=t[1]);d=d||h[Object.prototype.toString.call(u.data)]|0||5126;for(var e=G,t=c(d,w*G),u=u.data,n=0,L=0;L<w;++L)for(var z=0;z<G;++z)t[n++]=u[v*L+y*z+l];u=t}else if(Array.isArray(u))if(0<u.length&&Array.isArray(u[0])){e=u[0].length;d=d||5126;l=c(d,u.length*e);t=u;u=e;for(w=y=0;w<t.length;++w)for(v=t[w],
G=0;G<u;++G)l[y++]=v[G];u=l}else d=d||5126,u=c(d,u);else d=d||h[Object.prototype.toString.call(u)]|0;t=u.byteLength}else"length"in l&&(t=l.length|0);A.data=u;A.dtype=d||5121;A.byteLength=t;A.dimension=e;B(A);return F}var A=new n(e);d[A.id]=A;t||F(l);F._reglType="buffer";F._buffer=A;F.destroy=function(){v(A)};return F}var F=0,d={};n.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)};return{create:t,createStream:function(a){return t({data:a,usage:"stream"},34962,!1)._buffer},destroyStream:function(a){v(a)},
clear:function(){l(d).forEach(v)},refresh:function(){l(d).forEach(B)},getBuffer:function(a){return a&&a._buffer instanceof n?a._buffer:null}}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./util/is-ndarray":21,"./util/is-typed-array":22,"./util/values":28}],4:[function(e,n,r){n.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,
"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(e,n,r){n.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],6:[function(e,n,r){n.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(e,n,r){function c(a){return Array.isArray(a)||U(a)||B(a)}function f(a){return a.sort(function(a,d){return"viewport"===a?-1:"viewport"===
d?1:a<d?-1:1})}function a(a,d,c,l){this.thisDep=a;this.contextDep=d;this.propDep=c;this.append=l}function h(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function p(d){return new a(!1,!1,!1,d)}function l(d,c){var l=d.type;return 0===l?(l=d.data.length,new a(!0,1<=l,2<=l,c)):new a(3===l,2===l,1===l,c)}var I=e("./util/codegen"),z=e("./util/loop"),U=e("./util/is-typed-array"),B=e("./util/is-ndarray"),v=e("./constants/primitives.json"),t=e("./constants/dtypes.json"),F=["x","y","z","w"],d={0:0,1:1,
zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},u={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},y={0:0,zero:0,
keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},L={cw:2304,ccw:2305},aa=new a(!1,!1,!1,function(){});n.exports=function(e,n,B,r,V,H,w,G,ga,R,X,ha,M){function P(m){return m.replace(".","_")}function E(m,b,a){var k=P(m);pa.push(m);ma[k]=ia[k]=!!a;ja[k]=b}function C(m,b,a){var k=P(m);pa.push(m);Array.isArray(a)?(ia[k]=a.slice(),ma[k]=a.slice()):ia[k]=ma[k]=a;ka[k]=b}function Q(){var m=I(),b=m.link,a=m.global;m.id=Ca++;m.batchId="0";var k=
b(za),d=m.shared={props:"a0"};Object.keys(za).forEach(function(g){d[g]=a.def(k,".",g)});var D=m.next={},c=m.current={};Object.keys(ka).forEach(function(g){Array.isArray(ia[g])&&(D[g]=a.def(d.next,".",g),c[g]=a.def(d.current,".",g))});var g=m.constants={};Object.keys(ra).forEach(function(m){g[m]=a.def(JSON.stringify(ra[m]))});m.invoke=function(g,a){switch(a.type){case 0:var ca=["this",d.context,d.props,m.batchId];return g.def(b(a.data),".call(",ca.slice(0,Math.max(a.data.length+1,4)),")");case 1:return g.def(d.props,
a.data);case 2:return g.def(d.context,a.data);case 3:return g.def("this",a.data)}};m.attribCache={};var ca={};m.scopeAttrib=function(g){g=n.id(g);if(g in ca)return ca[g];var m=R.scope[g];m||(m=R.scope[g]=new na);return ca[g]=b(m)};return m}function da(m){var a=m["static"];m=m.dynamic;if("framebuffer"in a){var b=a.framebuffer;return b?(b=G.getFramebuffer(b),p(function(m,a){var k=m.link(b),g=m.shared;a.set(g.framebuffer,".next",k);g=g.context;a.set(g,".framebufferWidth",k+".width");a.set(g,".framebufferHeight",
k+".height");return k})):p(function(m,a){var b=m.shared;a.set(b.framebuffer,".next","null");b=b.context;a.set(b,".framebufferWidth",b+".drawingBufferWidth");a.set(b,".framebufferHeight",b+".drawingBufferHeight");return null})}if("framebuffer"in m){var k=m.framebuffer;return l(k,function(m,a){var b=m.invoke(a,k),g=m.shared,ca=g.framebuffer,b=a.def(ca,".getFramebuffer(",b,")");a.set(ca,".next",b);g=g.context;a.set(g,".framebufferWidth",b+"?"+b+".width:"+g+".drawingBufferWidth");a.set(g,".framebufferHeight",
b+"?"+b+".height:"+g+".drawingBufferHeight");return b})}return null}function Y(m,b){function k(g){if(g in d){var m=d[g];g=!0;var qa=m.x|0,Aa=m.y|0,D,q;"w"in m?D=m.w|0:g=!1;"h"in m?q=m.h|0:g=!1;return new a(g&&b&&b.thisDep,g&&b&&b.contextDep,g&&b&&b.propDep,function(g,b){var a=g.shared.context,k=D;"w"in m||(k=b.def(a,".","framebufferWidth","-",qa));var d=q;"h"in m||(d=b.def(a,".","framebufferHeight","-",Aa));return[qa,Aa,k,d]})}if(g in c){var p=c[g];g=l(p,function(g,b){var m=g.invoke(b,p),a=g.shared.context,
k=b.def(m,".x|0"),ca=b.def(m,".y|0"),qa=b.def('"w" in ',m,"?",m,".w|0:","(",a,".","framebufferWidth","-",k,")"),m=b.def('"h" in ',m,"?",m,".h|0:","(",a,".","framebufferHeight","-",ca,")");return[k,ca,qa,m]});b&&(g.thisDep=g.thisDep||b.thisDep,g.contextDep=g.contextDep||b.contextDep,g.propDep=g.propDep||b.prpoDep);return g}return b?new a(b.thisDep,b.contextDep,b.propDep,function(g,b){var m=g.shared.context;return[0,0,b.def(m,".","framebufferWidth"),b.def(m,".","framebufferHeight")]}):null}var d=m["static"],
c=m.dynamic,D=k("viewport");if(D)var q=D,D=new a(D.thisDep,D.contextDep,D.propDep,function(g,b){var m=q.append(g,b),a=g.shared.context;b.set(a,".viewportWidth",m[2]);b.set(a,".viewportHeight",m[3]);return m});return{viewport:D,scissor_box:k("scissor.box")}}function K(b){function k(g){if(g in d){var b=n.id(d[g]);g=p(function(){return b});g.id=b;return g}if(g in c){var m=c[g];return l(m,function(g,b){var a=g.invoke(b,m);return b.def(g.shared.strings,".id(",a,")")})}return null}var d=b["static"],c=b.dynamic,
q=k("frag"),D=k("vert"),f=null;h(q)&&h(D)?(f=X.program(D.id,q.id),b=p(function(g,b){return g.link(f)})):b=new a(q&&q.thisDep||D&&D.thisDep,q&&q.contextDep||D&&D.contextDep,q&&q.propDep||D&&D.propDep,function(g,b){var m=g.shared.shader,a;a=q?q.append(g,b):b.def(m,".","frag");var k;k=D?D.append(g,b):b.def(m,".","vert");return b.def(m+".program("+k+","+a+")")});return{frag:q,vert:D,progVar:b,program:f}}function J(b){function k(b,g){if(b in d){var m=d[b]|0;return p(function(b,a){g&&(b.OFFSET=m);return m})}if(b in
q){var a=q[b];return l(a,function(b,m){var k=b.invoke(m,a);g&&(b.OFFSET=k);return k})}return g&&f?p(function(g,b){g.OFFSET="0";return 0}):null}var d=b["static"],q=b.dynamic,f=function(){if("elements"in d){var b=d.elements;c(b)?b=H.getElements(H.create(b)):b&&(b=H.getElements(b));var g=p(function(g,m){if(b){var a=g.link(b);return g.ELEMENTS=a}return g.ELEMENTS=null});g.value=b;return g}if("elements"in q){var m=q.elements;return l(m,function(g,b){var a=g.shared,k=a.isBufferArgs,a=a.elements,d=g.invoke(b,
m),q=b.def("null"),k=b.def(k,"(",d,")"),d=g.cond(k).then(q,"=",a,".createStream(",d,");")["else"](q,"=",a,".getElements(",d,");");b.entry(d);b.exit(g.cond(k).then(a,".destroyStream(",q,");"));return g.ELEMENTS=q})}return null}(),D=k("offset",!0);return{elements:f,primitive:function(){if("primitive"in d){var b=d.primitive;return p(function(g,m){return v[b]})}if("primitive"in q){var g=q.primitive;return l(g,function(b,m){var a=b.constants.primTypes,k=b.invoke(m,g);return m.def(a,"[",k,"]")})}return f?
h(f)?f.value?p(function(g,b){return b.def(g.ELEMENTS,".primType")}):p(function(){return 4}):new a(f.thisDep,f.contextDep,f.propDep,function(g,b){var m=g.ELEMENTS;return b.def(m,"?",m,".primType:",4)}):null}(),count:function(){if("count"in d){var b=d.count|0;return p(function(){return b})}if("count"in q){var g=q.count;return l(g,function(b,m){return b.invoke(m,g)})}return f?h(f)?f?D?new a(D.thisDep,D.contextDep,D.propDep,function(g,b){return b.def(g.ELEMENTS,".vertCount-",g.OFFSET)}):p(function(g,
b){return b.def(g.ELEMENTS,".vertCount")}):p(function(){return-1}):new a(f.thisDep||D.thisDep,f.contextDep||D.contextDep,f.propDep||D.propDep,function(g,b){var m=g.ELEMENTS;return g.OFFSET?b.def(m,"?",m,".vertCount-",g.OFFSET,":-1"):b.def(m,"?",m,".vertCount:-1")}):null}(),instances:k("instances",!1),offset:D}}function T(b){var a=b["static"],k=b.dynamic,q={};pa.forEach(function(b){function m(g,d){if(b in a){var f=g(a[b]);q[c]=p(function(){return f})}else if(b in k){var D=k[b];q[c]=l(D,function(g,
b){return d(g,b,g.invoke(b,D))})}}var c=P(b);switch(b){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return m(function(g){return g},function(g,b,m){return m});case "depth.func":return m(function(g){return u[g]},function(g,b,m){return b.def(g.constants.compareFuncs,"[",m,"]")});case "depth.range":return m(function(g){return g},function(g,b,m){g=
b.def("+",m,"[0]");b=b.def("+",m,"[1]");return[g,b]});case "blend.func":return m(function(g){return[d["srcRGB"in g?g.srcRGB:g.src],d["dstRGB"in g?g.dstRGB:g.dst],d["srcAlpha"in g?g.srcAlpha:g.src],d["dstAlpha"in g?g.dstAlpha:g.dst]]},function(g,b,m){function a(g,d){var q=b.def('"',g,d,'" in ',m,"?",m,".",g,d,":",m,".",g);return b.def(k,"[",q,"]")}var k=g.constants.blendFuncs;g=a("src","RGB");var d=a("src","Alpha"),q=a("dst","RGB"),c=a("dst","Alpha");return[g,q,d,c]});case "blend.equation":return m(function(g){if("string"===
typeof g)return[la[g],la[g]];if("object"===typeof g)return[la[g.rgb],la[g.alpha]]},function(g,b,m){var a=g.constants.blendEquations,k=b.def(),d=b.def();g=g.cond("typeof ",m,'==="string"');g.then(k,"=",d,"=",a,"[",m,"];");g["else"](k,"=",a,"[",m,".rgb];",d,"=",a,"[",m,".alpha];");b(g);return[k,d]});case "blend.color":return m(function(g){return z(4,function(b){return+g[b]})},function(g,b,m){return z(4,function(g){return b.def("+",m,"[",g,"]")})});case "stencil.mask":return m(function(g){return g|0},
function(g,b,m){return b.def(m,"|0")});case "stencil.func":return m(function(g){return[u[g.cmp||"keep"],g.ref||0,"mask"in g?g.mask:-1]},function(g,b,m){g=b.def('"cmp" in ',m,"?",g.constants.compareFuncs,"[",m,".cmp]",":",7680);var a=b.def(m,".ref|0");b=b.def('"mask" in ',m,"?",m,".mask|0:-1");return[g,a,b]});case "stencil.opFront":case "stencil.opBack":return m(function(g){return["stencil.opBack"===b?1029:1028,y[g.fail||"keep"],y[g.zfail||"keep"],y[g.pass||"keep"]]},function(g,m,a){function k(b){return m.def('"',
b,'" in ',a,"?",d,"[",a,".",b,"]:",7680)}var d=g.constants.stencilOps;return["stencil.opBack"===b?1029:1028,k("fail"),k("zfail"),k("pass")]});case "polygonOffset.offset":return m(function(b){return[b.factor|0,b.units|0]},function(b,m,a){b=m.def(a,".factor|0");m=m.def(a,".units|0");return[b,m]});case "cull.face":return m(function(b){var m=0;"front"===b?m=1028:"back"===b&&(m=1029);return m},function(b,m,a){return m.def(a,'==="front"?',1028,":",1029)});case "lineWidth":return m(function(b){return b},
function(b,m,a){return a});case "frontFace":return m(function(b){return L[b]},function(b,m,a){return m.def(a+'==="cw"?2304:2305')});case "colorMask":return m(function(b){return b.map(function(b){return!!b})},function(b,m,a){return z(4,function(b){return"!!"+a+"["+b+"]"})});case "sample.coverage":return m(function(b){return["value"in b?b.value:1,!!b.invert]},function(b,m,a){b=m.def('"value" in ',a,"?+",a,".value:1");m=m.def("!!",a,".invert");return[b,m]})}});return q}function S(b){var a=b["static"],
k=b.dynamic,d={};Object.keys(a).forEach(function(b){var m=a[b],k;if("number"===typeof m||"boolean"===typeof m)k=p(function(){return m});else if("function"===typeof m&&"texture"===m._reglType)k=p(function(b){return b.link(m)});else if(Array.isArray(m)||U(m))k=p(function(b){return b.global.def("[",z(m.length,function(b){return m[b]}),"]")});k.value=m;d[b]=k});Object.keys(k).forEach(function(b){var m=k[b];d[b]=l(m,function(b,g){return b.invoke(g,m)})});return d}function Z(b){var a=b["static"],k=b.dynamic,
d={};Object.keys(a).forEach(function(b){var m=a[b],k=n.id(b),g=new na;if(c(m))g.state=1,g.buffer=V.getBuffer(V.create(m,34962,!1)),g.type=g.buffer.dtype;else{var q=V.getBuffer(m);if(q)g.state=1,g.buffer=q,g.type=q.dtype;else if(m.constant){var f=m.constant;g.state=2;"number"===typeof f?g.x=f:F.forEach(function(b,m){m<f.length&&(g[b]=f[m])})}else{var q=V.getBuffer(m.buffer),l=m.offset|0,h=m.stride|0,x=m.size|0,e=!!m.normalized,ya=0;"type"in m&&(ya=t[m.type]);m=m.divisor|0;g.buffer=q;g.state=1;g.size=
x;g.normalized=e;g.type=ya||q.dtype;g.offset=l;g.stride=h;g.divisor=m}}d[b]=p(function(b,m){var a=b.attribCache;if(k in a)return a[k];var d={isStream:!1};Object.keys(g).forEach(function(b){d[b]=g[b]});g.buffer&&(d.buffer=b.link(g.buffer));return a[k]=d})});Object.keys(k).forEach(function(b){var m=k[b];d[b]=l(m,function(b,g){function a(b){g(f[b],"=",k,".",b,"|0;")}var k=b.invoke(g,m),d=b.shared,q=d.isBufferArgs,c=d.buffer,f={isStream:g.def(!1)},l=new na;l.state=1;Object.keys(l).forEach(function(b){f[b]=
g.def(""+l[b])});var ba=f.buffer,p=f.type;g("if(",q,"(",k,")){",f.isStream,"=true;",ba,"=",c,".createStream(",k,");",p,"=",ba,".dtype;","}else{",ba,"=",c,".getBuffer(",k,");","if(",ba,"){",p,"=",ba,".dtype;","}else if(",k,".constant){",f.state,"=",2,";",F.map(function(b,m){return f[b]+"="+k+".length>="+m+"?"+k+"["+m+"]:0;"}).join(""),"}else{",ba,"=",c,".getBuffer(",k,".buffer);",p,'="type" in ',k,"?",d.glTypes,"[",k,".type]:",ba,".dtype;",f.normalized,"=!!",k,".normalized;");a("size");a("offset");
a("stride");a("divisor");g("}}");return f})});return d}function N(b){var a=b["static"],k=b.dynamic,d={};Object.keys(a).forEach(function(b){var m=a[b];d[b]=p(function(b,g){return"number"===typeof m||"boolean"===typeof m?""+m:b.link(m)})});Object.keys(k).forEach(function(b){var m=k[b];d[b]=l(m,function(b,g){return b.invoke(g,m)})});return d}function O(b,a,k){var d=b.shared.context,q=b.scope();Object.keys(k).forEach(function(c){a.save(d,"."+c);q(d,".",c,"=",k[c].append(b,a),";")});a(q)}function b(b,
a,k){var d=b.shared,q=d.gl,c=d.framebuffer,f;sa&&(f=a.def(d.extensions,".webgl_draw_buffers"));var g=b.constants,d=g.drawBuffers,g=g.backBuffer;b=k?k.append(b,a):a.def(c,".next");a("if(",c,".dirty||",b,"!==",c,".cur){","if(",b,"){",q,".bindFramebuffer(",36160,",",b,".framebuffer);");sa&&a(f,".drawBuffersWEBGL(",d,"[",b,".colorAttachments.length]);");a("}else{",q,".bindFramebuffer(",36160,",null);");sa&&a(f,".drawBuffersWEBGL(",g,");");a("}",c,".cur=",b,";",c,".dirty=false;","}")}function q(b,a,k){var d=
b.shared,q=d.gl,c=b.current,f=b.next,g=d.current,l=d.next,p=b.cond(g,".dirty");pa.forEach(function(a){a=P(a);if(!(a in k.state)){var d,ba;if(a in f){d=f[a];ba=c[a];var h=z(ia[a].length,function(b){return p.def(d,"[",b,"]")});p(b.cond(h.map(function(b,m){return b+"==="+ba+"["+m+"]"}).join("&&")).then(q,".",ka[a],"(",h,");",h.map(function(b,m){return ba+"["+m+"]="+b}).join(";"),";"))}else d=p.def(l,".",a),h=b.cond(d,"!==",g,".",a),p(h),a in ja?h(b.cond(d).then(q,".enable(",ja[a],");")["else"](q,".disable(",
ja[a],");"),g,".",a,"=",d,";"):h(q,".",ka[a],"(",d,");",g,".",a,"=",d,";")}});0===Object.keys(k.state).length&&p(g,".dirty=false;");a(p)}function k(b,a,k,d){var q=b.shared,c=b.current,l=q.current,g=q.gl;f(Object.keys(k)).forEach(function(q){var f=k[q];if(!d||d(f)){var p=f.append(b,a);if(ja[q]){var x=ja[q];h(f)?p?a(g,".enable(",x,");"):a(g,".disable(",x,");"):a(b.cond(p).then(g,".enable(",x,");")["else"](g,".disable(",x,");"));a(l,".",q,"=",p,";")}else if(Array.isArray(p)){var e=c[q];a(g,".",ka[q],
"(",p,");",p.map(function(b,m){return e+"["+m+"]="+b}).join(";"),";")}else a(g,".",ka[q],"(",p,");",l,".",q,"=",p,";")}})}function x(b,a){oa&&!b.instancing&&(b.instancing=a.def(b.shared.extensions,".angle_instanced_arrays"))}function ta(b,a,k,d,q){function c(b){switch(b){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function f(k,d,q){function c(){a("if(!",x,".pointer){",p,".enableVertexAttribArray(",
h,");",x,".pointer=true;}");var g=q.type,k;k=q.size?a.def(q.size,"||",d):d;a("if(",x,".type!==",g,"||",x,".size!==",k,"||",t.map(function(b){return x+"."+b+"!=="+q[b]}).join("||"),"){",p,".bindBuffer(",34962,",",e,".buffer);",p,".vertexAttribPointer(",[h,k,g,q.normalized,q.stride,q.offset],");",x,".type=",g,";",x,".size=",k,";",t.map(function(b){return x+"."+b+"="+q[b]+";"}).join(""),"}");oa&&(g=q.divisor,a("if(",x,".divisor!==",g,"){",b.instancing,".vertexAttribDivisorANGLE(",[h,g],");",x,".divisor=",
g,";}"))}function l(){a("if(",x,".pointer){",p,".disableVertexAttribArray(",h,");",x,".pointer=false;","}if(",F.map(function(b,a){return x+"."+b+"!=="+u[a]}).join("||"),"){",p,".vertexAttrib4f(",h,",",u,");",F.map(function(b,a){return x+"."+b+"="+u[a]+";"}).join(""),"}")}var p=g.gl,h=a.def(k,".location"),x=a.def(g.attributes,"[",h,"]");k=q.state;var e=q.buffer,u=[q.x,q.y,q.z,q.w],t=["buffer","normalized","offset","stride"];1===k?c():2===k?l():(a("if(",k,"===",1,"){"),c(),a("}else{"),l(),a("}"))}var g=
b.shared;d.forEach(function(g){var d=g.name,l=k.attributes[d],p;if(l){if(!q(l))return;p=l.append(b,a)}else{if(!q(aa))return;var h=b.scopeAttrib(d);p={};Object.keys(new na).forEach(function(b){p[b]=a.def(h,".",b)})}f(b.link(g),c(g.info.type),p)})}function ua(b,a,k,d,q){for(var c=b.shared,f=c.gl,g,p=0;p<d.length;++p){var l=d[p],h=l.name,x=l.info.type,e=k.uniforms[h],l=b.link(l)+".location";if(e){if(!q(e))continue;if(e["static"]){h=e.value;if(35678===x||35680===x)x=b.link(h._texture),a(f,".uniform1i(",
l,x+".bind());"),a.exit(x,".unbind()");else if(35674===x||35675===x||35676===x)h=b.global.def("["+h+"]"),e=2,35675===x?e=3:35676===x&&(e=4),a(f,".uniformMatrix",e,"fv(",l,",false,",h,");");else{switch(x){case 5126:g="1f";break;case 35664:g="2f";break;case 35665:g="3f";break;case 35666:g="4f";break;case 35670:g="1i";break;case 5124:g="1i";break;case 35671:g="2i";break;case 35667:g="2i";break;case 35672:g="3i";break;case 35668:g="3i";break;case 35673:g="4i";break;case 35669:g="4i"}a(f,".uniform",g,
"(",l,",",h,");")}continue}else h=e.append(b,a)}else{if(!q(aa))continue;h=a.def(c.uniforms,"[",n.id(h),"]")}e=",";switch(x){case 35678:case 35680:x=a.def(h,"._texture");a(f,".uniform1i(",l,",",x,".bind());");a.exit(x,".unbind();");continue;case 5124:case 35670:g="1i";break;case 35667:case 35671:g="2iv";break;case 35668:case 35672:g="3iv";break;case 35669:case 35673:g="4iv";break;case 5126:g="1f";break;case 35664:g="2fv";break;case 35665:g="3fv";break;case 35666:g="4fv";break;case 35674:g="Matrix2fv";
e=",false,";break;case 35675:g="Matrix3fv";e=",false,";break;case 35676:g="Matrix4fv",e=",false,"}a(f,".uniform",g,"(",l,e,h,");")}}function va(b,a,k,d){function q(g){var d=x[g];return d?d.batchStatic?d.append(b,a):d.append(b,k):a.def(p,".",g)}function c(){function b(){k(G,".drawElementsInstancedANGLE(",[u,w,y,t+"<<(("+y+"-5121)>>1)",v],");")}function a(){k(G,".drawArraysInstancedANGLE(",[u,t,w,v],");")}e?n?b():(k("if(",e,"){"),b(),k("}else{"),a(),k("}")):a()}function f(){function b(){k(l+".drawElements("+
[u,w,y,t+"<<(("+y+"-5121)>>1)"]+");")}function a(){k(l+".drawArrays("+[u,t,w]+");")}e?n?b():(k("if(",e,"){"),b(),k("}else{"),a(),k("}")):a()}var g=b.shared,l=g.gl,p=g.draw,x=d.draw,e=function(){var g=x.elements,d=a;g?(g.batchStatic||(d=k),g=g.append(b,d)):g=d.def(p,".","elements");g&&d("if("+g+")"+l+".bindBuffer(34963,"+g+".buffer.buffer);");return g}(),u=q("primitive"),t=q("offset"),w=function(){var g=x.count,d=a;g?(g.batchStatic||(d=k),g=g.append(b,d)):g=d.def(p,".","count");return g}();if("number"===
typeof w){if(0===w)return}else k("if(",w,"){"),k.exit("}");var v,G;oa&&(v=q("instances"),G=b.instancing);var y=e+".type",n=x.elements&&h(x.elements);oa&&("number"!==typeof v||0<=v)?"string"===typeof v?(k("if(",v,">0){"),c(),k("}else if(",v,"<0){"),f(),k("}")):c():f()}function wa(b,a,k,d,q){a=Q();q=a.proc("body",q);oa&&(a.instancing=q.def(a.shared.extensions,".angle_instanced_arrays"));b(a,q,k,d);return a.compile().body}function Ba(b,a,k,d){x(b,a);ta(b,a,k,d.attributes,function(){return!0});ua(b,a,
k,d.uniforms,function(){return!0});va(b,a,a,k)}function Da(a,d){var c=a.proc("draw",1);x(a,c);O(a,c,d.context);b(a,c,d.framebuffer);q(a,c,d);k(a,c,d.state);var f=d.shader.progVar.append(a,c);c(a.shared.gl,".useProgram(",f,".program);");if(d.shader.program)Ba(a,c,d,d.shader.program);else{var l=a.global.def("{}"),p=c.def(f,".id"),h=c.def(l,"[",p,"]");c(a.cond(h).then(h,".call(this,a0);")["else"](h,"=",l,"[",p,"]=",a.link(function(b){return wa(Ba,a,d,b,1)}),"(",f,");",h,".call(this,a0);"))}0<Object.keys(d.state).length&&
c(a.shared.current,".dirty=true;")}function Ea(b,a,k,d){function q(){return!0}b.batchId="a1";x(b,a);ta(b,a,k,d.attributes,q);ua(b,a,k,d.uniforms,q);va(b,a,a,k)}function xa(a,d,q,c){function f(b){return b.contextDep&&p||b.propDep}function l(b){return!f(b)}x(a,d);var p=q.contextDynamic,g=d.def(),h=d.def();a.shared.props=h;a.batchId=g;var e=a.scope(),u=a.scope();d(e.entry,"for(",g,"=0;",g,"<","a1",";++",g,"){",h,"=","a0","[",g,"];",u,"}",e.exit);q.needsContext&&O(a,u,q.context);q.needsFramebuffer&&b(a,
u,q.framebuffer);k(a,u,q.state,f);c?(ta(a,e,q,c.attributes,l),ta(a,u,q,c.attributes,f),ua(a,e,q,c.uniforms,l),ua(a,u,q,c.uniforms,f),va(a,e,u,q)):(d=a.global.def("{}"),c=q.shader.progVar.append(a,u),h=u.def(c,".id"),e=u.def(d,"[",h,"]"),u(a.shared.gl,".useProgram(",c,".program);","if(!",e,"){",e,"=",d,"[",h,"]=",a.link(function(b){return wa(Ea,a,q,b,2)}),"(",c,");}",e,".call(this,a0[",g,"],",g,");"))}function Fa(a,d){var c=a.proc("batch",2);a.batchId="0";x(a,c);var f=!1,l=!0;Object.keys(d.context).forEach(function(b){f=
f||d.context[b].propDep});f||(O(a,c,d.context),l=!1);var p=d.framebuffer,h=!1;p&&(p.propDep?f=h=!0:p.contextDep&&f&&(h=!0),h||b(a,c,p));d.state.viewport&&d.state.viewport.propDynamic&&(f=!0);q(a,c,d);k(a,c,d.state,function(b){return!(b.contextDep&&f||b.propDep)});d.contextDep=f;d.needsContext=l;d.needsFramebuffer=h;l=d.shader.progVar;if(l.contextDep&&f||l.propDep)xa(a,c,d,null);else if(l=l.append(a,c),c(a.shared.gl,".useProgram(",l,".program);"),d.shader.program)xa(a,c,d,d.shader.program);else{var p=
a.global.def("{}"),h=c.def(l,".id"),g=c.def(p,"[",h,"]");c(a.cond(g).then(g,".call(this,a0,a1);")["else"](g,"=",p,"[",h,"]=",a.link(function(b){return wa(xa,a,d,b,2)}),"(",l,");",g,".call(this,a0,a1);"))}0<Object.keys(d.state).length&&c(a.shared.current,".dirty=true;")}function Ga(b,a){function d(c){var g=a.shader[c];g&&k.set(q.shader,"."+c,g.append(b,k))}var k=b.proc("scope",3);b.batchId="a2";var q=b.shared,c=q.current;O(b,k,a.context);a.framebuffer&&a.framebuffer.append(b,k);f(Object.keys(a.state)).forEach(function(d){var g=
a.state[d].append(b,k);Array.isArray(g)?g.forEach(function(a,g){k.set(b.next[d],"["+g+"]",a)}):k.set(q.next,"."+d,g)});["elements","offset","count","instances","primitive"].forEach(function(d){var g=a.draw[d];g&&k.set(q.draw,"."+d,""+g.append(b,k))});Object.keys(a.uniforms).forEach(function(d){k.set(q.uniforms,"["+n.id(d)+"]",a.uniforms[d].append(b,k))});Object.keys(a.attributes).forEach(function(d){var g=a.attributes[d].append(b,k),q=b.scopeAttrib(d);Object.keys(new na).forEach(function(b){k.set(q,
"."+b,g[b])})});d("vert");d("frag");0<Object.keys(a.state).length&&(k(c,".dirty=true;"),k.exit(c,".dirty=true;"));k("a1(",b.shared.context,",a0,0);")}var na=R.Record,la={add:32774,subtract:32778,"reverse subtract":32779};B.ext_blend_minmax&&(la.min=32775,la.max=32776);var oa=B.angle_instanced_arrays,sa=B.webgl_draw_buffers,ia={dirty:!0},ma={},pa=[],ja={},ka={};E("dither",3024);E("blend.enable",3042);C("blend.color","blendColor",[0,0,0,0]);C("blend.equation","blendEquationSeparate",[32774,32774]);
C("blend.func","blendFuncSeparate",[1,0,1,0]);E("depth.enable",2929,!0);C("depth.func","depthFunc",513);C("depth.range","depthRange",[0,1]);C("depth.mask","depthMask",!0);C("colorMask","colorMask",[!0,!0,!0,!0]);E("cull.enable",2884);C("cull.face","cullFace",1029);C("frontFace","frontFace",2305);C("lineWidth","lineWidth",1);E("polygonOffset.enable",32823);C("polygonOffset.offset","polygonOffset",[0,0]);E("sample.alpha",32926);E("sample.enable",32928);C("sample.coverage","sampleCoverage",[1,!1]);E("stencil.enable",
2960);C("stencil.mask","stencilMask",-1);C("stencil.func","stencilFunc",[519,0,-1]);C("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);C("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);E("scissor.enable",3089);C("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);C("viewport","viewport",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var za={gl:e,context:M,strings:n,next:ma,current:ia,draw:ha,elements:H,buffer:V,shader:X,attributes:R.state,uniforms:ga,
framebuffer:G,extensions:B,isBufferArgs:c},ra={primTypes:v,compareFuncs:u,blendFuncs:d,blendEquations:la,stencilOps:y,glTypes:t,orientationType:L};sa&&(ra.backBuffer=[1029],ra.drawBuffer=z(r.maxDrawbuffers,function(b){return z(b,function(b){return 36064+b})}));var Ca=0;return{next:ma,current:ia,procs:function(){var a=Q(),d=a.proc("poll"),k=a.proc("refresh"),q=a.block();d(q);k(q);var c=a.shared,f=c.gl,l=c.next,g=c.current;q(g,".dirty=false;");b(a,d);k(c.framebuffer,".dirty=true;");b(a,k);Object.keys(ja).forEach(function(b){var c=
ja[b],p=q.def(l,".",b),h=a.block();h("if(",p,"){",f,".enable(",c,")}else{",f,".disable(",c,")}",g,".",b,"=",p,";");k(h);d("if(",p,"!==",g,".",b,"){",h,"}")});Object.keys(ka).forEach(function(b){var c=ka[b],p=ia[b],h,x,e=a.block();e(f,".",c,"(");Array.isArray(p)?(c=p.length,h=a.global.def(l,".",b),x=a.global.def(g,".",b),e(z(c,function(b){return h+"["+b+"]"}),");",z(c,function(b){return x+"["+b+"]="+h+"["+b+"];"}).join("")),d("if(",z(c,function(b){return h+"["+b+"]!=="+x+"["+b+"]"}).join("||"),"){",
e,"}")):(h=q.def(l,".",b),x=q.def(g,".",b),e(h,");",g,".",b,"=",h,";"),d("if(",h,"!==",x,"){",e,"}"));k(e)});return a.compile()}(),compile:function(b,a,d,k){var q=Q(),c;c=da(b);var f=Y(b,c),g=J(b),l=T(b);b=K(b);var p=f.viewport;p&&(l.viewport=p);p=P("scissor.box");(f=f[p])&&(l[p]=f);f=0<Object.keys(l).length;c={framebuffer:c,draw:g,shader:b,state:l,dirty:f};c.uniforms=S(d);c.attributes=Z(a);c.context=N(k);Da(q,c);Ga(q,c);Fa(q,c);return q.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,
"./util/codegen":19,"./util/is-ndarray":21,"./util/is-typed-array":22,"./util/loop":24}],8:[function(e,n,r){function c(a,c){this.id=h++;this.type=a;this.data=c}function f(a){if(0===a.length)return[];var c=a.charAt(0),h=a.charAt(a.length-1);if(1<a.length&&c===h&&('"'===c||"'"===c))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(c=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return f(a.substr(0,c.index)).concat(f(c[1])).concat(f(a.substr(c.index+c[0].length)));
c=a.split(".");if(1===c.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(h=0;h<c.length;++h)a=a.concat(f(c[h]));return a}function a(a){return"["+f(a).join("][")+"]"}var h=0;n.exports={define:function(f,h){switch(typeof h){case "boolean":case "number":case "string":return new c(f,a(h+""));case "undefined":return new c(f|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof c},unbox:function(f,h){if(f instanceof c){if(f.type&128)return new c(f.type&
-129,a(h))}else if("function"===typeof f)return new c(0,f);return f},accessor:a}},{}],9:[function(e,n,r){var c=e("./util/is-typed-array"),f=e("./util/is-ndarray"),a=e("./constants/primitives.json");n.exports=function(h,p,l){function e(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}function n(h){function z(h){var d=p.oes_element_index_uint;if(h)if("number"===typeof h)t(h);else{var l=null,e="static";Array.isArray(h)||c(h)||f(h)?l=h:("data"in h&&(l=h.data),"usage"in h&&(e=h.usage));Array.isArray(l)||
f(l)&&Array.isArray(l.data)||"type"in h?t({type:h.type||(d?"uint32":"uint16"),usage:e,data:l}):t({usage:e,data:l});if(Array.isArray(l)||c(l))t.dimension=3}else t();d=v.buffer.byteLength;l=0;switch(v.buffer.dtype){case 5121:case 5120:l=5121;break;case 5123:case 5122:l=5123;d>>=1;break;case 5125:case 5124:l=5125,d>>=2}var e=4,n=v.buffer.dimension;1===n&&(e=0);2===n&&(e=1);3===n&&(e=4);"object"===typeof h&&("primitive"in h&&(e=a[h.primitive]),"count"in h&&(d=h.vertCount|0));v.primType=e;v.vertCount=
d;v.type=l;return z}var v=new e,t=l.create(null,34963,!0);v.buffer=t._buffer;z(h);z._reglType="elements";z._elements=v;z.destroy=function(){t.destroy();v.buffer=null};return z}e.prototype.bind=function(){this.buffer.bind()};return{create:n,createStream:function(a){return n({usage:"stream",data:a})._elements},destroyStream:function(a){l.destroyStream(a.buffer)},getElements:function(a){return"function"===typeof a&&a._elements instanceof e?a._elements:null}}}},{"./constants/primitives.json":6,"./util/is-ndarray":21,
"./util/is-typed-array":22}],10:[function(e,n,r){n.exports=function(c){function f(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(f){try{a[f]=
c.getExtension(f)}catch(e){}})}var a={};f();return{extensions:a,refresh:f}}},{}],11:[function(e,n,r){var c=e("./util/values"),f=e("./util/extend");n.exports=function(a,h,e,l,n){function z(a,d,c,f){this.target=a;this.level=d;this.texture=c;this.renderbuffer=f}function r(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function B(a,d){var c=d.width,f=d.height;if(a.texture)var h=a.texture._texture,l=Math.max(1,h.params.width>>a.level),e=Math.max(1,
h.params.height>>a.level),c=c||l,f=f||e;else h=a.renderbuffer._renderbuffer,c=c||h.width,f=f||h.height;h.refCount+=1;d.width=c;d.height=f}function v(d,c){c?c.texture?a.framebufferTexture2D(36160,d,c.target,c.texture._texture.texture,c.level):a.framebufferRenderbuffer(36160,d,36161,c.renderbuffer._renderbuffer.renderbuffer):a.framebufferTexture2D(36160,d,3553,null,0)}function t(a){var d=3553,c=0,f=null,h=null;"object"===typeof a&&("level"in a&&(c=a.level|0),"target"in a&&(d=a.target|0));var l=a._reglType;
"texture"===l?f=a:"renderbuffer"===l&&(h=a,d=36161,c=0);return new z(d,c,f,h)}function F(a){return a&&(a.texture||a.renderbuffer)}function d(){this.id=V++;H[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function u(d){a.isFramebuffer(d.framebuffer)||(d.framebuffer=a.createFramebuffer());L.dirty=!0;a.bindFramebuffer(36160,d.framebuffer);for(var c=
d.colorAttachments,f=0;f<c.length;++f)v(36064+f,c[f]);for(f=c.length;f<e.maxColorAttachments;++f)v(36064+f,null);v(36096,d.depthAttachment);v(36128,d.stencilAttachment);v(33306,d.depthStencilAttachment);h.webgl_draw_buffers&&h.webgl_draw_buffers.drawBuffersWEBGL(fa[c.length]);a.checkFramebufferStatus(36160)}function y(d){d=d.framebuffer;a.isFramebuffer(d)&&a.deleteFramebuffer(d)}var L={current:null,next:null,dirty:!1},aa={rgba:6408},A={rgba4:32854,rgb565:36194,"rgb5 a1":32855};h.ext_srgb&&(A.srgba=
35907);h.ext_color_buffer_half_float&&(A.rgba16f=34842,A.rgb16f=34843);h.webgl_color_buffer_float&&(A.rgba32f=34836);var W=[],ea=[];h.webgl_depth_texture&&(W.push(6402),ea.push(34041));f(f({},aa),A);c(aa);c(A);A=5121;W={uint8:5121};h.oes_texture_half_float&&(A=W["half float"]=36193);h.oes_texture_float&&(A=W["float"]=5126);W.best=A;var fa=function(){for(var a=Array(e.maxDrawbuffers),d=0;d<=e.maxDrawbuffers;++d)for(var c=a[d]=Array(d),f=0;f<d;++f)c[f]=36064+f;return a}(),V=0,H={};return f(L,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof d)?a:null},create:function(c){function f(d){var c,e=d||{},p=d=0;if("shape"in e){var v=e.shape;d=v[0];p=v[1]}else"radius"in e&&(d=p=e.radius),"width"in e&&(d=e.width),"height"in e&&(p=e.height);var y=null,v=!1;if("colorBuffers"in e||"colorBuffer"in e){y=e.colorBuffers||e.colorBuffer;Array.isArray(y)||(y=[y]);h.width=d;h.height=p;y=y.map(t);for(c=0;c<y.length;++c)B(y[c],h);d=h.width;p=h.height}else{var L=!0,w="rgba",A="uint8",H=1,
v=!0;h.width=d=d||a.drawingBufferWidth;h.height=p=p||a.drawingBufferHeight;"format"in e&&(w=e.format,L=w in aa);"type"in e&&(A=e.type);"colorCount"in e&&(H=e.colorCount|0);if(h.ownsColor)for(y=h.colorAttachments;y.length>H;)r(y.pop());else y=[];for(c=0;c<y.length;++c){var K;a:{K=y[c];var J=L,T=w,S=d,W=p;if(K.texture){var N=K.texture;if(J){N({format:T,type:A,width:S,height:W});N._texture.refCount+=1;K=!0;break a}}else if(N=K.renderbuffer,!J){N({format:T,width:S,height:W});N._renderbuffer.refCount+=
1;K=!0;break a}r(K);K=!1}K||(y[c--]=y[y.length-1],y.pop())}for(;y.length<H;)L?y.push(new z(3553,0,l.create({format:w,type:A,width:d,height:p},3553),null)):y.push(new z(36161,0,null,n.create({format:w,width:d,height:p})))}h.width=d;h.height=p;w=L=c=null;A=!1;"depthBuffer"in e&&(c=t(e.depthBuffer));"stencilBuffer"in e&&(L=t(e.stencilBuffer));"depthStencilBuffer"in e&&(w=t(e.depthStencilBuffer));if(c||L||w)B(c||L||w,h);else if(H=!0,J=K=!1,"depth"in e&&(H=!!e.depth),"stencil"in e&&(K=!!e.stencil),"depthTexture"in
e&&(J=!!e.depthTexture),e=h.depthAttachment||h.stencilAttachment||h.depthStencilAttachment,T=null,H||K)A=!0,J?(J=K?"depth stencil":"depth",h.ownsDepthStencil&&e.texture?(e.texture({format:J,width:d,height:p}),e.texture._texture.refCount+=1,T=e):T=new z(3553,0,l.create({format:J,width:d,height:p},3553),null)):(J=H?K?"depth stencil":"depth":"stencil",h.ownsDepthStencil&&e.renderbuffer?(e.renderbuffer({format:J,width:d,height:p}),e.renderbuffer._renderbuffer.refCount+=1,T=e):T=new z(36161,0,null,n.create({format:J,
width:d,height:p}))),H?K?w=T:c=T:L=T;d=h;d.colorAttachments.forEach(r);r(d.depthAttachment);r(d.stencilAttachment);r(d.depthStencilAttachment);h.colorAttachments=y;h.depthAttachment=c;h.stencilAttachment=L;h.depthStencilAttachment=w;h.ownsColor=v;h.ownsDepthStencil=A;f.color=y.map(F);f.depth=F(c);f.stencil=F(L);f.depthStencil=F(w);u(h);f.width=h.width;f.height=h.height;return f}var h=new d;f(c);f._reglType="framebuffer";f._framebuffer=h;f._destroy=function(){y(h)};return f},clear:function(){c(H).forEach(y)},
refresh:function(){c(H).forEach(u)}})}},{"./util/extend":20,"./util/values":28}],12:[function(e,n,r){n.exports=function(c,f){var a=1;f.ext_texture_filter_anisotropic&&(a=c.getParameter(34047));var h=1,e=1;f.webgl_draw_buffers&&(h=c.getParameter(34852),e=c.getParameter(36063));return{colorBits:[c.getParameter(3410),c.getParameter(3411),c.getParameter(3412),c.getParameter(3413)],depthBits:c.getParameter(3414),stencilBits:c.getParameter(3415),subpixelBits:c.getParameter(3408),extensions:Object.keys(f).filter(function(a){return!!f[a]}),
maxAnisotropic:a,maxDrawbuffers:h,maxColorAttachments:e,pointSizeDims:c.getParameter(33901),lineWidthDims:c.getParameter(33902),maxViewportDims:c.getParameter(3386),maxCombinedTextureUnits:c.getParameter(35661),maxCubeMapSize:c.getParameter(34076),maxRenderbufferSize:c.getParameter(34024),maxTextureUnits:c.getParameter(34930),maxTextureSize:c.getParameter(3379),maxAttributes:c.getParameter(34921),maxVertexUniforms:c.getParameter(36347),maxVertexTextureUnits:c.getParameter(35660),maxVaryingVectors:c.getParameter(36348),
maxFragmentUniforms:c.getParameter(36349),glsl:c.getParameter(35724),renderer:c.getParameter(7937),vendor:c.getParameter(7936),version:c.getParameter(7938)}}},{}],13:[function(e,n,r){var c=e("./util/is-typed-array");n.exports=function(f,a,h){return function(e){var l=e||{};c(e)?l={data:l}:2===arguments.length?l={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof e&&(l={});a();var n=l.x||0,z=l.y||0,r=l.width||h.viewportWidth,B=l.height||h.viewportHeight,l=l.data||new Uint8Array(r*B*4);f.pixelStorei(3333,
4);f.readPixels(n,z,r,B,6408,5121,l);return l}}},{"./util/is-typed-array":22}],14:[function(e,n,r){var c=e("./util/values");n.exports=function(f,a,h){function e(){this.id=r++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function l(a){f.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=f.createRenderbuffer());f.bindRenderbuffer(36161,a.renderbuffer);f.renderbufferStorage(36161,a.format,a.width,a.height)}function n(a){var c=a.renderbuffer;f.bindRenderbuffer(36161,
null);f.isRenderbuffer(c)&&f.deleteRenderbuffer(c);a.renderbuffer=null;a.refCount=0;delete B[a.id]}var z={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};a.ext_srgb&&(z.srgba=35907);a.ext_color_buffer_half_float&&(z.rgba16f=34842,z.rgb16f=34843);a.webgl_color_buffer_float&&(z.rgba32f=34836);var r=0,B={};e.prototype.decRef=function(){0===--this.refCount&&n(this)};return{create:function(a){function c(a){a=a||{};var h=0,e=0;"shape"in a?(e=a.shape,h=e[0]|0,e=
e[1]|0):("radius"in a&&(h=e=a.radius|0),"width"in a&&(h=a.width|0),"height"in a&&(e=a.height|0));c.width=f.width=Math.max(h,1);c.height=f.height=Math.max(e,1);f.format=32854;"format"in a&&(f.format=z[a.format]);l(f);return c}var f=new e;B[f.id]=f;c(a);c._reglType="renderbuffer";c._renderbuffer=f;c.destroy=function(){f.decRef()};return c},refresh:function(){c(B).forEach(l)},clear:function(){c(B).forEach(n)}}}},{"./util/values":28}],15:[function(e,n,r){var c=e("./util/values");n.exports=function(f,
a){function h(a,c,f,h){this.name=a;this.id=c;this.location=f;this.info=h}function e(a,c){for(var f=0;f<a.length;++f)if(a[f].id===c.id){a[f].location=c.location;return}a.push(c)}function l(d,c,h){h=35632===d?r:B;var e=h[c];if(!e){var l=a.str(c),e=f.createShader(d);f.shaderSource(e,l);f.compileShader(e);h[c]=e}return e}function n(a,c){this.id=F++;this.fragId=a;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[]}function z(d,c){var n,t;n=l(35632,d.fragId);t=l(35633,d.vertId);var v=d.program=
f.createProgram();f.attachShader(v,n);f.attachShader(v,t);f.linkProgram(v);var z=f.getProgramParameter(v,35718),r=d.uniforms;for(n=0;n<z;++n)if(t=f.getActiveUniform(v,n))if(1<t.size)for(var F=0;F<t.size;++F){var I=t.name.replace("[0]","["+F+"]");e(r,new h(I,a.id(I),f.getUniformLocation(v,I),t))}else e(r,new h(t.name,a.id(t.name),f.getUniformLocation(v,t.name),t));z=f.getProgramParameter(v,35721);r=d.attributes;for(n=0;n<z;++n)(t=f.getActiveAttrib(v,n))&&e(r,new h(t.name,a.id(t.name),f.getAttribLocation(v,
t.name),t))}var r={},B={},v={},t=[],F=0;return{clear:function(){var a=f.deleteShader.bind(f);c(r).forEach(a);r={};c(B).forEach(a);B={};t.forEach(function(a){f.deleteProgram(a.program)});t.length=0;v={}},refresh:function(){r={};B={};t.forEach(z)},program:function(a,c,f){var h=v[c];h||(h=v[c]={});var e=h[a];e||(e=new n(c,a),z(e,f),h[a]=e,t.push(e));return e},shader:l,frag:null,vert:null}}},{"./util/values":28}],16:[function(e,n,r){n.exports=function(){var c={"":0},f=[""];return{id:function(a){var h=
c[a];if(h)return h;h=c[a]=f.length;f.push(a);return h},str:function(a){return f[a]}}}},{}],17:[function(e,n,r){function c(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function f(a){if(!Array.isArray(a))return!1;var c=a.length;if(0===c||!Array.isArray(a[0]))return!1;for(var f=a[0].length,h=1;h<c;++h)if(!Array.isArray(a[h])||a[h].length!==f)return!1;return!0}function a(a){return Object.prototype.toString.call(a)}function h(d){return"[object HTMLCanvasElement]"===a(d)}function p(d){return"[object CanvasRenderingContext2D]"===
a(d)}var l=e("./util/extend"),I=e("./util/values"),z=e("./util/is-typed-array"),U=e("./util/is-ndarray"),B=e("./util/load-texture"),v=e("./util/to-half-float"),t=e("./util/parse-dds"),F=[9984,9986,9985,9987];n.exports=function(d,e,n,r,aa){function A(b){this.target=b;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=
this.miplevel=0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function W(b){this.target=b;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ea(b,a){var d,c,f=0,h=0,e=0,l=0,p=0,n=0,t=!1,v=!1,u=!1;for(d=0;d<a.length;++d)c=a[d],l=l||c.width<<c.miplevel,p=p||c.height<<c.miplevel,
f=f||c.type,h=h||c.format,e=e||c.internalformat,n=n||c.channels,t=t||c.needsPoll,v=v||c.needsListeners,c=c.miplevel,u=u||0<c;b.needsPoll=t;b.needsListeners=v;b.width=l;b.height=p;b.format=h;b.internalformat=e;b.type=f;if(3553!==b.target)for(d=0;6>d;++d);d=0<=F.indexOf(b.minFilter);b.genMipmaps=!u&&(b.genMipmaps||d);u=u||b.genMipmaps;b.minFilter||(b.minFilter=u?9987:9728);b.wrapS=b.wrapS||33071;b.wrapT=b.wrapT||33071;for(d=0;d<a.length;++d)c=a[d],c.channels||(c.channels=n),c.format||(c.format=h),c.internalformat||
(c.internalformat=e),c.type||(c.type=f)}function fa(a){this.id=T++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new W(a);this.pixels=[]}function V(a,c){function d(a,b){var k=b.mipmap,f;if(Array.isArray(k))for(var h=0;h<k.length;++h)f=new A(a),f.parseFlags(c),f.parseFlags(b),f.parse(k[h],h),e.push(f);else f=new A(a),f.parseFlags(c),f.parse(b,0),e.push(f)}var f;G(a);var h=a.params;W.call(h,a.target);var e=a.pixels;e.length=
0;h.parse(c);if(3553===a.target)d(3553,c);else{var l=c.faces||c;if(Array.isArray(l))for(f=0;6>f;++f)d(34069+f,l[f]);else if("string"!==typeof l)for(f=0;6>f;++f)d(34069+f,{})}ea(h,e);h.needsListeners&&w(a);h.needsPoll&&(a.pollId=Z.length,Z.push(a));H(a)}function H(a){d.isTexture(a.texture)||(a.texture=d.createTexture());var c=a.target,k=a.unit;0<=k?(d.activeTexture(33984+k),J=k):d.bindTexture(c,a.texture);for(var c=a.pixels,f=a.params,h=0;h<c.length;++h)c[h].upload(f);f.upload();0>k&&((k=O[J])?d.bindTexture(k.target,
k.texture):(a.unit=J,O[J]=a))}function w(a){function c(a,b,d){var k=t(d);k.pixels.forEach(function(c){var d=new A(k.cube?c.target:a);d.channels=k.channels;d.compressed=k.compressed;d.type=k.type;d.internalformat=k.format;d.format=K[k.format];d.width=c.width;d.height=c.height;d.miplevel=c.miplevel||b;d.data=c.data;h.push(d)})}function d(){for(var k=0;k<h.length;++k){var e=h[k],l=e.image,p=e.video,n=e.xhr;l&&l.complete?(e.width=l.naturalWidth,e.height=l.naturalHeight):p&&2<p.readyState?(e.width=p.width,
e.height=p.height):n&&4===n.readyState&&(h[k]=h[h.length-1],h.pop(),n.removeEventListener("readystatechange",H),c(e.target,e.miplevel,n.response))}ea(f,h);H(a)}var f=a.params,h=a.pixels;h.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",d):a.video&&1>a.readyState?a.video.addEventListener("progress",d):a.xhr&&a.xhr.addEventListener("readystatechange",d)});a.cancelPending=function(){h.forEach(function(a){a.image?a.image.removeEventListener("load",d):a.video?a.video.removeEventListener("progress",
d):a.xhr&&(a.xhr.removeEventListener("readystatechange",d),a.xhr.abort())})}}function G(a){var d=a.cancelPending;d&&(d(),a.cancelPending=null);d=a.pollId;0<=d&&((Z[d]=Z[Z.length-1]).id=d,Z.pop(),a.pollId=-1)}function ga(a){var c=a.texture,k=a.unit,f=a.target;0<=k&&(d.activeTexture(33984+k),J=k,d.bindTexture(f,null),O[k]=null);G(a);d.isTexture(c)&&d.deleteTexture(c);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete S[a.id]}var R={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
X={repeat:10497,clamp:33071,mirror:33648},ha={nearest:9728,linear:9729},M=l({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ha),P={none:0,browser:37444},E={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},C={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Q={};e.ext_srgb&&(C.srgb=35904,C.srgba=35906);e.oes_texture_float&&(E["float"]=5126);e.oes_texture_half_float&&
(E["half float"]=36193);e.webgl_depth_texture&&(l(C,{depth:6402,"depth stencil":34041}),l(E,{uint16:5123,uint32:5125,"depth stencil":34042}));e.webgl_compressed_texture_s3tc&&l(Q,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});e.webgl_compressed_texture_atc&&l(Q,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});e.webgl_compressed_texture_pvrtc&&l(Q,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});e.webgl_compressed_texture_etc1&&(Q["rgb etc1"]=36196);var da=Array.prototype.slice.call(d.getParameter(34467));Object.keys(Q).forEach(function(a){var d=Q[a];0<=da.indexOf(d)&&(C[a]=d)});var Y=Object.keys(C);n.textureFormats=Y;var K=Y.reduce(function(a,d){var c=C[d];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=d.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});l(A.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=P[a.colorSpace]);if("format"in a){var d=a.format;this.internalformat=C[d];d in E&&(this.type=E[d]);d in Q&&(this.compressed=!0)}"type"in a&&(this.type=E[a.type]);var d=this.width,c=this.height,f=this.channels;"shape"in a?(d=a.shape[0],c=a.shape[1],3===a.shape.length&&(f=a.shape[2])):("radius"in a&&(d=c=a.radius),"width"in a&&(d=a.width),
"height"in a&&(c=a.height),"channels"in a&&(f=a.channels));this.width=d|0;this.height=c|0;this.channels=f|0;"stride"in a?(d=a.stride,this.strideX=d[0],this.strideY=d[1],this.strideC=3===d.length?d[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*f,this.strideY=this.strideX*d);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(b,d){this.miplevel=d;this.width>>=d;this.height>>=d;var k=b;switch(typeof b){case "object":if(!b)return;
this.parseFlags(b);var e=b.data;if("string"===typeof e||e&&(z(e)||c(e)||U(e)||h(e)||p(e)||"[object HTMLImageElement]"===a(e)||"[object HTMLVideoElement]"===a(e)||f(e)))k=b.data;break;case "undefined":return}"string"===typeof k&&(k=B(k,this.crossOrigin));var e=null,l=!1;if(null!==k)if(z(k))this.data=k;else if(c(k))e=k,l=!0;else if(U(k)){Array.isArray(k.data)?(e=k.data,l=!0):this.data=k.data;var n=k.shape;this.width=n[0];this.height=n[1];this.channels=3===n.length?n[2]:1;n=k.stride;this.strideX=k.stride[0];
this.strideY=k.stride[1];this.strideC=3===n.length?k.stride[2]:1;this.offset=k.offset;this.needsTranspose=!0}else if(h(k)||p(k))h(k)?this.canvas=k:this.canvas=k.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===a(k))this.image=k,k.complete?(this.width=k.naturalWidth,this.height=k.naturalHeight):(this.width=this.width||k.naturalWidth,this.height=this.height||k.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===a(k))this.video=k,1<k.readyState?(this.width=k.width,this.height=k.height):(this.width=this.width||k.width,this.height=this.height||k.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===a(k))this.xhr=k,this.needsListeners=!0;else if(f(k)){var l=k[0].length,n=k.length,t=1,u,r,y,w;if(Array.isArray(k[0][0]))for(t=k[0][0].length,e=Array(l*n*t),r=w=0;r<n;++r)for(u=0;u<l;++u)for(y=0;y<t;++y)e[w++]=k[r][u][y];
else for(e=Array(l*n),r=w=0;r<n;++r)for(u=0;u<l;++u)e[w++]=k[r][u];this.width=l;this.height=n;this.channels=t;l=!0}else b.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||aa.viewportWidth)|0,this.height=(this.height||aa.viewportHeight)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=
[6409,6410,6407,6408][(this.channels=this.channels||4)-1]);k=this.internalformat;n=this.format=K[k];if(!this.channels)switch(n){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}n=this.type;5126!==n&&36193!==n&&(n||(n=6402===k?5125:5121));this.type=n;if(l)switch(n){case 5121:this.data=new Uint8Array(e);break;case 5123:this.data=new Uint16Array(e);break;case 5125:this.data=new Uint32Array(e);break;
case 5126:this.data=new Float32Array(e);break;case 36193:this.data=v(e)}if(this.data&&this.needsTranspose){e=this.data;k=this.width;l=this.height;n=this.channels;t=this.strideX;u=this.strideY;r=this.strideC;y=this.offset;w=new e.constructor(k*l*n);for(var F=0,I=0;I<l;++I)for(var G=0;G<k;++G)for(var A=0;A<n;++A)w[F++]=e[u*I+t*G+r*A+y];this.data=w}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){d.pixelStorei(37440,
this.flipY);d.pixelStorei(37441,this.premultiplyAlpha);d.pixelStorei(37443,this.colorSpace);d.pixelStorei(3317,this.unpackAlignment);var c=this.target,f=this.miplevel,e=this.image,h=this.canvas,l=this.video,p=this.data,n=this.internalformat,t=this.format,v=this.type,u=this.width||Math.max(1,a.width>>f);a=this.height||Math.max(1,a.height>>f);l&&2<l.readyState?d.texImage2D(c,f,t,t,v,l):e&&e.complete?d.texImage2D(c,f,t,t,v,e):h?d.texImage2D(c,f,t,t,v,h):this.compressed?d.compressedTexImage2D(c,f,n,u,
a,0,p):this.copy?(r(),d.copyTexImage2D(c,f,t,this.x,this.y,u,a,0)):p?d.texImage2D(c,f,t,u,a,0,t,v,p):d.texImage2D(c,f,t,u||1,a||1,0,t,v,null)}});l(W.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=M[a.min]);"mag"in a&&(this.magFilter=ha[a.mag]);var d=this.wrapS,c=this.wrapT;if("wrap"in a){var f=a.wrap;"string"===typeof f?d=c=X[f]:Array.isArray(f)&&(d=X[f[0]],c=X[f[1]])}else"wrapS"in a&&(d=X[a.wrapS]),"wrapT"in a&&(c=X[a.wrapT]);this.wrapS=d;this.wrapT=c;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=R[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;d.texParameteri(a,10241,this.minFilter);d.texParameteri(a,10240,this.magFilter);d.texParameteri(a,10242,this.wrapS);d.texParameteri(a,10243,this.wrapT);e.ext_texture_filter_anisotropic&&d.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(d.hint(33170,this.mipmapHint),d.generateMipmap(a))}});
var J=0,T=0,S={},Z=[],N=n.maxTextureUnits,O=Array(N).map(function(){return null});l(fa.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var c=0;c<N;++c){var f=O[c];if(f){if(0<f.bindCount)continue;f.unit=-1}O[c]=this;a=c;break}this.unit=a;d.activeTexture(33984+a);d.bindTexture(this.target,this.texture);J=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&ga(this)}});return{create:function(a,d){function c(a,b,e,h,l,p){var n=a||{};34067===d&&
6===arguments.length&&(n=[a,b,e,h,l,p]);V(f,n);c.width=f.params.width;c.height=f.params.height;return c}var f=new fa(d);S[f.id]=f;c(a);c._reglType="texture";c._texture=f;c.destroy=function(){f.decRef()};return c},refresh:function(){I(S).forEach(H);for(var a=0;a<N;++a)O[a]=null;J=0;d.activeTexture(33984)},clear:function(){for(var a=0;a<N;++a)d.activeTexture(33984+a),d.bindTexture(3553,null),O[a]=null;d.activeTexture(33984);J=0;I(S).forEach(ga)},poll:function(){Z.forEach(H)},getTexture:function(a){return null}}}},
{"./util/extend":20,"./util/is-ndarray":21,"./util/is-typed-array":22,"./util/load-texture":23,"./util/parse-dds":25,"./util/to-half-float":27,"./util/values":28}],18:[function(e,n,r){n.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],19:[function(e,n,r){function c(a){return Array.prototype.slice.call(a)}function f(a){return c(a).join("")}var a=e("./extend");n.exports=function(){function e(){var h=[],p=[];return a(function(){h.push.apply(h,
c(arguments))},{def:function(){var a="v"+l++;p.push(a);0<arguments.length&&(h.push(a,"="),h.push.apply(h,c(arguments)),h.push(";"));return a},toString:function(){return f([0<p.length?"var "+p+";":"",f(h)])}})}function p(){function c(a,d){l(a,d,"=",f.def(a,d),";")}var f=e(),l=e(),d=f.toString,p=l.toString;return a(f,{entry:f,exit:l,save:c,set:function(a,d,e){c(a,d);f(a,d,"=",e,";")},toString:function(){return d()+p()}})}var l=0,n=[],r=[],U=e(),B={};return{global:U,link:function(a){for(var c=0;c<r.length;++c)if(r[c]===
a)return n[c];c="g"+l++;n.push(c);r.push(a);return c},block:e,proc:function(c,e){function h(){var a="a"+d.length;d.push(a);return a}var d=[];e=e||0;for(var l=0;l<e;++l)h();var l=p(),n=l.toString;return B[c]=a(l,{arg:h,toString:function(){return f(["function(",d.join(),"){",n(),"}"])}})},scope:p,cond:function(){var e=f(arguments),h=p(),l=p(),d=h.toString,n=l.toString;return a(h,{then:function(){h.apply(h,c(arguments));return this},"else":function(){l.apply(l,c(arguments));return this},toString:function(){var a=
n();a&&(a="else{"+a+"}");return f(["if(",e,"){",d(),"}",a])}})},compile:function(){var a=['"use strict";',U,"return {"];Object.keys(B).forEach(function(c){a.push('"',c,'":',B[c].toString(),",")});a.push("}");var c=f(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(c)).apply(null,r)}}}},{"./extend":20}],20:[function(e,n,r){n.exports=function(c,f){for(var a=Object.keys(f),e=0;e<a.length;++e)c[a[e]]=f[a[e]];return c}},{}],21:[function(e,n,r){var c=e("./is-typed-array");
n.exports=function(f){return!!f&&"object"===typeof f&&Array.isArray(f.shape)&&Array.isArray(f.stride)&&"number"===typeof f.offset&&f.shape.length===f.stride.length&&(Array.isArray(f.data)||c(f.data))}},{"./is-typed-array":22}],22:[function(e,n,r){var c=e("../constants/arraytypes.json");n.exports=function(f){return Object.prototype.toString.call(f)in c}},{"../constants/arraytypes.json":4}],23:[function(e,n,r){n.exports=function(c,f){if("undefined"!==typeof document){var a;a=(a=/\.(\w+)(\?.*)?$/.exec(c))&&
a[1]?a[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(a))return a=document.createElement("video"),a.autoplay=!0,a.loop=!0,f&&(a.crossOrigin=f),a.src=c,a;if(0<=["dds"].indexOf(a))return a=new XMLHttpRequest,a.responseType="arraybuffer",a.open("GET",c,!0),a.send(),a;a=new Image;f&&(a.crossOrigin=f);a.src=c;return a}return null}},{}],24:[function(e,n,r){n.exports=function(c,f){for(var a=Array(c),e=0;e<c;++e)a[e]=f(e);return a}},
{}],25:[function(e,n,r){n.exports=function(e){function n(a){for(var c=R,d=X,f=0;f<C;++f){var h=Math.max(1,c+3>>2)*Math.max(1,d+3>>2)*P;da.pixels.push({target:a,miplevel:f,width:c,height:d,data:new Uint8Array(e,Q,h)});Q+=h;c>>=1;d>>=1}}var r=new Int32Array(e),ga=r[L],R=r[A],X=r[aa],ha=z,M=0,P=0,E=4;switch(r[fa]){case t:P=8;ga&v?(E=3,M=a):M=h;break;case F:P=16;M=p;break;case d:P=16;M=l;break;case u:P=8,M=I}var C=1;r[ea]&U&&(C=Math.max(1,r[W]));var Q=r[y]+4,da={width:R,height:X,channels:E,format:M,type:ha,
compressed:!0,cube:!1,pixels:[]};if(r[V]&B)for(da.cube=!0,r=0;6>r;++r)n(f+r);else n(c);return da};var c=3553,f=34069,a=33776,h=33777,p=33778,l=33779,I=36196,z=5121,U=131072,B=512,v=64,t=827611204,F=861165636,d=894720068,u=826496069,y=1,L=2,aa=3,A=4,W=7,ea=20,fa=21,V=28},{}],26:[function(e,n,r){n.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(c){return requestAnimationFrame(c)},cancel:function(c){return cancelAnimationFrame(c)}}:{next:function(c){setTimeout(c,
30)},cancel:clearTimeout}},{}],27:[function(e,n,r){n.exports=function(c){for(var f=new Float32Array(c),f=new Uint32Array(f.buffer),a=new Uint16Array(c.length),e=0;e<c.length;++e)if(isNaN(c[e]))a[e]=65535;else if(Infinity===c[e])a[e]=31744;else if(-Infinity===c[e])a[e]=64512;else{var p=f[e],l=p>>>31<<15,n=(p<<1>>>24)-127,p=p>>13&1023;a[e]=-24>n?l:-14>n?l+(p+1024>>-14-n):15<n?l+31744:l+(n+15<<10)+p}return a}},{}],28:[function(e,n,r){n.exports=function(c){return Object.keys(c).map(function(f){return c[f]})}},
{}],29:[function(e,n,r){function c(c,e){function l(){var f=window.innerWidth,e=window.innerHeight;c!==document.body&&(e=c.getBoundingClientRect(),f=e.right-e.left,e=e.top-e.bottom);n.width=U*f;n.height=U*e;a(n.style,{width:f+"px",height:e+"px"})}var n=document.createElement("canvas"),r=f(n,e);a(n.style,{border:0,margin:0,padding:0,top:0,left:0});c.appendChild(n);c===document.body&&(n.style.position="absolute",a(c.style,{margin:0,padding:0}));var U=+r.options.pixelRatio;window.addEventListener("resize",
l,!1);var B=r.options.onDestroy;r.options=a(a({},r.options),{onDestroy:function(){window.removeEventListener("resize",l);c.removeChild(n);B&&B()}});l();return r}function f(c,e){function f(a){try{return c.getContext(a,n)}catch(e){return null}}var n=e.glOptions||{};return{gl:f("webgl")||f("experimental-webgl")||f("webgl-experimental"),options:a({pixelRatio:window.devicePixelRatio},e)}}var a=e("./util/extend");n.exports=function(e){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:e[0],
options:e[1]||{}};var n=document.body,l=e[1]||{};if("string"===typeof e[0])n=document.querySelector(e[0])||document.body;else if("object"===typeof e[0])if(e[0]instanceof HTMLElement)n=e[0];else{if(e[0]instanceof WebGLRenderingContext)return{gl:e[0],options:a({pixelRatio:1},l)};l=e[0]}return n.nodeName&&"CANVAS"===n.nodeName.toUpperCase()?f(n,l):c(n,l)}},{"./util/extend":20}],30:[function(e,n,r){var c=e("./lib/util/extend"),f=e("./lib/dynamic"),a=e("./lib/util/raf"),h=e("./lib/util/clock"),p=e("./lib/strings"),
l=e("./lib/webgl"),I=e("./lib/extension"),z=e("./lib/limits"),U=e("./lib/buffer"),B=e("./lib/elements"),v=e("./lib/texture"),t=e("./lib/renderbuffer"),F=e("./lib/framebuffer"),d=e("./lib/attribute"),u=e("./lib/shader"),y=e("./lib/read"),L=e("./lib/core");n.exports=function(){function e(){b=a.next(e);E.count+=1;var c=Z.viewport,d=Z.scissor_box;c[0]=c[1]=d[0]=d[1]=0;E.viewportWidth=E.frameBufferWidth=E.drawingBufferWidth=c[2]=d[2]=w.drawingBufferWidth;E.viewportHeight=E.frameBufferWidth=E.drawingBufferHeight=
c[3]=d[3]=w.drawingBufferHeight;c=h();E.deltaTime=(c-ha)/1E3;E.time=(c-X)/1E3;ha=c;S.procs.refresh();Y.poll();for(c=0;c<O.length;++c)(0,O[c])(E,null,0)}function n(){b&&(a.cancel(e),b=0)}function r(a){n();a.preventDefault();if(G.onContextLost)G.onContextLost()}function ea(a){w.getError();ga.refresh();S.procs.refresh();C.refresh();Y.refresh();K.refresh();J.refresh();da.refresh();if(G.onContextRestored)G.onContextRestored();e()}function fa(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=
a[b];f.isDynamic(e)?d[b]=f.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function d(a){for(;t.length<a;)t.push(null);return t}var e=b(a.context||{}),h=b(a.uniforms||{}),l=b(a.attributes||{});a=b(function(a){function b(a){if(a in d){var c=d[a];delete d[a];Object.keys(c).forEach(function(b){d[a+"."+b]=c[b]})}}var d=c({},a);delete d.uniforms;delete d.attributes;delete d.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return d}(a));var e=S.compile(a,
l,h,e),n=e.draw,p=e.batch,r=e.scope,t=[];return function(a,b){var c;if("function"===typeof a)return r.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(c=0;c<a;++c)r.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)r.call(this,a[c],b,c);else return r.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return n.call(this,a)}}function V(){S.procs.poll()}
var H=l(Array.prototype.slice.call(arguments)),w=H.gl,G=H.options,H=p(),ga=I(w),R=ga.extensions,X=h(),ha=X,M=w.drawingBufferWidth,P=w.drawingBufferHeight,E={count:0,deltaTime:0,time:0,viewportWidth:M,viewportHeight:P,framebufferWidth:M,framebufferHeight:P,drawingBufferWidth:M,drawingBufferHeight:P,pixelRatio:G.pixelRatio},M=z(w,R),C=U(w),Q=B(w,R,C),P=d(w,R,M,C,H),da=u(w,H),Y=v(w,R,M,V,E),K=t(w,R,M),J=F(w,R,M,Y,K),T=y(w,V,E),S=L(w,H,R,M,C,Q,Y,J,{},P,da,{elements:null,primitive:4,count:-1,offset:0,
instances:-1},E),Z=S.next,N=w.canvas,O=[],b=0;N&&(N.addEventListener("webglcontextlost",r,!1),N.addEventListener("webglcontextrestored",ea,!1));S.procs.refresh();return c(fa,{clear:function(a){var b=0;V();var c=a.color;c&&(w.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(w.clearDepth(+a.depth),b|=256);"stencil"in a&&(w.clearStencil(a.stencil|0),b|=1024);w.clear(b)},prop:f.define.bind(null,1),context:f.define.bind(null,2),"this":f.define.bind(null,3),draw:fa({}),elements:function(a){return Q.create(a)},
buffer:function(a){return C.create(a,34962)},texture:function(a){return Y.create(a,3553)},cube:function(a){return 6===arguments.length?Y.create(Array.prototype.slice.call(arguments),34067):Y.create(a,34067)},renderbuffer:function(a){return K.create(a)},framebuffer:function(a){return J.create(a)},framebufferCube:function(a){},attributes:w.getContextAttributes(),frame:function(a){O.push(a);!b&&0<O.length&&e();return{cancel:function(){var b=O.find(function(b){return b===a});0>b||(O.splice(b,1),0>=O.length&&
n())}}},limits:M,read:T,destroy:function(){n();N&&(N.removeEventListener("webglcontextlost",r),N.removeEventListener("webglcontextrestored",ea));da.clear();J.clear();K.clear();Y.clear();C.clear();if(G.onDestroy)G.onDestroy()},_gl:w,_refresh:function(){S.procs.refresh()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":7,"./lib/dynamic":8,"./lib/elements":9,"./lib/extension":10,"./lib/framebuffer":11,"./lib/limits":12,"./lib/read":13,"./lib/renderbuffer":14,"./lib/shader":15,"./lib/strings":16,
"./lib/texture":17,"./lib/util/clock":18,"./lib/util/extend":20,"./lib/util/raf":26,"./lib/webgl":29}]},{},[1]);

        </script>
        </body>
      </html>