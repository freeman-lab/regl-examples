<!DOCTYPE html>
      <html>
        <head>
          <title>example/life.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(f,h,b){function m(a,e){if(!h[a]){if(!f[a]){var l="function"==typeof require&&require;if(!e&&l)return l(a,!0);if(c)return c(a,!0);l=Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l;}l=h[a]={exports:{}};f[a][0].call(l.exports,function(b){var e=f[a][1][b];return m(e?e:b)},l,l.exports,e$$0,f,h,b)}return h[a].exports}for(var c="function"==typeof require&&require,a=0;a<b.length;a++)m(b[a]);return m})({1:[function(d,f,h){var b=d("../regl")(),m=Array(1048576).fill(0).map(function(){return.9<
Math.random()?255:0}),c=Array(2).fill().map(function(){return b.framebuffer({colorBuffer:b.texture({radius:512,data:m,wrap:"repeat"}),depth:!1})}),a=b({frag:"\n  precision mediump float;\n  uniform sampler2D prevState;\n  varying vec2 uv;\n  void main() {\n    float n = 0.0;\n    for(int dx=-1; dx<=1; ++dx)\n    for(int dy=-1; dy<=1; ++dy) {\n      n += texture2D(prevState, uv+vec2(dx,dy)/float(512)).r;\n    }\n    float s = texture2D(prevState, uv).r;\n    if(n > 3.0+s || n < 3.0) {\n      gl_FragColor = vec4(0,0,0,1);\n    } else {\n      gl_FragColor = vec4(1,1,1,1);\n    }\n  }",
framebuffer:function(a,b,n){return c[(n.count+1)%2]}}),n=b({frag:"\n  precision mediump float;\n  uniform sampler2D prevState;\n  varying vec2 uv;\n  void main() {\n    float state = texture2D(prevState, uv).r;\n    gl_FragColor = vec4(vec3(state), 1);\n  }",vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main() {\n    uv = 0.5 * (position + 1.0);\n    gl_Position = vec4(position, 0, 1);\n  }",attributes:{position:b.buffer([-4,-4,4,-4,0,4])},uniforms:{prevState:function(a,
b,n){return c[n.count%2].color[0]}},depth:{enable:!1},count:3});b.frame(function(){n(function(){b.draw();a()})})},{"../regl":34}],2:[function(d,f,h){function b(){this.pointer=!1;this.w=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}var m=d("./constants/dtypes.json"),c=d("./extend");c(b.prototype,{equals:function(a,b){return this.pointer?a.pointer&&this.buffer===a.buffer&&this.size===b&&this.normalized===a.normalized&&this.type===
a.type&&this.offset===a.offset&&this.stride===a.stride&&this.divisor===a.divisor:!a.pointer&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},set:function(a,b){(this.pointer=a.pointer)?(this.buffer=a.buffer,this.size=b,this.normalized=a.normalized,this.type=a.type,this.offset=a.offset,this.stride=a.stride,this.divisor=a.divisor):(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w)}});f.exports=function(a,n,e,l,d){function F(){for(var a=Array(16),n=0;16>n;++n)a[n]=new b;this.records=a;this.top=0}function f(a){for(var n=
a.records,e=a.top;n.length-1<=e;)n.push(new b);return n[++a.top]}var A={};e=e.maxAttributes;for(var r=Array(e),q=0;q<e;++q)r[q]=new b;c(F.prototype,{pushVec:function(a,b,n,e){var c=f(this);c.pointer=!1;c.x=a;c.y=b;c.z=n;c.w=e},pushPtr:function(a,b,n,e,c,r,m){var l=f(this);l.pointer=!0;l.buffer=a;l.size=b;l.offset=n;l.stride=e;l.divisor=c;l.normalized=r;l.type=m},pushDyn:function(a){if("number"===typeof a)this.pushVec(a,0,0,0);else if(Array.isArray(a))this.pushVec(a[0],a[1],a[2],a[3]);else{var b=l.getBuffer(a),
n=0,e=0,c=0,r=0,q=!1,d=5126;b?d=b.dtype:(b=l.getBuffer(a.buffer),n=a.size||0,e=a.stride||0,c=a.offset||0,r=a.divisor||0,q=a.normalized||!1,d=b.dtype,"type"in a&&(d=m[a.type]));this.pushPtr(b,n,c,e,r,q,d)}},pop:function(){--this.top}});return{bindings:r,bind:function(b,e,c,r){r=c.size||r;if(!e.equals(c,r)){if(c.pointer){e.pointer||a.enableVertexAttribArray(b);e.buffer!==c.buffer&&c.buffer.bind();a.vertexAttribPointer(b,r,c.type,c.normalized,c.stride,c.offset);var l=n.angle_instanced_arrays;l&&l.vertexAttribDivisorANGLE(b,
c.divisor)}else e.pointer&&a.disableVertexAttribArray(b),a.vertexAttrib4f(b,c.x,c.y,c.z,c.w);e.set(c,r)}},def:function(a){a=d.id(a);var b=A[a];b||(b=A[a]=new F);return b}}}},{"./constants/dtypes.json":9,"./extend":15}],3:[function(d,f,h){function b(a,b){switch(a){case 5121:return new Uint8Array(b);case 5123:return new Uint16Array(b);case 5125:return new Uint32Array(b);case 5120:return new Int8Array(b);case 5122:return new Int16Array(b);case 5124:return new Int32Array(b);case 5126:return new Float32Array(b);
default:return null}}var m=d("./check"),c=d("./is-typed-array"),a=d("./is-ndarray"),n=d("./constants/arraytypes.json"),e=d("./constants/dtypes.json"),l=d("./values"),Q={"static":35044,dynamic:35048,stream:35040};f.exports=function(d){function f(a,b){this.id=q++;this.buffer=a;this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function A(a){d.isBuffer(a.buffer)||(a.buffer=d.createBuffer());a.bind();d.bufferData(a.type,a.data||a.byteLength,a.usage)}function r(a){var b=
a.buffer;m(b,"buffer must not be deleted already");d.isBuffer(b)&&d.deleteBuffer(b);a.buffer=null;delete z[a.id]}var q=0,z={};f.prototype.bind=function(){d.bindBuffer(this.type,this.buffer)};return{create:function(k,l,q){function t(r){var k=r||{};if(Array.isArray(k)||c(k)||a(k))k={data:k};else if("number"===typeof k)k={length:k|0};else if(null===k||void 0===k)k={};m.type(k,"object","buffer arguments must be an object, a number or an array");"usage"in k?(m.parameter(k.usage,Q,"invalid buffer usage"),
h.usage=Q[k.usage]):h.usage=35044;r=0;"type"in k&&(m.parameter(k.type,e,"invalid buffer type"),r=e[k.type]);var l=k.dimension|0||1,d=0,q=null;if("data"in k)if(q=k.data,null===q)d=k.length|0;else{if(a(q)){var l=q.shape,d=q.stride,k=q.offset,O=0,f=0,z=0,u=0;1===l.length?(O=l[0],f=1,z=d[0],u=0):2===l.length?(O=l[0],f=l[1],z=d[0],u=d[1]):m.raise("invalid shape");r=r||n[Object.prototype.toString.call(q)]|0||5126;for(var l=f,d=b(r,O*f),q=q.data,F=0,ma=0;ma<O;++ma)for(var X=0;X<f;++X)d[F++]=q[z*ma+u*X+k];
q=d}else if(Array.isArray(q))if(0<q.length&&Array.isArray(q[0])){l=q[0].length;r=r||5126;k=b(r,q.length*l);d=q;q=l;for(O=u=0;O<d.length;++O)for(z=d[O],f=0;f<q;++f)k[u++]=z[f];q=k}else r=r||5126,q=b(r,q);else m.isTypedArray(q,"invalid data type buffer data"),r=r||n[Object.prototype.toString.call(q)]|0;d=q.byteLength}else"length"in k&&(d=k.length|0,m.nni(d,"buffer length must be a nonnegative integer"));h.data=q;h.dtype=r||5121;h.byteLength=d;h.dimension=l;A(h);return t}var ea=d.createBuffer(),h=new f(ea,
l);z[h.id]=h;q||t(k);t._reglType="buffer";t._buffer=h;t.destroy=function(){r(h)};return t},clear:function(){l(z).forEach(r)},refresh:function(){l(z).forEach(A)},getBuffer:function(a){return a&&a._buffer instanceof f?a._buffer:null}}}},{"./check":4,"./constants/arraytypes.json":8,"./constants/dtypes.json":9,"./is-ndarray":18,"./is-typed-array":19,"./values":33}],4:[function(d,f,h){function b(a){a=Error("(regl) "+a);console.error(a);throw a;}function m(a,n){a||b(n)}var c=d("./is-typed-array");d=d("./extend");
f.exports=d(m,{raise:b,parameter:function(a,n,c){a in n||b("unknown parameter ("+a+")"+(c?": "+c:"")+". possible values: "+Object.keys(n).join())},type:function(a,n,c){typeof a!==n&&b("invalid parameter type"+(c?": "+c:"")+". expected "+n+", got "+typeof a)},isTypedArray:function(a,n){c(a)||b("invalid parameter type"+(n?": "+n:"")+". must be a typed array")},nni:function(a,c){0<=a&&(a|0)===a||b("invalid parameter type, ("+a+")"+(c?": "+c:"")+". must be a nonnegative integer")},oneOf:function(a,c,
e){0>c.indexOf(a)&&b("invalid value"+(e?": "+e:"")+". must be one of: "+c)},shaderError:function(a,b,c,l){a.getShaderParameter(b,a.COMPILE_STATUS)||(a=a.getShaderInfoLog(b),m.raise("Error compiling shader:\n"+a))},linkError:function(a,b){if(!a.getProgramParameter(b,a.LINK_STATUS)){var c=a.getProgramInfoLog(b);m.raise("Error linking program:\n"+c)}}})},{"./extend":15,"./is-typed-array":19}],5:[function(d,f,h){f.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:
function(){return+new Date}},{}],6:[function(d,f,h){var b=d("./extend");f.exports=function(){function d(){var a=[],n=[];return b(function(){a.push.apply(a,Array.prototype.slice.call(arguments))},{def:function(){var b="v"+c++;n.push(b);0<arguments.length&&(a.push(b,"="),a.push.apply(a,Array.prototype.slice.call(arguments)),a.push(";"));return b},toString:function(){return[0<n.length?"var "+n+";":"",a.join("")].join("")}})}var c=0,a=[],n=[],e={};return{link:function(b){var e="g"+c++;a.push(e);n.push(b);
return e},block:d,proc:function(a){var n=[],f=d(),h=f.toString;return e[a]=b(f,{arg:function(){var a="a"+c++;n.push(a);return a},toString:function(){return["function(",n.join(),"){",h(),"}"].join("")}})},compile:function(){var b=['"use strict";return {'];Object.keys(e).forEach(function(a){b.push('"',a,'":',e[a].toString(),",")});b.push("}");return Function.apply(null,a.concat([b.join("")])).apply(null,n)}}}},{"./extend":15}],7:[function(d,f,h){function b(a){switch(a){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function m(a,b,c,e){var d,l=",";switch(b){case 5126:d="1f";break;case 35664:d="2fv";break;case 35665:d="3fv";break;case 35666:d="4fv";break;case 35670:case 5124:d="1i";break;case 35671:case 35667:d="2iv";break;case 35672:case 35668:d="3iv";break;case 35673:case 35669:d="4iv";break;case 35674:d="Matrix2fv";l=",false,";break;case 35675:d="Matrix3fv";l=",false,";break;case 35676:d="Matrix4fv";l=",false,";
break;default:n.raise("unsupported uniform type")}return a+".uniform"+d+"("+c+l+e+");"}function c(a){return a+"["+a+".length-1]"}function a(a,b){return"framebuffer"===a||a<b?-1:a>b?1:0}var n=d("./check"),e=d("./codegen"),l=d("./constants/primitives.json"),Q=d("./constants/dtypes.json"),F={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,
"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},N={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},A={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};f.exports=function(d,q,f,k,O,u,h,ea,W,fa,ga,T,ca,ka,oa){function ha(k,q,O,Q,h){function t(a){var b=
pa[a];return b?b:b=pa[a]=v(la[a])}function U(a){var b=a.id,w=S[b];if(w)return w;w=a.func?p.def(v(a.data),"(",ra,",",G,",",I,")"):p.def(ra,".",a.data);return S[b]=w}function Y(a,b){return a.find(function(a){return a.name===b})}function L(a){return na&&!(a in q||a in h)}var J=e(),v=J.link,p=J.proc("batch"),C=J.block(),D=p.def,aa=p.arg,g=v(d),H=v(k.program),E=v(ga.bind),I=v(ka),ja=v(ea),B=v(ca.count),P=v(ca.offset),ta=v(ca.instances),V=v(ca.primitive),pa={},da=v(u.elements),B=D(c(B)),P=D(c(P)),V=D(c(V)),
da=D(c(da)),x,M,K=f.angle_instanced_arrays;K&&(x=D(c(ta)),M=v(K));var na="elements"in q,ta=aa(),aa=aa(),ra=D(),G=D(),S={};p(g,".useProgram(",H,");");k.uniforms.forEach(function(a){if(!(a.name in O)){var b=v(a.location),w=v(fa.def(a.name)),w=w+"["+w+".length-1]";a=a.info.type;35678===a||35680===a?(a=D(w+"._texture"),p(m(g,5124,b,a+".bind()")),C(a,".unbind();")):p(m(g,a,b,w))}});k.attributes.forEach(function(a){if(!(Q.name in Q)){var g=v(ga.def(a.name));p(E,"(",a.location,",",v(ga.bindings[a.location]),
",",g,".records[",g,".top]",",",b(a.info.type),");")}});na||p("if(",da,"){",g,".bindBuffer(",34963,",",da,".buffer.buffer);","}else{",g,".bindBuffer(",34963,",null);","}");p("for(",G,"=0;",G,"<",ta,";++",G,"){",ra,"=",aa,"[",G,"];");Object.keys(q).sort(a).forEach(function(a){function b(a){p("if(",w,"){",g,".enable(",a,");}else{",g,".disable(",a,");}")}var w=U(q[a]);switch(a){case "framebuffer":a=t("viewport");var c=t("scissor.box");p("if(",ja,".push(",w,"&&",w,"._framebuffer)){",ja,".poll();",a,".setDirty();",
c,".setDirty();","}");break;case "cull.enable":b(2884);break;case "blend.enable":b(3042);break;case "dither":b(3024);break;case "stencil.enable":b(2960);break;case "depth.enable":b(2929);break;case "scissor.enable":b(3089);break;case "polygonOffset.enable":b(32823);break;case "sample.alpha":b(32926);break;case "sample.enable":b(32928);break;case "depth.mask":p(g,".depthMask(",w,");");break;case "depth.func":a=v(N);p(g,".depthFunc(",a,"[",w,"]);");break;case "depth.range":p(g,".depthRange(",w,"[0],",
w,"[1]);");break;case "blend.color":p(g,".blendColor(",w,"[0],",w,"[1],",w,"[2],",w,"[3]);");break;case "blend.equation":a=v(y);p("if(typeof ",w,'==="string"){',g,".blendEquation(",a,"[",w,"]);","}else{",g,".blendEquationSeparate(",a,"[",w,".rgb],",a,"[",w,".alpha]);","}");break;case "blend.func":a=v(F);p(g,".blendFuncSeparate(",a,'["srcRGB" in ',w,"?",w,".srcRGB:",w,".src],",a,'["dstRGB" in ',w,"?",w,".dstRGB:",w,".dst],",a,'["srcAlpha" in ',w,"?",w,".srcAlpha:",w,".src],",a,'["dstAlpha" in ',w,
"?",w,".dstAlpha:",w,".dst]);");break;case "stencil.mask":p(g,".stencilMask(",w,");");break;case "stencil.func":a=v(N);p(g,".stencilFunc(",a,"[",w,'.cmp||"always"],',w,".ref|0,",'"mask" in ',w,"?",w,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":c=v(A);p(g,".stencilOpSeparate(","stencil.opFront"===a?1028:1029,",",c,"[",w,'.fail||"keep"],',c,"[",w,'.zfail||"keep"],',c,"[",w,'.pass||"keep"]);');break;case "polygonOffset.offset":p(g,".polygonOffset(",w,".factor||0,",w,".units||0);");
break;case "cull.face":p(g,".cullFace(",w,'==="front"?',1028,":",1029,");");break;case "lineWidth":p(g,".lineWidth(",w,");");break;case "frontFace":p(g,".frontFace(",w,'==="cw"?',2304,":",2305,");");break;case "colorMask":p(g,".colorMask(",w,"[0],",w,"[1],",w,"[2],",w,"[3]);");break;case "sample.coverage":p(g,".sampleCoverage(",w,".value,",w,".invert);");break;case "scissor.box":case "viewport":a=t(a);p(a,".push(",w,".x||0,",w,".y||0,",w,".w||-1,",w,".h||-1);");break;case "primitives":case "offset":case "count":case "elements":break;
default:n.raise("unsupported option for batch",a)}});("viewport"in q||"framebuffer"in q)&&p(t("viewport"),".poll();");("scissor.box"in q||"framebuffer"in q)&&p(t("scissor.box"),".poll();");"framebuffer"in q&&p(ja,".pop();");var T=k.uniforms,W=[];Object.keys(O).forEach(function(a){var b=Y(T,a);if(b){var w=b.info.type,c=v(b.location);a=U(O[a]);35678===b.info.type||35680===b.info.type?(b=D(a+"._texture"),W.push(b),p(m(g,5124,c,b+".bind()"))):p(m(g,w,c,a))}});W.forEach(function(a){p(a,".unbind();")});
var ha=k.attributes;Object.keys(Q).forEach(function(a){var g=Y(ha,a);g&&p(E,"(",g.location,",",v(a.bindings[g.location]),",",U(Q[a]),",",b(g.info.type),");")});q.count?p(B,"=",U(q.count),";"):L("count")||p("if(",B,"){");q.offset&&p(P,"=",U(q.offset),";");q.primitive&&(k=v(l),p(V,"=",k,"[",U(q.primitive),"];"));na&&(k=U(q.elements),p(da,"=",k,"?",k,"._elements:null;"));L("offset")&&p(P,"=0;");p("if(",da,"){");L("count")&&p(B,"=",da,".vertCount;","if(",B,">0){");L("primitive")&&p(V,"=",da,".primType;");
na&&p(g,".bindBuffer(",34963,",",da,".buffer.buffer);");K&&(q.instances&&p(x,"=",U(q.instances),";"),p("if(",x,">0){",M,".drawElementsInstancedANGLE(",V,",",B,",",da,".type,",P,",",x,");}else{"));p(g,".drawElements(",V,",",B,",",da,".type,",P,");");K&&p("}");L("count")&&p("}");p("}else{");L("count")||(L("primitive")&&p(V,"=",4,";"),K&&p("if(",x,">0){",M,".drawArraysInstancedANGLE(",V,",",P,",",B,",",x,");}else{"),p(g,".drawArrays(",V,",",P,",",B,");}"),K&&p("}"));p("}}",C);return J.compile().batch}
var la=W.contextState,y={add:32774,subtract:32778,"reverse subtract":32779};f.ext_blend_minmax&&(y.min=32775,y.max=32776);var K=0;return{draw:function(a){var n=e(),k=n.link,q=n.proc("draw"),l=q.def,O=k(d),Q=k(a.program),F=k(ga.bind),L=k(ca.count),J=k(ca.offset),v=k(ca.instances),p=k(ca.primitive),C=k(u.elements),D=[];q(O,".useProgram(",Q,");");a.attributes.forEach(function(a){var g=k(ga.def(a.name));q(F,"(",a.location,",",k(ga.bindings[a.location]),",",g,".records[",g,".top]",",",b(a.info.type),");")});
a.uniforms.forEach(function(a){var b=k(a.location),c=k(fa.def(a.name)),c=c+"["+c+".length-1]";a=a.info.type;35678===a||35680===a?(a=l(c+"._texture"),D.push(a),q(m(O,5124,b,a+".bind()"))):q(m(O,a,b,c))});D.forEach(function(a){q(a,".unbind();")});a=l(c(p));L=l(c(L));J=l(c(J));C=l(c(C));q("if(",L,"){");(Q=f.angle_instanced_arrays)?(v=l(c(v)),Q=k(Q),q("if(",C,"){",C,".bind();","if(",v,">0){",Q,".drawElementsInstancedANGLE(",a,",",L,",",C,".type,",J,",",v,");}else{",O,".drawElements(",a,",",L,",",C,".type,",
J,");}","}else if(",v,">0){",Q,".drawArraysInstancedANGLE(",a,",",J,",",L,",",v,");}else{",O,".drawArrays(",a,",",J,",",L,");}}")):q("if(",C,"){",O,".drawElements(",a,",",L,",",C,".type,",J,");}","}else{",O,".drawArrays(",a,",",J,",",L,");}");return n.compile().draw},command:function(b,d,r,m,f,z,h){function t(a){var b=da[a];return b?b:b=da[a]=p(la[a])}function L(a,b){var g=t(a);x(g,".push(",b,");");M(g,".pop();")}function J(a){var b=a.id,g=va[b];if(g)return g;g=a.func?G.def(p(a.data),"(",sa,",0,",
W,")"):G.def(sa,".",a.data);return va[b]=g}var v=e(),p=v.link,C=v.block,D=v.proc,aa=K++,g=p(oa);p(q);var H=p(T.fragShaders),E=p(T.vertShaders),I=p(T.programs),ja=p(ea),B={count:p(ca.count),offset:p(ca.offset),instances:p(ca.instances),primitive:p(ca.primitive)},P=p(u.elements),ta=p(l),V=p(N),pa=p(A),da={},x=C(),M=C(),ua=!1;Object.keys(b).sort(a).forEach(function(a){var g=b[a];switch(a){case "frag":ua=!0;x(H,".push(",p(q.id(g)),");");M(H,".pop();");break;case "vert":ua=!0;x(E,".push(",p(q.id(g)),");");
M(E,".pop();");break;case "framebuffer":a=ea.getFramebuffer(g);n(null===g||a,"invalid framebuffer object");a=t("viewport");var c=t("scissor.box");x("if(",ja,".push(",p(g&&g._framebuffer),")){",a,".setDirty();",c,".setDirty();","}");M("if(",ja,".pop()){",a,".setDirty();",c,".setDirty();","}");break;case "count":case "offset":case "instances":n.nni(g,a);x(B[a],".push(",g,");");M(B[a],".pop();");break;case "primitive":n.parameter(g,l,"not a valid drawing primitive");x(B.primitive,".push(",l[g],");");
M(B.primitive,".pop();");break;case "elements":c=u.getElements(g);g=!("primitive"in b);a=!("count"in b);c?(c=p(c),x(P,".push(",c,");"),g&&x(B.primitive,".push(",c,".primType);"),a&&x(B.count,".push(",c,".vertCount);")):(x(P,".push(null);"),g&&x(B.primitive,".push(",4,");"),a&&x(B.count,".push(0);"));g&&M(B.primitive,".pop();");a&&M(B.count,".pop();");"offset"in b||(x(B.offset,".push(0);"),M(B.offset,".pop();"));M(P,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":n.type(g,
"boolean",a);L(a,g);break;case "depth.func":n.parameter(g,N,a);L(a,N[g]);break;case "depth.range":n(Array.isArray(g)&&2===g.length&&g[0]<=g[1],"depth range is 2d array");a=t(a);x(a,".push(",g[0],",",g[1],");");M(a,".pop();");break;case "blend.func":a=t(a);n.type(g,"object","blend func must be an object");var c="srcRGB"in g?g.srcRGB:g.src,e="srcAlpha"in g?g.srcAlpha:g.src,d="dstRGB"in g?g.dstRGB:g.dst,g="dstAlpha"in g?g.dstAlpha:g.dst;n.parameter(c,F);n.parameter(e,F);n.parameter(d,F);n.parameter(g,
F);x(a,".push(",F[c],",",F[d],",",F[e],",",F[g],");");M(a,".pop();");break;case "blend.equation":a=t(a);"string"===typeof g?(n.parameter(g,y,"invalid blend equation"),x(a,".push(",y[g],",",y[g],");")):"object"===typeof g?(n.parameter(g.rgb,y,"invalid blend equation rgb"),n.parameter(g.alpha,y,"invalid blend equation alpha"),x(a,".push(",y[g.rgb],",",y[g.alpha],");")):n.raise("invalid blend equation");M(a,".pop();");break;case "blend.color":n(Array.isArray(g)&&4===g.length,"blend color is a 4d array");
a=t(a);x(a,".push(",g[0],",",g[1],",",g[2],",",g[3],");");M(a,".pop();");break;case "stencil.mask":n.type(g,"number","stencil mask must be an integer");a=t(a);x(a,".push(",g,");");M(a,".pop();");break;case "stencil.func":n.type(g,"object","stencil func must be an object");c=g.cmp||"keep";e=g.ref||0;g="mask"in g?g.mask:-1;n.parameter(c,N,"invalid stencil func cmp");n.type(e,"number","stencil func ref");n.type(g,"number","stencil func mask");a=t(a);x(a,".push(",N[c],",",e,",",g,");");M(a,".pop();");
break;case "stencil.opFront":case "stencil.opBack":n.type(g,"object",a);c=g.fail||"keep";e=g.zfail||"keep";g=g.pass||"keep";n.parameter(c,A,a);n.parameter(e,A,a);n.parameter(g,A,a);a=t(a);x(a,".push(",A[c],",",A[e],",",A[g],");");M(a,".pop();");break;case "polygonOffset.offset":n.type(g,"object",a);c=g.factor||0;g=g.units||0;n.type(c,"number","offset.factor");n.type(g,"number","offset.units");a=t(a);x(a,".push(",c,",",g,");");M(a,".pop();");break;case "cull.face":c=0;"front"===g?c=1028:"back"===g&&
(c=1029);n(!!c,"cull.face");g=t(a);x(g,".push(",c,");");M(g,".pop();");break;case "lineWidth":c=k.lineWidthDims;n("number"===typeof g&&g>=c[0]&&g<=c[1],"invalid line width, must positive number between "+c[0]+" and "+c[1]);L(a,g);break;case "frontFace":c=0;"cw"===g?c=2304:"ccw"===g&&(c=2305);n(!!c,"frontFace");g=t(a);x(g,".push(",c,");");M(g,".pop();");break;case "colorMask":n(Array.isArray(g)&&4===g.length,"color mask must be length 4 array");a=t(a);x(a,".push(",g.map(function(a){return!!a}).join(),
");");M(a,".pop();");break;case "sample.coverage":n.type(g,"object",a);c="value"in g?g.value:1;g=!!g.invert;n("number"===typeof c&&0<=c&&1>=c,"sample value");a=t(a);x(a,".push(",c,",",g,");");M(a,".pop();");break;case "viewport":case "scissor.box":n("object"===typeof g&&g,a+" is an object");var c=g.x||0,e=g.y||0,I=d=-1;n("number"===typeof c&&0<=c,a+".x must be a positive int");n("number"===typeof e&&0<=e,a+".y must be a positive int");"w"in g&&(d=g.w,n("number"===typeof d&&0<=d,a+".w must be a positive int"));
"h"in g&&(I=g.h,n("number"===typeof I&&0<=I,a+".h must be a positive int"));g=t(a);x(g,".push(",c,",",e,",",d,",",I,");");M(g,".pop();");break;default:n.raise("unsupported parameter "+a)}});if(ua){if(b.frag&&b.vert)C=b.frag,x(I,".push(",p(T.create(q.id(b.vert),q.id(C))),");");else{var C=x.def(H,"[",H,".length-1]"),na=x.def(E,"[",E,".length-1]"),ra=p(T.create);x(I,".push(",ra,"(",na,",",C,"));")}M(I,".pop();")}Object.keys(d).forEach(function(a){var g=p(fa.def(a));a=d[a];a="function"===typeof a&&a._reglType?
p(a):Array.isArray(a)?p(a.slice()):+a;x(g,".push(",a,");");M(g,".pop();")});Object.keys(r).forEach(function(a){var g=p(ga.def(a)),b=r[a];if("number"===typeof b)x(g,".pushVec(",+b,",0,0,0);");else if(n(!!b,"invalid attribute: "+a),Array.isArray(b))x(g,".pushVec(",[b[0]||0,b[1]||0,b[2]||0,b[3]||0],");");else{var c=O.getBuffer(b),e=0,E=0,k=0,d=0,q=!1,I=5126;c?I=c.dtype:(n.type(b,"object",'invalid attribute "'+a+'"'),c=O.getBuffer(b.buffer),e=b.size||0,E=b.stride||0,k=b.offset||0,d=b.divisor||0,q=b.normalized||
!1,n(!!c,"invalid attribute "+a+".buffer"),I=c.dtype,"type"in b&&(n.parameter(b.type,Q,"attribute type"),I=Q[b.type]));n(!!c,"invalid attribute "+a+".buffer");n.nni(E,a+".stride");n.nni(k,a+".offset");n.nni(d,a+".divisor");n.type(q,"boolean",a+".normalized");n.oneOf(e,[0,1,2,3,4],a+".size");x(g,".pushPtr(",[p(c),e,k,E,d,q,I].join(),");")}M(g,".pop();")});var G=v.block(),S=v.block(),W,sa;h&&(W=p(ka),sa=x.def());var va={};Object.keys(m).sort(a).forEach(function(a){var g=J(m[a]);switch(a){case "framebuffer":a=
t("viewport");var c=t("scissor.box");G("if(",ja,".push(",g,"&&",g,"._framebuffer)){",a,".setDirty();",c,".setDirty();","}");S("if(",ja,".pop()){",a,".setDirty();",c,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=t(a);G(a,".push(",g,");");S(a,".pop();");break;case "count":case "offset":case "instances":a=
B[a];G(a,".push(",g,");");S(a,".pop();");break;case "primitive":a=B.primitive;G(a,".push(",ta,"[",g,"]);");S(a,".pop();");break;case "depth.func":a=t(a);G(a,".push(",V,"[",g,"]);");S(a,".pop();");break;case "blend.func":a=t(a);c=p(F);G(a,".push(",c,'["srcRGB" in ',g,"?",g,".srcRGB:",g,".src],",c,'["dstRGB" in ',g,"?",g,".dstRGB:",g,".dst],",c,'["srcAlpha" in ',g,"?",g,".srcAlpha:",g,".src],",c,'["dstAlpha" in ',g,"?",g,".dstAlpha:",g,".dst]);");S(a,".pop();");break;case "blend.equation":a=t(a);c=
p(y);G("if(typeof ",g,'==="string"){',a,".push(",c,"[",g,"],",c,"[",g,"]);","}else{",a,".push(",c,"[",g,".rgb],",c,"[",g,".alpha]);","}");S(a,".pop();");break;case "blend.color":a=t(a);G(a,".push(",g,"[0],",g,"[1],",g,"[2],",g,"[3]);");S(a,".pop();");break;case "stencil.mask":a=t(a);G(a,".push(",g,");");S(a,".pop();");break;case "stencil.func":a=t(a);G(a,".push(",V,"[",g,".cmp],",g,".ref|0,",'"mask" in ',g,"?",g,".mask:-1);");S(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=t(a);
G(a,".push(",pa,"[",g,'.fail||"keep"],',pa,"[",g,'.zfail||"keep"],',pa,"[",g,'.pass||"keep"]);');S(a,".pop();");break;case "polygonOffset.offset":a=t(a);G(a,".push(",g,".factor||0,",g,".units||0);");S(a,".pop();");break;case "cull.face":a=t(a);G(a,".push(",g,'==="front"?',1028,":",1029,");");S(a,".pop();");break;case "frontFace":a=t(a);G(a,".push(",g,'==="cw"?',2304,":",2305,");");S(a,".pop();");break;case "colorMask":a=t(a);G(a,".push(",g,"[0],",g,"[1],",g,"[2],",g,"[3]);");S(a,".pop();");break;
case "sample.coverage":a=t(a);G(a,".push(",g,".value,",g,".invert);");S(a,".pop();");break;case "scissor.box":case "viewport":a=t(a);G(a,".push(",g,".x||0,",g,".y||0,",'"w" in ',g,"?",g,".w:-1,",'"h" in ',g,"?",g,".h:-1);");S(a,".pop();");break;case "elements":a=!("primitive"in m)&&!("primitive"in b);var c=!("count"in m)&&!("count"in b),e=!("offset"in m)&&!("offset"in b),E=G.def();G("if(",g,"){",E,"=",g,"._elements;",P,".push(",E,");",a?B.primitive+".push("+E+".primType);":"",c?B.count+".push("+E+
".vertCount);":"",e?B.offset+".push("+E+".offset);":"","}else{",P,".push(null);","}");S(P,".pop();","if(",g,"){",a?B.primitive+".pop();":"",c?B.count+".pop();":"",e?B.offset+".pop();":"","}");break;default:n.raise("unsupported dynamic option: "+a)}});Object.keys(f).forEach(function(a){var g=p(fa.def(a));a=J(f[a]);G(g,".push(",a,");");S(g,".pop();")});Object.keys(z).forEach(function(a){var g=p(ga.def(a));a=J(z[a]);G(g,".pushDyn(",a,");");S(g,".pop();")});C=D("scope");na=C.arg();ra=C.arg();C(x);h&&
C(sa,"=",na,";",G);C(ra,"();",h?S:"",M);C=D("draw");C(x);h&&C(sa,"=",C.arg(),";",G);na=c(I);C(g,"();","if(",na,")",na,".draw(",h?sa:"",");",h?S:"",M);var qa=D("batch");qa(x);h=qa.def(c(I));D=p(function(a,g,c){var e=a.batchCache[aa];e||(e=a.batchCache[aa]=ha(a,m,f,z,b));return e(g,c)});qa("if(",h,"){",g,"();",D,"(",h,",",qa.arg(),",",qa.arg(),");");Object.keys(m).forEach(function(a){(a=da[a])&&qa(a,".setDirty();")});qa("}",M);return v.compile()}}}},{"./check":4,"./codegen":6,"./constants/dtypes.json":9,
"./constants/primitives.json":10}],8:[function(d,f,h){f.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],9:[function(d,f,h){f.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],10:[function(d,f,h){f.exports={points:0,
lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],11:[function(d,f,h){function b(b,c){function d(){var c=window.innerWidth,e=window.innerHeight;b!==document.body&&(e=b.getBoundingClientRect(),c=e.right-e.left,e=e.top-e.bottom);f.width=N*c;f.height=N*e;a(f.style,{width:c+"px",height:e+"px"})}var f=document.createElement("canvas"),h=m(f,c);a(f.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(f);b===document.body&&(f.style.position="absolute",a(b.style,
{margin:0,padding:0}));var N=+h.options.pixelRatio;window.addEventListener("resize",d,!1);var A=h.options.onDestroy;h.options=a(a({},h.options),{onDestroy:function(){window.removeEventListener("resize",d);b.removeChild(f);A&&A()}});d();return h}function m(b,e){function d(a){try{return b.getContext(a,m)}catch(c){return null}}var m=e.glOptions||{},f=d("webgl")||d("experimental-webgl")||d("webgl-experimental");c(f,"webgl not supported");return{gl:f,options:a({pixelRatio:window.devicePixelRatio},e)}}
var c=d("./check"),a=d("./extend");f.exports=function(c){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:c[0],options:c[1]||{}};var e=document.body,d=c[1]||{};if("string"===typeof c[0])e=document.querySelector(c[0])||document.body;else if("object"===typeof c[0])if(c[0]instanceof HTMLElement)e=c[0];else{if(c[0]instanceof WebGLRenderingContext)return{gl:c[0],options:a({pixelRatio:1},d)};d=c[0]}return e.nodeName&&"CANVAS"===e.nodeName.toUpperCase()?m(e,d):b(e,d)}},{"./check":4,
"./extend":15}],12:[function(d,f,h){f.exports=function(b){return{primitive:[4],count:[0],offset:[0],instances:[0]}}},{}],13:[function(d,f,h){function b(a,b){this.id=c++;this.func=a;this.data=b}function m(a,c){switch(typeof a){case "boolean":case "number":case "string":return new b(!1,a);case "function":return new b(!0,a);default:return m}}var c=0;f.exports={define:m,isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof b},unbox:function(a,c){return a instanceof b?a:"function"===
typeof a&&a!==m?new b(!0,a):new b(!1,c)}}},{}],14:[function(d,f,h){var b=d("./check"),m=d("./is-typed-array"),c=d("./is-ndarray"),a=d("./constants/primitives.json");f.exports=function(d,e,l){function f(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}f.prototype.bind=function(){this.buffer.bind()};return{create:function(d){function n(d){var f=e.oes_element_index_uint;if(d)if("number"===typeof d)r(d);else{var k=null,l="static",u=0;Array.isArray(d)||m(d)||c(d)?k=d:(b.type(d,"object","invalid arguments for elements"),
"data"in d&&(k=d.data),"usage"in d&&(l=d.usage),"length"in d&&(u=d.length));Array.isArray(k)||c(k)&&"array"===k.dtype||"type"in d?r({type:d.type||(f?"uint32":"uint16"),usage:l,data:k,length:u}):r({usage:l,data:k,length:u});if(Array.isArray(k)||m(k))r.dimension=3}else r();k=h.buffer.byteLength;l=0;switch(h.buffer.dtype){case 5121:case 5120:l=5121;break;case 5123:case 5122:l=5123;k>>=1;break;case 5125:case 5124:b(f,"32 bit element buffers not supported");l=5125;k>>=2;break;default:b.raise("invalid element buffer type")}f=
4;u=h.buffer.dimension;1===u&&(f=0);2===u&&(f=1);3===u&&(f=4);"object"===typeof d&&("primitive"in d&&(f=d.primitive,b.parameter(f,a),f=a[f]),"count"in d&&(k=d.vertCount|0));h.primType=f;h.vertCount=k;h.type=l;return n}var h=new f,r=l.create(null,34963,!0);h.buffer=r._buffer;n(d);n._reglType="elements";n._elements=h;n.destroy=function(){b(null!==h.buffer,"must not double destroy elements");r.destroy();h.buffer=null};return n},elements:[null],getElements:function(a){return a&&a._elements instanceof
f?a._elements:null}}}},{"./check":4,"./constants/primitives.json":10,"./is-ndarray":18,"./is-typed-array":19}],15:[function(d,f,h){f.exports=function(b,d){for(var c=Object.keys(d),a=0;a<c.length;++a)b[c[a]]=d[c[a]];return b}},{}],16:[function(d,f,h){f.exports=function(b){function d(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{c[a]=
b.getExtension(a)}catch(d){}})}var c={};d();return{extensions:c,refresh:d}}},{}],17:[function(d,f,h){var b=d("./check"),m=d("./values"),c=d("./extend"),a=[1029];f.exports=function(d,e,f,h,F){function N(a,b,c,d){this.target=a;this.level=b;this.texture=c;this.renderbuffer=d}function A(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function r(a,c,d){if(a.texture)b.oneOf(a.texture._texture.params.internalformat,c,"unsupported texture format for attachment");
else b.oneOf(a.renderbuffer._renderbuffer.format,d,"unsupported renderbuffer format for attachment")}function q(a,c){var d=c.width,e=c.height;if(a.texture){var k=a.texture._texture,n=Math.max(1,k.params.width>>a.level),q=Math.max(1,k.params.height>>a.level),d=d||n,e=e||q;b(n===d&&q===e,"inconsistent width/height for supplied texture");b(0>k.pollId,"polling fbo textures not supported")}else k=a.renderbuffer._renderbuffer,d=d||k.width,e=e||k.height,b(k.width===d&&k.height===e,"inconsistent width/height for renderbuffer"),
b(0<=X.indexOf(k.format),"renderbuffer format not compatible with color channels");k.refCount+=1;c.width=d;c.height=e}function z(a,b){b?b.texture?d.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):d.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):d.framebufferTexture2D(36160,a,3553,null,0)}function k(a){var c=3553,d=0,e=null,k=null,n=a;"object"===typeof a&&(n=a.data,"level"in a&&(d=a.level|0),"target"in a&&(c=a.target|0));b.type(n,"function",
"invalid attachment data");n=a._reglType;"texture"===n?(e=a,34067===e._texture.target?b(34069<=c&&34075>c,"invalid cube map target"):b(3553===c)):"renderbuffer"===n?(k=a,c=36161,d=0):b.raise("invalid regl object for attachment");return new N(c,d,e,k)}function O(a){return a&&(a.texture||a.renderbuffer)}function u(){this.id=R++;Z[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=
this.ownsColor=!1}function t(a){d.isFramebuffer(a.framebuffer)||(a.framebuffer=d.createFramebuffer());Y=!0;d.bindFramebuffer(36160,a.framebuffer);for(var c=a.colorAttachments,k=0;k<c.length;++k)z(36064+k,c[k]);for(k=c.length;k<f.maxColorAttachments;++k)z(36064+k,null);z(36096,a.depthAttachment);z(36128,a.stencilAttachment);z(33306,a.depthStencilAttachment);e.webgl_draw_buffers&&e.webgl_draw_buffers.drawBuffersWEBGL(ba[c.length]);a=d.checkFramebufferStatus(36160);36053!==a&&b.raise("framebuffer configuration not supported, status = "+
fa[a])}function ea(a){a=a.framebuffer;b(a,"must not double destroy framebuffer");d.isFramebuffer(a)&&d.deleteFramebuffer(a)}function W(){return U[U.length-1]}var fa={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},ga={rgba:6408},T={rgba4:32854,rgb565:36194,"rgb5 a1":32855};e.ext_srgb&&(T.srgba=35907);e.ext_color_buffer_half_float&&(T.rgba16f=34842,T.rgb16f=34843);e.webgl_color_buffer_float&&(T.rgba32f=34836);
var ca=[33189],ka=[36168],oa=[34041],ha=[],la=[],y=[];e.webgl_depth_texture&&(ha.push(6402),y.push(34041));var K=c(c({},ga),T),ma=m(ga),X=m(T),T=5121,ia={uint8:5121};e.oes_texture_half_float&&(T=ia["half float"]=36193);e.oes_texture_float&&(T=ia["float"]=5126);ia.best=T;var ba=function(){for(var a=Array(f.maxDrawbuffers),b=0;b<=f.maxDrawbuffers;++b)for(var c=a[b]=Array(b),d=0;d<b;++d)c[d]=36064+d;return a}(),R=0,Z={},U=[null],Y=!0;return{top:W,dirty:function(){return Y},push:function(a){a=a||null;
Y=Y||a!==W();U.push(a);return Y},pop:function(){var a=W();U.pop();return Y=Y||a!==W()},getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof u)?a:null},poll:function(){if(Y){var b=U[U.length-1],c=e.webgl_draw_buffers;b?(d.bindFramebuffer(36160,b.framebuffer),c&&c.drawBuffersWEBGL(ba[b.colorAttachments.length])):(d.bindFramebuffer(36160,null),c&&c.drawBuffersWEBGL(a));Y=!1}},create:function(a){function c(a){var l,m=a||{};l=e.webgl_draw_buffers;
var u=0,g=0;"shape"in m?(a=m.shape,b(Array.isArray(a)&&2<=a.length,"invalid shape for framebuffer"),u=a[0],g=a[1]):("radius"in m&&(u=g=m.radius),"width"in m&&(u=m.width),"height"in m&&(g=m.height));var H=null;a=!1;if("colorBuffers"in m||"colorBuffer"in m){H=m.colorBuffers||m.colorBuffer;Array.isArray(H)||(H=[H]);f.width=u;f.height=g;1<H.length&&b(l,"multiple render targets not supported");b(0<=H.length,"must specify at least one color attachment");H=H.map(k);for(l=0;l<H.length;++l)u=H[l],r(u,ma,X),
q(u,f);u=f.width;g=f.height}else{var E=!0,I="rgba",ja="uint8",B=1;a=!0;f.width=u||d.drawingBufferWidth;f.height=g||d.drawingBufferHeight;"format"in m&&(I=m.format,b.parameter(I,K,"invalid color format"),E=I in ga);"type"in m&&(b(E,"colorType can not be set for renderbuffer targets"),ja=m.type,b.parameter(ja,ia,"invalid color type"));"colorCount"in m&&(B=m.colorCount|0,b(0<=B,"color count must be positive"));if(f.ownsColor)for(H=f.colorAttachments;H.length>B;)A(H.pop());else H=[];for(l=0;l<H.length;++l){var P;
a:{P=H[l];var z=E,V=I,pa=u,da=g;if(P.texture){var x=P.texture;if(z){x({format:V,type:ja,width:pa,height:da});x._texture.refCount+=1;P=!0;break a}}else if(x=P.renderbuffer,!z){x({format:V,width:pa,height:da});x._renderbuffer.refCount+=1;P=!0;break a}A(P);P=!1}P||(H[l--]=H[H.length-1],H.pop())}for(;H.length<B;)E?H.push(new N(3553,0,h.create({format:I,type:ja,width:u,height:g},3553),null)):H.push(new N(36161,0,null,F.create({format:I,width:u,height:g})))}b(0<H.length,"must specify at least one color buffer");
f.width=u;f.height=g;I=E=l=null;ja=!1;B=0;"depthBuffer"in m&&(l=k(m.depthBuffer),r(l,ha,ca),B+=1);"stencilBuffer"in m&&(E=k(m.stencilBuffer),r(E,la,ka),B+=1);"depthStencilBuffer"in m&&(I=k(m.depthStencilBuffer),r(I,y,oa),B+=1);if(l||E||I)b(1===B,"can specify only one of depth, stencil or depthStencil attachment"),q(l||E||I,f);else if(B=!0,z=P=!1,"depth"in m&&(B=!!m.depth),"stencil"in m&&(P=!!m.stencil),"depthTexture"in m&&(z=!!m.depthTexture),m=f.depthAttachment||f.stencilAttachment||f.depthStencilAttachment,
V=null,B||P)ja=!0,z?(b(e.webgl_depth_texture,"depth texture extension not supported"),b(B,"stencil only textures not supported"),z=P?"depth stencil":"depth",f.ownsDepthStencil&&m.texture?(m.texture({format:z,width:u,height:g}),m.texture._texture.refCount+=1,V=m):V=new N(3553,0,h.create({format:z,width:u,height:g},3553),null)):(z=B?P?"depth stencil":"depth":"stencil",f.ownsDepthStencil&&m.renderbuffer?(m.renderbuffer({format:z,width:u,height:g}),m.renderbuffer._renderbuffer.refCount+=1,V=m):V=new N(36161,
0,null,F.create({format:z,width:u,height:g}))),B?P?I=V:l=V:E=V;u=f;u.colorAttachments.forEach(A);A(u.depthAttachment);A(u.stencilAttachment);A(u.depthStencilAttachment);f.colorAttachments=H;f.depthAttachment=l;f.stencilAttachment=E;f.depthStencilAttachment=I;f.ownsColor=a;f.ownsDepthStencil=ja;c.color=H.map(O);c.depth=O(l);c.stencil=O(E);c.depthStencil=O(I);t(f);c.width=f.width;c.height=f.height;return c}var f=new u;c(a);c._reglType="framebuffer";c._framebuffer=f;c._destroy=function(){ea(f)};return c},
clear:function(){m(Z).forEach(ea)},refresh:function(){m(Z).forEach(t)}}}},{"./check":4,"./extend":15,"./values":33}],18:[function(d,f,h){var b=d("./is-typed-array");f.exports=function(d){return"object"===typeof d&&Array.isArray(d.shape)&&Array.isArray(d.stride)&&"number"===typeof d.offset&&d.shape.length===d.stride.length&&(Array.isArray(d.data)||b(d.data))}},{"./is-typed-array":19}],19:[function(d,f,h){var b=d("./constants/arraytypes.json");f.exports=function(d){return Object.prototype.toString.call(d)in
b}},{"./constants/arraytypes.json":8}],20:[function(d,f,h){f.exports=function(b,d){var c=1;d.ext_texture_filter_anisotropic&&(c=b.getParameter(34047));var a=1,f=1;d.webgl_draw_buffers&&(a=b.getParameter(34852),f=b.getParameter(36063));return{colorBits:[b.getParameter(3410),b.getParameter(3411),b.getParameter(3412),b.getParameter(3413)],depthBits:b.getParameter(3414),stencilBits:b.getParameter(3415),subpixelBits:b.getParameter(3408),extensions:Object.keys(d).filter(function(a){return!!d[a]}),maxAnisotropic:c,
maxDrawbuffers:a,maxColorAttachments:f,pointSizeDims:b.getParameter(33901),lineWidthDims:b.getParameter(33902),maxViewportDims:b.getParameter(3386),maxCombinedTextureUnits:b.getParameter(35661),maxCubeMapSize:b.getParameter(34076),maxRenderbufferSize:b.getParameter(34024),maxTextureUnits:b.getParameter(34930),maxTextureSize:b.getParameter(3379),maxAttributes:b.getParameter(34921),maxVertexUniforms:b.getParameter(36347),maxVertexTextureUnits:b.getParameter(35660),maxVaryingVectors:b.getParameter(36348),
maxFragmentUniforms:b.getParameter(36349),glsl:b.getParameter(35724),renderer:b.getParameter(7937),vendor:b.getParameter(7936),version:b.getParameter(7938)}}},{}],21:[function(d,f,h){f.exports=function(b,d){if("undefined"!==typeof document){var c;c=(c=/\.(\w+)(\?.*)?$/.exec(b))&&c[1]?c[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(c))return c=document.createElement("video"),c.autoplay=!0,c.loop=!0,d&&(c.crossOrigin=d),c.src=
b,c;if(0<=["dds"].indexOf(c))return c=new XMLHttpRequest,c.responseType="arraybuffer",c.open("GET",b,!0),c.send(),c;c=new Image;d&&(c.crossOrigin=d);c.src=b;return c}return null}},{}],22:[function(d,f,h){var b=d("./check");f.exports=function(d){function f(a){for(var b=X,c=ia,e=0;e<Y;++e){var k=Math.max(1,b+3>>2)*Math.max(1,c+3>>2)*Z;J.pixels.push({target:a,miplevel:e,width:b,height:c,data:new Uint8Array(d,L,k)});L+=k;b>>=1;c>>=1}}var h=new Int32Array(d);b(h[0]===m,"invalid magic number for dds header");
var ma=h[fa];b(ma&z,"unsupported dds format");var X=h[T],ia=h[ga],ba=N,R=0,Z=0,U=4;switch(h[oa]){case O:Z=8;ma&k?(U=3,R=n):R=e;break;case u:Z=16;R=l;break;case t:Z=16;R=Q;break;case ea:Z=8;R=F;break;default:b.raise("unsupported dds texture format")}var Y=1;h[ka]&A&&(Y=Math.max(1,h[ca]));var L=h[W]+4,J={width:X,height:ia,channels:U,format:R,type:ba,compressed:!0,cube:!1,pixels:[]},h=h[ha];if(h&r)for(b((h&q)===q,"missing cubemap faces"),J.cube=!0,h=0;6>h;++h)f(a+h);else f(c);return J};var m=542327876,
c=3553,a=34069,n=33776,e=33777,l=33778,Q=33779,F=36196,N=5121,A=131072,r=512,q=64512,z=4,k=64,O=827611204,u=861165636,t=894720068,ea=826496069,W=1,fa=2,ga=3,T=4,ca=7,ka=20,oa=21,ha=28},{"./check":4}],23:[function(d,f,h){f.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(b){return requestAnimationFrame(b)},cancel:function(b){return cancelAnimationFrame(b)}}:{next:function(b){setTimeout(b,30)},cancel:clearTimeout}},{}],24:[function(d,f,h){var b=
d("./check"),m=d("./is-typed-array");f.exports=function(c,a,d){return function(e){var f=e||{};m(e)?f={data:f}:2===arguments.length?f={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof e&&(f={});a();var h=f.x||0,F=f.y||0,N=f.width||d.width,A=f.height||d.height,r=N*A*4,f=f.data||new Uint8Array(r);b.isTypedArray(f);b(f.byteLength>=r,"data buffer too small");c.pixelStorei(3333,4);c.readPixels(h,F,N,A,6408,5121,f);return f}}},{"./check":4,"./is-typed-array":19}],25:[function(d,f,h){var b=d("./check"),
m=d("./values");f.exports=function(c,a,d){function e(){this.id=N++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function f(a){c.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=c.createRenderbuffer());c.bindRenderbuffer(36161,a.renderbuffer);c.renderbufferStorage(36161,a.format,a.width,a.height)}function h(a){var d=a.renderbuffer;b(d,"must not double destroy renderbuffer");c.bindRenderbuffer(36161,null);c.isRenderbuffer(d)&&c.deleteRenderbuffer(d);a.renderbuffer=
null;a.refCount=0;delete A[a.id]}var F={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};a.ext_srgb&&(F.srgba=35907);a.ext_color_buffer_half_float&&(F.rgba16f=34842,F.rgb16f=34843);a.webgl_color_buffer_float&&(F.rgba32f=34836);var N=0,A={};e.prototype.decRef=function(){0===--this.refCount&&h(this)};return{create:function(a){function c(a){a=a||{};var e=0,r=0;"shape"in a?(r=a.shape,b(Array.isArray(r)&&2<=r.length,"invalid renderbuffer shape"),e=r[0]|0,r=r[1]|
0):("radius"in a&&(e=r=a.radius|0),"width"in a&&(e=a.width|0),"height"in a&&(r=a.height|0));var h=d.maxRenderbufferSize;b(0<=e&&0<=r&&e<=h&&r<=h,"invalid renderbuffer size");c.width=m.width=Math.max(e,1);c.height=m.height=Math.max(r,1);m.format=32854;"format"in a&&(a=a.format,b.parameter(a,F,"invalid render buffer format"),m.format=F[a]);f(m);return c}var m=new e;A[m.id]=m;c(a);c._reglType="renderbuffer";c._renderbuffer=m;c.destroy=function(){m.decRef()};return c},refresh:function(){m(A).forEach(f)},
clear:function(){m(A).forEach(h)}}}},{"./check":4,"./values":33}],26:[function(d,f,h){function b(a,b,c){this.name=a;this.location=b;this.info=c}var m=d("./check"),c=d("./values");f.exports=function(a,d,e,f,h){function F(b,c){var d=35632===b?r:q,e=d[c];if(!e){var f=h.str(c),e=a.createShader(b);a.shaderSource(e,f);a.compileShader(e);m.shaderError(a,e,f,b);d[c]=e}return e}function N(a,b){this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];this.draw=function(){};this.batchCache=
{}}function A(c){var k,q;k=F(35632,c.fragId);q=F(35633,c.vertId);var r=c.program=a.createProgram();a.attachShader(r,k);a.attachShader(r,q);a.linkProgram(r);m.linkError(a,r);var h=a.getProgramParameter(r,35718),z=c.uniforms=[];for(k=0;k<h;++k)if(q=a.getActiveUniform(r,k))if(1<q.size)for(var Q=0;Q<q.size;++Q){var A=q.name.replace("[0]","["+Q+"]");e.def(A);z.push(new b(A,a.getUniformLocation(r,A),q))}else e.def(q.name),z.push(new b(q.name,a.getUniformLocation(r,q.name),q));h=a.getProgramParameter(r,
35721);z=c.attributes=[];for(k=0;k<h;++k)if(q=a.getActiveAttrib(r,k))d.def(q.name),z.push(new b(q.name,a.getAttribLocation(r,q.name),q));c.draw=f(c);c.batchCache={}}var r={},q={},z={},k=[];return{create:function(a,b){var c=z[b];c||(c=z[b]={});var d=c[a];d||(d=new N(b,a),A(d),c[a]=d,k.push(d));return d},clear:function(){var b=a.deleteShader.bind(a);c(r).forEach(b);r={};c(q).forEach(b);q={};k.forEach(function(b){a.deleteProgram(b.program)});k.length=0;z={}},refresh:function(){r={};q={};k.forEach(A)},
programs:[null],fragShaders:[h.id("void main(){gl_FragColor=vec4(0,0,0,0);}")],vertShaders:[h.id("void main(){gl_Position=vec4(0,0,0,0);}")]}}},{"./check":4,"./values":33}],27:[function(d,f,h){f.exports=function(b,d){var c=b.length,a=b.slice(),f=b.slice(),e=!1,l=!0;return{push:function(){e=!1;for(var b=0;b<c;++b){var d=arguments[b];e=e||d!==f[b];a.push(d)}},pop:function(){e=!1;a.length-=c;for(var b=0;b<c;++b)e=e||a[a.length-c+b]!==f[b]},poll:function(){var b=a.length-c;if(e||l){switch(c){case 1:d(a[b]);
break;case 2:d(a[b],a[b+1]);break;case 3:d(a[b],a[b+1],a[b+2]);break;case 4:d(a[b],a[b+1],a[b+2],a[b+3]);break;case 5:d(a[b],a[b+1],a[b+2],a[b+3],a[b+4]);break;case 6:d(a[b],a[b+1],a[b+2],a[b+3],a[b+4],a[b+5]);break;default:d.apply(null,a.slice(b,a.length))}for(var h=0;h<c;++h)f[h]=a[b+h];l=e=!1}},setDirty:function(){l=!0}}}},{}],28:[function(d,f,h){var b=d("./stack"),m=d("./codegen");f.exports=function(c,a,d){function e(a,d){var e=b([!!d],function(b){b?c.enable(a):c.disable(a)});e.flag=a;return e}
var f={dither:e(3024),"blend.enable":e(3042),"blend.color":b([0,0,0,0],function(a,b,d,e){c.blendColor(a,b,d,e)}),"blend.equation":b([32774,32774],function(a,b){c.blendEquationSeparate(a,b)}),"blend.func":b([1,0,1,0],function(a,b,d,e){c.blendFuncSeparate(a,b,d,e)}),"depth.enable":e(2929,!0),"depth.func":b([513],function(a){c.depthFunc(a)}),"depth.range":b([0,1],function(a,b){c.depthRange(a,b)}),"depth.mask":b([!0],function(a){c.depthMask(a)}),"cull.enable":e(2884),"cull.face":b([1029],function(a){c.cullFace(a)}),
frontFace:b([2305],function(a){c.frontFace(a)}),colorMask:b([!0,!0,!0,!0],function(a,b,d,e){c.colorMask(a,b,d,e)}),lineWidth:b([1],function(a){c.lineWidth(a)}),"polygonOffset.enable":e(32823),"polygonOffset.offset":b([0,0],function(a,b){c.polygonOffset(a,b)}),"sample.alpha":e(32926),"sample.enable":e(32928),"sample.coverage":b([1,!1],function(a,b){c.sampleCoverage(a,b)}),"stencil.enable":e(2960),"stencil.mask":b([-1],function(a){c.stencilMask(a)}),"stencil.func":b([519,0,-1],function(a,b,d){c.stencilFunc(a,
b,d)}),"stencil.opFront":b([7680,7680,7680],function(a,b,d){c.stencilOpSeparate(1028,a,b,d)}),"stencil.opBack":b([7680,7680,7680],function(a,b,d){c.stencilOpSeparate(1029,a,b,d)}),"scissor.enable":e(3089),"scissor.box":b([0,0,-1,-1],function(b,d,e,f){var m=e,n=a.top();0>e&&(m=n?n.width-b:c.drawingBufferWidth-b);e=f;0>f&&(e=n?n.height-d:c.drawingBufferHeight-d);c.scissor(b,d,m,e)}),viewport:b([0,0,-1,-1],function(b,e,f,k){var m=f,h=a.top();0>f&&(m=h?h.width-b:c.drawingBufferWidth-b);f=k;0>k&&(f=h?
h.height-e:c.drawingBufferHeight-e);c.viewport(b,e,m,f);d.width=m;d.height=f})},h=m(),F=h.proc("poll"),N=h.proc("refresh");Object.keys(f).forEach(function(a){a=h.link(f[a]);F(a,".poll();");N(a,".setDirty();")});var A=h.compile();return{contextState:f,viewport:d,poll:A.poll,refresh:A.refresh,notifyViewportChanged:function(){f.viewport.setDirty();f["scissor.box"].setDirty()}}}},{"./codegen":6,"./stack":27}],29:[function(d,f,h){f.exports=function(){var b={},d=[""];return{id:function(c){var a=b[c];if(a)return a;
a=b[c]=d.length;d.push(c);return a},str:function(b){return d[b]}}}},{}],30:[function(d,f,h){function b(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function m(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,d=1;d<b;++d)if(!Array.isArray(a[d])||a[d].length!==c)return!1;return!0}function c(a){return Object.prototype.toString.call(a)}function a(a){return"[object HTMLCanvasElement]"===c(a)}function n(a){return"[object CanvasRenderingContext2D]"===
c(a)}var e=d("./check"),l=d("./extend"),Q=d("./values"),F=d("./is-typed-array"),N=d("./is-ndarray"),A=d("./load-texture"),r=d("./to-half-float"),q=d("./parse-dds"),z=[9984,9986,9985,9987];f.exports=function(d,f,h,t,ea){function W(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=this.miplevel=
0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function fa(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ga(a,b){var c,d,m=0,n=0,h=0,k=0,l=0,q=0,p=!1,r=!1,t=!1,v=0,A=[0,0,0,0,0,0],u=0,G=!1;for(c=0;c<b.length;++c){d=b[c];var k=k||d.width<<d.miplevel,
l=l||d.height<<d.miplevel,m=m||d.type,n=n||d.format,h=h||d.internalformat,q=q||d.channels,r=r||d.needsPoll,t=t||d.needsListeners,p=p||d.compressed,y=d.miplevel;d=d.target;G=G||0<y;3553===d?v|=1<<y:(d-=34069,A[d]|=1<<y,u|=1<<d)}a.needsPoll=r;a.needsListeners=t;a.width=k;a.height=l;a.format=n;a.internalformat=h;a.type=m;r=G?(k<<1)-1:1;if(3553===a.target)e(0===u,"pixmap type must not contain cubemap faces"),e(v===r,"missing mip map data");else for(e(63===u,"missing cubemap faces"),c=0;6>c;++c)e(A[c]===
r,"missing mip map data");c=0<=z.indexOf(a.minFilter);a.genMipmaps=!G&&(a.genMipmaps||c);G=G||a.genMipmaps;a.minFilter?e(G===c,"min filter inconsistent with mipmap data"):a.minFilter=G?9987:9728;G&&e(k===l&&!(k&k-1)&&!!k,"must be a square power of 2 to support mipmaps");a.genMipmaps&&e(!p,"mipmap generation not supported for compressed textures");a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;33071===a.wrapS&&33071===a.wrapT||e(!(k&k-1)&&!!k&&!(l&l-1)&&!!l&&!u,"incompatible size for wrap mode, image must be a power of 2");
(5126===m&&!f.oes_texture_float_linear||36193===m&&!f.oes_texture_half_float_linear)&&e(9728===this.magFilter&&9728===this.minFilter,"unsupported filter mode for float texture");for(c=0;c<b.length;++c)d=b[c],p=d.miplevel,d.width&&e(d.width<<p===k,"inconsistent width"),d.height&&e(d.height<<p===l,"inconsistent width"),d.channels?e(d.channels===q,"inconsistent channels"):d.channels=q,d.format?e(d.format===n,"inconsistent format"):d.format=n,d.internalformat?e(d.internalformat===h,"inconsistent internalformat"):
d.internalformat=h,d.type?e(d.type===m,"inconsistent type"):d.type=m,d.copy&&e(5121===d.type&&6408===d.internalformat,"incompatible format/type for copyTexImage2D")}function T(a){this.id=v++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new fa(a);this.pixels=[]}function ca(a,b){function d(a,c){var g=c.mipmap,e;if(Array.isArray(g))for(var f=0;f<g.length;++f)e=new W(a),e.parseFlags(b),e.parseFlags(c),e.parse(g[f],f),m.push(e);
else e=new W(a),e.parseFlags(b),e.parse(c,0),m.push(e)}var c;ha(a);var f=a.params;fa.call(f,a.target);var m=a.pixels;m.length=0;f.parse(b);if(3553===a.target)d(3553,b);else{var k=b.faces||b;if(Array.isArray(k))for(e(6===k.length,"invalid number of faces in cube map"),c=0;6>c;++c)d(34069+c,k[c]);else if("string"!==typeof k)for(c=0;6>c;++c)d(34069+c,{})}ga(f,m);f.needsListeners&&oa(a);f.needsPoll&&(a.pollId=C.length,C.push(a));ka(a)}function ka(a){d.isTexture(a.texture)||(a.texture=d.createTexture());
var b=a.target,c=a.unit;0<=c?(d.activeTexture(33984+c),J=c):d.bindTexture(b,a.texture);for(var b=a.pixels,e=a.params,f=0;f<b.length;++f)b[f].upload(e);e.upload();0>c&&((c=aa[J])?d.bindTexture(c.target,c.texture):(a.unit=J,aa[J]=a))}function oa(a){function b(c,d,m){var k=q(m);e(k.format in L,"unsupported dds texture format");k.cube?(e(34067===a.target),e.raise("cube map DDS not yet implemented")):e(3553===a.target);d&&e(1===k.pixels.length,"number of mip levels inconsistent");k.pixels.forEach(function(a){var b=
new W(k.cube?a.target:c);b.channels=k.channels;b.compressed=k.compressed;b.type=k.type;b.internalformat=k.format;b.format=L[k.format];b.width=a.width;b.height=a.height;b.miplevel=a.miplevel||d;b.data=a.data;f.push(b)})}function c(){for(var e=0;e<f.length;++e){var k=f[e],m=k.image,E=k.video,n=k.xhr;m&&m.complete?(k.width=m.naturalWidth,k.height=m.naturalHeight):E&&2<E.readyState?(k.width=E.width,k.height=E.height):n&&4===n.readyState&&(f[e]=f[f.length-1],f.pop(),n.removeEventListener("readystatechange",
ka),b(k.target,k.miplevel,n.response))}ga(d,f);ka(a)}var d=a.params,f=a.pixels;f.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){f.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function ha(a){var b=
a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((C[b]=C[C.length-1]).id=b,C.pop(),a.pollId=-1)}function la(a){var b=a.texture;e(b,"must not double destroy texture");var c=a.unit,f=a.target;0<=c&&(d.activeTexture(33984+c),J=c,d.bindTexture(f,null),aa[c]=null);ha(a);d.isTexture(b)&&d.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete p[a.id]}var y={"don't care":4352,"dont care":4352,nice:4354,fast:4353},K={repeat:10497,clamp:33071,mirror:33648},ma={nearest:9728,
linear:9729},X=l({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ma),ia={none:0,browser:37444},ba={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},R={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Z={};f.ext_srgb&&(R.srgb=35904,R.srgba=35906);f.oes_texture_float&&(ba["float"]=5126);f.oes_texture_half_float&&(ba["half float"]=36193);f.webgl_depth_texture&&
(l(R,{depth:6402,"depth stencil":34041}),l(ba,{uint16:5123,uint32:5125,"depth stencil":34042}));f.webgl_compressed_texture_s3tc&&l(Z,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});f.webgl_compressed_texture_atc&&l(Z,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});f.webgl_compressed_texture_pvrtc&&l(Z,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});f.webgl_compressed_texture_etc1&&
(Z["rgb etc1"]=36196);var U=Array.prototype.slice.call(d.getParameter(34467));Object.keys(Z).forEach(function(a){var b=Z[a];0<=U.indexOf(b)&&(R[a]=b)});var Y=Object.keys(R);h.textureFormats=Y;var L=Y.reduce(function(a,b){var c=R[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});l(W.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in a&&(e.type(a.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),
this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(e.type(a.flipY,"boolean","invalid texture flip"),this.flipY=a.flipY);"alignment"in a&&(e.oneOf(a.alignment,[1,2,4,8],"invalid texture unpack alignment"),this.unpackAlignment=a.alignment);"colorSpace"in a&&(e.parameter(a.colorSpace,ia,"invalid colorSpace"),this.colorSpace=ia[a.colorSpace]);if("format"in a){var b=a.format;e.parameter(b,R,"invalid texture format");this.internalformat=R[b];b in ba&&(this.type=ba[b]);b in Z&&(this.compressed=!0)}"type"in
a&&(b=a.type,e.parameter(b,ba,"invalid texture type"),this.type=ba[b]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(e(Array.isArray(a.shape)&&2<=a.shape.length,"shape must be an array"),b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,e(Array.isArray(b)&&2<=b.length,"invalid stride vector"),
this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(d,k){this.miplevel=k;this.width>>=k;this.height>>=k;var h=d;switch(typeof d){case "string":break;case "object":if(!d)return;this.parseFlags(d);var l=d.data;if("string"===typeof l||l&&(F(l)||b(l)||N(l)||a(l)||
n(l)||"[object HTMLImageElement]"===c(l)||"[object HTMLVideoElement]"===c(l)||m(l)))h=d.data;break;case "undefined":return;default:e.raise("invalid pixel data type")}"string"===typeof h&&(h=A(h,this.crossOrigin));var l=null,q=!1;this.compressed&&e(h instanceof Uint8Array||"[object XMLHttpRequest]"===c(h),"compressed texture data must be stored in a uint8array");if(null!==h)if(F(h))this.data=h;else if(b(h))l=h,q=!0;else if(N(h)){Array.isArray(h.data)?(l=h.data,q=!0):this.data=h.data;var p=h.shape;
this.width=p[0];this.height=p[1];this.channels=3===p.length?p[2]:1;p=h.stride;this.strideX=h.stride[0];this.strideY=h.stride[1];this.strideC=3===p.length?h.stride[2]:1;this.offset=h.offset;this.needsTranspose=!0}else if(a(h)||n(h))a(h)?this.canvas=h:this.canvas=h.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===c(h))this.image=h,h.complete?(this.width=h.naturalWidth,this.height=h.naturalHeight):(this.width=this.width||
h.naturalWidth,this.height=this.height||h.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();else if("[object HTMLVideoElement]"===c(h))this.video=h,1<h.readyState?(this.width=h.width,this.height=h.height):(this.width=this.width||h.width,this.height=this.height||h.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===c(h))this.xhr=h,this.needsListeners=!0;else if(m(h)){var q=h.length,p=h[0].length,t=1,u,v,y,z;if(Array.isArray(h[0][0]))for(t=
h[0][0].length,e(0<=t&&4>=t,"invalid number of channels for image data"),l=Array(q*p*t),v=z=0;v<p;++v)for(u=0;u<q;++u)for(y=0;y<t;++y)l[z++]=h[u][v][y];else for(l=Array(q*p),v=z=0;v<p;++v)for(u=0;u<q;++u)l[z++]=h[u][v];this.width=q;this.height=p;this.channels=t;q=!0}else d.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||ea.width)|0,this.height=(this.height||ea.height)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:
this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=[6409,6410,6407,6408][(this.channels=this.channels||4)-1],e(this.internalformat,"invalid number of channels"));p=this.internalformat;if(6402===p||34041===p)e(f.webgl_depth_texture,"depth/stencil texture not supported"),6402===p&&e(5123===this.type||5125,"depth texture type must be uint16 or uint32"),34041===p&&e(34042===this.type,"depth stencil texture format must match type"),
e(!this.data&&!l&&!this.image&&!this.video&&!this.canvas,"depth/stencil textures are for rendering only");h=this.format=L[p];if(!this.channels)switch(h){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}h=this.type;5126===h?e(f.oes_texture_float,"float texture not supported"):36193===h?e(f.oes_texture_half_float,"half float texture not supported"):h||(h=6402===p?5125:5121);this.type=h;if(q)switch(h){case 5121:this.data=
new Uint8Array(l);break;case 5123:this.data=new Uint16Array(l);break;case 5125:this.data=new Uint32Array(l);break;case 5126:this.data=new Float32Array(l);break;case 36193:this.data=r(l);break;case 33635:case 32820:case 32819:case 34042:e.raise("unsupported format for automatic conversion");break;default:e.raise("unsupported type conversion")}if(this.data){if(this.needsTranspose){l=this.data;q=this.width;p=this.height;t=this.channels;u=this.strideX;v=this.strideY;y=this.strideC;z=this.offset;for(var x=
new l.constructor(q*p*t),C=0,D=0;D<p;++D)for(var J=0;J<q;++J)for(var K=0;K<t;++K)x[C++]=l[v*D+u*J+y*K+z];this.data=x}switch(h){case 5121:e(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray,"incompatible pixel type");break;case 33635:case 32820:case 32819:case 5123:case 36193:e(this.data instanceof Uint16Array,"incompatible pixel type");break;case 5125:e(this.data instanceof Uint32Array,"incompatible pixel type");break;case 5126:e(this.data instanceof Float32Array,"incompatible pixel type");
break;default:e.raise("bad or missing pixel type")}}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){d.pixelStorei(37440,this.flipY);d.pixelStorei(37441,this.premultiplyAlpha);d.pixelStorei(37443,this.colorSpace);d.pixelStorei(3317,this.unpackAlignment);var b=this.target,c=this.miplevel,e=this.image,f=this.canvas,h=this.video,m=this.data,n=this.internalformat,l=this.format,p=this.type,q=this.width||
Math.max(1,a.width>>c);a=this.height||Math.max(1,a.height>>c);h&&2<h.readyState?d.texImage2D(b,c,l,l,p,h):e&&e.complete?d.texImage2D(b,c,l,l,p,e):f?d.texImage2D(b,c,l,l,p,f):this.compressed?d.compressedTexImage2D(b,c,n,q,a,0,m):this.copy?(t(),d.copyTexImage2D(b,c,l,this.x,this.y,q,a,0)):m?d.texImage2D(b,c,l,q,a,0,l,p,m):d.texImage2D(b,c,l,q||1,a||1,0,l,p,null)}});l(fa.prototype,{parse:function(a){if("object"===typeof a&&a){if("min"in a){var b=a.min;e.parameter(b,X);this.minFilter=X[b]}"mag"in a&&
(b=a.mag,e.parameter(b,ma),this.magFilter=ma[b]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var d=a.wrap;"string"===typeof d?(e.parameter(d,K),b=c=K[d]):Array.isArray(d)&&(e.parameter(d[0],K),e.parameter(d[1],K),b=K[d[0]],c=K[d[1]])}else"wrapS"in a&&(b=a.wrapS,e.parameter(b,K),b=K[b]),"wrapT"in a&&(c=a.wrapT,e.parameter(c,K),c=K[c]);this.wrapS=b;this.wrapT=c;"anisotropic"in a&&(b=a.anisotropic,e("number"===typeof b&&1<=b&&b<=h.maxAnisotropic,"aniso samples must be between 1 and "),this.anisotropic=
a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":e.parameter(a,y,"invalid mipmap hint");this.mipmapHint=y[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a;break;case "object":break;default:e.raise("invalid mipmap type")}}},upload:function(){var a=this.target;d.texParameteri(a,10241,this.minFilter);d.texParameteri(a,10240,this.magFilter);d.texParameteri(a,10242,this.wrapS);d.texParameteri(a,10243,this.wrapT);f.ext_texture_filter_anisotropic&&d.texParameteri(a,
34046,this.anisotropic);this.genMipmaps&&(d.hint(33170,this.mipmapHint),d.generateMipmap(a))}});var J=0,v=0,p={},C=[],D=h.maxTextureUnits,aa=Array(D).map(function(){return null});l(T.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<D;++b){var c=aa[b];if(c){if(0<c.bindCount)continue;c.unit=-1}aa[b]=this;a=b;break}a>=D&&e.raise("insufficient number of texture units");this.unit=a;d.activeTexture(33984+a);d.bindTexture(this.target,this.texture);J=a}return a},unbind:function(){--this.bindCount},
decRef:function(){0===--this.refCount&&la(this)}});return{create:function(a,b){function c(a,e,g,f,h,k){var m=a||{};34067===b&&6===arguments.length&&(m=[a,e,g,f,h,k]);ca(d,m);c.width=d.params.width;c.height=d.params.height;return c}var d=new T(b);p[d.id]=d;c(a);c._reglType="texture";c._texture=d;c.destroy=function(){d.decRef()};return c},refresh:function(){Q(p).forEach(ka);for(var a=0;a<D;++a)aa[a]=null;J=0;d.activeTexture(33984)},clear:function(){for(var a=0;a<D;++a)d.activeTexture(33984+a),d.bindTexture(3553,
null),aa[a]=null;d.activeTexture(33984);J=0;Q(p).forEach(la)},poll:function(){C.forEach(ka)},getTexture:function(a){return null}}}},{"./check":4,"./extend":15,"./is-ndarray":18,"./is-typed-array":19,"./load-texture":21,"./parse-dds":22,"./to-half-float":31,"./values":33}],31:[function(d,f,h){f.exports=function(b){for(var d=new Float32Array(b),d=new Uint32Array(d.buffer),c=new Uint16Array(b.length),a=0;a<b.length;++a)if(isNaN(b[a]))c[a]=65535;else if(Infinity===b[a])c[a]=31744;else if(-Infinity===
b[a])c[a]=64512;else{var f=d[a],e=f>>>31<<15,h=(f<<1>>>24)-127,f=f>>13&1023;c[a]=-24>h?e:-14>h?e+(f+1024>>-14-h):15<h?e+31744:e+(h+15<<10)+f}return c}},{}],32:[function(d,f,h){f.exports=function(b){var d={};return{def:function(c){c=b.id(c);var a=d[c];a||(a=d[c]=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]);return a}}}},{}],33:[function(d,f,h){f.exports=function(b){return Object.keys(b).map(function(d){return b[d]})}},{}],34:[function(d,f,h){var b=d("./lib/check"),m=d("./lib/extend"),c=d("./lib/context"),a=
d("./lib/strings"),n=d("./lib/extension"),e=d("./lib/limits"),l=d("./lib/buffer"),Q=d("./lib/elements"),F=d("./lib/texture"),N=d("./lib/renderbuffer"),A=d("./lib/framebuffer"),r=d("./lib/uniform"),q=d("./lib/attribute"),z=d("./lib/shader"),k=d("./lib/draw"),O=d("./lib/state"),u=d("./lib/compile"),t=d("./lib/read"),ea=d("./lib/dynamic"),W=d("./lib/raf"),fa=d("./lib/clock");f.exports=function(){function d(){I=W.next(d);D.count+=1;if(D.width!==y.drawingBufferWidth||D.height!==y.drawingBufferHeight)D.width=
y.drawingBufferWidth,D.height=y.drawingBufferHeight,aa.notifyViewportChanged();var a=fa();D.dt=a-D.t;D.t=a;v.poll();for(var b=0;b<E.length;++b)(0,E[b])(D.count,D.t,D.dt);D.renderTime=fa()-a}function f(){I&&(W.cancel(d),I=0)}function h(a){f();a.preventDefault();if(K.onContextLost)K.onContextLost()}function ka(a){y.getError();ma.refresh();R.refresh();v.refresh();p.refresh();C.refresh();L.refresh();aa.refresh();if(K.onContextRestored)K.onContextRestored();d()}function oa(a){function c(a){var b={},e=
{};Object.keys(a).forEach(function(c){var f=a[c];ea.isDynamic(f)?(d=!0,e[c]=ea.unbox(f,c)):b[c]=f});return{dynamic:e,"static":b}}b(!!a,"invalid args to regl({...})");b.type(a,"object","invalid args to regl({...})");var d=!1,e=c(a.uniforms||{}),f=c(a.attributes||{});a=c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=m({},a);delete c.uniforms;delete c.attributes;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");
b("sample");return c}(a));var e=g.command(a["static"],e["static"],f["static"],a.dynamic,e.dynamic,f.dynamic,d),h=e.draw,k=e.batch,l=e.scope,n=[];return function(a,b){if("number"===typeof a){for(var c=a|0;n.length<c;)n.push(null);return k(a|0,n)}return Array.isArray(a)?k(a.length,a):"function"===typeof a?l(null,a):"function"===typeof b?l(a,b):h(a)}}function ha(){C.poll();aa.poll()}var la=c(Array.prototype.slice.call(arguments)),y=la.gl,K=la.options,la=a(),ma=n(y),X=ma.extensions,ia={width:y.drawingBufferWidth,
height:y.drawingBufferHeight},ba=e(y,X),R=l(y),Z=Q(y,X,R),U=r(la),Y=q(y,X,ba,R,la),L=z(y,Y,U,function(a){return g.draw(a)},la),J=k(y,X,R),v=F(y,X,ba,ha,ia),p=N(y,X,ba),C=A(y,X,ba,v,p),D={count:0,start:fa(),dt:0,t:fa(),renderTime:0,width:y.drawingBufferWidth,height:y.drawingBufferHeight,pixelRatio:K.pixelRatio},aa=O(y,C,ia),ia=t(y,ha,ia),g=u(y,la,X,ba,R,Z,v,C,aa,U,Y,L,J,D,ha),H=y.canvas,E=[],I=0;H&&(H.addEventListener("webglcontextlost",h,!1),H.addEventListener("webglcontextrestored",ka,!1));return m(oa,
{clear:function(a){var c=0;ha();var d=a.color;d&&(y.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in a&&(y.clearDepth(+a.depth),c|=256);"stencil"in a&&(y.clearStencil(a.stencil|0),c|=1024);b(!!c,"called regl.clear with no buffer specified");y.clear(c)},prop:ea.define,draw:oa({}),elements:function(a){return Z.create(a)},buffer:function(a){return R.create(a,34962)},texture:function(a){return v.create(a,3553)},cube:function(a){return 6===arguments.length?v.create(Array.prototype.slice.call(arguments),
34067):v.create(a,34067)},renderbuffer:function(a){return p.create(a)},framebuffer:function(a){return C.create(a)},framebufferCube:function(a){b.raise("framebuffer cube not yet implemented")},frame:function(a){E.push(a);!I&&0<E.length&&d();return{cancel:function(){var b=E.find(function(b){return b===a});0>b||(E.splice(b,1),0>=E.length&&f())}}},stats:D,limits:ba,read:ia,destroy:function(){f();H&&(H.removeEventListener("webglcontextlost",h),H.removeEventListener("webglcontextrestored",ka));L.clear();
C.clear();p.clear();v.clear();R.clear();if(K.onDestroy)K.onDestroy()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/check":4,"./lib/clock":5,"./lib/compile":7,"./lib/context":11,"./lib/draw":12,"./lib/dynamic":13,"./lib/elements":14,"./lib/extend":15,"./lib/extension":16,"./lib/framebuffer":17,"./lib/limits":20,"./lib/raf":23,"./lib/read":24,"./lib/renderbuffer":25,"./lib/shader":26,"./lib/state":28,"./lib/strings":29,"./lib/texture":30,"./lib/uniform":32}]},{},[1]);

        </script>
        </body>
      </html>