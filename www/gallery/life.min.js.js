(function e$$0(l,q,h){function e(b,c){if(!q[b]){if(!l[b]){var a="function"==typeof require&&require;if(!c&&a)return a(b,!0);if(d)return d(b,!0);a=Error("Cannot find module '"+b+"'");throw a.code="MODULE_NOT_FOUND",a;}a=q[b]={exports:{}};l[b][0].call(a.exports,function(c){var d=l[b][1][c];return e(d?d:c)},a,a.exports,e$$0,l,q,h)}return q[b].exports}for(var d="function"==typeof require&&require,a=0;a<h.length;a++)e(h[a]);return e})({1:[function(f,l,q){var h=f("../regl")(),e=Array(1048576).fill(0).map(function(){return.9<
Math.random()?255:0}),d=Array(2).fill().map(function(){return h.framebuffer({colorBuffer:h.texture({radius:512,data:e,wrap:"repeat"}),depth:!1})}),a=h({frag:"\n  precision mediump float;\n  uniform sampler2D prevState;\n  varying vec2 uv;\n  void main() {\n    float n = 0.0;\n    for(int dx=-1; dx<=1; ++dx)\n    for(int dy=-1; dy<=1; ++dy) {\n      n += texture2D(prevState, uv+vec2(dx,dy)/float(512)).r;\n    }\n    float s = texture2D(prevState, uv).r;\n    if(n > 3.0+s || n < 3.0) {\n      gl_FragColor = vec4(0,0,0,1);\n    } else {\n      gl_FragColor = vec4(1,1,1,1);\n    }\n  }",
framebuffer:function(b){return d[(b.count+1)%2]}}),b=h({frag:"\n  precision mediump float;\n  uniform sampler2D prevState;\n  varying vec2 uv;\n  void main() {\n    float state = texture2D(prevState, uv).r;\n    gl_FragColor = vec4(vec3(state), 1);\n  }",vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main() {\n    uv = 0.5 * (position + 1.0);\n    gl_Position = vec4(position, 0, 1);\n  }",attributes:{position:[-4,-4,4,-4,0,4]},uniforms:{prevState:function(b){return d[b.count%
2].color[0]}},depth:{enable:!1},count:3});h.frame(function(){b(function(){h.draw();a()})})},{"../regl":34}],2:[function(f,l,q){function h(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}l.exports=function(e,d,a,b,c){e=a.maxAttributes;d=Array(e);for(a=0;a<e;++a)d[a]=new h;return{Record:h,scope:{},state:d}}},{}],3:[function(f,l,q){function h(b,c){for(var d=0;d<c.length;++d)b[d]=c[d]}var e=f("./util/is-typed-array"),
d=f("./util/is-ndarray"),a=f("./util/values"),b=f("./util/flatten"),c=f("./util/transpose"),t=f("./util/pool"),H=f("./constants/arraytypes.json"),W=f("./constants/dtypes.json"),z=f("./constants/usage.json");l.exports=function(f){function r(b){this.id=n++;this.buffer=f.createBuffer();this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121}function u(b,d,c){b.byteLength=d.byteLength;f.bufferData(b.type,d,c)}function m(a,m,n,f,r){a.usage=n;if(Array.isArray(m))a.dtype=f||5126,
0<m.length&&Array.isArray(m[0])?(a.dimension=m[0].length,f=t.allocType(a.dtype,m.length*a.dimension),b(f,m,a.dimension)):(a.dimension=r,f=t.allocType(a.dtype,m.length),h(f,m)),u(a,f,n),t.freeType(f);else if(e(m))a.dtype=f||H[Object.prototype.toString.call(m)]|0,a.dimension=r,u(a,m,n);else if(d(m)){var v=m.shape,w=m.stride;r=m.offset;var M=0,X=0,l=0,G=0;1===v.length?(M=v[0],X=1,l=w[0],G=0):2===v.length&&(M=v[0],X=v[1],l=w[0],G=w[1]);a.dtype=f||H[Object.prototype.toString.call(m.data)]|0||5126;a.dimension=
X;f=t.allocType(a.dtype,M*X);c(f,m.data,M,X,l,G,r);u(a,f,n);t.freeType(f)}}function w(b){var d=b.buffer;f.isBuffer(d)&&f.deleteBuffer(d);b.buffer=null;delete l[b.id]}var n=0,l={};r.prototype.bind=function(){f.bindBuffer(this.type,this.buffer)};var J=[];return{create:function(a,n,u){function J(b){var a=35044,c=null,h=0,n=0,r=1;Array.isArray(b)||e(b)||d(b)?c=b:"number"===typeof b?h=b|0:b&&("data"in b&&(c=b.data),"usage"in b&&(a=z[b.usage]),"type"in b&&(n=W[b.type]),"dimension"in b&&(r=b.dimension|0),
"length"in b&&(h=b.length|0));q.bind();c?m(q,c,a,n,r):(f.bufferData(q.type,h,a),q.dtype=n||5121,q.usage=a,q.dimension=r,q.byteLength=h);return J}var q=new r(n);l[q.id]=q;u||J(a);J._reglType="buffer";J._buffer=q;J.subdata=function(a,m){var n=(m||0)|0;q.bind();if(Array.isArray(a))if(0<a.length&&Array.isArray(a[0])){var r=a[0].length,w=t.allocType(q.dtype,a.length*r);b(w,a,r);f.bufferSubData(q.type,n,w);t.freeType(w)}else r=t.allocType(q.dtype,a.length),h(r,a),f.bufferSubData(q.type,n,r),t.freeType(r);
else if(e(a))f.bufferSubData(q.type,n,a);else if(d(a)){var l=a.shape,u=a.stride,y=w=r=0,F=0;1===l.length?(r=l[0],w=1,y=u[0],F=0):2===l.length&&(r=l[0],w=l[1],y=u[0],F=u[1]);l=Array.isArray(a.data)?q.dtype:H[Object.prototype.toString.call(a.data)]|0;l=t.allocType(l,r*w);c(l,a.data,r,w,y,F,a.offset);f.bufferSubData(q.type,n,l);t.freeType(l)}return J};J.destroy=function(){w(q)};return J},createStream:function(b,a){var c=J.pop();c||(c=new r(b),c.buffer=f.createBuffer());c.bind();m(c,a,35040,0,1);return c},
destroyStream:function(b){J.push(b)},clear:function(){a(l).forEach(w)},getBuffer:function(b){return b&&b._buffer instanceof r?b._buffer:null},_initBuffer:m}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/flatten":22,"./util/is-ndarray":23,"./util/is-typed-array":24,"./util/pool":28,"./util/transpose":31,"./util/values":32}],4:[function(f,l,q){l.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,
"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(f,l,q){l.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],6:[function(f,l,q){l.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(f,l,q){l.exports={"static":35044,dynamic:35048,
stream:35040}},{}],8:[function(f,l,q){function h(b){return Array.isArray(b)||W(b)||z(b)}function e(b){return b.sort(function(b,a){return"viewport"===b?-1:"viewport"===a?1:b<a?-1:1})}function d(b,a,c,d){this.thisDep=b;this.contextDep=a;this.propDep=c;this.append=d}function a(b){return b&&!(b.thisDep||b.contextDep||b.propDep)}function b(b){return new d(!1,!1,!1,b)}function c(b,a){var c=b.type;return 0===c?(c=b.data.length,new d(!0,1<=c,2<=c,a)):new d(3===c,2===c,1===c,a)}var t=f("./util/codegen"),H=
f("./util/loop"),W=f("./util/is-typed-array"),z=f("./util/is-ndarray"),A=f("./constants/primitives.json"),r=f("./constants/dtypes.json"),u=["x","y","z","w"],m={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},w={never:512,less:513,
"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},n={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},y={cw:2304,ccw:2305},J=new d(!1,!1,!1,function(){});l.exports=function(f,l,q,z,R,v,ka,M,X,Y,G,Z,I){function Q(b){return b.replace(".","_")}function K(b,k,a){var c=Q(b);oa.push(b);la[c]=fa[c]=!!a;ga[c]=k}function D(b,k,a){var c=
Q(b);oa.push(b);Array.isArray(a)?(fa[c]=a.slice(),la[c]=a.slice()):fa[c]=la[c]=a;ha[c]=k}function B(){var b=t(),k=b.link,a=b.global;b.id=Aa++;b.batchId="0";var c=k(wa),d=b.shared={props:"a0"};Object.keys(wa).forEach(function(g){d[g]=a.def(c,".",g)});var C=b.next={},p=b.current={};Object.keys(ha).forEach(function(g){Array.isArray(fa[g])&&(C[g]=a.def(d.next,".",g),p[g]=a.def(d.current,".",g))});var g=b.constants={};Object.keys(pa).forEach(function(b){g[b]=a.def(JSON.stringify(pa[b]))});b.invoke=function(g,
a){switch(a.type){case 0:var aa=["this",d.context,d.props,b.batchId];return g.def(k(a.data),".call(",aa.slice(0,Math.max(a.data.length+1,4)),")");case 1:return g.def(d.props,a.data);case 2:return g.def(d.context,a.data);case 3:return g.def("this",a.data)}};b.attribCache={};var aa={};b.scopeAttrib=function(g){g=l.id(g);if(g in aa)return aa[g];var b=Y.scope[g];b||(b=Y.scope[g]=new ma);return aa[g]=k(b)};return b}function ba(k){var a=k["static"];k=k.dynamic;if("framebuffer"in a){var d=a.framebuffer;
return d?(d=M.getFramebuffer(d),b(function(b,k){var a=b.link(d),g=b.shared;k.set(g.framebuffer,".next",a);g=g.context;k.set(g,".framebufferWidth",a+".width");k.set(g,".framebufferHeight",a+".height");return a})):b(function(b,k){var a=b.shared;k.set(a.framebuffer,".next","null");a=a.context;k.set(a,".framebufferWidth",a+".drawingBufferWidth");k.set(a,".framebufferHeight",a+".drawingBufferHeight");return null})}if("framebuffer"in k){var p=k.framebuffer;return c(p,function(b,k){var a=b.invoke(k,p),g=
b.shared,aa=g.framebuffer,a=k.def(aa,".getFramebuffer(",a,")");k.set(aa,".next",a);g=g.context;k.set(g,".framebufferWidth",a+"?"+a+".width:"+g+".drawingBufferWidth");k.set(g,".framebufferHeight",a+"?"+a+".height:"+g+".drawingBufferHeight");return a})}return null}function ia(b,a){function k(g){if(g in p){var b=p[g];g=!0;var x=b.x|0,xa=b.y|0,C,h;"w"in b?C=b.w|0:g=!1;"h"in b?h=b.h|0:g=!1;return new d(g&&a&&a.thisDep,g&&a&&a.contextDep,g&&a&&a.propDep,function(g,a){var k=g.shared.context,c=C;"w"in b||
(c=a.def(k,".","framebufferWidth","-",x));var d=h;"h"in b||(d=a.def(k,".","framebufferHeight","-",xa));return[x,xa,c,d]})}if(g in m){var e=m[g];g=c(e,function(g,b){var a=g.invoke(b,e),k=g.shared.context,c=b.def(a,".x|0"),aa=b.def(a,".y|0"),x=b.def('"w" in ',a,"?",a,".w|0:","(",k,".","framebufferWidth","-",c,")"),a=b.def('"h" in ',a,"?",a,".h|0:","(",k,".","framebufferHeight","-",aa,")");return[c,aa,x,a]});a&&(g.thisDep=g.thisDep||a.thisDep,g.contextDep=g.contextDep||a.contextDep,g.propDep=g.propDep||
a.prpoDep);return g}return a?new d(a.thisDep,a.contextDep,a.propDep,function(g,b){var a=g.shared.context;return[0,0,b.def(a,".","framebufferWidth"),b.def(a,".","framebufferHeight")]}):null}var p=b["static"],m=b.dynamic,C=k("viewport");if(C)var h=C,C=new d(C.thisDep,C.contextDep,C.propDep,function(g,b){var a=h.append(g,b),k=g.shared.context;b.set(k,".viewportWidth",a[2]);b.set(k,".viewportHeight",a[3]);return a});return{viewport:C,scissor_box:k("scissor.box")}}function L(k){function p(g){if(g in m){var a=
l.id(m[g]);g=b(function(){return a});g.id=a;return g}if(g in h){var k=h[g];return c(k,function(g,b){var a=g.invoke(b,k);return b.def(g.shared.strings,".id(",a,")")})}return null}var m=k["static"],h=k.dynamic,e=p("frag"),C=p("vert"),n=null;a(e)&&a(C)?(n=G.program(C.id,e.id),k=b(function(g,b){return g.link(n)})):k=new d(e&&e.thisDep||C&&C.thisDep,e&&e.contextDep||C&&C.contextDep,e&&e.propDep||C&&C.propDep,function(g,b){var a=g.shared.shader,k;k=e?e.append(g,b):b.def(a,".","frag");var c;c=C?C.append(g,
b):b.def(a,".","vert");return b.def(a+".program("+c+","+k+")")});return{frag:e,vert:C,progVar:k,program:n}}function E(k){function p(a,g){if(a in e){var k=e[a]|0;return b(function(b,a){g&&(b.OFFSET=k);return k})}if(a in m){var d=m[a];return c(d,function(b,a){var k=b.invoke(a,d);g&&(b.OFFSET=k);return k})}return g&&n?b(function(g,b){g.OFFSET="0";return 0}):null}var e=k["static"],m=k.dynamic,n=function(){if("elements"in e){var a=e.elements;h(a)?a=v.getElements(v.create(a)):a&&(a=v.getElements(a));var g=
b(function(g,b){if(a){var k=g.link(a);return g.ELEMENTS=k}return g.ELEMENTS=null});g.value=a;return g}if("elements"in m){var k=m.elements;return c(k,function(g,b){var a=g.shared,c=a.isBufferArgs,a=a.elements,d=g.invoke(b,k),x=b.def("null"),c=b.def(c,"(",d,")"),d=g.cond(c).then(x,"=",a,".createStream(",d,");")["else"](x,"=",a,".getElements(",d,");");b.entry(d);b.exit(g.cond(c).then(a,".destroyStream(",x,");"));return g.ELEMENTS=x})}return null}(),C=p("offset",!0);return{elements:n,primitive:function(){if("primitive"in
e){var k=e.primitive;return b(function(g,b){return A[k]})}if("primitive"in m){var g=m.primitive;return c(g,function(b,a){var k=b.constants.primTypes,c=b.invoke(a,g);return a.def(k,"[",c,"]")})}return n?a(n)?n.value?b(function(g,b){return b.def(g.ELEMENTS,".primType")}):b(function(){return 4}):new d(n.thisDep,n.contextDep,n.propDep,function(g,b){var a=g.ELEMENTS;return b.def(a,"?",a,".primType:",4)}):null}(),count:function(){if("count"in e){var k=e.count|0;return b(function(){return k})}if("count"in
m){var g=m.count;return c(g,function(b,a){return b.invoke(a,g)})}return n?a(n)?n?C?new d(C.thisDep,C.contextDep,C.propDep,function(g,b){return b.def(g.ELEMENTS,".vertCount-",g.OFFSET)}):b(function(g,b){return b.def(g.ELEMENTS,".vertCount")}):b(function(){return-1}):new d(n.thisDep||C.thisDep,n.contextDep||C.contextDep,n.propDep||C.propDep,function(g,b){var a=g.ELEMENTS;return g.OFFSET?b.def(a,"?",a,".vertCount-",g.OFFSET,":-1"):b.def(a,"?",a,".vertCount:-1")}):null}(),instances:p("instances",!1),
offset:C}}function S(a){var k=a["static"],d=a.dynamic,p={};oa.forEach(function(a){function x(g,m){if(a in k){var h=g(k[a]);p[e]=b(function(){return h})}else if(a in d){var n=d[a];p[e]=c(n,function(g,a){return m(g,a,g.invoke(a,n))})}}var e=Q(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return x(function(g){return g},function(g,a,
b){return b});case "depth.func":return x(function(g){return w[g]},function(g,a,b){return a.def(g.constants.compareFuncs,"[",b,"]")});case "depth.range":return x(function(g){return g},function(g,a,b){g=a.def("+",b,"[0]");a=a.def("+",b,"[1]");return[g,a]});case "blend.func":return x(function(g){return[m["srcRGB"in g?g.srcRGB:g.src],m["dstRGB"in g?g.dstRGB:g.dst],m["srcAlpha"in g?g.srcAlpha:g.src],m["dstAlpha"in g?g.dstAlpha:g.dst]]},function(g,a,b){function k(g,x){var d=a.def('"',g,x,'" in ',b,"?",
b,".",g,x,":",b,".",g);return a.def(c,"[",d,"]")}var c=g.constants.blendFuncs;g=k("src","RGB");var x=k("src","Alpha"),d=k("dst","RGB"),p=k("dst","Alpha");return[g,d,x,p]});case "blend.equation":return x(function(g){if("string"===typeof g)return[ja[g],ja[g]];if("object"===typeof g)return[ja[g.rgb],ja[g.alpha]]},function(g,a,b){var k=g.constants.blendEquations,c=a.def(),x=a.def();g=g.cond("typeof ",b,'==="string"');g.then(c,"=",x,"=",k,"[",b,"];");g["else"](c,"=",k,"[",b,".rgb];",x,"=",k,"[",b,".alpha];");
a(g);return[c,x]});case "blend.color":return x(function(g){return H(4,function(a){return+g[a]})},function(g,a,b){return H(4,function(g){return a.def("+",b,"[",g,"]")})});case "stencil.mask":return x(function(g){return g|0},function(g,a,b){return a.def(b,"|0")});case "stencil.func":return x(function(g){return[w[g.cmp||"keep"],g.ref||0,"mask"in g?g.mask:-1]},function(g,a,b){g=a.def('"cmp" in ',b,"?",g.constants.compareFuncs,"[",b,".cmp]",":",7680);var k=a.def(b,".ref|0");a=a.def('"mask" in ',b,"?",
b,".mask|0:-1");return[g,k,a]});case "stencil.opFront":case "stencil.opBack":return x(function(g){return["stencil.opBack"===a?1029:1028,n[g.fail||"keep"],n[g.zfail||"keep"],n[g.pass||"keep"]]},function(g,b,k){function c(a){return b.def('"',a,'" in ',k,"?",x,"[",k,".",a,"]:",7680)}var x=g.constants.stencilOps;return["stencil.opBack"===a?1029:1028,c("fail"),c("zfail"),c("pass")]});case "polygonOffset.offset":return x(function(a){return[a.factor|0,a.units|0]},function(a,b,k){a=b.def(k,".factor|0");b=
b.def(k,".units|0");return[a,b]});case "cull.face":return x(function(a){var b=0;"front"===a?b=1028:"back"===a&&(b=1029);return b},function(a,b,k){return b.def(k,'==="front"?',1028,":",1029)});case "lineWidth":return x(function(a){return a},function(a,b,k){return k});case "frontFace":return x(function(a){return y[a]},function(a,b,k){return b.def(k+'==="cw"?2304:2305')});case "colorMask":return x(function(a){return a.map(function(a){return!!a})},function(a,b,k){return H(4,function(a){return"!!"+k+"["+
a+"]"})});case "sample.coverage":return x(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,b,k){a=b.def('"value" in ',k,"?+",k,".value:1");b=b.def("!!",k,".invert");return[a,b]})}});return p}function U(a){var k=a["static"],d=a.dynamic,p={};Object.keys(k).forEach(function(a){var c=k[a],x;if("number"===typeof c||"boolean"===typeof c)x=b(function(){return c});else if("function"===typeof c&&"texture"===c._reglType)x=b(function(a){return a.link(c)});else if(Array.isArray(c)||W(c))x=b(function(a){return a.global.def("[",
H(c.length,function(a){return c[a]}),"]")});x.value=c;p[a]=x});Object.keys(d).forEach(function(a){var b=d[a];p[a]=c(b,function(a,g){return a.invoke(g,b)})});return p}function P(a){var k=a["static"],d=a.dynamic,p={};Object.keys(k).forEach(function(a){var c=k[a],x=l.id(a),g=new ma;if(h(c))g.state=1,g.buffer=R.getBuffer(R.create(c,34962,!1)),g.type=g.buffer.dtype;else{var d=R.getBuffer(c);if(d)g.state=1,g.buffer=d,g.type=d.dtype;else if(c.constant){var e=c.constant;g.state=2;"number"===typeof e?g.x=
e:u.forEach(function(a,b){b<e.length&&(g[a]=e[b])})}else{var d=R.getBuffer(c.buffer),m=c.offset|0,n=c.stride|0,f=c.size|0,za=!!c.normalized,T=0;"type"in c&&(T=r[c.type]);c=c.divisor|0;g.buffer=d;g.state=1;g.size=f;g.normalized=za;g.type=T||d.dtype;g.offset=m;g.stride=n;g.divisor=c}}p[a]=b(function(a,b){var k=a.attribCache;if(x in k)return k[x];var c={isStream:!1};Object.keys(g).forEach(function(a){c[a]=g[a]});g.buffer&&(c.buffer=a.link(g.buffer));return k[x]=c})});Object.keys(d).forEach(function(a){var b=
d[a];p[a]=c(b,function(a,g){function k(a){g(e[a],"=",c,".",a,"|0;")}var c=a.invoke(g,b),x=a.shared,d=x.isBufferArgs,p=x.buffer,e={isStream:g.def(!1)},m=new ma;m.state=1;Object.keys(m).forEach(function(a){e[a]=g.def(""+m[a])});var n=e.buffer,h=e.type;g("if(",d,"(",c,")){",e.isStream,"=true;",n,"=",p,".createStream(",34962,",",c,");",h,"=",n,".dtype;","}else{",n,"=",p,".getBuffer(",c,");","if(",n,"){",h,"=",n,".dtype;","}else if(",c,".constant){",e.state,"=",2,";",u.map(function(a,b){return e[a]+"="+
c+".length>="+b+"?"+c+"["+b+"]:0;"}).join(""),"}else{",n,"=",p,".getBuffer(",c,".buffer);",h,'="type" in ',c,"?",x.glTypes,"[",c,".type]:",n,".dtype;",e.normalized,"=!!",c,".normalized;");k("size");k("offset");k("stride");k("divisor");g("}}");return e})});return p}function N(a){var k=a["static"],d=a.dynamic,p={};Object.keys(k).forEach(function(a){var c=k[a];p[a]=b(function(a,b){return"number"===typeof c||"boolean"===typeof c?""+c:a.link(c)})});Object.keys(d).forEach(function(a){var b=d[a];p[a]=c(b,
function(a,k){return a.invoke(k,b)})});return p}function V(a,b,k){var c=a.shared.context,d=a.scope();Object.keys(k).forEach(function(p){b.save(c,"."+p);d(c,".",p,"=",k[p].append(a,b),";")});b(d)}function k(a,b,k){var c=a.shared,d=c.gl,p=c.framebuffer,e;qa&&(e=b.def(c.extensions,".webgl_draw_buffers"));var g=a.constants,c=g.drawBuffers,g=g.backBuffer;a=k?k.append(a,b):b.def(p,".next");b("if(",p,".dirty||",a,"!==",p,".cur){","if(",a,"){",d,".bindFramebuffer(",36160,",",a,".framebuffer);");qa&&b(e,".drawBuffersWEBGL(",
c,"[",a,".colorAttachments.length]);");b("}else{",d,".bindFramebuffer(",36160,",null);");qa&&b(e,".drawBuffersWEBGL(",g,");");b("}",p,".cur=",a,";",p,".dirty=false;","}")}function ca(a,b,k){var c=a.shared,d=c.gl,p=a.current,e=a.next,g=c.current,m=c.next,n=a.cond(g,".dirty");oa.forEach(function(b){b=Q(b);if(!(b in k.state)){var c,h;if(b in e){c=e[b];h=p[b];var f=H(fa[b].length,function(a){return n.def(c,"[",a,"]")});n(a.cond(f.map(function(a,b){return a+"==="+h+"["+b+"]"}).join("&&")).then(d,".",ha[b],
"(",f,");",f.map(function(a,b){return h+"["+b+"]="+a}).join(";"),";"))}else c=n.def(m,".",b),f=a.cond(c,"!==",g,".",b),n(f),b in ga?f(a.cond(c).then(d,".enable(",ga[b],");")["else"](d,".disable(",ga[b],");"),g,".",b,"=",c,";"):f(d,".",ha[b],"(",c,");",g,".",b,"=",c,";")}});0===Object.keys(k.state).length&&n(g,".dirty=false;");b(n)}function p(b,k,c,d){var p=b.shared,m=b.current,n=p.current,g=p.gl;e(Object.keys(c)).forEach(function(p){var e=c[p];if(!d||d(e)){var h=e.append(b,k);if(ga[p]){var f=ga[p];
a(e)?h?k(g,".enable(",f,");"):k(g,".disable(",f,");"):k(b.cond(h).then(g,".enable(",f,");")["else"](g,".disable(",f,");"));k(n,".",p,"=",h,";")}else if(Array.isArray(h)){var r=m[p];k(g,".",ha[p],"(",h,");",h.map(function(a,b){return r+"["+b+"]="+a}).join(";"),";")}else k(g,".",ha[p],"(",h,");",n,".",p,"=",h,";")}})}function T(a,b){na&&!a.instancing&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function ra(a,b,k,c,d){function p(a){switch(a){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function e(k,c,d){function p(){b("if(!",f,".pointer){",n,".enableVertexAttribArray(",h,");",f,".pointer=true;}");var k=d.type,g;g=d.size?b.def(d.size,"||",c):c;b("if(",f,".type!==",k,"||",f,".size!==",g,"||",l.map(function(a){return f+"."+a+"!=="+d[a]}).join("||"),"){",n,".bindBuffer(",34962,",",r,".buffer);",n,".vertexAttribPointer(",[h,g,k,d.normalized,d.stride,d.offset],");",f,".type=",k,";",f,
".size=",g,";",l.map(function(a){return f+"."+a+"="+d[a]+";"}).join(""),"}");na&&(k=d.divisor,b("if(",f,".divisor!==",k,"){",a.instancing,".vertexAttribDivisorANGLE(",[h,k],");",f,".divisor=",k,";}"))}function m(){b("if(",f,".pointer){",n,".disableVertexAttribArray(",h,");",f,".pointer=false;","}if(",u.map(function(a,b){return f+"."+a+"!=="+T[b]}).join("||"),"){",n,".vertexAttrib4f(",h,",",T,");",u.map(function(a,b){return f+"."+a+"="+T[b]+";"}).join(""),"}")}var n=g.gl,h=b.def(k,".location"),f=b.def(g.attributes,
"[",h,"]");k=d.state;var r=d.buffer,T=[d.x,d.y,d.z,d.w],l=["buffer","normalized","offset","stride"];1===k?p():2===k?m():(b("if(",k,"===",1,"){"),p(),b("}else{"),m(),b("}"))}var g=a.shared;c.forEach(function(g){var c=g.name,m=k.attributes[c],n;if(m){if(!d(m))return;n=m.append(a,b)}else{if(!d(J))return;var h=a.scopeAttrib(c);n={};Object.keys(new ma).forEach(function(a){n[a]=b.def(h,".",a)})}e(a.link(g),p(g.info.type),n)})}function sa(a,b,k,c,d){for(var p=a.shared,e=p.gl,g,n=0;n<c.length;++n){var m=
c[n],h=m.name,f=m.info.type,r=k.uniforms[h],m=a.link(m)+".location";if(r){if(!d(r))continue;if(r["static"]){h=r.value;if(35678===f||35680===f)f=a.link(h._texture),b(e,".uniform1i(",m,f+".bind());"),b.exit(f,".unbind()");else if(35674===f||35675===f||35676===f)h=a.global.def("["+h+"]"),r=2,35675===f?r=3:35676===f&&(r=4),b(e,".uniformMatrix",r,"fv(",m,",false,",h,");");else{switch(f){case 5126:g="1f";break;case 35664:g="2f";break;case 35665:g="3f";break;case 35666:g="4f";break;case 35670:g="1i";break;
case 5124:g="1i";break;case 35671:g="2i";break;case 35667:g="2i";break;case 35672:g="3i";break;case 35668:g="3i";break;case 35673:g="4i";break;case 35669:g="4i"}b(e,".uniform",g,"(",m,",",h,");")}continue}else h=r.append(a,b)}else{if(!d(J))continue;h=b.def(p.uniforms,"[",l.id(h),"]")}r=",";switch(f){case 35678:case 35680:f=b.def(h,"._texture");b(e,".uniform1i(",m,",",f,".bind());");b.exit(f,".unbind();");continue;case 5124:case 35670:g="1i";break;case 35667:case 35671:g="2iv";break;case 35668:case 35672:g=
"3iv";break;case 35669:case 35673:g="4iv";break;case 5126:g="1f";break;case 35664:g="2fv";break;case 35665:g="3fv";break;case 35666:g="4fv";break;case 35674:g="Matrix2fv";r=",false,";break;case 35675:g="Matrix3fv";r=",false,";break;case 35676:g="Matrix4fv",r=",false,"}b(e,".uniform",g,"(",m,r,h,");")}}function ta(b,k,c,d){function p(a){var g=f[a];return g?g.batchStatic?g.append(b,k):g.append(b,c):k.def(n,".",a)}function e(){function a(){c(u,".drawElementsInstancedANGLE(",[T,w,t,l+"<<(("+t+"-5121)>>1)",
ca],");")}function b(){c(u,".drawArraysInstancedANGLE(",[T,l,w,ca],");")}r?M?a():(c("if(",r,"){"),a(),c("}else{"),b(),c("}")):b()}function m(){function a(){c(h+".drawElements("+[T,w,t,l+"<<(("+t+"-5121)>>1)"]+");")}function b(){c(h+".drawArrays("+[T,l,w]+");")}r?M?a():(c("if(",r,"){"),a(),c("}else{"),b(),c("}")):b()}var g=b.shared,h=g.gl,n=g.draw,f=d.draw,r=function(){var a=f.elements,g=k;a?(a.batchStatic||(g=c),a=a.append(b,g)):a=g.def(n,".","elements");a&&g("if("+a+")"+h+".bindBuffer(34963,"+a+
".buffer.buffer);");return a}(),T=p("primitive"),l=p("offset"),w=function(){var a=f.count,g=k;a?(a.batchStatic||(g=c),a=a.append(b,g)):a=g.def(n,".","count");return a}();if("number"===typeof w){if(0===w)return}else c("if(",w,"){"),c.exit("}");var ca,u;na&&(ca=p("instances"),u=b.instancing);var t=r+".type",M=f.elements&&a(f.elements);na&&("number"!==typeof ca||0<=ca)?"string"===typeof ca?(c("if(",ca,">0){"),e(),c("}else if(",ca,"<0){"),m(),c("}")):e():m()}function ua(a,b,k,c,d){b=B();d=b.proc("body",
d);na&&(b.instancing=d.def(b.shared.extensions,".angle_instanced_arrays"));a(b,d,k,c);return b.compile().body}function ya(a,b,k,c){T(a,b);ra(a,b,k,c.attributes,function(){return!0});sa(a,b,k,c.uniforms,function(){return!0});ta(a,b,b,k)}function Ba(a,b){var c=a.proc("draw",1);T(a,c);V(a,c,b.context);k(a,c,b.framebuffer);ca(a,c,b);p(a,c,b.state);var d=b.shader.progVar.append(a,c);c(a.shared.gl,".useProgram(",d,".program);");if(b.shader.program)ya(a,c,b,b.shader.program);else{var e=a.global.def("{}"),
h=c.def(d,".id"),m=c.def(e,"[",h,"]");c(a.cond(m).then(m,".call(this,a0);")["else"](m,"=",e,"[",h,"]=",a.link(function(k){return ua(ya,a,b,k,1)}),"(",d,");",m,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Ca(a,b,k,c){function d(){return!0}a.batchId="a1";T(a,b);ra(a,b,k,c.attributes,d);sa(a,b,k,c.uniforms,d);ta(a,b,b,k)}function va(a,b,c,d){function e(a){return a.contextDep&&h||a.propDep}function m(a){return!e(a)}T(a,b);var h=c.contextDynamic,g=b.def(),
n=b.def();a.shared.props=n;a.batchId=g;var f=a.scope(),r=a.scope();b(f.entry,"for(",g,"=0;",g,"<","a1",";++",g,"){",n,"=","a0","[",g,"];",r,"}",f.exit);c.needsContext&&V(a,r,c.context);c.needsFramebuffer&&k(a,r,c.framebuffer);p(a,r,c.state,e);d?(ra(a,f,c,d.attributes,m),ra(a,r,c,d.attributes,e),sa(a,f,c,d.uniforms,m),sa(a,r,c,d.uniforms,e),ta(a,f,r,c)):(b=a.global.def("{}"),d=c.shader.progVar.append(a,r),n=r.def(d,".id"),f=r.def(b,"[",n,"]"),r(a.shared.gl,".useProgram(",d,".program);","if(!",f,"){",
f,"=",b,"[",n,"]=",a.link(function(b){return ua(Ca,a,c,b,2)}),"(",d,");}",f,".call(this,a0[",g,"],",g,");"))}function Da(a,b){var c=a.proc("batch",2);a.batchId="0";T(a,c);var d=!1,e=!0;Object.keys(b.context).forEach(function(a){d=d||b.context[a].propDep});d||(V(a,c,b.context),e=!1);var m=b.framebuffer,h=!1;m&&(m.propDep?d=h=!0:m.contextDep&&d&&(h=!0),h||k(a,c,m));b.state.viewport&&b.state.viewport.propDynamic&&(d=!0);ca(a,c,b);p(a,c,b.state,function(a){return!(a.contextDep&&d||a.propDep)});b.contextDep=
d;b.needsContext=e;b.needsFramebuffer=h;e=b.shader.progVar;if(e.contextDep&&d||e.propDep)va(a,c,b,null);else if(e=e.append(a,c),c(a.shared.gl,".useProgram(",e,".program);"),b.shader.program)va(a,c,b,b.shader.program);else{var m=a.global.def("{}"),h=c.def(e,".id"),g=c.def(m,"[",h,"]");c(a.cond(g).then(g,".call(this,a0,a1);")["else"](g,"=",m,"[",h,"]=",a.link(function(k){return ua(va,a,b,k,2)}),"(",e,");",g,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Ea(a,
b){function k(p){var g=b.shader[p];g&&c.set(d.shader,"."+p,g.append(a,c))}var c=a.proc("scope",3);a.batchId="a2";var d=a.shared,p=d.current;V(a,c,b.context);b.framebuffer&&b.framebuffer.append(a,c);e(Object.keys(b.state)).forEach(function(k){var g=b.state[k].append(a,c);Array.isArray(g)?g.forEach(function(b,g){c.set(a.next[k],"["+g+"]",b)}):c.set(d.next,"."+k,g)});["elements","offset","count","instances","primitive"].forEach(function(k){var g=b.draw[k];g&&c.set(d.draw,"."+k,""+g.append(a,c))});Object.keys(b.uniforms).forEach(function(k){c.set(d.uniforms,
"["+l.id(k)+"]",b.uniforms[k].append(a,c))});Object.keys(b.attributes).forEach(function(k){var g=b.attributes[k].append(a,c),d=a.scopeAttrib(k);Object.keys(new ma).forEach(function(a){c.set(d,"."+a,g[a])})});k("vert");k("frag");0<Object.keys(b.state).length&&(c(p,".dirty=true;"),c.exit(p,".dirty=true;"));c("a1(",a.shared.context,",a0,0);")}var ma=Y.Record,ja={add:32774,subtract:32778,"reverse subtract":32779};q.ext_blend_minmax&&(ja.min=32775,ja.max=32776);var na=q.angle_instanced_arrays,qa=q.webgl_draw_buffers,
fa={dirty:!0},la={},oa=[],ga={},ha={};K("dither",3024);K("blend.enable",3042);D("blend.color","blendColor",[0,0,0,0]);D("blend.equation","blendEquationSeparate",[32774,32774]);D("blend.func","blendFuncSeparate",[1,0,1,0]);K("depth.enable",2929,!0);D("depth.func","depthFunc",513);D("depth.range","depthRange",[0,1]);D("depth.mask","depthMask",!0);D("colorMask","colorMask",[!0,!0,!0,!0]);K("cull.enable",2884);D("cull.face","cullFace",1029);D("frontFace","frontFace",2305);D("lineWidth","lineWidth",1);
K("polygonOffset.enable",32823);D("polygonOffset.offset","polygonOffset",[0,0]);K("sample.alpha",32926);K("sample.enable",32928);D("sample.coverage","sampleCoverage",[1,!1]);K("stencil.enable",2960);D("stencil.mask","stencilMask",-1);D("stencil.func","stencilFunc",[519,0,-1]);D("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);D("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);K("scissor.enable",3089);D("scissor.box","scissor",[0,0,f.drawingBufferWidth,f.drawingBufferHeight]);
D("viewport","viewport",[0,0,f.drawingBufferWidth,f.drawingBufferHeight]);var wa={gl:f,context:I,strings:l,next:la,current:fa,draw:Z,elements:v,buffer:R,shader:G,attributes:Y.state,uniforms:X,framebuffer:M,extensions:q,isBufferArgs:h},pa={primTypes:A,compareFuncs:w,blendFuncs:m,blendEquations:ja,stencilOps:n,glTypes:r,orientationType:y};qa&&(pa.backBuffer=[1029],pa.drawBuffer=H(z.maxDrawbuffers,function(a){return H(a,function(a){return 36064+a})}));var Aa=0;return{next:la,current:fa,procs:function(){var a=
B(),b=a.proc("poll"),c=a.proc("refresh"),d=a.block();b(d);c(d);var p=a.shared,e=p.gl,m=p.next,g=p.current;d(g,".dirty=false;");k(a,b);c(p.framebuffer,".dirty=true;");k(a,c);Object.keys(ga).forEach(function(k){var p=ga[k],h=d.def(m,".",k),n=a.block();n("if(",h,"){",e,".enable(",p,")}else{",e,".disable(",p,")}",g,".",k,"=",h,";");c(n);b("if(",h,"!==",g,".",k,"){",n,"}")});Object.keys(ha).forEach(function(k){var p=ha[k],h=fa[k],n,f,r=a.block();r(e,".",p,"(");Array.isArray(h)?(p=h.length,n=a.global.def(m,
".",k),f=a.global.def(g,".",k),r(H(p,function(a){return n+"["+a+"]"}),");",H(p,function(a){return f+"["+a+"]="+n+"["+a+"];"}).join("")),b("if(",H(p,function(a){return n+"["+a+"]!=="+f+"["+a+"]"}).join("||"),"){",r,"}")):(n=d.def(m,".",k),f=d.def(g,".",k),r(n,");",g,".",k,"=",n,";"),b("if(",n,"!==",f,"){",r,"}"));c(r)});return a.compile()}(),compile:function(a,b,k,c){var d=B(),p;p=ba(a);var e=ia(a,p),g=E(a),h=S(a);a=L(a);var m=e.viewport;m&&(h.viewport=m);m=Q("scissor.box");(e=e[m])&&(h[m]=e);e=0<
Object.keys(h).length;p={framebuffer:p,draw:g,shader:a,state:h,dirty:e};p.uniforms=U(k);p.attributes=P(b);p.context=N(c);Ba(d,p);Ea(d,p);Da(d,p);return d.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":20,"./util/is-ndarray":23,"./util/is-typed-array":24,"./util/loop":26}],9:[function(f,l,q){function h(b,c){this.id=a++;this.type=b;this.data=c}function e(a){if(0===a.length)return[];var c=a.charAt(0),d=a.charAt(a.length-1);if(1<a.length&&c===d&&('"'===c||
"'"===c))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(c=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return e(a.substr(0,c.index)).concat(e(c[1])).concat(e(a.substr(c.index+c[0].length)));c=a.split(".");if(1===c.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(d=0;d<c.length;++d)a=a.concat(e(c[d]));return a}function d(a){return"["+e(a).join("][")+"]"}var a=0;l.exports={define:function(a,c){switch(typeof c){case "boolean":case "number":case "string":return new h(a,
d(c+""));case "undefined":return new h(a|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof h},unbox:function(a,c){if(a instanceof h){if(a.type&128)return new h(a.type&-129,d(c))}else if("function"===typeof a)return new h(0,a);return a},accessor:d}},{}],10:[function(f,l,q){var h=f("./util/is-typed-array"),e=f("./util/is-ndarray"),d=f("./constants/primitives.json"),a=f("./constants/usage.json");l.exports=function(b,c,f){function l(a){this.buffer=a;this.primType=
4;this.type=this.vertCount=0}function q(a,b,d,l,n,y,A){(y=A)||h(b)&&(!e(b)||h(b.data))||(y=c.oes_element_index_uint?5125:5123);a.buffer.bind();f._initBuffer(a.buffer,b,d,y,3);b=A;if(!A){switch(a.buffer.dtype){case 5121:case 5120:b=5121;break;case 5123:case 5122:b=5123;break;case 5125:case 5124:b=5125}a.buffer.dtype=b}a.type=b;0>n&&(n=a.buffer.byteLength,5123===b?n>>=1:5125===b&&(n>>=2));a.vertCount=n;n=l;0>l&&(n=4,l=a.buffer.dimension,1===l&&(n=0),2===l&&(n=1),3===l&&(n=4));a.primType=n}var z={uint8:5121,
uint16:5123};c.oes_element_index_uint&&(z.uint32=5125);l.prototype.bind=function(){this.buffer.bind()};var A=[];return{create:function(c){function u(c){if(c)if("number"===typeof c)m(c),w.primType=4,w.vertCount=c|0,w.type=5121;else{var f=null,r=35044,l=-1,t=-1,A=0,H=0;Array.isArray(c)||h(c)||e(c)?f=c:("data"in c&&(f=c.data),"usage"in c&&(r=a[c.usage]),"primitive"in c&&(l=d[c.primitive]),"count"in c&&(t=c.count|0),"length"in c&&(A=c.length|0),"type"in c&&(H=z[c.type]));f?q(w,f,r,l,t,A,H):(c=w.buffer,
c.bind(),b.bufferData(34963,A,r),c.dtype=H||5121,c.usage=r,c.dimension=3,c.byteLength=A,w.primType=0>l?4:l,w.vertCount=0>t?0:t,w.type=c.dtype)}else m(),w.primType=4,w.vertCount=0,w.type=5121;return u}var m=f.create(null,34963,!0),w=new l(m._buffer);u(c);u._reglType="elements";u._elements=w;u.subdata=function(a,b){m.subdata(a,b);return u};u.destroy=function(){m.destroy();w.buffer=null};return u},createStream:function(a){var b=A.pop();b||(b=new l(f.create(null,34963,!0)._buffer));q(b,a,35040,-1,-1,
0,0);return b},destroyStream:function(a){A.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof l?a._elements:null}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":23,"./util/is-typed-array":24}],11:[function(f,l,q){l.exports=function(h){function e(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{d[a]=
h.getExtension(a)}catch(b){}})}var d={};e();return{extensions:d,refresh:e}}},{}],12:[function(f,l,q){var h=f("./util/values"),e=f("./util/extend");l.exports=function(d,a,b,c,f){function l(a,b,c,d){this.target=a;this.level=b;this.texture=c;this.renderbuffer=d}function q(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function z(a,b){var c=b.width,d=b.height;if(a.texture)var e=a.texture._texture,h=Math.max(1,e.params.width>>a.level),m=Math.max(1,
e.params.height>>a.level),c=c||h,d=d||m;else e=a.renderbuffer._renderbuffer,c=c||e.width,d=d||e.height;e.refCount+=1;b.width=c;b.height=d}function A(a,b){b?b.texture?d.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):d.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):d.framebufferTexture2D(36160,a,3553,null,0)}function r(a){var b=3553,c=0,d=null,e=null;"object"===typeof a&&("level"in a&&(c=a.level|0),"target"in a&&(b=a.target|0));var h=a._reglType;
"texture"===h?d=a:"renderbuffer"===h&&(e=a,b=36161,c=0);return new l(b,c,d,e)}function u(a){return a&&(a.texture||a.renderbuffer)}function m(){this.id=R++;v[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function w(c){d.isFramebuffer(c.framebuffer)||(c.framebuffer=d.createFramebuffer());y.dirty=!0;d.bindFramebuffer(36160,c.framebuffer);for(var e=
c.colorAttachments,h=0;h<e.length;++h)A(36064+h,e[h]);for(h=e.length;h<b.maxColorAttachments;++h)A(36064+h,null);A(36096,c.depthAttachment);A(36128,c.stencilAttachment);A(33306,c.depthStencilAttachment);a.webgl_draw_buffers&&a.webgl_draw_buffers.drawBuffersWEBGL(da[e.length]);d.checkFramebufferStatus(36160)}function n(a){a=a.framebuffer;d.isFramebuffer(a)&&d.deleteFramebuffer(a)}var y={current:null,next:null,dirty:!1},J={rgba:6408},F={rgba4:32854,rgb565:36194,"rgb5 a1":32855};a.ext_srgb&&(F.srgba=
35907);a.ext_color_buffer_half_float&&(F.rgba16f=34842,F.rgb16f=34843);a.webgl_color_buffer_float&&(F.rgba32f=34836);var O=[],ea=[];a.webgl_depth_texture&&(O.push(6402),ea.push(34041));e(e({},J),F);h(J);h(F);F=5121;O={uint8:5121};a.oes_texture_half_float&&(F=O["half float"]=36193);a.oes_texture_float&&(F=O["float"]=5126);O.best=F;var da=function(){for(var a=Array(b.maxDrawbuffers),c=0;c<=b.maxDrawbuffers;++c)for(var d=a[c]=Array(c),e=0;e<c;++e)d[e]=36064+e;return a}(),R=0,v={};return e(y,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof m)?a:null},create:function(a){function b(a){var h,m=a||{},n=a=0;if("shape"in m){var A=m.shape;a=A[0];n=A[1]}else"radius"in m&&(a=n=m.radius),"width"in m&&(a=m.width),"height"in m&&(n=m.height);var y=null,A=!1;if("colorBuffers"in m||"colorBuffer"in m){y=m.colorBuffers||m.colorBuffer;Array.isArray(y)||(y=[y]);e.width=a;e.height=n;y=y.map(r);for(h=0;h<y.length;++h)z(y[h],e);a=e.width;n=e.height}else{var v=!0,B="rgba",F="uint8",O=1,
A=!0;e.width=a=a||d.drawingBufferWidth;e.height=n=n||d.drawingBufferHeight;"format"in m&&(B=m.format,v=B in J);"type"in m&&(F=m.type);"colorCount"in m&&(O=m.colorCount|0);if(e.ownsColor)for(y=e.colorAttachments;y.length>O;)q(y.pop());else y=[];for(h=0;h<y.length;++h){var L;a:{L=y[h];var E=v,S=B,U=a,P=n;if(L.texture){var N=L.texture;if(E){N({format:S,type:F,width:U,height:P});N._texture.refCount+=1;L=!0;break a}}else if(N=L.renderbuffer,!E){N({format:S,width:U,height:P});N._renderbuffer.refCount+=
1;L=!0;break a}q(L);L=!1}L||(y[h--]=y[y.length-1],y.pop())}for(;y.length<O;)v?y.push(new l(3553,0,c.create({format:B,type:F,width:a,height:n},3553),null)):y.push(new l(36161,0,null,f.create({format:B,width:a,height:n})))}e.width=a;e.height=n;B=v=h=null;F=!1;"depthBuffer"in m&&(h=r(m.depthBuffer));"stencilBuffer"in m&&(v=r(m.stencilBuffer));"depthStencilBuffer"in m&&(B=r(m.depthStencilBuffer));if(h||v||B)z(h||v||B,e);else if(O=!0,E=L=!1,"depth"in m&&(O=!!m.depth),"stencil"in m&&(L=!!m.stencil),"depthTexture"in
m&&(E=!!m.depthTexture),m=e.depthAttachment||e.stencilAttachment||e.depthStencilAttachment,S=null,O||L)F=!0,E?(E=L?"depth stencil":"depth",e.ownsDepthStencil&&m.texture?(m.texture({format:E,width:a,height:n}),m.texture._texture.refCount+=1,S=m):S=new l(3553,0,c.create({format:E,width:a,height:n},3553),null)):(E=O?L?"depth stencil":"depth":"stencil",e.ownsDepthStencil&&m.renderbuffer?(m.renderbuffer({format:E,width:a,height:n}),m.renderbuffer._renderbuffer.refCount+=1,S=m):S=new l(36161,0,null,f.create({format:E,
width:a,height:n}))),O?L?B=S:h=S:v=S;a=e;a.colorAttachments.forEach(q);q(a.depthAttachment);q(a.stencilAttachment);q(a.depthStencilAttachment);e.colorAttachments=y;e.depthAttachment=h;e.stencilAttachment=v;e.depthStencilAttachment=B;e.ownsColor=A;e.ownsDepthStencil=F;b.color=y.map(u);b.depth=u(h);b.stencil=u(v);b.depthStencil=u(B);w(e);b.width=e.width;b.height=e.height;return b}var e=new m;b(a);b._reglType="framebuffer";b._framebuffer=e;b._destroy=function(){n(e)};return b},clear:function(){h(v).forEach(n)},
refresh:function(){h(v).forEach(w)}})}},{"./util/extend":21,"./util/values":32}],13:[function(f,l,q){l.exports=function(h,e){var d=1;e.ext_texture_filter_anisotropic&&(d=h.getParameter(34047));var a=1,b=1;e.webgl_draw_buffers&&(a=h.getParameter(34852),b=h.getParameter(36063));return{colorBits:[h.getParameter(3410),h.getParameter(3411),h.getParameter(3412),h.getParameter(3413)],depthBits:h.getParameter(3414),stencilBits:h.getParameter(3415),subpixelBits:h.getParameter(3408),extensions:Object.keys(e).filter(function(a){return!!e[a]}),
maxAnisotropic:d,maxDrawbuffers:a,maxColorAttachments:b,pointSizeDims:h.getParameter(33901),lineWidthDims:h.getParameter(33902),maxViewportDims:h.getParameter(3386),maxCombinedTextureUnits:h.getParameter(35661),maxCubeMapSize:h.getParameter(34076),maxRenderbufferSize:h.getParameter(34024),maxTextureUnits:h.getParameter(34930),maxTextureSize:h.getParameter(3379),maxAttributes:h.getParameter(34921),maxVertexUniforms:h.getParameter(36347),maxVertexTextureUnits:h.getParameter(35660),maxVaryingVectors:h.getParameter(36348),
maxFragmentUniforms:h.getParameter(36349),glsl:h.getParameter(35724),renderer:h.getParameter(7937),vendor:h.getParameter(7936),version:h.getParameter(7938)}}},{}],14:[function(f,l,q){var h=f("./util/is-typed-array");l.exports=function(e,d,a){return function(b){var c=b||{};h(b)?c={data:c}:2===arguments.length?c={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof b&&(c={});d();var f=c.x||0,l=c.y||0,q=c.width||a.viewportWidth,z=c.height||a.viewportHeight,c=c.data||new Uint8Array(q*z*4);e.pixelStorei(3333,
4);e.readPixels(f,l,q,z,6408,5121,c);return c}}},{"./util/is-typed-array":24}],15:[function(f,l,q){var h=f("./util/values");l.exports=function(e,d,a){function b(){this.id=q++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function c(a){e.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=e.createRenderbuffer());e.bindRenderbuffer(36161,a.renderbuffer);e.renderbufferStorage(36161,a.format,a.width,a.height)}function f(a){var b=a.renderbuffer;e.bindRenderbuffer(36161,
null);e.isRenderbuffer(b)&&e.deleteRenderbuffer(b);a.renderbuffer=null;a.refCount=0;delete z[a.id]}var l={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};d.ext_srgb&&(l.srgba=35907);d.ext_color_buffer_half_float&&(l.rgba16f=34842,l.rgb16f=34843);d.webgl_color_buffer_float&&(l.rgba32f=34836);var q=0,z={};b.prototype.decRef=function(){0===--this.refCount&&f(this)};return{create:function(a){function d(a){a=a||{};var b=0,h=0;"shape"in a?(h=a.shape,b=h[0]|0,h=
h[1]|0):("radius"in a&&(b=h=a.radius|0),"width"in a&&(b=a.width|0),"height"in a&&(h=a.height|0));d.width=e.width=Math.max(b,1);d.height=e.height=Math.max(h,1);e.format=32854;"format"in a&&(e.format=l[a.format]);c(e);return d}var e=new b;z[e.id]=e;d(a);d._reglType="renderbuffer";d._renderbuffer=e;d.destroy=function(){e.decRef()};return d},refresh:function(){h(z).forEach(c)},clear:function(){h(z).forEach(f)}}}},{"./util/values":32}],16:[function(f,l,q){var h=f("./util/values");l.exports=function(e,
d){function a(a,b,c,d){this.name=a;this.id=b;this.location=c;this.info=d}function b(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function c(a,b,c){c=35632===a?q:z;var h=c[b];if(!h){var f=d.str(b),h=e.createShader(a);e.shaderSource(h,f);e.compileShader(h);c[b]=h}return h}function f(a,b){this.id=u++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[]}function l(h,f){var n,r;n=c(35632,h.fragId);r=c(35633,h.vertId);var q=h.program=
e.createProgram();e.attachShader(q,n);e.attachShader(q,r);e.linkProgram(q);var t=e.getProgramParameter(q,35718),A=h.uniforms;for(n=0;n<t;++n)if(r=e.getActiveUniform(q,n))if(1<r.size)for(var u=0;u<r.size;++u){var z=r.name.replace("[0]","["+u+"]");b(A,new a(z,d.id(z),e.getUniformLocation(q,z),r))}else b(A,new a(r.name,d.id(r.name),e.getUniformLocation(q,r.name),r));t=e.getProgramParameter(q,35721);A=h.attributes;for(n=0;n<t;++n)(r=e.getActiveAttrib(q,n))&&b(A,new a(r.name,d.id(r.name),e.getAttribLocation(q,
r.name),r))}var q={},z={},A={},r=[],u=0;return{clear:function(){var a=e.deleteShader.bind(e);h(q).forEach(a);q={};h(z).forEach(a);z={};r.forEach(function(a){e.deleteProgram(a.program)});r.length=0;A={}},refresh:function(){q={};z={};r.forEach(l)},program:function(a,b,c){var d=A[b];d||(d=A[b]={});var e=d[a];e||(e=new f(b,a),l(e,c),d[a]=e,r.push(e));return e},shader:c,frag:null,vert:null}}},{"./util/values":32}],17:[function(f,l,q){l.exports=function(){var h={"":0},e=[""];return{id:function(d){var a=
h[d];if(a)return a;a=h[d]=e.length;e.push(d);return a},str:function(d){return e[d]}}}},{}],18:[function(f,l,q){function h(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function e(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,d=1;d<b;++d)if(!Array.isArray(a[d])||a[d].length!==c)return!1;return!0}function d(a){return Object.prototype.toString.call(a)}function a(a){return"[object HTMLCanvasElement]"===d(a)}function b(a){return"[object CanvasRenderingContext2D]"===
d(a)}var c=f("./util/extend"),t=f("./util/values"),H=f("./util/is-typed-array"),W=f("./util/is-ndarray"),z=f("./util/load-texture"),A=f("./util/to-half-float"),r=f("./util/parse-dds"),u=[9984,9986,9985,9987];l.exports=function(f,l,n,q,J){function F(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=
this.miplevel=0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function O(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ea(a,b){var c,d,e=0,h=0,f=0,m=0,n=0,l=0,r=!1,q=!1,t=!1;for(c=0;c<b.length;++c)d=b[c],m=m||d.width<<d.miplevel,n=n||d.height<<d.miplevel,
e=e||d.type,h=h||d.format,f=f||d.internalformat,l=l||d.channels,r=r||d.needsPoll,q=q||d.needsListeners,d=d.miplevel,t=t||0<d;a.needsPoll=r;a.needsListeners=q;a.width=m;a.height=n;a.format=h;a.internalformat=f;a.type=e;if(3553!==a.target)for(c=0;6>c;++c);c=0<=u.indexOf(a.minFilter);a.genMipmaps=!t&&(a.genMipmaps||c);t=t||a.genMipmaps;a.minFilter||(a.minFilter=t?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(c=0;c<b.length;++c)d=b[c],d.channels||(d.channels=l),d.format||(d.format=h),d.internalformat||
(d.internalformat=f),d.type||(d.type=e)}function da(a){this.id=S++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new O(a);this.pixels=[]}function R(a,b){function c(a,k){var d=k.mipmap,e;if(Array.isArray(d))for(var f=0;f<d.length;++f)e=new F(a),e.parseFlags(b),e.parseFlags(k),e.parse(d[f],f),h.push(e);else e=new F(a),e.parseFlags(b),e.parse(k,0),h.push(e)}var d;M(a);var e=a.params;O.call(e,a.target);var h=a.pixels;h.length=
0;e.parse(b);if(3553===a.target)c(3553,b);else{var f=b.faces||b;if(Array.isArray(f))for(d=0;6>d;++d)c(34069+d,f[d]);else if("string"!==typeof f)for(d=0;6>d;++d)c(34069+d,{})}ea(e,h);e.needsListeners&&ka(a);e.needsPoll&&(a.pollId=P.length,P.push(a));v(a)}function v(a){f.isTexture(a.texture)||(a.texture=f.createTexture());var b=a.target,c=a.unit;0<=c?(f.activeTexture(33984+c),E=c):f.bindTexture(b,a.texture);for(var b=a.pixels,d=a.params,e=0;e<b.length;++e)b[e].upload(d);d.upload();0>c&&((c=V[E])?f.bindTexture(c.target,
c.texture):(a.unit=E,V[E]=a))}function ka(a){function b(a,c,d){var k=r(d);k.pixels.forEach(function(b){var d=new F(k.cube?b.target:a);d.channels=k.channels;d.compressed=k.compressed;d.type=k.type;d.internalformat=k.format;d.format=L[k.format];d.width=b.width;d.height=b.height;d.miplevel=b.miplevel||c;d.data=b.data;e.push(d)})}function c(){for(var h=0;h<e.length;++h){var f=e[h],p=f.image,m=f.video,n=f.xhr;p&&p.complete?(f.width=p.naturalWidth,f.height=p.naturalHeight):m&&2<m.readyState?(f.width=m.width,
f.height=m.height):n&&4===n.readyState&&(e[h]=e[e.length-1],e.pop(),n.removeEventListener("readystatechange",v),b(f.target,f.miplevel,n.response))}ea(d,e);v(a)}var d=a.params,e=a.pixels;e.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){e.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",
c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function M(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((P[b]=P[P.length-1]).id=b,P.pop(),a.pollId=-1)}function X(a){var b=a.texture,c=a.unit,d=a.target;0<=c&&(f.activeTexture(33984+c),E=c,f.bindTexture(d,null),V[c]=null);M(a);f.isTexture(b)&&f.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete U[a.id]}var Y={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
G={repeat:10497,clamp:33071,mirror:33648},Z={nearest:9728,linear:9729},I=c({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},Z),Q={none:0,browser:37444},K={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},D={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},B={};l.ext_srgb&&(D.srgb=35904,D.srgba=35906);l.oes_texture_float&&(K["float"]=5126);l.oes_texture_half_float&&
(K["half float"]=36193);l.webgl_depth_texture&&(c(D,{depth:6402,"depth stencil":34041}),c(K,{uint16:5123,uint32:5125,"depth stencil":34042}));l.webgl_compressed_texture_s3tc&&c(B,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});l.webgl_compressed_texture_atc&&c(B,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});l.webgl_compressed_texture_pvrtc&&c(B,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});l.webgl_compressed_texture_etc1&&(B["rgb etc1"]=36196);var ba=Array.prototype.slice.call(f.getParameter(34467));Object.keys(B).forEach(function(a){var b=B[a];0<=ba.indexOf(b)&&(D[a]=b)});var ia=Object.keys(D);n.textureFormats=ia;var L=ia.reduce(function(a,b){var c=D[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});c(F.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=Q[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=D[b];b in K&&(this.type=K[b]);b in B&&(this.compressed=!0)}"type"in a&&(this.type=K[a.type]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),
"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(c,f){this.miplevel=f;this.width>>=f;this.height>>=f;var p=c;switch(typeof c){case "object":if(!c)return;
this.parseFlags(c);var m=c.data;if("string"===typeof m||m&&(H(m)||h(m)||W(m)||a(m)||b(m)||"[object HTMLImageElement]"===d(m)||"[object HTMLVideoElement]"===d(m)||e(m)))p=c.data;break;case "undefined":return}"string"===typeof p&&(p=z(p,this.crossOrigin));var m=null,n=!1;if(null!==p)if(H(p))this.data=p;else if(h(p))m=p,n=!0;else if(W(p)){Array.isArray(p.data)?(m=p.data,n=!0):this.data=p.data;var l=p.shape;this.width=l[0];this.height=l[1];this.channels=3===l.length?l[2]:1;l=p.stride;this.strideX=p.stride[0];
this.strideY=p.stride[1];this.strideC=3===l.length?p.stride[2]:1;this.offset=p.offset;this.needsTranspose=!0}else if(a(p)||b(p))a(p)?this.canvas=p:this.canvas=p.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===d(p))this.image=p,p.complete?(this.width=p.naturalWidth,this.height=p.naturalHeight):(this.width=this.width||p.naturalWidth,this.height=this.height||p.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===d(p))this.video=p,1<p.readyState?(this.width=p.width,this.height=p.height):(this.width=this.width||p.width,this.height=this.height||p.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===d(p))this.xhr=p,this.needsListeners=!0;else if(e(p)){var n=p[0].length,l=p.length,r=1,q,t,u,w;if(Array.isArray(p[0][0]))for(r=p[0][0].length,m=Array(n*l*r),t=w=0;t<l;++t)for(q=0;q<n;++q)for(u=0;u<r;++u)m[w++]=p[t][q][u];
else for(m=Array(n*l),t=w=0;t<l;++t)for(q=0;q<n;++q)m[w++]=p[t][q];this.width=n;this.height=l;this.channels=r;n=!0}else c.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||J.viewportWidth)|0,this.height=(this.height||J.viewportHeight)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=
[6409,6410,6407,6408][(this.channels=this.channels||4)-1]);p=this.internalformat;l=this.format=L[p];if(!this.channels)switch(l){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}l=this.type;5126!==l&&36193!==l&&(l||(l=6402===p?5125:5121));this.type=l;if(n)switch(l){case 5121:this.data=new Uint8Array(m);break;case 5123:this.data=new Uint16Array(m);break;case 5125:this.data=new Uint32Array(m);break;
case 5126:this.data=new Float32Array(m);break;case 36193:this.data=A(m)}if(this.data&&this.needsTranspose){m=this.data;p=this.width;n=this.height;l=this.channels;r=this.strideX;q=this.strideY;t=this.strideC;u=this.offset;w=new m.constructor(p*n*l);for(var v=0,V=0;V<n;++V)for(var y=0;y<p;++y)for(var B=0;B<l;++B)w[v++]=m[q*V+r*y+t*B+u];this.data=w}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){f.pixelStorei(37440,
this.flipY);f.pixelStorei(37441,this.premultiplyAlpha);f.pixelStorei(37443,this.colorSpace);f.pixelStorei(3317,this.unpackAlignment);var b=this.target,c=this.miplevel,d=this.image,e=this.canvas,h=this.video,n=this.data,l=this.internalformat,r=this.format,t=this.type,u=this.width||Math.max(1,a.width>>c);a=this.height||Math.max(1,a.height>>c);h&&2<h.readyState?f.texImage2D(b,c,r,r,t,h):d&&d.complete?f.texImage2D(b,c,r,r,t,d):e?f.texImage2D(b,c,r,r,t,e):this.compressed?f.compressedTexImage2D(b,c,l,u,
a,0,n):this.copy?(q(),f.copyTexImage2D(b,c,r,this.x,this.y,u,a,0)):n?f.texImage2D(b,c,r,u,a,0,r,t,n):f.texImage2D(b,c,r,u||1,a||1,0,r,t,null)}});c(O.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=I[a.min]);"mag"in a&&(this.magFilter=Z[a.mag]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var d=a.wrap;"string"===typeof d?b=c=G[d]:Array.isArray(d)&&(b=G[d[0]],c=G[d[1]])}else"wrapS"in a&&(b=G[a.wrapS]),"wrapT"in a&&(c=G[a.wrapT]);this.wrapS=b;this.wrapT=c;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=Y[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;f.texParameteri(a,10241,this.minFilter);f.texParameteri(a,10240,this.magFilter);f.texParameteri(a,10242,this.wrapS);f.texParameteri(a,10243,this.wrapT);l.ext_texture_filter_anisotropic&&f.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(f.hint(33170,this.mipmapHint),f.generateMipmap(a))}});
var E=0,S=0,U={},P=[],N=n.maxTextureUnits,V=Array(N).map(function(){return null});c(da.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<N;++b){var c=V[b];if(c){if(0<c.bindCount)continue;c.unit=-1}V[b]=this;a=b;break}this.unit=a;f.activeTexture(33984+a);f.bindTexture(this.target,this.texture);E=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&X(this)}});return{create:function(a,b){function c(a,e,h,f,k,m){var n=a||{};34067===b&&
6===arguments.length&&(n=[a,e,h,f,k,m]);R(d,n);c.width=d.params.width;c.height=d.params.height;return c}var d=new da(b);U[d.id]=d;c(a);c._reglType="texture";c._texture=d;c.destroy=function(){d.decRef()};return c},refresh:function(){t(U).forEach(v);for(var a=0;a<N;++a)V[a]=null;E=0;f.activeTexture(33984)},clear:function(){for(var a=0;a<N;++a)f.activeTexture(33984+a),f.bindTexture(3553,null),V[a]=null;f.activeTexture(33984);E=0;t(U).forEach(X)},poll:function(){P.forEach(v)},getTexture:function(a){return null}}}},
{"./util/extend":21,"./util/is-ndarray":23,"./util/is-typed-array":24,"./util/load-texture":25,"./util/parse-dds":27,"./util/to-half-float":30,"./util/values":32}],19:[function(f,l,q){l.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],20:[function(f,l,q){function h(a){return Array.prototype.slice.call(a)}function e(a){return h(a).join("")}var d=f("./extend");l.exports=function(){function a(){var a=[],b=[];return d(function(){a.push.apply(a,
h(arguments))},{def:function(){var d="v"+c++;b.push(d);0<arguments.length&&(a.push(d,"="),a.push.apply(a,h(arguments)),a.push(";"));return d},toString:function(){return e([0<b.length?"var "+b+";":"",e(a)])}})}function b(){function b(a,d){e(a,d,"=",c.def(a,d),";")}var c=a(),e=a(),h=c.toString,f=e.toString;return d(c,{entry:c,exit:e,save:b,set:function(a,d,e){b(a,d);c(a,d,"=",e,";")},toString:function(){return h()+f()}})}var c=0,f=[],l=[],q=a(),z={};return{global:q,link:function(a){for(var b=0;b<l.length;++b)if(l[b]===
a)return f[b];b="g"+c++;f.push(b);l.push(a);return b},block:a,proc:function(a,c){function h(){var a="a"+f.length;f.push(a);return a}var f=[];c=c||0;for(var l=0;l<c;++l)h();var l=b(),n=l.toString;return z[a]=d(l,{arg:h,toString:function(){return e(["function(",f.join(),"){",n(),"}"])}})},scope:b,cond:function(){var a=e(arguments),c=b(),f=b(),m=c.toString,l=f.toString;return d(c,{then:function(){c.apply(c,h(arguments));return this},"else":function(){f.apply(f,h(arguments));return this},toString:function(){var b=
l();b&&(b="else{"+b+"}");return e(["if(",a,"){",m(),"}",b])}})},compile:function(){var a=['"use strict";',q,"return {"];Object.keys(z).forEach(function(b){a.push('"',b,'":',z[b].toString(),",")});a.push("}");var b=e(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,f.concat(b)).apply(null,l)}}}},{"./extend":21}],21:[function(f,l,q){l.exports=function(h,e){for(var d=Object.keys(e),a=0;a<d.length;++a)h[d[a]]=e[d[a]];return h}},{}],22:[function(f,l,q){l.exports=
function(h,e,d){for(var a=0,b=0;b<e.length;++b)for(var c=e[b],f=0;f<d;++f)h[a++]=c[f]}},{}],23:[function(f,l,q){var h=f("./is-typed-array");l.exports=function(e){return!!e&&"object"===typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"===typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||h(e.data))}},{"./is-typed-array":24}],24:[function(f,l,q){var h=f("../constants/arraytypes.json");l.exports=function(e){return Object.prototype.toString.call(e)in h}},{"../constants/arraytypes.json":4}],
25:[function(f,l,q){l.exports=function(f,e){if("undefined"!==typeof document){var d;d=(d=/\.(\w+)(\?.*)?$/.exec(f))&&d[1]?d[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(d))return d=document.createElement("video"),d.autoplay=!0,d.loop=!0,e&&(d.crossOrigin=e),d.src=f,d;if(0<=["dds"].indexOf(d))return d=new XMLHttpRequest,d.responseType="arraybuffer",d.open("GET",f,!0),d.send(),d;d=new Image;e&&(d.crossOrigin=e);d.src=f;return d}return null}},
{}],26:[function(f,l,q){l.exports=function(f,e){for(var d=Array(f),a=0;a<f;++a)d[a]=e(a);return d}},{}],27:[function(f,l,q){l.exports=function(f){function l(a){for(var b=Y,c=G,d=0;d<D;++d){var e=Math.max(1,b+3>>2)*Math.max(1,c+3>>2)*Q;ba.pixels.push({target:a,miplevel:d,width:b,height:c,data:new Uint8Array(f,B,e)});B+=e;b>>=1;c>>=1}}var q=new Int32Array(f),X=q[y],Y=q[F],G=q[J],Z=H,I=0,Q=0,K=4;switch(q[da]){case r:Q=8;X&A?(K=3,I=d):I=a;break;case u:Q=16;I=b;break;case m:Q=16;I=c;break;case w:Q=8,I=
t}var D=1;q[ea]&W&&(D=Math.max(1,q[O]));var B=q[n]+4,ba={width:Y,height:G,channels:K,format:I,type:Z,compressed:!0,cube:!1,pixels:[]};if(q[R]&z)for(ba.cube=!0,q=0;6>q;++q)l(e+q);else l(h);return ba};var h=3553,e=34069,d=33776,a=33777,b=33778,c=33779,t=36196,H=5121,W=131072,z=512,A=64,r=827611204,u=861165636,m=894720068,w=826496069,n=1,y=2,J=3,F=4,O=7,ea=20,da=21,R=28},{}],28:[function(f,l,q){function h(a){var c,d;c=(65535<a)<<4;a>>>=c;d=(255<a)<<3;a>>>=d;c|=d;d=(15<a)<<2;a>>>=d;c|=d;d=(3<a)<<1;return c|
d|a>>>d>>1}function e(b){a:{for(var c=16;268435456>=c;c*=16)if(b<=c){b=c;break a}b=0}c=a[h(b)>>2];return 0<c.length?c.pop():new ArrayBuffer(b)}function d(b){a[h(b.byteLength)>>2].push(b)}var a=f("./loop")(8,function(){return[]});l.exports={alloc:e,free:d,allocType:function(a,c){switch(a){case 5120:return new Int8Array(e(c),0,c);case 5121:return new Uint8Array(e(c),0,c);case 5122:return new Int16Array(e(2*c),0,c);case 5123:return new Uint16Array(e(2*c),0,c);case 5124:return new Int32Array(e(4*c),0,
c);case 5125:return new Uint32Array(e(4*c),0,c);case 5126:return new Float32Array(e(4*c),0,c);default:return null}},freeType:function(a){d(a.buffer)}}},{"./loop":26}],29:[function(f,l,q){l.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(f){return requestAnimationFrame(f)},cancel:function(f){return cancelAnimationFrame(f)}}:{next:function(f){setTimeout(f,30)},cancel:clearTimeout}},{}],30:[function(f,l,q){l.exports=function(f){for(var e=new Float32Array(f),
e=new Uint32Array(e.buffer),d=new Uint16Array(f.length),a=0;a<f.length;++a)if(isNaN(f[a]))d[a]=65535;else if(Infinity===f[a])d[a]=31744;else if(-Infinity===f[a])d[a]=64512;else{var b=e[a],c=b>>>31<<15,l=(b<<1>>>24)-127,b=b>>13&1023;d[a]=-24>l?c:-14>l?c+(b+1024>>-14-l):15<l?c+31744:c+(l+15<<10)+b}return d}},{}],31:[function(f,l,q){l.exports=function(f,e,d,a,b,c,l){for(var q=0,W=0;W<d;++W)for(var z=0;z<a;++z)f[q++]=e[b*W+c*z+l]}},{}],32:[function(f,l,q){l.exports=function(f){return Object.keys(f).map(function(e){return f[e]})}},
{}],33:[function(f,l,q){function h(a,b){function c(){var b=window.innerWidth,c=window.innerHeight;a!==document.body&&(c=a.getBoundingClientRect(),b=c.right-c.left,c=c.top-c.bottom);f.width=l*b;f.height=l*c;d(f.style,{width:b+"px",height:c+"px"})}var f=document.createElement("canvas"),h=e(f,b);d(f.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(f);a===document.body&&(f.style.position="absolute",d(a.style,{margin:0,padding:0}));var l=+h.options.pixelRatio;window.addEventListener("resize",
c,!1);var q=h.options.onDestroy;h.options=d(d({},h.options),{onDestroy:function(){window.removeEventListener("resize",c);a.removeChild(f);q&&q()}});c();return h}function e(a,b){function c(b){try{return a.getContext(b,e)}catch(c){return null}}var e=b.glOptions||{};return{gl:c("webgl")||c("experimental-webgl")||c("webgl-experimental"),options:d({pixelRatio:window.devicePixelRatio},b)}}var d=f("./util/extend");l.exports=function(a){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:a[0],
options:a[1]||{}};var b=document.body,c=a[1]||{};if("string"===typeof a[0])b=document.querySelector(a[0])||document.body;else if("object"===typeof a[0])if(a[0]instanceof HTMLElement)b=a[0];else{if(a[0]instanceof WebGLRenderingContext)return{gl:a[0],options:d({pixelRatio:1},c)};c=a[0]}return b.nodeName&&"CANVAS"===b.nodeName.toUpperCase()?e(b,c):h(b,c)}},{"./util/extend":21}],34:[function(f,l,q){var h=f("./lib/util/extend"),e=f("./lib/dynamic"),d=f("./lib/util/raf"),a=f("./lib/util/clock"),b=f("./lib/strings"),
c=f("./lib/webgl"),t=f("./lib/extension"),H=f("./lib/limits"),W=f("./lib/buffer"),z=f("./lib/elements"),A=f("./lib/texture"),r=f("./lib/renderbuffer"),u=f("./lib/framebuffer"),m=f("./lib/attribute"),w=f("./lib/shader"),n=f("./lib/read"),y=f("./lib/core");l.exports=function(){function f(){N=d.next(f);I.count+=1;var b=S.viewport,c=S.scissor_box;b[0]=b[1]=c[0]=c[1]=0;I.viewportWidth=I.frameBufferWidth=I.drawingBufferWidth=b[2]=c[2]=v.drawingBufferWidth;I.viewportHeight=I.frameBufferWidth=I.drawingBufferHeight=
b[3]=c[3]=v.drawingBufferHeight;b=a();I.deltaTime=(b-Y)/1E3;I.time=(b-X)/1E3;Y=b;E.procs.refresh();B.poll();for(b=0;b<P.length;++b)(0,P[b])(I,null,0)}function l(a){}function q(a){}function ea(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var f=a[b];e.isDynamic(f)?d[b]=e.unbox(f,b):c[b]=f});return{dynamic:d,"static":c}}function c(a){for(;r.length<a;)r.push(null);return r}var d=b(a.context||{}),f=b(a.uniforms||{}),l=b(a.attributes||{});a=b(function(a){function b(a){if(a in c){var d=
c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=h({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var d=E.compile(a,l,f,d),m=d.draw,n=d.batch,q=d.scope,r=[];return function(a,b){var d;if("function"===typeof a)return q.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)q.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<
a.length;++d)q.call(this,a[d],b,d);else return q.call(this,a,b,0);else if("number"===typeof a){if(0<a)return n.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return n.call(this,a,a.length)}else return m.call(this,a)}}function da(){E.procs.poll()}var R=c(Array.prototype.slice.call(arguments)),v=R.gl,ka=R.options,R=b(),M=t(v).extensions,X=a(),Y=X,G=v.drawingBufferWidth,Z=v.drawingBufferHeight,I={count:0,deltaTime:0,time:0,viewportWidth:G,viewportHeight:Z,framebufferWidth:G,framebufferHeight:Z,
drawingBufferWidth:G,drawingBufferHeight:Z,pixelRatio:ka.pixelRatio},G=H(v,M),Q=W(v),K=z(v,M,Q),Z=m(v,M,G,Q,R),D=w(v,R),B=A(v,M,G,da,I),ba=r(v,M,G),ia=u(v,M,G,B,ba),L=n(v,da,I),E=y(v,R,M,G,Q,K,B,ia,{},Z,D,{elements:null,primitive:4,count:-1,offset:0,instances:-1},I),S=E.next,U=v.canvas,P=[],N=0;U&&(U.addEventListener("webglcontextlost",l,!1),U.addEventListener("webglcontextrestored",q,!1));E.procs.refresh();return h(ea,{clear:function(a){var b=0;da();var c=a.color;c&&(v.clearColor(+c[0]||0,+c[1]||
0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(v.clearDepth(+a.depth),b|=256);"stencil"in a&&(v.clearStencil(a.stencil|0),b|=1024);v.clear(b)},prop:e.define.bind(null,1),context:e.define.bind(null,2),"this":e.define.bind(null,3),draw:ea({}),elements:function(a){return K.create(a)},buffer:function(a){return Q.create(a,34962)},texture:function(a){return B.create(a,3553)},cube:function(a){return 6===arguments.length?B.create(Array.prototype.slice.call(arguments),34067):B.create(a,34067)},renderbuffer:function(a){return ba.create(a)},
framebuffer:function(a){return ia.create(a)},framebufferCube:function(a){},attributes:v.getContextAttributes(),frame:function(a){P.push(a);!N&&0<P.length&&f();return{cancel:function(){var b=P.find(function(b){return b===a});0>b||(P.splice(b,1),0>=P.length&&N&&(d.cancel(f),N=0))}}},limits:G,read:L,destroy:function(){N&&(d.cancel(f),N=0);U&&(U.removeEventListener("webglcontextlost",l),U.removeEventListener("webglcontextrestored",q));D.clear();ia.clear();ba.clear();B.clear();Q.clear();if(ka.onDestroy)ka.onDestroy()},
_gl:v,_refresh:function(){E.procs.refresh()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/strings":17,"./lib/texture":18,"./lib/util/clock":19,"./lib/util/extend":21,"./lib/util/raf":29,"./lib/webgl":33}]},{},[1]);
