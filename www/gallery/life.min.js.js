(function e$$0(n,q,l){function h(b,d){if(!q[b]){if(!n[b]){var e="function"==typeof require&&require;if(!d&&e)return e(b,!0);if(p)return p(b,!0);e=Error("Cannot find module '"+b+"'");throw e.code="MODULE_NOT_FOUND",e;}e=q[b]={exports:{}};n[b][0].call(e.exports,function(d){var e=n[b][1][d];return h(e?e:d)},e,e.exports,e$$0,n,q,l)}return q[b].exports}for(var p="function"==typeof require&&require,e=0;e<l.length;e++)h(l[e]);return h})({1:[function(g,n,q){var l=g("../regl")(),h=Array(1048576).fill(0).map(function(){return.9<
Math.random()?255:0}),p=Array(2).fill().map(function(){return l.framebuffer({colorBuffer:l.texture({radius:512,data:h,wrap:"repeat"}),depth:!1})}),e=l({frag:"\n  precision mediump float;\n  uniform sampler2D prevState;\n  varying vec2 uv;\n  void main() {\n    float n = 0.0;\n    for(int dx=-1; dx<=1; ++dx)\n    for(int dy=-1; dy<=1; ++dy) {\n      n += texture2D(prevState, uv+vec2(dx,dy)/float(512)).r;\n    }\n    float s = texture2D(prevState, uv).r;\n    if(n > 3.0+s || n < 3.0) {\n      gl_FragColor = vec4(0,0,0,1);\n    } else {\n      gl_FragColor = vec4(1,1,1,1);\n    }\n  }",
framebuffer:function(b){return p[(b.count+1)%2]}}),b=l({frag:"\n  precision mediump float;\n  uniform sampler2D prevState;\n  varying vec2 uv;\n  void main() {\n    float state = texture2D(prevState, uv).r;\n    gl_FragColor = vec4(vec3(state), 1);\n  }",vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main() {\n    uv = 0.5 * (position + 1.0);\n    gl_Position = vec4(position, 0, 1);\n  }",attributes:{position:[-4,-4,4,-4,0,4]},uniforms:{prevState:function(b){return p[b.count%
2].color[0]}},depth:{enable:!1},count:3});l.frame(function(){b(function(){l.draw();e()})})},{"../regl":30}],2:[function(g,n,q){function l(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}n.exports=function(h,p,e,b,d){h=e.maxAttributes;p=Array(h);for(e=0;e<h;++e)p[e]=new l;return{Record:l,scope:{},state:p}}},{}],3:[function(g,n,q){function l(b){return Q[Object.prototype.toString.call(b)]|0}function h(b,
d){for(var e=0;e<d.length;++e)b[e]=d[e]}function p(b,d,e,h,l,a,p){for(var g=0,U=0;U<e;++U)for(var la=0;la<h;++la)b[g++]=d[l*U+a*la+p]}function e(b,d,e){for(var h=0,l=0;l<d.length;++l)for(var a=d[l],p=0;p<e;++p)b[h++]=a[p]}var b=g("./util/is-typed-array"),d=g("./util/is-ndarray"),x=g("./util/values"),A=g("./util/pool"),Q=g("./constants/arraytypes.json"),F=g("./constants/dtypes.json"),u=g("./constants/usage.json");n.exports=function(z){function g(b){this.id=a++;this.buffer=z.createBuffer();this.type=
b;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121}function C(b,d,e){b.byteLength=d.byteLength;z.bufferData(b.type,d,e)}function r(a,m,z,g,r){a.usage=z;if(Array.isArray(m))a.dtype=g||5126,0<m.length&&(Array.isArray(m[0])?(a.dimension=m[0].length,g=A.allocType(a.dtype,m.length*a.dimension),e(g,m,a.dimension),C(a,g,z),A.freeType(g)):"number"===typeof m[0]?(a.dimension=r,g=A.allocType(a.dtype,m.length),h(g,m),C(a,g,z),A.freeType(g)):b(m[0])&&(a.dimension=m[0].length,a.dtype=g||l(m[0])||
5126,g=A.allocType(a.dtype,m.length*a.dimension),e(g,m,a.dimension),C(a,g,z),A.freeType(g)));else if(b(m))a.dtype=g||l(m),a.dimension=r,C(a,m,z);else if(d(m)){var D=m.shape,x=m.stride;r=m.offset;var O=0,R=0,L=0,S=0;1===D.length?(O=D[0],R=1,L=x[0],S=0):2===D.length&&(O=D[0],R=D[1],L=x[0],S=x[1]);a.dtype=g||l(m.data)||5126;a.dimension=R;g=A.allocType(a.dtype,O*R);p(g,m.data,O,R,L,S,r);C(a,g,z);A.freeType(g)}}function m(b){var d=b.buffer;z.isBuffer(d)&&z.deleteBuffer(d);b.buffer=null;delete V[b.id]}
var a=0,V={};g.prototype.bind=function(){z.bindBuffer(this.type,this.buffer)};var n=[];return{create:function(a,C,x){function n(a){var e=35044,m=null,l=0,h=0,g=1;Array.isArray(a)||b(a)||d(a)?m=a:"number"===typeof a?l=a|0:a&&("data"in a&&(m=a.data),"usage"in a&&(e=u[a.usage]),"type"in a&&(h=F[a.type]),"dimension"in a&&(g=a.dimension|0),"length"in a&&(l=a.length|0));B.bind();m?r(B,m,e,h,g):(z.bufferData(B.type,l,e),B.dtype=h||5121,B.usage=e,B.dimension=g,B.byteLength=l);return n}var B=new g(C);V[B.id]=
B;x||n(a);n._reglType="buffer";n._buffer=B;n.subdata=function(a,m){var g=(m||0)|0;B.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var r=A.allocType(B.dtype,a.length);h(r,a);z.bufferSubData(B.type,g,r);A.freeType(r)}else if(Array.isArray(a[0])||b(a[0])){var r=a[0].length,C=A.allocType(B.dtype,a.length*r);e(C,a,r);z.bufferSubData(B.type,g,C);A.freeType(C)}}else if(b(a))z.bufferSubData(B.type,g,a);else if(d(a)){var x=a.shape,L=a.stride,V=C=r=0,u=0;1===x.length?(r=x[0],C=1,V=L[0],
u=0):2===x.length&&(r=x[0],C=x[1],V=L[0],u=L[1]);x=Array.isArray(a.data)?B.dtype:l(a.data);x=A.allocType(x,r*C);p(x,a.data,r,C,V,u,a.offset);z.bufferSubData(B.type,g,x);A.freeType(x)}return n};n.destroy=function(){m(B)};return n},createStream:function(a,b){var d=n.pop();d||(d=new g(a),d.buffer=z.createBuffer());d.bind();r(d,b,35040,0,1);return d},destroyStream:function(a){n.push(a)},clear:function(){x(V).forEach(m)},getBuffer:function(a){return a&&a._buffer instanceof g?a._buffer:null},_initBuffer:r}}},
{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/pool":25,"./util/values":28}],4:[function(g,n,q){n.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(g,
n,q){n.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(g,n,q){n.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(g,n,q){n.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(g,n,q){function l(a){return Array.isArray(a)||Q(a)||F(a)}function h(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:
a<b?-1:1})}function p(a,b,d,e){this.thisDep=a;this.contextDep=b;this.propDep=d;this.append=e}function e(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function b(a){return new p(!1,!1,!1,a)}function d(a,b){var d=a.type;return 0===d?(d=a.data.length,new p(!0,1<=d,2<=d,b)):new p(3===d,2===d,1===d,b)}var x=g("./util/codegen"),A=g("./util/loop"),Q=g("./util/is-typed-array"),F=g("./util/is-ndarray"),u=g("./constants/primitives.json"),z=g("./constants/dtypes.json"),L=["x","y","z","w"],C={0:0,1:1,zero:0,
one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},r={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},m={0:0,zero:0,keep:7680,
replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},a={cw:2304,ccw:2305},V=new p(!1,!1,!1,function(){});n.exports=function(g,n,F,q,G,M,D,ha,O,R,Y,S,ia){function J(c){return c.replace(".","_")}function H(c,a,b){var d=J(c);t.push(c);y[d]=f[d]=!!b;ma[d]=a}function I(c,a,b){var d=J(c);t.push(c);Array.isArray(b)?(f[d]=b.slice(),y[d]=b.slice()):f[d]=y[d]=b;na[d]=a}function ja(){var c=x(),a=c.link,b=c.global;c.id=X++;c.batchId="0";var d=a(Fa),E=c.shared=
{props:"a0"};Object.keys(Fa).forEach(function(k){E[k]=b.def(d,".",k)});var w=c.next={},Ha=c.current={};Object.keys(na).forEach(function(k){Array.isArray(f[k])&&(w[k]=b.def(E.next,".",k),Ha[k]=b.def(E.current,".",k))});var k=c.constants={};Object.keys(Aa).forEach(function(c){k[c]=b.def(JSON.stringify(Aa[c]))});c.invoke=function(k,f){switch(f.type){case 0:var ya=["this",E.context,E.props,c.batchId];return k.def(a(f.data),".call(",ya.slice(0,Math.max(f.data.length+1,4)),")");case 1:return k.def(E.props,
f.data);case 2:return k.def(E.context,f.data);case 3:return k.def("this",f.data)}};c.attribCache={};var ya={};c.scopeAttrib=function(k){k=n.id(k);if(k in ya)return ya[k];var c=R.scope[k];c||(c=R.scope[k]=new sa);return ya[k]=a(c)};return c}function fa(c){var f=c["static"];c=c.dynamic;if("framebuffer"in f){var a=f.framebuffer;return a?(a=ha.getFramebuffer(a),b(function(c,f){var v=c.link(a),k=c.shared;f.set(k.framebuffer,".next",v);k=k.context;f.set(k,".framebufferWidth",v+".width");f.set(k,".framebufferHeight",
v+".height");return v})):b(function(c,f){var a=c.shared;f.set(a.framebuffer,".next","null");a=a.context;f.set(a,".framebufferWidth",a+".drawingBufferWidth");f.set(a,".framebufferHeight",a+".drawingBufferHeight");return null})}if("framebuffer"in c){var e=c.framebuffer;return d(e,function(c,f){var a=c.invoke(f,e),k=c.shared,v=k.framebuffer,a=f.def(v,".getFramebuffer(",a,")");f.set(v,".next",a);k=k.context;f.set(k,".framebufferWidth",a+"?"+a+".width:"+k+".drawingBufferWidth");f.set(k,".framebufferHeight",
a+"?"+a+".height:"+k+".drawingBufferHeight");return a})}return null}function oa(c,f){function a(k){if(k in b){var c=b[k];k=!0;var Ga=c.x|0,w=c.y|0,e,ra;"w"in c?e=c.w|0:k=!1;"h"in c?ra=c.h|0:k=!1;return new p(k&&f&&f.thisDep,k&&f&&f.contextDep,k&&f&&f.propDep,function(k,f){var a=k.shared.context,v=e;"w"in c||(v=f.def(a,".","framebufferWidth","-",Ga));var b=ra;"h"in c||(b=f.def(a,".","framebufferHeight","-",w));return[Ga,w,v,b]})}if(k in E){var m=E[k];k=d(m,function(k,c){var f=k.invoke(c,m),a=k.shared.context,
v=c.def(f,".x|0"),b=c.def(f,".y|0"),d=c.def('"w" in ',f,"?",f,".w|0:","(",a,".","framebufferWidth","-",v,")"),f=c.def('"h" in ',f,"?",f,".h|0:","(",a,".","framebufferHeight","-",b,")");return[v,b,d,f]});f&&(k.thisDep=k.thisDep||f.thisDep,k.contextDep=k.contextDep||f.contextDep,k.propDep=k.propDep||f.prpoDep);return k}return f?new p(f.thisDep,f.contextDep,f.propDep,function(k,c){var f=k.shared.context;return[0,0,c.def(f,".","framebufferWidth"),c.def(f,".","framebufferHeight")]}):null}var b=c["static"],
E=c.dynamic,w=a("viewport");if(w)var e=w,w=new p(w.thisDep,w.contextDep,w.propDep,function(k,c){var f=e.append(k,c),a=k.shared.context;c.set(a,".viewportWidth",f[2]);c.set(a,".viewportHeight",f[3]);return f});return{viewport:w,scissor_box:a("scissor.box")}}function K(c){function f(k){if(k in a){var c=n.id(a[k]);k=b(function(){return c});k.id=c;return k}if(k in m){var v=m[k];return d(v,function(k,c){var f=k.invoke(c,v);return c.def(k.shared.strings,".id(",f,")")})}return null}var a=c["static"],m=c.dynamic,
E=f("frag"),w=f("vert"),l=null;e(E)&&e(w)?(l=Y.program(w.id,E.id),c=b(function(k,c){return k.link(l)})):c=new p(E&&E.thisDep||w&&w.thisDep,E&&E.contextDep||w&&w.contextDep,E&&E.propDep||w&&w.propDep,function(k,c){var f=k.shared.shader,a;a=E?E.append(k,c):c.def(f,".","frag");var v;v=w?w.append(k,c):c.def(f,".","vert");return c.def(f+".program("+v+","+a+")")});return{frag:E,vert:w,progVar:c,program:l}}function ua(c){function f(c,k){if(c in a){var v=a[c]|0;return b(function(c,f){k&&(c.OFFSET=v);return v})}if(c in
m){var w=m[c];return d(w,function(c,f){var a=c.invoke(f,w);k&&(c.OFFSET=a);return a})}return k&&E?b(function(k,c){k.OFFSET="0";return 0}):null}var a=c["static"],m=c.dynamic,E=function(){if("elements"in a){var c=a.elements;l(c)?c=M.getElements(M.create(c)):c&&(c=M.getElements(c));var k=b(function(k,f){if(c){var a=k.link(c);return k.ELEMENTS=a}return k.ELEMENTS=null});k.value=c;return k}if("elements"in m){var f=m.elements;return d(f,function(k,c){var a=k.shared,v=a.isBufferArgs,a=a.elements,b=k.invoke(c,
f),d=c.def("null"),v=c.def(v,"(",b,")"),b=k.cond(v).then(d,"=",a,".createStream(",b,");")["else"](d,"=",a,".getElements(",b,");");c.entry(b);c.exit(k.cond(v).then(a,".destroyStream(",d,");"));return k.ELEMENTS=d})}return null}(),w=f("offset",!0);return{elements:E,primitive:function(){if("primitive"in a){var c=a.primitive;return b(function(k,f){return u[c]})}if("primitive"in m){var k=m.primitive;return d(k,function(c,f){var a=c.constants.primTypes,v=c.invoke(f,k);return f.def(a,"[",v,"]")})}return E?
e(E)?E.value?b(function(k,c){return c.def(k.ELEMENTS,".primType")}):b(function(){return 4}):new p(E.thisDep,E.contextDep,E.propDep,function(k,c){var f=k.ELEMENTS;return c.def(f,"?",f,".primType:",4)}):null}(),count:function(){if("count"in a){var c=a.count|0;return b(function(){return c})}if("count"in m){var k=m.count;return d(k,function(c,f){return c.invoke(f,k)})}return E?e(E)?E?w?new p(w.thisDep,w.contextDep,w.propDep,function(k,c){return c.def(k.ELEMENTS,".vertCount-",k.OFFSET)}):b(function(k,
c){return c.def(k.ELEMENTS,".vertCount")}):b(function(){return-1}):new p(E.thisDep||w.thisDep,E.contextDep||w.contextDep,E.propDep||w.propDep,function(k,c){var f=k.ELEMENTS;return k.OFFSET?c.def(f,"?",f,".vertCount-",k.OFFSET,":-1"):c.def(f,"?",f,".vertCount:-1")}):null}(),instances:f("instances",!1),offset:w}}function P(c){var f=c["static"],e=c.dynamic,l={};t.forEach(function(c){function w(k,a){if(c in f){var w=k(f[c]);l[h]=b(function(){return w})}else if(c in e){var m=e[c];l[h]=d(m,function(k,c){return a(k,
c,k.invoke(c,m))})}}var h=J(c);switch(c){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return w(function(k){return k},function(k,c,f){return f});case "depth.func":return w(function(k){return r[k]},function(k,c,f){return c.def(k.constants.compareFuncs,"[",f,"]")});case "depth.range":return w(function(k){return k},function(k,c,f){k=c.def("+",f,
"[0]");c=c.def("+",f,"[1]");return[k,c]});case "blend.func":return w(function(c){return[C["srcRGB"in c?c.srcRGB:c.src],C["dstRGB"in c?c.dstRGB:c.dst],C["srcAlpha"in c?c.srcAlpha:c.src],C["dstAlpha"in c?c.dstAlpha:c.dst]]},function(c,f,a){function v(c,k){var d=f.def('"',c,k,'" in ',a,"?",a,".",c,k,":",a,".",c);return f.def(b,"[",d,"]")}var b=c.constants.blendFuncs;c=v("src","RGB");var d=v("src","Alpha"),w=v("dst","RGB"),e=v("dst","Alpha");return[c,w,d,e]});case "blend.equation":return w(function(c){if("string"===
typeof c)return[Z[c],Z[c]];if("object"===typeof c)return[Z[c.rgb],Z[c.alpha]]},function(c,f,a){var v=c.constants.blendEquations,b=f.def(),d=f.def();c=c.cond("typeof ",a,'==="string"');c.then(b,"=",d,"=",v,"[",a,"];");c["else"](b,"=",v,"[",a,".rgb];",d,"=",v,"[",a,".alpha];");f(c);return[b,d]});case "blend.color":return w(function(c){return A(4,function(f){return+c[f]})},function(c,f,a){return A(4,function(c){return f.def("+",a,"[",c,"]")})});case "stencil.mask":return w(function(c){return c|0},function(c,
f,a){return f.def(a,"|0")});case "stencil.func":return w(function(c){return[r[c.cmp||"keep"],c.ref||0,"mask"in c?c.mask:-1]},function(c,f,a){c=f.def('"cmp" in ',a,"?",c.constants.compareFuncs,"[",a,".cmp]",":",7680);var v=f.def(a,".ref|0");f=f.def('"mask" in ',a,"?",a,".mask|0:-1");return[c,v,f]});case "stencil.opFront":case "stencil.opBack":return w(function(f){return["stencil.opBack"===c?1029:1028,m[f.fail||"keep"],m[f.zfail||"keep"],m[f.pass||"keep"]]},function(f,a,v){function b(c){return a.def('"',
c,'" in ',v,"?",d,"[",v,".",c,"]:",7680)}var d=f.constants.stencilOps;return["stencil.opBack"===c?1029:1028,b("fail"),b("zfail"),b("pass")]});case "polygonOffset.offset":return w(function(c){return[c.factor|0,c.units|0]},function(c,f,a){c=f.def(a,".factor|0");f=f.def(a,".units|0");return[c,f]});case "cull.face":return w(function(c){var f=0;"front"===c?f=1028:"back"===c&&(f=1029);return f},function(c,f,a){return f.def(a,'==="front"?',1028,":",1029)});case "lineWidth":return w(function(c){return c},
function(c,f,a){return a});case "frontFace":return w(function(c){return a[c]},function(c,f,a){return f.def(a+'==="cw"?2304:2305')});case "colorMask":return w(function(c){return c.map(function(c){return!!c})},function(c,f,a){return A(4,function(c){return"!!"+a+"["+c+"]"})});case "sample.coverage":return w(function(c){return["value"in c?c.value:1,!!c.invert]},function(c,f,a){c=f.def('"value" in ',a,"?+",a,".value:1");f=f.def("!!",a,".invert");return[c,f]})}});return l}function pa(c){var f=c["static"],
a=c.dynamic,e={};Object.keys(f).forEach(function(c){var a=f[c],d;if("number"===typeof a||"boolean"===typeof a)d=b(function(){return a});else if("function"===typeof a&&("texture2d"===a._reglType||"textureCube"===a._reglTYpe))d=b(function(c){return c.link(a)});else if(Array.isArray(a)||Q(a))d=b(function(c){return c.global.def("[",A(a.length,function(c){return a[c]}),"]")});d.value=a;e[c]=d});Object.keys(a).forEach(function(c){var f=a[c];e[c]=d(f,function(c,a){return c.invoke(a,f)})});return e}function T(c){var f=
c["static"],a=c.dynamic,e={};Object.keys(f).forEach(function(c){var a=f[c],d=n.id(c),k=new sa;if(l(a))k.state=1,k.buffer=G.getBuffer(G.create(a,34962,!1)),k.type=k.buffer.dtype;else{var m=G.getBuffer(a);if(m)k.state=1,k.buffer=m,k.type=m.dtype;else if(a.constant){var h=a.constant;k.state=2;"number"===typeof h?k.x=h:L.forEach(function(c,f){f<h.length&&(k[c]=h[f])})}else{var m=G.getBuffer(a.buffer),t=a.offset|0,y=a.stride|0,g=a.size|0,ra=!!a.normalized,p=0;"type"in a&&(p=z[a.type]);a=a.divisor|0;k.buffer=
m;k.state=1;k.size=g;k.normalized=ra;k.type=p||m.dtype;k.offset=t;k.stride=y;k.divisor=a}}e[c]=b(function(c,f){var a=c.attribCache;if(d in a)return a[d];var b={isStream:!1};Object.keys(k).forEach(function(c){b[c]=k[c]});k.buffer&&(b.buffer=c.link(k.buffer));return a[d]=b})});Object.keys(a).forEach(function(c){var f=a[c];e[c]=d(f,function(c,a){function b(c){a(l[c],"=",v,".",c,"|0;")}var v=c.invoke(a,f),d=c.shared,e=d.isBufferArgs,m=d.buffer,l={isStream:a.def(!1)},h=new sa;h.state=1;Object.keys(h).forEach(function(c){l[c]=
a.def(""+h[c])});var t=l.buffer,y=l.type;a("if(",e,"(",v,")){",l.isStream,"=true;",t,"=",m,".createStream(",34962,",",v,");",y,"=",t,".dtype;","}else{",t,"=",m,".getBuffer(",v,");","if(",t,"){",y,"=",t,".dtype;","}else if(",v,".constant){",l.state,"=",2,";",L.map(function(c,f){return l[c]+"="+v+".length>="+f+"?"+v+"["+f+"]:0;"}).join(""),"}else{",t,"=",m,".getBuffer(",v,".buffer);",y,'="type" in ',v,"?",d.glTypes,"[",v,".type]:",t,".dtype;",l.normalized,"=!!",v,".normalized;");b("size");b("offset");
b("stride");b("divisor");a("}}");return l})});return e}function N(c){var f=c["static"],a=c.dynamic,e={};Object.keys(f).forEach(function(c){var a=f[c];e[c]=b(function(c,f){return"number"===typeof a||"boolean"===typeof a?""+a:c.link(a)})});Object.keys(a).forEach(function(c){var f=a[c];e[c]=d(f,function(c,a){return c.invoke(a,f)})});return e}function W(c,f,a){var b=c.shared.context,d=c.scope();Object.keys(a).forEach(function(e){f.save(b,"."+e);d(b,".",e,"=",a[e].append(c,f),";")});f(d)}function ba(c,
f,a){var b=c.shared,d=b.gl,e=b.framebuffer,m;ga&&(m=f.def(b.extensions,".webgl_draw_buffers"));var k=c.constants,b=k.drawBuffer,k=k.backBuffer;c=a?a.append(c,f):f.def(e,".next");f("if(",e,".dirty||",c,"!==",e,".cur){","if(",c,"){",d,".bindFramebuffer(",36160,",",c,".framebuffer);");ga&&f(m,".drawBuffersWEBGL(",b,"[",c,".colorAttachments.length]);");f("}else{",d,".bindFramebuffer(",36160,",null);");ga&&f(m,".drawBuffersWEBGL(",k,");");f("}",e,".cur=",c,";",e,".dirty=false;","}")}function qa(c,a,b){var d=
c.shared,e=d.gl,m=c.current,l=c.next,k=d.current,h=d.next,y=c.cond(k,".dirty");t.forEach(function(a){a=J(a);if(!(a in b.state)){var d,v;if(a in l){d=l[a];v=m[a];var t=A(f[a].length,function(c){return y.def(d,"[",c,"]")});y(c.cond(t.map(function(c,f){return c+"==="+v+"["+f+"]"}).join("&&")).then(e,".",na[a],"(",t,");",t.map(function(c,f){return v+"["+f+"]="+c}).join(";"),";"))}else d=y.def(h,".",a),t=c.cond(d,"!==",k,".",a),y(t),a in ma?t(c.cond(d).then(e,".enable(",ma[a],");")["else"](e,".disable(",
ma[a],");"),k,".",a,"=",d,";"):t(e,".",na[a],"(",d,");",k,".",a,"=",d,";")}});0===Object.keys(b.state).length&&y(k,".dirty=false;");a(y)}function va(c,f,a,b){var d=c.shared,m=c.current,l=d.current,k=d.gl;h(Object.keys(a)).forEach(function(d){var t=a[d];if(!b||b(t)){var h=t.append(c,f);if(ma[d]){var y=ma[d];e(t)?h?f(k,".enable(",y,");"):f(k,".disable(",y,");"):f(c.cond(h).then(k,".enable(",y,");")["else"](k,".disable(",y,");"));f(l,".",d,"=",h,";")}else if(Array.isArray(h)){var g=m[d];f(k,".",na[d],
"(",h,");",h.map(function(c,f){return g+"["+f+"]="+c}).join(";"),";")}else f(k,".",na[d],"(",h,");",l,".",d,"=",h,";")}})}function ta(c,f){ka&&!c.instancing&&(c.instancing=f.def(c.shared.extensions,".angle_instanced_arrays"))}function wa(c,f,a,d,b){function e(c){switch(c){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function m(a,d,b){function e(){f("if(!",y,".pointer){",h,".enableVertexAttribArray(",
t,");",y,".pointer=true;}");var a=b.type,k;k=b.size?f.def(b.size,"||",d):d;f("if(",y,".type!==",a,"||",y,".size!==",k,"||",ra.map(function(c){return y+"."+c+"!=="+b[c]}).join("||"),"){",h,".bindBuffer(",34962,",",g,".buffer);",h,".vertexAttribPointer(",[t,k,a,b.normalized,b.stride,b.offset],");",y,".type=",a,";",y,".size=",k,";",ra.map(function(c){return y+"."+c+"="+b[c]+";"}).join(""),"}");ka&&(a=b.divisor,f("if(",y,".divisor!==",a,"){",c.instancing,".vertexAttribDivisorANGLE(",[t,a],");",y,".divisor=",
a,";}"))}function l(){f("if(",y,".pointer){",h,".disableVertexAttribArray(",t,");",y,".pointer=false;","}if(",L.map(function(c,f){return y+"."+c+"!=="+w[f]}).join("||"),"){",h,".vertexAttrib4f(",t,",",w,");",L.map(function(c,f){return y+"."+c+"="+w[f]+";"}).join(""),"}")}var h=k.gl,t=f.def(a,".location"),y=f.def(k.attributes,"[",t,"]");a=b.state;var g=b.buffer,w=[b.x,b.y,b.z,b.w],ra=["buffer","normalized","offset","stride"];1===a?e():2===a?l():(f("if(",a,"===",1,"){"),e(),f("}else{"),l(),f("}"))}
var k=c.shared;d.forEach(function(k){var d=k.name,y=a.attributes[d],h;if(y){if(!b(y))return;h=y.append(c,f)}else{if(!b(V))return;var t=c.scopeAttrib(d);h={};Object.keys(new sa).forEach(function(c){h[c]=f.def(t,".",c)})}m(c.link(k),e(k.info.type),h)})}function aa(c,f,a,b,d){for(var e=c.shared,m=e.gl,k,y=0;y<b.length;++y){var h=b[y],t=h.name,l=h.info.type,g=a.uniforms[t],h=c.link(h)+".location";if(g){if(!d(g))continue;if(g["static"]){t=g.value;if(35678===l||35680===l)l=c.link(t._texture),f(m,".uniform1i(",
h,l+".bind());"),f.exit(l,".unbind()");else if(35674===l||35675===l||35676===l)t=c.global.def("["+t+"]"),g=2,35675===l?g=3:35676===l&&(g=4),f(m,".uniformMatrix",g,"fv(",h,",false,",t,");");else{switch(l){case 5126:k="1f";break;case 35664:k="2f";break;case 35665:k="3f";break;case 35666:k="4f";break;case 35670:k="1i";break;case 5124:k="1i";break;case 35671:k="2i";break;case 35667:k="2i";break;case 35672:k="3i";break;case 35668:k="3i";break;case 35673:k="4i";break;case 35669:k="4i"}f(m,".uniform",k,
"(",h,",",t,");")}continue}else t=g.append(c,f)}else{if(!d(V))continue;t=f.def(e.uniforms,"[",n.id(t),"]")}g=",";switch(l){case 35678:case 35680:l=f.def(t,"._texture");f(m,".uniform1i(",h,",",l,".bind());");f.exit(l,".unbind();");continue;case 5124:case 35670:k="1i";break;case 35667:case 35671:k="2iv";break;case 35668:case 35672:k="3iv";break;case 35669:case 35673:k="4iv";break;case 5126:k="1f";break;case 35664:k="2fv";break;case 35665:k="3fv";break;case 35666:k="4fv";break;case 35674:k="Matrix2fv";
g=",false,";break;case 35675:k="Matrix3fv";g=",false,";break;case 35676:k="Matrix4fv",g=",false,"}f(m,".uniform",k,"(",h,g,t,");")}}function ca(c,f,a,b){function d(k){var b=y[k];return b?b.batchStatic?b.append(c,f):b.append(c,a):f.def(t,".",k)}function m(){function c(){a(D,".drawElementsInstancedANGLE(",[p,r,C,z+"<<(("+C+"-5121)>>1)",x],");")}function f(){a(D,".drawArraysInstancedANGLE(",[p,z,r,x],");")}g?n?c():(a("if(",g,"){"),c(),a("}else{"),f(),a("}")):f()}function l(){function c(){a(h+".drawElements("+
[p,r,C,z+"<<(("+C+"-5121)>>1)"]+");")}function f(){a(h+".drawArrays("+[p,z,r]+");")}g?n?c():(a("if(",g,"){"),c(),a("}else{"),f(),a("}")):f()}var k=c.shared,h=k.gl,t=k.draw,y=b.draw,g=function(){var k=y.elements,b=f;k?(k.batchStatic||(b=a),k=k.append(c,b)):k=b.def(t,".","elements");k&&b("if("+k+")"+h+".bindBuffer(34963,"+k+".buffer.buffer);");return k}(),p=d("primitive"),z=d("offset"),r=function(){var k=y.count,b=f;k?(k.batchStatic||(b=a),k=k.append(c,b)):k=b.def(t,".","count");return k}();if("number"===
typeof r){if(0===r)return}else a("if(",r,"){"),a.exit("}");var x,D;ka&&(x=d("instances"),D=c.instancing);var C=g+".type",n=y.elements&&e(y.elements);ka&&("number"!==typeof x||0<=x)?"string"===typeof x?(a("if(",x,">0){"),m(),a("}else if(",x,"<0){"),l(),a("}")):m():l()}function da(c,f,a,b,d){f=ja();d=f.proc("body",d);ka&&(f.instancing=d.def(f.shared.extensions,".angle_instanced_arrays"));c(f,d,a,b);return f.compile().body}function Ba(c,f,a,b){ta(c,f);wa(c,f,a,b.attributes,function(){return!0});aa(c,
f,a,b.uniforms,function(){return!0});ca(c,f,f,a)}function Ca(c,f){var a=c.proc("draw",1);ta(c,a);W(c,a,f.context);ba(c,a,f.framebuffer);qa(c,a,f);va(c,a,f.state);var b=f.shader.progVar.append(c,a);a(c.shared.gl,".useProgram(",b,".program);");if(f.shader.program)Ba(c,a,f,f.shader.program);else{var d=c.global.def("{}"),e=a.def(b,".id"),m=a.def(d,"[",e,"]");a(c.cond(m).then(m,".call(this,a0);")["else"](m,"=",d,"[",e,"]=",c.link(function(a){return da(Ba,c,f,a,1)}),"(",b,");",m,".call(this,a0);"))}0<Object.keys(f.state).length&&
a(c.shared.current,".dirty=true;")}function Ea(c,f,a,b){function d(){return!0}c.batchId="a1";ta(c,f);wa(c,f,a,b.attributes,d);aa(c,f,a,b.uniforms,d);ca(c,f,f,a)}function xa(c,f,a,b){function d(c){return c.contextDep&&m||c.propDep}function e(c){return!d(c)}ta(c,f);var m=a.contextDynamic,k=f.def(),h=f.def();c.shared.props=h;c.batchId=k;var t=c.scope(),l=c.scope();f(t.entry,"for(",k,"=0;",k,"<","a1",";++",k,"){",h,"=","a0","[",k,"];",l,"}",t.exit);a.needsContext&&W(c,l,a.context);a.needsFramebuffer&&
ba(c,l,a.framebuffer);va(c,l,a.state,d);b?(wa(c,t,a,b.attributes,e),wa(c,l,a,b.attributes,d),aa(c,t,a,b.uniforms,e),aa(c,l,a,b.uniforms,d),ca(c,t,l,a)):(f=c.global.def("{}"),b=a.shader.progVar.append(c,l),h=l.def(b,".id"),t=l.def(f,"[",h,"]"),l(c.shared.gl,".useProgram(",b,".program);","if(!",t,"){",t,"=",f,"[",h,"]=",c.link(function(f){return da(Ea,c,a,f,2)}),"(",b,");}",t,".call(this,a0[",k,"],",k,");"))}function Da(c,f){var a=c.proc("batch",2);c.batchId="0";ta(c,a);var b=!1,d=!0;Object.keys(f.context).forEach(function(c){b=
b||f.context[c].propDep});b||(W(c,a,f.context),d=!1);var e=f.framebuffer,m=!1;e&&(e.propDep?b=m=!0:e.contextDep&&b&&(m=!0),m||ba(c,a,e));f.state.viewport&&f.state.viewport.propDynamic&&(b=!0);qa(c,a,f);va(c,a,f.state,function(c){return!(c.contextDep&&b||c.propDep)});f.contextDep=b;f.needsContext=d;f.needsFramebuffer=m;d=f.shader.progVar;if(d.contextDep&&b||d.propDep)xa(c,a,f,null);else if(d=d.append(c,a),a(c.shared.gl,".useProgram(",d,".program);"),f.shader.program)xa(c,a,f,f.shader.program);else{var e=
c.global.def("{}"),m=a.def(d,".id"),k=a.def(e,"[",m,"]");a(c.cond(k).then(k,".call(this,a0,a1);")["else"](k,"=",e,"[",m,"]=",c.link(function(a){return da(xa,c,f,a,2)}),"(",d,");",k,".call(this,a0,a1);"))}0<Object.keys(f.state).length&&a(c.shared.current,".dirty=true;")}function za(c,f){function a(e){var k=f.shader[e];k&&b.set(d.shader,"."+e,k.append(c,b))}var b=c.proc("scope",3);c.batchId="a2";var d=c.shared,e=d.current;W(c,b,f.context);f.framebuffer&&f.framebuffer.append(c,b);h(Object.keys(f.state)).forEach(function(a){var k=
f.state[a].append(c,b);Array.isArray(k)?k.forEach(function(f,k){b.set(c.next[a],"["+k+"]",f)}):b.set(d.next,"."+a,k)});["elements","offset","count","instances","primitive"].forEach(function(a){var k=f.draw[a];k&&b.set(d.draw,"."+a,""+k.append(c,b))});Object.keys(f.uniforms).forEach(function(a){b.set(d.uniforms,"["+n.id(a)+"]",f.uniforms[a].append(c,b))});Object.keys(f.attributes).forEach(function(a){var k=f.attributes[a].append(c,b),d=c.scopeAttrib(a);Object.keys(new sa).forEach(function(c){b.set(d,
"."+c,k[c])})});a("vert");a("frag");0<Object.keys(f.state).length&&(b(e,".dirty=true;"),b.exit(e,".dirty=true;"));b("a1(",c.shared.context,",a0,0);")}var sa=R.Record,Z={add:32774,subtract:32778,"reverse subtract":32779};F.ext_blend_minmax&&(Z.min=32775,Z.max=32776);var ka=F.angle_instanced_arrays,ga=F.webgl_draw_buffers,f={dirty:!0},y={},t=[],ma={},na={};H("dither",3024);H("blend.enable",3042);I("blend.color","blendColor",[0,0,0,0]);I("blend.equation","blendEquationSeparate",[32774,32774]);I("blend.func",
"blendFuncSeparate",[1,0,1,0]);H("depth.enable",2929,!0);I("depth.func","depthFunc",513);I("depth.range","depthRange",[0,1]);I("depth.mask","depthMask",!0);I("colorMask","colorMask",[!0,!0,!0,!0]);H("cull.enable",2884);I("cull.face","cullFace",1029);I("frontFace","frontFace",2305);I("lineWidth","lineWidth",1);H("polygonOffset.enable",32823);I("polygonOffset.offset","polygonOffset",[0,0]);H("sample.alpha",32926);H("sample.enable",32928);I("sample.coverage","sampleCoverage",[1,!1]);H("stencil.enable",
2960);I("stencil.mask","stencilMask",-1);I("stencil.func","stencilFunc",[519,0,-1]);I("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);I("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);H("scissor.enable",3089);I("scissor.box","scissor",[0,0,g.drawingBufferWidth,g.drawingBufferHeight]);I("viewport","viewport",[0,0,g.drawingBufferWidth,g.drawingBufferHeight]);var Fa={gl:g,context:ia,strings:n,next:y,current:f,draw:S,elements:M,buffer:G,shader:Y,attributes:R.state,uniforms:O,
framebuffer:ha,extensions:F,isBufferArgs:l},Aa={primTypes:u,compareFuncs:r,blendFuncs:C,blendEquations:Z,stencilOps:m,glTypes:z,orientationType:a};ga&&(Aa.backBuffer=[1029],Aa.drawBuffer=A(q.maxDrawbuffers,function(c){return 0===c?[0]:A(c,function(c){return 36064+c})}));var X=0;return{next:y,current:f,procs:function(){var c=ja(),a=c.proc("poll"),b=c.proc("refresh"),d=c.block();a(d);b(d);var e=c.shared,m=e.gl,l=e.next,k=e.current;d(k,".dirty=false;");ba(c,a);b(e.framebuffer,".dirty=true;");ba(c,b);
Object.keys(ma).forEach(function(f){var e=ma[f],t=d.def(l,".",f),h=c.block();h("if(",t,"){",m,".enable(",e,")}else{",m,".disable(",e,")}",k,".",f,"=",t,";");b(h);a("if(",t,"!==",k,".",f,"){",h,"}")});Object.keys(na).forEach(function(e){var t=na[e],h=f[e],y,g,p=c.block();p(m,".",t,"(");Array.isArray(h)?(t=h.length,y=c.global.def(l,".",e),g=c.global.def(k,".",e),p(A(t,function(c){return y+"["+c+"]"}),");",A(t,function(c){return g+"["+c+"]="+y+"["+c+"];"}).join("")),a("if(",A(t,function(c){return y+
"["+c+"]!=="+g+"["+c+"]"}).join("||"),"){",p,"}")):(y=d.def(l,".",e),g=d.def(k,".",e),p(y,");",k,".",e,"=",y,";"),a("if(",y,"!==",g,"){",p,"}"));b(p)});return c.compile()}(),compile:function(c,f,a,b){var d=ja(),e;e=fa(c);var m=oa(c,e),k=ua(c),t=P(c);c=K(c);var l=m.viewport;l&&(t.viewport=l);l=J("scissor.box");(m=m[l])&&(t[l]=m);m=0<Object.keys(t).length;e={framebuffer:e,draw:k,shader:c,state:t,dirty:m};e.uniforms=pa(a);e.attributes=T(f);e.context=N(b);Ca(d,e);za(d,e);Da(d,e);return d.compile()}}}},
{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":20,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/loop":24}],9:[function(g,n,q){function l(b,d){this.id=e++;this.type=b;this.data=d}function h(b){if(0===b.length)return[];var d=b.charAt(0),e=b.charAt(b.length-1);if(1<b.length&&d===e&&('"'===d||"'"===d))return['"'+b.substr(1,b.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(d=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return h(b.substr(0,d.index)).concat(h(d[1])).concat(h(b.substr(d.index+
d[0].length)));d=b.split(".");if(1===d.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(e=0;e<d.length;++e)b=b.concat(h(d[e]));return b}function p(b){return"["+h(b).join("][")+"]"}var e=0;n.exports={define:function(b,d){switch(typeof d){case "boolean":case "number":case "string":return new l(b,p(d+""));case "undefined":return new l(b|128,null)}},isDynamic:function(b){return"function"===typeof b&&!b._reglType||b instanceof l},unbox:function(b,d){if(b instanceof l){if(b.type&
128)return new l(b.type&-129,p(d))}else if("function"===typeof b)return new l(0,b);return b},accessor:p}},{}],10:[function(g,n,q){var l=g("./util/is-typed-array"),h=g("./util/is-ndarray"),p=g("./constants/primitives.json"),e=g("./constants/usage.json");n.exports=function(b,d,g){function n(b){this.buffer=b;this.primType=4;this.type=this.vertCount=0}function Q(b,e,p,r,m,a,n){(a=n)||l(e)&&(!h(e)||l(e.data))||(a=d.oes_element_index_uint?5125:5123);b.buffer.bind();g._initBuffer(b.buffer,e,p,a,3);e=n;if(!n){switch(b.buffer.dtype){case 5121:case 5120:e=
5121;break;case 5123:case 5122:e=5123;break;case 5125:case 5124:e=5125}b.buffer.dtype=e}b.type=e;0>m&&(m=b.buffer.byteLength,5123===e?m>>=1:5125===e&&(m>>=2));b.vertCount=m;m=r;0>r&&(m=4,r=b.buffer.dimension,1===r&&(m=0),2===r&&(m=1),3===r&&(m=4));b.primType=m}var F={uint8:5121,uint16:5123};d.oes_element_index_uint&&(F.uint32=5125);n.prototype.bind=function(){this.buffer.bind()};var u=[];return{create:function(d){function u(d){if(d)if("number"===typeof d)C(d),r.primType=4,r.vertCount=d|0,r.type=5121;
else{var a=null,g=35044,z=-1,n=-1,x=0,A=0;Array.isArray(d)||l(d)||h(d)?a=d:("data"in d&&(a=d.data),"usage"in d&&(g=e[d.usage]),"primitive"in d&&(z=p[d.primitive]),"count"in d&&(n=d.count|0),"length"in d&&(x=d.length|0),"type"in d&&(A=F[d.type]));a?Q(r,a,g,z,n,x,A):(d=r.buffer,d.bind(),b.bufferData(34963,x,g),d.dtype=A||5121,d.usage=g,d.dimension=3,d.byteLength=x,r.primType=0>z?4:z,r.vertCount=0>n?0:n,r.type=d.dtype)}else C(),r.primType=4,r.vertCount=0,r.type=5121;return u}var C=g.create(null,34963,
!0),r=new n(C._buffer);u(d);u._reglType="elements";u._elements=r;u.subdata=function(b,a){C.subdata(b,a);return u};u.destroy=function(){C.destroy();r.buffer=null};return u},createStream:function(b){var d=u.pop();d||(d=new n(g.create(null,34963,!0)._buffer));Q(d,b,35040,-1,-1,0,0);return d},destroyStream:function(b){u.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof n?b._elements:null}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":22,
"./util/is-typed-array":23}],11:[function(g,n,q){n.exports=function(l){function h(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(e){try{g[e]=
l.getExtension(e)}catch(b){}})}var g={};h();return{extensions:g,refresh:h}}},{}],12:[function(g,n,q){var l=g("./util/values"),h=g("./util/extend");n.exports=function(g,e,b,d,n){function A(a,b,d,e){this.target=a;this.level=b;this.texture=d;this.renderbuffer=e}function Q(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function F(a,b){var d=b.width,e=b.height;if(a.texture)var l=a.texture._texture,h=Math.max(1,l.params.width>>a.level),g=Math.max(1,
l.params.height>>a.level),d=d||h,e=e||g;else l=a.renderbuffer._renderbuffer,d=d||l.width,e=e||l.height;l.refCount+=1;b.width=d;b.height=e}function u(a,b){b?b.texture?g.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):g.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):g.framebufferTexture2D(36160,a,3553,null,0)}function z(a){var b=3553,d=0,e=null,l=null;"object"===typeof a&&("level"in a&&(d=a.level|0),"target"in a&&(b=a.target|0));var h=a._reglType;
"texture"===h?e=a:"renderbuffer"===h&&(l=a,b=36161,d=0);return new A(b,d,e,l)}function L(a){return a&&(a.texture||a.renderbuffer)}function C(){this.id=G++;M[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function r(d){g.isFramebuffer(d.framebuffer)||(d.framebuffer=g.createFramebuffer());a.dirty=!0;g.bindFramebuffer(36160,d.framebuffer);for(var l=
d.colorAttachments,h=0;h<l.length;++h)u(36064+h,l[h]);for(h=l.length;h<b.maxColorAttachments;++h)u(36064+h,null);u(36096,d.depthAttachment);u(36128,d.stencilAttachment);u(33306,d.depthStencilAttachment);e.webgl_draw_buffers&&e.webgl_draw_buffers.drawBuffersWEBGL(ea[l.length]);g.checkFramebufferStatus(36160)}function m(a){a=a.framebuffer;g.isFramebuffer(a)&&g.deleteFramebuffer(a)}var a={current:null,next:null,dirty:!1},V={rgba:6408},B={rgba4:32854,rgb565:36194,"rgb5 a1":32855};e.ext_srgb&&(B.srgba=
35907);e.ext_color_buffer_half_float&&(B.rgba16f=34842,B.rgb16f=34843);e.webgl_color_buffer_float&&(B.rgba32f=34836);var q=[],la=[];e.webgl_depth_texture&&(q.push(6402),la.push(34041));h(h({},V),B);l(V);l(B);B=5121;q={uint8:5121};e.oes_texture_half_float&&(B=q["half float"]=36193);e.oes_texture_float&&(B=q["float"]=5126);q.best=B;var ea=function(){for(var a=Array(b.maxDrawbuffers),d=0;d<=b.maxDrawbuffers;++d)for(var e=a[d]=Array(d),l=0;l<d;++l)e[l]=36064+l;return a}(),G=0,M={};return h(a,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof C)?a:null},create:function(a){function b(a){var l,h=a||{},m=a=0;if("shape"in h){var C=h.shape;a=C[0];m=C[1]}else"radius"in h&&(a=m=h.radius),"width"in h&&(a=h.width),"height"in h&&(m=h.height);var u=null,C=!1;if("colorBuffers"in h||"colorBuffer"in h){u=h.colorBuffers||h.colorBuffer;Array.isArray(u)||(u=[u]);e.width=a;e.height=m;u=u.map(z);for(l=0;l<u.length;++l)F(u[l],e);a=e.width;m=e.height}else{var q=!0,B="rgba",D="uint8",G=1,
C=!0;e.width=a=a||g.drawingBufferWidth;e.height=m=m||g.drawingBufferHeight;"format"in h&&(B=h.format,q=B in V);"type"in h&&(D=h.type);"colorCount"in h&&(G=h.colorCount|0);if(e.ownsColor)for(u=e.colorAttachments;u.length>G;)Q(u.pop());else u=[];for(l=0;l<u.length;++l){var K;a:{K=u[l];var U=q,P=B,M=a,T=m;if(K.texture){var N=K.texture;if(U){N({format:P,type:D,width:M,height:T});N._texture.refCount+=1;K=!0;break a}}else if(N=K.renderbuffer,!U){N({format:P,width:M,height:T});N._renderbuffer.refCount+=
1;K=!0;break a}Q(K);K=!1}K||(u[l--]=u[u.length-1],u.pop())}for(;u.length<G;)q?u.push(new A(3553,0,d.create2D({format:B,type:D,width:a,height:m},3553),null)):u.push(new A(36161,0,null,n.create({format:B,width:a,height:m})))}e.width=a;e.height=m;B=q=l=null;D=!1;"depthBuffer"in h&&(l=z(h.depthBuffer));"stencilBuffer"in h&&(q=z(h.stencilBuffer));"depthStencilBuffer"in h&&(B=z(h.depthStencilBuffer));if(l||q||B)F(l||q||B,e);else if(G=!0,U=K=!1,"depth"in h&&(G=!!h.depth),"stencil"in h&&(K=!!h.stencil),"depthTexture"in
h&&(U=!!h.depthTexture),h=e.depthAttachment||e.stencilAttachment||e.depthStencilAttachment,P=null,G||K)D=!0,U?(U=K?"depth stencil":"depth",e.ownsDepthStencil&&h.texture?(h.texture({format:U,width:a,height:m}),h.texture._texture.refCount+=1,P=h):P=new A(3553,0,d.create({format:U,width:a,height:m},3553),null)):(U=G?K?"depth stencil":"depth":"stencil",e.ownsDepthStencil&&h.renderbuffer?(h.renderbuffer({format:U,width:a,height:m}),h.renderbuffer._renderbuffer.refCount+=1,P=h):P=new A(36161,0,null,n.create({format:U,
width:a,height:m}))),G?K?B=P:l=P:q=P;a=e;a.colorAttachments.forEach(Q);Q(a.depthAttachment);Q(a.stencilAttachment);Q(a.depthStencilAttachment);e.colorAttachments=u;e.depthAttachment=l;e.stencilAttachment=q;e.depthStencilAttachment=B;e.ownsColor=C;e.ownsDepthStencil=D;b.color=u.map(L);b.depth=L(l);b.stencil=L(q);b.depthStencil=L(B);r(e);b.width=e.width;b.height=e.height;return b}var e=new C;b(a);b._reglType="framebuffer";b._framebuffer=e;b._destroy=function(){m(e)};return b},clear:function(){l(M).forEach(m)},
refresh:function(){l(M).forEach(r)}})}},{"./util/extend":21,"./util/values":28}],13:[function(g,n,q){n.exports=function(l,h){var g=1;h.ext_texture_filter_anisotropic&&(g=l.getParameter(34047));var e=1,b=1;h.webgl_draw_buffers&&(e=l.getParameter(34852),b=l.getParameter(36063));return{colorBits:[l.getParameter(3410),l.getParameter(3411),l.getParameter(3412),l.getParameter(3413)],depthBits:l.getParameter(3414),stencilBits:l.getParameter(3415),subpixelBits:l.getParameter(3408),extensions:Object.keys(h).filter(function(b){return!!h[b]}),
maxAnisotropic:g,maxDrawbuffers:e,maxColorAttachments:b,pointSizeDims:l.getParameter(33901),lineWidthDims:l.getParameter(33902),maxViewportDims:l.getParameter(3386),maxCombinedTextureUnits:l.getParameter(35661),maxCubeMapSize:l.getParameter(34076),maxRenderbufferSize:l.getParameter(34024),maxTextureUnits:l.getParameter(34930),maxTextureSize:l.getParameter(3379),maxAttributes:l.getParameter(34921),maxVertexUniforms:l.getParameter(36347),maxVertexTextureUnits:l.getParameter(35660),maxVaryingVectors:l.getParameter(36348),
maxFragmentUniforms:l.getParameter(36349),glsl:l.getParameter(35724),renderer:l.getParameter(7937),vendor:l.getParameter(7936),version:l.getParameter(7938)}}},{}],14:[function(g,n,q){var l=g("./util/is-typed-array");n.exports=function(h,g,e){return function(b){var d=b||{};l(b)?d={data:d}:2===arguments.length?d={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof b&&(d={});g();var n=d.x||0,A=d.y||0,q=d.width||e.viewportWidth,F=d.height||e.viewportHeight,d=d.data||new Uint8Array(q*F*4);h.pixelStorei(3333,
4);h.readPixels(n,A,q,F,6408,5121,d);return d}}},{"./util/is-typed-array":23}],15:[function(g,n,q){var l=g("./util/values");n.exports=function(h,g,e){function b(){this.id=q++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function d(b){h.isRenderbuffer(b.renderbuffer)||(b.renderbuffer=h.createRenderbuffer());h.bindRenderbuffer(36161,b.renderbuffer);h.renderbufferStorage(36161,b.format,b.width,b.height)}function n(b){var d=b.renderbuffer;h.bindRenderbuffer(36161,
null);h.isRenderbuffer(d)&&h.deleteRenderbuffer(d);b.renderbuffer=null;b.refCount=0;delete F[b.id]}var A={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};g.ext_srgb&&(A.srgba=35907);g.ext_color_buffer_half_float&&(A.rgba16f=34842,A.rgb16f=34843);g.webgl_color_buffer_float&&(A.rgba32f=34836);var q=0,F={};b.prototype.decRef=function(){0===--this.refCount&&n(this)};return{create:function(e){function h(b){b=b||{};var e=0,g=0;"shape"in b?(g=b.shape,e=g[0]|0,g=
g[1]|0):("radius"in b&&(e=g=b.radius|0),"width"in b&&(e=b.width|0),"height"in b&&(g=b.height|0));h.width=l.width=Math.max(e,1);h.height=l.height=Math.max(g,1);l.format=32854;"format"in b&&(l.format=A[b.format]);d(l);return h}var l=new b;F[l.id]=l;h(e);h._reglType="renderbuffer";h._renderbuffer=l;h.destroy=function(){l.decRef()};return h},refresh:function(){l(F).forEach(d)},clear:function(){l(F).forEach(n)}}}},{"./util/values":28}],16:[function(g,n,q){var l=g("./util/values");n.exports=function(h,
g){function e(b,d,e,a){this.name=b;this.id=d;this.location=e;this.info=a}function b(b,d){for(var e=0;e<b.length;++e)if(b[e].id===d.id){b[e].location=d.location;return}b.push(d)}function d(b,d,e){e=35632===b?q:F;var a=e[d];if(!a){var l=g.str(d),a=h.createShader(b);h.shaderSource(a,l);h.compileShader(a);e[d]=a}return a}function n(b,d){this.id=L++;this.fragId=b;this.vertId=d;this.program=null;this.uniforms=[];this.attributes=[]}function A(l,n){var m,a;m=d(35632,l.fragId);a=d(35633,l.vertId);var u=l.program=
h.createProgram();h.attachShader(u,m);h.attachShader(u,a);h.linkProgram(u);var z=h.getProgramParameter(u,35718),x=l.uniforms;for(m=0;m<z;++m)if(a=h.getActiveUniform(u,m))if(1<a.size)for(var A=0;A<a.size;++A){var q=a.name.replace("[0]","["+A+"]");b(x,new e(q,g.id(q),h.getUniformLocation(u,q),a))}else b(x,new e(a.name,g.id(a.name),h.getUniformLocation(u,a.name),a));z=h.getProgramParameter(u,35721);x=l.attributes;for(m=0;m<z;++m)(a=h.getActiveAttrib(u,m))&&b(x,new e(a.name,g.id(a.name),h.getAttribLocation(u,
a.name),a))}var q={},F={},u={},z=[],L=0;return{clear:function(){var b=h.deleteShader.bind(h);l(q).forEach(b);q={};l(F).forEach(b);F={};z.forEach(function(b){h.deleteProgram(b.program)});z.length=0;u={}},refresh:function(){q={};F={};z.forEach(A)},program:function(b,d,e){var a=u[d];a||(a=u[d]={});var h=a[b];h||(h=new n(d,b),A(h,e),a[b]=h,z.push(h));return h},shader:d,frag:null,vert:null}}},{"./util/values":28}],17:[function(g,n,q){n.exports=function(){var l={"":0},h=[""];return{id:function(g){var e=
l[g];if(e)return e;e=l[g]=h.length;h.push(g);return e},str:function(l){return h[l]}}}},{}],18:[function(g,n,q){function l(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function h(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var d=a[0].length,e=1;e<b;++e)if(!Array.isArray(a[e])||a[e].length!==d)return!1;return!0}function p(a){return Object.prototype.toString.call(a)}function e(a){if(!a)return!1;var b=p(a);return 0<=m.indexOf(b)?!0:
l(a)||h(a)||Q(a)}function b(a,b){36193===a.type?(a.data=u(b),F.freeType(b)):a.data=b}var d=g("./util/extend"),x=g("./util/values"),A=g("./util/is-typed-array"),Q=g("./util/is-ndarray"),F=g("./util/pool"),u=g("./util/to-half-float");q=g("./constants/arraytypes.json");var z=g("./constants/arraytypes.json"),L=[9984,9986,9985,9987],C=[0,6409,6410,6407,6408],r={};r[6409]=r[6406]=r[6402]=1;r[34041]=r[6410]=2;r[6407]=3;r[6408]=4;var m=Object.keys(q).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]",
"[object HTMLImageElement]","[object HTMLVideoElement]"]);n.exports=function(a,g,m,n,q){function ea(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function G(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;
a.width=b.width;a.height=b.height;a.channels=b.channels}function M(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=wa[b.colorSpace]);"type"in b&&(a.type=aa[b.type]);var d=a.width,e=a.height,h=a.channels,l=!1;"shape"in b?(d=b.shape[0],e=b.shape[1],3===b.shape.length&&(h=b.shape[2],l=!0)):("radius"in b&&(d=e=b.radius),"width"in b&&(d=b.width),
"height"in b&&(e=b.height),"channels"in b&&(h=b.channels,l=!0));a.width=d|0;a.height=e|0;a.channels=h|0;d=!1;"format"in b&&(d=b.format,e=a.internalformat=ca[d],a.format=Ea[e],d in aa&&!("type"in b)&&(a.type=aa[d]),d in da&&(a.compressed=!0),d=!0);!l&&d?a.channels=r[a.format]:l&&!d&&a.channels!==C[a.format]&&(a.format=a.internalformat=C[a.channels])}}function D(f){a.pixelStorei(37440,f.flipY);a.pixelStorei(37441,f.premultiplyAlpha);a.pixelStorei(37443,f.colorSpace);a.pixelStorei(3317,f.unpackAlignment)}
function ha(){ea.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function O(a,d){var g=null;e(d)?g=d:d&&(M(a,d),"x"in d&&(a.xOffset=d.x|0),"y"in d&&(a.yOffset=d.y|0),e(d.data)&&(g=d.data));if(d.copy){var m=q.viewportWidth,n=q.viewportHeight;a.width=a.width||m-a.xOffset;a.height=a.height||n-a.yOffset;a.needsCopy=!0}else if(!g)a.width=a.width||1,a.height=a.height||1;else if(A(g))a.data=g,"type"in d||5121!==a.type||(a.type=z[Object.prototype.toString.call(g)]|
0);else if(l(g)){m=g;n=a.width*a.height*a.channels;switch(a.type){case 5121:case 5123:case 5125:case 5126:n=F.allocType(a.type,n);n.set(m);a.data=n;break;case 36193:a.data=u(m)}a.alignment=1;a.needsFree=!0}else if(Q(g)){m=g.data;Array.isArray(m)||5121!==a.type||(a.type=z[Object.prototype.toString.call(m)]|0);var n=g.shape,x=g.stride,r,X,c,v;3===n.length?(c=n[2],v=x[2]):v=c=1;r=n[0];X=n[1];n=x[0];x=x[1];a.alignment=1;a.width=r;a.height=X;a.channels=c;a.format=a.internalformat=C[c];a.needsFree=!0;r=
v;g=g.offset;c=a.width;v=a.height;X=a.channels;for(var B=F.allocType(36193===a.type?5126:a.type,c*v*X),D=0,E=0;E<v;++E)for(var w=0;w<c;++w)for(var ba=0;ba<X;++ba)B[D++]=m[n*w+x*E+r*ba+g];b(a,B)}else if("[object HTMLCanvasElement]"===p(g)||"[object CanvasRenderingContext2D]"===p(g))"[object HTMLCanvasElement]"===p(g)?a.element=g:a.element=g.canvas,a.width=a.element.width,a.height=a.element.height;else if("[object HTMLImageElement]"===p(g))a.element=g,a.width=g.naturalWidth,a.height=g.naturalHeight;
else if("[object HTMLVideoElement]"===p(g))a.element=g,a.width=g.videoWidth,a.height=g.videoHeight,a.needsPoll=!0;else if(h(g)){m=g[0].length;n=g.length;x=1;if(Array.isArray(g[0][0])){r=x=g[0][0].length;c=F.allocType(36193===a.type?5126:a.type,m*n*r);for(X=v=0;X<n;++X)for(B=g[X],D=0;D<m;++D)for(E=B[D],w=0;w<r;++w)c[v++]=E[w];b(a,c)}else{r=F.allocType(36193===a.type?5126:a.type,m*n);for(v=c=0;v<n;++v)for(X=g[v],B=0;B<m;++B)r[c++]=X[B];b(a,r)}a.alignment=1;a.width=m;a.height=n;a.channels=x;a.format=
a.internalformat=C[x];a.needsFree=!0}}function R(b,d,e,h,l){var g=b.element,m=b.data,x=b.internalformat,c=b.format,u=b.type,p=b.width,z=b.height;D(b);g?a.texSubImage2D(d,l,e,h,c,u,g):b.compressed?a.compressedTexSubImage2D(d,l,e,h,x,p,z,m):b.needsCopy?(n(),a.copyTexSubImage2D(d,l,e,h,b.xOffset,b.yOffset,p,z)):a.texSubImage2D(d,l,e,h,p,z,c,u,m)}function Y(){return xa.pop()||new ha}function S(a){a.needsFree&&F.freeType(a.data);ha.call(a);xa.push(a)}function ia(){ea.call(this);this.genMipmaps=!1;this.mipmapHint=
4352;this.mipmask=0;this.images=Array(16)}function J(a,b,d){var e=a.images[0]=Y();a.mipmask=1;e.width=a.width=b;e.height=a.height=d}function H(a,b){var d=null;if(e(b))d=a.images[0]=Y(),O(d,b),a.mipmask=1;else if(M(a,b),Array.isArray(b.mipmap))for(var h=b.mipmap,l=0;l<h.length;++l)d=a.images[l]=Y(),G(d,a),d.width>>=l,d.height>>=l,O(d,h[l]),a.mipmask|=1<<l;else d=a.images[0]=Y(),G(d,a),O(d,b),a.mipmask=1;G(a,a.images[0])}function I(b,d){for(var e=b.images,l=0;l<e.length&&e[l];++l){var h=e[l],g=d,m=
l,x=h.element,c=h.data,u=h.internalformat,p=h.format,z=h.type,r=h.width,w=h.height;D(h);x?a.texImage2D(g,m,p,p,z,x):h.compressed?a.compressedTexImage2D(g,m,u,r,w,0,c):h.needsCopy?(n(),a.copyTexImage2D(g,m,p,h.xOffset,h.yOffset,r,w,0)):a.texImage2D(g,m,p,r,w,0,p,z,c)}}function ja(){var a=Da.pop()||new ia;ea.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function fa(a){for(var b=a.images,d=0;d<b.length;++d)b[d]&&S(b[d]),b[d]=null;Da.push(a)}function oa(){this.magFilter=this.minFilter=
9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function K(a,b){"min"in b&&(a.minFilter=ta[b.min],0<=L.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=va[b.mag]);var d=a.wrapS,e=a.wrapT;if("wrap"in b){var h=b.wrap;"string"===typeof h?d=e=qa[h]:Array.isArray(h)&&(d=qa[h[0]],e=qa[h[1]])}else"wrapS"in b&&(d=qa[b.wrapS]),"wrapT"in b&&(e=qa[b.wrapT]);a.wrapS=d;a.wrapT=e;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){d=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=
ba[b.mipmap];d=a.genMipmaps=!0;break;case "boolean":d=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,d=!0}!d||"min"in b||(a.minFilter=9984)}}function ua(b,d){a.texParameteri(d,10241,b.minFilter);a.texParameteri(d,10240,b.magFilter);a.texParameteri(d,10242,b.wrapS);a.texParameteri(d,10243,b.wrapT);g.ext_texture_filter_anisotropic&&a.texParameteri(d,34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(d))}function P(){var a=za.pop()||new oa;oa.call(a);return a}
function pa(b){ea.call(this);this.mipmask=0;this.id=sa++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0}function T(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function N(){var b=ga[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function W(b){var d=b.texture,e=b.unit,h=b.target;0<=e&&(a.activeTexture(33984+e),a.bindTexture(h,null),ga[e]=null);a.deleteTexture(d);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete Z[b.id]}
var ba={"don't care":4352,"dont care":4352,nice:4354,fast:4353},qa={repeat:10497,clamp:33071,mirror:33648},va={nearest:9728,linear:9729},ta=d({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},va),wa={none:0,browser:37444},aa={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},ca={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},da={};g.ext_srgb&&(ca.srgb=35904,
ca.srgba=35906);g.oes_texture_float&&(aa["float"]=5126);g.oes_texture_half_float&&(aa.float16=aa["half float"]=36193);g.webgl_depth_texture&&(d(ca,{depth:6402,"depth stencil":34041}),d(aa,{uint16:5123,uint32:5125,"depth stencil":34042}));g.webgl_compressed_texture_s3tc&&d(da,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});g.webgl_compressed_texture_atc&&d(da,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});g.webgl_compressed_texture_pvrtc&&
d(da,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});g.webgl_compressed_texture_etc1&&(da["rgb etc1"]=36196);var Ba=Array.prototype.slice.call(a.getParameter(34467));Object.keys(da).forEach(function(a){var b=da[a];0<=Ba.indexOf(b)&&(ca[a]=b)});var Ca=Object.keys(ca);m.textureFormats=Ca;var Ea=Ca.reduce(function(a,b){var d=ca[b];6409===d||6406===d||6409===d||6410===d||6402===d||34041===d?a[d]=d:32855===d||0<=b.indexOf("rgba")?a[d]=6408:a[d]=
6407;return a},{}),xa=[],Da=[],za=[],sa=0,Z={},ka=m.maxTextureUnits,ga=Array(ka).map(function(){return null});d(pa.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var d=0;d<ka;++d){var e=ga[d];if(e){if(0<e.bindCount)continue;e.unit=-1}ga[d]=this;b=d;break}this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&W(this)}});return{create2D:function(a,b){function d(a,b){var f=
P(),h=ja();"number"===typeof a?"number"===typeof b?J(h,a|0,b|0):J(h,a|0,a|0):a?(K(f,a),H(h,a)):J(h,1,1);f.genMipmaps&&(h.mipmask=(h.width<<1)-1);e.mipmask=h.mipmask;G(e,h);d.width=h.width;d.height=h.height;T(e);I(h,3553);ua(f,3553);N();za.push(f);fa(h);return d}var e=new pa(3553);Z[e.id]=e;d(a,b);d.subimage=function(a,b,f,h){b|=0;f|=0;h|=0;var c=Y();G(c,e);c.width>>=h;c.height>>=h;c.width-=b;c.height-=f;O(c,a);T(e);R(c,3553,b,f,h);N();S(c);return d};d._reglType="texture2d";d._texture=e;d.destroy=
function(){e.decRef()};return d},createCube:function(a,b,d,e,h,l){function g(a,b,d,e,f,h){var k,l=P();for(k=0;6>k;++k)c[k]=ja();if("number"===typeof a||!a)for(a=a|0||1,k=0;6>k;++k)J(c[k],a,a);else if("object"===typeof a)if(b)H(c[0],a),H(c[1],b),H(c[2],d),H(c[3],e),H(c[4],f),H(c[5],h);else if(K(l,a),M(m,a),"faces"in a)for(a=a.faces,k=0;6>k;++k)G(c[k],m),H(c[k],a[k]);else for(k=0;6>k;++k)H(c[k],a);G(m,c[0]);m.mipmask=l.genMipmaps?(c[0].width<<1)-1:c[0].mipmask;g.width=c[0].width;g.height=c[0].height;
T(m);for(k=0;6>k;++k)I(c[k],34069+k);ua(l,34067);N();za.push(l);for(k=0;6>k;++k)fa(c[k]);return g}var m=new pa(34067);Z[m.id]=m;var c=Array(6);g(a,b,d,e,h,l);g.subimage=function(a,b,c,d,e){c|=0;d|=0;e|=0;var f=Y();G(f,m);f.width>>=e;f.height>>=e;f.width-=c;f.height-=d;O(f,b);T(m);R(f,34069+a,c,d,e);N();S(f);return g};g._reglType="textureCube";g._texture=m;g.destroy=function(){m.decRef()};return g},clear:function(){for(var b=0;b<ka;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),ga[b]=null;x(Z).forEach(W)},
getTexture:function(a){return null}}}},{"./constants/arraytypes.json":4,"./util/extend":21,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/pool":25,"./util/to-half-float":27,"./util/values":28}],19:[function(g,n,q){n.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],20:[function(g,n,q){function l(e){return Array.prototype.slice.call(e)}function h(e){return l(e).join("")}var p=g("./extend");n.exports=function(){function e(){var b=
[],e=[];return p(function(){b.push.apply(b,l(arguments))},{def:function(){var h="v"+d++;e.push(h);0<arguments.length&&(b.push(h,"="),b.push.apply(b,l(arguments)),b.push(";"));return h},toString:function(){return h([0<e.length?"var "+e+";":"",h(b)])}})}function b(){function b(e,a){h(e,a,"=",d.def(e,a),";")}var d=e(),h=e(),l=d.toString,g=h.toString;return p(d,{entry:d,exit:h,save:b,set:function(e,a,h){b(e,a);d(e,a,"=",h,";")},toString:function(){return l()+g()}})}var d=0,g=[],n=[],q=e(),F={};return{global:q,
link:function(b){for(var e=0;e<n.length;++e)if(n[e]===b)return g[e];e="g"+d++;g.push(e);n.push(b);return e},block:e,proc:function(d,e){function l(){var a="a"+g.length;g.push(a);return a}var g=[];e=e||0;for(var n=0;n<e;++n)l();var n=b(),m=n.toString;return F[d]=p(n,{arg:l,toString:function(){return h(["function(",g.join(),"){",m(),"}"])}})},scope:b,cond:function(){var d=h(arguments),e=b(),g=b(),n=e.toString,x=g.toString;return p(e,{then:function(){e.apply(e,l(arguments));return this},"else":function(){g.apply(g,
l(arguments));return this},toString:function(){var b=x();b&&(b="else{"+b+"}");return h(["if(",d,"){",n(),"}",b])}})},compile:function(){var b=['"use strict";',q,"return {"];Object.keys(F).forEach(function(d){b.push('"',d,'":',F[d].toString(),",")});b.push("}");var d=h(b).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,g.concat(d)).apply(null,n)}}}},{"./extend":21}],21:[function(g,n,q){n.exports=function(g,h){for(var n=Object.keys(h),e=0;e<n.length;++e)g[n[e]]=
h[n[e]];return g}},{}],22:[function(g,n,q){var l=g("./is-typed-array");n.exports=function(h){return!!h&&"object"===typeof h&&Array.isArray(h.shape)&&Array.isArray(h.stride)&&"number"===typeof h.offset&&h.shape.length===h.stride.length&&(Array.isArray(h.data)||l(h.data))}},{"./is-typed-array":23}],23:[function(g,n,q){var l=g("../constants/arraytypes.json");n.exports=function(h){return Object.prototype.toString.call(h)in l}},{"../constants/arraytypes.json":4}],24:[function(g,n,q){n.exports=function(g,
h){for(var n=Array(g),e=0;e<g;++e)n[e]=h(e);return n}},{}],25:[function(g,n,q){function l(b){var d,e;d=(65535<b)<<4;b>>>=d;e=(255<b)<<3;b>>>=e;d|=e;e=(15<b)<<2;b>>>=e;d|=e;e=(3<b)<<1;return d|e|b>>>e>>1}function h(b){a:{for(var d=16;268435456>=d;d*=16)if(b<=d){b=d;break a}b=0}d=e[l(b)>>2];return 0<d.length?d.pop():new ArrayBuffer(b)}function p(b){e[l(b.byteLength)>>2].push(b)}var e=g("./loop")(8,function(){return[]});n.exports={alloc:h,free:p,allocType:function(b,d){var e=null;switch(b){case 5120:e=
new Int8Array(h(d),0,d);break;case 5121:e=new Uint8Array(h(d),0,d);break;case 5122:e=new Int16Array(h(2*d),0,d);break;case 5123:e=new Uint16Array(h(2*d),0,d);break;case 5124:e=new Int32Array(h(4*d),0,d);break;case 5125:e=new Uint32Array(h(4*d),0,d);break;case 5126:e=new Float32Array(h(4*d),0,d);break;default:return null}return e.length!==d?e.subarray(0,d):e},freeType:function(b){p(b.buffer)}}},{"./loop":24}],26:[function(g,n,q){n.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?
{next:function(g){return requestAnimationFrame(g)},cancel:function(g){return cancelAnimationFrame(g)}}:{next:function(g){setTimeout(g,30)},cancel:clearTimeout}},{}],27:[function(g,n,q){var l=g("./pool"),h=new Float32Array(1),p=new Uint32Array(h.buffer);n.exports=function(e){for(var b=l.allocType(5123,e.length),d=0;d<e.length;++d)if(isNaN(e[d]))b[d]=65535;else if(Infinity===e[d])b[d]=31744;else if(-Infinity===e[d])b[d]=64512;else{h[0]=e[d];var g=p[0],n=g>>>31<<15,q=(g<<1>>>24)-127,g=g>>13&1023;b[d]=
-24>q?n:-14>q?n+(g+1024>>-14-q):15<q?n+31744:n+(q+15<<10)+g}return b}},{"./pool":25}],28:[function(g,n,q){n.exports=function(g){return Object.keys(g).map(function(h){return g[h]})}},{}],29:[function(g,n,q){function l(e,b){function d(){var b=window.innerWidth,d=window.innerHeight;e!==document.body&&(d=e.getBoundingClientRect(),b=d.right-d.left,d=d.top-d.bottom);g.width=n*b;g.height=n*d;p(g.style,{width:b+"px",height:d+"px"})}var g=document.createElement("canvas"),l=h(g,b);p(g.style,{border:0,margin:0,
padding:0,top:0,left:0});e.appendChild(g);e===document.body&&(g.style.position="absolute",p(e.style,{margin:0,padding:0}));var n=+l.options.pixelRatio;window.addEventListener("resize",d,!1);var q=l.options.onDestroy;l.options=p(p({},l.options),{onDestroy:function(){window.removeEventListener("resize",d);e.removeChild(g);q&&q()}});d();return l}function h(e,b){function d(b){try{return e.getContext(b,h)}catch(d){return null}}var h=b.glOptions||{};return{gl:d("webgl")||d("experimental-webgl")||d("webgl-experimental"),
options:p({pixelRatio:window.devicePixelRatio},b)}}var p=g("./util/extend");n.exports=function(e){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:e[0],options:e[1]||{}};var b=document.body,d=e[1]||{};if("string"===typeof e[0])b=document.querySelector(e[0])||document.body;else if("object"===typeof e[0])if(e[0]instanceof HTMLElement)b=e[0];else{if(e[0]instanceof WebGLRenderingContext)return{gl:e[0],options:p({pixelRatio:1},d)};d=e[0]}return b.nodeName&&"CANVAS"===b.nodeName.toUpperCase()?
h(b,d):l(b,d)}},{"./util/extend":21}],30:[function(g,n,q){var l=g("./lib/util/extend"),h=g("./lib/dynamic"),p=g("./lib/util/raf"),e=g("./lib/util/clock"),b=g("./lib/strings"),d=g("./lib/webgl"),x=g("./lib/extension"),A=g("./lib/limits"),Q=g("./lib/buffer"),F=g("./lib/elements"),u=g("./lib/texture"),z=g("./lib/renderbuffer"),L=g("./lib/framebuffer"),C=g("./lib/attribute"),r=g("./lib/shader"),m=g("./lib/read"),a=g("./lib/core");n.exports=function(){function g(){W=p.next(g);J.count+=1;var a=e();J.deltaTime=
(a-Y)/1E3;J.time=(a-R)/1E3;Y=a;G();for(a=0;a<N.length;++a)(0,N[a])(J,null,0)}function n(a){}function q(a){}function la(a){function b(a){var d={},e={};Object.keys(a).forEach(function(b){var g=a[b];h.isDynamic(g)?e[b]=h.unbox(g,b):d[b]=g});return{dynamic:e,"static":d}}function d(a){for(;r.length<a;)r.push(null);return r}var e=b(a.context||{}),g=b(a.uniforms||{}),m=b(a.attributes||{});a=b(function(a){function b(a){if(a in d){var e=d[a];delete d[a];Object.keys(e).forEach(function(b){d[a+"."+b]=e[b]})}}
var d=l({},a);delete d.uniforms;delete d.attributes;delete d.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return d}(a));var e=P.compile(a,m,g,e),n=e.draw,p=e.batch,q=e.scope,r=[];return function(a,b){var e;if("function"===typeof a)return q.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(e=0;e<a;++e)q.call(this,null,b,e);else if(Array.isArray(a))for(e=0;e<a.length;++e)q.call(this,a[e],b,e);else return q.call(this,a,b,0);else if("number"===
typeof a){if(0<a)return p.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return n.call(this,a)}}function ea(){P.procs.poll()}function G(){var a=pa.viewport,b=pa.scissor_box;a[0]=a[1]=b[0]=b[1]=0;J.viewportWidth=J.frameBufferWidth=J.drawingBufferWidth=a[2]=b[2]=D.drawingBufferWidth;J.viewportHeight=J.frameBufferWidth=J.drawingBufferHeight=a[3]=b[3]=D.drawingBufferHeight;P.procs.refresh()}var M=d(Array.prototype.slice.call(arguments)),D=M.gl,ha=M.options,
M=b(),O=x(D).extensions,R=e(),Y=R,S=D.drawingBufferWidth,ia=D.drawingBufferHeight,J={count:0,deltaTime:0,time:0,viewportWidth:S,viewportHeight:ia,framebufferWidth:S,framebufferHeight:ia,drawingBufferWidth:S,drawingBufferHeight:ia,pixelRatio:ha.pixelRatio},H=A(D,O),I=Q(D),S=F(D,O,I),ia=C(D,O,H,I,M),ja=r(D,M),fa=u(D,O,H,ea,J),oa=z(D,O,H),K=L(D,O,H,fa,oa),ua=m(D,ea,J),P=a(D,M,O,H,I,S,fa,K,{},ia,ja,{elements:null,primitive:4,count:-1,offset:0,instances:-1},J),pa=P.next,T=D.canvas,N=[],W=0;T&&(T.addEventListener("webglcontextlost",
n,!1),T.addEventListener("webglcontextrestored",q,!1));G();return l(la,{clear:function(a){var b=0;ea();var d=a.color;d&&(D.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),b|=16384);"depth"in a&&(D.clearDepth(+a.depth),b|=256);"stencil"in a&&(D.clearStencil(a.stencil|0),b|=1024);D.clear(b)},prop:h.define.bind(null,1),context:h.define.bind(null,2),"this":h.define.bind(null,3),draw:la({}),buffer:function(a){return I.create(a,34962)},elements:S.create,texture:fa.create2D,cube:fa.createCube,renderbuffer:oa.create,
framebuffer:K.create,framebufferCube:function(a){},attributes:D.getContextAttributes(),frame:function(a){N.push(a);!W&&0<N.length&&g();return{cancel:function(){var b=N.find(function(b){return b===a});0>b||(N.splice(b,1),0>=N.length&&W&&(p.cancel(g),W=0))}}},limits:H,hasExtension:function(a){return 0<=H.extensions.indexOf(a.toLowerCase())},read:ua,destroy:function(){W&&(p.cancel(g),W=0);T&&(T.removeEventListener("webglcontextlost",n),T.removeEventListener("webglcontextrestored",q));ja.clear();K.clear();
oa.clear();fa.clear();I.clear();if(ha.onDestroy)ha.onDestroy()},_gl:D,_refresh:G})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/strings":17,"./lib/texture":18,"./lib/util/clock":19,"./lib/util/extend":21,"./lib/util/raf":26,"./lib/webgl":29}]},{},[1]);
