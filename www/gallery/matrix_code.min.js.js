(function(){function fa(t,K,h){function E(w,C){if(!K[w]){if(!t[w]){var z="function"==typeof require&&require;if(!C&&z)return z(w,!0);if(p)return p(w,!0);z=Error("Cannot find module '"+w+"'");throw z.code="MODULE_NOT_FOUND",z;}z=K[w]={exports:{}};t[w][0].call(z.exports,function(h){return E(t[w][1][h]||h)},z,z.exports,fa,t,K,h)}return K[w].exports}for(var p="function"==typeof require&&require,w=0;w<h.length;w++)E(h[w]);return E}return fa})()({1:[function(fa,t,K){document.body.style="background-color: black;";
document.addEventListener("touchmove",function(h){return h.preventDefault()},{passive:!1});t=document.body.appendChild(document.createElement("canvas"));K=fa("canvas-fit");window.addEventListener("resize",K(t),!1);var h=fa("regl")({canvas:t,extensions:["OES_texture_half_float","OES_texture_half_float_linear"],optionalExtensions:["EXT_color_buffer_half_float","WEBGL_color_buffer_float","OES_standard_derivatives"]}),E=Array(2).fill().map(function(){return h.framebuffer({color:h.texture({radius:60,type:"half float"}),
depthStencil:!1})});t=function(){return h.framebuffer({color:h.texture({type:"half float",min:"linear",mag:"linear"})})};var p=function(h,p,E,z){return h.forEach(function(h,H){return h.resize(Math.floor(p*z/Math.pow(2,H)),Math.floor(E*z/Math.pow(2,H)))})},w=t(),Y=Array(5).fill().map(t),C=Array(5).fill().map(t),z=Array(5).fill().map(t),ta=t(),Bb=h({frag:"\n    precision highp float;\n\n    #define PI 3.14159265359\n    #define SQRT_2 1.4142135623730951\n    #define SQRT_5 2.23606797749979\n\n    uniform float glyphSequenceLength;\n    uniform float numColumns;\n    uniform float glyphTextureColumns;\n    uniform float time;\n    uniform sampler2D lastState;\n\n    highp float rand( const in vec2 uv ) {\n      const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n      highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n      return fract(sin(sn) * c);\n    }\n\n    void main()  {\n\n      vec2 uv = gl_FragCoord.xy / numColumns;\n\n      float columnTimeOffset = rand(vec2(gl_FragCoord.x, 0.0));\n      float columnSpeedOffset = rand(vec2(gl_FragCoord.x + 0.1, 0.0));\n\n      vec4 data = texture2D( lastState, uv );\n\n      if (length(data) == 0.) {\n        data.rba = vec3(rand(uv), 0., 0.);\n        data.g = rand(uv);\n      }\n\n      float columnTime = (columnTimeOffset * 1000.0 + time * 0.5) * (0.5 + columnSpeedOffset * 0.5) + (sin(time * columnSpeedOffset) * 0.2);\n      float glyphTime = gl_FragCoord.y * 0.01 + columnTime;\n\n      float value = 1.0 - fract((glyphTime + 0.3 * sin(SQRT_2 * glyphTime) + 0.2 * sin(SQRT_5 * glyphTime)));\n\n      float brightness = 3.0 * log(value * 1.25);\n\n      float glyphCycleSpeed = 0.0;\n      if (brightness > 0.0) glyphCycleSpeed = pow(1.0 - brightness, 4.0);\n\n      float glyphCycle = data.g;\n      glyphCycle = fract(glyphCycle + 0.005 * glyphCycleSpeed);\n\n      float symbol = floor(glyphSequenceLength * glyphCycle);\n      float symbolX = mod(symbol, glyphTextureColumns);\n      float symbolY = ((glyphTextureColumns - 1.0) - (symbol - symbolX) / glyphTextureColumns);\n\n      gl_FragColor = vec4(\n        brightness,\n        glyphCycle,\n        symbolY * glyphTextureColumns + symbolX,\n        1.\n      );\n    }\n  ",
uniforms:{glyphSequenceLength:57,time:h.context("time")},framebuffer:function(h){return E[(h.tick+1)%2]}}),ab=h({vert:"\n  attribute vec2 aPosition;\n  uniform float width;\n  uniform float height;\n  varying vec2 vUV;\n  void main() {\n    vUV = aPosition / 2.0 + 0.5;\n    vec2 size = width > height ? vec2(width / height, 1.) : vec2(1., height / width);\n    gl_Position = vec4( size * aPosition, 0.0, 1.0 );\n  }\n  ",frag:"\n    #ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives: enable\n    #endif\n    precision lowp float;\n\n    uniform sampler2D glyphMSDF;\n    uniform sampler2D lastState;\n    uniform float numColumns;\n    uniform float glyphTextureColumns;\n\n    varying vec2 vUV;\n\n    float median3(vec3 i) {\n      return max(min(i.r, i.g), min(max(i.r, i.g), i.b));\n    }\n\n    void main() {\n      // Unpack the values from the font texture\n      vec4 glyph = texture2D(lastState, vUV);\n      float brightness = max(0., glyph.r);\n      float symbolIndex = glyph.b;\n\n      // resolve UV to MSDF texture coord\n      vec2 symbolUV = vec2(mod(symbolIndex, glyphTextureColumns), floor(symbolIndex / glyphTextureColumns));\n      vec2 glyphUV = fract(vUV * numColumns);\n      vec2 msdfUV = (glyphUV + symbolUV) / glyphTextureColumns;\n\n      // MSDF\n      vec3 dist = texture2D(glyphMSDF, msdfUV).rgb;\n      float sigDist = median3(dist) - 0.5;\n      float alpha = clamp(sigDist/fwidth(sigDist) + 0.5, 0.0, 1.0);\n\n      gl_FragColor = vec4(vec3(brightness * alpha), 1.0);\n    }\n  ",
uniforms:{glyphMSDF:h.prop("glyphMSDF"),width:h.context("viewportHeight"),height:h.context("viewportWidth")},framebuffer:w}),aa=h({frag:"\n  precision mediump float;\n  varying vec2 vUV;\n  uniform sampler2D tex;\n  uniform float threshold;\n  void main() {\n    float value = texture2D(tex, vUV).r;\n    if (value < threshold) {\n      value = 0.;\n    }\n    gl_FragColor = vec4(vec3(value), 1.0);\n  }\n  ",uniforms:{tex:h.prop("tex"),threshold:.3},framebuffer:h.prop("fbo")}),va=h({frag:"\n  precision mediump float;\n  varying vec2 vUV;\n  uniform sampler2D tex;\n  uniform vec2 direction;\n  uniform float width, height;\n  void main() {\n    vec2 size = width > height ? vec2(width / height, 1.) : vec2(1., height / width);\n    gl_FragColor =\n      texture2D(tex, vUV) * 0.442 +\n      (\n        texture2D(tex, vUV + direction / max(width, height) * size) +\n        texture2D(tex, vUV - direction / max(width, height) * size)\n      ) * 0.279;\n  }\n  ",
uniforms:{tex:h.prop("tex"),direction:h.prop("direction"),height:h.context("viewportWidth"),width:h.context("viewportHeight")},framebuffer:h.prop("fbo")}),wa=h({frag:"\n  precision mediump float;\n  varying vec2 vUV;\n  "+z.map(function(h,p){return"uniform sampler2D tex_"+p+";"}).join("\n")+"\n  uniform sampler2D tex;\n  void main() {\n    vec4 total = vec4(0.);\n    "+z.map(function(h,p){return"total += texture2D(tex_"+p+", vUV);"}).join("\n")+"\n    gl_FragColor = total + texture2D(tex, vUV);\n  }\n  ",
uniforms:Object.assign({tex:h.prop("tex")},function(h){for(var p={},z=0;z<h.length;z++)p["tex_"+z]=h[z];return p}(z)),framebuffer:h.prop("fbo")}),Qa=h({frag:"\n  precision mediump float;\n  #define PI 3.14159265359\n\n  uniform sampler2D tex;\n  uniform sampler2D palette;\n  uniform float ditherMagnitude;\n  uniform float time;\n  varying vec2 vUV;\n\n  highp float rand( const in vec2 uv, const in float t ) {\n    const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n    highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n    return fract(sin(sn) * c + t);\n  }\n\n  void main() {\n    float value = texture2D( tex, vUV ).r - rand( gl_FragCoord.xy, time ) * ditherMagnitude;\n    gl_FragColor = texture2D(palette, vec2(value, 0.));\n  }\n  ",
uniforms:{ditherMagnitude:.05,palette:h.prop("palette"),tex:ta,time:h.context("time")}}),La=h({vert:"\n  precision mediump float;\n  attribute vec2 aPosition;\n  varying vec2 vUV;\n  void main() {\n    vUV = 0.5 * (aPosition + 1.0);\n    gl_Position = vec4(aPosition, 0, 1);\n  }",attributes:{aPosition:[-4,-4,4,-4,0,4]},uniforms:{lastState:function(h){return E[h.tick%2]},numColumns:60,glyphTextureColumns:8},depth:{enable:!1},count:3});fa("resl")({manifest:{glyphMSDF:{type:"image",src:"assets/matrix_glyphs_msdf.png",
parser:function(p){return h.texture({data:p,mag:"linear",min:"linear",flipY:!0})}},palette:{type:"image",src:"assets/matrix_palette.png",parser:function(p){return h.texture({data:p,mag:"linear",min:"linear"})}}},onDone:function(E){La({},Bb);h.frame(function(h){var t=h.viewportWidth;h=h.viewportHeight;w.resize(t,h);ta.resize(t,h);p(Y,t,h,.5);p(C,t,h,.5);p(z,t,h,.5);La(function(){Bb();ab(E);Y.forEach(function(h){return aa({fbo:h,tex:w})});C.forEach(function(h,p){return va({fbo:h,tex:Y[p],direction:[1,
0]})});z.forEach(function(h,p){return va({fbo:h,tex:C[p],direction:[0,1]})});wa({tex:w,fbo:ta});Qa(E)})})}})},{"canvas-fit":2,regl:4,resl:5}],2:[function(fa,t,K){var h=fa("element-size");t.exports=function(p,w,t){function C(){var w=C.parent||p.parentNode;if("function"===typeof w)var t=w(E)||E,w=t[0],t=t[1];else w&&w!==document.body?(t=h(w),w=t[0]|0,t=t[1]|0):(w=window.innerWidth,t=window.innerHeight);z?(p.setAttribute("width",w*C.scale+"px"),p.setAttribute("height",t*C.scale+"px")):(p.width=w*C.scale,
p.height=t*C.scale);p.style.width=w+"px";p.style.height=t+"px";return C}var z="SVG"===p.nodeName.toUpperCase();p.style.position=p.style.position||"absolute";p.style.top=0;p.style.left=0;C.scale=parseFloat(t||1);C.parent=w;return C()};var E=new Float32Array(2)},{"element-size":3}],3:[function(fa,t,K){function h(h){return parseFloat(h)||0}t.exports=function(t){if(t===window||t===document.body)return[window.innerWidth,window.innerHeight];if(!t.parentNode){var p=!0;document.body.appendChild(t)}var w=
t.getBoundingClientRect(),Y=getComputedStyle(t),C=(w.height|0)+h(Y.getPropertyValue("margin-top"))+h(Y.getPropertyValue("margin-bottom")),w=(w.width|0)+h(Y.getPropertyValue("margin-left"))+h(Y.getPropertyValue("margin-right"));p&&document.body.removeChild(t);return[w,C]}},{}],4:[function(fa,t,K){(function(h,E){"object"===typeof K&&"undefined"!==typeof t?t.exports=E():"function"===typeof define&&define.amd?define(E):h.createREGL=E()})(this,function(){function h(a){return"undefined"!==typeof atob?atob(a):
"base64:"+a}function t(a){a=Error("(regl) "+a);console.error(a);throw a;}function p(a,b){a||t(b)}function w(a){return a?": "+a:""}function Y(a,b){switch(b){case "number":return"number"===typeof a;case "object":return"object"===typeof a;case "string":return"string"===typeof a;case "boolean":return"boolean"===typeof a;case "function":return"function"===typeof a;case "undefined":return"undefined"===typeof a;case "symbol":return"symbol"===typeof a}}function C(a,b,d){0>b.indexOf(a)&&t("invalid value"+
w(d)+". must be one of: "+b)}function z(a,b){for(a+="";a.length<b;)a=" "+a;return a}function ta(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function K(a,b){this.number=a;this.line=b;this.errors=[]}function fa(a,b,d){this.file=a;this.line=b;this.message=d}function aa(){var a=Error(),a=(a.stack||a).toString(),b=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);return b?b[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?a[1]:"unknown"}function va(){var a=Error(),a=(a.stack||
a).toString(),b=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);return b?b[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function wa(a,b){var d=a.split("\n"),c=1,e=0,k={unknown:new ta,0:new ta};k.unknown.name=k[0].name=b||aa();k.unknown.lines.push(new K(0,""));for(var ma=0;ma<d.length;++ma){var f=d[ma],m=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(f);if(m)switch(m[1]){case "line":if(m=/(\d+)(\s+\d+)?/.exec(m[2]))c=m[1]|0,m[2]&&(e=m[2]|0,e in k||(k[e]=new ta));break;case "define":if(m=/SHADER_NAME(_B64)?\s+(.*)$/.exec(m[2]))k[e].name=
m[1]?h(m[2]):m[2]}k[e].lines.push(new K(c++,f))}Object.keys(k).forEach(function(a){var b=k[a];b.lines.forEach(function(a){b.index[a.number]=a})});return k}function Qa(a){var b=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var d=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(a);d?b.push(new fa(d[1]|0,d[2]|0,d[3].trim())):0<a.length&&b.push(new fa("unknown",0,a))}});return b}function La(a,b){b.forEach(function(b){var d=a[b.file];if(d){var e=d.index[b.line];if(e){e.errors.push(b);d.hasErrors=!0;return}}a.unknown.hasErrors=
!0;a.unknown.lines[0].errors.push(b)})}function Pa(a){a._commandRef=aa()}function Aa(a,b){var d=va();t(a+" in command "+(b||aa())+("unknown"===d?"":" called from "+d))}function Ba(a,b,d,c){Y(a,b)||Aa("invalid parameter type"+w(d)+". expected "+b+", got "+typeof a,c||aa())}function $a(a,b){return 32820===a||32819===a||33635===a?2:34042===a?4:ha[a]*b}function ua(a,b){this.id=$b++;this.type=a;this.data=b}function H(a){if(0===a.length)return[];var b=a.charAt(0),d=a.charAt(a.length-1);if(1<a.length&&b===
d&&('"'===b||"'"===b))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return H(a.substr(0,b.index)).concat(H(b[1])).concat(H(a.substr(b.index+b[0].length)));b=a.split(".");if(1===b.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(d=0;d<b.length;++d)a=a.concat(H(b[d]));return a}function F(a){return"["+H(a).join("][")+"]"}function da(){var a={"":0},b=[""];return{id:function(d){var c=
a[d];if(c)return c;c=a[d]=b.length;b.push(d);return c},str:function(a){return b[a]}}}function pb(a,b,d){function c(){var b=window.innerWidth,c=window.innerHeight;a!==document.body&&(c=a.getBoundingClientRect(),b=c.right-c.left,c=c.bottom-c.top);e.width=d*b;e.height=d*c;P(e.style,{width:b+"px",height:c+"px"})}var e=document.createElement("canvas");P(e.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(e);a===document.body&&(e.style.position="absolute",P(a.style,{margin:0,padding:0}));
var k;a!==document.body&&"function"===typeof ResizeObserver?(k=new ResizeObserver(function(){setTimeout(c)}),k.observe(a)):window.addEventListener("resize",c,!1);c();return{canvas:e,onDestroy:function(){k?k.disconnect():window.removeEventListener("resize",c);a.removeChild(e)}}}function R(a,b){function d(g){try{return a.getContext(g,b)}catch(e){return null}}return d("webgl")||d("experimental-webgl")||d("webgl-experimental")}function ia(a){if("string"===typeof a)return a.split();d(Array.isArray(a),
"invalid extension array");return a}function B(a){return"string"===typeof a?(d("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(a)):a}function db(a){var b=a||{},g,c,e,k;a={};var ma=[],f=[],m="undefined"===typeof window?1:window.devicePixelRatio,q=!1,u=function(a){a&&d.raise(a)},r=function(){};"string"===typeof b?(d("undefined"!==typeof document,"selector queries only supported in DOM enviroments"),g=document.querySelector(b),d(g,"invalid query string for element")):
"object"===typeof b?"string"===typeof b.nodeName&&"function"===typeof b.appendChild&&"function"===typeof b.getBoundingClientRect?g=b:"function"===typeof b.drawArrays||"function"===typeof b.drawElements?(k=b,e=k.canvas):(d.constructor(b),"gl"in b?k=b.gl:"canvas"in b?e=B(b.canvas):"container"in b&&(c=B(b.container)),"attributes"in b&&(a=b.attributes,d.type(a,"object","invalid context attributes")),"extensions"in b&&(ma=ia(b.extensions)),"optionalExtensions"in b&&(f=ia(b.optionalExtensions)),"onDone"in
b&&(d.type(b.onDone,"function","invalid or missing onDone callback"),u=b.onDone),"profile"in b&&(q=!!b.profile),"pixelRatio"in b&&(m=+b.pixelRatio,d(0<m,"invalid pixel ratio"))):d.raise("invalid arguments to regl");g&&("canvas"===g.nodeName.toLowerCase()?e=g:c=g);if(!k){if(!e){d("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");g=pb(c||document.body,u,m);if(!g)return null;e=g.canvas;r=g.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0);
k=R(e,a)}return k?{gl:k,canvas:e,container:c,extensions:ma,optionalExtensions:f,pixelRatio:m,profile:q,onDone:u,onDestroy:r}:(r(),u("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Q(a,b){function g(b){d.type(b,"string","extension name must be string");b=b.toLowerCase();var g;try{g=c[b]=a.getExtension(b)}catch(e){}return!!g}for(var c={},e=0;e<b.extensions.length;++e){var k=b.extensions[e];if(!g(k))return b.onDestroy(),b.onDone('"'+k+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),
null}b.optionalExtensions.forEach(g);return{extensions:c,restore:function(){Object.keys(c).forEach(function(a){if(c[a]&&!g(a))throw Error("(regl): error restoring extension "+a);})}}}function D(a,b){for(var d=Array(a),c=0;c<a;++c)d[c]=b(c);return d}function eb(a){var b,d;b=(65535<a)<<4;a>>>=b;d=(255<a)<<3;a>>>=d;b|=d;d=(15<a)<<2;a>>>=d;b|=d;d=(3<a)<<1;return b|d|a>>>d>>1}function Cb(){function a(a){a:{for(var d=16;268435456>=d;d*=16)if(a<=d){a=d;break a}a=0}d=g[eb(a)>>2];return 0<d.length?d.pop():
new ArrayBuffer(a)}function d(a){g[eb(a.byteLength)>>2].push(a)}var g=D(8,function(){return[]});return{alloc:a,free:d,allocType:function(d,b){var g=null;switch(d){case 5120:g=new Int8Array(a(b),0,b);break;case 5121:g=new Uint8Array(a(b),0,b);break;case 5122:g=new Int16Array(a(2*b),0,b);break;case 5123:g=new Uint16Array(a(2*b),0,b);break;case 5124:g=new Int32Array(a(4*b),0,b);break;case 5125:g=new Uint32Array(a(4*b),0,b);break;case 5126:g=new Float32Array(a(4*b),0,b);break;default:return null}return g.length!==
b?g.subarray(0,b):g},freeType:function(a){d(a.buffer)}}}function ba(a){return!!a&&"object"===typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"===typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||X(a.data))}function Db(a,d,g,c,e,k){for(var h=0;h<d;++h)for(var f=a[h],m=0;m<g;++m)for(var q=f[m],u=0;u<c;++u)e[k++]=q[u]}function Eb(a,d,g,c,e){for(var k=1,h=g+1;h<d.length;++h)k*=d[h];var f=d[g];if(4===d.length-g){var m=d[g+1],q=d[g+2];d=d[g+3];for(h=0;h<f;++h)Db(a[h],
m,q,d,c,e),e+=k}else for(h=0;h<f;++h)Eb(a[h],d,g+1,c,e),e+=k}function fb(a){return gb[Object.prototype.toString.call(a)]|0}function Fb(a,d){for(var g=0;g<d.length;++g)a[g]=d[g]}function Gb(a,d,g,c,e,k,h){for(var f=0,m=0;m<g;++m)for(var q=0;q<c;++q)a[f++]=d[e*m+k*q+h]}function ac(a,b,g,c){function e(d){this.id=m++;this.buffer=a.createBuffer();this.type=d;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;g.profile&&(this.stats={size:0})}function k(d,b,g){d.byteLength=
b.byteLength;a.bufferData(d.type,b,g)}function h(a,b,g,c,l,e){a.usage=g;if(Array.isArray(b)){if(a.dtype=c||5126,0<b.length)if(Array.isArray(b[0])){l=Hb(b);for(var x=c=1;x<l.length;++x)c*=l[x];a.dimension=c;b=qb(b,l,a.dtype);k(a,b,g);e?a.persistentData=b:J.freeType(b)}else"number"===typeof b[0]?(a.dimension=l,l=J.allocType(a.dtype,b.length),Fb(l,b),k(a,l,g),e?a.persistentData=l:J.freeType(l)):X(b[0])?(a.dimension=b[0].length,a.dtype=c||fb(b[0])||5126,b=qb(b,[b.length,b[0].length],a.dtype),k(a,b,g),
e?a.persistentData=b:J.freeType(b)):d.raise("invalid buffer data")}else if(X(b))a.dtype=c||fb(b),a.dimension=l,k(a,b,g),e&&(a.persistentData=new Uint8Array(new Uint8Array(b.buffer)));else if(ba(b)){l=b.shape;var M=b.stride,x=b.offset,q=0,f=0,m=0,u=0;1===l.length?(q=l[0],f=1,m=M[0],u=0):2===l.length?(q=l[0],f=l[1],m=M[0],u=M[1]):d.raise("invalid shape");a.dtype=c||fb(b.data)||5126;a.dimension=f;l=J.allocType(a.dtype,q*f);Gb(l,b.data,q,f,m,u,x);k(a,l,g);e?a.persistentData=l:J.freeType(l)}else b instanceof
ArrayBuffer?(a.dtype=5121,a.dimension=l,k(a,b,g),e&&(a.persistentData=new Uint8Array(new Uint8Array(b)))):d.raise("invalid buffer data")}function f(g){b.bufferCount--;c(g);var e=g.buffer;d(e,"buffer must not be deleted already");a.deleteBuffer(e);g.buffer=null;delete q[g.id]}var m=0,q={};e.prototype.bind=function(){a.bindBuffer(this.type,this.buffer)};e.prototype.destroy=function(){f(this)};var u=[];g.profile&&(b.getTotalBufferSize=function(){var a=0;Object.keys(q).forEach(function(d){a+=q[d].stats.size});
return a});return{create:function(c,k,v,n){function l(b){var c=35044,e=null,r=0,k=0,f=1;Array.isArray(b)||X(b)||ba(b)||b instanceof ArrayBuffer?e=b:"number"===typeof b?r=b|0:b&&(d.type(b,"object","buffer arguments must be an object, a number or an array"),"data"in b&&(d(null===e||Array.isArray(e)||X(e)||ba(e),"invalid data for buffer"),e=b.data),"usage"in b&&(d.parameter(b.usage,hb,"invalid buffer usage"),c=hb[b.usage]),"type"in b&&(d.parameter(b.type,Ma,"invalid buffer type"),k=Ma[b.type]),"dimension"in
b&&(d.type(b.dimension,"number","invalid dimension"),f=b.dimension|0),"length"in b&&(d.nni(r,"buffer length must be a nonnegative integer"),r=b.length|0));x.bind();e?h(x,e,c,k,f,n):(r&&a.bufferData(x.type,r,c),x.dtype=k||5121,x.usage=c,x.dimension=f,x.byteLength=r);g.profile&&(x.stats.size=x.byteLength*Ga[x.dtype]);return l}function m(b,g){d(g+b.byteLength<=x.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+b.byteLength+" starting from offset "+g+" to a buffer of size "+
x.byteLength);a.bufferSubData(x.type,g,b)}b.bufferCount++;var x=new e(k);q[x.id]=x;v||l(c);l._reglType="buffer";l._buffer=x;l.subdata=function(a,b){var g=(b||0)|0,c;x.bind();if(X(a)||a instanceof ArrayBuffer)m(a,g);else if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var e=J.allocType(x.dtype,a.length);Fb(e,a);m(e,g);J.freeType(e)}else Array.isArray(a[0])||X(a[0])?(c=Hb(a),e=qb(a,c,x.dtype),m(e,g),J.freeType(e)):d.raise("invalid buffer data")}else if(ba(a)){c=a.shape;var r=a.stride,
k=e=0,f=0,n=0;1===c.length?(e=c[0],k=1,f=r[0],n=0):2===c.length?(e=c[0],k=c[1],f=r[0],n=r[1]):d.raise("invalid shape");c=Array.isArray(a.data)?x.dtype:fb(a.data);c=J.allocType(c,e*k);Gb(c,a.data,e,k,f,n,a.offset);m(c,g);J.freeType(c)}else d.raise("invalid data for buffer subdata");return l};g.profile&&(l.stats=x.stats);l.destroy=function(){f(x)};return l},createStream:function(a,b){var d=u.pop();d||(d=new e(a));d.bind();h(d,b,35040,0,1,!1);return d},destroyStream:function(a){u.push(a)},clear:function(){W(q).forEach(f);
u.forEach(f)},getBuffer:function(a){return a&&a._buffer instanceof e?a._buffer:null},restore:function(){W(q).forEach(function(b){b.buffer=a.createBuffer();a.bindBuffer(b.type,b.buffer);a.bufferData(b.type,b.persistentData||b.byteLength,b.usage)})},_initBuffer:h}}function bc(a,b,g,c){function e(a){this.id=m++;f[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function k(c,e,k,f,l,q,x){c.buffer.bind();var m;e?((m=x)||X(e)&&(!ba(e)||X(e.data))||(m=b.oes_element_index_uint?5125:
5123),g._initBuffer(c.buffer,e,k,m,3)):(a.bufferData(34963,q,k),c.buffer.dtype=m||5121,c.buffer.usage=k,c.buffer.dimension=3,c.buffer.byteLength=q);m=x;if(!x){switch(c.buffer.dtype){case 5121:case 5120:m=5121;break;case 5123:case 5122:m=5123;break;case 5125:case 5124:m=5125;break;default:d.raise("unsupported type for element array")}c.buffer.dtype=m}c.type=m;d(5125!==m||!!b.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");e=l;0>e&&(e=c.buffer.byteLength,
5123===m?e>>=1:5125===m&&(e>>=2));c.vertCount=e;e=f;0>f&&(e=4,f=c.buffer.dimension,1===f&&(e=0),2===f&&(e=1),3===f&&(e=4));c.primType=e}function h(a){c.elementsCount--;d(null!==a.buffer,"must not double destroy elements");delete f[a.id];a.buffer.destroy();a.buffer=null}var f={},m=0,q={uint8:5121,uint16:5123};b.oes_element_index_uint&&(q.uint32=5125);e.prototype.bind=function(){this.buffer.bind()};var u=[];return{create:function(a,b){function f(a){if(a)if("number"===typeof a)m(a),l.primType=4,l.vertCount=
a|0,l.type=5121;else{var b=null,g=35044,c=-1,e=-1,h=0,r=0;if(Array.isArray(a)||X(a)||ba(a))b=a;else if(d.type(a,"object","invalid arguments for elements"),"data"in a&&(b=a.data,d(Array.isArray(b)||X(b)||ba(b),"invalid data for element buffer")),"usage"in a&&(d.parameter(a.usage,hb,"invalid element buffer usage"),g=hb[a.usage]),"primitive"in a&&(d.parameter(a.primitive,Sa,"invalid element buffer primitive"),c=Sa[a.primitive]),"count"in a&&(d("number"===typeof a.count&&0<=a.count,"invalid vertex count for elements"),
e=a.count|0),"type"in a&&(d.parameter(a.type,q,"invalid buffer type"),r=q[a.type]),"length"in a)h=a.length|0;else if(h=e,5123===r||5122===r)h*=2;else if(5125===r||5124===r)h*=4;k(l,b,g,c,e,h,r)}else m(),l.primType=4,l.vertCount=0,l.type=5121;return f}var m=g.create(null,34963,!0),l=new e(m._buffer);c.elementsCount++;f(a);f._reglType="elements";f._elements=l;f.subdata=function(a,b){m.subdata(a,b);return f};f.destroy=function(){h(l)};return f},createStream:function(a){var b=u.pop();b||(b=new e(g.create(null,
34963,!0,!1)._buffer));k(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){u.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof e?a._elements:null},clear:function(){W(f).forEach(h)}}}function Ib(a){for(var b=J.allocType(5123,a.length),d=0;d<a.length;++d)if(isNaN(a[d]))b[d]=65535;else if(Infinity===a[d])b[d]=31744;else if(-Infinity===a[d])b[d]=64512;else{Jb[0]=a[d];var c=cc[0],e=c>>>31<<15,k=(c<<1>>>24)-127,c=c>>13&1023;b[d]=-24>k?e:-14>k?e+(c+1024>>-14-k):
15<k?e+31744:e+(k+15<<10)+c}return b}function N(a){return Array.isArray(a)||X(a)}function Ta(a){return"[object "+a+"]"}function Kb(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function Lb(a){return Array.isArray(a)&&0!==a.length&&N(a[0])?!0:!1}function Ca(a){return Object.prototype.toString.call(a)}function sb(a){if(!a)return!1;var b=Ca(a);return 0<=dc.indexOf(b)?!0:Kb(a)||Lb(a)||ba(a)}function Mb(a,b){36193===a.type?(a.data=Ib(b),J.freeType(b)):a.data=b}function ib(a,b,d,c,
e,k){a="undefined"!==typeof L[a]?L[a]:na[a]*Ua[b];k&&(a*=6);if(e){for(c=0;1<=d;)c+=a*d*d,d/=2;return c}return a*d*c}function ec(a,b,g,c,e,k,h){function f(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.colorSpace=37444;this.channels=this.height=this.width=0}function m(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;
a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function q(a,c){if("object"===typeof c&&c){"premultiplyAlpha"in c&&(d.type(c.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),a.premultiplyAlpha=c.premultiplyAlpha);"flipY"in c&&(d.type(c.flipY,"boolean","invalid texture flip"),a.flipY=c.flipY);"alignment"in c&&(d.oneOf(c.alignment,[1,2,4,8],"invalid texture unpack alignment"),a.unpackAlignment=c.alignment);"colorSpace"in c&&
(d.parameter(c.colorSpace,Nb,"invalid colorSpace"),a.colorSpace=Nb[c.colorSpace]);if("type"in c){var Z=c.type;d(b.oes_texture_float||!("float"===Z||"float32"===Z),"you must enable the OES_texture_float extension in order to use floating point textures.");d(b.oes_texture_half_float||!("half float"===Z||"float16"===Z),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");d(b.webgl_depth_texture||!("uint16"===Z||"uint32"===Z||"depth stencil"===Z),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");
d.parameter(Z,ja,"invalid texture type");a.type=ja[Z]}var e=a.width,l=a.height,f=a.channels,Z=!1;"shape"in c?(d(Array.isArray(c.shape)&&2<=c.shape.length,"shape must be an array"),e=c.shape[0],l=c.shape[1],3===c.shape.length&&(f=c.shape[2],d(0<f&&4>=f,"invalid number of channels"),Z=!0),d(0<=e&&e<=g.maxTextureSize,"invalid width"),d(0<=l&&l<=g.maxTextureSize,"invalid height")):("radius"in c&&(e=l=c.radius,d(0<=e&&e<=g.maxTextureSize,"invalid radius")),"width"in c&&(e=c.width,d(0<=e&&e<=g.maxTextureSize,
"invalid width")),"height"in c&&(l=c.height,d(0<=l&&l<=g.maxTextureSize,"invalid height")),"channels"in c&&(f=c.channels,d(0<f&&4>=f,"invalid number of channels"),Z=!0));a.width=e|0;a.height=l|0;a.channels=f|0;e=!1;"format"in c&&(e=c.format,d(b.webgl_depth_texture||!("depth"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),d.parameter(e,ca,"invalid texture format"),l=a.internalformat=ca[e],a.format=T[l],e in ja&&!("type"in c)&&
(a.type=ja[e]),e in U&&(a.compressed=!0),e=!0);!Z&&e?a.channels=na[a.format]:Z&&!e?a.channels!==jb[a.format]&&(a.format=a.internalformat=jb[a.channels]):e&&Z&&d(a.channels===na[a.format],"number of channels inconsistent with specified format")}}function u(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function r(){f.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;
this.needsCopy=!1}function xa(a,b){var c=null;sb(b)?c=b:b&&(d.type(b,"object","invalid pixel data type"),q(a,b),"x"in b&&(a.xOffset=b.x|0),"y"in b&&(a.yOffset=b.y|0),sb(b.data)&&(c=b.data));d(!a.compressed||c instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(b.copy){d(!c,"can not specify copy and data field for the same texture");var l=e.viewportWidth,f=e.viewportHeight;a.width=a.width||l-a.xOffset;a.height=a.height||f-a.yOffset;a.needsCopy=!0;d(0<=a.xOffset&&a.xOffset<
l&&0<=a.yOffset&&a.yOffset<f&&0<a.width&&a.width<=l&&0<a.height&&a.height<=f,"copy texture read out of bounds")}else if(!c)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(X(c))a.channels=a.channels||4,a.data=c,"type"in b||5121!==a.type||(a.type=gb[Object.prototype.toString.call(c)]|0);else if(Kb(c)){a.channels=a.channels||4;l=c;f=l.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:f=J.allocType(a.type,f);f.set(l);a.data=f;break;case 36193:a.data=Ib(l);break;default:d.raise("unsupported texture type, must specify a typed array")}a.alignment=
1;a.needsFree=!0}else if(ba(c)){l=c.data;Array.isArray(l)||5121!==a.type||(a.type=gb[Object.prototype.toString.call(l)]|0);var f=c.shape,k=c.stride,m,x,h,n;3===f.length?(h=f[2],n=k[2]):(d(2===f.length,"invalid ndarray pixel data, must be 2 or 3D"),n=h=1);m=f[0];x=f[1];f=k[0];k=k[1];a.alignment=1;a.width=m;a.height=x;a.channels=h;a.format=a.internalformat=jb[h];a.needsFree=!0;m=n;c=c.offset;h=a.width;n=a.height;x=a.channels;for(var y=J.allocType(36193===a.type?5126:a.type,h*n*x),V=0,ea=0;ea<n;++ea)for(var Ea=
0;Ea<h;++Ea)for(var tb=0;tb<x;++tb)y[V++]=l[f*Ea+k*ea+m*tb+c];Mb(a,y)}else if(Ca(c)===ub||Ca(c)===vb||Ca(c)===Ob)Ca(c)===ub||Ca(c)===vb?a.element=c:a.element=c.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if(Ca(c)===Pb)a.element=c,a.width=c.width,a.height=c.height,a.channels=4;else if(Ca(c)===Qb)a.element=c,a.width=c.naturalWidth,a.height=c.naturalHeight,a.channels=4;else if(Ca(c)===Rb)a.element=c,a.width=c.videoWidth,a.height=c.videoHeight,a.channels=4;else if(Lb(c)){l=
a.width||c[0].length;f=a.height||c.length;k=a.channels;k=N(c[0][0])?k||c[0][0].length:k||1;m=kb.shape(c);h=1;for(n=0;n<m.length;++n)h*=m[n];h=J.allocType(36193===a.type?5126:a.type,h);kb.flatten(c,m,"",h);Mb(a,h);a.alignment=1;a.width=l;a.height=f;a.channels=k;a.format=a.internalformat=jb[k];a.needsFree=!0}5126===a.type?d(0<=g.extensions.indexOf("oes_texture_float"),"oes_texture_float extension not enabled"):36193===a.type&&d(0<=g.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}
function v(b,d,e,g,l){var f=b.element,k=b.data,m=b.internalformat,h=b.format,x=b.type,y=b.width,V=b.height;u(b);f?a.texSubImage2D(d,l,e,g,h,x,f):b.compressed?a.compressedTexSubImage2D(d,l,e,g,m,y,V,k):b.needsCopy?(c(),a.copyTexSubImage2D(d,l,e,g,b.xOffset,b.yOffset,y,V)):a.texSubImage2D(d,l,e,g,y,V,h,x,k)}function n(){return lb.pop()||new r}function l(a){a.needsFree&&J.freeType(a.data);r.call(a);lb.push(a)}function p(){f.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=
Array(16)}function x(a,b,d){var c=a.images[0]=n();a.mipmask=1;c.width=a.width=b;c.height=a.height=d;c.channels=a.channels=4}function M(a,b){var c=null;if(sb(b))c=a.images[0]=n(),m(c,a),xa(c,b),a.mipmask=1;else if(q(a,b),Array.isArray(b.mipmap))for(var e=b.mipmap,g=0;g<e.length;++g)c=a.images[g]=n(),m(c,a),c.width>>=g,c.height>>=g,xa(c,e[g]),a.mipmask|=1<<g;else c=a.images[0]=n(),m(c,a),xa(c,b),a.mipmask=1;m(a,a.images[0]);!a.compressed||33776!==a.internalformat&&33777!==a.internalformat&&33778!==
a.internalformat&&33779!==a.internalformat||d(0===a.width%4&&0===a.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function t(b,d){for(var e=b.images,g=0;g<e.length&&e[g];++g){var l=e[g],f=d,k=g,m=l.element,h=l.data,x=l.internalformat,y=l.format,V=l.type,ea=l.width,Ea=l.height;u(l);m?a.texImage2D(f,k,y,y,V,m):l.compressed?a.compressedTexImage2D(f,k,x,ea,Ea,0,h):l.needsCopy?(c(),a.copyTexImage2D(f,k,y,l.xOffset,l.yOffset,ea,Ea,0)):a.texImage2D(f,
k,y,ea,Ea,0,y,V,h||null)}}function H(){var a=E.pop()||new p;f.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function w(a){for(var b=a.images,d=0;d<b.length;++d)b[d]&&l(b[d]),b[d]=null;E.push(a)}function Fa(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function z(a,b){if("min"in b){var c=b.min;d.parameter(c,mb);a.minFilter=mb[c];0<=fc.indexOf(a.minFilter)&&!("faces"in b)&&(a.genMipmaps=!0)}"mag"in b&&(c=
b.mag,d.parameter(c,G),a.magFilter=G[c]);var c=a.wrapS,e=a.wrapT;if("wrap"in b){var l=b.wrap;"string"===typeof l?(d.parameter(l,oa),c=e=oa[l]):Array.isArray(l)&&(d.parameter(l[0],oa),d.parameter(l[1],oa),c=oa[l[0]],e=oa[l[1]])}else"wrapS"in b&&(c=b.wrapS,d.parameter(c,oa),c=oa[c]),"wrapT"in b&&(e=b.wrapT,d.parameter(e,oa),e=oa[e]);a.wrapS=c;a.wrapT=e;"anisotropic"in b&&(c=b.anisotropic,d("number"===typeof c&&1<=c&&c<=g.maxAnisotropic,"aniso samples must be between 1 and "),a.anisotropic=b.anisotropic);
if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":d.parameter(b.mipmap,A,"invalid mipmap hint");a.mipmapHint=A[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":d(Array.isArray(b.mipmap),"invalid mipmap type");a.genMipmaps=!1;c=!0;break;default:d.raise("invalid mipmap type")}!c||"min"in b||(a.minFilter=9984)}}function da(d,c){a.texParameteri(c,10241,d.minFilter);a.texParameteri(c,10240,d.magFilter);a.texParameteri(c,10242,d.wrapS);a.texParameteri(c,
10243,d.wrapT);b.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,d.anisotropic);d.genMipmaps&&(a.hint(33170,d.mipmapHint),a.generateMipmap(c))}function rb(b){f.call(this);this.mipmask=0;this.internalformat=6408;this.id=O++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new Fa;h.profile&&(this.stats={size:0})}function Ra(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function Va(){var b=ga[0];b?a.bindTexture(b.target,b.texture):
a.bindTexture(3553,null)}function I(b){var c=b.texture;d(c,"must not double destroy texture");var e=b.unit,l=b.target;0<=e&&(a.activeTexture(33984+e),a.bindTexture(l,null),ga[e]=null);a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete Q[b.id];k.textureCount--}var A={"don't care":4352,"dont care":4352,nice:4354,fast:4353},oa={repeat:10497,clamp:33071,mirror:33648},G={nearest:9728,linear:9729},mb=P({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,
"nearest mipmap linear":9986,"linear mipmap linear":9987},G),Nb={none:0,browser:37444},ja={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},ca={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},U={};b.ext_srgb&&(ca.srgb=35904,ca.srgba=35906);b.oes_texture_float&&(ja.float32=ja["float"]=5126);b.oes_texture_half_float&&(ja.float16=ja["half float"]=36193);b.webgl_depth_texture&&(P(ca,{depth:6402,"depth stencil":34041}),P(ja,{uint16:5123,
uint32:5125,"depth stencil":34042}));b.webgl_compressed_texture_s3tc&&P(U,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});b.webgl_compressed_texture_atc&&P(U,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});b.webgl_compressed_texture_pvrtc&&P(U,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});b.webgl_compressed_texture_etc1&&(U["rgb etc1"]=36196);var B=Array.prototype.slice.call(a.getParameter(34467));
Object.keys(U).forEach(function(a){var b=U[a];0<=B.indexOf(b)&&(ca[a]=b)});var F=Object.keys(ca);g.textureFormats=F;var D=[];Object.keys(ca).forEach(function(a){D[ca[a]]=a});var C=[];Object.keys(ja).forEach(function(a){C[ja[a]]=a});var R=[];Object.keys(G).forEach(function(a){R[G[a]]=a});var ya=[];Object.keys(mb).forEach(function(a){ya[mb[a]]=a});var pa=[];Object.keys(oa).forEach(function(a){pa[oa[a]]=a});var T=F.reduce(function(a,d){var c=ca[d];6409===c||6406===c||6409===c||6410===c||6402===c||34041===
c||b.ext_srgb&&(35904===c||35906===c)?a[c]=c:32855===c||0<=d.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),lb=[],E=[],O=0,Q={},L=g.maxTextureUnits,ga=Array(L).map(function(){return null});P(rb.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<L;++c){var e=ga[c];if(e){if(0<e.bindCount)continue;e.unit=-1}ga[c]=this;b=c;break}b>=L&&d.raise("insufficient number of texture units");h.profile&&k.maxTextureUnits<b+1&&(k.maxTextureUnits=b+1);this.unit=b;a.activeTexture(33984+
b);a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&I(this)}});h.profile&&(k.getTotalTextureSize=function(){var a=0;Object.keys(Q).forEach(function(b){a+=Q[b].stats.size});return a});return{create2D:function(b,c){function e(a,b){var c=f.texInfo;Fa.call(c);var l=H();"number"===typeof a?"number"===typeof b?x(l,a|0,b|0):x(l,a|0,a|0):a?(d.type(a,"object","invalid arguments to regl.texture"),z(c,a),M(l,a)):x(l,1,1);c.genMipmaps&&
(l.mipmask=(l.width<<1)-1);f.mipmask=l.mipmask;m(f,l);d.texture2D(c,l,g);f.internalformat=l.internalformat;e.width=l.width;e.height=l.height;Ra(f);t(l,3553);da(c,3553);Va();w(l);h.profile&&(f.stats.size=ib(f.internalformat,f.type,l.width,l.height,c.genMipmaps,!1));e.format=D[f.internalformat];e.type=C[f.type];e.mag=R[c.magFilter];e.min=ya[c.minFilter];e.wrapS=pa[c.wrapS];e.wrapT=pa[c.wrapT];return e}var f=new rb(3553);Q[f.id]=f;k.textureCount++;e(b,c);e.subimage=function(a,b,c,g){d(!!a,"must specify image data");
b|=0;c|=0;g|=0;var k=n();m(k,f);k.width=0;k.height=0;xa(k,a);k.width=k.width||(f.width>>g)-b;k.height=k.height||(f.height>>g)-c;d(f.type===k.type&&f.format===k.format&&f.internalformat===k.internalformat,"incompatible format for texture.subimage");d(0<=b&&0<=c&&b+k.width<=f.width&&c+k.height<=f.height,"texture.subimage write out of bounds");d(f.mipmask&1<<g,"missing mipmap data");d(k.data||k.element||k.needsCopy,"missing image data");Ra(f);v(k,3553,b,c,g);Va();l(k);return e};e.resize=function(b,d){var c=
b|0,l=d|0||c;if(c===f.width&&l===f.height)return e;e.width=f.width=c;e.height=f.height=l;Ra(f);for(var g=0;f.mipmask>>g;++g){var k=c>>g,y=l>>g;if(!k||!y)break;a.texImage2D(3553,g,f.format,k,y,0,f.format,f.type,null)}Va();h.profile&&(f.stats.size=ib(f.internalformat,f.type,c,l,!1,!1));return e};e._reglType="texture2d";e._texture=f;h.profile&&(e.stats=f.stats);e.destroy=function(){f.decRef()};return e},createCube:function(b,c,e,f,r,u){function I(a,b,c,e,l,f){var S,k=A.texInfo;Fa.call(k);for(S=0;6>S;++S)G[S]=
H();if("number"!==typeof a&&a)if("object"===typeof a)if(b)M(G[0],a),M(G[1],b),M(G[2],c),M(G[3],e),M(G[4],l),M(G[5],f);else if(z(k,a),q(A,a),"faces"in a)for(a=a.faces,d(Array.isArray(a)&&6===a.length,"cube faces must be a length 6 array"),S=0;6>S;++S)d("object"===typeof a[S]&&!!a[S],"invalid input for cube map face"),m(G[S],A),M(G[S],a[S]);else for(S=0;6>S;++S)M(G[S],a);else d.raise("invalid arguments to cube map");else for(a=a|0||1,S=0;6>S;++S)x(G[S],a,a);m(A,G[0]);g.npotTextureCube||d(Sb(A.width)&&
Sb(A.height),"your browser does not support non power or two texture dimensions");A.mipmask=k.genMipmaps?(G[0].width<<1)-1:G[0].mipmask;d.textureCube(A,k,G,g);A.internalformat=G[0].internalformat;I.width=G[0].width;I.height=G[0].height;Ra(A);for(S=0;6>S;++S)t(G[S],34069+S);da(k,34067);Va();h.profile&&(A.stats.size=ib(A.internalformat,A.type,I.width,I.height,k.genMipmaps,!0));I.format=D[A.internalformat];I.type=C[A.type];I.mag=R[k.magFilter];I.min=ya[k.minFilter];I.wrapS=pa[k.wrapS];I.wrapT=pa[k.wrapT];
for(S=0;6>S;++S)w(G[S]);return I}var A=new rb(34067);Q[A.id]=A;k.cubeCount++;var G=Array(6);I(b,c,e,f,r,u);I.subimage=function(a,b,c,e,g){d(!!b,"must specify image data");d("number"===typeof a&&a===(a|0)&&0<=a&&6>a,"invalid face");c|=0;e|=0;g|=0;var f=n();m(f,A);f.width=0;f.height=0;xa(f,b);f.width=f.width||(A.width>>g)-c;f.height=f.height||(A.height>>g)-e;d(A.type===f.type&&A.format===f.format&&A.internalformat===f.internalformat,"incompatible format for texture.subimage");d(0<=c&&0<=e&&c+f.width<=
A.width&&e+f.height<=A.height,"texture.subimage write out of bounds");d(A.mipmask&1<<g,"missing mipmap data");d(f.data||f.element||f.needsCopy,"missing image data");Ra(A);v(f,34069+a,c,e,g);Va();l(f);return I};I.resize=function(b){b|=0;if(b!==A.width){I.width=A.width=b;I.height=A.height=b;Ra(A);for(var d=0;6>d;++d)for(var c=0;A.mipmask>>c;++c)a.texImage2D(34069+d,c,A.format,b>>c,b>>c,0,A.format,A.type,null);Va();h.profile&&(A.stats.size=ib(A.internalformat,A.type,I.width,I.height,!1,!0));return I}};
I._reglType="textureCube";I._texture=A;h.profile&&(I.stats=A.stats);I.destroy=function(){A.decRef()};return I},clear:function(){for(var b=0;b<L;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),ga[b]=null;W(Q).forEach(I);k.cubeCount=0;k.textureCount=0},getTexture:function(a){return null},restore:function(){for(var b=0;b<L;++b){var d=ga[b];d&&(d.bindCount=0,d.unit=-1,ga[b]=null)}W(Q).forEach(function(b){b.texture=a.createTexture();a.bindTexture(b.target,b.texture);for(var d=0;32>d;++d)if(0!==(b.mipmask&
1<<d))if(3553===b.target)a.texImage2D(3553,d,b.internalformat,b.width>>d,b.height>>d,0,b.internalformat,b.type,null);else for(var c=0;6>c;++c)a.texImage2D(34069+c,d,b.internalformat,b.width>>d,b.height>>d,0,b.internalformat,b.type,null);da(b.texInfo,b.target)})}}}function gc(a,b,g,c,e,k){function h(a,b,d){this.target=a;this.texture=b;this.renderbuffer=d;var c=a=0;b?(a=b.width,c=b.height):d&&(a=d.width,c=d.height);this.width=a;this.height=c}function f(a){a&&(a.texture&&a.texture._texture.decRef(),
a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function m(a,b,c){if(a){if(a.texture){a=a.texture._texture;var e=Math.max(1,a.height);d(Math.max(1,a.width)===b&&e===c,"inconsistent width/height for supplied texture")}else a=a.renderbuffer._renderbuffer,d(a.width===b&&a.height===c,"inconsistent width/height for renderbuffer");a.refCount+=1}}function q(b,d){d&&(d.texture?a.framebufferTexture2D(36160,b,d.target,d.texture._texture.texture,0):a.framebufferRenderbuffer(36160,b,36161,d.renderbuffer._renderbuffer.renderbuffer))}
function u(a){var b=3553,c=null,e=null,l=a;"object"===typeof a&&(l=a.data,"target"in a&&(b=a.target|0));d.type(l,"function","invalid attachment data");a=l._reglType;"texture2d"===a?(c=l,d(3553===b)):"textureCube"===a?(c=l,d(34069<=b&&34075>b,"invalid cube map target")):"renderbuffer"===a?(e=l,b=36161):d.raise("invalid regl object for attachment");return new h(b,c,e)}function r(a,b,d,l,g){if(d)return a=c.create2D({width:a,height:b,format:l,type:g}),a._texture.refCount=0,new h(3553,a,null);a=e.create({width:a,
height:b,format:l});a._renderbuffer.refCount=0;return new h(36161,null,a)}function xa(a){return a&&(a.texture||a.renderbuffer)}function v(a,b,d){a&&(a.texture?a.texture.resize(b,d):a.renderbuffer&&a.renderbuffer.resize(b,d),a.width=b,a.height=d)}function n(){this.id=z++;da[this.id]=this;this.framebuffer=a.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function l(a){a.colorAttachments.forEach(f);f(a.depthAttachment);
f(a.stencilAttachment);f(a.depthStencilAttachment)}function p(b){var c=b.framebuffer;d(c,"must not double destroy framebuffer");a.deleteFramebuffer(c);b.framebuffer=null;k.framebufferCount--;delete da[b.id]}function x(b){var c;a.bindFramebuffer(36160,b.framebuffer);var e=b.colorAttachments;for(c=0;c<e.length;++c)q(36064+c,e[c]);for(c=e.length;c<g.maxColorAttachments;++c)a.framebufferTexture2D(36160,36064+c,3553,null,0);a.framebufferTexture2D(36160,33306,3553,null,0);a.framebufferTexture2D(36160,36096,
3553,null,0);a.framebufferTexture2D(36160,36128,3553,null,0);q(36096,b.depthAttachment);q(36128,b.stencilAttachment);q(33306,b.depthStencilAttachment);b=a.checkFramebufferStatus(36160);a.isContextLost()||36053===b||d.raise("framebuffer configuration not supported, status = "+hc[b]);a.bindFramebuffer(36160,t.next?t.next.framebuffer:null);t.cur=t.next;a.getError()}function M(a,c){function e(a,c){var k;d(t.next!==f,"can not update framebuffer which is currently in use");var h=0,n=0,q=!0,M=!0;k=null;
var v=!0,p="rgba",ra="uint8",z=1,ma=null,da=null,ya=null,pa=!1;if("number"===typeof a)h=a|0,n=c|0||h;else if(a){d.type(a,"object","invalid arguments for framebuffer");"shape"in a?(n=a.shape,d(Array.isArray(n)&&2<=n.length,"invalid shape for framebuffer"),h=n[0],n=n[1]):("radius"in a&&(h=n=a.radius),"width"in a&&(h=a.width),"height"in a&&(n=a.height));if("color"in a||"colors"in a)k=a.color||a.colors,Array.isArray(k)&&d(1===k.length||b.webgl_draw_buffers,"multiple render targets not supported");if(!k){"colorCount"in
a&&(z=a.colorCount|0,d(0<z,"invalid color buffer count"));"colorTexture"in a&&(v=!!a.colorTexture,p="rgba4");if("colorType"in a){ra=a.colorType;if(v)d(b.oes_texture_float||!("float"===ra||"float32"===ra),"you must enable OES_texture_float in order to use floating point framebuffer objects"),d(b.oes_texture_half_float||!("half float"===ra||"float16"===ra),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===ra||"float16"===ra)d(b.ext_color_buffer_half_float,
"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),p="rgba16f";else if("float"===ra||"float32"===ra)d(b.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),p="rgba32f";d.oneOf(ra,Fa,"invalid color type")}if("colorFormat"in a)if(p=a.colorFormat,0<=H.indexOf(p))v=!0;else if(0<=w.indexOf(p))v=!1;else if(v)d.oneOf(a.colorFormat,H,"invalid color format for texture");else d.oneOf(a.colorFormat,w,"invalid color format for renderbuffer")}if("depthTexture"in
a||"depthStencilTexture"in a)pa=!(!a.depthTexture&&!a.depthStencilTexture),d(!pa||b.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in a&&("boolean"===typeof a.depth?q=a.depth:(ma=a.depth,M=!1));"stencil"in a&&("boolean"===typeof a.stencil?M=a.stencil:(da=a.stencil,q=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?q=M=a.depthStencil:(ya=a.depthStencil,M=q=!1))}else h=n=1;var T=null,F=null,B=null,D=null;if(Array.isArray(k))T=k.map(u);else if(k)T=[u(k)];else for(T=
Array(z),k=0;k<z;++k)T[k]=r(h,n,v,p,ra);d(b.webgl_draw_buffers||1>=T.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");d(T.length<=g.maxColorAttachments,"too many color attachments, not supported");h=h||T[0].width;n=n||T[0].height;ma?F=u(ma):q&&!M&&(F=r(h,n,pa,"depth","uint32"));da?B=u(da):M&&!q&&(B=r(h,n,!1,"stencil","uint8"));ya?D=u(ya):!ma&&!da&&M&&q&&(D=r(h,n,pa,"depth stencil","depth stencil"));d(1>=!!ma+!!da+!!ya,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");
q=null;for(k=0;k<T.length;++k)m(T[k],h,n),d(!T[k]||T[k].texture&&0<=ic.indexOf(T[k].texture._texture.format)||T[k].renderbuffer&&0<=jc.indexOf(T[k].renderbuffer._renderbuffer.format),"framebuffer color attachment "+k+" is invalid"),T[k]&&T[k].texture&&(M=xb[T[k].texture._texture.format]*nb[T[k].texture._texture.type],null===q?q=M:d(q===M,"all color attachments much have the same number of bits per pixel."));m(F,h,n);d(!F||F.texture&&6402===F.texture._texture.format||F.renderbuffer&&33189===F.renderbuffer._renderbuffer.format,
"invalid depth attachment for framebuffer object");m(B,h,n);d(!B||B.renderbuffer&&36168===B.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");m(D,h,n);d(!D||D.texture&&34041===D.texture._texture.format||D.renderbuffer&&34041===D.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");l(f);f.width=h;f.height=n;f.colorAttachments=T;f.depthAttachment=F;f.stencilAttachment=B;f.depthStencilAttachment=D;e.color=T.map(xa);e.depth=
xa(F);e.stencil=xa(B);e.depthStencil=xa(D);e.width=f.width;e.height=f.height;x(f);return e}var f=new n;k.framebufferCount++;e(a,c);return P(e,{resize:function(a,b){d(t.next!==f,"can not resize a framebuffer which is currently in use");var c=Math.max(a|0,1),l=Math.max(b|0||c,1);if(c===f.width&&l===f.height)return e;for(var g=f.colorAttachments,k=0;k<g.length;++k)v(g[k],c,l);v(f.depthAttachment,c,l);v(f.stencilAttachment,c,l);v(f.depthStencilAttachment,c,l);f.width=e.width=c;f.height=e.height=l;x(f);
return e},_reglType:"framebuffer",_framebuffer:f,destroy:function(){p(f);l(f)},use:function(a){t.setFBO({framebuffer:e},a)}})}var t={cur:null,next:null,dirty:!1,setFBO:null},H=["rgba"],w=["rgba4","rgb565","rgb5 a1"];b.ext_srgb&&w.push("srgba");b.ext_color_buffer_half_float&&w.push("rgba16f","rgb16f");b.webgl_color_buffer_float&&w.push("rgba32f");var Fa=["uint8"];b.oes_texture_half_float&&Fa.push("half float","float16");b.oes_texture_float&&Fa.push("float","float32");var z=0,da={};return P(t,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof n)?a:null},create:M,createCube:function(a){function e(a){var f;d(0>l.indexOf(t.next),"can not update framebuffer which is currently in use");var g={color:null},k=0,h=null;f="rgba";var m="uint8",n=1;if("number"===typeof a)k=a|0;else if(a){d.type(a,"object","invalid arguments for framebuffer");"shape"in a?(k=a.shape,d(Array.isArray(k)&&2<=k.length,"invalid shape for framebuffer"),d(k[0]===k[1],"cube framebuffer must be square"),k=
k[0]):("radius"in a&&(k=a.radius|0),"width"in a?(k=a.width|0,"height"in a&&d(a.height===k,"must be square")):"height"in a&&(k=a.height|0));if("color"in a||"colors"in a)h=a.color||a.colors,Array.isArray(h)&&d(1===h.length||b.webgl_draw_buffers,"multiple render targets not supported");h||("colorCount"in a&&(n=a.colorCount|0,d(0<n,"invalid color buffer count")),"colorType"in a&&(d.oneOf(a.colorType,Fa,"invalid color type"),m=a.colorType),"colorFormat"in a&&(f=a.colorFormat,d.oneOf(a.colorFormat,H,"invalid color format for texture")));
"depth"in a&&(g.depth=a.depth);"stencil"in a&&(g.stencil=a.stencil);"depthStencil"in a&&(g.depthStencil=a.depthStencil)}else k=1;if(h)if(Array.isArray(h))for(a=[],f=0;f<h.length;++f)a[f]=h[f];else a=[h];else for(a=Array(n),h={radius:k,format:f,type:m},f=0;f<n;++f)a[f]=c.createCube(h);g.color=Array(a.length);for(f=0;f<a.length;++f)n=a[f],d("function"===typeof n&&"textureCube"===n._reglType,"invalid cube map"),k=k||n.width,d(n.width===k&&n.height===k,"invalid cube map shape"),g.color[f]={target:34069,
data:a[f]};for(f=0;6>f;++f){for(n=0;n<a.length;++n)g.color[n].target=34069+f;0<f&&(g.depth=l[0].depth,g.stencil=l[0].stencil,g.depthStencil=l[0].depthStencil);if(l[f])l[f](g);else l[f]=M(g)}return P(e,{width:k,height:k,color:a})}var l=Array(6);e(a);return P(e,{faces:l,resize:function(a){var b=a|0;d(0<b&&b<=g.maxCubeMapSize,"invalid radius for cube fbo");if(b===e.width)return e;var c=e.color;for(a=0;a<c.length;++a)c[a].resize(b);for(a=0;6>a;++a)l[a].resize(b);e.width=e.height=b;return e},_reglType:"framebufferCube",
destroy:function(){l.forEach(function(a){a.destroy()})}})},clear:function(){W(da).forEach(p)},restore:function(){t.cur=null;t.next=null;t.dirty=!0;W(da).forEach(function(b){b.framebuffer=a.createFramebuffer();x(b)})}})}function yb(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}function kc(a,b,g,c,e){function k(a){if(a!==n.currentVAO){var d=b.oes_vertex_array_object;a?d.bindVertexArrayOES(a.vao):d.bindVertexArrayOES(null);
n.currentVAO=a}}function h(d){if(d!==n.currentVAO){if(d)d.bindAttrs();else for(var c=b.angle_instanced_arrays,e=0;e<r.length;++e){var f=r[e];f.buffer?(a.enableVertexAttribArray(e),a.vertexAttribPointer(e,f.size,f.type,f.normalized,f.stride,f.offfset),c&&c.vertexAttribDivisorANGLE(e,f.divisor)):(a.disableVertexAttribArray(e),a.vertexAttrib4f(e,f.x,f.y,f.z,f.w))}n.currentVAO=d}}function f(){W(v).forEach(function(a){a.destroy()})}function m(){this.id=++p;this.attributes=[];var a=b.oes_vertex_array_object;
this.vao=a?a.createVertexArrayOES():null;v[this.id]=this;this.buffers=[]}function q(){b.oes_vertex_array_object&&W(v).forEach(function(a){a.refresh()})}var u=g.maxAttributes,r=Array(u);for(g=0;g<u;++g)r[g]=new yb;var p=0,v={},n={Record:yb,scope:{},state:r,currentVAO:null,targetVAO:null,restore:b.oes_vertex_array_object?q:function(){},createVAO:function(a){function f(a){d(Array.isArray(a),"arguments to vertex array constructor must be an array");d(a.length<u,"too many attributes");d(0<a.length,"must specify at least one attribute");
for(var c=0;c<g.buffers.length;++c)g.buffers[c].destroy();g.buffers.length=0;c=g.attributes;c.length=a.length;for(var l=0;l<a.length;++l){var k=a[l],h=c[l]=new yb;Array.isArray(k)||X(k)||ba(k)?(k=e.create(k,34962,!1,!0),h.buffer=e.getBuffer(k),h.size=h.buffer.dimension|0,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,h.divisor=0,h.state=1,g.buffers.push(k)):e.getBuffer(k)?(h.buffer=e.getBuffer(k),h.size=h.buffer.dimension|0,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,
h.divisor=0,h.state=1):e.getBuffer(k.buffer)?(h.buffer=e.getBuffer(k.buffer),h.size=(+k.size||h.buffer.dimension)|0,h.normalized=!!k.normalized||!1,"type"in k?(d.parameter(k.type,Ma,"invalid buffer type"),h.type=Ma[k.type]):h.type=h.buffer.dtype,h.offset=(k.offset||0)|0,h.stride=(k.stride||0)|0,h.divisor=(k.divisor||0)|0,h.state=1,d(1<=h.size&&4>=h.size,"size must be between 1 and 4"),d(0<=h.offset,"invalid offset"),d(0<=h.stride&&255>=h.stride,"stride must be between 0 and 255"),d(0<=h.divisor,"divisor must be positive"),
d(!h.divisor||!!b.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in k?(d(0<l,"first attribute must not be a constant"),h.x=+k.x||0,h.y=+k.y||0,h.z=+k.z||0,h.w=+k.w||0,h.state=2):d(!1,"invalid attribute spec for location "+l)}g.refresh();return f}var g=new m;c.vaoCount+=1;f.destroy=function(){g.destroy()};f._vao=g;f._reglType="vao";return f(a)},getVAO:function(a){return"function"===typeof a&&a._vao?a._vao:null},destroyBuffer:function(b){for(var d=0;d<r.length;++d){var c=
r[d];c.buffer===b&&(a.disableVertexAttribArray(d),c.buffer=null)}},setVAO:b.oes_vertex_array_object?k:h,clear:b.oes_vertex_array_object?f:function(){}};m.prototype.bindAttrs=function(){for(var d=b.angle_instanced_arrays,c=this.attributes,e=0;e<c.length;++e){var f=c[e];f.buffer?(a.enableVertexAttribArray(e),a.bindBuffer(34962,f.buffer.buffer),a.vertexAttribPointer(e,f.size,f.type,f.normalized,f.stride,f.offset),d&&d.vertexAttribDivisorANGLE(e,f.divisor)):(a.disableVertexAttribArray(e),a.vertexAttrib4f(e,
f.x,f.y,f.z,f.w))}for(d=c.length;d<u;++d)a.disableVertexAttribArray(d)};m.prototype.refresh=function(){var a=b.oes_vertex_array_object;a&&(a.bindVertexArrayOES(this.vao),this.bindAttrs(),n.currentVAO=this)};m.prototype.destroy=function(){if(this.vao){var a=b.oes_vertex_array_object;this===n.currentVAO&&(n.currentVAO=null,a.bindVertexArrayOES(null));a.deleteVertexArrayOES(this.vao);this.vao=null}v[this.id]&&(delete v[this.id],--c.vaoCount)};return n}function lc(a,b,g,c){function e(a,b,d,c){this.name=
a;this.id=b;this.location=d;this.info=c}function k(a,b){for(var d=0;d<a.length;++d)if(a[d].id===b.id){a[d].location=b.location;return}a.push(b)}function h(c,e,f){var k=35632===c?q:u,g=k[e];if(!g){var m=b.str(e),g=a.createShader(c);a.shaderSource(g,m);a.compileShader(g);d.shaderError(a,g,m,c,f);k[e]=g}return g}function f(a,b){this.id=v++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];c.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function m(f,g,m){var q;
q=h(35632,f.fragId);var r=h(35633,f.vertId),u=f.program=a.createProgram();a.attachShader(u,q);a.attachShader(u,r);if(m)for(q=0;q<m.length;++q)r=m[q],a.bindAttribLocation(u,r[0],r[1]);a.linkProgram(u);d.linkError(a,u,b.str(f.fragId),b.str(f.vertId),g);m=a.getProgramParameter(u,35718);c.profile&&(f.stats.uniformsCount=m);r=f.uniforms;for(q=0;q<m;++q)if(g=a.getActiveUniform(u,q))if(1<g.size)for(var v=0;v<g.size;++v){var p=g.name.replace("[0]","["+v+"]");k(r,new e(p,b.id(p),a.getUniformLocation(u,p),
g))}else k(r,new e(g.name,b.id(g.name),a.getUniformLocation(u,g.name),g));m=a.getProgramParameter(u,35721);c.profile&&(f.stats.attributesCount=m);f=f.attributes;for(q=0;q<m;++q)(g=a.getActiveAttrib(u,q))&&k(f,new e(g.name,b.id(g.name),a.getAttribLocation(u,g.name),g))}var q={},u={},r={},p=[],v=0;c.profile&&(g.getMaxUniformsCount=function(){var a=0;p.forEach(function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)});return a},g.getMaxAttributesCount=function(){var a=0;p.forEach(function(b){b.stats.attributesCount>
a&&(a=b.stats.attributesCount)});return a});return{clear:function(){var b=a.deleteShader.bind(a);W(q).forEach(b);q={};W(u).forEach(b);u={};p.forEach(function(b){a.deleteProgram(b.program)});p.length=0;r={};g.shaderCount=0},program:function(a,b,c,e){d.command(0<=a,"missing vertex shader",c);d.command(0<=b,"missing fragment shader",c);var k=r[b];k||(k=r[b]={});var h=k[a];if(h&&!e)return h;b=new f(b,a);g.shaderCount++;m(b,c,e);h||(k[a]=b);p.push(b);return b},restore:function(){q={};u={};for(var a=0;a<
p.length;++a)m(p[a],null,p[a].attributes.map(function(a){return[a.location,a.name]}))},shader:h,frag:-1,vert:-1}}function mc(a,b,g,c,e,k,h){function f(f){var m;null===b.next?(d(e.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),m=5121):(d(null!==b.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),m=b.next.colorAttachments[0].texture._texture.type,k.oes_texture_float?(d(5121===m||5126===
m,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),5126===m&&d(h.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):d(5121===m,"Reading from a framebuffer is only allowed for the type 'uint8'"));var r=0,p=0,v=c.framebufferWidth,n=c.framebufferHeight,l=null;X(f)?l=f:f&&(d.type(f,"object","invalid arguments to regl.read()"),r=f.x|0,p=f.y|0,d(0<=r&&r<c.framebufferWidth,"invalid x offset for regl.read"),
d(0<=p&&p<c.framebufferHeight,"invalid y offset for regl.read"),v=(f.width||c.framebufferWidth-r)|0,n=(f.height||c.framebufferHeight-p)|0,l=f.data||null);l&&(5121===m?d(l instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===m&&d(l instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));d(0<v&&v+r<=c.framebufferWidth,"invalid width for read pixels");d(0<n&&n+p<=c.framebufferHeight,"invalid height for read pixels");
g();f=v*n*4;l||(5121===m?l=new Uint8Array(f):5126===m&&(l=l||new Float32Array(f)));d.isTypedArray(l,"data buffer for regl.read() must be a typedarray");d(l.byteLength>=f,"data buffer for regl.read() too small");a.pixelStorei(3333,4);a.readPixels(r,p,v,n,6408,m,l);return l}function m(a){var d;b.setFBO({framebuffer:a.framebuffer},function(){d=f(a)});return d}return function(a){return a&&"framebuffer"in a?m(a):f(a)}}function Wa(a){return Array.prototype.slice.call(a)}function Xa(a){return Wa(a).join("")}
function nc(){function a(){var a=[],b=[];return P(function(){a.push.apply(a,Wa(arguments))},{def:function(){var c="v"+d++;b.push(c);0<arguments.length&&(a.push(c,"="),a.push.apply(a,Wa(arguments)),a.push(";"));return c},toString:function(){return Xa([0<b.length?"var "+b.join(",")+";":"",Xa(a)])}})}function b(){function b(a,f){c(a,f,"=",d.def(a,f),";")}var d=a(),c=a(),e=d.toString,g=c.toString;return P(function(){d.apply(d,Wa(arguments))},{def:d.def,entry:d,exit:c,save:b,set:function(a,c,e){b(a,c);
d(a,c,"=",e,";")},toString:function(){return e()+g()}})}var d=0,c=[],e=[],k=a(),h={};return{global:k,link:function(a){for(var b=0;b<e.length;++b)if(e[b]===a)return c[b];b="g"+d++;c.push(b);e.push(a);return b},block:a,proc:function(a,d){function c(){var a="a"+e.length;e.push(a);return a}var e=[];d=d||0;for(var g=0;g<d;++g)c();var g=b(),k=g.toString;return h[a]=P(g,{arg:c,toString:function(){return Xa(["function(",e.join(),"){",k(),"}"])}})},scope:b,cond:function(){var a=Xa(arguments),d=b(),c=b(),e=
d.toString,g=c.toString;return P(d,{then:function(){d.apply(d,Wa(arguments));return this},"else":function(){c.apply(c,Wa(arguments));return this},toString:function(){var b=g();b&&(b="else{"+b+"}");return Xa(["if(",a,"){",e(),"}",b])}})},compile:function(){var a=['"use strict";',k,"return {"];Object.keys(h).forEach(function(b){a.push('"',b,'":',h[b].toString(),",")});a.push("}");var b=Xa(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,c.concat(b)).apply(null,
e)}}}function ob(a){return Array.isArray(a)||X(a)||ba(a)}function Tb(a){return a.sort(function(a,d){return"viewport"===a?-1:"viewport"===d?1:a<d?-1:1})}function la(a,b,d,c){this.thisDep=a;this.contextDep=b;this.propDep=d;this.append=c}function Ja(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function O(a){return new la(!1,!1,!1,a)}function ka(a,b){var d=a.type;return 0===d?(d=a.data.length,new la(!0,1<=d,2<=d,b)):4===d?(d=a.data,new la(d.thisDep,d.contextDep,d.propDep,b)):new la(3===d,2===d,
1===d,b)}function oc(a,b,g,c,e,k,h,f,m,q,p,r,t,v,n){function l(a){return a.replace(".","_")}function H(a,b,d){var c=l(a);cb.push(a);bb[c]=Z[c]=!!d;Ha[c]=b}function x(a,b,d){var c=l(a);cb.push(a);Array.isArray(d)?(Z[c]=d.slice(),bb[c]=d.slice()):Z[c]=bb[c]=d;Ia[c]=b}function M(){var a=nc(),c=a.link,e=a.global;a.id=eb++;a.batchId="0";var f=c(ha),g=a.shared={props:"a0"};Object.keys(ha).forEach(function(a){g[a]=e.def(f,".",a)});d.optional(function(){a.CHECK=c(d);a.commandStr=d.guessCommand();a.command=
c(a.commandStr);a.assert=function(a,b,d){a("if(!(",b,"))",this.CHECK,".commandRaise(",c(d),",",this.command,");")};W.invalidBlendCombinations=Ub});var k=a.next={},h=a.current={};Object.keys(Ia).forEach(function(a){Array.isArray(Z[a])&&(k[a]=e.def(g.next,".",a),h[a]=e.def(g.current,".",a))});var l=a.constants={};Object.keys(W).forEach(function(a){l[a]=e.def(JSON.stringify(W[a]))});a.invoke=function(b,d){switch(d.type){case 0:var e=["this",g.context,g.props,a.batchId];return b.def(c(d.data),".call(",
e.slice(0,Math.max(d.data.length+1,4)),")");case 1:return b.def(g.props,d.data);case 2:return b.def(g.context,d.data);case 3:return b.def("this",d.data);case 4:return d.data.append(a,b),d.data.ref}};a.attribCache={};var Oa={};a.scopeAttrib=function(a){a=b.id(a);if(a in Oa)return Oa[a];var d=q.scope[a];d||(d=q.scope[a]=new ba);return Oa[a]=c(d)};return a}function w(a){var b=a["static"];a=a.dynamic;var d;if("profile"in b){var c=!!b.profile;d=O(function(a,b){return c});d.enable=c}else if("profile"in
a){var e=a.profile;d=ka(e,function(a,b){return a.invoke(b,e)})}return d}function z(a,b){var c=a["static"],e=a.dynamic;if("framebuffer"in c){var g=c.framebuffer;return g?(g=f.getFramebuffer(g),d.command(g,"invalid framebuffer object"),O(function(a,b){var d=a.link(g),c=a.shared;b.set(c.framebuffer,".next",d);c=c.context;b.set(c,".framebufferWidth",d+".width");b.set(c,".framebufferHeight",d+".height");return d})):O(function(a,b){var d=a.shared;b.set(d.framebuffer,".next","null");d=d.context;b.set(d,
".framebufferWidth",d+".drawingBufferWidth");b.set(d,".framebufferHeight",d+".drawingBufferHeight");return"null"})}if("framebuffer"in e){var k=e.framebuffer;return ka(k,function(a,b){var c=a.invoke(b,k),e=a.shared,f=e.framebuffer,g=b.def(f,".getFramebuffer(",c,")");d.optional(function(){a.assert(b,"!"+c+"||"+g,"invalid framebuffer object")});b.set(f,".next",g);e=e.context;b.set(e,".framebufferWidth",g+"?"+g+".width:"+e+".drawingBufferWidth");b.set(e,".framebufferHeight",g+"?"+g+".height:"+e+".drawingBufferHeight");
return g})}return null}function da(a,b,c){function e(a){if(a in f){var k=f[a];d.commandType(k,"object","invalid "+a,c.commandStr);var y=!0,Na=k.x|0,h=k.y|0,l,wb;"width"in k?(l=k.width|0,d.command(0<=l,"invalid "+a,c.commandStr)):y=!1;"height"in k?(wb=k.height|0,d.command(0<=wb,"invalid "+a,c.commandStr)):y=!1;return new la(!y&&b&&b.thisDep,!y&&b&&b.contextDep,!y&&b&&b.propDep,function(a,b){var d=a.shared.context,c=l;"width"in k||(c=b.def(d,".","framebufferWidth","-",Na));var e=wb;"height"in k||(e=
b.def(d,".","framebufferHeight","-",h));return[Na,h,c,e]})}if(a in g){var m=g[a],y=ka(m,function(b,c){var e=b.invoke(c,m);d.optional(function(){b.assert(c,e+"&&typeof "+e+'==="object"',"invalid "+a)});var f=b.shared.context,g=c.def(e,".x|0"),k=c.def(e,".y|0"),Na=c.def('"width" in ',e,"?",e,".width|0:","(",f,".","framebufferWidth","-",g,")"),y=c.def('"height" in ',e,"?",e,".height|0:","(",f,".","framebufferHeight","-",k,")");d.optional(function(){b.assert(c,Na+">=0&&"+y+">=0","invalid "+a)});return[g,
k,Na,y]});b&&(y.thisDep=y.thisDep||b.thisDep,y.contextDep=y.contextDep||b.contextDep,y.propDep=y.propDep||b.propDep);return y}return b?new la(b.thisDep,b.contextDep,b.propDep,function(a,b){var d=a.shared.context;return[0,0,b.def(d,".","framebufferWidth"),b.def(d,".","framebufferHeight")]}):null}var f=a["static"],g=a.dynamic;if(a=e("viewport")){var k=a;a=new la(a.thisDep,a.contextDep,a.propDep,function(a,b){var d=k.append(a,b),c=a.shared.context;b.set(c,".viewportWidth",d[2]);b.set(c,".viewportHeight",
d[3]);return d})}return{viewport:a,scissor_box:e("scissor.box")}}function F(a,b){var c=a["static"];if("string"===typeof c.frag&&"string"===typeof c.vert){if(0<Object.keys(b.dynamic).length)return null;var c=b["static"],e=Object.keys(c);if(0<e.length&&"number"===typeof c[e[0]]){for(var f=[],g=0;g<e.length;++g)d("number"===typeof c[e[g]],"must specify all vertex attribute locations when using vaos"),f.push([c[e[g]]|0,e[g]]);return f}}return null}function B(a,c,e){function f(a){if(a in g){var c=b.id(g[a]);
d.optional(function(){p.shader(Vb[a],c,d.guessCommand())});var e=O(function(){return c});e.id=c;return e}if(a in k){var y=k[a];return ka(y,function(b,c){var e=b.invoke(c,y),f=c.def(b.shared.strings,".id(",e,")");d.optional(function(){c(b.shared.shader,".shader(",Vb[a],",",f,",",b.command,");")});return f})}return null}var g=a["static"],k=a.dynamic,h=f("frag"),l=f("vert"),Oa=null;Ja(h)&&Ja(l)?(Oa=p.program(l.id,h.id,null,e),a=O(function(a,b){return a.link(Oa)})):a=new la(h&&h.thisDep||l&&l.thisDep,
h&&h.contextDep||l&&l.contextDep,h&&h.propDep||l&&l.propDep,function(a,b){var c=a.shared.shader,e;e=h?h.append(a,b):b.def(c,".","frag");var f;f=l?l.append(a,b):b.def(c,".","vert");var g=c+".program("+f+","+e;d.optional(function(){g+=","+a.command});return b.def(g+")")});return{frag:h,vert:l,progVar:a,program:Oa}}function Q(a,b){function c(a,k){if(a in e){var y=e[a]|0;d.command(!k||0<=y,"invalid "+a,b.commandStr);return O(function(a,b){k&&(a.OFFSET=y);return y})}if(a in f){var h=f[a];return ka(h,function(b,
c){var e=b.invoke(c,h);k&&(b.OFFSET=e,d.optional(function(){b.assert(c,e+">=0","invalid "+a)}));return e})}return k&&g?O(function(a,b){a.OFFSET="0";return 0}):null}var e=a["static"],f=a.dynamic,g=function(){if("elements"in e){var a=e.elements;ob(a)?a=k.getElements(k.create(a,!0)):a&&(a=k.getElements(a),d.command(a,"invalid elements",b.commandStr));var c=O(function(b,d){if(a){var c=b.link(a);return b.ELEMENTS=c}return b.ELEMENTS=null});c.value=a;return c}if("elements"in f){var g=f.elements;return ka(g,
function(a,b){var c=a.shared,e=c.isBufferArgs,c=c.elements,f=a.invoke(b,g),k=b.def("null"),e=b.def(e,"(",f,")"),y=a.cond(e).then(k,"=",c,".createStream(",f,");")["else"](k,"=",c,".getElements(",f,");");d.optional(function(){a.assert(y["else"],"!"+f+"||"+k,"invalid elements")});b.entry(y);b.exit(a.cond(e).then(c,".destroyStream(",k,");"));return a.ELEMENTS=k})}return null}(),h=c("offset",!0);return{elements:g,primitive:function(){if("primitive"in e){var a=e.primitive;d.commandParameter(a,Sa,"invalid primitve",
b.commandStr);return O(function(b,d){return Sa[a]})}if("primitive"in f){var c=f.primitive;return ka(c,function(a,b){var e=a.constants.primTypes,f=a.invoke(b,c);d.optional(function(){a.assert(b,f+" in "+e,"invalid primitive, must be one of "+Object.keys(Sa))});return b.def(e,"[",f,"]")})}return g?Ja(g)?g.value?O(function(a,b){return b.def(a.ELEMENTS,".primType")}):O(function(){return 4}):new la(g.thisDep,g.contextDep,g.propDep,function(a,b){var d=a.ELEMENTS;return b.def(d,"?",d,".primType:",4)}):null}(),
count:function(){if("count"in e){var a=e.count|0;d.command("number"===typeof a&&0<=a,"invalid vertex count",b.commandStr);return O(function(){return a})}if("count"in f){var c=f.count;return ka(c,function(a,b){var e=a.invoke(b,c);d.optional(function(){a.assert(b,"typeof "+e+'==="number"&&'+e+">=0&&"+e+"===("+e+"|0)","invalid vertex count")});return e})}if(g){if(Ja(g)){if(g)return h?new la(h.thisDep,h.contextDep,h.propDep,function(a,b){var c=b.def(a.ELEMENTS,".vertCount-",a.OFFSET);d.optional(function(){a.assert(b,
c+">=0","invalid vertex offset/element buffer too small")});return c}):O(function(a,b){return b.def(a.ELEMENTS,".vertCount")});var k=O(function(){return-1});d.optional(function(){k.MISSING=!0});return k}var y=new la(g.thisDep||h.thisDep,g.contextDep||h.contextDep,g.propDep||h.propDep,function(a,b){var d=a.ELEMENTS;return a.OFFSET?b.def(d,"?",d,".vertCount-",a.OFFSET,":-1"):b.def(d,"?",d,".vertCount:-1")});d.optional(function(){y.DYNAMIC=!0});return y}return null}(),instances:c("instances",!1),offset:h}}
function C(a,b){var e=a["static"],f=a.dynamic,g={};cb.forEach(function(a){function k(b,d){if(a in e){var c=b(e[a]);g[y]=O(function(){return c})}else if(a in f){var h=f[a];g[y]=ka(h,function(a,b){return d(a,b,a.invoke(b,h))})}}var y=l(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return k(function(c){d.commandType(c,"boolean",a,b.commandStr);
return c},function(b,c,e){d.optional(function(){b.assert(c,"typeof "+e+'==="boolean"',"invalid flag "+a,b.commandStr)});return e});case "depth.func":return k(function(c){d.commandParameter(c,Ya,"invalid "+a,b.commandStr);return Ya[c]},function(b,c,e){var f=b.constants.compareFuncs;d.optional(function(){b.assert(c,e+" in "+f,"invalid "+a+", must be one of "+Object.keys(Ya))});return c.def(f,"[",e,"]")});case "depth.range":return k(function(a){d.command(N(a)&&2===a.length&&"number"===typeof a[0]&&"number"===
typeof a[1]&&a[0]<=a[1],"depth range is 2d array",b.commandStr);return a},function(a,b,c){d.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===2&&typeof "+c+'[0]==="number"&&typeof '+c+'[1]==="number"&&'+c+"[0]<="+c+"[1]","depth range must be a 2d array")});var e=b.def("+",c,"[0]"),f=b.def("+",c,"[1]");return[e,f]});case "blend.func":return k(function(a){d.commandType(a,"object","blend.func",b.commandStr);var c="srcRGB"in a?a.srcRGB:a.src,e="srcAlpha"in a?a.srcAlpha:a.src,
f="dstRGB"in a?a.dstRGB:a.dst;a="dstAlpha"in a?a.dstAlpha:a.dst;d.commandParameter(c,za,y+".srcRGB",b.commandStr);d.commandParameter(e,za,y+".srcAlpha",b.commandStr);d.commandParameter(f,za,y+".dstRGB",b.commandStr);d.commandParameter(a,za,y+".dstAlpha",b.commandStr);d.command(-1===Ub.indexOf(c+", "+f),"unallowed blending combination (srcRGB, dstRGB) = ("+c+", "+f+")",b.commandStr);return[za[c],za[f],za[e],za[a]]},function(b,c,e){function f(k,y){var h=c.def('"',k,y,'" in ',e,"?",e,".",k,y,":",e,".",
k);d.optional(function(){b.assert(c,h+" in "+g,"invalid "+a+"."+k+y+", must be one of "+Object.keys(za))});return h}var g=b.constants.blendFuncs;d.optional(function(){b.assert(c,e+"&&typeof "+e+'==="object"',"invalid blend func, must be an object")});var k=f("src","RGB"),y=f("dst","RGB");d.optional(function(){b.assert(c,b.constants.invalidBlendCombinations+".indexOf("+k+'+", "+'+y+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var h=c.def(g,"[",k,"]"),l=c.def(g,"[",f("src","Alpha"),
"]"),V=c.def(g,"[",y,"]"),m=c.def(g,"[",f("dst","Alpha"),"]");return[h,V,l,m]});case "blend.equation":return k(function(c){if("string"===typeof c)return d.commandParameter(c,ga,"invalid "+a,b.commandStr),[ga[c],ga[c]];if("object"===typeof c)return d.commandParameter(c.rgb,ga,a+".rgb",b.commandStr),d.commandParameter(c.alpha,ga,a+".alpha",b.commandStr),[ga[c.rgb],ga[c.alpha]];d.commandRaise("invalid blend.equation",b.commandStr)},function(b,c,e){var f=b.constants.blendEquations,g=c.def(),k=c.def(),
y=b.cond("typeof ",e,'==="string"');d.optional(function(){function c(a,d,e){b.assert(a,e+" in "+f,"invalid "+d+", must be one of "+Object.keys(ga))}c(y.then,a,e);b.assert(y["else"],e+"&&typeof "+e+'==="object"',"invalid "+a);c(y["else"],a+".rgb",e+".rgb");c(y["else"],a+".alpha",e+".alpha")});y.then(g,"=",k,"=",f,"[",e,"];");y["else"](g,"=",f,"[",e,".rgb];",k,"=",f,"[",e,".alpha];");c(y);return[g,k]});case "blend.color":return k(function(a){d.command(N(a)&&4===a.length,"blend.color must be a 4d array",
b.commandStr);return D(4,function(b){return+a[b]})},function(a,b,c){d.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===4","blend.color must be a 4d array")});return D(4,function(a){return b.def("+",c,"[",a,"]")})});case "stencil.mask":return k(function(a){d.commandType(a,"number",y,b.commandStr);return a|0},function(a,b,c){d.optional(function(){a.assert(b,"typeof "+c+'==="number"',"invalid stencil.mask")});return b.def(c,"|0")});case "stencil.func":return k(function(c){d.commandType(c,
"object",y,b.commandStr);var e=c.cmp||"keep",f=c.ref||0;c="mask"in c?c.mask:-1;d.commandParameter(e,Ya,a+".cmp",b.commandStr);d.commandType(f,"number",a+".ref",b.commandStr);d.commandType(c,"number",a+".mask",b.commandStr);return[Ya[e],f,c]},function(a,b,c){var e=a.constants.compareFuncs;d.optional(function(){function d(){a.assert(b,Array.prototype.join.call(arguments,""),"invalid stencil.func")}d(c+"&&typeof ",c,'==="object"');d('!("cmp" in ',c,")||(",c,".cmp in ",e,")")});var f=b.def('"cmp" in ',
c,"?",e,"[",c,".cmp]",":",7680),g=b.def(c,".ref|0"),k=b.def('"mask" in ',c,"?",c,".mask|0:-1");return[f,g,k]});case "stencil.opFront":case "stencil.opBack":return k(function(c){d.commandType(c,"object",y,b.commandStr);var e=c.fail||"keep",f=c.zfail||"keep";c=c.zpass||"keep";d.commandParameter(e,Ka,a+".fail",b.commandStr);d.commandParameter(f,Ka,a+".zfail",b.commandStr);d.commandParameter(c,Ka,a+".zpass",b.commandStr);return["stencil.opBack"===a?1029:1028,Ka[e],Ka[f],Ka[c]]},function(b,c,e){function f(k){d.optional(function(){b.assert(c,
'!("'+k+'" in '+e+")||("+e+"."+k+" in "+g+")","invalid "+a+"."+k+", must be one of "+Object.keys(Ka))});return c.def('"',k,'" in ',e,"?",g,"[",e,".",k,"]:",7680)}var g=b.constants.stencilOps;d.optional(function(){b.assert(c,e+"&&typeof "+e+'==="object"',"invalid "+a)});return["stencil.opBack"===a?1029:1028,f("fail"),f("zfail"),f("zpass")]});case "polygonOffset.offset":return k(function(a){d.commandType(a,"object",y,b.commandStr);var c=a.factor|0;a=a.units|0;d.commandType(c,"number",y+".factor",b.commandStr);
d.commandType(a,"number",y+".units",b.commandStr);return[c,a]},function(b,c,e){d.optional(function(){b.assert(c,e+"&&typeof "+e+'==="object"',"invalid "+a)});var f=c.def(e,".factor|0"),g=c.def(e,".units|0");return[f,g]});case "cull.face":return k(function(a){var c=0;"front"===a?c=1028:"back"===a&&(c=1029);d.command(!!c,y,b.commandStr);return c},function(a,b,c){d.optional(function(){a.assert(b,c+'==="front"||'+c+'==="back"',"invalid cull.face")});return b.def(c,'==="front"?',1028,":",1029)});case "lineWidth":return k(function(a){d.command("number"===
typeof a&&a>=c.lineWidthDims[0]&&a<=c.lineWidthDims[1],"invalid line width, must be a positive number between "+c.lineWidthDims[0]+" and "+c.lineWidthDims[1],b.commandStr);return a},function(a,b,e){d.optional(function(){a.assert(b,"typeof "+e+'==="number"&&'+e+">="+c.lineWidthDims[0]+"&&"+e+"<="+c.lineWidthDims[1],"invalid line width")});return e});case "frontFace":return k(function(a){d.commandParameter(a,zb,y,b.commandStr);return zb[a]},function(a,b,c){d.optional(function(){a.assert(b,c+'==="cw"||'+
c+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return b.def(c+'==="cw"?2304:2305')});case "colorMask":return k(function(a){d.command(N(a)&&4===a.length,"color.mask must be length 4 array",b.commandStr);return a.map(function(a){return!!a})},function(a,b,c){d.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===4","invalid color.mask")});return D(4,function(a){return"!!"+c+"["+a+"]"})});case "sample.coverage":return k(function(a){d.command("object"===typeof a&&a,
y,b.commandStr);var c="value"in a?a.value:1;a=!!a.invert;d.command("number"===typeof c&&0<=c&&1>=c,"sample.coverage.value must be a number between 0 and 1",b.commandStr);return[c,a]},function(a,b,c){d.optional(function(){a.assert(b,c+"&&typeof "+c+'==="object"',"invalid sample.coverage")});var e=b.def('"value" in ',c,"?+",c,".value:1"),f=b.def("!!",c,".invert");return[e,f]})}});return g}function R(a,b){var c=a["static"],e=a.dynamic,f={};Object.keys(c).forEach(function(a){var e=c[a],g;if("number"===
typeof e||"boolean"===typeof e)g=O(function(){return e});else if("function"===typeof e){var k=e._reglType;"texture2d"===k||"textureCube"===k?g=O(function(a){return a.link(e)}):"framebuffer"===k||"framebufferCube"===k?(d.command(0<e.color.length,'missing color attachment for framebuffer sent to uniform "'+a+'"',b.commandStr),g=O(function(a){return a.link(e.color[0])})):d.commandRaise('invalid data for uniform "'+a+'"',b.commandStr)}else N(e)?g=O(function(b){return b.global.def("[",D(e.length,function(c){d.command("number"===
typeof e[c]||"boolean"===typeof e[c],"invalid uniform "+a,b.commandStr);return e[c]}),"]")}):d.commandRaise('invalid or missing data for uniform "'+a+'"',b.commandStr);g.value=e;f[a]=g});Object.keys(e).forEach(function(a){var b=e[a];f[a]=ka(b,function(a,c){return a.invoke(c,b)})});return f}function E(a,c){var f=a["static"],g=a.dynamic,k={};Object.keys(f).forEach(function(a){var g=f[a],y=b.id(a),h=new ba;if(ob(g))h.state=1,h.buffer=e.getBuffer(e.create(g,34962,!1,!0)),h.type=0;else{var l=e.getBuffer(g);
if(l)h.state=1,h.buffer=l,h.type=0;else if(d.command("object"===typeof g&&g,"invalid data for attribute "+a,c.commandStr),"constant"in g){var m=g.constant;h.buffer="null";h.state=2;"number"===typeof m?h.x=m:(d.command(N(m)&&0<m.length&&4>=m.length,"invalid constant for attribute "+a,c.commandStr),Za.forEach(function(a,b){b<m.length&&(h[a]=m[b])}))}else{l=ob(g.buffer)?e.getBuffer(e.create(g.buffer,34962,!1,!0)):e.getBuffer(g.buffer);d.command(!!l,'missing buffer for attribute "'+a+'"',c.commandStr);
var n=g.offset|0;d.command(0<=n,'invalid offset for attribute "'+a+'"',c.commandStr);var q=g.stride|0;d.command(0<=q&&256>q,'invalid stride for attribute "'+a+'", must be integer betweeen [0, 255]',c.commandStr);var r=g.size|0;d.command(!("size"in g)||0<r&&4>=r,'invalid size for attribute "'+a+'", must be 1,2,3,4',c.commandStr);var Ea=!!g.normalized,p=0;"type"in g&&(d.commandParameter(g.type,Ma,"invalid type for attribute "+a,c.commandStr),p=Ma[g.type]);var v=g.divisor|0;"divisor"in g&&(d.command(0===
v||Da,'cannot specify divisor for attribute "'+a+'", instancing not supported',c.commandStr),d.command(0<=v,'invalid divisor for attribute "'+a+'"',c.commandStr));d.optional(function(){var b=c.commandStr,e="buffer offset divisor normalized type size stride".split(" ");Object.keys(g).forEach(function(c){d.command(0<=e.indexOf(c),'unknown parameter "'+c+'" for attribute pointer "'+a+'" (valid parameters are '+e+")",b)})});h.buffer=l;h.state=1;h.size=r;h.normalized=Ea;h.type=p||l.dtype;h.offset=n;h.stride=
q;h.divisor=v}}k[a]=O(function(a,b){var c=a.attribCache;if(y in c)return c[y];var d={isStream:!1};Object.keys(h).forEach(function(a){d[a]=h[a]});h.buffer&&(d.buffer=a.link(h.buffer),d.type=d.type||d.buffer+".dtype");return c[y]=d})});Object.keys(g).forEach(function(a){var b=g[a];k[a]=ka(b,function(c,e){function f(a){e(V[a],"=",g,".",a,"|0;")}var g=c.invoke(e,b),k=c.shared,y=c.constants,h=k.isBufferArgs,l=k.buffer;d.optional(function(){c.assert(e,g+"&&(typeof "+g+'==="object"||typeof '+g+'==="function")&&('+
h+"("+g+")||"+l+".getBuffer("+g+")||"+l+".getBuffer("+g+".buffer)||"+h+"("+g+'.buffer)||("constant" in '+g+"&&(typeof "+g+'.constant==="number"||'+k.isArrayLike+"("+g+".constant))))",'invalid dynamic attribute "'+a+'"')});var V={isStream:e.def(!1)},m=new ba;m.state=1;Object.keys(m).forEach(function(a){V[a]=e.def(""+m[a])});var ea=V.buffer,n=V.type;e("if(",h,"(",g,")){",V.isStream,"=true;",ea,"=",l,".createStream(",34962,",",g,");",n,"=",ea,".dtype;","}else{",ea,"=",l,".getBuffer(",g,");","if(",ea,
"){",n,"=",ea,".dtype;",'}else if("constant" in ',g,"){",V.state,"=",2,";","if(typeof "+g+'.constant === "number"){',V[Za[0]],"=",g,".constant;",Za.slice(1).map(function(a){return V[a]}).join("="),"=0;","}else{",Za.map(function(a,b){return V[a]+"="+g+".constant.length>"+b+"?"+g+".constant["+b+"]:0;"}).join(""),"}}else{","if(",h,"(",g,".buffer)){",ea,"=",l,".createStream(",34962,",",g,".buffer);","}else{",ea,"=",l,".getBuffer(",g,".buffer);","}",n,'="type" in ',g,"?",y.glTypes,"[",g,".type]:",ea,".dtype;",
V.normalized,"=!!",g,".normalized;");f("size");f("offset");f("stride");f("divisor");e("}}");e.exit("if(",V.isStream,"){",l,".destroyStream(",ea,");","}");return V})});return k}function I(a,b){var c=a["static"],d=a.dynamic;if("vao"in c){var e=c.vao;null!==e&&null===q.getVAO(e)&&(e=q.createVAO(e));return O(function(a){return a.link(q.getVAO(e))})}if("vao"in d){var f=d.vao;return ka(f,function(a,b){var c=a.invoke(b,f);return b.def(a.shared.vao+".getVAO("+c+")")})}return null}function A(a){var b=a["static"],
c=a.dynamic,d={};Object.keys(b).forEach(function(a){var c=b[a];d[a]=O(function(a,b){return"number"===typeof c||"boolean"===typeof c?""+c:a.link(c)})});Object.keys(c).forEach(function(a){var b=c[a];d[a]=ka(b,function(a,c){return a.invoke(c,b)})});return d}function L(a,b,c,e,f){function k(a){var b=Na[a];b&&(v[a]=b)}var h=a["static"],m=a.dynamic;d.optional(function(){function a(c){Object.keys(c).forEach(function(a){d.command(0<=b.indexOf(a),'unknown parameter "'+a+'"',f.commandStr)})}var b="framebuffer vert frag elements primitive offset count instances profile vao".split(" ").concat(cb);
a(h);a(m)});var n=F(a,b),r=z(a,f),Na=da(a,r,f),p=Q(a,f),v=C(a,f),u=B(a,f,n);k("viewport");k(l("scissor.box"));var x=0<Object.keys(v).length,r={framebuffer:r,draw:p,shader:u,state:v,dirty:x,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};r.profile=w(a,f);r.uniforms=R(c,f);r.drawVAO=r.scopeVAO=I(a,f);if(!r.drawVAO&&u.program&&!n&&g.angle_instanced_arrays){var t=!0;a=u.program.attributes.map(function(a){a=b["static"][a];t=t&&!!a;return a});if(t&&0<a.length){var H=q.getVAO(q.createVAO(a));r.drawVAO=
new la(null,null,null,function(a,b){return a.link(H)});r.useVAO=!0}}n?r.useVAO=!0:r.attributes=E(b,f);r.context=A(e,f);return r}function G(a,b,c){var d=a.shared.context,e=a.scope();Object.keys(c).forEach(function(f){b.save(d,"."+f);e(d,".",f,"=",c[f].append(a,b),";")});b(e)}function P(a,b,c,d){var e=a.shared,f=e.gl,g=e.framebuffer,k;Y&&(k=b.def(e.extensions,".webgl_draw_buffers"));var h=a.constants,e=h.drawBuffer,h=h.backBuffer;a=c?c.append(a,b):b.def(g,".next");d||b("if(",a,"!==",g,".cur){");b("if(",
a,"){",f,".bindFramebuffer(",36160,",",a,".framebuffer);");Y&&b(k,".drawBuffersWEBGL(",e,"[",a,".colorAttachments.length]);");b("}else{",f,".bindFramebuffer(",36160,",null);");Y&&b(k,".drawBuffersWEBGL(",h,");");b("}",g,".cur=",a,";");d||b("}")}function J(a,b,c){var d=a.shared,e=d.gl,f=a.current,g=a.next,k=d.current,h=d.next,m=a.cond(k,".dirty");cb.forEach(function(b){b=l(b);if(!(b in c.state)){var d,V;if(b in g){d=g[b];V=f[b];var n=D(Z[b].length,function(a){return m.def(d,"[",a,"]")});m(a.cond(n.map(function(a,
b){return a+"!=="+V+"["+b+"]"}).join("||")).then(e,".",Ia[b],"(",n,");",n.map(function(a,b){return V+"["+b+"]="+a}).join(";"),";"))}else d=m.def(h,".",b),n=a.cond(d,"!==",k,".",b),m(n),b in Ha?n(a.cond(d).then(e,".enable(",Ha[b],");")["else"](e,".disable(",Ha[b],");"),k,".",b,"=",d,";"):n(e,".",Ia[b],"(",d,");",k,".",b,"=",d,";")}});0===Object.keys(c.state).length&&m(k,".dirty=false;");b(m)}function ja(a,b,c,d){var e=a.shared,f=a.current,g=e.current,k=e.gl;Tb(Object.keys(c)).forEach(function(e){var h=
c[e];if(!d||d(h)){var l=h.append(a,b);if(Ha[e]){var m=Ha[e];Ja(h)?l?b(k,".enable(",m,");"):b(k,".disable(",m,");"):b(a.cond(l).then(k,".enable(",m,");")["else"](k,".disable(",m,");"));b(g,".",e,"=",l,";")}else if(N(l)){var n=f[e];b(k,".",Ia[e],"(",l,");",l.map(function(a,b){return n+"["+b+"]="+a}).join(";"),";")}else b(k,".",Ia[e],"(",l,");",g,".",e,"=",l,";")}})}function ca(a,b){Da&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function U(a,b,c,d,e){function f(){return"undefined"===
typeof performance?"Date.now()":"performance.now()"}function g(a){q=b.def();a(q,"=",f(),";");"string"===typeof e?a(m,".count+=",e,";"):a(m,".count++;");v&&(d?(p=b.def(),a(p,"=",r,".getNumPendingQueries();")):a(r,".beginQuery(",m,");"))}function k(a){a(m,".cpuTime+=",f(),"-",q,";");v&&(d?a(r,".pushScopeStats(",p,",",r,".getNumPendingQueries(),",m,");"):a(r,".endQuery();"))}function h(a){var c=b.def(n,".profile");b(n,".profile=",a,";");b.exit(n,".profile=",c,";")}var l=a.shared,m=a.stats,n=l.current,
r=l.timer;c=c.profile;var q,p;if(c){if(Ja(c)){c.enable?(g(b),k(b.exit),h("true")):h("false");return}c=c.append(a,b);h(c)}else c=b.def(n,".profile");l=a.block();g(l);b("if(",c,"){",l,"}");a=a.block();k(a);b.exit("if(",c,"){",a,"}")}function ia(a,b,c,e,f){function g(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function k(c,d,e){function f(){b("if(!",n,".buffer){",l,".enableVertexAttribArray(",
m,");}");var c=e.type,g;g=e.size?b.def(e.size,"||",d):d;b("if(",n,".type!==",c,"||",n,".size!==",g,"||",ea.map(function(a){return n+"."+a+"!=="+e[a]}).join("||"),"){",l,".bindBuffer(",34962,",",r,".buffer);",l,".vertexAttribPointer(",[m,g,c,e.normalized,e.stride,e.offset],");",n,".type=",c,";",n,".size=",g,";",ea.map(function(a){return n+"."+a+"="+e[a]+";"}).join(""),"}");Da&&(c=e.divisor,b("if(",n,".divisor!==",c,"){",a.instancing,".vertexAttribDivisorANGLE(",[m,c],");",n,".divisor=",c,";}"))}function g(){b("if(",
n,".buffer){",l,".disableVertexAttribArray(",m,");",n,".buffer=null;","}if(",Za.map(function(a,b){return n+"."+a+"!=="+q[b]}).join("||"),"){",l,".vertexAttrib4f(",m,",",q,");",Za.map(function(a,b){return n+"."+a+"="+q[b]+";"}).join(""),"}")}var l=h.gl,m=b.def(c,".location"),n=b.def(h.attributes,"[",m,"]");c=e.state;var r=e.buffer,q=[e.x,e.y,e.z,e.w],ea=["buffer","normalized","offset","stride"];1===c?f():2===c?g():(b("if(",c,"===",1,"){"),f(),b("}else{"),g(),b("}"))}var h=a.shared;e.forEach(function(e){var h=
e.name,l=c.attributes[h],m;if(l){if(!f(l))return;m=l.append(a,b)}else{if(!f(Wb))return;var n=a.scopeAttrib(h);d.optional(function(){a.assert(b,n+".state","missing attribute "+h)});m={};Object.keys(new ba).forEach(function(a){m[a]=b.def(n,".",a)})}k(a.link(e),g(e.info.type),m)})}function X(a,c,e,f,g){for(var k=a.shared,h=k.gl,l,m=0;m<f.length;++m){var n=f[m],r=n.name,q=n.info.type,p=e.uniforms[r],n=a.link(n)+".location",v;if(p){if(!g(p))continue;if(Ja(p)){var u=p.value;d.command(null!==u&&"undefined"!==
typeof u,'missing uniform "'+r+'"',a.commandStr);if(35678===q||35680===q)d.command("function"===typeof u&&(35678===q&&("texture2d"===u._reglType||"framebuffer"===u._reglType)||35680===q&&("textureCube"===u._reglType||"framebufferCube"===u._reglType)),"invalid texture for uniform "+r,a.commandStr),p=a.link(u._texture||u.color[0]._texture),c(h,".uniform1i(",n,",",p+".bind());"),c.exit(p,".unbind();");else if(35674===q||35675===q||35676===q){d.optional(function(){d.command(N(u),"invalid matrix for uniform "+
r,a.commandStr);d.command(35674===q&&4===u.length||35675===q&&9===u.length||35676===q&&16===u.length,"invalid length for matrix uniform "+r,a.commandStr)});var p=a.global.def("new Float32Array(["+Array.prototype.slice.call(u)+"])"),x=2;35675===q?x=3:35676===q&&(x=4);c(h,".uniformMatrix",x,"fv(",n,",false,",p,");")}else{switch(q){case 5126:d.commandType(u,"number","uniform "+r,a.commandStr);l="1f";break;case 35664:d.command(N(u)&&2===u.length,"uniform "+r,a.commandStr);l="2f";break;case 35665:d.command(N(u)&&
3===u.length,"uniform "+r,a.commandStr);l="3f";break;case 35666:d.command(N(u)&&4===u.length,"uniform "+r,a.commandStr);l="4f";break;case 35670:d.commandType(u,"boolean","uniform "+r,a.commandStr);l="1i";break;case 5124:d.commandType(u,"number","uniform "+r,a.commandStr);l="1i";break;case 35671:d.command(N(u)&&2===u.length,"uniform "+r,a.commandStr);l="2i";break;case 35667:d.command(N(u)&&2===u.length,"uniform "+r,a.commandStr);l="2i";break;case 35672:d.command(N(u)&&3===u.length,"uniform "+r,a.commandStr);
l="3i";break;case 35668:d.command(N(u)&&3===u.length,"uniform "+r,a.commandStr);l="3i";break;case 35673:d.command(N(u)&&4===u.length,"uniform "+r,a.commandStr);l="4i";break;case 35669:d.command(N(u)&&4===u.length,"uniform "+r,a.commandStr),l="4i"}c(h,".uniform",l,"(",n,",",N(u)?Array.prototype.slice.call(u):u,");")}continue}else v=p.append(a,c)}else{if(!g(Wb))continue;v=c.def(k.uniforms,"[",b.id(r),"]")}35678===q?c("if(",v,"&&",v,'._reglType==="framebuffer"){',v,"=",v,".color[0];","}"):35680===q&&
c("if(",v,"&&",v,'._reglType==="framebufferCube"){',v,"=",v,".color[0];","}");d.optional(function(){function b(d,e){a.assert(c,d,'bad data or missing for uniform "'+r+'".  '+e)}function d(a){b("typeof "+v+'==="'+a+'"',"invalid type, expected "+a)}function e(c,d){b(k.isArrayLike+"("+v+")&&"+v+".length==="+c,"invalid vector, should have length "+c,a.commandStr)}function f(c){b("typeof "+v+'==="function"&&'+v+'._reglType==="texture'+(3553===c?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(q){case 5124:d("number");
break;case 35667:e(2,"number");break;case 35668:e(3,"number");break;case 35669:e(4,"number");break;case 5126:d("number");break;case 35664:e(2,"number");break;case 35665:e(3,"number");break;case 35666:e(4,"number");break;case 35670:d("boolean");break;case 35671:e(2,"boolean");break;case 35672:e(3,"boolean");break;case 35673:e(4,"boolean");break;case 35674:e(4,"number");break;case 35675:e(9,"number");break;case 35676:e(16,"number");break;case 35678:f(3553);break;case 35680:f(34067)}});p=1;switch(q){case 35678:case 35680:p=
c.def(v,"._texture");c(h,".uniform1i(",n,",",p,".bind());");c.exit(p,".unbind();");continue;case 5124:case 35670:l="1i";break;case 35667:case 35671:l="2i";p=2;break;case 35668:case 35672:l="3i";p=3;break;case 35669:case 35673:l="4i";p=4;break;case 5126:l="1f";break;case 35664:l="2f";p=2;break;case 35665:l="3f";p=3;break;case 35666:l="4f";p=4;break;case 35674:l="Matrix2fv";break;case 35675:l="Matrix3fv";break;case 35676:l="Matrix4fv"}c(h,".uniform",l,"(",n,",");if("M"===l.charAt(0)){var n=Math.pow(q-
35674+2,2),t=a.global.def("new Float32Array(",n,")");c("false,(Array.isArray(",v,")||",v," instanceof Float32Array)?",v,":(",D(n,function(a){return t+"["+a+"]="+v+"["+a+"]"}),",",t,")")}else 1<p?c(D(p,function(a){return v+"["+a+"]"})):c(v);c(");")}}function aa(a,b,c,e){function f(d){var g=n[d];return g?g.contextDep&&e.contextDynamic||g.propDep?g.append(a,c):g.append(a,b):b.def(m,".",d)}function g(){function a(){c(x,".drawElementsInstancedANGLE(",[q,p,t,u+"<<(("+t+"-5121)>>1)",v],");")}function b(){c(x,
".drawArraysInstancedANGLE(",[q,u,p,v],");")}r?H?a():(c("if(",r,"){"),a(),c("}else{"),b(),c("}")):b()}function k(){function a(){c(l+".drawElements("+[q,p,t,u+"<<(("+t+"-5121)>>1)"]+");")}function b(){c(l+".drawArrays("+[q,u,p]+");")}r?H?a():(c("if(",r,"){"),a(),c("}else{"),b(),c("}")):b()}var h=a.shared,l=h.gl,m=h.draw,n=e.draw,r=function(){var d=n.elements,f=b;if(d){if(d.contextDep&&e.contextDynamic||d.propDep)f=c;d=d.append(a,f)}else d=f.def(m,".","elements");d&&f("if("+d+")"+l+".bindBuffer(34963,"+
d+".buffer.buffer);");return d}(),q=f("primitive"),u=f("offset"),p=function(){var f=n.count,g,k=b;if(f){if(f.contextDep&&e.contextDynamic||f.propDep)k=c;g=f.append(a,k);d.optional(function(){f.MISSING&&a.assert(b,"false","missing vertex count");f.DYNAMIC&&a.assert(k,g+">=0","missing vertex count")})}else g=k.def(m,".","count"),d.optional(function(){a.assert(k,g+">=0","missing vertex count")});return g}();if("number"===typeof p){if(0===p)return}else c("if(",p,"){"),c.exit("}");var v,x;Da&&(v=f("instances"),
x=a.instancing);var t=r+".type",H=n.elements&&Ja(n.elements);Da&&("number"!==typeof v||0<=v)?"string"===typeof v?(c("if(",v,">0){"),g(),c("}else if(",v,"<0){"),k(),c("}")):g():k()}function K(a,b,c,e,f){var g=M();f=g.proc("body",f);d.optional(function(){g.commandStr=b.commandStr;g.command=g.link(b.commandStr)});Da&&(g.instancing=f.def(g.shared.extensions,".angle_instanced_arrays"));a(g,f,c,e);return g.compile().body}function ta(a,b,c,d){ca(a,b);c.useVAO?c.drawVAO?b(a.shared.vao,".setVAO(",c.drawVAO.append(a,
b),");"):b(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(b(a.shared.vao,".setVAO(null);"),ia(a,b,c,d.attributes,function(){return!0}));X(a,b,c,d.uniforms,function(){return!0});aa(a,b,b,c)}function ya(a,b){var c=a.proc("draw",1);ca(a,c);G(a,c,b.context);P(a,c,b.framebuffer);J(a,c,b);ja(a,c,b.state);U(a,c,b,!1,!0);var d=b.shader.progVar.append(a,c);c(a.shared.gl,".useProgram(",d,".program);");if(b.shader.program)ta(a,c,b,b.shader.program);else{c(a.shared.vao,".setVAO(null);");var e=a.global.def("{}"),
f=c.def(d,".id"),g=c.def(e,"[",f,"]");c(a.cond(g).then(g,".call(this,a0);")["else"](g,"=",e,"[",f,"]=",a.link(function(c){return K(ta,a,b,c,1)}),"(",d,");",g,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function pa(a,b,c,d){function e(){return!0}a.batchId="a1";ca(a,b);ia(a,b,c,d.attributes,e);X(a,b,c,d.uniforms,e);aa(a,b,b,c)}function T(a,b,c,d){function e(a){return a.contextDep&&g||a.propDep}function f(a){return!e(a)}ca(a,b);var g=c.contextDep,k=b.def(),h=
b.def();a.shared.props=h;a.batchId=k;var l=a.scope(),m=a.scope();b(l.entry,"for(",k,"=0;",k,"<","a1",";++",k,"){",h,"=","a0","[",k,"];",m,"}",l.exit);c.needsContext&&G(a,m,c.context);c.needsFramebuffer&&P(a,m,c.framebuffer);ja(a,m,c.state,e);c.profile&&e(c.profile)&&U(a,m,c,!1,!0);d?(c.useVAO?c.drawVAO?e(c.drawVAO)?m(a.shared.vao,".setVAO(",c.drawVAO.append(a,m),");"):l(a.shared.vao,".setVAO(",c.drawVAO.append(a,l),");"):l(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(l(a.shared.vao,".setVAO(null);"),
ia(a,l,c,d.attributes,f),ia(a,m,c,d.attributes,e)),X(a,l,c,d.uniforms,f),X(a,m,c,d.uniforms,e),aa(a,l,m,c)):(b=a.global.def("{}"),d=c.shader.progVar.append(a,m),h=m.def(d,".id"),l=m.def(b,"[",h,"]"),m(a.shared.gl,".useProgram(",d,".program);","if(!",l,"){",l,"=",b,"[",h,"]=",a.link(function(b){return K(pa,a,c,b,2)}),"(",d,");}",l,".call(this,a0[",k,"],",k,");"))}function lb(a,b){function c(a){return a.contextDep&&e||a.propDep}var d=a.proc("batch",2);a.batchId="0";ca(a,d);var e=!1,f=!0;Object.keys(b.context).forEach(function(a){e=
e||b.context[a].propDep});e||(G(a,d,b.context),f=!1);var g=b.framebuffer,k=!1;g?(g.propDep?e=k=!0:g.contextDep&&e&&(k=!0),k||P(a,d,g)):P(a,d,null);b.state.viewport&&b.state.viewport.propDep&&(e=!0);J(a,d,b);ja(a,d,b.state,function(a){return!c(a)});b.profile&&c(b.profile)||U(a,d,b,!1,"a1");b.contextDep=e;b.needsContext=f;b.needsFramebuffer=k;f=b.shader.progVar;if(f.contextDep&&e||f.propDep)T(a,d,b,null);else if(f=f.append(a,d),d(a.shared.gl,".useProgram(",f,".program);"),b.shader.program)T(a,d,b,b.shader.program);
else{d(a.shared.vao,".setVAO(null);");var g=a.global.def("{}"),k=d.def(f,".id"),h=d.def(g,"[",k,"]");d(a.cond(h).then(h,".call(this,a0,a1);")["else"](h,"=",g,"[",k,"]=",a.link(function(c){return K(T,a,b,c,2)}),"(",f,");",h,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}function pb(a,c){function d(b){var g=c.shader[b];g&&e.set(f.shader,"."+b,g.append(a,e))}var e=a.proc("scope",3);a.batchId="a2";var f=a.shared,g=f.current;G(a,e,c.context);c.framebuffer&&c.framebuffer.append(a,
e);Tb(Object.keys(c.state)).forEach(function(b){var d=c.state[b].append(a,e);N(d)?d.forEach(function(c,d){e.set(a.next[b],"["+d+"]",c)}):e.set(f.next,"."+b,d)});U(a,e,c,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(b){var d=c.draw[b];d&&e.set(f.draw,"."+b,""+d.append(a,e))});Object.keys(c.uniforms).forEach(function(d){e.set(f.uniforms,"["+b.id(d)+"]",c.uniforms[d].append(a,e))});Object.keys(c.attributes).forEach(function(b){var d=c.attributes[b].append(a,e),f=a.scopeAttrib(b);
Object.keys(new ba).forEach(function(a){e.set(f,"."+a,d[a])})});c.scopeVAO&&e.set(f.vao,".targetVAO",c.scopeVAO.append(a,e));d("vert");d("frag");0<Object.keys(c.state).length&&(e(g,".dirty=true;"),e.exit(g,".dirty=true;"));e("a1(",a.shared.context,",a0,",a.batchId,");")}function fa(a){if("object"===typeof a&&!N(a)){for(var b=Object.keys(a),c=0;c<b.length;++c)if(sa.isDynamic(a[b[c]]))return!0;return!1}}function db(a,b,c){function d(a,b){g.forEach(function(c){var d=e[c];sa.isDynamic(d)&&(d=a.invoke(b,
d),b(m,".",c,"=",d,";"))})}var e=b["static"][c];if(e&&fa(e)){var f=a.global,g=Object.keys(e),k=!1,h=!1,l=!1,m=a.global.def("{}");g.forEach(function(b){var c=e[b];if(sa.isDynamic(c))"function"===typeof c&&(c=e[b]=sa.unbox(c)),b=ka(c,null),k=k||b.thisDep,l=l||b.propDep,h=h||b.contextDep;else{f(m,".",b,"=");switch(typeof c){case "number":f(c);break;case "string":f('"',c,'"');break;case "object":Array.isArray(c)&&f("[",c.join(),"]");break;default:f(a.link(c))}f(";")}});b.dynamic[c]=new sa.DynamicVariable(4,
{thisDep:k,contextDep:h,propDep:l,ref:m,append:d});delete b["static"][c]}}var ba=q.Record,ga={add:32774,subtract:32778,"reverse subtract":32779};g.ext_blend_minmax&&(ga.min=32775,ga.max=32776);var Da=g.angle_instanced_arrays,Y=g.webgl_draw_buffers,Z={dirty:!0,profile:n.profile},bb={},cb=[],Ha={},Ia={};H("dither",3024);H("blend.enable",3042);x("blend.color","blendColor",[0,0,0,0]);x("blend.equation","blendEquationSeparate",[32774,32774]);x("blend.func","blendFuncSeparate",[1,0,1,0]);H("depth.enable",
2929,!0);x("depth.func","depthFunc",513);x("depth.range","depthRange",[0,1]);x("depth.mask","depthMask",!0);x("colorMask","colorMask",[!0,!0,!0,!0]);H("cull.enable",2884);x("cull.face","cullFace",1029);x("frontFace","frontFace",2305);x("lineWidth","lineWidth",1);H("polygonOffset.enable",32823);x("polygonOffset.offset","polygonOffset",[0,0]);H("sample.alpha",32926);H("sample.enable",32928);x("sample.coverage","sampleCoverage",[1,!1]);H("stencil.enable",2960);x("stencil.mask","stencilMask",-1);x("stencil.func",
"stencilFunc",[519,0,-1]);x("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);x("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);H("scissor.enable",3089);x("scissor.box","scissor",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);x("viewport","viewport",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);var ha={gl:a,context:t,strings:b,next:bb,current:Z,draw:r,elements:k,buffer:e,shader:p,attributes:q.state,vao:q,uniforms:m,framebuffer:f,extensions:g,timer:v,isBufferArgs:ob},
W={primTypes:Sa,compareFuncs:Ya,blendFuncs:za,blendEquations:ga,stencilOps:Ka,glTypes:Ma,orientationType:zb};d.optional(function(){ha.isArrayLike=N});Y&&(W.backBuffer=[1029],W.drawBuffer=D(c.maxDrawbuffers,function(a){return 0===a?[0]:D(a,function(a){return 36064+a})}));var eb=0;return{next:bb,current:Z,procs:function(){var a=M(),b=a.proc("poll"),d=a.proc("refresh"),e=a.block();b(e);d(e);var f=a.shared,k=f.gl,h=f.next,l=f.current;e(l,".dirty=false;");P(a,b);P(a,d,null,!0);var m;Da&&(m=a.link(Da));
g.oes_vertex_array_object&&d(a.link(g.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var n=0;n<c.maxAttributes;++n){var r=d.def(f.attributes,"[",n,"]"),q=a.cond(r,".buffer");q.then(k,".enableVertexAttribArray(",n,");",k,".bindBuffer(",34962,",",r,".buffer.buffer);",k,".vertexAttribPointer(",n,",",r,".size,",r,".type,",r,".normalized,",r,".stride,",r,".offset);")["else"](k,".disableVertexAttribArray(",n,");",k,".vertexAttrib4f(",n,",",r,".x,",r,".y,",r,".z,",r,".w);",r,".buffer=null;");
d(q);Da&&d(m,".vertexAttribDivisorANGLE(",n,",",r,".divisor);")}d(a.shared.vao,".currentVAO=null;",a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);");Object.keys(Ha).forEach(function(c){var f=Ha[c],g=e.def(h,".",c),m=a.block();m("if(",g,"){",k,".enable(",f,")}else{",k,".disable(",f,")}",l,".",c,"=",g,";");d(m);b("if(",g,"!==",l,".",c,"){",m,"}")});Object.keys(Ia).forEach(function(c){var f=Ia[c],g=Z[c],m,n,r=a.block();r(k,".",f,"(");N(g)?(f=g.length,m=a.global.def(h,".",c),n=a.global.def(l,".",c),
r(D(f,function(a){return m+"["+a+"]"}),");",D(f,function(a){return n+"["+a+"]="+m+"["+a+"];"}).join("")),b("if(",D(f,function(a){return m+"["+a+"]!=="+n+"["+a+"]"}).join("||"),"){",r,"}")):(m=e.def(h,".",c),n=e.def(l,".",c),r(m,");",l,".",c,"=",m,";"),b("if(",m,"!==",n,"){",r,"}"));d(r)});return a.compile()}(),compile:function(a,b,c,d,e){var f=M();f.stats=f.link(e);Object.keys(b["static"]).forEach(function(a){db(f,b,a)});pc.forEach(function(b){db(f,a,b)});c=L(a,b,c,d,f);ya(f,c);pb(f,c);lb(f,c);return f.compile()}}}
function Xb(a,b){for(var d=0;d<a.length;++d)if(a[d]===b)return d;return-1}var X=function(a){return a instanceof Uint8Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Float32Array||a instanceof Float64Array||a instanceof Uint8ClampedArray},P=function(a,b){for(var d=Object.keys(b),c=0;c<d.length;++c)a[d[c]]=b[d[c]];return a},Yb="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),
ha={};ha[5120]=ha[5121]=1;ha[5122]=ha[5123]=ha[36193]=ha[33635]=ha[32819]=ha[32820]=2;ha[5124]=ha[5125]=ha[5126]=ha[34042]=4;var d=P(p,{optional:function(a){a()},raise:t,commandRaise:Aa,command:function(a,b,d){a||Aa(b,d||aa())},parameter:function(a,b,d){a in b||t("unknown parameter ("+a+")"+w(d)+". possible values: "+Object.keys(b).join())},commandParameter:function(a,b,d,c){a in b||Aa("unknown parameter ("+a+")"+w(d)+". possible values: "+Object.keys(b).join(),c||aa())},constructor:function(a){Object.keys(a).forEach(function(a){0>
Yb.indexOf(a)&&t('invalid regl constructor argument "'+a+'". must be one of '+Yb)})},type:function(a,b,d){Y(a,b)||t("invalid parameter type"+w(d)+". expected "+b+", got "+typeof a)},commandType:Ba,isTypedArray:function(a,b){X(a)||t("invalid parameter type"+w(b)+". must be a typed array")},nni:function(a,b){0<=a&&(a|0)===a||t("invalid parameter type, ("+a+")"+w(b)+". must be a nonnegative integer")},oneOf:C,shaderError:function(a,b,d,c,e){if(!a.getShaderParameter(b,a.COMPILE_STATUS)){b=a.getShaderInfoLog(b);
a=c===a.FRAGMENT_SHADER?"fragment":"vertex";Ba(d,"string",a+" shader source must be a string",e);var k=wa(d,e);d=Qa(b);La(k,d);Object.keys(k).forEach(function(a){function b(a,c){d.push(a);e.push(c||"")}var c=k[a];if(c.hasErrors){var d=[""],e=[""];b("file number "+a+": "+c.name+"\n","color:red;text-decoration:underline;font-weight:bold");c.lines.forEach(function(a){if(0<a.errors.length){b(z(a.number,4)+"|  ","background-color:yellow; font-weight:bold");b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");
var c=0;a.errors.forEach(function(d){d=d.message;var e=/^\s*'(.*)'\s*:\s*(.*)$/.exec(d);if(e){var g=e[1];d=e[2];switch(g){case "assign":g="="}c=Math.max(a.line.indexOf(g,c),0)}else c=0;b(z("| ",6));b(z("^^^",c+3)+"\n","font-weight:bold");b(z("| ",6));b(d+"\n","font-weight:bold")});b(z("| ",6)+"\n")}else b(z(a.number,4)+"|  "),b(a.line+"\n","color:red")});"undefined"===typeof document||window.chrome?console.log(d.join("")):(e[0]=d.join("%c"),console.log.apply(console,e))}});p.raise("Error compiling "+
a+" shader, "+k[0].name)}},linkError:function(a,b,d,c,e){a.getProgramParameter(b,a.LINK_STATUS)||(a=a.getProgramInfoLog(b),d=wa(d,e),c='Error linking program with vertex shader, "'+wa(c,e)[0].name+'", and fragment shader "'+d[0].name+'"',"undefined"!==typeof document?console.log("%c"+c+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(c+"\n"+a),p.raise(c))},callSite:va,saveCommandRef:Pa,saveDrawInfo:function(a,b,d,c){function e(a){return a?c.id(a):0}function k(a,
b){Object.keys(b).forEach(function(b){a[c.id(b)]=!0})}Pa(a);a._fragId=e(a["static"].frag);a._vertId=e(a["static"].vert);var h=a._uniformSet={};k(h,b["static"]);k(h,b.dynamic);b=a._attributeSet={};k(b,d["static"]);k(b,d.dynamic);a._hasCount="count"in a["static"]||"count"in a.dynamic||"elements"in a["static"]||"elements"in a.dynamic},framebufferFormat:function(a,b,d){a.texture?C(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):C(a.renderbuffer._renderbuffer.format,d,
"unsupported renderbuffer format for attachment")},guessCommand:aa,texture2D:function(a,b,d){var c=b.width,e=b.height,k=b.channels;p(0<c&&c<=d.maxTextureSize&&0<e&&e<=d.maxTextureSize,"invalid texture shape");33071===a.wrapS&&33071===a.wrapT||p(!(c&c-1)&&!!c&&!(e&e-1)&&!!e,"incompatible wrap mode for texture, both width and height must be power of 2");1===b.mipmask?1!==c&&1!==e&&p(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(p(!(c&c-
1)&&!!c&&!(e&e-1)&&!!e,"texture must be a square power of 2 to support mipmapping"),p(b.mipmask===(c<<1)-1,"missing or incomplete mipmap data"));5126===b.type&&(0>d.extensions.indexOf("oes_texture_float_linear")&&p(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),p(!a.genMipmaps,"mipmap generation not supported with float textures"));var h=b.images;for(d=0;16>d;++d)if(h[d]){var f=c>>d,m=e>>d;p(b.mipmask&1<<d,"missing mipmap data");var q=h[d];p(q.width===
f&&q.height===m,"invalid shape for mip images");p(q.format===b.format&&q.internalformat===b.internalformat&&q.type===b.type,"incompatible type for mip image");!q.compressed&&q.data&&(f=Math.ceil($a(q.type,k)*f/q.unpackAlignment)*q.unpackAlignment,p(q.data.byteLength===f*m,"invalid data for image, buffer size is inconsistent with image format"))}else a.genMipmaps||p(0===(b.mipmask&1<<d),"extra mipmap data");b.compressed&&p(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,
b,d,c){var e=a.width,k=a.height,h=a.channels;p(0<e&&e<=c.maxTextureSize&&0<k&&k<=c.maxTextureSize,"invalid texture shape");p(e===k,"cube map must be square");p(33071===b.wrapS&&33071===b.wrapT,"wrap mode not supported by cube map");for(c=0;c<d.length;++c){var f=d[c];p(f.width===e&&f.height===k,"inconsistent cube map face shape");b.genMipmaps&&(p(!f.compressed,"can not generate mipmap for compressed textures"),p(1===f.mipmask,"can not specify mipmaps and generate mipmaps"));for(var m=f.images,q=0;16>
q;++q){var u=m[q];if(u){var r=e>>q,t=k>>q;p(f.mipmask&1<<q,"missing mipmap data");p(u.width===r&&u.height===t,"invalid shape for mip images");p(u.format===a.format&&u.internalformat===a.internalformat&&u.type===a.type,"incompatible type for mip image");u.compressed||u.data&&p(u.data.byteLength===r*t*Math.max($a(u.type,h),u.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}}),$b=0,sa={DynamicVariable:ua,define:function(a,b){return new ua(a,F(b+""))},isDynamic:function(a){return"function"===
typeof a&&!a._reglType||a instanceof ua},unbox:function(a,b){return"function"===typeof a?new ua(0,a):a},accessor:F},Ab={next:"function"===typeof requestAnimationFrame?function(a){return requestAnimationFrame(a)}:function(a){return setTimeout(a,16)},cancel:"function"===typeof cancelAnimationFrame?function(a){return cancelAnimationFrame(a)}:clearTimeout},Zb="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},J=Cb();J.zero=Cb();var qc=function(a,
b){var d=1;b.ext_texture_filter_anisotropic&&(d=a.getParameter(34047));var c=1,e=1;b.webgl_draw_buffers&&(c=a.getParameter(34852),e=a.getParameter(36063));var k=!!b.oes_texture_float;if(k){k=a.createTexture();a.bindTexture(3553,k);a.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var h=a.createFramebuffer();a.bindFramebuffer(36160,h);a.framebufferTexture2D(36160,36064,3553,k,0);a.bindTexture(3553,null);if(36053!==a.checkFramebufferStatus(36160))k=!1;else{a.viewport(0,0,1,1);a.clearColor(1,0,0,1);a.clear(16384);
var f=J.allocType(5126,4);a.readPixels(0,0,1,1,6408,5126,f);a.getError()?k=!1:(a.deleteFramebuffer(h),a.deleteTexture(k),k=1===f[0]);J.freeType(f)}}f=!0;"undefined"!==typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(f=a.createTexture(),h=J.allocType(5121,36),a.activeTexture(33984),a.bindTexture(34067,f),a.texImage2D(34069,0,6408,3,3,0,6408,5121,h),J.freeType(h),a.bindTexture(34067,null),a.deleteTexture(f),f=!a.getError());
return{colorBits:[a.getParameter(3410),a.getParameter(3411),a.getParameter(3412),a.getParameter(3413)],depthBits:a.getParameter(3414),stencilBits:a.getParameter(3415),subpixelBits:a.getParameter(3408),extensions:Object.keys(b).filter(function(a){return!!b[a]}),maxAnisotropic:d,maxDrawbuffers:c,maxColorAttachments:e,pointSizeDims:a.getParameter(33901),lineWidthDims:a.getParameter(33902),maxViewportDims:a.getParameter(3386),maxCombinedTextureUnits:a.getParameter(35661),maxCubeMapSize:a.getParameter(34076),
maxRenderbufferSize:a.getParameter(34024),maxTextureUnits:a.getParameter(34930),maxTextureSize:a.getParameter(3379),maxAttributes:a.getParameter(34921),maxVertexUniforms:a.getParameter(36347),maxVertexTextureUnits:a.getParameter(35660),maxVaryingVectors:a.getParameter(36348),maxFragmentUniforms:a.getParameter(36349),glsl:a.getParameter(35724),renderer:a.getParameter(7937),vendor:a.getParameter(7936),version:a.getParameter(7938),readFloat:k,npotTextureCube:f}},W=function(a){return Object.keys(a).map(function(b){return a[b]})},
kb={shape:function(a){for(var b=[];a.length;a=a[0])b.push(a.length);return b},flatten:function(a,b,d,c){var e=1;if(b.length)for(var k=0;k<b.length;++k)e*=b[k];else e=0;d=c||J.allocType(d,e);switch(b.length){case 0:break;case 1:c=b[0];for(b=0;b<c;++b)d[b]=a[b];break;case 2:c=b[0];b=b[1];for(k=e=0;k<c;++k)for(var h=a[k],f=0;f<b;++f)d[e++]=h[f];break;case 3:Db(a,b[0],b[1],b[2],d,0);break;default:Eb(a,b,0,d,0)}return d}},gb={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,
"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ma={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126},hb={dynamic:35048,stream:35040,"static":35044},qb=kb.flatten,Hb=kb.shape,Ga=[];Ga[5120]=1;Ga[5122]=2;Ga[5124]=4;Ga[5121]=1;Ga[5123]=2;Ga[5125]=4;Ga[5126]=4;var Sa={points:0,point:0,lines:1,line:1,triangles:4,
triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Jb=new Float32Array(1),cc=new Uint32Array(Jb.buffer),Sb=function(a){return!(a&a-1)&&!!a},fc=[9984,9986,9985,9987],jb=[0,6409,6410,6407,6408],na={};na[6409]=na[6406]=na[6402]=1;na[34041]=na[6410]=2;na[6407]=na[35904]=3;na[6408]=na[35906]=4;var ub=Ta("HTMLCanvasElement"),vb=Ta("OffscreenCanvas"),Ob=Ta("CanvasRenderingContext2D"),Pb=Ta("ImageBitmap"),Qb=Ta("HTMLImageElement"),Rb=Ta("HTMLVideoElement"),dc=Object.keys(gb).concat([ub,
vb,Ob,Pb,Qb,Rb]),Ua=[];Ua[5121]=1;Ua[5126]=4;Ua[36193]=2;Ua[5123]=2;Ua[5125]=4;var L=[];L[32854]=2;L[32855]=2;L[36194]=2;L[34041]=4;L[33776]=.5;L[33777]=.5;L[33778]=1;L[33779]=1;L[35986]=.5;L[35987]=1;L[34798]=1;L[35840]=.5;L[35841]=.25;L[35842]=.5;L[35843]=.25;L[36196]=.5;var qa=[];qa[32854]=2;qa[32855]=2;qa[36194]=2;qa[33189]=2;qa[36168]=1;qa[34041]=4;qa[35907]=4;qa[34836]=16;qa[34842]=8;qa[34843]=6;var rc=function(a,b,g,c,e){function k(a){this.id=q++;this.refCount=1;this.renderbuffer=a;this.format=
32854;this.height=this.width=0;e.profile&&(this.stats={size:0})}function h(b){var e=b.renderbuffer;d(e,"must not double destroy renderbuffer");a.bindRenderbuffer(36161,null);a.deleteRenderbuffer(e);b.renderbuffer=null;b.refCount=0;delete p[b.id];c.renderbufferCount--}var f={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};b.ext_srgb&&(f.srgba=35907);b.ext_color_buffer_half_float&&(f.rgba16f=34842,f.rgb16f=34843);b.webgl_color_buffer_float&&(f.rgba32f=34836);
var m=[];Object.keys(f).forEach(function(a){m[f[a]]=a});var q=0,p={};k.prototype.decRef=function(){0>=--this.refCount&&h(this)};e.profile&&(c.getTotalRenderbufferSize=function(){var a=0;Object.keys(p).forEach(function(b){a+=p[b].stats.size});return a});return{create:function(b,h){function q(b,c){var k=0,h=0,r=32854;"object"===typeof b&&b?("shape"in b?(h=b.shape,d(Array.isArray(h)&&2<=h.length,"invalid renderbuffer shape"),k=h[0]|0,h=h[1]|0):("radius"in b&&(k=h=b.radius|0),"width"in b&&(k=b.width|
0),"height"in b&&(h=b.height|0)),"format"in b&&(d.parameter(b.format,f,"invalid renderbuffer format"),r=f[b.format])):"number"===typeof b?(k=b|0,h="number"===typeof c?c|0:k):b?d.raise("invalid arguments to renderbuffer constructor"):k=h=1;d(0<k&&0<h&&k<=g.maxRenderbufferSize&&h<=g.maxRenderbufferSize,"invalid renderbuffer size");if(k!==n.width||h!==n.height||r!==n.format)return q.width=n.width=k,q.height=n.height=h,n.format=r,a.bindRenderbuffer(36161,n.renderbuffer),a.renderbufferStorage(36161,r,
k,h),d(0===a.getError(),"invalid render buffer format"),e.profile&&(n.stats.size=qa[n.format]*n.width*n.height),q.format=m[n.format],q}var n=new k(a.createRenderbuffer());p[n.id]=n;c.renderbufferCount++;q(b,h);q.resize=function(b,c){var f=b|0,k=c|0||f;if(f===n.width&&k===n.height)return q;d(0<f&&0<k&&f<=g.maxRenderbufferSize&&k<=g.maxRenderbufferSize,"invalid renderbuffer size");q.width=n.width=f;q.height=n.height=k;a.bindRenderbuffer(36161,n.renderbuffer);a.renderbufferStorage(36161,n.format,f,k);
d(0===a.getError(),"invalid render buffer format");e.profile&&(n.stats.size=qa[n.format]*n.width*n.height);return q};q._reglType="renderbuffer";q._renderbuffer=n;e.profile&&(q.stats=n.stats);q.destroy=function(){n.decRef()};return q},clear:function(){W(p).forEach(h)},restore:function(){W(p).forEach(function(b){b.renderbuffer=a.createRenderbuffer();a.bindRenderbuffer(36161,b.renderbuffer);a.renderbufferStorage(36161,b.format,b.width,b.height)});a.bindRenderbuffer(36161,null)}}},ic=[6407,6408],xb=[];
xb[6408]=4;xb[6407]=3;var nb=[];nb[5121]=1;nb[5126]=4;nb[36193]=2;var jc=[32854,32855,36194,35907,34842,34843,34836],hc={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},Za=["x","y","z","w"],pc="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),za={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,
"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Ub="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
Ya={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ka={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Vb={frag:35632,vert:35633},zb={cw:2304,ccw:2305},Wb=new la(!1,!1,!1,function(){}),sc=function(a,b){function d(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function c(a,b,c){var e=
h.pop()||new d;e.startQueryIndex=a;e.endQueryIndex=b;e.sum=0;e.stats=c;f.push(e)}if(!b.ext_disjoint_timer_query)return null;var e=[],k=[],h=[],f=[],m=[],q=[];return{beginQuery:function(a){var d=e.pop()||b.ext_disjoint_timer_query.createQueryEXT();b.ext_disjoint_timer_query.beginQueryEXT(35007,d);k.push(d);c(k.length-1,k.length,a)},endQuery:function(){b.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:c,update:function(){var a,c;a=k.length;if(0!==a){q.length=Math.max(q.length,a+1);m.length=
Math.max(m.length,a+1);m[0]=0;var d=q[0]=0;for(c=a=0;c<k.length;++c){var g=k[c];b.ext_disjoint_timer_query.getQueryObjectEXT(g,34919)?(d+=b.ext_disjoint_timer_query.getQueryObjectEXT(g,34918),e.push(g)):k[a++]=g;m[c+1]=d;q[c+1]=a}k.length=a;for(c=a=0;c<f.length;++c){var d=f[c],n=d.startQueryIndex,g=d.endQueryIndex;d.sum+=m[g]-m[n];n=q[n];g=q[g];g===n?(d.stats.gpuTime+=d.sum/1E6,h.push(d)):(d.startQueryIndex=n,d.endQueryIndex=g,f[a++]=d)}f.length=a}},getNumPendingQueries:function(){return k.length},
clear:function(){e.push.apply(e,k);for(var a=0;a<e.length;a++)b.ext_disjoint_timer_query.deleteQueryEXT(e[a]);k.length=0;e.length=0},restore:function(){k.length=0;e.length=0}}};return function(a){function b(){if(0===U.length)F&&F.update(),W=null;else{W=Ab.next(b);p();for(var a=U.length-1;0<=a;--a){var c=U[a];c&&c(R,null,0)}v.flush();F&&F.update()}}function g(){!W&&0<U.length&&(W=Ab.next(b))}function c(){W&&(Ab.cancel(b),W=null)}function e(a){a.preventDefault();l=!0;c();aa.forEach(function(a){a()})}
function k(a){v.getError();l=!1;H.restore();A.restore();J.restore();O.restore();G.restore();N.restore();L.restore();F&&F.restore();ia.procs.refresh();g();ba.forEach(function(a){a()})}function h(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];sa.isDynamic(e)?d[b]=sa.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;p.length<a;)p.push(null);return p}d(!!a,"invalid args to regl({...})");d.type(a,"object","invalid args to regl({...})");var e=b(a.context||
{}),f=b(a.uniforms||{}),g=b(a.attributes||{}),k=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=P({},a);delete c.uniforms;delete c.attributes;delete c.context;delete c.vao;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");"vao"in a&&(c.vao=a.vao);return c}(a));a={gpuTime:0,cpuTime:0,count:0};
var e=ia.compile(k,g,f,e,a),m=e.draw,n=e.batch,q=e.scope,p=[];return P(function(a,b){var e;l&&d.raise("context lost");if("function"===typeof a)return q.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(e=0;e<a;++e)q.call(this,null,b,e);else if(Array.isArray(a))for(e=0;e<a.length;++e)q.call(this,a[e],b,e);else return q.call(this,a,b,0);else if("number"===typeof a){if(0<a)return n.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return n.call(this,a,a.length)}else return m.call(this,
a)},{stats:a})}function f(a,b){var c=0;ia.procs.poll();var e=b.color;e&&(v.clearColor(+e[0]||0,+e[1]||0,+e[2]||0,+e[3]||0),c|=16384);"depth"in b&&(v.clearDepth(+b.depth),c|=256);"stencil"in b&&(v.clearStencil(b.stencil|0),c|=1024);d(!!c,"called regl.clear with no buffer specified");v.clear(c)}function m(a){d.type(a,"function","regl.frame() callback must be a function");U.push(a);g();return{cancel:function(){function b(){var a=Xb(U,b);U[a]=U[U.length-1];--U.length;0>=U.length&&c()}var e=Xb(U,a);d(0<=
e,"cannot cancel a frame twice");U[e]=b}}}function q(){var a=X.viewport,b=X.scissor_box;a[0]=a[1]=b[0]=b[1]=0;R.viewportWidth=R.framebufferWidth=R.drawingBufferWidth=a[2]=b[2]=v.drawingBufferWidth;R.viewportHeight=R.framebufferHeight=R.drawingBufferHeight=a[3]=b[3]=v.drawingBufferHeight}function p(){R.tick+=1;R.time=t();q();ia.procs.poll()}function r(){q();ia.procs.refresh();F&&F.update()}function t(){return(Zb()-B)/1E3}a=db(a);if(!a)return null;var v=a.gl,n=v.getContextAttributes(),l=v.isContextLost(),
H=Q(v,a);if(!H)return null;var x=da(),w={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},z=H.extensions,F=sc(v,z),B=Zb(),D=v.drawingBufferWidth,C=v.drawingBufferHeight,R={tick:0,time:0,viewportWidth:D,viewportHeight:C,framebufferWidth:D,framebufferHeight:C,drawingBufferWidth:D,drawingBufferHeight:C,pixelRatio:a.pixelRatio},E=qc(v,z),J=ac(v,w,a,function(a){return L.destroyBuffer(a)}),L=kc(v,z,E,w,J),I=bc(v,
z,J,w),A=lc(v,x,w,a),O=ec(v,z,E,function(){ia.procs.poll()},R,w,a),G=rc(v,z,E,w,a),N=gc(v,z,E,O,G,w),ia=oc(v,x,z,E,J,I,O,N,{},L,A,{elements:null,primitive:4,count:-1,offset:0,instances:-1},R,F,a),x=mc(v,N,ia.procs.poll,R,n,z,E),X=ia.next,ca=v.canvas,U=[],aa=[],ba=[],K=[a.onDestroy],W=null;ca&&(ca.addEventListener("webglcontextlost",e,!1),ca.addEventListener("webglcontextrestored",k,!1));var Y=N.setFBO=h({framebuffer:sa.define.call(null,1,"framebuffer")});r();n=P(h,{clear:function(a){d("object"===
typeof a&&a,"regl.clear() takes an object as input");if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)Y(P({framebuffer:a.framebuffer.faces[b]},a),f);else Y(a,f);else f(null,a)},prop:sa.define.bind(null,1),context:sa.define.bind(null,2),"this":sa.define.bind(null,3),draw:h({}),buffer:function(a){return J.create(a,34962,!1,!1)},elements:function(a){return I.create(a,!1)},texture:O.create2D,cube:O.createCube,renderbuffer:G.create,framebuffer:N.create,
framebufferCube:N.createCube,vao:L.createVAO,attributes:n,frame:m,on:function(a,b){d.type(b,"function","listener callback must be a function");var c;switch(a){case "frame":return m(b);case "lost":c=aa;break;case "restore":c=ba;break;case "destroy":c=K;break;default:d.raise("invalid event, must be one of frame,lost,restore,destroy")}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:E,hasExtension:function(a){return 0<=E.extensions.indexOf(a.toLowerCase())},
read:x,destroy:function(){U.length=0;c();ca&&(ca.removeEventListener("webglcontextlost",e),ca.removeEventListener("webglcontextrestored",k));A.clear();N.clear();G.clear();O.clear();I.clear();J.clear();L.clear();F&&F.clear();K.forEach(function(a){a()})},_gl:v,_refresh:r,poll:function(){p();F&&F.update()},now:t,stats:w});a.onDone(null,n);return n}})},{}],5:[function(fa,t,K){function h(h){throw Error("resl: "+h);}function E(p,t,w){Object.keys(p).forEach(function(p){0>t.indexOf(p)&&h('invalid parameter "'+
p+'" in '+w)})}function p(h,p){this.state=0;this.ready=!1;this.progress=0;this.name=h;this.cancel=p}var w=["manifest","onDone","onProgress","onError"],Y=["type","src","stream","credentials","parser"],C=["onData","onDone"];t.exports=function(t){function K(p,w){if(p in t){var da=t[p];"function"!==typeof da&&h('invalid callback "'+p+'"');return da}return null}function fa(h){function t(){if(!(2>B.readyState||1===Q.state||-1===Q.state)){if(200!==B.status)return aa('error loading resource "'+h.name+'"');
if(2<B.readyState&&0===Q.state){var p;p="binary"===h.type?B.response:B.responseText;if(E.data)try{C=E.data(p)}catch(F){return aa(F)}else C=p}if(3<B.readyState&&0===Q.state){if(E.done)try{C=E.done()}catch(F){return aa(F)}Q.state=1}Aa[w]=C;Q.progress=.75*Q.progress+.25;Q.ready=h.stream&&!!C||1===Q.state;va()}}var w=h.name,z=h.stream,R="binary"===h.type,E=h.parser,B=new XMLHttpRequest,C=null,Q=new p(w,function(){1!==Q.state&&-1!==Q.state&&(B.onreadystatechange=null,B.abort(),Q.state=-1)});B.onreadystatechange=
z?t:function(){4===B.readyState&&t()};R&&(B.responseType="arraybuffer");h.credentials&&(B.withCredentials=!0);B.open("GET",h.src,!0);B.send();return Q}function ab(h,t){function w(){if(0===D.state)if(Q.data)try{K=Q.data(t)}catch(h){return aa(h)}else K=t}function z(h){w();Aa[C]=K;D.progress=h.lengthComputable?Math.max(D.progress,h.loaded/h.total):.75*D.progress+.25;va(C)}function R(){w();if(0===D.state){if(Q.done)try{K=Q.done()}catch(h){return aa(h)}D.state=1}D.progress=1;D.ready=!0;Aa[C]=K;B();va("finish "+
C)}function E(){aa('error loading asset "'+C+'"')}function B(){h.stream&&t.removeEventListener("progress",z);"image"===h.type?t.addEventListener("load",R):t.addEventListener("canplay",R);t.removeEventListener("error",E)}var C=h.name,Q=h.parser,D=new p(C,function(){1!==D.state&&-1!==D.state&&(D.state=-1,B(),t.src="")}),K=t;h.stream&&t.addEventListener("progress",z);if("image"===h.type)t.addEventListener("load",R);else{var Y=!1,ba=!1;t.addEventListener("loadedmetadata",function(){ba=!0;Y&&R()});t.addEventListener("canplay",
function(){Y=!0;ba&&R()})}t.addEventListener("error",E);t.crossOrigin=h.credentials?"use-credentials":"anonymous";t.src=h.src;return D}function aa(h){-1!==Ba&&1!==Ba&&(Ba=-1,ua.forEach(function(h){h.cancel()}),Pa?"string"===typeof h?Pa(Error("resl: "+h)):Pa(h):console.error("resl error:",h))}function va(h){if(-1!==Ba&&1!==Ba){var p=0,t=0;ua.forEach(function(h){h.ready&&(t+=1);p+=h.progress});t===ua.length?(Ba=1,Qa(Aa)):La&&La(p/ua.length,h)}}"object"===typeof t&&t||h("invalid or missing configuration");
E(t,w,"config");var wa=t.manifest;"object"===typeof wa&&wa||h("missing manifest");var Qa=K("onDone");Qa||h("missing onDone() callback");var La=K("onProgress"),Pa=K("onError"),Aa={},Ba=0,$a={text:fa,binary:function(h){return fa(h)},image:function(h){return ab(h,document.createElement("img"))},video:function(h){return ab(h,document.createElement("video"))},audio:function(h){return ab(h,document.createElement("audio"))}},ua=Object.keys(wa).map(function(p){function t(p,z){if(p in w.parser){var B=w.parser[p];
"function"!==typeof B&&h("invalid parser callback "+p+' for asset "'+p+'"');return B}return z}var w=wa[p];"string"===typeof w?w={src:w}:"object"===typeof w&&w||h('invalid asset definition "'+p+'"');E(w,Y,'asset "'+p+'"');var z={};"parser"in w&&("function"===typeof w.parser?z={data:w.parser}:"object"===typeof w.parser&&w.parser?(E(z,C,'parser for asset "'+p+'"'),"onData"in z||h('missing onData callback for parser in asset "'+p+'"'),z={data:t("onData"),done:t("onDone")}):h('invalid parser for asset "'+
p+'"'));return{name:p,type:function(t,z,B){t in w&&(B=w[t]);0>z.indexOf(B)&&h("invalid "+t+' "'+B+'" for asset "'+p+'", possible values: '+z);return B}("type",Object.keys($a),"text"),stream:!!w.stream,credentials:!!w.credentials,src:function(t,z,B){t in w?B=w[t]:z&&h("missing "+t+' for asset "'+p+'"');"string"!==typeof B&&h("invalid "+t+' for asset "'+p+'", must be a string');return B}("src",!0,""),parser:z}}).map(function(h){return $a[h.type](h)});0===ua.length&&setTimeout(function(){va("done")},
1)}},{}]},{},[1]);
