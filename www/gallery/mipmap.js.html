<!DOCTYPE html>
      <html>
        <head>
          <title>example/mipmap.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(l,r,k){function f(a,d){if(!r[a]){if(!l[a]){var b="function"==typeof require&&require;if(!d&&b)return b(a,!0);if(m)return m(a,!0);b=Error("Cannot find module '"+a+"'");throw b.code="MODULE_NOT_FOUND",b;}b=r[a]={exports:{}};l[a][0].call(b.exports,function(d){var m=l[a][1][d];return f(m?m:d)},b,b.exports,e$$0,l,r,k)}return r[a].exports}for(var m="function"==typeof require&&require,b=0;b<k.length;b++)f(k[b]);return f})({1:[function(c,l,r){c=c("../regl")();var k=c({frag:"\n  precision mediump float;\n  uniform sampler2D texture;\n  uniform float tick;\n  varying vec2 uv;\n  void main () {\n    mat3 m = mat3(\n      cos(tick), sin(tick), -1.1 + cos(tick),\n      -sin(tick), cos(tick), 0,\n      0, 0, 1);\n    vec3 p = m * vec3(uv, 1);\n    gl_FragColor = texture2D(texture, p.xy / p.z);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main () {\n    uv = position;\n    gl_Position = vec4(1.0 - 2.0 * position, 0, 1);\n  }",attributes:{position:[-2,0,0,-2,2,2]},uniforms:{tick:function(f){return.005*f.count},texture:c.texture({min:"nearest mipmap linear",mag:"nearest",wrap:"repeat",data:[[255,255,255,255,0,0,0,0],[255,255,255,255,0,0,0,0],[255,255,255,255,0,0,0,0],[255,255,255,255,0,0,0,0],[0,0,0,0,255,255,255,255],[0,0,0,0,255,255,255,255],
[0,0,0,0,255,255,255,255],[0,0,0,0,255,255,255,255]]})},count:3});c.frame(function(){k()})},{"../regl":34}],2:[function(c,l,r){function k(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}l.exports=function(f,m,b,a,d){f=b.maxAttributes;m=Array(f);for(b=0;b<f;++b)m[b]=new k;return{Record:k,scope:{},state:m}}},{}],3:[function(c,l,r){function k(a,d){for(var m=0;m<d.length;++m)a[m]=d[m]}var f=c("./util/is-typed-array"),
m=c("./util/is-ndarray"),b=c("./util/values"),a=c("./util/flatten"),d=c("./util/transpose"),t=c("./util/pool"),I=c("./constants/arraytypes.json"),D=c("./constants/dtypes.json"),y=c("./constants/usage.json");l.exports=function(c){function q(a){this.id=p++;this.buffer=c.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121}function u(a,d,m){a.byteLength=d.byteLength;c.bufferData(a.type,d,m)}function g(b,g,p,c,q){b.usage=p;if(Array.isArray(g))b.dtype=c||5126,
0<g.length&&Array.isArray(g[0])?(b.dimension=g[0].length,c=t.allocType(b.dtype,g.length*b.dimension),a(c,g,b.dimension)):(b.dimension=q,c=t.allocType(b.dtype,g.length),k(c,g)),u(b,c,p),t.freeType(c);else if(f(g))b.dtype=c||I[Object.prototype.toString.call(g)]|0,b.dimension=q,u(b,g,p);else if(m(g)){var v=g.shape,w=g.stride;q=g.offset;var N=0,X=0,l=0,H=0;1===v.length?(N=v[0],X=1,l=w[0],H=0):2===v.length&&(N=v[0],X=v[1],l=w[0],H=w[1]);b.dtype=c||I[Object.prototype.toString.call(g.data)]|0||5126;b.dimension=
X;c=t.allocType(b.dtype,N*X);d(c,g.data,N,X,l,H,q);u(b,c,p);t.freeType(c)}}function w(a){var d=a.buffer;c.isBuffer(d)&&c.deleteBuffer(d);a.buffer=null;delete l[a.id]}var p=0,l={};q.prototype.bind=function(){c.bindBuffer(this.type,this.buffer)};var K=[];return{create:function(b,p,u){function K(a){var d=35044,b=null,k=0,p=0,q=1;Array.isArray(a)||f(a)||m(a)?b=a:"number"===typeof a?k=a|0:a&&("data"in a&&(b=a.data),"usage"in a&&(d=y[a.usage]),"type"in a&&(p=D[a.type]),"dimension"in a&&(q=a.dimension|0),
"length"in a&&(k=a.length|0));r.bind();b?g(r,b,d,p,q):(c.bufferData(r.type,k,d),r.dtype=p||5121,r.usage=d,r.dimension=q,r.byteLength=k);return K}var r=new q(p);l[r.id]=r;u||K(b);K._reglType="buffer";K._buffer=r;K.subdata=function(b,g){var p=(g||0)|0;r.bind();if(Array.isArray(b))if(0<b.length&&Array.isArray(b[0])){var q=b[0].length,w=t.allocType(r.dtype,b.length*q);a(w,b,q);c.bufferSubData(r.type,p,w);t.freeType(w)}else q=t.allocType(r.dtype,b.length),k(q,b),c.bufferSubData(r.type,p,q),t.freeType(q);
else if(f(b))c.bufferSubData(r.type,p,b);else if(m(b)){var l=b.shape,u=b.stride,A=w=q=0,G=0;1===l.length?(q=l[0],w=1,A=u[0],G=0):2===l.length&&(q=l[0],w=l[1],A=u[0],G=u[1]);l=Array.isArray(b.data)?r.dtype:I[Object.prototype.toString.call(b.data)]|0;l=t.allocType(l,q*w);d(l,b.data,q,w,A,G,b.offset);c.bufferSubData(r.type,p,l);t.freeType(l)}return K};K.destroy=function(){w(r)};return K},createStream:function(a,b){var d=K.pop();d||(d=new q(a),d.buffer=c.createBuffer());d.bind();g(d,b,35040,0,1);return d},
destroyStream:function(a){K.push(a)},clear:function(){b(l).forEach(w)},getBuffer:function(a){return a&&a._buffer instanceof q?a._buffer:null},_initBuffer:g}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/flatten":22,"./util/is-ndarray":23,"./util/is-typed-array":24,"./util/pool":28,"./util/transpose":31,"./util/values":32}],4:[function(c,l,r){l.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,
"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(c,l,r){l.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],6:[function(c,l,r){l.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(c,l,r){l.exports={"static":35044,dynamic:35048,
stream:35040}},{}],8:[function(c,l,r){function k(a){return Array.isArray(a)||D(a)||y(a)}function f(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function m(a,b,d,m){this.thisDep=a;this.contextDep=b;this.propDep=d;this.append=m}function b(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function a(a){return new m(!1,!1,!1,a)}function d(a,b){var d=a.type;return 0===d?(d=a.data.length,new m(!0,1<=d,2<=d,b)):new m(3===d,2===d,1===d,b)}var t=c("./util/codegen"),I=
c("./util/loop"),D=c("./util/is-typed-array"),y=c("./util/is-ndarray"),z=c("./constants/primitives.json"),q=c("./constants/dtypes.json"),u=["x","y","z","w"],g={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},w={never:512,less:513,
"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},p={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},A={cw:2304,ccw:2305},K=new m(!1,!1,!1,function(){});l.exports=function(c,l,r,y,S,v,ka,N,X,Y,H,Z,J){function R(a){return a.replace(".","_")}function L(a,e,b){var d=R(a);oa.push(a);la[d]=fa[d]=!!b;ga[d]=e}function E(a,e,b){var d=
R(a);oa.push(a);Array.isArray(b)?(fa[d]=b.slice(),la[d]=b.slice()):fa[d]=la[d]=b;ha[d]=e}function B(){var a=t(),e=a.link,b=a.global;a.id=Ba++;a.batchId="0";var d=e(xa),n=a.shared={props:"a0"};Object.keys(xa).forEach(function(h){n[h]=b.def(d,".",h)});var C=a.next={},m=a.current={};Object.keys(ha).forEach(function(h){Array.isArray(fa[h])&&(C[h]=b.def(n.next,".",h),m[h]=b.def(n.current,".",h))});var h=a.constants={};Object.keys(pa).forEach(function(a){h[a]=b.def(JSON.stringify(pa[a]))});a.invoke=function(h,
b){switch(b.type){case 0:var aa=["this",n.context,n.props,a.batchId];return h.def(e(b.data),".call(",aa.slice(0,Math.max(b.data.length+1,4)),")");case 1:return h.def(n.props,b.data);case 2:return h.def(n.context,b.data);case 3:return h.def("this",b.data)}};a.attribCache={};var aa={};a.scopeAttrib=function(h){h=l.id(h);if(h in aa)return aa[h];var a=Y.scope[h];a||(a=Y.scope[h]=new ma);return aa[h]=e(a)};return a}function ba(e){var b=e["static"];e=e.dynamic;if("framebuffer"in b){var n=b.framebuffer;
return n?(n=N.getFramebuffer(n),a(function(a,e){var b=a.link(n),h=a.shared;e.set(h.framebuffer,".next",b);h=h.context;e.set(h,".framebufferWidth",b+".width");e.set(h,".framebufferHeight",b+".height");return b})):a(function(a,e){var b=a.shared;e.set(b.framebuffer,".next","null");b=b.context;e.set(b,".framebufferWidth",b+".drawingBufferWidth");e.set(b,".framebufferHeight",b+".drawingBufferHeight");return null})}if("framebuffer"in e){var m=e.framebuffer;return d(m,function(a,e){var b=a.invoke(e,m),h=
a.shared,aa=h.framebuffer,b=e.def(aa,".getFramebuffer(",b,")");e.set(aa,".next",b);h=h.context;e.set(h,".framebufferWidth",b+"?"+b+".width:"+h+".drawingBufferWidth");e.set(h,".framebufferHeight",b+"?"+b+".height:"+h+".drawingBufferHeight");return b})}return null}function ia(a,e){function b(h){if(h in n){var a=n[h];h=!0;var x=a.x|0,ya=a.y|0,C,f;"w"in a?C=a.w|0:h=!1;"h"in a?f=a.h|0:h=!1;return new m(h&&e&&e.thisDep,h&&e&&e.contextDep,h&&e&&e.propDep,function(h,e){var b=h.shared.context,d=C;"w"in a||
(d=e.def(b,".","framebufferWidth","-",x));var n=f;"h"in a||(n=e.def(b,".","framebufferHeight","-",ya));return[x,ya,d,n]})}if(h in g){var k=g[h];h=d(k,function(h,a){var e=h.invoke(a,k),b=h.shared.context,d=a.def(e,".x|0"),aa=a.def(e,".y|0"),x=a.def('"w" in ',e,"?",e,".w|0:","(",b,".","framebufferWidth","-",d,")"),e=a.def('"h" in ',e,"?",e,".h|0:","(",b,".","framebufferHeight","-",aa,")");return[d,aa,x,e]});e&&(h.thisDep=h.thisDep||e.thisDep,h.contextDep=h.contextDep||e.contextDep,h.propDep=h.propDep||
e.prpoDep);return h}return e?new m(e.thisDep,e.contextDep,e.propDep,function(h,a){var e=h.shared.context;return[0,0,a.def(e,".","framebufferWidth"),a.def(e,".","framebufferHeight")]}):null}var n=a["static"],g=a.dynamic,C=b("viewport");if(C)var f=C,C=new m(C.thisDep,C.contextDep,C.propDep,function(h,a){var e=f.append(h,a),b=h.shared.context;a.set(b,".viewportWidth",e[2]);a.set(b,".viewportHeight",e[3]);return e});return{viewport:C,scissor_box:b("scissor.box")}}function M(e){function n(h){if(h in g){var e=
l.id(g[h]);h=a(function(){return e});h.id=e;return h}if(h in f){var b=f[h];return d(b,function(h,a){var e=h.invoke(a,b);return a.def(h.shared.strings,".id(",e,")")})}return null}var g=e["static"],f=e.dynamic,k=n("frag"),C=n("vert"),c=null;b(k)&&b(C)?(c=H.program(C.id,k.id),e=a(function(h,a){return h.link(c)})):e=new m(k&&k.thisDep||C&&C.thisDep,k&&k.contextDep||C&&C.contextDep,k&&k.propDep||C&&C.propDep,function(h,a){var e=h.shared.shader,b;b=k?k.append(h,a):a.def(e,".","frag");var d;d=C?C.append(h,
a):a.def(e,".","vert");return a.def(e+".program("+d+","+b+")")});return{frag:k,vert:C,progVar:e,program:c}}function F(e){function n(e,h){if(e in g){var b=g[e]|0;return a(function(e,a){h&&(e.OFFSET=b);return b})}if(e in f){var x=f[e];return d(x,function(e,a){var b=e.invoke(a,x);h&&(e.OFFSET=b);return b})}return h&&c?a(function(h,e){h.OFFSET="0";return 0}):null}var g=e["static"],f=e.dynamic,c=function(){if("elements"in g){var e=g.elements;k(e)?e=v.getElements(v.create(e)):e&&(e=v.getElements(e));var h=
a(function(h,a){if(e){var b=h.link(e);return h.ELEMENTS=b}return h.ELEMENTS=null});h.value=e;return h}if("elements"in f){var b=f.elements;return d(b,function(h,e){var a=h.shared,d=a.isBufferArgs,a=a.elements,n=h.invoke(e,b),x=e.def("null"),d=e.def(d,"(",n,")"),n=h.cond(d).then(x,"=",a,".createStream(",n,");")["else"](x,"=",a,".getElements(",n,");");e.entry(n);e.exit(h.cond(d).then(a,".destroyStream(",x,");"));return h.ELEMENTS=x})}return null}(),C=n("offset",!0);return{elements:c,primitive:function(){if("primitive"in
g){var e=g.primitive;return a(function(h,a){return z[e]})}if("primitive"in f){var h=f.primitive;return d(h,function(e,a){var b=e.constants.primTypes,d=e.invoke(a,h);return a.def(b,"[",d,"]")})}return c?b(c)?c.value?a(function(h,e){return e.def(h.ELEMENTS,".primType")}):a(function(){return 4}):new m(c.thisDep,c.contextDep,c.propDep,function(h,e){var a=h.ELEMENTS;return e.def(a,"?",a,".primType:",4)}):null}(),count:function(){if("count"in g){var e=g.count|0;return a(function(){return e})}if("count"in
f){var h=f.count;return d(h,function(e,a){return e.invoke(a,h)})}return c?b(c)?c?C?new m(C.thisDep,C.contextDep,C.propDep,function(h,e){return e.def(h.ELEMENTS,".vertCount-",h.OFFSET)}):a(function(h,e){return e.def(h.ELEMENTS,".vertCount")}):a(function(){return-1}):new m(c.thisDep||C.thisDep,c.contextDep||C.contextDep,c.propDep||C.propDep,function(h,e){var a=h.ELEMENTS;return h.OFFSET?e.def(a,"?",a,".vertCount-",h.OFFSET,":-1"):e.def(a,"?",a,".vertCount:-1")}):null}(),instances:n("instances",!1),
offset:C}}function T(e){var b=e["static"],n=e.dynamic,f={};oa.forEach(function(e){function x(h,g){if(e in b){var k=h(b[e]);f[m]=a(function(){return k})}else if(e in n){var c=n[e];f[m]=d(c,function(h,e){return g(h,e,h.invoke(e,c))})}}var m=R(e);switch(e){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return x(function(h){return h},function(h,e,
a){return a});case "depth.func":return x(function(h){return w[h]},function(h,e,a){return e.def(h.constants.compareFuncs,"[",a,"]")});case "depth.range":return x(function(e){return e},function(e,a,b){e=a.def("+",b,"[0]");a=a.def("+",b,"[1]");return[e,a]});case "blend.func":return x(function(e){return[g["srcRGB"in e?e.srcRGB:e.src],g["dstRGB"in e?e.dstRGB:e.dst],g["srcAlpha"in e?e.srcAlpha:e.src],g["dstAlpha"in e?e.dstAlpha:e.dst]]},function(e,a,b){function d(e,h){var n=a.def('"',e,h,'" in ',b,"?",
b,".",e,h,":",b,".",e);return a.def(x,"[",n,"]")}var x=e.constants.blendFuncs;e=d("src","RGB");var n=d("src","Alpha"),g=d("dst","RGB"),f=d("dst","Alpha");return[e,g,n,f]});case "blend.equation":return x(function(e){if("string"===typeof e)return[ja[e],ja[e]];if("object"===typeof e)return[ja[e.rgb],ja[e.alpha]]},function(e,a,b){var d=e.constants.blendEquations,x=a.def(),n=a.def();e=e.cond("typeof ",b,'==="string"');e.then(x,"=",n,"=",d,"[",b,"];");e["else"](x,"=",d,"[",b,".rgb];",n,"=",d,"[",b,".alpha];");
a(e);return[x,n]});case "blend.color":return x(function(e){return I(4,function(a){return+e[a]})},function(e,a,b){return I(4,function(e){return a.def("+",b,"[",e,"]")})});case "stencil.mask":return x(function(e){return e|0},function(e,a,b){return a.def(b,"|0")});case "stencil.func":return x(function(e){return[w[e.cmp||"keep"],e.ref||0,"mask"in e?e.mask:-1]},function(e,a,b){e=a.def('"cmp" in ',b,"?",e.constants.compareFuncs,"[",b,".cmp]",":",7680);var d=a.def(b,".ref|0");a=a.def('"mask" in ',b,"?",
b,".mask|0:-1");return[e,d,a]});case "stencil.opFront":case "stencil.opBack":return x(function(a){return["stencil.opBack"===e?1029:1028,p[a.fail||"keep"],p[a.zfail||"keep"],p[a.pass||"keep"]]},function(a,b,d){function x(e){return b.def('"',e,'" in ',d,"?",n,"[",d,".",e,"]:",7680)}var n=a.constants.stencilOps;return["stencil.opBack"===e?1029:1028,x("fail"),x("zfail"),x("pass")]});case "polygonOffset.offset":return x(function(e){return[e.factor|0,e.units|0]},function(e,a,b){e=a.def(b,".factor|0");a=
a.def(b,".units|0");return[e,a]});case "cull.face":return x(function(e){var a=0;"front"===e?a=1028:"back"===e&&(a=1029);return a},function(e,a,b){return a.def(b,'==="front"?',1028,":",1029)});case "lineWidth":return x(function(e){return e},function(e,a,b){return b});case "frontFace":return x(function(e){return A[e]},function(e,a,b){return a.def(b+'==="cw"?2304:2305')});case "colorMask":return x(function(e){return e.map(function(e){return!!e})},function(e,a,b){return I(4,function(e){return"!!"+b+"["+
e+"]"})});case "sample.coverage":return x(function(e){return["value"in e?e.value:1,!!e.invert]},function(e,a,b){e=a.def('"value" in ',b,"?+",b,".value:1");a=a.def("!!",b,".invert");return[e,a]})}});return f}function V(e){var b=e["static"],n=e.dynamic,g={};Object.keys(b).forEach(function(e){var d=b[e],x;if("number"===typeof d||"boolean"===typeof d)x=a(function(){return d});else if("function"===typeof d&&"texture"===d._reglType)x=a(function(e){return e.link(d)});else if(Array.isArray(d)||D(d))x=a(function(e){return e.global.def("[",
I(d.length,function(e){return d[e]}),"]")});x.value=d;g[e]=x});Object.keys(n).forEach(function(e){var a=n[e];g[e]=d(a,function(e,b){return e.invoke(b,a)})});return g}function Q(e){var b=e["static"],n=e.dynamic,g={};Object.keys(b).forEach(function(e){var d=b[e],x=l.id(e),h=new ma;if(k(d))h.state=1,h.buffer=S.getBuffer(S.create(d,34962,!1)),h.type=h.buffer.dtype;else{var n=S.getBuffer(d);if(n)h.state=1,h.buffer=n,h.type=n.dtype;else if(d.constant){var f=d.constant;h.state=2;"number"===typeof f?h.x=
f:u.forEach(function(e,a){a<f.length&&(h[e]=f[a])})}else{var n=S.getBuffer(d.buffer),m=d.offset|0,c=d.stride|0,p=d.size|0,Aa=!!d.normalized,U=0;"type"in d&&(U=q[d.type]);d=d.divisor|0;h.buffer=n;h.state=1;h.size=p;h.normalized=Aa;h.type=U||n.dtype;h.offset=m;h.stride=c;h.divisor=d}}g[e]=a(function(e,a){var b=e.attribCache;if(x in b)return b[x];var d={isStream:!1};Object.keys(h).forEach(function(e){d[e]=h[e]});h.buffer&&(d.buffer=e.link(h.buffer));return b[x]=d})});Object.keys(n).forEach(function(e){var a=
n[e];g[e]=d(a,function(e,b){function d(e){b(m[e],"=",n,".",e,"|0;")}var n=e.invoke(b,a),x=e.shared,g=x.isBufferArgs,f=x.buffer,m={isStream:b.def(!1)},k=new ma;k.state=1;Object.keys(k).forEach(function(e){m[e]=b.def(""+k[e])});var c=m.buffer,ta=m.type;b("if(",g,"(",n,")){",m.isStream,"=true;",c,"=",f,".createStream(",34962,",",n,");",ta,"=",c,".dtype;","}else{",c,"=",f,".getBuffer(",n,");","if(",c,"){",ta,"=",c,".dtype;","}else if(",n,".constant){",m.state,"=",2,";",u.map(function(e,a){return m[e]+
"="+n+".length>="+a+"?"+n+"["+a+"]:0;"}).join(""),"}else{",c,"=",f,".getBuffer(",n,".buffer);",ta,'="type" in ',n,"?",x.glTypes,"[",n,".type]:",c,".dtype;",m.normalized,"=!!",n,".normalized;");d("size");d("offset");d("stride");d("divisor");b("}}");return m})});return g}function O(e){var b=e["static"],n=e.dynamic,g={};Object.keys(b).forEach(function(e){var d=b[e];g[e]=a(function(e,a){return"number"===typeof d||"boolean"===typeof d?""+d:e.link(d)})});Object.keys(n).forEach(function(e){var a=n[e];g[e]=
d(a,function(e,b){return e.invoke(b,a)})});return g}function W(e,a,b){var d=e.shared.context,n=e.scope();Object.keys(b).forEach(function(g){a.save(d,"."+g);n(d,".",g,"=",b[g].append(e,a),";")});a(n)}function e(e,a,b){var d=e.shared,n=d.gl,g=d.framebuffer,f;qa&&(f=a.def(d.extensions,".webgl_draw_buffers"));var h=e.constants,d=h.drawBuffers,h=h.backBuffer;e=b?b.append(e,a):a.def(g,".next");a("if(",g,".dirty||",e,"!==",g,".cur){","if(",e,"){",n,".bindFramebuffer(",36160,",",e,".framebuffer);");qa&&a(f,
".drawBuffersWEBGL(",d,"[",e,".colorAttachments.length]);");a("}else{",n,".bindFramebuffer(",36160,",null);");qa&&a(f,".drawBuffersWEBGL(",h,");");a("}",g,".cur=",e,";",g,".dirty=false;","}")}function ca(e,a,b){var d=e.shared,n=d.gl,g=e.current,f=e.next,h=d.current,m=d.next,c=e.cond(h,".dirty");oa.forEach(function(a){a=R(a);if(!(a in b.state)){var d,k;if(a in f){d=f[a];k=g[a];var p=I(fa[a].length,function(e){return c.def(d,"[",e,"]")});c(e.cond(p.map(function(e,a){return e+"==="+k+"["+a+"]"}).join("&&")).then(n,
".",ha[a],"(",p,");",p.map(function(e,a){return k+"["+a+"]="+e}).join(";"),";"))}else d=c.def(m,".",a),p=e.cond(d,"!==",h,".",a),c(p),a in ga?p(e.cond(d).then(n,".enable(",ga[a],");")["else"](n,".disable(",ga[a],");"),h,".",a,"=",d,";"):p(n,".",ha[a],"(",d,");",h,".",a,"=",d,";")}});0===Object.keys(b.state).length&&c(h,".dirty=false;");a(c)}function n(e,a,d,n){var g=e.shared,m=e.current,c=g.current,h=g.gl;f(Object.keys(d)).forEach(function(g){var f=d[g];if(!n||n(f)){var k=f.append(e,a);if(ga[g]){var p=
ga[g];b(f)?k?a(h,".enable(",p,");"):a(h,".disable(",p,");"):a(e.cond(k).then(h,".enable(",p,");")["else"](h,".disable(",p,");"));a(c,".",g,"=",k,";")}else if(Array.isArray(k)){var q=m[g];a(h,".",ha[g],"(",k,");",k.map(function(e,a){return q+"["+a+"]="+e}).join(";"),";")}else a(h,".",ha[g],"(",k,");",c,".",g,"=",k,";")}})}function U(e,a){na&&!e.instancing&&(e.instancing=a.def(e.shared.extensions,".angle_instanced_arrays"))}function ra(e,a,b,d,n){function g(e){switch(e){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function f(b,d,n){function g(){a("if(!",p,".pointer){",k,".enableVertexAttribArray(",c,");",p,".pointer=true;}");var b=n.type,h;h=n.size?a.def(n.size,"||",d):d;a("if(",p,".type!==",b,"||",p,".size!==",h,"||",l.map(function(e){return p+"."+e+"!=="+n[e]}).join("||"),"){",k,".bindBuffer(",34962,",",q,".buffer);",k,".vertexAttribPointer(",[c,h,b,n.normalized,n.stride,n.offset],");",p,".type=",b,";",p,
".size=",h,";",l.map(function(e){return p+"."+e+"="+n[e]+";"}).join(""),"}");na&&(b=n.divisor,a("if(",p,".divisor!==",b,"){",e.instancing,".vertexAttribDivisorANGLE(",[c,b],");",p,".divisor=",b,";}"))}function m(){a("if(",p,".pointer){",k,".disableVertexAttribArray(",c,");",p,".pointer=false;","}if(",u.map(function(e,a){return p+"."+e+"!=="+U[a]}).join("||"),"){",k,".vertexAttrib4f(",c,",",U,");",u.map(function(e,a){return p+"."+e+"="+U[a]+";"}).join(""),"}")}var k=h.gl,c=a.def(b,".location"),p=a.def(h.attributes,
"[",c,"]");b=n.state;var q=n.buffer,U=[n.x,n.y,n.z,n.w],l=["buffer","normalized","offset","stride"];1===b?g():2===b?m():(a("if(",b,"===",1,"){"),g(),a("}else{"),m(),a("}"))}var h=e.shared;d.forEach(function(d){var h=d.name,c=b.attributes[h],k;if(c){if(!n(c))return;k=c.append(e,a)}else{if(!n(K))return;var m=e.scopeAttrib(h);k={};Object.keys(new ma).forEach(function(e){k[e]=a.def(m,".",e)})}f(e.link(d),g(d.info.type),k)})}function sa(e,a,b,d,n){for(var g=e.shared,f=g.gl,h,k=0;k<d.length;++k){var c=
d[k],m=c.name,p=c.info.type,q=b.uniforms[m],c=e.link(c)+".location";if(q){if(!n(q))continue;if(q["static"]){m=q.value;if(35678===p||35680===p)p=e.link(m._texture),a(f,".uniform1i(",c,p+".bind());"),a.exit(p,".unbind()");else if(35674===p||35675===p||35676===p)m=e.global.def("["+m+"]"),q=2,35675===p?q=3:35676===p&&(q=4),a(f,".uniformMatrix",q,"fv(",c,",false,",m,");");else{switch(p){case 5126:h="1f";break;case 35664:h="2f";break;case 35665:h="3f";break;case 35666:h="4f";break;case 35670:h="1i";break;
case 5124:h="1i";break;case 35671:h="2i";break;case 35667:h="2i";break;case 35672:h="3i";break;case 35668:h="3i";break;case 35673:h="4i";break;case 35669:h="4i"}a(f,".uniform",h,"(",c,",",m,");")}continue}else m=q.append(e,a)}else{if(!n(K))continue;m=a.def(g.uniforms,"[",l.id(m),"]")}q=",";switch(p){case 35678:case 35680:p=a.def(m,"._texture");a(f,".uniform1i(",c,",",p,".bind());");a.exit(p,".unbind();");continue;case 5124:case 35670:h="1i";break;case 35667:case 35671:h="2iv";break;case 35668:case 35672:h=
"3iv";break;case 35669:case 35673:h="4iv";break;case 5126:h="1f";break;case 35664:h="2fv";break;case 35665:h="3fv";break;case 35666:h="4fv";break;case 35674:h="Matrix2fv";q=",false,";break;case 35675:h="Matrix3fv";q=",false,";break;case 35676:h="Matrix4fv",q=",false,"}a(f,".uniform",h,"(",c,q,m,");")}}function ua(e,a,d,n){function g(b){var n=p[b];return n?n.batchStatic?n.append(e,a):n.append(e,d):a.def(k,".",b)}function m(){function e(){d(u,".drawElementsInstancedANGLE(",[U,w,t,l+"<<(("+t+"-5121)>>1)",
ca],");")}function a(){d(u,".drawArraysInstancedANGLE(",[U,l,w,ca],");")}q?N?e():(d("if(",q,"){"),e(),d("}else{"),a(),d("}")):a()}function c(){function e(){d(f+".drawElements("+[U,w,t,l+"<<(("+t+"-5121)>>1)"]+");")}function a(){d(f+".drawArrays("+[U,l,w]+");")}q?N?e():(d("if(",q,"){"),e(),d("}else{"),a(),d("}")):a()}var h=e.shared,f=h.gl,k=h.draw,p=n.draw,q=function(){var b=p.elements,n=a;b?(b.batchStatic||(n=d),b=b.append(e,n)):b=n.def(k,".","elements");b&&n("if("+b+")"+f+".bindBuffer(34963,"+b+
".buffer.buffer);");return b}(),U=g("primitive"),l=g("offset"),w=function(){var b=p.count,n=a;b?(b.batchStatic||(n=d),b=b.append(e,n)):b=n.def(k,".","count");return b}();if("number"===typeof w){if(0===w)return}else d("if(",w,"){"),d.exit("}");var ca,u;na&&(ca=g("instances"),u=e.instancing);var t=q+".type",N=p.elements&&b(p.elements);na&&("number"!==typeof ca||0<=ca)?"string"===typeof ca?(d("if(",ca,">0){"),m(),d("}else if(",ca,"<0){"),c(),d("}")):m():c()}function va(e,a,b,d,n){a=B();n=a.proc("body",
n);na&&(a.instancing=n.def(a.shared.extensions,".angle_instanced_arrays"));e(a,n,b,d);return a.compile().body}function za(e,a,b,d){U(e,a);ra(e,a,b,d.attributes,function(){return!0});sa(e,a,b,d.uniforms,function(){return!0});ua(e,a,a,b)}function Ca(a,b){var d=a.proc("draw",1);U(a,d);W(a,d,b.context);e(a,d,b.framebuffer);ca(a,d,b);n(a,d,b.state);var g=b.shader.progVar.append(a,d);d(a.shared.gl,".useProgram(",g,".program);");if(b.shader.program)za(a,d,b,b.shader.program);else{var m=a.global.def("{}"),
c=d.def(g,".id"),f=d.def(m,"[",c,"]");d(a.cond(f).then(f,".call(this,a0);")["else"](f,"=",m,"[",c,"]=",a.link(function(e){return va(za,a,b,e,1)}),"(",g,");",f,".call(this,a0);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}function Da(e,a,b,d){function n(){return!0}e.batchId="a1";U(e,a);ra(e,a,b,d.attributes,n);sa(e,a,b,d.uniforms,n);ua(e,a,a,b)}function wa(a,b,d,g){function f(e){return e.contextDep&&c||e.propDep}function m(e){return!f(e)}U(a,b);var c=d.contextDynamic,h=b.def(),
k=b.def();a.shared.props=k;a.batchId=h;var p=a.scope(),q=a.scope();b(p.entry,"for(",h,"=0;",h,"<","a1",";++",h,"){",k,"=","a0","[",h,"];",q,"}",p.exit);d.needsContext&&W(a,q,d.context);d.needsFramebuffer&&e(a,q,d.framebuffer);n(a,q,d.state,f);g?(ra(a,p,d,g.attributes,m),ra(a,q,d,g.attributes,f),sa(a,p,d,g.uniforms,m),sa(a,q,d,g.uniforms,f),ua(a,p,q,d)):(b=a.global.def("{}"),g=d.shader.progVar.append(a,q),k=q.def(g,".id"),p=q.def(b,"[",k,"]"),q(a.shared.gl,".useProgram(",g,".program);","if(!",p,"){",
p,"=",b,"[",k,"]=",a.link(function(e){return va(Da,a,d,e,2)}),"(",g,");}",p,".call(this,a0[",h,"],",h,");"))}function Ea(a,b){var d=a.proc("batch",2);a.batchId="0";U(a,d);var g=!1,f=!0;Object.keys(b.context).forEach(function(e){g=g||b.context[e].propDep});g||(W(a,d,b.context),f=!1);var m=b.framebuffer,c=!1;m&&(m.propDep?g=c=!0:m.contextDep&&g&&(c=!0),c||e(a,d,m));b.state.viewport&&b.state.viewport.propDynamic&&(g=!0);ca(a,d,b);n(a,d,b.state,function(e){return!(e.contextDep&&g||e.propDep)});b.contextDep=
g;b.needsContext=f;b.needsFramebuffer=c;f=b.shader.progVar;if(f.contextDep&&g||f.propDep)wa(a,d,b,null);else if(f=f.append(a,d),d(a.shared.gl,".useProgram(",f,".program);"),b.shader.program)wa(a,d,b,b.shader.program);else{var m=a.global.def("{}"),c=d.def(f,".id"),h=d.def(m,"[",c,"]");d(a.cond(h).then(h,".call(this,a0,a1);")["else"](h,"=",m,"[",c,"]=",a.link(function(e){return va(wa,a,b,e,2)}),"(",f,");",h,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}function Fa(e,
a){function b(g){var h=a.shader[g];h&&d.set(n.shader,"."+g,h.append(e,d))}var d=e.proc("scope",3);e.batchId="a2";var n=e.shared,g=n.current;W(e,d,a.context);a.framebuffer&&a.framebuffer.append(e,d);f(Object.keys(a.state)).forEach(function(b){var h=a.state[b].append(e,d);Array.isArray(h)?h.forEach(function(a,n){d.set(e.next[b],"["+n+"]",a)}):d.set(n.next,"."+b,h)});["elements","offset","count","instances","primitive"].forEach(function(b){var h=a.draw[b];h&&d.set(n.draw,"."+b,""+h.append(e,d))});Object.keys(a.uniforms).forEach(function(b){d.set(n.uniforms,
"["+l.id(b)+"]",a.uniforms[b].append(e,d))});Object.keys(a.attributes).forEach(function(b){var n=a.attributes[b].append(e,d),g=e.scopeAttrib(b);Object.keys(new ma).forEach(function(e){d.set(g,"."+e,n[e])})});b("vert");b("frag");0<Object.keys(a.state).length&&(d(g,".dirty=true;"),d.exit(g,".dirty=true;"));d("a1(",e.shared.context,",a0,0);")}var ma=Y.Record,ja={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(ja.min=32775,ja.max=32776);var na=r.angle_instanced_arrays,qa=r.webgl_draw_buffers,
fa={dirty:!0},la={},oa=[],ga={},ha={};L("dither",3024);L("blend.enable",3042);E("blend.color","blendColor",[0,0,0,0]);E("blend.equation","blendEquationSeparate",[32774,32774]);E("blend.func","blendFuncSeparate",[1,0,1,0]);L("depth.enable",2929,!0);E("depth.func","depthFunc",513);E("depth.range","depthRange",[0,1]);E("depth.mask","depthMask",!0);E("colorMask","colorMask",[!0,!0,!0,!0]);L("cull.enable",2884);E("cull.face","cullFace",1029);E("frontFace","frontFace",2305);E("lineWidth","lineWidth",1);
L("polygonOffset.enable",32823);E("polygonOffset.offset","polygonOffset",[0,0]);L("sample.alpha",32926);L("sample.enable",32928);E("sample.coverage","sampleCoverage",[1,!1]);L("stencil.enable",2960);E("stencil.mask","stencilMask",-1);E("stencil.func","stencilFunc",[519,0,-1]);E("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);E("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);L("scissor.enable",3089);E("scissor.box","scissor",[0,0,c.drawingBufferWidth,c.drawingBufferHeight]);
E("viewport","viewport",[0,0,c.drawingBufferWidth,c.drawingBufferHeight]);var xa={gl:c,context:J,strings:l,next:la,current:fa,draw:Z,elements:v,buffer:S,shader:H,attributes:Y.state,uniforms:X,framebuffer:N,extensions:r,isBufferArgs:k},pa={primTypes:z,compareFuncs:w,blendFuncs:g,blendEquations:ja,stencilOps:p,glTypes:q,orientationType:A};qa&&(pa.backBuffer=[1029],pa.drawBuffer=I(y.maxDrawbuffers,function(e){return I(e,function(e){return 36064+e})}));var Ba=0;return{next:la,current:fa,procs:function(){var a=
B(),b=a.proc("poll"),d=a.proc("refresh"),n=a.block();b(n);d(n);var g=a.shared,f=g.gl,m=g.next,h=g.current;n(h,".dirty=false;");e(a,b);d(g.framebuffer,".dirty=true;");e(a,d);Object.keys(ga).forEach(function(e){var g=ga[e],c=n.def(m,".",e),k=a.block();k("if(",c,"){",f,".enable(",g,")}else{",f,".disable(",g,")}",h,".",e,"=",c,";");d(k);b("if(",c,"!==",h,".",e,"){",k,"}")});Object.keys(ha).forEach(function(e){var g=ha[e],c=fa[e],k,p,q=a.block();q(f,".",g,"(");Array.isArray(c)?(g=c.length,k=a.global.def(m,
".",e),p=a.global.def(h,".",e),q(I(g,function(e){return k+"["+e+"]"}),");",I(g,function(e){return p+"["+e+"]="+k+"["+e+"];"}).join("")),b("if(",I(g,function(e){return k+"["+e+"]!=="+p+"["+e+"]"}).join("||"),"){",q,"}")):(k=n.def(m,".",e),p=n.def(h,".",e),q(k,");",h,".",e,"=",k,";"),b("if(",k,"!==",p,"){",q,"}"));d(q)});return a.compile()}(),compile:function(e,a,b,d){var n=B(),g;g=ba(e);var f=ia(e,g),h=F(e),c=T(e);e=M(e);var m=f.viewport;m&&(c.viewport=m);m=R("scissor.box");(f=f[m])&&(c[m]=f);f=0<
Object.keys(c).length;g={framebuffer:g,draw:h,shader:e,state:c,dirty:f};g.uniforms=V(b);g.attributes=Q(a);g.context=O(d);Ca(n,g);Fa(n,g);Ea(n,g);return n.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":20,"./util/is-ndarray":23,"./util/is-typed-array":24,"./util/loop":26}],9:[function(c,l,r){function k(a,d){this.id=b++;this.type=a;this.data=d}function f(a){if(0===a.length)return[];var b=a.charAt(0),c=a.charAt(a.length-1);if(1<a.length&&b===c&&('"'===b||
"'"===b))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return f(a.substr(0,b.index)).concat(f(b[1])).concat(f(a.substr(b.index+b[0].length)));b=a.split(".");if(1===b.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(c=0;c<b.length;++c)a=a.concat(f(b[c]));return a}function m(a){return"["+f(a).join("][")+"]"}var b=0;l.exports={define:function(a,b){switch(typeof b){case "boolean":case "number":case "string":return new k(a,
m(b+""));case "undefined":return new k(a|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof k},unbox:function(a,b){if(a instanceof k){if(a.type&128)return new k(a.type&-129,m(b))}else if("function"===typeof a)return new k(0,a);return a},accessor:m}},{}],10:[function(c,l,r){var k=c("./util/is-typed-array"),f=c("./util/is-ndarray"),m=c("./constants/primitives.json"),b=c("./constants/usage.json");l.exports=function(a,d,c){function l(a){this.buffer=a;this.primType=
4;this.type=this.vertCount=0}function r(a,b,g,m,p,l,z){(l=z)||k(b)&&(!f(b)||k(b.data))||(l=d.oes_element_index_uint?5125:5123);a.buffer.bind();c._initBuffer(a.buffer,b,g,l,3);b=z;if(!z){switch(a.buffer.dtype){case 5121:case 5120:b=5121;break;case 5123:case 5122:b=5123;break;case 5125:case 5124:b=5125}a.buffer.dtype=b}a.type=b;0>p&&(p=a.buffer.byteLength,5123===b?p>>=1:5125===b&&(p>>=2));a.vertCount=p;p=m;0>m&&(p=4,m=a.buffer.dimension,1===m&&(p=0),2===m&&(p=1),3===m&&(p=4));a.primType=p}var y={uint8:5121,
uint16:5123};d.oes_element_index_uint&&(y.uint32=5125);l.prototype.bind=function(){this.buffer.bind()};var z=[];return{create:function(d){function u(d){if(d)if("number"===typeof d)g(d),w.primType=4,w.vertCount=d|0,w.type=5121;else{var c=null,q=35044,l=-1,t=-1,z=0,I=0;Array.isArray(d)||k(d)||f(d)?c=d:("data"in d&&(c=d.data),"usage"in d&&(q=b[d.usage]),"primitive"in d&&(l=m[d.primitive]),"count"in d&&(t=d.count|0),"length"in d&&(z=d.length|0),"type"in d&&(I=y[d.type]));c?r(w,c,q,l,t,z,I):(d=w.buffer,
d.bind(),a.bufferData(34963,z,q),d.dtype=I||5121,d.usage=q,d.dimension=3,d.byteLength=z,w.primType=0>l?4:l,w.vertCount=0>t?0:t,w.type=d.dtype)}else g(),w.primType=4,w.vertCount=0,w.type=5121;return u}var g=c.create(null,34963,!0),w=new l(g._buffer);u(d);u._reglType="elements";u._elements=w;u.subdata=function(a,b){g.subdata(a,b);return u};u.destroy=function(){g.destroy();w.buffer=null};return u},createStream:function(a){var b=z.pop();b||(b=new l(c.create(null,34963,!0)._buffer));r(b,a,35040,-1,-1,
0,0);return b},destroyStream:function(a){z.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof l?a._elements:null}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":23,"./util/is-typed-array":24}],11:[function(c,l,r){l.exports=function(c){function f(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(b){try{m[b]=
c.getExtension(b)}catch(a){}})}var m={};f();return{extensions:m,refresh:f}}},{}],12:[function(c,l,r){var k=c("./util/values"),f=c("./util/extend");l.exports=function(c,b,a,d,l){function r(a,b,d,g){this.target=a;this.level=b;this.texture=d;this.renderbuffer=g}function D(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function y(a,b){var d=b.width,g=b.height;if(a.texture)var c=a.texture._texture,f=Math.max(1,c.params.width>>a.level),m=Math.max(1,
c.params.height>>a.level),d=d||f,g=g||m;else c=a.renderbuffer._renderbuffer,d=d||c.width,g=g||c.height;c.refCount+=1;b.width=d;b.height=g}function z(a,b){b?b.texture?c.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):c.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):c.framebufferTexture2D(36160,a,3553,null,0)}function q(a){var b=3553,d=0,g=null,c=null;"object"===typeof a&&("level"in a&&(d=a.level|0),"target"in a&&(b=a.target|0));var f=a._reglType;
"texture"===f?g=a:"renderbuffer"===f&&(c=a,b=36161,d=0);return new r(b,d,g,c)}function u(a){return a&&(a.texture||a.renderbuffer)}function g(){this.id=S++;v[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function w(d){c.isFramebuffer(d.framebuffer)||(d.framebuffer=c.createFramebuffer());A.dirty=!0;c.bindFramebuffer(36160,d.framebuffer);for(var g=
d.colorAttachments,f=0;f<g.length;++f)z(36064+f,g[f]);for(f=g.length;f<a.maxColorAttachments;++f)z(36064+f,null);z(36096,d.depthAttachment);z(36128,d.stencilAttachment);z(33306,d.depthStencilAttachment);b.webgl_draw_buffers&&b.webgl_draw_buffers.drawBuffersWEBGL(da[g.length]);c.checkFramebufferStatus(36160)}function p(a){a=a.framebuffer;c.isFramebuffer(a)&&c.deleteFramebuffer(a)}var A={current:null,next:null,dirty:!1},K={rgba:6408},G={rgba4:32854,rgb565:36194,"rgb5 a1":32855};b.ext_srgb&&(G.srgba=
35907);b.ext_color_buffer_half_float&&(G.rgba16f=34842,G.rgb16f=34843);b.webgl_color_buffer_float&&(G.rgba32f=34836);var P=[],ea=[];b.webgl_depth_texture&&(P.push(6402),ea.push(34041));f(f({},K),G);k(K);k(G);G=5121;P={uint8:5121};b.oes_texture_half_float&&(G=P["half float"]=36193);b.oes_texture_float&&(G=P["float"]=5126);P.best=G;var da=function(){for(var b=Array(a.maxDrawbuffers),d=0;d<=a.maxDrawbuffers;++d)for(var g=b[d]=Array(d),c=0;c<d;++c)g[c]=36064+c;return b}(),S=0,v={};return f(A,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof g)?a:null},create:function(a){function b(a){var g,k=a||{},p=a=0;if("shape"in k){var z=k.shape;a=z[0];p=z[1]}else"radius"in k&&(a=p=k.radius),"width"in k&&(a=k.width),"height"in k&&(p=k.height);var A=null,z=!1;if("colorBuffers"in k||"colorBuffer"in k){A=k.colorBuffers||k.colorBuffer;Array.isArray(A)||(A=[A]);f.width=a;f.height=p;A=A.map(q);for(g=0;g<A.length;++g)y(A[g],f);a=f.width;p=f.height}else{var v=!0,B="rgba",G="uint8",P=1,
z=!0;f.width=a=a||c.drawingBufferWidth;f.height=p=p||c.drawingBufferHeight;"format"in k&&(B=k.format,v=B in K);"type"in k&&(G=k.type);"colorCount"in k&&(P=k.colorCount|0);if(f.ownsColor)for(A=f.colorAttachments;A.length>P;)D(A.pop());else A=[];for(g=0;g<A.length;++g){var M;a:{M=A[g];var F=v,T=B,V=a,Q=p;if(M.texture){var O=M.texture;if(F){O({format:T,type:G,width:V,height:Q});O._texture.refCount+=1;M=!0;break a}}else if(O=M.renderbuffer,!F){O({format:T,width:V,height:Q});O._renderbuffer.refCount+=
1;M=!0;break a}D(M);M=!1}M||(A[g--]=A[A.length-1],A.pop())}for(;A.length<P;)v?A.push(new r(3553,0,d.create({format:B,type:G,width:a,height:p},3553),null)):A.push(new r(36161,0,null,l.create({format:B,width:a,height:p})))}f.width=a;f.height=p;B=v=g=null;G=!1;"depthBuffer"in k&&(g=q(k.depthBuffer));"stencilBuffer"in k&&(v=q(k.stencilBuffer));"depthStencilBuffer"in k&&(B=q(k.depthStencilBuffer));if(g||v||B)y(g||v||B,f);else if(P=!0,F=M=!1,"depth"in k&&(P=!!k.depth),"stencil"in k&&(M=!!k.stencil),"depthTexture"in
k&&(F=!!k.depthTexture),k=f.depthAttachment||f.stencilAttachment||f.depthStencilAttachment,T=null,P||M)G=!0,F?(F=M?"depth stencil":"depth",f.ownsDepthStencil&&k.texture?(k.texture({format:F,width:a,height:p}),k.texture._texture.refCount+=1,T=k):T=new r(3553,0,d.create({format:F,width:a,height:p},3553),null)):(F=P?M?"depth stencil":"depth":"stencil",f.ownsDepthStencil&&k.renderbuffer?(k.renderbuffer({format:F,width:a,height:p}),k.renderbuffer._renderbuffer.refCount+=1,T=k):T=new r(36161,0,null,l.create({format:F,
width:a,height:p}))),P?M?B=T:g=T:v=T;a=f;a.colorAttachments.forEach(D);D(a.depthAttachment);D(a.stencilAttachment);D(a.depthStencilAttachment);f.colorAttachments=A;f.depthAttachment=g;f.stencilAttachment=v;f.depthStencilAttachment=B;f.ownsColor=z;f.ownsDepthStencil=G;b.color=A.map(u);b.depth=u(g);b.stencil=u(v);b.depthStencil=u(B);w(f);b.width=f.width;b.height=f.height;return b}var f=new g;b(a);b._reglType="framebuffer";b._framebuffer=f;b._destroy=function(){p(f)};return b},clear:function(){k(v).forEach(p)},
refresh:function(){k(v).forEach(w)}})}},{"./util/extend":21,"./util/values":32}],13:[function(c,l,r){l.exports=function(c,f){var m=1;f.ext_texture_filter_anisotropic&&(m=c.getParameter(34047));var b=1,a=1;f.webgl_draw_buffers&&(b=c.getParameter(34852),a=c.getParameter(36063));return{colorBits:[c.getParameter(3410),c.getParameter(3411),c.getParameter(3412),c.getParameter(3413)],depthBits:c.getParameter(3414),stencilBits:c.getParameter(3415),subpixelBits:c.getParameter(3408),extensions:Object.keys(f).filter(function(a){return!!f[a]}),
maxAnisotropic:m,maxDrawbuffers:b,maxColorAttachments:a,pointSizeDims:c.getParameter(33901),lineWidthDims:c.getParameter(33902),maxViewportDims:c.getParameter(3386),maxCombinedTextureUnits:c.getParameter(35661),maxCubeMapSize:c.getParameter(34076),maxRenderbufferSize:c.getParameter(34024),maxTextureUnits:c.getParameter(34930),maxTextureSize:c.getParameter(3379),maxAttributes:c.getParameter(34921),maxVertexUniforms:c.getParameter(36347),maxVertexTextureUnits:c.getParameter(35660),maxVaryingVectors:c.getParameter(36348),
maxFragmentUniforms:c.getParameter(36349),glsl:c.getParameter(35724),renderer:c.getParameter(7937),vendor:c.getParameter(7936),version:c.getParameter(7938)}}},{}],14:[function(c,l,r){var k=c("./util/is-typed-array");l.exports=function(c,m,b){return function(a){var d=a||{};k(a)?d={data:d}:2===arguments.length?d={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof a&&(d={});m();var l=d.x||0,r=d.y||0,D=d.width||b.viewportWidth,y=d.height||b.viewportHeight,d=d.data||new Uint8Array(D*y*4);c.pixelStorei(3333,
4);c.readPixels(l,r,D,y,6408,5121,d);return d}}},{"./util/is-typed-array":24}],15:[function(c,l,r){var k=c("./util/values");l.exports=function(c,m,b){function a(){this.id=D++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function d(a){c.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=c.createRenderbuffer());c.bindRenderbuffer(36161,a.renderbuffer);c.renderbufferStorage(36161,a.format,a.width,a.height)}function l(a){var b=a.renderbuffer;c.bindRenderbuffer(36161,
null);c.isRenderbuffer(b)&&c.deleteRenderbuffer(b);a.renderbuffer=null;a.refCount=0;delete y[a.id]}var r={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};m.ext_srgb&&(r.srgba=35907);m.ext_color_buffer_half_float&&(r.rgba16f=34842,r.rgb16f=34843);m.webgl_color_buffer_float&&(r.rgba32f=34836);var D=0,y={};a.prototype.decRef=function(){0===--this.refCount&&l(this)};return{create:function(b){function c(a){a=a||{};var b=0,k=0;"shape"in a?(k=a.shape,b=k[0]|0,k=
k[1]|0):("radius"in a&&(b=k=a.radius|0),"width"in a&&(b=a.width|0),"height"in a&&(k=a.height|0));c.width=f.width=Math.max(b,1);c.height=f.height=Math.max(k,1);f.format=32854;"format"in a&&(f.format=r[a.format]);d(f);return c}var f=new a;y[f.id]=f;c(b);c._reglType="renderbuffer";c._renderbuffer=f;c.destroy=function(){f.decRef()};return c},refresh:function(){k(y).forEach(d)},clear:function(){k(y).forEach(l)}}}},{"./util/values":32}],16:[function(c,l,r){var k=c("./util/values");l.exports=function(c,
m){function b(a,b,d,c){this.name=a;this.id=b;this.location=d;this.info=c}function a(a,b){for(var d=0;d<a.length;++d)if(a[d].id===b.id){a[d].location=b.location;return}a.push(b)}function d(a,b,d){d=35632===a?D:y;var k=d[b];if(!k){var q=m.str(b),k=c.createShader(a);c.shaderSource(k,q);c.compileShader(k);d[b]=k}return k}function l(a,b){this.id=u++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[]}function r(g,k){var p,q;p=d(35632,g.fragId);q=d(35633,g.vertId);var l=g.program=
c.createProgram();c.attachShader(l,p);c.attachShader(l,q);c.linkProgram(l);var t=c.getProgramParameter(l,35718),z=g.uniforms;for(p=0;p<t;++p)if(q=c.getActiveUniform(l,p))if(1<q.size)for(var u=0;u<q.size;++u){var y=q.name.replace("[0]","["+u+"]");a(z,new b(y,m.id(y),c.getUniformLocation(l,y),q))}else a(z,new b(q.name,m.id(q.name),c.getUniformLocation(l,q.name),q));t=c.getProgramParameter(l,35721);z=g.attributes;for(p=0;p<t;++p)(q=c.getActiveAttrib(l,p))&&a(z,new b(q.name,m.id(q.name),c.getAttribLocation(l,
q.name),q))}var D={},y={},z={},q=[],u=0;return{clear:function(){var a=c.deleteShader.bind(c);k(D).forEach(a);D={};k(y).forEach(a);y={};q.forEach(function(a){c.deleteProgram(a.program)});q.length=0;z={}},refresh:function(){D={};y={};q.forEach(r)},program:function(a,b,d){var c=z[b];c||(c=z[b]={});var f=c[a];f||(f=new l(b,a),r(f,d),c[a]=f,q.push(f));return f},shader:d,frag:null,vert:null}}},{"./util/values":32}],17:[function(c,l,r){l.exports=function(){var c={"":0},f=[""];return{id:function(m){var b=
c[m];if(b)return b;b=c[m]=f.length;f.push(m);return b},str:function(c){return f[c]}}}},{}],18:[function(c,l,r){function k(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function f(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var d=a[0].length,c=1;c<b;++c)if(!Array.isArray(a[c])||a[c].length!==d)return!1;return!0}function m(a){return Object.prototype.toString.call(a)}function b(a){return"[object HTMLCanvasElement]"===m(a)}function a(a){return"[object CanvasRenderingContext2D]"===
m(a)}var d=c("./util/extend"),t=c("./util/values"),I=c("./util/is-typed-array"),D=c("./util/is-ndarray"),y=c("./util/load-texture"),z=c("./util/to-half-float"),q=c("./util/parse-dds"),u=[9984,9986,9985,9987];l.exports=function(c,l,p,r,K){function G(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=
this.miplevel=0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function P(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ea(a,b){var d,c,f=0,k=0,g=0,m=0,p=0,l=0,q=!1,r=!1,t=!1;for(d=0;d<b.length;++d)c=b[d],m=m||c.width<<c.miplevel,p=p||c.height<<c.miplevel,
f=f||c.type,k=k||c.format,g=g||c.internalformat,l=l||c.channels,q=q||c.needsPoll,r=r||c.needsListeners,c=c.miplevel,t=t||0<c;a.needsPoll=q;a.needsListeners=r;a.width=m;a.height=p;a.format=k;a.internalformat=g;a.type=f;if(3553!==a.target)for(d=0;6>d;++d);d=0<=u.indexOf(a.minFilter);a.genMipmaps=!t&&(a.genMipmaps||d);t=t||a.genMipmaps;a.minFilter||(a.minFilter=t?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(d=0;d<b.length;++d)c=b[d],c.channels||(c.channels=l),c.format||(c.format=k),c.internalformat||
(c.internalformat=g),c.type||(c.type=f)}function da(a){this.id=T++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new P(a);this.pixels=[]}function S(a,b){function d(a,e){var c=e.mipmap,n;if(Array.isArray(c))for(var f=0;f<c.length;++f)n=new G(a),n.parseFlags(b),n.parseFlags(e),n.parse(c[f],f),k.push(n);else n=new G(a),n.parseFlags(b),n.parse(e,0),k.push(n)}var c;N(a);var f=a.params;P.call(f,a.target);var k=a.pixels;k.length=
0;f.parse(b);if(3553===a.target)d(3553,b);else{var g=b.faces||b;if(Array.isArray(g))for(c=0;6>c;++c)d(34069+c,g[c]);else if("string"!==typeof g)for(c=0;6>c;++c)d(34069+c,{})}ea(f,k);f.needsListeners&&ka(a);f.needsPoll&&(a.pollId=Q.length,Q.push(a));v(a)}function v(a){c.isTexture(a.texture)||(a.texture=c.createTexture());var b=a.target,d=a.unit;0<=d?(c.activeTexture(33984+d),F=d):c.bindTexture(b,a.texture);for(var b=a.pixels,f=a.params,k=0;k<b.length;++k)b[k].upload(f);f.upload();0>d&&((d=W[F])?c.bindTexture(d.target,
d.texture):(a.unit=F,W[F]=a))}function ka(a){function b(a,e,d){var c=q(d);c.pixels.forEach(function(b){var d=new G(c.cube?b.target:a);d.channels=c.channels;d.compressed=c.compressed;d.type=c.type;d.internalformat=c.format;d.format=M[c.format];d.width=b.width;d.height=b.height;d.miplevel=b.miplevel||e;d.data=b.data;f.push(d)})}function d(){for(var n=0;n<f.length;++n){var k=f[n],g=k.image,m=k.video,p=k.xhr;g&&g.complete?(k.width=g.naturalWidth,k.height=g.naturalHeight):m&&2<m.readyState?(k.width=m.width,
k.height=m.height):p&&4===p.readyState&&(f[n]=f[f.length-1],f.pop(),p.removeEventListener("readystatechange",v),b(k.target,k.miplevel,p.response))}ea(c,f);v(a)}var c=a.params,f=a.pixels;f.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",d):a.video&&1>a.readyState?a.video.addEventListener("progress",d):a.xhr&&a.xhr.addEventListener("readystatechange",d)});a.cancelPending=function(){f.forEach(function(a){a.image?a.image.removeEventListener("load",d):a.video?a.video.removeEventListener("progress",
d):a.xhr&&(a.xhr.removeEventListener("readystatechange",d),a.xhr.abort())})}}function N(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((Q[b]=Q[Q.length-1]).id=b,Q.pop(),a.pollId=-1)}function X(a){var b=a.texture,d=a.unit,f=a.target;0<=d&&(c.activeTexture(33984+d),F=d,c.bindTexture(f,null),W[d]=null);N(a);c.isTexture(b)&&c.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete V[a.id]}var Y={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
H={repeat:10497,clamp:33071,mirror:33648},Z={nearest:9728,linear:9729},J=d({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},Z),R={none:0,browser:37444},L={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},E={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},B={};l.ext_srgb&&(E.srgb=35904,E.srgba=35906);l.oes_texture_float&&(L["float"]=5126);l.oes_texture_half_float&&
(L["half float"]=36193);l.webgl_depth_texture&&(d(E,{depth:6402,"depth stencil":34041}),d(L,{uint16:5123,uint32:5125,"depth stencil":34042}));l.webgl_compressed_texture_s3tc&&d(B,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});l.webgl_compressed_texture_atc&&d(B,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});l.webgl_compressed_texture_pvrtc&&d(B,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});l.webgl_compressed_texture_etc1&&(B["rgb etc1"]=36196);var ba=Array.prototype.slice.call(c.getParameter(34467));Object.keys(B).forEach(function(a){var b=B[a];0<=ba.indexOf(b)&&(E[a]=b)});var ia=Object.keys(E);p.textureFormats=ia;var M=ia.reduce(function(a,b){var d=E[b];6409===d||6406===d||6409===d||6410===d||6402===d||34041===d?a[d]=d:32855===d||0<=b.indexOf("rgba")?a[d]=6408:a[d]=6407;return a},{});d(G.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=R[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=E[b];b in L&&(this.type=L[b]);b in B&&(this.compressed=!0)}"type"in a&&(this.type=L[a.type]);var b=this.width,d=this.height,c=this.channels;"shape"in a?(b=a.shape[0],d=a.shape[1],3===a.shape.length&&(c=a.shape[2])):("radius"in a&&(b=d=a.radius),"width"in a&&(b=a.width),
"height"in a&&(d=a.height),"channels"in a&&(c=a.channels));this.width=b|0;this.height=d|0;this.channels=c|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*c,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(e,d){this.miplevel=d;this.width>>=d;this.height>>=d;var c=e;switch(typeof e){case "object":if(!e)return;
this.parseFlags(e);var g=e.data;if("string"===typeof g||g&&(I(g)||k(g)||D(g)||b(g)||a(g)||"[object HTMLImageElement]"===m(g)||"[object HTMLVideoElement]"===m(g)||f(g)))c=e.data;break;case "undefined":return}"string"===typeof c&&(c=y(c,this.crossOrigin));var g=null,p=!1;if(null!==c)if(I(c))this.data=c;else if(k(c))g=c,p=!0;else if(D(c)){Array.isArray(c.data)?(g=c.data,p=!0):this.data=c.data;var l=c.shape;this.width=l[0];this.height=l[1];this.channels=3===l.length?l[2]:1;l=c.stride;this.strideX=c.stride[0];
this.strideY=c.stride[1];this.strideC=3===l.length?c.stride[2]:1;this.offset=c.offset;this.needsTranspose=!0}else if(b(c)||a(c))b(c)?this.canvas=c:this.canvas=c.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===m(c))this.image=c,c.complete?(this.width=c.naturalWidth,this.height=c.naturalHeight):(this.width=this.width||c.naturalWidth,this.height=this.height||c.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===m(c))this.video=c,1<c.readyState?(this.width=c.width,this.height=c.height):(this.width=this.width||c.width,this.height=this.height||c.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===m(c))this.xhr=c,this.needsListeners=!0;else if(f(c)){var p=c[0].length,l=c.length,q=1,r,t,u,w;if(Array.isArray(c[0][0]))for(q=c[0][0].length,g=Array(p*l*q),t=w=0;t<l;++t)for(r=0;r<p;++r)for(u=0;u<q;++u)g[w++]=c[t][r][u];
else for(g=Array(p*l),t=w=0;t<l;++t)for(r=0;r<p;++r)g[w++]=c[t][r];this.width=p;this.height=l;this.channels=q;p=!0}else e.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||K.viewportWidth)|0,this.height=(this.height||K.viewportHeight)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=
[6409,6410,6407,6408][(this.channels=this.channels||4)-1]);c=this.internalformat;l=this.format=M[c];if(!this.channels)switch(l){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}l=this.type;5126!==l&&36193!==l&&(l||(l=6402===c?5125:5121));this.type=l;if(p)switch(l){case 5121:this.data=new Uint8Array(g);break;case 5123:this.data=new Uint16Array(g);break;case 5125:this.data=new Uint32Array(g);break;
case 5126:this.data=new Float32Array(g);break;case 36193:this.data=z(g)}if(this.data&&this.needsTranspose){g=this.data;c=this.width;p=this.height;l=this.channels;q=this.strideX;r=this.strideY;t=this.strideC;u=this.offset;w=new g.constructor(c*p*l);for(var v=0,W=0;W<p;++W)for(var A=0;A<c;++A)for(var B=0;B<l;++B)w[v++]=g[r*W+q*A+t*B+u];this.data=w}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){c.pixelStorei(37440,
this.flipY);c.pixelStorei(37441,this.premultiplyAlpha);c.pixelStorei(37443,this.colorSpace);c.pixelStorei(3317,this.unpackAlignment);var b=this.target,d=this.miplevel,f=this.image,k=this.canvas,m=this.video,l=this.data,p=this.internalformat,q=this.format,t=this.type,u=this.width||Math.max(1,a.width>>d);a=this.height||Math.max(1,a.height>>d);m&&2<m.readyState?c.texImage2D(b,d,q,q,t,m):f&&f.complete?c.texImage2D(b,d,q,q,t,f):k?c.texImage2D(b,d,q,q,t,k):this.compressed?c.compressedTexImage2D(b,d,p,u,
a,0,l):this.copy?(r(),c.copyTexImage2D(b,d,q,this.x,this.y,u,a,0)):l?c.texImage2D(b,d,q,u,a,0,q,t,l):c.texImage2D(b,d,q,u||1,a||1,0,q,t,null)}});d(P.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=J[a.min]);"mag"in a&&(this.magFilter=Z[a.mag]);var b=this.wrapS,d=this.wrapT;if("wrap"in a){var c=a.wrap;"string"===typeof c?b=d=H[c]:Array.isArray(c)&&(b=H[c[0]],d=H[c[1]])}else"wrapS"in a&&(b=H[a.wrapS]),"wrapT"in a&&(d=H[a.wrapT]);this.wrapS=b;this.wrapT=d;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=Y[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;c.texParameteri(a,10241,this.minFilter);c.texParameteri(a,10240,this.magFilter);c.texParameteri(a,10242,this.wrapS);c.texParameteri(a,10243,this.wrapT);l.ext_texture_filter_anisotropic&&c.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(c.hint(33170,this.mipmapHint),c.generateMipmap(a))}});
var F=0,T=0,V={},Q=[],O=p.maxTextureUnits,W=Array(O).map(function(){return null});d(da.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<O;++b){var d=W[b];if(d){if(0<d.bindCount)continue;d.unit=-1}W[b]=this;a=b;break}this.unit=a;c.activeTexture(33984+a);c.bindTexture(this.target,this.texture);F=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&X(this)}});return{create:function(a,b){function d(a,e,f,g,k,m){var l=a||{};34067===b&&
6===arguments.length&&(l=[a,e,f,g,k,m]);S(c,l);d.width=c.params.width;d.height=c.params.height;return d}var c=new da(b);V[c.id]=c;d(a);d._reglType="texture";d._texture=c;d.destroy=function(){c.decRef()};return d},refresh:function(){t(V).forEach(v);for(var a=0;a<O;++a)W[a]=null;F=0;c.activeTexture(33984)},clear:function(){for(var a=0;a<O;++a)c.activeTexture(33984+a),c.bindTexture(3553,null),W[a]=null;c.activeTexture(33984);F=0;t(V).forEach(X)},poll:function(){Q.forEach(v)},getTexture:function(a){return null}}}},
{"./util/extend":21,"./util/is-ndarray":23,"./util/is-typed-array":24,"./util/load-texture":25,"./util/parse-dds":27,"./util/to-half-float":30,"./util/values":32}],19:[function(c,l,r){l.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],20:[function(c,l,r){function k(b){return Array.prototype.slice.call(b)}function f(b){return k(b).join("")}var m=c("./extend");l.exports=function(){function b(){var a=[],b=[];return m(function(){a.push.apply(a,
k(arguments))},{def:function(){var c="v"+d++;b.push(c);0<arguments.length&&(a.push(c,"="),a.push.apply(a,k(arguments)),a.push(";"));return c},toString:function(){return f([0<b.length?"var "+b+";":"",f(a)])}})}function a(){function a(b,f){c(b,f,"=",d.def(b,f),";")}var d=b(),c=b(),f=d.toString,k=c.toString;return m(d,{entry:d,exit:c,save:a,set:function(b,c,f){a(b,c);d(b,c,"=",f,";")},toString:function(){return f()+k()}})}var d=0,c=[],l=[],r=b(),y={};return{global:r,link:function(a){for(var b=0;b<l.length;++b)if(l[b]===
a)return c[b];b="g"+d++;c.push(b);l.push(a);return b},block:b,proc:function(b,d){function c(){var a="a"+k.length;k.push(a);return a}var k=[];d=d||0;for(var l=0;l<d;++l)c();var l=a(),p=l.toString;return y[b]=m(l,{arg:c,toString:function(){return f(["function(",k.join(),"){",p(),"}"])}})},scope:a,cond:function(){var b=f(arguments),d=a(),c=a(),g=d.toString,l=c.toString;return m(d,{then:function(){d.apply(d,k(arguments));return this},"else":function(){c.apply(c,k(arguments));return this},toString:function(){var a=
l();a&&(a="else{"+a+"}");return f(["if(",b,"){",g(),"}",a])}})},compile:function(){var a=['"use strict";',r,"return {"];Object.keys(y).forEach(function(b){a.push('"',b,'":',y[b].toString(),",")});a.push("}");var b=f(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,c.concat(b)).apply(null,l)}}}},{"./extend":21}],21:[function(c,l,r){l.exports=function(c,f){for(var m=Object.keys(f),b=0;b<m.length;++b)c[m[b]]=f[m[b]];return c}},{}],22:[function(c,l,r){l.exports=
function(c,f,m){for(var b=0,a=0;a<f.length;++a)for(var d=f[a],l=0;l<m;++l)c[b++]=d[l]}},{}],23:[function(c,l,r){var k=c("./is-typed-array");l.exports=function(c){return!!c&&"object"===typeof c&&Array.isArray(c.shape)&&Array.isArray(c.stride)&&"number"===typeof c.offset&&c.shape.length===c.stride.length&&(Array.isArray(c.data)||k(c.data))}},{"./is-typed-array":24}],24:[function(c,l,r){var k=c("../constants/arraytypes.json");l.exports=function(c){return Object.prototype.toString.call(c)in k}},{"../constants/arraytypes.json":4}],
25:[function(c,l,r){l.exports=function(c,f){if("undefined"!==typeof document){var m;m=(m=/\.(\w+)(\?.*)?$/.exec(c))&&m[1]?m[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(m))return m=document.createElement("video"),m.autoplay=!0,m.loop=!0,f&&(m.crossOrigin=f),m.src=c,m;if(0<=["dds"].indexOf(m))return m=new XMLHttpRequest,m.responseType="arraybuffer",m.open("GET",c,!0),m.send(),m;m=new Image;f&&(m.crossOrigin=f);m.src=c;return m}return null}},
{}],26:[function(c,l,r){l.exports=function(c,f){for(var m=Array(c),b=0;b<c;++b)m[b]=f(b);return m}},{}],27:[function(c,l,r){l.exports=function(c){function l(a){for(var b=Y,d=H,f=0;f<E;++f){var g=Math.max(1,b+3>>2)*Math.max(1,d+3>>2)*R;ba.pixels.push({target:a,miplevel:f,width:b,height:d,data:new Uint8Array(c,B,g)});B+=g;b>>=1;d>>=1}}var r=new Int32Array(c),X=r[A],Y=r[G],H=r[K],Z=I,J=0,R=0,L=4;switch(r[da]){case q:R=8;X&z?(L=3,J=m):J=b;break;case u:R=16;J=a;break;case g:R=16;J=d;break;case w:R=8,J=
t}var E=1;r[ea]&D&&(E=Math.max(1,r[P]));var B=r[p]+4,ba={width:Y,height:H,channels:L,format:J,type:Z,compressed:!0,cube:!1,pixels:[]};if(r[S]&y)for(ba.cube=!0,r=0;6>r;++r)l(f+r);else l(k);return ba};var k=3553,f=34069,m=33776,b=33777,a=33778,d=33779,t=36196,I=5121,D=131072,y=512,z=64,q=827611204,u=861165636,g=894720068,w=826496069,p=1,A=2,K=3,G=4,P=7,ea=20,da=21,S=28},{}],28:[function(c,l,r){function k(a){var b,c;b=(65535<a)<<4;a>>>=b;c=(255<a)<<3;a>>>=c;b|=c;c=(15<a)<<2;a>>>=c;b|=c;c=(3<a)<<1;return b|
c|a>>>c>>1}function f(a){a:{for(var c=16;268435456>=c;c*=16)if(a<=c){a=c;break a}a=0}c=b[k(a)>>2];return 0<c.length?c.pop():new ArrayBuffer(a)}function m(a){b[k(a.byteLength)>>2].push(a)}var b=c("./loop")(8,function(){return[]});l.exports={alloc:f,free:m,allocType:function(a,b){switch(a){case 5120:return new Int8Array(f(b),0,b);case 5121:return new Uint8Array(f(b),0,b);case 5122:return new Int16Array(f(2*b),0,b);case 5123:return new Uint16Array(f(2*b),0,b);case 5124:return new Int32Array(f(4*b),0,
b);case 5125:return new Uint32Array(f(4*b),0,b);case 5126:return new Float32Array(f(4*b),0,b);default:return null}},freeType:function(a){m(a.buffer)}}},{"./loop":26}],29:[function(c,l,r){l.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(c){return requestAnimationFrame(c)},cancel:function(c){return cancelAnimationFrame(c)}}:{next:function(c){setTimeout(c,30)},cancel:clearTimeout}},{}],30:[function(c,l,r){l.exports=function(c){for(var f=new Float32Array(c),
f=new Uint32Array(f.buffer),m=new Uint16Array(c.length),b=0;b<c.length;++b)if(isNaN(c[b]))m[b]=65535;else if(Infinity===c[b])m[b]=31744;else if(-Infinity===c[b])m[b]=64512;else{var a=f[b],d=a>>>31<<15,l=(a<<1>>>24)-127,a=a>>13&1023;m[b]=-24>l?d:-14>l?d+(a+1024>>-14-l):15<l?d+31744:d+(l+15<<10)+a}return m}},{}],31:[function(c,l,r){l.exports=function(c,f,m,b,a,d,l){for(var r=0,D=0;D<m;++D)for(var y=0;y<b;++y)c[r++]=f[a*D+d*y+l]}},{}],32:[function(c,l,r){l.exports=function(c){return Object.keys(c).map(function(f){return c[f]})}},
{}],33:[function(c,l,r){function k(b,a){function c(){var a=window.innerWidth,d=window.innerHeight;b!==document.body&&(d=b.getBoundingClientRect(),a=d.right-d.left,d=d.top-d.bottom);k.width=r*a;k.height=r*d;m(k.style,{width:a+"px",height:d+"px"})}var k=document.createElement("canvas"),l=f(k,a);m(k.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(k);b===document.body&&(k.style.position="absolute",m(b.style,{margin:0,padding:0}));var r=+l.options.pixelRatio;window.addEventListener("resize",
c,!1);var y=l.options.onDestroy;l.options=m(m({},l.options),{onDestroy:function(){window.removeEventListener("resize",c);b.removeChild(k);y&&y()}});c();return l}function f(b,a){function c(a){try{return b.getContext(a,f)}catch(d){return null}}var f=a.glOptions||{};return{gl:c("webgl")||c("experimental-webgl")||c("webgl-experimental"),options:m({pixelRatio:window.devicePixelRatio},a)}}var m=c("./util/extend");l.exports=function(b){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:b[0],
options:b[1]||{}};var a=document.body,c=b[1]||{};if("string"===typeof b[0])a=document.querySelector(b[0])||document.body;else if("object"===typeof b[0])if(b[0]instanceof HTMLElement)a=b[0];else{if(b[0]instanceof WebGLRenderingContext)return{gl:b[0],options:m({pixelRatio:1},c)};c=b[0]}return a.nodeName&&"CANVAS"===a.nodeName.toUpperCase()?f(a,c):k(a,c)}},{"./util/extend":21}],34:[function(c,l,r){var k=c("./lib/util/extend"),f=c("./lib/dynamic"),m=c("./lib/util/raf"),b=c("./lib/util/clock"),a=c("./lib/strings"),
d=c("./lib/webgl"),t=c("./lib/extension"),I=c("./lib/limits"),D=c("./lib/buffer"),y=c("./lib/elements"),z=c("./lib/texture"),q=c("./lib/renderbuffer"),u=c("./lib/framebuffer"),g=c("./lib/attribute"),w=c("./lib/shader"),p=c("./lib/read"),A=c("./lib/core");l.exports=function(){function c(){O=m.next(c);J.count+=1;var a=T.viewport,d=T.scissor_box;a[0]=a[1]=d[0]=d[1]=0;J.viewportWidth=J.frameBufferWidth=J.drawingBufferWidth=a[2]=d[2]=v.drawingBufferWidth;J.viewportHeight=J.frameBufferWidth=J.drawingBufferHeight=
a[3]=d[3]=v.drawingBufferHeight;a=b();J.deltaTime=(a-Y)/1E3;J.time=(a-X)/1E3;Y=a;F.procs.refresh();B.poll();for(a=0;a<Q.length;++a)(0,Q[a])(J,null,0)}function l(a){}function r(a){}function ea(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];f.isDynamic(e)?d[b]=f.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;r.length<a;)r.push(null);return r}var d=b(a.context||{}),g=b(a.uniforms||{}),l=b(a.attributes||{});a=b(function(a){function b(a){if(a in c){var d=
c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=k({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var d=F.compile(a,l,g,d),m=d.draw,p=d.batch,q=d.scope,r=[];return function(a,b){var d;if("function"===typeof a)return q.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)q.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<
a.length;++d)q.call(this,a[d],b,d);else return q.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return m.call(this,a)}}function da(){F.procs.poll()}var S=d(Array.prototype.slice.call(arguments)),v=S.gl,ka=S.options,S=a(),N=t(v).extensions,X=b(),Y=X,H=v.drawingBufferWidth,Z=v.drawingBufferHeight,J={count:0,deltaTime:0,time:0,viewportWidth:H,viewportHeight:Z,framebufferWidth:H,framebufferHeight:Z,
drawingBufferWidth:H,drawingBufferHeight:Z,pixelRatio:ka.pixelRatio},H=I(v,N),R=D(v),L=y(v,N,R),Z=g(v,N,H,R,S),E=w(v,S),B=z(v,N,H,da,J),ba=q(v,N,H),ia=u(v,N,H,B,ba),M=p(v,da,J),F=A(v,S,N,H,R,L,B,ia,{},Z,E,{elements:null,primitive:4,count:-1,offset:0,instances:-1},J),T=F.next,V=v.canvas,Q=[],O=0;V&&(V.addEventListener("webglcontextlost",l,!1),V.addEventListener("webglcontextrestored",r,!1));F.procs.refresh();return k(ea,{clear:function(a){var b=0;da();var c=a.color;c&&(v.clearColor(+c[0]||0,+c[1]||
0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(v.clearDepth(+a.depth),b|=256);"stencil"in a&&(v.clearStencil(a.stencil|0),b|=1024);v.clear(b)},prop:f.define.bind(null,1),context:f.define.bind(null,2),"this":f.define.bind(null,3),draw:ea({}),elements:function(a){return L.create(a)},buffer:function(a){return R.create(a,34962)},texture:function(a){return B.create(a,3553)},cube:function(a){return 6===arguments.length?B.create(Array.prototype.slice.call(arguments),34067):B.create(a,34067)},renderbuffer:function(a){return ba.create(a)},
framebuffer:function(a){return ia.create(a)},framebufferCube:function(a){},attributes:v.getContextAttributes(),frame:function(a){Q.push(a);!O&&0<Q.length&&c();return{cancel:function(){var b=Q.find(function(b){return b===a});0>b||(Q.splice(b,1),0>=Q.length&&O&&(m.cancel(c),O=0))}}},limits:H,read:M,destroy:function(){O&&(m.cancel(c),O=0);V&&(V.removeEventListener("webglcontextlost",l),V.removeEventListener("webglcontextrestored",r));E.clear();ia.clear();ba.clear();B.clear();R.clear();if(ka.onDestroy)ka.onDestroy()},
_gl:v,_refresh:function(){F.procs.refresh()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/strings":17,"./lib/texture":18,"./lib/util/clock":19,"./lib/util/extend":21,"./lib/util/raf":29,"./lib/webgl":33}]},{},[1]);

        </script>
        </body>
      </html>