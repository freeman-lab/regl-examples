(function(){function d(e,n,c){function b(y,H){if(!n[y]){if(!e[y]){var B="function"==typeof require&&require;if(!H&&B)return B(y,!0);if(v)return v(y,!0);B=Error("Cannot find module '"+y+"'");throw B.code="MODULE_NOT_FOUND",B;}B=n[y]={exports:{}};e[y][0].call(B.exports,function(c){return b(e[y][1][c]||c)},B,B.exports,d,e,n,c)}return n[y].exports}for(var v="function"==typeof require&&require,y=0;y<c.length;y++)b(c[y]);return b}return d})()({1:[function(d,e,n){function c(b,c){this.c=O.fromValues(b[0],
b[1]);this.r=O.fromValues(c[0],c[1])}function b(b,c,v){return c<v?b<c?c:b>v?v:b:b<v?v:b>c?c:b}function v(b,c,v){var d=+(b.c[0]-c.c[0])-(b.r[0]+c.r[0]),e=-(b.c[0]-c.c[0])-(b.r[0]+c.r[0]);if(0<d||0<e)return!1;var y=+(b.c[1]-c.c[1])-v*(b.r[1]+c.r[1]);b=-(b.c[1]-c.c[1])-v*(b.r[1]+c.r[1]);if(0<y||0<b)return!1;if(d>e&&d>y&&d>b)return O.fromValues(-1,0);if(e>d&&e>y&&e>b)return O.fromValues(1,0);if(y>d&&y>e&&y>b)return O.fromValues(0,-1);if(b>d&&b>e&&b>y)return O.fromValues(0,1)}function y(b,c){return Math.random()*
(c-b)+b}function Ca(b){C.c=[0,0];C.r=[.02,.02];var c=y(.3,.4);b=b?y(Math.PI-1.2,Math.PI+1.2):y(-1.2,1.2);A=[c*Math.cos(b),c*Math.sin(b)]}function H(b,c){for(var v=E.sampleRate*b,d=E.createBuffer(2,v,E.sampleRate),e=0;2>e;e++){var y=d.getChannelData(e);c(y,v)}return d}function B(b){var c=E.createBufferSource();c.buffer=b;c.connect(E.destination);c.start()}function J(b,c){B(Y[fa]);fa=(fa+1)%2;return O.subtract(b,b,O.scale([0,0],c,2.1*O.dot(b,c)))}var ha=d("regl")(),O=d("gl-vec2"),K=null;d("mouse-change")(function(b,
c,v){K=v});var la=new c([-.9,0],[.03,.15]),F=new c([.9,0],[.03,.15]),ma=new c([0,0],[.005,1]),C=new c([0,0],[0,0]),A=O.fromValues(0,0),E=new AudioContext,Y=[];Y[0]=H(.15,function(b,c){for(var v=.1,d=0;d<c;d++)0===d%100&&(v*=-1),b[d]=v*(1-d/c)});Y[1]=H(.15,function(b,c){for(var v=.1,d=0;d<c;d++)0===d%150&&(v*=-1),b[d]=v*(1-d/c)});var $a=H(.4,function(b,c){for(var v=.1,d=50,e=0;e<c;e++)0===e%d&&(v*=-1),0===e%600&&(d-=2),b[e]=v*(1-e/c)}),Na=H(.5,function(b,c){for(var v=y(-.1,.1),d=0;d<c;d++)0===d%150&&
(v=y(-.1,.1)),b[d]=v*(1-d/c)}),fa=0,ab=ha({frag:"\n    precision mediump float;\n    void main() {\n      gl_FragColor = vec4(1.0);\n    }",vert:"\n  precision mediump float;\n\n  attribute vec2 position;\n\n  uniform vec2 offset;\n  uniform vec2 scale;\n\n  uniform float viewportWidth;\n  uniform float viewportHeight;\n\n  void main() {\n    // windows ratio scaling factor.\n    float r = (viewportWidth) / (viewportHeight);\n    gl_Position = vec4(position.xy * scale * vec2(1.0, r) + offset, 0, 1);\n  }",
attributes:{position:[[-1,-1],[1,1],[-1,1],[-1,-1],[1,-1],[1,1]]},uniforms:{offset:function(b,c){return c.aabb.c},scale:function(b,c){return c.aabb.r},viewportWidth:ha.context("viewportWidth"),viewportHeight:ha.context("viewportHeight")},depth:{enable:!1},cull:{enable:!0},count:6});Ca(!0);ha.frame(function(c){var d=c.viewportWidth,e=c.viewportHeight;c=c.pixelRatio;ha.clear({color:[0,0,0,1]});var d=d/e,y=-1+la.r[1]*d,n=1-la.r[1]*d;null!==K&&(la.c[1]=b(-1+2*(1-K*c/e),y,n));F.c[1]=b(F.c[1]+.0323*(C.c[1]-
F.c[1]),y,n);O.scaleAndAdd(C.c,C.c,A,.017);1<=C.c[1]+d*C.r[1]&&(A=J(A,O.fromValues(0,-1)));1<=C.c[0]+C.r[0]&&(B($a),Ca(!0));-1>=C.c[1]-d*C.r[1]&&(A=J(A,O.fromValues(0,1)));-1>=C.c[0]-C.r[0]&&(B(Na),Ca(!1));e=v(F,C,d);!1!==e&&(A=J(A,e));e=v(la,C,d);!1!==e&&(A=J(A,e));ab([{aabb:la},{aabb:F},{aabb:ma},{aabb:C}])})},{"gl-vec2":19,"mouse-change":47,regl:49}],2:[function(d,e,n){e.exports=function(c,b,v){c[0]=b[0]+v[0];c[1]=b[1]+v[1];return c}},{}],3:[function(d,e,n){e.exports=function(c,b){c[0]=Math.ceil(b[0]);
c[1]=Math.ceil(b[1]);return c}},{}],4:[function(d,e,n){e.exports=function(c){var b=new Float32Array(2);b[0]=c[0];b[1]=c[1];return b}},{}],5:[function(d,e,n){e.exports=function(c,b){c[0]=b[0];c[1]=b[1];return c}},{}],6:[function(d,e,n){e.exports=function(){var c=new Float32Array(2);c[0]=0;c[1]=0;return c}},{}],7:[function(d,e,n){e.exports=function(c,b,v){b=b[0]*v[1]-b[1]*v[0];c[0]=c[1]=0;c[2]=b;return c}},{}],8:[function(d,e,n){e.exports=d("./distance")},{"./distance":9}],9:[function(d,e,n){e.exports=
function(c,b){var v=b[0]-c[0],d=b[1]-c[1];return Math.sqrt(v*v+d*d)}},{}],10:[function(d,e,n){e.exports=d("./divide")},{"./divide":11}],11:[function(d,e,n){e.exports=function(c,b,v){c[0]=b[0]/v[0];c[1]=b[1]/v[1];return c}},{}],12:[function(d,e,n){e.exports=function(c,b){return c[0]*b[0]+c[1]*b[1]}},{}],13:[function(d,e,n){e.exports=1E-6},{}],14:[function(d,e,n){e.exports=function(b,v){var d=b[0],e=b[1],n=v[0],B=v[1];return Math.abs(d-n)<=c*Math.max(1,Math.abs(d),Math.abs(n))&&Math.abs(e-B)<=c*Math.max(1,
Math.abs(e),Math.abs(B))};var c=d("./epsilon")},{"./epsilon":13}],15:[function(d,e,n){e.exports=function(c,b){return c[0]===b[0]&&c[1]===b[1]}},{}],16:[function(d,e,n){e.exports=function(c,b){c[0]=Math.floor(b[0]);c[1]=Math.floor(b[1]);return c}},{}],17:[function(d,e,n){e.exports=function(b,v,d,e,n,B){v||(v=2);d||(d=0);for(e=e?Math.min(e*v+d,b.length):b.length;d<e;d+=v)c[0]=b[d],c[1]=b[d+1],n(c,c,B),b[d]=c[0],b[d+1]=c[1];return b};var c=d("./create")()},{"./create":6}],18:[function(d,e,n){e.exports=
function(c,b){var v=new Float32Array(2);v[0]=c;v[1]=b;return v}},{}],19:[function(d,e,n){e.exports={EPSILON:d("./epsilon"),create:d("./create"),clone:d("./clone"),fromValues:d("./fromValues"),copy:d("./copy"),set:d("./set"),equals:d("./equals"),exactEquals:d("./exactEquals"),add:d("./add"),subtract:d("./subtract"),sub:d("./sub"),multiply:d("./multiply"),mul:d("./mul"),divide:d("./divide"),div:d("./div"),inverse:d("./inverse"),min:d("./min"),max:d("./max"),rotate:d("./rotate"),floor:d("./floor"),ceil:d("./ceil"),
round:d("./round"),scale:d("./scale"),scaleAndAdd:d("./scaleAndAdd"),distance:d("./distance"),dist:d("./dist"),squaredDistance:d("./squaredDistance"),sqrDist:d("./sqrDist"),length:d("./length"),len:d("./len"),squaredLength:d("./squaredLength"),sqrLen:d("./sqrLen"),negate:d("./negate"),normalize:d("./normalize"),dot:d("./dot"),cross:d("./cross"),lerp:d("./lerp"),random:d("./random"),transformMat2:d("./transformMat2"),transformMat2d:d("./transformMat2d"),transformMat3:d("./transformMat3"),transformMat4:d("./transformMat4"),
forEach:d("./forEach"),limit:d("./limit")}},{"./add":2,"./ceil":3,"./clone":4,"./copy":5,"./create":6,"./cross":7,"./dist":8,"./distance":9,"./div":10,"./divide":11,"./dot":12,"./epsilon":13,"./equals":14,"./exactEquals":15,"./floor":16,"./forEach":17,"./fromValues":18,"./inverse":20,"./len":21,"./length":22,"./lerp":23,"./limit":24,"./max":25,"./min":26,"./mul":27,"./multiply":28,"./negate":29,"./normalize":30,"./random":31,"./rotate":32,"./round":33,"./scale":34,"./scaleAndAdd":35,"./set":36,"./sqrDist":37,
"./sqrLen":38,"./squaredDistance":39,"./squaredLength":40,"./sub":41,"./subtract":42,"./transformMat2":43,"./transformMat2d":44,"./transformMat3":45,"./transformMat4":46}],20:[function(d,e,n){e.exports=function(c,b){c[0]=1/b[0];c[1]=1/b[1];return c}},{}],21:[function(d,e,n){e.exports=d("./length")},{"./length":22}],22:[function(d,e,n){e.exports=function(c){var b=c[0];c=c[1];return Math.sqrt(b*b+c*c)}},{}],23:[function(d,e,n){e.exports=function(c,b,v,d){var e=b[0];b=b[1];c[0]=e+d*(v[0]-e);c[1]=b+d*
(v[1]-b);return c}},{}],24:[function(d,e,n){e.exports=function(c,b,v){var d=b[0]*b[0]+b[1]*b[1];d>v*v?(d=Math.sqrt(d),c[0]=b[0]/d*v,c[1]=b[1]/d*v):(c[0]=b[0],c[1]=b[1]);return c}},{}],25:[function(d,e,n){e.exports=function(c,b,d){c[0]=Math.max(b[0],d[0]);c[1]=Math.max(b[1],d[1]);return c}},{}],26:[function(d,e,n){e.exports=function(c,b,d){c[0]=Math.min(b[0],d[0]);c[1]=Math.min(b[1],d[1]);return c}},{}],27:[function(d,e,n){e.exports=d("./multiply")},{"./multiply":28}],28:[function(d,e,n){e.exports=
function(c,b,d){c[0]=b[0]*d[0];c[1]=b[1]*d[1];return c}},{}],29:[function(d,e,n){e.exports=function(c,b){c[0]=-b[0];c[1]=-b[1];return c}},{}],30:[function(d,e,n){e.exports=function(c,b){var d=b[0],e=b[1],d=d*d+e*e;0<d&&(d=1/Math.sqrt(d),c[0]=b[0]*d,c[1]=b[1]*d);return c}},{}],31:[function(d,e,n){e.exports=function(c,b){b=b||1;var d=2*Math.random()*Math.PI;c[0]=Math.cos(d)*b;c[1]=Math.sin(d)*b;return c}},{}],32:[function(d,e,n){e.exports=function(c,b,d){var e=Math.cos(d);d=Math.sin(d);var n=b[0];b=
b[1];c[0]=n*e-b*d;c[1]=n*d+b*e;return c}},{}],33:[function(d,e,n){e.exports=function(c,b){c[0]=Math.round(b[0]);c[1]=Math.round(b[1]);return c}},{}],34:[function(d,e,n){e.exports=function(c,b,d){c[0]=b[0]*d;c[1]=b[1]*d;return c}},{}],35:[function(d,e,n){e.exports=function(c,b,d,e){c[0]=b[0]+d[0]*e;c[1]=b[1]+d[1]*e;return c}},{}],36:[function(d,e,n){e.exports=function(c,b,d){c[0]=b;c[1]=d;return c}},{}],37:[function(d,e,n){e.exports=d("./squaredDistance")},{"./squaredDistance":39}],38:[function(d,
e,n){e.exports=d("./squaredLength")},{"./squaredLength":40}],39:[function(d,e,n){e.exports=function(c,b){var d=b[0]-c[0],e=b[1]-c[1];return d*d+e*e}},{}],40:[function(d,e,n){e.exports=function(c){var b=c[0];c=c[1];return b*b+c*c}},{}],41:[function(d,e,n){e.exports=d("./subtract")},{"./subtract":42}],42:[function(d,e,n){e.exports=function(c,b,d){c[0]=b[0]-d[0];c[1]=b[1]-d[1];return c}},{}],43:[function(d,e,n){e.exports=function(c,b,d){var e=b[0];b=b[1];c[0]=d[0]*e+d[2]*b;c[1]=d[1]*e+d[3]*b;return c}},
{}],44:[function(d,e,n){e.exports=function(c,b,d){var e=b[0];b=b[1];c[0]=d[0]*e+d[2]*b+d[4];c[1]=d[1]*e+d[3]*b+d[5];return c}},{}],45:[function(d,e,n){e.exports=function(d,b,e){var n=b[0];b=b[1];d[0]=e[0]*n+e[3]*b+e[6];d[1]=e[1]*n+e[4]*b+e[7];return d}},{}],46:[function(d,e,n){e.exports=function(d,b,e){var n=b[0];b=b[1];d[0]=e[0]*n+e[4]*b+e[12];d[1]=e[1]*n+e[5]*b+e[13];return d}},{}],47:[function(d,e,n){e.exports=function(b,d){function e(b){var d=!1;"altKey"in b&&(d=d||b.altKey!==A.alt,A.alt=!!b.altKey);
"shiftKey"in b&&(d=d||b.shiftKey!==A.shift,A.shift=!!b.shiftKey);"ctrlKey"in b&&(d=d||b.ctrlKey!==A.control,A.control=!!b.ctrlKey);"metaKey"in b&&(d=d||b.metaKey!==A.meta,A.meta=!!b.metaKey);return d}function n(b,B){var J=c.x(B),H=c.y(B);"buttons"in B&&(b=B.buttons|0);if(b!==F||J!==ma||H!==C||e(B))F=b|0,ma=J||0,C=H||0,d&&d(F,ma,C,A)}function H(b){n(0,b)}function B(){if(F||ma||C||A.shift||A.alt||A.meta||A.control)F=ma=C=0,A.shift=A.alt=A.control=A.meta=!1,d&&d(0,0,0,A)}function J(b){e(b)&&d&&d(F,ma,
C,A)}function ha(b){0===c.buttons(b)?n(0,b):n(F,b)}function O(b){n(F|c.buttons(b),b)}function K(b){n(F&~c.buttons(b),b)}function la(){E||(E=!0,b.addEventListener("mousemove",ha),b.addEventListener("mousedown",O),b.addEventListener("mouseup",K),b.addEventListener("mouseleave",H),b.addEventListener("mouseenter",H),b.addEventListener("mouseout",H),b.addEventListener("mouseover",H),b.addEventListener("blur",B),b.addEventListener("keyup",J),b.addEventListener("keydown",J),b.addEventListener("keypress",
J),b!==window&&(window.addEventListener("blur",B),window.addEventListener("keyup",J),window.addEventListener("keydown",J),window.addEventListener("keypress",J)))}d||(d=b,b=window);var F=0,ma=0,C=0,A={shift:!1,alt:!1,control:!1,meta:!1},E=!1;la();var Y={element:b};Object.defineProperties(Y,{enabled:{get:function(){return E},set:function(d){d?la():E&&(E=!1,b.removeEventListener("mousemove",ha),b.removeEventListener("mousedown",O),b.removeEventListener("mouseup",K),b.removeEventListener("mouseleave",
H),b.removeEventListener("mouseenter",H),b.removeEventListener("mouseout",H),b.removeEventListener("mouseover",H),b.removeEventListener("blur",B),b.removeEventListener("keyup",J),b.removeEventListener("keydown",J),b.removeEventListener("keypress",J),b!==window&&(window.removeEventListener("blur",B),window.removeEventListener("keyup",J),window.removeEventListener("keydown",J),window.removeEventListener("keypress",J)))},enumerable:!0},buttons:{get:function(){return F},enumerable:!0},x:{get:function(){return ma},
enumerable:!0},y:{get:function(){return C},enumerable:!0},mods:{get:function(){return A},enumerable:!0}});return Y};var c=d("mouse-event")},{"mouse-event":48}],48:[function(d,e,n){function c(b){return b.target||b.srcElement||window}n.buttons=function(b){if("object"===typeof b){if("buttons"in b)return b.buttons;if("which"in b){b=b.which;if(2===b)return 4;if(3===b)return 2;if(0<b)return 1<<b-1}else if("button"in b){b=b.button;if(1===b)return 4;if(2===b)return 2;if(0<=b)return 1<<b}}return 0};n.element=
c;n.x=function(b){if("object"===typeof b){if("offsetX"in b)return b.offsetX;var d=c(b).getBoundingClientRect();return b.clientX-d.left}return 0};n.y=function(b){if("object"===typeof b){if("offsetY"in b)return b.offsetY;var d=c(b).getBoundingClientRect();return b.clientY-d.top}return 0}},{}],49:[function(d,e,n){(function(d,b){"object"===typeof n&&"undefined"!==typeof e?e.exports=b():"function"===typeof define&&define.amd?define(b):d.createREGL=b()})(this,function(){function d(a){return"undefined"!==
typeof atob?atob(a):"base64:"+a}function b(a){a=Error("(regl) "+a);console.error(a);throw a;}function e(a,h){a||b(h)}function n(a){return a?": "+a:""}function Ca(a,h){switch(h){case "number":return"number"===typeof a;case "object":return"object"===typeof a;case "string":return"string"===typeof a;case "boolean":return"boolean"===typeof a;case "function":return"function"===typeof a;case "undefined":return"undefined"===typeof a;case "symbol":return"symbol"===typeof a}}function H(a,h,f){0>h.indexOf(a)&&
b("invalid value"+n(f)+". must be one of: "+h)}function B(a,h){for(a+="";a.length<h;)a=" "+a;return a}function J(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function ha(a,h){this.number=a;this.line=h;this.errors=[]}function O(a,h,b){this.file=a;this.line=h;this.message=b}function K(){var a=Error(),a=(a.stack||a).toString(),h=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);return h?h[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?a[1]:"unknown"}function la(){var a=Error(),
a=(a.stack||a).toString(),h=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);return h?h[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function F(a,h){var b=a.split("\n"),f=1,e=0,l={unknown:new J,0:new J};l.unknown.name=l[0].name=h||K();l.unknown.lines.push(new ha(0,""));for(var sa=0;sa<b.length;++sa){var g=b[sa],p=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(g);if(p)switch(p[1]){case "line":if(p=/(\d+)(\s+\d+)?/.exec(p[2]))f=p[1]|0,p[2]&&(e=p[2]|0,e in l||(l[e]=new J));break;case "define":if(p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(p[2]))l[e].name=
p[1]?d(p[2]):p[2]}l[e].lines.push(new ha(f++,g))}Object.keys(l).forEach(function(a){var h=l[a];h.lines.forEach(function(a){h.index[a.number]=a})});return l}function ma(a){var h=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var b=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(a);b?h.push(new O(b[1]|0,b[2]|0,b[3].trim())):0<a.length&&h.push(new O("unknown",0,a))}});return h}function C(a,h){h.forEach(function(h){var b=a[h.file];if(b){var f=b.index[h.line];if(f){f.errors.push(h);b.hasErrors=!0;return}}a.unknown.hasErrors=
!0;a.unknown.lines[0].errors.push(h)})}function A(a){a._commandRef=K()}function E(a,h){var f=la();b(a+" in command "+(h||K())+("unknown"===f?"":" called from "+f))}function Y(a,h,b,f){Ca(a,h)||E("invalid parameter type"+n(b)+". expected "+h+", got "+typeof a,f||K())}function $a(a,h){return 32820===a||32819===a||33635===a?2:34042===a?4:aa[a]*h}function Na(a,h){this.id=$b++;this.type=a;this.data=h}function fa(a){if(0===a.length)return[];var h=a.charAt(0),b=a.charAt(a.length-1);if(1<a.length&&h===b&&
('"'===h||"'"===h))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(h=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return fa(a.substr(0,h.index)).concat(fa(h[1])).concat(fa(a.substr(h.index+h[0].length)));h=a.split(".");if(1===h.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(b=0;b<h.length;++b)a=a.concat(fa(h[b]));return a}function ab(a){return"["+fa(a).join("][")+"]"}function Wb(){var a={"":0},h=[""];return{id:function(b){var f=
a[b];if(f)return f;f=a[b]=h.length;h.push(b);return f},str:function(a){return h[a]}}}function Xb(a,h,b){function f(){var h=window.innerWidth,c=window.innerHeight;a!==document.body&&(c=a.getBoundingClientRect(),h=c.right-c.left,c=c.bottom-c.top);d.width=b*h;d.height=b*c;W(d.style,{width:h+"px",height:c+"px"})}var d=document.createElement("canvas");W(d.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(d);a===document.body&&(d.style.position="absolute",W(a.style,{margin:0,padding:0}));
var c;a!==document.body&&"function"===typeof ResizeObserver?(c=new ResizeObserver(function(){setTimeout(f)}),c.observe(a)):window.addEventListener("resize",f,!1);f();return{canvas:d,onDestroy:function(){c?c.disconnect():window.removeEventListener("resize",f);a.removeChild(d)}}}function Yb(a,h){function b(f){try{return a.getContext(f,h)}catch(d){return null}}return b("webgl")||b("experimental-webgl")||b("webgl-experimental")}function vb(a){if("string"===typeof a)return a.split();f(Array.isArray(a),
"invalid extension array");return a}function wb(a){return"string"===typeof a?(f("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(a)):a}function Zb(a){var b=a||{},d,c,e,l;a={};var sa=[],g=[],p="undefined"===typeof window?1:window.devicePixelRatio,k=!1,t=function(a){a&&f.raise(a)},q=function(){};"string"===typeof b?(f("undefined"!==typeof document,"selector queries only supported in DOM enviroments"),d=document.querySelector(b),f(d,"invalid query string for element")):
"object"===typeof b?"string"===typeof b.nodeName&&"function"===typeof b.appendChild&&"function"===typeof b.getBoundingClientRect?d=b:"function"===typeof b.drawArrays||"function"===typeof b.drawElements?(l=b,e=l.canvas):(f.constructor(b),"gl"in b?l=b.gl:"canvas"in b?e=wb(b.canvas):"container"in b&&(c=wb(b.container)),"attributes"in b&&(a=b.attributes,f.type(a,"object","invalid context attributes")),"extensions"in b&&(sa=vb(b.extensions)),"optionalExtensions"in b&&(g=vb(b.optionalExtensions)),"onDone"in
b&&(f.type(b.onDone,"function","invalid or missing onDone callback"),t=b.onDone),"profile"in b&&(k=!!b.profile),"pixelRatio"in b&&(p=+b.pixelRatio,f(0<p,"invalid pixel ratio"))):f.raise("invalid arguments to regl");d&&("canvas"===d.nodeName.toLowerCase()?e=d:c=d);if(!l){if(!e){f("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");d=Xb(c||document.body,t,p);if(!d)return null;e=d.canvas;q=d.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0);
l=Yb(e,a)}return l?{gl:l,canvas:e,container:c,extensions:sa,optionalExtensions:g,pixelRatio:p,profile:k,onDone:t,onDestroy:q}:(q(),t("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ac(a,b){function d(b){f.type(b,"string","extension name must be string");b=b.toLowerCase();var h;try{h=c[b]=a.getExtension(b)}catch(e){}return!!h}for(var c={},e=0;e<b.extensions.length;++e){var l=b.extensions[e];if(!d(l))return b.onDestroy(),b.onDone('"'+l+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),
null}b.optionalExtensions.forEach(d);return{extensions:c,restore:function(){Object.keys(c).forEach(function(a){if(c[a]&&!d(a))throw Error("(regl): error restoring extension "+a);})}}}function oa(a,b){for(var f=Array(a),d=0;d<a;++d)f[d]=b(d);return f}function xb(a){var b,f;b=(65535<a)<<4;a>>>=b;f=(255<a)<<3;a>>>=f;b|=f;f=(15<a)<<2;a>>>=f;b|=f;f=(3<a)<<1;return b|f|a>>>f>>1}function yb(){function a(a){a:{for(var b=16;268435456>=b;b*=16)if(a<=b){a=b;break a}a=0}b=f[xb(a)>>2];return 0<b.length?b.pop():
new ArrayBuffer(a)}function b(a){f[xb(a.byteLength)>>2].push(a)}var f=oa(8,function(){return[]});return{alloc:a,free:b,allocType:function(b,f){var d=null;switch(b){case 5120:d=new Int8Array(a(f),0,f);break;case 5121:d=new Uint8Array(a(f),0,f);break;case 5122:d=new Int16Array(a(2*f),0,f);break;case 5123:d=new Uint16Array(a(2*f),0,f);break;case 5124:d=new Int32Array(a(4*f),0,f);break;case 5125:d=new Uint32Array(a(4*f),0,f);break;case 5126:d=new Float32Array(a(4*f),0,f);break;default:return null}return d.length!==
f?d.subarray(0,f):d},freeType:function(a){b(a.buffer)}}}function ia(a){return!!a&&"object"===typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"===typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||P(a.data))}function zb(a,b,f,d,c,e){for(var n=0;n<b;++n)for(var g=a[n],p=0;p<f;++p)for(var k=g[p],t=0;t<d;++t)c[e++]=k[t]}function Ab(a,b,f,d,c){for(var e=1,n=f+1;n<b.length;++n)e*=b[n];var g=b[f];if(4===b.length-f){var p=b[f+1],k=b[f+2];b=b[f+3];for(n=0;n<g;++n)zb(a[n],
p,k,b,d,c),c+=e}else for(n=0;n<g;++n)Ab(a[n],b,f+1,d,c),c+=e}function bb(a){return cb[Object.prototype.toString.call(a)]|0}function Bb(a,b){for(var f=0;f<b.length;++f)a[f]=b[f]}function Cb(a,b,f,d,c,e,n){for(var g=0,p=0;p<f;++p)for(var k=0;k<d;++k)a[g++]=b[c*p+e*k+n]}function bc(a,b,d,c){function e(b){this.id=p++;this.buffer=a.createBuffer();this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;d.profile&&(this.stats={size:0})}function l(b,f,d){b.byteLength=
f.byteLength;a.bufferData(b.type,f,d)}function n(a,b,d,h,c,e){a.usage=d;if(Array.isArray(b)){if(a.dtype=h||5126,0<b.length)if(Array.isArray(b[0])){c=Db(b);for(var z=h=1;z<c.length;++z)h*=c[z];a.dimension=h;b=lb(b,c,a.dtype);l(a,b,d);e?a.persistentData=b:I.freeType(b)}else"number"===typeof b[0]?(a.dimension=c,c=I.allocType(a.dtype,b.length),Bb(c,b),l(a,c,d),e?a.persistentData=c:I.freeType(c)):P(b[0])?(a.dimension=b[0].length,a.dtype=h||bb(b[0])||5126,b=lb(b,[b.length,b[0].length],a.dtype),l(a,b,d),
e?a.persistentData=b:I.freeType(b)):f.raise("invalid buffer data")}else if(P(b))a.dtype=h||bb(b),a.dimension=c,l(a,b,d),e&&(a.persistentData=new Uint8Array(new Uint8Array(b.buffer)));else if(ia(b)){c=b.shape;var L=b.stride,z=b.offset,k=0,g=0,p=0,na=0;1===c.length?(k=c[0],g=1,p=L[0],na=0):2===c.length?(k=c[0],g=c[1],p=L[0],na=L[1]):f.raise("invalid shape");a.dtype=h||bb(b.data)||5126;a.dimension=g;c=I.allocType(a.dtype,k*g);Cb(c,b.data,k,g,p,na,z);l(a,c,d);e?a.persistentData=c:I.freeType(c)}else b instanceof
ArrayBuffer?(a.dtype=5121,a.dimension=c,l(a,b,d),e&&(a.persistentData=new Uint8Array(new Uint8Array(b)))):f.raise("invalid buffer data")}function g(d){b.bufferCount--;c(d);var e=d.buffer;f(e,"buffer must not be deleted already");a.deleteBuffer(e);d.buffer=null;delete k[d.id]}var p=0,k={};e.prototype.bind=function(){a.bindBuffer(this.type,this.buffer)};e.prototype.destroy=function(){g(this)};var t=[];d.profile&&(b.getTotalBufferSize=function(){var a=0;Object.keys(k).forEach(function(b){a+=k[b].stats.size});
return a});return{create:function(c,l,u,r){function m(b){var c=35044,h=null,e=0,q=0,g=1;Array.isArray(b)||P(b)||ia(b)||b instanceof ArrayBuffer?h=b:"number"===typeof b?e=b|0:b&&(f.type(b,"object","buffer arguments must be an object, a number or an array"),"data"in b&&(f(null===h||Array.isArray(h)||P(h)||ia(h),"invalid data for buffer"),h=b.data),"usage"in b&&(f.parameter(b.usage,db,"invalid buffer usage"),c=db[b.usage]),"type"in b&&(f.parameter(b.type,La,"invalid buffer type"),q=La[b.type]),"dimension"in
b&&(f.type(b.dimension,"number","invalid dimension"),g=b.dimension|0),"length"in b&&(f.nni(e,"buffer length must be a nonnegative integer"),e=b.length|0));w.bind();h?n(w,h,c,q,g,r):(e&&a.bufferData(w.type,e,c),w.dtype=q||5121,w.usage=c,w.dimension=g,w.byteLength=e);d.profile&&(w.stats.size=w.byteLength*ja[w.dtype]);return m}function p(b,d){f(d+b.byteLength<=w.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+b.byteLength+" starting from offset "+d+" to a buffer of size "+
w.byteLength);a.bufferSubData(w.type,d,b)}b.bufferCount++;var w=new e(l);k[w.id]=w;u||m(c);m._reglType="buffer";m._buffer=w;m.subdata=function(a,b){var d=(b||0)|0,h;w.bind();if(P(a)||a instanceof ArrayBuffer)p(a,d);else if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var c=I.allocType(w.dtype,a.length);Bb(c,a);p(c,d);I.freeType(c)}else Array.isArray(a[0])||P(a[0])?(h=Db(a),c=lb(a,h,w.dtype),p(c,d),I.freeType(c)):f.raise("invalid buffer data")}else if(ia(a)){h=a.shape;var e=a.stride,
z=c=0,q=0,g=0;1===h.length?(c=h[0],z=1,q=e[0],g=0):2===h.length?(c=h[0],z=h[1],q=e[0],g=e[1]):f.raise("invalid shape");h=Array.isArray(a.data)?w.dtype:bb(a.data);h=I.allocType(h,c*z);Cb(h,a.data,c,z,q,g,a.offset);p(h,d);I.freeType(h)}else f.raise("invalid data for buffer subdata");return m};d.profile&&(m.stats=w.stats);m.destroy=function(){g(w)};return m},createStream:function(a,b){var f=t.pop();f||(f=new e(a));f.bind();n(f,b,35040,0,1,!1);return f},destroyStream:function(a){t.push(a)},clear:function(){ba(k).forEach(g);
t.forEach(g)},getBuffer:function(a){return a&&a._buffer instanceof e?a._buffer:null},restore:function(){ba(k).forEach(function(b){b.buffer=a.createBuffer();a.bindBuffer(b.type,b.buffer);a.bufferData(b.type,b.persistentData||b.byteLength,b.usage)})},_initBuffer:n}}function cc(a,b,d,c){function e(a){this.id=p++;g[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function l(c,e,g,r,m,k,w){c.buffer.bind();var l;e?((l=w)||P(e)&&(!ia(e)||P(e.data))||(l=b.oes_element_index_uint?5125:
5123),d._initBuffer(c.buffer,e,g,l,3)):(a.bufferData(34963,k,g),c.buffer.dtype=l||5121,c.buffer.usage=g,c.buffer.dimension=3,c.buffer.byteLength=k);l=w;if(!w){switch(c.buffer.dtype){case 5121:case 5120:l=5121;break;case 5123:case 5122:l=5123;break;case 5125:case 5124:l=5125;break;default:f.raise("unsupported type for element array")}c.buffer.dtype=l}c.type=l;f(5125!==l||!!b.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");e=m;0>e&&(e=c.buffer.byteLength,
5123===l?e>>=1:5125===l&&(e>>=2));c.vertCount=e;e=r;0>r&&(e=4,r=c.buffer.dimension,1===r&&(e=0),2===r&&(e=1),3===r&&(e=4));c.primType=e}function n(a){c.elementsCount--;f(null!==a.buffer,"must not double destroy elements");delete g[a.id];a.buffer.destroy();a.buffer=null}var g={},p=0,k={uint8:5121,uint16:5123};b.oes_element_index_uint&&(k.uint32=5125);e.prototype.bind=function(){this.buffer.bind()};var t=[];return{create:function(a,b){function h(a){if(a)if("number"===typeof a)g(a),m.primType=4,m.vertCount=
a|0,m.type=5121;else{var b=null,d=35044,c=-1,e=-1,z=0,p=0;if(Array.isArray(a)||P(a)||ia(a))b=a;else if(f.type(a,"object","invalid arguments for elements"),"data"in a&&(b=a.data,f(Array.isArray(b)||P(b)||ia(b),"invalid data for element buffer")),"usage"in a&&(f.parameter(a.usage,db,"invalid element buffer usage"),d=db[a.usage]),"primitive"in a&&(f.parameter(a.primitive,Pa,"invalid element buffer primitive"),c=Pa[a.primitive]),"count"in a&&(f("number"===typeof a.count&&0<=a.count,"invalid vertex count for elements"),
e=a.count|0),"type"in a&&(f.parameter(a.type,k,"invalid buffer type"),p=k[a.type]),"length"in a)z=a.length|0;else if(z=e,5123===p||5122===p)z*=2;else if(5125===p||5124===p)z*=4;l(m,b,d,c,e,z,p)}else g(),m.primType=4,m.vertCount=0,m.type=5121;return h}var g=d.create(null,34963,!0),m=new e(g._buffer);c.elementsCount++;h(a);h._reglType="elements";h._elements=m;h.subdata=function(a,b){g.subdata(a,b);return h};h.destroy=function(){n(m)};return h},createStream:function(a){var b=t.pop();b||(b=new e(d.create(null,
34963,!0,!1)._buffer));l(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){t.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof e?a._elements:null},clear:function(){ba(g).forEach(n)}}}function Eb(a){for(var b=I.allocType(5123,a.length),f=0;f<a.length;++f)if(isNaN(a[f]))b[f]=65535;else if(Infinity===a[f])b[f]=31744;else if(-Infinity===a[f])b[f]=64512;else{Fb[0]=a[f];var d=dc[0],c=d>>>31<<15,e=(d<<1>>>24)-127,d=d>>13&1023;b[f]=-24>e?c:-14>e?c+(d+1024>>-14-e):
15<e?c+31744:c+(e+15<<10)+d}return b}function M(a){return Array.isArray(a)||P(a)}function Qa(a){return"[object "+a+"]"}function Gb(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function Hb(a){return Array.isArray(a)&&0!==a.length&&M(a[0])?!0:!1}function pa(a){return Object.prototype.toString.call(a)}function nb(a){if(!a)return!1;var b=pa(a);return 0<=ec.indexOf(b)?!0:Gb(a)||Hb(a)||ia(a)}function Ib(a,b){36193===a.type?(a.data=Eb(b),I.freeType(b)):a.data=b}function eb(a,b,f,d,
c,e){a="undefined"!==typeof N[a]?N[a]:ca[a]*Ra[b];e&&(a*=6);if(c){for(d=0;1<=f;)d+=a*f*f,f/=2;return d}return a*f*d}function fc(a,b,d,c,e,l,n){function g(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.colorSpace=37444;this.channels=this.height=this.width=0}function p(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;
a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function k(a,c){if("object"===typeof c&&c){"premultiplyAlpha"in c&&(f.type(c.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),a.premultiplyAlpha=c.premultiplyAlpha);"flipY"in c&&(f.type(c.flipY,"boolean","invalid texture flip"),a.flipY=c.flipY);"alignment"in c&&(f.oneOf(c.alignment,[1,2,4,8],"invalid texture unpack alignment"),a.unpackAlignment=c.alignment);"colorSpace"in c&&
(f.parameter(c.colorSpace,Jb,"invalid colorSpace"),a.colorSpace=Jb[c.colorSpace]);if("type"in c){var e=c.type;f(b.oes_texture_float||!("float"===e||"float32"===e),"you must enable the OES_texture_float extension in order to use floating point textures.");f(b.oes_texture_half_float||!("half float"===e||"float16"===e),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");f(b.webgl_depth_texture||!("uint16"===e||"uint32"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");
f.parameter(e,ga,"invalid texture type");a.type=ga[e]}var m=a.width,g=a.height,k=a.channels,e=!1;"shape"in c?(f(Array.isArray(c.shape)&&2<=c.shape.length,"shape must be an array"),m=c.shape[0],g=c.shape[1],3===c.shape.length&&(k=c.shape[2],f(0<k&&4>=k,"invalid number of channels"),e=!0),f(0<=m&&m<=d.maxTextureSize,"invalid width"),f(0<=g&&g<=d.maxTextureSize,"invalid height")):("radius"in c&&(m=g=c.radius,f(0<=m&&m<=d.maxTextureSize,"invalid radius")),"width"in c&&(m=c.width,f(0<=m&&m<=d.maxTextureSize,
"invalid width")),"height"in c&&(g=c.height,f(0<=g&&g<=d.maxTextureSize,"invalid height")),"channels"in c&&(k=c.channels,f(0<k&&4>=k,"invalid number of channels"),e=!0));a.width=m|0;a.height=g|0;a.channels=k|0;m=!1;"format"in c&&(m=c.format,f(b.webgl_depth_texture||!("depth"===m||"depth stencil"===m),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),f.parameter(m,X,"invalid texture format"),g=a.internalformat=X[m],a.format=T[g],m in ga&&!("type"in c)&&(a.type=
ga[m]),m in U&&(a.compressed=!0),m=!0);!e&&m?a.channels=ca[a.format]:e&&!m?a.channels!==fb[a.format]&&(a.format=a.internalformat=fb[a.channels]):m&&e&&f(a.channels===ca[a.format],"number of channels inconsistent with specified format")}}function t(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function q(){g.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=
!1}function S(a,b){var c=null;nb(b)?c=b:b&&(f.type(b,"object","invalid pixel data type"),k(a,b),"x"in b&&(a.xOffset=b.x|0),"y"in b&&(a.yOffset=b.y|0),nb(b.data)&&(c=b.data));f(!a.compressed||c instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(b.copy){f(!c,"can not specify copy and data field for the same texture");var h=e.viewportWidth,m=e.viewportHeight;a.width=a.width||h-a.xOffset;a.height=a.height||m-a.yOffset;a.needsCopy=!0;f(0<=a.xOffset&&a.xOffset<h&&0<=a.yOffset&&
a.yOffset<m&&0<a.width&&a.width<=h&&0<a.height&&a.height<=m,"copy texture read out of bounds")}else if(!c)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(P(c))a.channels=a.channels||4,a.data=c,"type"in b||5121!==a.type||(a.type=cb[Object.prototype.toString.call(c)]|0);else if(Gb(c)){a.channels=a.channels||4;h=c;m=h.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:m=I.allocType(a.type,m);m.set(h);a.data=m;break;case 36193:a.data=Eb(h);break;default:f.raise("unsupported texture type, must specify a typed array")}a.alignment=
1;a.needsFree=!0}else if(ia(c)){h=c.data;Array.isArray(h)||5121!==a.type||(a.type=cb[Object.prototype.toString.call(h)]|0);var m=c.shape,g=c.stride,p,w,l,r;3===m.length?(l=m[2],r=g[2]):(f(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),r=l=1);p=m[0];w=m[1];m=g[0];g=g[1];a.alignment=1;a.width=p;a.height=w;a.channels=l;a.format=a.internalformat=fb[l];a.needsFree=!0;p=r;c=c.offset;l=a.width;r=a.height;w=a.channels;for(var x=I.allocType(36193===a.type?5126:a.type,l*r*w),Z=0,Ma=0;Ma<r;++Ma)for(var Ba=
0;Ba<l;++Ba)for(var ob=0;ob<w;++ob)x[Z++]=h[m*Ba+g*Ma+p*ob+c];Ib(a,x)}else if(pa(c)===pb||pa(c)===qb||pa(c)===Kb)pa(c)===pb||pa(c)===qb?a.element=c:a.element=c.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if(pa(c)===Lb)a.element=c,a.width=c.width,a.height=c.height,a.channels=4;else if(pa(c)===Mb)a.element=c,a.width=c.naturalWidth,a.height=c.naturalHeight,a.channels=4;else if(pa(c)===Nb)a.element=c,a.width=c.videoWidth,a.height=c.videoHeight,a.channels=4;else if(Hb(c)){h=
a.width||c[0].length;m=a.height||c.length;g=a.channels;g=M(c[0][0])?g||c[0][0].length:g||1;p=gb.shape(c);l=1;for(r=0;r<p.length;++r)l*=p[r];l=I.allocType(36193===a.type?5126:a.type,l);gb.flatten(c,p,"",l);Ib(a,l);a.alignment=1;a.width=h;a.height=m;a.channels=g;a.format=a.internalformat=fb[g];a.needsFree=!0}5126===a.type?f(0<=d.extensions.indexOf("oes_texture_float"),"oes_texture_float extension not enabled"):36193===a.type&&f(0<=d.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}
function u(b,f,d,e,h){var m=b.element,g=b.data,l=b.internalformat,k=b.format,p=b.type,x=b.width,Z=b.height;t(b);m?a.texSubImage2D(f,h,d,e,k,p,m):b.compressed?a.compressedTexSubImage2D(f,h,d,e,l,x,Z,g):b.needsCopy?(c(),a.copyTexSubImage2D(f,h,d,e,b.xOffset,b.yOffset,x,Z)):a.texSubImage2D(f,h,d,e,x,Z,k,p,g)}function r(){return hb.pop()||new q}function m(a){a.needsFree&&I.freeType(a.data);q.call(a);hb.push(a)}function Ka(){g.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=
Array(16)}function w(a,b,f){var c=a.images[0]=r();a.mipmask=1;c.width=a.width=b;c.height=a.height=f;c.channels=a.channels=4}function L(a,b){var c=null;if(nb(b))c=a.images[0]=r(),p(c,a),S(c,b),a.mipmask=1;else if(k(a,b),Array.isArray(b.mipmap))for(var d=b.mipmap,e=0;e<d.length;++e)c=a.images[e]=r(),p(c,a),c.width>>=e,c.height>>=e,S(c,d[e]),a.mipmask|=1<<e;else c=a.images[0]=r(),p(c,a),S(c,b),a.mipmask=1;p(a,a.images[0]);!a.compressed||33776!==a.internalformat&&33777!==a.internalformat&&33778!==a.internalformat&&
33779!==a.internalformat||f(0===a.width%4&&0===a.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function v(b,f){for(var d=b.images,e=0;e<d.length&&d[e];++e){var h=d[e],m=f,g=e,l=h.element,k=h.data,p=h.internalformat,x=h.format,Z=h.type,Ma=h.width,Ba=h.height;t(h);l?a.texImage2D(m,g,x,x,Z,l):h.compressed?a.compressedTexImage2D(m,g,p,Ma,Ba,0,k):h.needsCopy?(c(),a.copyTexImage2D(m,g,x,h.xOffset,h.yOffset,Ma,Ba,0)):a.texImage2D(m,g,x,Ma,
Ba,0,x,Z,k||null)}}function B(){var a=O.pop()||new Ka;g.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function Da(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&m(b[c]),b[c]=null;O.push(a)}function Ea(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function A(a,b){if("min"in b){var c=b.min;f.parameter(c,ib);a.minFilter=ib[c];0<=gc.indexOf(a.minFilter)&&!("faces"in b)&&(a.genMipmaps=!0)}"mag"in b&&(c=b.mag,
f.parameter(c,Za),a.magFilter=Za[c]);var c=a.wrapS,e=a.wrapT;if("wrap"in b){var h=b.wrap;"string"===typeof h?(f.parameter(h,ua),c=e=ua[h]):Array.isArray(h)&&(f.parameter(h[0],ua),f.parameter(h[1],ua),c=ua[h[0]],e=ua[h[1]])}else"wrapS"in b&&(c=b.wrapS,f.parameter(c,ua),c=ua[c]),"wrapT"in b&&(e=b.wrapT,f.parameter(e,ua),e=ua[e]);a.wrapS=c;a.wrapT=e;"anisotropic"in b&&(c=b.anisotropic,f("number"===typeof c&&1<=c&&c<=d.maxAnisotropic,"aniso samples must be between 1 and "),a.anisotropic=b.anisotropic);
if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":f.parameter(b.mipmap,Q,"invalid mipmap hint");a.mipmapHint=Q[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":f(Array.isArray(b.mipmap),"invalid mipmap type");a.genMipmaps=!1;c=!0;break;default:f.raise("invalid mipmap type")}!c||"min"in b||(a.minFilter=9984)}}function y(c,f){a.texParameteri(f,10241,c.minFilter);a.texParameteri(f,10240,c.magFilter);a.texParameteri(f,10242,c.wrapS);a.texParameteri(f,
10243,c.wrapT);b.ext_texture_filter_anisotropic&&a.texParameteri(f,34046,c.anisotropic);c.genMipmaps&&(a.hint(33170,c.mipmapHint),a.generateMipmap(f))}function mb(b){g.call(this);this.mipmask=0;this.internalformat=6408;this.id=N++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new Ea;n.profile&&(this.stats={size:0})}function Oa(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function Sa(){var b=da[0];b?a.bindTexture(b.target,b.texture):
a.bindTexture(3553,null)}function D(b){var c=b.texture;f(c,"must not double destroy texture");var d=b.unit,e=b.target;0<=d&&(a.activeTexture(33984+d),a.bindTexture(e,null),da[d]=null);a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete E[b.id];l.textureCount--}var Q={"don't care":4352,"dont care":4352,nice:4354,fast:4353},ua={repeat:10497,clamp:33071,mirror:33648},Za={nearest:9728,linear:9729},ib=W({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,
"nearest mipmap linear":9986,"linear mipmap linear":9987},Za),Jb={none:0,browser:37444},ga={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},X={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},U={};b.ext_srgb&&(X.srgb=35904,X.srgba=35906);b.oes_texture_float&&(ga.float32=ga["float"]=5126);b.oes_texture_half_float&&(ga.float16=ga["half float"]=36193);b.webgl_depth_texture&&(W(X,{depth:6402,"depth stencil":34041}),W(ga,{uint16:5123,uint32:5125,
"depth stencil":34042}));b.webgl_compressed_texture_s3tc&&W(U,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});b.webgl_compressed_texture_atc&&W(U,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});b.webgl_compressed_texture_pvrtc&&W(U,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});b.webgl_compressed_texture_etc1&&(U["rgb etc1"]=36196);var C=Array.prototype.slice.call(a.getParameter(34467));
Object.keys(U).forEach(function(a){var b=U[a];0<=C.indexOf(b)&&(X[a]=b)});var J=Object.keys(X);d.textureFormats=J;var H=[];Object.keys(X).forEach(function(a){H[X[a]]=a});var G=[];Object.keys(ga).forEach(function(a){G[ga[a]]=a});var F=[];Object.keys(Za).forEach(function(a){F[Za[a]]=a});var ya=[];Object.keys(ib).forEach(function(a){ya[ib[a]]=a});var va=[];Object.keys(ua).forEach(function(a){va[ua[a]]=a});var T=J.reduce(function(a,c){var f=X[c];6409===f||6406===f||6409===f||6410===f||6402===f||34041===
f||b.ext_srgb&&(35904===f||35906===f)?a[f]=f:32855===f||0<=c.indexOf("rgba")?a[f]=6408:a[f]=6407;return a},{}),hb=[],O=[],N=0,E={},K=d.maxTextureUnits,da=Array(K).map(function(){return null});W(mb.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<K;++c){var d=da[c];if(d){if(0<d.bindCount)continue;d.unit=-1}da[c]=this;b=c;break}b>=K&&f.raise("insufficient number of texture units");n.profile&&l.maxTextureUnits<b+1&&(l.maxTextureUnits=b+1);this.unit=b;a.activeTexture(33984+
b);a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&D(this)}});n.profile&&(l.getTotalTextureSize=function(){var a=0;Object.keys(E).forEach(function(b){a+=E[b].stats.size});return a});return{create2D:function(b,c){function e(a,b){var c=h.texInfo;Ea.call(c);var m=B();"number"===typeof a?"number"===typeof b?w(m,a|0,b|0):w(m,a|0,a|0):a?(f.type(a,"object","invalid arguments to regl.texture"),A(c,a),L(m,a)):w(m,1,1);c.genMipmaps&&
(m.mipmask=(m.width<<1)-1);h.mipmask=m.mipmask;p(h,m);f.texture2D(c,m,d);h.internalformat=m.internalformat;e.width=m.width;e.height=m.height;Oa(h);v(m,3553);y(c,3553);Sa();Da(m);n.profile&&(h.stats.size=eb(h.internalformat,h.type,m.width,m.height,c.genMipmaps,!1));e.format=H[h.internalformat];e.type=G[h.type];e.mag=F[c.magFilter];e.min=ya[c.minFilter];e.wrapS=va[c.wrapS];e.wrapT=va[c.wrapT];return e}var h=new mb(3553);E[h.id]=h;l.textureCount++;e(b,c);e.subimage=function(a,b,c,d){f(!!a,"must specify image data");
b|=0;c|=0;d|=0;var g=r();p(g,h);g.width=0;g.height=0;S(g,a);g.width=g.width||(h.width>>d)-b;g.height=g.height||(h.height>>d)-c;f(h.type===g.type&&h.format===g.format&&h.internalformat===g.internalformat,"incompatible format for texture.subimage");f(0<=b&&0<=c&&b+g.width<=h.width&&c+g.height<=h.height,"texture.subimage write out of bounds");f(h.mipmask&1<<d,"missing mipmap data");f(g.data||g.element||g.needsCopy,"missing image data");Oa(h);u(g,3553,b,c,d);Sa();m(g);return e};e.resize=function(b,c){var f=
b|0,d=c|0||f;if(f===h.width&&d===h.height)return e;e.width=h.width=f;e.height=h.height=d;Oa(h);for(var m=0;h.mipmask>>m;++m){var g=f>>m,x=d>>m;if(!g||!x)break;a.texImage2D(3553,m,h.format,g,x,0,h.format,h.type,null)}Sa();n.profile&&(h.stats.size=eb(h.internalformat,h.type,f,d,!1,!1));return e};e._reglType="texture2d";e._texture=h;n.profile&&(e.stats=h.stats);e.destroy=function(){h.decRef()};return e},createCube:function(b,c,e,h,g,t){function q(a,b,c,e,h,m){var R,g=D.texInfo;Ea.call(g);for(R=0;6>R;++R)Q[R]=
B();if("number"!==typeof a&&a)if("object"===typeof a)if(b)L(Q[0],a),L(Q[1],b),L(Q[2],c),L(Q[3],e),L(Q[4],h),L(Q[5],m);else if(A(g,a),k(D,a),"faces"in a)for(a=a.faces,f(Array.isArray(a)&&6===a.length,"cube faces must be a length 6 array"),R=0;6>R;++R)f("object"===typeof a[R]&&!!a[R],"invalid input for cube map face"),p(Q[R],D),L(Q[R],a[R]);else for(R=0;6>R;++R)L(Q[R],a);else f.raise("invalid arguments to cube map");else for(a=a|0||1,R=0;6>R;++R)w(Q[R],a,a);p(D,Q[0]);d.npotTextureCube||f(Ob(D.width)&&
Ob(D.height),"your browser does not support non power or two texture dimensions");D.mipmask=g.genMipmaps?(Q[0].width<<1)-1:Q[0].mipmask;f.textureCube(D,g,Q,d);D.internalformat=Q[0].internalformat;q.width=Q[0].width;q.height=Q[0].height;Oa(D);for(R=0;6>R;++R)v(Q[R],34069+R);y(g,34067);Sa();n.profile&&(D.stats.size=eb(D.internalformat,D.type,q.width,q.height,g.genMipmaps,!0));q.format=H[D.internalformat];q.type=G[D.type];q.mag=F[g.magFilter];q.min=ya[g.minFilter];q.wrapS=va[g.wrapS];q.wrapT=va[g.wrapT];
for(R=0;6>R;++R)Da(Q[R]);return q}var D=new mb(34067);E[D.id]=D;l.cubeCount++;var Q=Array(6);q(b,c,e,h,g,t);q.subimage=function(a,b,c,d,e){f(!!b,"must specify image data");f("number"===typeof a&&a===(a|0)&&0<=a&&6>a,"invalid face");c|=0;d|=0;e|=0;var h=r();p(h,D);h.width=0;h.height=0;S(h,b);h.width=h.width||(D.width>>e)-c;h.height=h.height||(D.height>>e)-d;f(D.type===h.type&&D.format===h.format&&D.internalformat===h.internalformat,"incompatible format for texture.subimage");f(0<=c&&0<=d&&c+h.width<=
D.width&&d+h.height<=D.height,"texture.subimage write out of bounds");f(D.mipmask&1<<e,"missing mipmap data");f(h.data||h.element||h.needsCopy,"missing image data");Oa(D);u(h,34069+a,c,d,e);Sa();m(h);return q};q.resize=function(b){b|=0;if(b!==D.width){q.width=D.width=b;q.height=D.height=b;Oa(D);for(var c=0;6>c;++c)for(var f=0;D.mipmask>>f;++f)a.texImage2D(34069+c,f,D.format,b>>f,b>>f,0,D.format,D.type,null);Sa();n.profile&&(D.stats.size=eb(D.internalformat,D.type,q.width,q.height,!1,!0));return q}};
q._reglType="textureCube";q._texture=D;n.profile&&(q.stats=D.stats);q.destroy=function(){D.decRef()};return q},clear:function(){for(var b=0;b<K;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),da[b]=null;ba(E).forEach(D);l.cubeCount=0;l.textureCount=0},getTexture:function(a){return null},restore:function(){for(var b=0;b<K;++b){var c=da[b];c&&(c.bindCount=0,c.unit=-1,da[b]=null)}ba(E).forEach(function(b){b.texture=a.createTexture();a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!==
(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var f=0;6>f;++f)a.texImage2D(34069+f,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);y(b.texInfo,b.target)})}}}function hc(a,b,c,d,e,l){function n(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var f=a=0;b?(a=b.width,f=b.height):c&&(a=c.width,f=c.height);this.width=a;this.height=f}function g(a){a&&(a.texture&&a.texture._texture.decRef(),
a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function p(a,b,c){if(a){if(a.texture){a=a.texture._texture;var d=Math.max(1,a.height);f(Math.max(1,a.width)===b&&d===c,"inconsistent width/height for supplied texture")}else a=a.renderbuffer._renderbuffer,f(a.width===b&&a.height===c,"inconsistent width/height for renderbuffer");a.refCount+=1}}function k(b,c){c&&(c.texture?a.framebufferTexture2D(36160,b,c.target,c.texture._texture.texture,0):a.framebufferRenderbuffer(36160,b,36161,c.renderbuffer._renderbuffer.renderbuffer))}
function t(a){var b=3553,c=null,d=null,e=a;"object"===typeof a&&(e=a.data,"target"in a&&(b=a.target|0));f.type(e,"function","invalid attachment data");a=e._reglType;"texture2d"===a?(c=e,f(3553===b)):"textureCube"===a?(c=e,f(34069<=b&&34075>b,"invalid cube map target")):"renderbuffer"===a?(d=e,b=36161):f.raise("invalid regl object for attachment");return new n(b,c,d)}function q(a,b,c,f,h){if(c)return a=d.create2D({width:a,height:b,format:f,type:h}),a._texture.refCount=0,new n(3553,a,null);a=e.create({width:a,
height:b,format:f});a._renderbuffer.refCount=0;return new n(36161,null,a)}function S(a){return a&&(a.texture||a.renderbuffer)}function u(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c),a.width=b,a.height=c)}function r(){this.id=A++;y[this.id]=this;this.framebuffer=a.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function m(a){a.colorAttachments.forEach(g);g(a.depthAttachment);
g(a.stencilAttachment);g(a.depthStencilAttachment)}function v(b){var c=b.framebuffer;f(c,"must not double destroy framebuffer");a.deleteFramebuffer(c);b.framebuffer=null;l.framebufferCount--;delete y[b.id]}function w(b){var d;a.bindFramebuffer(36160,b.framebuffer);var e=b.colorAttachments;for(d=0;d<e.length;++d)k(36064+d,e[d]);for(d=e.length;d<c.maxColorAttachments;++d)a.framebufferTexture2D(36160,36064+d,3553,null,0);a.framebufferTexture2D(36160,33306,3553,null,0);a.framebufferTexture2D(36160,36096,
3553,null,0);a.framebufferTexture2D(36160,36128,3553,null,0);k(36096,b.depthAttachment);k(36128,b.stencilAttachment);k(33306,b.depthStencilAttachment);b=a.checkFramebufferStatus(36160);a.isContextLost()||36053===b||f.raise("framebuffer configuration not supported, status = "+ic[b]);a.bindFramebuffer(36160,ta.next?ta.next.framebuffer:null);ta.cur=ta.next;a.getError()}function L(a,d){function e(a,d){var l;f(ta.next!==g,"can not update framebuffer which is currently in use");var k=0,r=0,n=!0,L=!0;l=
null;var u=!0,na="rgba",wa="uint8",v=1,Ka=null,sa=null,ya=null,va=!1;if("number"===typeof a)k=a|0,r=d|0||k;else if(a){f.type(a,"object","invalid arguments for framebuffer");"shape"in a?(r=a.shape,f(Array.isArray(r)&&2<=r.length,"invalid shape for framebuffer"),k=r[0],r=r[1]):("radius"in a&&(k=r=a.radius),"width"in a&&(k=a.width),"height"in a&&(r=a.height));if("color"in a||"colors"in a)l=a.color||a.colors,Array.isArray(l)&&f(1===l.length||b.webgl_draw_buffers,"multiple render targets not supported");
if(!l){"colorCount"in a&&(v=a.colorCount|0,f(0<v,"invalid color buffer count"));"colorTexture"in a&&(u=!!a.colorTexture,na="rgba4");if("colorType"in a){wa=a.colorType;if(u)f(b.oes_texture_float||!("float"===wa||"float32"===wa),"you must enable OES_texture_float in order to use floating point framebuffer objects"),f(b.oes_texture_half_float||!("half float"===wa||"float16"===wa),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===
wa||"float16"===wa)f(b.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),na="rgba16f";else if("float"===wa||"float32"===wa)f(b.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),na="rgba32f";f.oneOf(wa,Ea,"invalid color type")}if("colorFormat"in a)if(na=a.colorFormat,0<=B.indexOf(na))u=!0;else if(0<=Da.indexOf(na))u=!1;else if(u)f.oneOf(a.colorFormat,B,"invalid color format for texture");
else f.oneOf(a.colorFormat,Da,"invalid color format for renderbuffer")}if("depthTexture"in a||"depthStencilTexture"in a)va=!(!a.depthTexture&&!a.depthStencilTexture),f(!va||b.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in a&&("boolean"===typeof a.depth?n=a.depth:(Ka=a.depth,L=!1));"stencil"in a&&("boolean"===typeof a.stencil?L=a.stencil:(sa=a.stencil,n=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?n=L=a.depthStencil:(ya=a.depthStencil,L=n=!1))}else k=r=
1;var T=null,y=null,A=null,C=null;if(Array.isArray(l))T=l.map(t);else if(l)T=[t(l)];else for(T=Array(v),l=0;l<v;++l)T[l]=q(k,r,u,na,wa);f(b.webgl_draw_buffers||1>=T.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");f(T.length<=c.maxColorAttachments,"too many color attachments, not supported");k=k||T[0].width;r=r||T[0].height;Ka?y=t(Ka):n&&!L&&(y=q(k,r,va,"depth","uint32"));sa?A=t(sa):L&&!n&&(A=q(k,r,!1,"stencil","uint8"));ya?C=t(ya):!Ka&&!sa&&L&&n&&
(C=q(k,r,va,"depth stencil","depth stencil"));f(1>=!!Ka+!!sa+!!ya,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");n=null;for(l=0;l<T.length;++l)p(T[l],k,r),f(!T[l]||T[l].texture&&0<=jc.indexOf(T[l].texture._texture.format)||T[l].renderbuffer&&0<=kc.indexOf(T[l].renderbuffer._renderbuffer.format),"framebuffer color attachment "+l+" is invalid"),T[l]&&T[l].texture&&(L=rb[T[l].texture._texture.format]*jb[T[l].texture._texture.type],null===n?n=L:f(n===L,"all color attachments much have the same number of bits per pixel."));
p(y,k,r);f(!y||y.texture&&6402===y.texture._texture.format||y.renderbuffer&&33189===y.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object");p(A,k,r);f(!A||A.renderbuffer&&36168===A.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");p(C,k,r);f(!C||C.texture&&34041===C.texture._texture.format||C.renderbuffer&&34041===C.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");m(g);g.width=k;g.height=
r;g.colorAttachments=T;g.depthAttachment=y;g.stencilAttachment=A;g.depthStencilAttachment=C;e.color=T.map(S);e.depth=S(y);e.stencil=S(A);e.depthStencil=S(C);e.width=g.width;e.height=g.height;w(g);return e}var g=new r;l.framebufferCount++;e(a,d);return W(e,{resize:function(a,b){f(ta.next!==g,"can not resize a framebuffer which is currently in use");var c=Math.max(a|0,1),d=Math.max(b|0||c,1);if(c===g.width&&d===g.height)return e;for(var h=g.colorAttachments,m=0;m<h.length;++m)u(h[m],c,d);u(g.depthAttachment,
c,d);u(g.stencilAttachment,c,d);u(g.depthStencilAttachment,c,d);g.width=e.width=c;g.height=e.height=d;w(g);return e},_reglType:"framebuffer",_framebuffer:g,destroy:function(){v(g);m(g)},use:function(a){ta.setFBO({framebuffer:e},a)}})}var ta={cur:null,next:null,dirty:!1,setFBO:null},B=["rgba"],Da=["rgba4","rgb565","rgb5 a1"];b.ext_srgb&&Da.push("srgba");b.ext_color_buffer_half_float&&Da.push("rgba16f","rgb16f");b.webgl_color_buffer_float&&Da.push("rgba32f");var Ea=["uint8"];b.oes_texture_half_float&&
Ea.push("half float","float16");b.oes_texture_float&&Ea.push("float","float32");var A=0,y={};return W(ta,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof r)?a:null},create:L,createCube:function(a){function e(a){var c;f(0>m.indexOf(ta.next),"can not update framebuffer which is currently in use");var g={color:null},l=0,k=null;c="rgba";var r="uint8",p=1;if("number"===typeof a)l=a|0;else if(a){f.type(a,"object","invalid arguments for framebuffer");
"shape"in a?(l=a.shape,f(Array.isArray(l)&&2<=l.length,"invalid shape for framebuffer"),f(l[0]===l[1],"cube framebuffer must be square"),l=l[0]):("radius"in a&&(l=a.radius|0),"width"in a?(l=a.width|0,"height"in a&&f(a.height===l,"must be square")):"height"in a&&(l=a.height|0));if("color"in a||"colors"in a)k=a.color||a.colors,Array.isArray(k)&&f(1===k.length||b.webgl_draw_buffers,"multiple render targets not supported");k||("colorCount"in a&&(p=a.colorCount|0,f(0<p,"invalid color buffer count")),"colorType"in
a&&(f.oneOf(a.colorType,Ea,"invalid color type"),r=a.colorType),"colorFormat"in a&&(c=a.colorFormat,f.oneOf(a.colorFormat,B,"invalid color format for texture")));"depth"in a&&(g.depth=a.depth);"stencil"in a&&(g.stencil=a.stencil);"depthStencil"in a&&(g.depthStencil=a.depthStencil)}else l=1;if(k)if(Array.isArray(k))for(a=[],c=0;c<k.length;++c)a[c]=k[c];else a=[k];else for(a=Array(p),k={radius:l,format:c,type:r},c=0;c<p;++c)a[c]=d.createCube(k);g.color=Array(a.length);for(c=0;c<a.length;++c)p=a[c],
f("function"===typeof p&&"textureCube"===p._reglType,"invalid cube map"),l=l||p.width,f(p.width===l&&p.height===l,"invalid cube map shape"),g.color[c]={target:34069,data:a[c]};for(c=0;6>c;++c){for(p=0;p<a.length;++p)g.color[p].target=34069+c;0<c&&(g.depth=m[0].depth,g.stencil=m[0].stencil,g.depthStencil=m[0].depthStencil);if(m[c])m[c](g);else m[c]=L(g)}return W(e,{width:l,height:l,color:a})}var m=Array(6);e(a);return W(e,{faces:m,resize:function(a){var b=a|0;f(0<b&&b<=c.maxCubeMapSize,"invalid radius for cube fbo");
if(b===e.width)return e;var d=e.color;for(a=0;a<d.length;++a)d[a].resize(b);for(a=0;6>a;++a)m[a].resize(b);e.width=e.height=b;return e},_reglType:"framebufferCube",destroy:function(){m.forEach(function(a){a.destroy()})}})},clear:function(){ba(y).forEach(v)},restore:function(){ta.cur=null;ta.next=null;ta.dirty=!0;ba(y).forEach(function(b){b.framebuffer=a.createFramebuffer();w(b)})}})}function sb(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;
this.divisor=this.stride=this.offset=0}function lc(a,b,c,d,e){function l(a){if(a!==r.currentVAO){var c=b.oes_vertex_array_object;a?c.bindVertexArrayOES(a.vao):c.bindVertexArrayOES(null);r.currentVAO=a}}function n(c){if(c!==r.currentVAO){if(c)c.bindAttrs();else for(var f=b.angle_instanced_arrays,d=0;d<q.length;++d){var e=q[d];e.buffer?(a.enableVertexAttribArray(d),a.vertexAttribPointer(d,e.size,e.type,e.normalized,e.stride,e.offfset),f&&f.vertexAttribDivisorANGLE(d,e.divisor)):(a.disableVertexAttribArray(d),
a.vertexAttrib4f(d,e.x,e.y,e.z,e.w))}r.currentVAO=c}}function g(){ba(u).forEach(function(a){a.destroy()})}function p(){this.id=++S;this.attributes=[];var a=b.oes_vertex_array_object;this.vao=a?a.createVertexArrayOES():null;u[this.id]=this;this.buffers=[]}function k(){b.oes_vertex_array_object&&ba(u).forEach(function(a){a.refresh()})}var t=c.maxAttributes,q=Array(t);for(c=0;c<t;++c)q[c]=new sb;var S=0,u={},r={Record:sb,scope:{},state:q,currentVAO:null,targetVAO:null,restore:b.oes_vertex_array_object?
k:function(){},createVAO:function(a){function c(a){f(Array.isArray(a),"arguments to vertex array constructor must be an array");f(a.length<t,"too many attributes");f(0<a.length,"must specify at least one attribute");for(var d=0;d<g.buffers.length;++d)g.buffers[d].destroy();g.buffers.length=0;d=g.attributes;d.length=a.length;for(var m=0;m<a.length;++m){var l=a[m],k=d[m]=new sb;Array.isArray(l)||P(l)||ia(l)?(l=e.create(l,34962,!1,!0),k.buffer=e.getBuffer(l),k.size=k.buffer.dimension|0,k.normalized=
!1,k.type=k.buffer.dtype,k.offset=0,k.stride=0,k.divisor=0,k.state=1,g.buffers.push(l)):e.getBuffer(l)?(k.buffer=e.getBuffer(l),k.size=k.buffer.dimension|0,k.normalized=!1,k.type=k.buffer.dtype,k.offset=0,k.stride=0,k.divisor=0,k.state=1):e.getBuffer(l.buffer)?(k.buffer=e.getBuffer(l.buffer),k.size=(+l.size||k.buffer.dimension)|0,k.normalized=!!l.normalized||!1,"type"in l?(f.parameter(l.type,La,"invalid buffer type"),k.type=La[l.type]):k.type=k.buffer.dtype,k.offset=(l.offset||0)|0,k.stride=(l.stride||
0)|0,k.divisor=(l.divisor||0)|0,k.state=1,f(1<=k.size&&4>=k.size,"size must be between 1 and 4"),f(0<=k.offset,"invalid offset"),f(0<=k.stride&&255>=k.stride,"stride must be between 0 and 255"),f(0<=k.divisor,"divisor must be positive"),f(!k.divisor||!!b.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in l?(f(0<m,"first attribute must not be a constant"),k.x=+l.x||0,k.y=+l.y||0,k.z=+l.z||0,k.w=+l.w||0,k.state=2):f(!1,"invalid attribute spec for location "+m)}g.refresh();
return c}var g=new p;d.vaoCount+=1;c.destroy=function(){g.destroy()};c._vao=g;c._reglType="vao";return c(a)},getVAO:function(a){return"function"===typeof a&&a._vao?a._vao:null},destroyBuffer:function(b){for(var c=0;c<q.length;++c){var d=q[c];d.buffer===b&&(a.disableVertexAttribArray(c),d.buffer=null)}},setVAO:b.oes_vertex_array_object?l:n,clear:b.oes_vertex_array_object?g:function(){}};p.prototype.bindAttrs=function(){for(var c=b.angle_instanced_arrays,d=this.attributes,f=0;f<d.length;++f){var e=
d[f];e.buffer?(a.enableVertexAttribArray(f),a.bindBuffer(34962,e.buffer.buffer),a.vertexAttribPointer(f,e.size,e.type,e.normalized,e.stride,e.offset),c&&c.vertexAttribDivisorANGLE(f,e.divisor)):(a.disableVertexAttribArray(f),a.vertexAttrib4f(f,e.x,e.y,e.z,e.w))}for(c=d.length;c<t;++c)a.disableVertexAttribArray(c)};p.prototype.refresh=function(){var a=b.oes_vertex_array_object;a&&(a.bindVertexArrayOES(this.vao),this.bindAttrs(),r.currentVAO=this)};p.prototype.destroy=function(){if(this.vao){var a=
b.oes_vertex_array_object;this===r.currentVAO&&(r.currentVAO=null,a.bindVertexArrayOES(null));a.deleteVertexArrayOES(this.vao);this.vao=null}u[this.id]&&(delete u[this.id],--d.vaoCount)};return r}function mc(a,b,c,d){function e(a,b,c,d){this.name=a;this.id=b;this.location=c;this.info=d}function l(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function n(c,d,e){var g=35632===c?k:t,l=g[d];if(!l){var p=b.str(d),l=a.createShader(c);a.shaderSource(l,p);a.compileShader(l);
f.shaderError(a,l,p,c,e);g[d]=l}return l}function g(a,b){this.id=u++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];d.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(c,g,k){var p;p=n(35632,c.fragId);var q=n(35633,c.vertId),z=c.program=a.createProgram();a.attachShader(z,p);a.attachShader(z,q);if(k)for(p=0;p<k.length;++p)q=k[p],a.bindAttribLocation(z,q[0],q[1]);a.linkProgram(z);f.linkError(a,z,b.str(c.fragId),b.str(c.vertId),g);k=a.getProgramParameter(z,
35718);d.profile&&(c.stats.uniformsCount=k);q=c.uniforms;for(p=0;p<k;++p)if(g=a.getActiveUniform(z,p))if(1<g.size)for(var t=0;t<g.size;++t){var u=g.name.replace("[0]","["+t+"]");l(q,new e(u,b.id(u),a.getUniformLocation(z,u),g))}else l(q,new e(g.name,b.id(g.name),a.getUniformLocation(z,g.name),g));k=a.getProgramParameter(z,35721);d.profile&&(c.stats.attributesCount=k);c=c.attributes;for(p=0;p<k;++p)(g=a.getActiveAttrib(z,p))&&l(c,new e(g.name,b.id(g.name),a.getAttribLocation(z,g.name),g))}var k={},
t={},q={},S=[],u=0;d.profile&&(c.getMaxUniformsCount=function(){var a=0;S.forEach(function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)});return a},c.getMaxAttributesCount=function(){var a=0;S.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});return{clear:function(){var b=a.deleteShader.bind(a);ba(k).forEach(b);k={};ba(t).forEach(b);t={};S.forEach(function(b){a.deleteProgram(b.program)});S.length=0;q={};c.shaderCount=0},program:function(a,b,d,e){f.command(0<=
a,"missing vertex shader",d);f.command(0<=b,"missing fragment shader",d);var h=q[b];h||(h=q[b]={});var l=h[a];if(l&&!e)return l;b=new g(b,a);c.shaderCount++;p(b,d,e);l||(h[a]=b);S.push(b);return b},restore:function(){k={};t={};for(var a=0;a<S.length;++a)p(S[a],null,S[a].attributes.map(function(a){return[a.location,a.name]}))},shader:n,frag:-1,vert:-1}}function nc(a,b,c,d,e,l,n){function g(g){var p;null===b.next?(f(e.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),
p=5121):(f(null!==b.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),p=b.next.colorAttachments[0].texture._texture.type,l.oes_texture_float?(f(5121===p||5126===p,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),5126===p&&f(n.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):f(5121===p,"Reading from a framebuffer is only allowed for the type 'uint8'"));
var q=0,S=0,u=d.framebufferWidth,r=d.framebufferHeight,m=null;P(g)?m=g:g&&(f.type(g,"object","invalid arguments to regl.read()"),q=g.x|0,S=g.y|0,f(0<=q&&q<d.framebufferWidth,"invalid x offset for regl.read"),f(0<=S&&S<d.framebufferHeight,"invalid y offset for regl.read"),u=(g.width||d.framebufferWidth-q)|0,r=(g.height||d.framebufferHeight-S)|0,m=g.data||null);m&&(5121===p?f(m instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===p&&f(m instanceof
Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));f(0<u&&u+q<=d.framebufferWidth,"invalid width for read pixels");f(0<r&&r+S<=d.framebufferHeight,"invalid height for read pixels");c();g=u*r*4;m||(5121===p?m=new Uint8Array(g):5126===p&&(m=m||new Float32Array(g)));f.isTypedArray(m,"data buffer for regl.read() must be a typedarray");f(m.byteLength>=g,"data buffer for regl.read() too small");a.pixelStorei(3333,4);a.readPixels(q,S,u,r,6408,p,m);return m}function p(a){var c;
b.setFBO({framebuffer:a.framebuffer},function(){c=g(a)});return c}return function(a){return a&&"framebuffer"in a?p(a):g(a)}}function Ta(a){return Array.prototype.slice.call(a)}function Ua(a){return Ta(a).join("")}function oc(){function a(){var a=[],b=[];return W(function(){a.push.apply(a,Ta(arguments))},{def:function(){var d="v"+c++;b.push(d);0<arguments.length&&(a.push(d,"="),a.push.apply(a,Ta(arguments)),a.push(";"));return d},toString:function(){return Ua([0<b.length?"var "+b.join(",")+";":"",
Ua(a)])}})}function b(){function c(a,b){f(a,b,"=",d.def(a,b),";")}var d=a(),f=a(),e=d.toString,h=f.toString;return W(function(){d.apply(d,Ta(arguments))},{def:d.def,entry:d,exit:f,save:c,set:function(a,b,f){c(a,b);d(a,b,"=",f,";")},toString:function(){return e()+h()}})}var c=0,d=[],f=[],e=a(),n={};return{global:e,link:function(a){for(var b=0;b<f.length;++b)if(f[b]===a)return d[b];b="g"+c++;d.push(b);f.push(a);return b},block:a,proc:function(a,c){function d(){var a="a"+f.length;f.push(a);return a}
var f=[];c=c||0;for(var e=0;e<c;++e)d();var e=b(),l=e.toString;return n[a]=W(e,{arg:d,toString:function(){return Ua(["function(",f.join(),"){",l(),"}"])}})},scope:b,cond:function(){var a=Ua(arguments),c=b(),d=b(),f=c.toString,e=d.toString;return W(c,{then:function(){c.apply(c,Ta(arguments));return this},"else":function(){d.apply(d,Ta(arguments));return this},toString:function(){var b=e();b&&(b="else{"+b+"}");return Ua(["if(",a,"){",f(),"}",b])}})},compile:function(){var a=['"use strict";',e,"return {"];
Object.keys(n).forEach(function(b){a.push('"',b,'":',n[b].toString(),",")});a.push("}");var b=Ua(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,d.concat(b)).apply(null,f)}}}function kb(a){return Array.isArray(a)||P(a)||ia(a)}function Pb(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function qa(a,b,c,d){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=d}function Ia(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}
function G(a){return new qa(!1,!1,!1,a)}function ka(a,b){var c=a.type;return 0===c?(c=a.data.length,new qa(!0,1<=c,2<=c,b)):4===c?(c=a.data,new qa(c.thisDep,c.contextDep,c.propDep,b)):new qa(3===c,2===c,1===c,b)}function pc(a,b,c,d,e,l,n,g,p,k,t,q,v,u,r){function m(a){return a.replace(".","_")}function y(a,b,c){var d=m(a);Ya.push(a);Xa[d]=Fa[d]=!!c;Ga[d]=b}function w(a,b,c){var d=m(a);Ya.push(a);Array.isArray(c)?(Fa[d]=c.slice(),Xa[d]=c.slice()):Fa[d]=Xa[d]=c;Ha[d]=b}function L(){var a=oc(),c=a.link,
d=a.global;a.id=Ca++;a.batchId="0";var e=c(pa),g=a.shared={props:"a0"};Object.keys(pa).forEach(function(a){g[a]=d.def(e,".",a)});f.optional(function(){a.CHECK=c(f);a.commandStr=f.guessCommand();a.command=c(a.commandStr);a.assert=function(a,b,d){a("if(!(",b,"))",this.CHECK,".commandRaise(",c(d),",",this.command,");")};ja.invalidBlendCombinations=Qb});var l=a.next={},m=a.current={};Object.keys(Ha).forEach(function(a){Array.isArray(Fa[a])&&(l[a]=d.def(g.next,".",a),m[a]=d.def(g.current,".",a))});var qc=
a.constants={};Object.keys(ja).forEach(function(a){qc[a]=d.def(JSON.stringify(ja[a]))});a.invoke=function(b,d){switch(d.type){case 0:var f=["this",g.context,g.props,a.batchId];return b.def(c(d.data),".call(",f.slice(0,Math.max(d.data.length+1,4)),")");case 1:return b.def(g.props,d.data);case 2:return b.def(g.context,d.data);case 3:return b.def("this",d.data);case 4:return d.data.append(a,b),d.data.ref}};a.attribCache={};var V={};a.scopeAttrib=function(a){a=b.id(a);if(a in V)return V[a];var d=k.scope[a];
d||(d=k.scope[a]=new Y);return V[a]=c(d)};return a}function A(a){var b=a["static"];a=a.dynamic;var c;if("profile"in b){var d=!!b.profile;c=G(function(a,b){return d});c.enable=d}else if("profile"in a){var f=a.profile;c=ka(f,function(a,b){return a.invoke(b,f)})}return c}function B(a,b){var c=a["static"],d=a.dynamic;if("framebuffer"in c){var e=c.framebuffer;return e?(e=g.getFramebuffer(e),f.command(e,"invalid framebuffer object"),G(function(a,b){var c=a.link(e),d=a.shared;b.set(d.framebuffer,".next",
c);d=d.context;b.set(d,".framebufferWidth",c+".width");b.set(d,".framebufferHeight",c+".height");return c})):G(function(a,b){var c=a.shared;b.set(c.framebuffer,".next","null");c=c.context;b.set(c,".framebufferWidth",c+".drawingBufferWidth");b.set(c,".framebufferHeight",c+".drawingBufferHeight");return"null"})}if("framebuffer"in d){var h=d.framebuffer;return ka(h,function(a,b){var c=a.invoke(b,h),d=a.shared,e=d.framebuffer,x=b.def(e,".getFramebuffer(",c,")");f.optional(function(){a.assert(b,"!"+c+
"||"+x,"invalid framebuffer object")});b.set(e,".next",x);d=d.context;b.set(d,".framebufferWidth",x+"?"+x+".width:"+d+".drawingBufferWidth");b.set(d,".framebufferHeight",x+"?"+x+".height:"+d+".drawingBufferHeight");return x})}return null}function C(a,b,c){function d(a){if(a in e){var V=e[a];f.commandType(V,"object","invalid "+a,c.commandStr);var g=!0,ra=V.x|0,x=V.y|0,l,k;"width"in V?(l=V.width|0,f.command(0<=l,"invalid "+a,c.commandStr)):g=!1;"height"in V?(k=V.height|0,f.command(0<=k,"invalid "+a,
c.commandStr)):g=!1;return new qa(!g&&b&&b.thisDep,!g&&b&&b.contextDep,!g&&b&&b.propDep,function(a,b){var c=a.shared.context,d=l;"width"in V||(d=b.def(c,".","framebufferWidth","-",ra));var e=k;"height"in V||(e=b.def(c,".","framebufferHeight","-",x));return[ra,x,d,e]})}if(a in h){var m=h[a],g=ka(m,function(b,c){var d=b.invoke(c,m);f.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid "+a)});var e=b.shared.context,h=c.def(d,".x|0"),g=c.def(d,".y|0"),ra=c.def('"width" in ',d,"?",d,
".width|0:","(",e,".","framebufferWidth","-",h,")"),V=c.def('"height" in ',d,"?",d,".height|0:","(",e,".","framebufferHeight","-",g,")");f.optional(function(){b.assert(c,ra+">=0&&"+V+">=0","invalid "+a)});return[h,g,ra,V]});b&&(g.thisDep=g.thisDep||b.thisDep,g.contextDep=g.contextDep||b.contextDep,g.propDep=g.propDep||b.propDep);return g}return b?new qa(b.thisDep,b.contextDep,b.propDep,function(a,b){var c=a.shared.context;return[0,0,b.def(c,".","framebufferWidth"),b.def(c,".","framebufferHeight")]}):
null}var e=a["static"],h=a.dynamic;if(a=d("viewport")){var g=a;a=new qa(a.thisDep,a.contextDep,a.propDep,function(a,b){var c=g.append(a,b),d=a.shared.context;b.set(d,".viewportWidth",c[2]);b.set(d,".viewportHeight",c[3]);return c})}return{viewport:a,scissor_box:d("scissor.box")}}function J(a,b){var c=a["static"];if("string"===typeof c.frag&&"string"===typeof c.vert){if(0<Object.keys(b.dynamic).length)return null;var c=b["static"],d=Object.keys(c);if(0<d.length&&"number"===typeof c[d[0]]){for(var e=
[],h=0;h<d.length;++h)f("number"===typeof c[d[h]],"must specify all vertex attribute locations when using vaos"),e.push([c[d[h]]|0,d[h]]);return e}}return null}function H(a,c,d){function e(a){if(a in g){var c=b.id(g[a]);f.optional(function(){t.shader(Rb[a],c,f.guessCommand())});var d=G(function(){return c});d.id=c;return d}if(a in l){var V=l[a];return ka(V,function(b,c){var d=b.invoke(c,V),e=c.def(b.shared.strings,".id(",d,")");f.optional(function(){c(b.shared.shader,".shader(",Rb[a],",",e,",",b.command,
");")});return e})}return null}var g=a["static"],l=a.dynamic,k=e("frag"),m=e("vert"),V=null;Ia(k)&&Ia(m)?(V=t.program(m.id,k.id,null,d),a=G(function(a,b){return a.link(V)})):a=new qa(k&&k.thisDep||m&&m.thisDep,k&&k.contextDep||m&&m.contextDep,k&&k.propDep||m&&m.propDep,function(a,b){var c=a.shared.shader,d;d=k?k.append(a,b):b.def(c,".","frag");var e;e=m?m.append(a,b):b.def(c,".","vert");var h=c+".program("+e+","+d;f.optional(function(){h+=","+a.command});return b.def(h+")")});return{frag:k,vert:m,
progVar:a,program:V}}function E(a,b){function c(a,g){if(a in d){var x=d[a]|0;f.command(!g||0<=x,"invalid "+a,b.commandStr);return G(function(a,b){g&&(a.OFFSET=x);return x})}if(a in e){var ra=e[a];return ka(ra,function(b,c){var d=b.invoke(c,ra);g&&(b.OFFSET=d,f.optional(function(){b.assert(c,d+">=0","invalid "+a)}));return d})}return g&&h?G(function(a,b){a.OFFSET="0";return 0}):null}var d=a["static"],e=a.dynamic,h=function(){if("elements"in d){var a=d.elements;kb(a)?a=l.getElements(l.create(a,!0)):
a&&(a=l.getElements(a),f.command(a,"invalid elements",b.commandStr));var c=G(function(b,c){if(a){var d=b.link(a);return b.ELEMENTS=d}return b.ELEMENTS=null});c.value=a;return c}if("elements"in e){var h=e.elements;return ka(h,function(a,b){var c=a.shared,d=c.isBufferArgs,c=c.elements,e=a.invoke(b,h),g=b.def("null"),d=b.def(d,"(",e,")"),V=a.cond(d).then(g,"=",c,".createStream(",e,");")["else"](g,"=",c,".getElements(",e,");");f.optional(function(){a.assert(V["else"],"!"+e+"||"+g,"invalid elements")});
b.entry(V);b.exit(a.cond(d).then(c,".destroyStream(",g,");"));return a.ELEMENTS=g})}return null}(),g=c("offset",!0);return{elements:h,primitive:function(){if("primitive"in d){var a=d.primitive;f.commandParameter(a,Pa,"invalid primitve",b.commandStr);return G(function(b,c){return Pa[a]})}if("primitive"in e){var c=e.primitive;return ka(c,function(a,b){var d=a.constants.primTypes,e=a.invoke(b,c);f.optional(function(){a.assert(b,e+" in "+d,"invalid primitive, must be one of "+Object.keys(Pa))});return b.def(d,
"[",e,"]")})}return h?Ia(h)?h.value?G(function(a,b){return b.def(a.ELEMENTS,".primType")}):G(function(){return 4}):new qa(h.thisDep,h.contextDep,h.propDep,function(a,b){var c=a.ELEMENTS;return b.def(c,"?",c,".primType:",4)}):null}(),count:function(){if("count"in d){var a=d.count|0;f.command("number"===typeof a&&0<=a,"invalid vertex count",b.commandStr);return G(function(){return a})}if("count"in e){var c=e.count;return ka(c,function(a,b){var d=a.invoke(b,c);f.optional(function(){a.assert(b,"typeof "+
d+'==="number"&&'+d+">=0&&"+d+"===("+d+"|0)","invalid vertex count")});return d})}if(h){if(Ia(h)){if(h)return g?new qa(g.thisDep,g.contextDep,g.propDep,function(a,b){var c=b.def(a.ELEMENTS,".vertCount-",a.OFFSET);f.optional(function(){a.assert(b,c+">=0","invalid vertex offset/element buffer too small")});return c}):G(function(a,b){return b.def(a.ELEMENTS,".vertCount")});var x=G(function(){return-1});f.optional(function(){x.MISSING=!0});return x}var ra=new qa(h.thisDep||g.thisDep,h.contextDep||g.contextDep,
h.propDep||g.propDep,function(a,b){var c=a.ELEMENTS;return a.OFFSET?b.def(c,"?",c,".vertCount-",a.OFFSET,":-1"):b.def(c,"?",c,".vertCount:-1")});f.optional(function(){ra.DYNAMIC=!0});return ra}return null}(),instances:c("instances",!1),offset:g}}function F(a,b){var c=a["static"],e=a.dynamic,h={};Ya.forEach(function(a){function g(b,d){if(a in c){var f=b(c[a]);h[x]=G(function(){return f})}else if(a in e){var l=e[a];h[x]=ka(l,function(a,b){return d(a,b,a.invoke(b,l))})}}var x=m(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return g(function(c){f.commandType(c,
"boolean",a,b.commandStr);return c},function(b,c,d){f.optional(function(){b.assert(c,"typeof "+d+'==="boolean"',"invalid flag "+a,b.commandStr)});return d});case "depth.func":return g(function(c){f.commandParameter(c,Va,"invalid "+a,b.commandStr);return Va[c]},function(b,c,d){var e=b.constants.compareFuncs;f.optional(function(){b.assert(c,d+" in "+e,"invalid "+a+", must be one of "+Object.keys(Va))});return c.def(e,"[",d,"]")});case "depth.range":return g(function(a){f.command(M(a)&&2===a.length&&
"number"===typeof a[0]&&"number"===typeof a[1]&&a[0]<=a[1],"depth range is 2d array",b.commandStr);return a},function(a,b,c){f.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===2&&typeof "+c+'[0]==="number"&&typeof '+c+'[1]==="number"&&'+c+"[0]<="+c+"[1]","depth range must be a 2d array")});var d=b.def("+",c,"[0]"),e=b.def("+",c,"[1]");return[d,e]});case "blend.func":return g(function(a){f.commandType(a,"object","blend.func",b.commandStr);var c="srcRGB"in a?a.srcRGB:a.src,
d="srcAlpha"in a?a.srcAlpha:a.src,e="dstRGB"in a?a.dstRGB:a.dst;a="dstAlpha"in a?a.dstAlpha:a.dst;f.commandParameter(c,za,x+".srcRGB",b.commandStr);f.commandParameter(d,za,x+".srcAlpha",b.commandStr);f.commandParameter(e,za,x+".dstRGB",b.commandStr);f.commandParameter(a,za,x+".dstAlpha",b.commandStr);f.command(-1===Qb.indexOf(c+", "+e),"unallowed blending combination (srcRGB, dstRGB) = ("+c+", "+e+")",b.commandStr);return[za[c],za[e],za[d],za[a]]},function(b,c,d){function e(g,x){var l=c.def('"',g,
x,'" in ',d,"?",d,".",g,x,":",d,".",g);f.optional(function(){b.assert(c,l+" in "+h,"invalid "+a+"."+g+x+", must be one of "+Object.keys(za))});return l}var h=b.constants.blendFuncs;f.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid blend func, must be an object")});var g=e("src","RGB"),x=e("dst","RGB");f.optional(function(){b.assert(c,b.constants.invalidBlendCombinations+".indexOf("+g+'+", "+'+x+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var l=c.def(h,
"[",g,"]"),k=c.def(h,"[",e("src","Alpha"),"]"),Z=c.def(h,"[",x,"]"),m=c.def(h,"[",e("dst","Alpha"),"]");return[l,Z,k,m]});case "blend.equation":return g(function(c){if("string"===typeof c)return f.commandParameter(c,da,"invalid "+a,b.commandStr),[da[c],da[c]];if("object"===typeof c)return f.commandParameter(c.rgb,da,a+".rgb",b.commandStr),f.commandParameter(c.alpha,da,a+".alpha",b.commandStr),[da[c.rgb],da[c.alpha]];f.commandRaise("invalid blend.equation",b.commandStr)},function(b,c,d){var e=b.constants.blendEquations,
h=c.def(),g=c.def(),x=b.cond("typeof ",d,'==="string"');f.optional(function(){function c(a,d,f){b.assert(a,f+" in "+e,"invalid "+d+", must be one of "+Object.keys(da))}c(x.then,a,d);b.assert(x["else"],d+"&&typeof "+d+'==="object"',"invalid "+a);c(x["else"],a+".rgb",d+".rgb");c(x["else"],a+".alpha",d+".alpha")});x.then(h,"=",g,"=",e,"[",d,"];");x["else"](h,"=",e,"[",d,".rgb];",g,"=",e,"[",d,".alpha];");c(x);return[h,g]});case "blend.color":return g(function(a){f.command(M(a)&&4===a.length,"blend.color must be a 4d array",
b.commandStr);return oa(4,function(b){return+a[b]})},function(a,b,c){f.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===4","blend.color must be a 4d array")});return oa(4,function(a){return b.def("+",c,"[",a,"]")})});case "stencil.mask":return g(function(a){f.commandType(a,"number",x,b.commandStr);return a|0},function(a,b,c){f.optional(function(){a.assert(b,"typeof "+c+'==="number"',"invalid stencil.mask")});return b.def(c,"|0")});case "stencil.func":return g(function(c){f.commandType(c,
"object",x,b.commandStr);var d=c.cmp||"keep",e=c.ref||0;c="mask"in c?c.mask:-1;f.commandParameter(d,Va,a+".cmp",b.commandStr);f.commandType(e,"number",a+".ref",b.commandStr);f.commandType(c,"number",a+".mask",b.commandStr);return[Va[d],e,c]},function(a,b,c){var d=a.constants.compareFuncs;f.optional(function(){function e(){a.assert(b,Array.prototype.join.call(arguments,""),"invalid stencil.func")}e(c+"&&typeof ",c,'==="object"');e('!("cmp" in ',c,")||(",c,".cmp in ",d,")")});var e=b.def('"cmp" in ',
c,"?",d,"[",c,".cmp]",":",7680),h=b.def(c,".ref|0"),g=b.def('"mask" in ',c,"?",c,".mask|0:-1");return[e,h,g]});case "stencil.opFront":case "stencil.opBack":return g(function(c){f.commandType(c,"object",x,b.commandStr);var d=c.fail||"keep",e=c.zfail||"keep";c=c.zpass||"keep";f.commandParameter(d,Ja,a+".fail",b.commandStr);f.commandParameter(e,Ja,a+".zfail",b.commandStr);f.commandParameter(c,Ja,a+".zpass",b.commandStr);return["stencil.opBack"===a?1029:1028,Ja[d],Ja[e],Ja[c]]},function(b,c,d){function e(g){f.optional(function(){b.assert(c,
'!("'+g+'" in '+d+")||("+d+"."+g+" in "+h+")","invalid "+a+"."+g+", must be one of "+Object.keys(Ja))});return c.def('"',g,'" in ',d,"?",h,"[",d,".",g,"]:",7680)}var h=b.constants.stencilOps;f.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid "+a)});return["stencil.opBack"===a?1029:1028,e("fail"),e("zfail"),e("zpass")]});case "polygonOffset.offset":return g(function(a){f.commandType(a,"object",x,b.commandStr);var c=a.factor|0;a=a.units|0;f.commandType(c,"number",x+".factor",b.commandStr);
f.commandType(a,"number",x+".units",b.commandStr);return[c,a]},function(b,c,d){f.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid "+a)});var e=c.def(d,".factor|0"),h=c.def(d,".units|0");return[e,h]});case "cull.face":return g(function(a){var c=0;"front"===a?c=1028:"back"===a&&(c=1029);f.command(!!c,x,b.commandStr);return c},function(a,b,c){f.optional(function(){a.assert(b,c+'==="front"||'+c+'==="back"',"invalid cull.face")});return b.def(c,'==="front"?',1028,":",1029)});case "lineWidth":return g(function(a){f.command("number"===
typeof a&&a>=d.lineWidthDims[0]&&a<=d.lineWidthDims[1],"invalid line width, must be a positive number between "+d.lineWidthDims[0]+" and "+d.lineWidthDims[1],b.commandStr);return a},function(a,b,c){f.optional(function(){a.assert(b,"typeof "+c+'==="number"&&'+c+">="+d.lineWidthDims[0]+"&&"+c+"<="+d.lineWidthDims[1],"invalid line width")});return c});case "frontFace":return g(function(a){f.commandParameter(a,tb,x,b.commandStr);return tb[a]},function(a,b,c){f.optional(function(){a.assert(b,c+'==="cw"||'+
c+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return b.def(c+'==="cw"?2304:2305')});case "colorMask":return g(function(a){f.command(M(a)&&4===a.length,"color.mask must be length 4 array",b.commandStr);return a.map(function(a){return!!a})},function(a,b,c){f.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===4","invalid color.mask")});return oa(4,function(a){return"!!"+c+"["+a+"]"})});case "sample.coverage":return g(function(a){f.command("object"===typeof a&&a,
x,b.commandStr);var c="value"in a?a.value:1;a=!!a.invert;f.command("number"===typeof c&&0<=c&&1>=c,"sample.coverage.value must be a number between 0 and 1",b.commandStr);return[c,a]},function(a,b,c){f.optional(function(){a.assert(b,c+"&&typeof "+c+'==="object"',"invalid sample.coverage")});var d=b.def('"value" in ',c,"?+",c,".value:1"),e=b.def("!!",c,".invert");return[d,e]})}});return h}function W(a,b){var c=a["static"],d=a.dynamic,e={};Object.keys(c).forEach(function(a){var d=c[a],h;if("number"===
typeof d||"boolean"===typeof d)h=G(function(){return d});else if("function"===typeof d){var g=d._reglType;"texture2d"===g||"textureCube"===g?h=G(function(a){return a.link(d)}):"framebuffer"===g||"framebufferCube"===g?(f.command(0<d.color.length,'missing color attachment for framebuffer sent to uniform "'+a+'"',b.commandStr),h=G(function(a){return a.link(d.color[0])})):f.commandRaise('invalid data for uniform "'+a+'"',b.commandStr)}else M(d)?h=G(function(b){return b.global.def("[",oa(d.length,function(c){f.command("number"===
typeof d[c]||"boolean"===typeof d[c],"invalid uniform "+a,b.commandStr);return d[c]}),"]")}):f.commandRaise('invalid or missing data for uniform "'+a+'"',b.commandStr);h.value=d;e[a]=h});Object.keys(d).forEach(function(a){var b=d[a];e[a]=ka(b,function(a,c){return a.invoke(c,b)})});return e}function I(a,c){var d=a["static"],g=a.dynamic,l={};Object.keys(d).forEach(function(a){var g=d[a],x=b.id(a),k=new Y;if(kb(g))k.state=1,k.buffer=e.getBuffer(e.create(g,34962,!1,!0)),k.type=0;else{var m=e.getBuffer(g);
if(m)k.state=1,k.buffer=m,k.type=0;else if(f.command("object"===typeof g&&g,"invalid data for attribute "+a,c.commandStr),"constant"in g){var p=g.constant;k.buffer="null";k.state=2;"number"===typeof p?k.x=p:(f.command(M(p)&&0<p.length&&4>=p.length,"invalid constant for attribute "+a,c.commandStr),Wa.forEach(function(a,b){b<p.length&&(k[a]=p[b])}))}else{m=kb(g.buffer)?e.getBuffer(e.create(g.buffer,34962,!1,!0)):e.getBuffer(g.buffer);f.command(!!m,'missing buffer for attribute "'+a+'"',c.commandStr);
var n=g.offset|0;f.command(0<=n,'invalid offset for attribute "'+a+'"',c.commandStr);var q=g.stride|0;f.command(0<=q&&256>q,'invalid stride for attribute "'+a+'", must be integer betweeen [0, 255]',c.commandStr);var r=g.size|0;f.command(!("size"in g)||0<r&&4>=r,'invalid size for attribute "'+a+'", must be 1,2,3,4',c.commandStr);var Ba=!!g.normalized,u=0;"type"in g&&(f.commandParameter(g.type,La,"invalid type for attribute "+a,c.commandStr),u=La[g.type]);var z=g.divisor|0;"divisor"in g&&(f.command(0===
z||Aa,'cannot specify divisor for attribute "'+a+'", instancing not supported',c.commandStr),f.command(0<=z,'invalid divisor for attribute "'+a+'"',c.commandStr));f.optional(function(){var b=c.commandStr,d="buffer offset divisor normalized type size stride".split(" ");Object.keys(g).forEach(function(c){f.command(0<=d.indexOf(c),'unknown parameter "'+c+'" for attribute pointer "'+a+'" (valid parameters are '+d+")",b)})});k.buffer=m;k.state=1;k.size=r;k.normalized=Ba;k.type=u||m.dtype;k.offset=n;k.stride=
q;k.divisor=z}}l[a]=G(function(a,b){var c=a.attribCache;if(x in c)return c[x];var d={isStream:!1};Object.keys(k).forEach(function(a){d[a]=k[a]});k.buffer&&(d.buffer=a.link(k.buffer),d.type=d.type||d.buffer+".dtype");return c[x]=d})});Object.keys(g).forEach(function(a){var b=g[a];l[a]=ka(b,function(c,d){function e(a){d(m[a],"=",h,".",a,"|0;")}var h=c.invoke(d,b),g=c.shared,x=c.constants,l=g.isBufferArgs,k=g.buffer;f.optional(function(){c.assert(d,h+"&&(typeof "+h+'==="object"||typeof '+h+'==="function")&&('+
l+"("+h+")||"+k+".getBuffer("+h+")||"+k+".getBuffer("+h+".buffer)||"+l+"("+h+'.buffer)||("constant" in '+h+"&&(typeof "+h+'.constant==="number"||'+g.isArrayLike+"("+h+".constant))))",'invalid dynamic attribute "'+a+'"')});var m={isStream:d.def(!1)},Z=new Y;Z.state=1;Object.keys(Z).forEach(function(a){m[a]=d.def(""+Z[a])});var p=m.buffer,n=m.type;d("if(",l,"(",h,")){",m.isStream,"=true;",p,"=",k,".createStream(",34962,",",h,");",n,"=",p,".dtype;","}else{",p,"=",k,".getBuffer(",h,");","if(",p,"){",
n,"=",p,".dtype;",'}else if("constant" in ',h,"){",m.state,"=",2,";","if(typeof "+h+'.constant === "number"){',m[Wa[0]],"=",h,".constant;",Wa.slice(1).map(function(a){return m[a]}).join("="),"=0;","}else{",Wa.map(function(a,b){return m[a]+"="+h+".constant.length>"+b+"?"+h+".constant["+b+"]:0;"}).join(""),"}}else{","if(",l,"(",h,".buffer)){",p,"=",k,".createStream(",34962,",",h,".buffer);","}else{",p,"=",k,".getBuffer(",h,".buffer);","}",n,'="type" in ',h,"?",x.glTypes,"[",h,".type]:",p,".dtype;",
m.normalized,"=!!",h,".normalized;");e("size");e("offset");e("stride");e("divisor");d("}}");d.exit("if(",m.isStream,"){",k,".destroyStream(",p,");","}");return m})});return l}function D(a,b){var c=a["static"],d=a.dynamic;if("vao"in c){var e=c.vao;null!==e&&null===k.getVAO(e)&&(e=k.createVAO(e));return G(function(a){return a.link(k.getVAO(e))})}if("vao"in d){var f=d.vao;return ka(f,function(a,b){var c=a.invoke(b,f);return b.def(a.shared.vao+".getVAO("+c+")")})}return null}function Q(a){var b=a["static"],
c=a.dynamic,d={};Object.keys(b).forEach(function(a){var c=b[a];d[a]=G(function(a,b){return"number"===typeof c||"boolean"===typeof c?""+c:a.link(c)})});Object.keys(c).forEach(function(a){var b=c[a];d[a]=ka(b,function(a,c){return a.invoke(c,b)})});return d}function O(a,b,d,e,h){function g(a){var b=ra[a];b&&(u[a]=b)}var l=a["static"],p=a.dynamic;f.optional(function(){function a(c){Object.keys(c).forEach(function(a){f.command(0<=b.indexOf(a),'unknown parameter "'+a+'"',h.commandStr)})}var b="framebuffer vert frag elements primitive offset count instances profile vao".split(" ").concat(Ya);
a(l);a(p)});var n=J(a,b),q=B(a,h),ra=C(a,q,h),r=E(a,h),u=F(a,h),t=H(a,h,n);g("viewport");g(m("scissor.box"));var w=0<Object.keys(u).length,q={framebuffer:q,draw:r,shader:t,state:u,dirty:w,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};q.profile=A(a,h);q.uniforms=W(d,h);q.drawVAO=q.scopeVAO=D(a,h);if(!q.drawVAO&&t.program&&!n&&c.angle_instanced_arrays){var v=!0;a=t.program.attributes.map(function(a){a=b["static"][a];v=v&&!!a;return a});if(v&&0<a.length){var na=k.getVAO(k.createVAO(a));q.drawVAO=
new qa(null,null,null,function(a,b){return a.link(na)});q.useVAO=!0}}n?q.useVAO=!0:q.attributes=I(b,h);q.context=Q(e,h);return q}function K(a,b,c){var d=a.shared.context,e=a.scope();Object.keys(c).forEach(function(f){b.save(d,"."+f);e(d,".",f,"=",c[f].append(a,b),";")});b(e)}function N(a,b,c,d){var e=a.shared,f=e.gl,h=e.framebuffer,g;fa&&(g=b.def(e.extensions,".webgl_draw_buffers"));var l=a.constants,e=l.drawBuffer,l=l.backBuffer;a=c?c.append(a,b):b.def(h,".next");d||b("if(",a,"!==",h,".cur){");b("if(",
a,"){",f,".bindFramebuffer(",36160,",",a,".framebuffer);");fa&&b(g,".drawBuffersWEBGL(",e,"[",a,".colorAttachments.length]);");b("}else{",f,".bindFramebuffer(",36160,",null);");fa&&b(g,".drawBuffersWEBGL(",l,");");b("}",h,".cur=",a,";");d||b("}")}function P(a,b,c){var d=a.shared,e=d.gl,f=a.current,h=a.next,g=d.current,l=d.next,k=a.cond(g,".dirty");Ya.forEach(function(b){b=m(b);if(!(b in c.state)){var d,p;if(b in h){d=h[b];p=f[b];var Z=oa(Fa[b].length,function(a){return k.def(d,"[",a,"]")});k(a.cond(Z.map(function(a,
b){return a+"!=="+p+"["+b+"]"}).join("||")).then(e,".",Ha[b],"(",Z,");",Z.map(function(a,b){return p+"["+b+"]="+a}).join(";"),";"))}else d=k.def(l,".",b),Z=a.cond(d,"!==",g,".",b),k(Z),b in Ga?Z(a.cond(d).then(e,".enable(",Ga[b],");")["else"](e,".disable(",Ga[b],");"),g,".",b,"=",d,";"):Z(e,".",Ha[b],"(",d,");",g,".",b,"=",d,";")}});0===Object.keys(c.state).length&&k(g,".dirty=false;");b(k)}function ga(a,b,c,d){var e=a.shared,f=a.current,h=e.current,g=e.gl;Pb(Object.keys(c)).forEach(function(e){var l=
c[e];if(!d||d(l)){var k=l.append(a,b);if(Ga[e]){var m=Ga[e];Ia(l)?k?b(g,".enable(",m,");"):b(g,".disable(",m,");"):b(a.cond(k).then(g,".enable(",m,");")["else"](g,".disable(",m,");"));b(h,".",e,"=",k,";")}else if(M(k)){var p=f[e];b(g,".",Ha[e],"(",k,");",k.map(function(a,b){return p+"["+b+"]="+a}).join(";"),";")}else b(g,".",Ha[e],"(",k,");",h,".",e,"=",k,";")}})}function X(a,b){Aa&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function U(a,b,c,d,e){function f(){return"undefined"===
typeof performance?"Date.now()":"performance.now()"}function h(a){q=b.def();a(q,"=",f(),";");"string"===typeof e?a(m,".count+=",e,";"):a(m,".count++;");u&&(d?(r=b.def(),a(r,"=",n,".getNumPendingQueries();")):a(n,".beginQuery(",m,");"))}function g(a){a(m,".cpuTime+=",f(),"-",q,";");u&&(d?a(n,".pushScopeStats(",r,",",n,".getNumPendingQueries(),",m,");"):a(n,".endQuery();"))}function l(a){var c=b.def(p,".profile");b(p,".profile=",a,";");b.exit(p,".profile=",c,";")}var k=a.shared,m=a.stats,p=k.current,
n=k.timer;c=c.profile;var q,r;if(c){if(Ia(c)){c.enable?(h(b),g(b.exit),l("true")):l("false");return}c=c.append(a,b);l(c)}else c=b.def(p,".profile");k=a.block();h(k);b("if(",c,"){",k,"}");a=a.block();g(a);b.exit("if(",c,"){",a,"}")}function aa(a,b,c,d,e){function h(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function g(c,d,e){function f(){b("if(!",p,".buffer){",k,".enableVertexAttribArray(",
m,");}");var c=e.type,h;h=e.size?b.def(e.size,"||",d):d;b("if(",p,".type!==",c,"||",p,".size!==",h,"||",r.map(function(a){return p+"."+a+"!=="+e[a]}).join("||"),"){",k,".bindBuffer(",34962,",",n,".buffer);",k,".vertexAttribPointer(",[m,h,c,e.normalized,e.stride,e.offset],");",p,".type=",c,";",p,".size=",h,";",r.map(function(a){return p+"."+a+"="+e[a]+";"}).join(""),"}");Aa&&(c=e.divisor,b("if(",p,".divisor!==",c,"){",a.instancing,".vertexAttribDivisorANGLE(",[m,c],");",p,".divisor=",c,";}"))}function h(){b("if(",
p,".buffer){",k,".disableVertexAttribArray(",m,");",p,".buffer=null;","}if(",Wa.map(function(a,b){return p+"."+a+"!=="+q[b]}).join("||"),"){",k,".vertexAttrib4f(",m,",",q,");",Wa.map(function(a,b){return p+"."+a+"="+q[b]+";"}).join(""),"}")}var k=l.gl,m=b.def(c,".location"),p=b.def(l.attributes,"[",m,"]");c=e.state;var n=e.buffer,q=[e.x,e.y,e.z,e.w],r=["buffer","normalized","offset","stride"];1===c?f():2===c?h():(b("if(",c,"===",1,"){"),f(),b("}else{"),h(),b("}"))}var l=a.shared;d.forEach(function(d){var l=
d.name,k=c.attributes[l],m;if(k){if(!e(k))return;m=k.append(a,b)}else{if(!e(Sb))return;var p=a.scopeAttrib(l);f.optional(function(){a.assert(b,p+".state","missing attribute "+l)});m={};Object.keys(new Y).forEach(function(a){m[a]=b.def(p,".",a)})}g(a.link(d),h(d.info.type),m)})}function ba(a,c,d,e,g){for(var l=a.shared,k=l.gl,m,p=0;p<e.length;++p){var n=e[p],q=n.name,r=n.info.type,u=d.uniforms[q],n=a.link(n)+".location",z;if(u){if(!g(u))continue;if(Ia(u)){var t=u.value;f.command(null!==t&&"undefined"!==
typeof t,'missing uniform "'+q+'"',a.commandStr);if(35678===r||35680===r)f.command("function"===typeof t&&(35678===r&&("texture2d"===t._reglType||"framebuffer"===t._reglType)||35680===r&&("textureCube"===t._reglType||"framebufferCube"===t._reglType)),"invalid texture for uniform "+q,a.commandStr),u=a.link(t._texture||t.color[0]._texture),c(k,".uniform1i(",n,",",u+".bind());"),c.exit(u,".unbind();");else if(35674===r||35675===r||35676===r){f.optional(function(){f.command(M(t),"invalid matrix for uniform "+
q,a.commandStr);f.command(35674===r&&4===t.length||35675===r&&9===t.length||35676===r&&16===t.length,"invalid length for matrix uniform "+q,a.commandStr)});var u=a.global.def("new Float32Array(["+Array.prototype.slice.call(t)+"])"),w=2;35675===r?w=3:35676===r&&(w=4);c(k,".uniformMatrix",w,"fv(",n,",false,",u,");")}else{switch(r){case 5126:f.commandType(t,"number","uniform "+q,a.commandStr);m="1f";break;case 35664:f.command(M(t)&&2===t.length,"uniform "+q,a.commandStr);m="2f";break;case 35665:f.command(M(t)&&
3===t.length,"uniform "+q,a.commandStr);m="3f";break;case 35666:f.command(M(t)&&4===t.length,"uniform "+q,a.commandStr);m="4f";break;case 35670:f.commandType(t,"boolean","uniform "+q,a.commandStr);m="1i";break;case 5124:f.commandType(t,"number","uniform "+q,a.commandStr);m="1i";break;case 35671:f.command(M(t)&&2===t.length,"uniform "+q,a.commandStr);m="2i";break;case 35667:f.command(M(t)&&2===t.length,"uniform "+q,a.commandStr);m="2i";break;case 35672:f.command(M(t)&&3===t.length,"uniform "+q,a.commandStr);
m="3i";break;case 35668:f.command(M(t)&&3===t.length,"uniform "+q,a.commandStr);m="3i";break;case 35673:f.command(M(t)&&4===t.length,"uniform "+q,a.commandStr);m="4i";break;case 35669:f.command(M(t)&&4===t.length,"uniform "+q,a.commandStr),m="4i"}c(k,".uniform",m,"(",n,",",M(t)?Array.prototype.slice.call(t):t,");")}continue}else z=u.append(a,c)}else{if(!g(Sb))continue;z=c.def(l.uniforms,"[",b.id(q),"]")}35678===r?c("if(",z,"&&",z,'._reglType==="framebuffer"){',z,"=",z,".color[0];","}"):35680===r&&
c("if(",z,"&&",z,'._reglType==="framebufferCube"){',z,"=",z,".color[0];","}");f.optional(function(){function b(d,e){a.assert(c,d,'bad data or missing for uniform "'+q+'".  '+e)}function d(a){b("typeof "+z+'==="'+a+'"',"invalid type, expected "+a)}function e(c,d){b(l.isArrayLike+"("+z+")&&"+z+".length==="+c,"invalid vector, should have length "+c,a.commandStr)}function f(c){b("typeof "+z+'==="function"&&'+z+'._reglType==="texture'+(3553===c?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(r){case 5124:d("number");
break;case 35667:e(2,"number");break;case 35668:e(3,"number");break;case 35669:e(4,"number");break;case 5126:d("number");break;case 35664:e(2,"number");break;case 35665:e(3,"number");break;case 35666:e(4,"number");break;case 35670:d("boolean");break;case 35671:e(2,"boolean");break;case 35672:e(3,"boolean");break;case 35673:e(4,"boolean");break;case 35674:e(4,"number");break;case 35675:e(9,"number");break;case 35676:e(16,"number");break;case 35678:f(3553);break;case 35680:f(34067)}});u=1;switch(r){case 35678:case 35680:u=
c.def(z,"._texture");c(k,".uniform1i(",n,",",u,".bind());");c.exit(u,".unbind();");continue;case 5124:case 35670:m="1i";break;case 35667:case 35671:m="2i";u=2;break;case 35668:case 35672:m="3i";u=3;break;case 35669:case 35673:m="4i";u=4;break;case 5126:m="1f";break;case 35664:m="2f";u=2;break;case 35665:m="3f";u=3;break;case 35666:m="4f";u=4;break;case 35674:m="Matrix2fv";break;case 35675:m="Matrix3fv";break;case 35676:m="Matrix4fv"}c(k,".uniform",m,"(",n,",");if("M"===m.charAt(0)){var n=Math.pow(r-
35674+2,2),v=a.global.def("new Float32Array(",n,")");c("false,(Array.isArray(",z,")||",z," instanceof Float32Array)?",z,":(",oa(n,function(a){return v+"["+a+"]="+z+"["+a+"]"}),",",v,")")}else 1<u?c(oa(u,function(a){return z+"["+a+"]"})):c(z);c(");")}}function ca(a,b,c,d){function e(f){var h=p[f];return h?h.contextDep&&d.contextDynamic||h.propDep?h.append(a,c):h.append(a,b):b.def(m,".",f)}function h(){function a(){c(z,".drawElementsInstancedANGLE(",[q,u,w,r+"<<(("+w+"-5121)>>1)",t],");")}function b(){c(z,
".drawArraysInstancedANGLE(",[q,r,u,t],");")}n?v?a():(c("if(",n,"){"),a(),c("}else{"),b(),c("}")):b()}function g(){function a(){c(k+".drawElements("+[q,u,w,r+"<<(("+w+"-5121)>>1)"]+");")}function b(){c(k+".drawArrays("+[q,r,u]+");")}n?v?a():(c("if(",n,"){"),a(),c("}else{"),b(),c("}")):b()}var l=a.shared,k=l.gl,m=l.draw,p=d.draw,n=function(){var e=p.elements,f=b;if(e){if(e.contextDep&&d.contextDynamic||e.propDep)f=c;e=e.append(a,f)}else e=f.def(m,".","elements");e&&f("if("+e+")"+k+".bindBuffer(34963,"+
e+".buffer.buffer);");return e}(),q=e("primitive"),r=e("offset"),u=function(){var e=p.count,h,g=b;if(e){if(e.contextDep&&d.contextDynamic||e.propDep)g=c;h=e.append(a,g);f.optional(function(){e.MISSING&&a.assert(b,"false","missing vertex count");e.DYNAMIC&&a.assert(g,h+">=0","missing vertex count")})}else h=g.def(m,".","count"),f.optional(function(){a.assert(g,h+">=0","missing vertex count")});return h}();if("number"===typeof u){if(0===u)return}else c("if(",u,"){"),c.exit("}");var t,z;Aa&&(t=e("instances"),
z=a.instancing);var w=n+".type",v=p.elements&&Ia(p.elements);Aa&&("number"!==typeof t||0<=t)?"string"===typeof t?(c("if(",t,">0){"),h(),c("}else if(",t,"<0){"),g(),c("}")):h():g()}function ea(a,b,c,d,e){var h=L();e=h.proc("body",e);f.optional(function(){h.commandStr=b.commandStr;h.command=h.link(b.commandStr)});Aa&&(h.instancing=e.def(h.shared.extensions,".angle_instanced_arrays"));a(h,e,c,d);return h.compile().body}function ha(a,b,c,d){X(a,b);c.useVAO?c.drawVAO?b(a.shared.vao,".setVAO(",c.drawVAO.append(a,
b),");"):b(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(b(a.shared.vao,".setVAO(null);"),aa(a,b,c,d.attributes,function(){return!0}));ba(a,b,c,d.uniforms,function(){return!0});ca(a,b,b,c)}function ya(a,b){var c=a.proc("draw",1);X(a,c);K(a,c,b.context);N(a,c,b.framebuffer);P(a,c,b);ga(a,c,b.state);U(a,c,b,!1,!0);var d=b.shader.progVar.append(a,c);c(a.shared.gl,".useProgram(",d,".program);");if(b.shader.program)ha(a,c,b,b.shader.program);else{c(a.shared.vao,".setVAO(null);");var e=a.global.def("{}"),
f=c.def(d,".id"),h=c.def(e,"[",f,"]");c(a.cond(h).then(h,".call(this,a0);")["else"](h,"=",e,"[",f,"]=",a.link(function(c){return ea(ha,a,b,c,1)}),"(",d,");",h,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function va(a,b,c,d){function e(){return!0}a.batchId="a1";X(a,b);aa(a,b,c,d.attributes,e);ba(a,b,c,d.uniforms,e);ca(a,b,b,c)}function T(a,b,c,d){function e(a){return a.contextDep&&h||a.propDep}function f(a){return!e(a)}X(a,b);var h=c.contextDep,g=b.def(),l=
b.def();a.shared.props=l;a.batchId=g;var k=a.scope(),m=a.scope();b(k.entry,"for(",g,"=0;",g,"<","a1",";++",g,"){",l,"=","a0","[",g,"];",m,"}",k.exit);c.needsContext&&K(a,m,c.context);c.needsFramebuffer&&N(a,m,c.framebuffer);ga(a,m,c.state,e);c.profile&&e(c.profile)&&U(a,m,c,!1,!0);d?(c.useVAO?c.drawVAO?e(c.drawVAO)?m(a.shared.vao,".setVAO(",c.drawVAO.append(a,m),");"):k(a.shared.vao,".setVAO(",c.drawVAO.append(a,k),");"):k(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(k(a.shared.vao,".setVAO(null);"),
aa(a,k,c,d.attributes,f),aa(a,m,c,d.attributes,e)),ba(a,k,c,d.uniforms,f),ba(a,m,c,d.uniforms,e),ca(a,k,m,c)):(b=a.global.def("{}"),d=c.shader.progVar.append(a,m),l=m.def(d,".id"),k=m.def(b,"[",l,"]"),m(a.shared.gl,".useProgram(",d,".program);","if(!",k,"){",k,"=",b,"[",l,"]=",a.link(function(b){return ea(va,a,c,b,2)}),"(",d,");}",k,".call(this,a0[",g,"],",g,");"))}function hb(a,b){function c(a){return a.contextDep&&e||a.propDep}var d=a.proc("batch",2);a.batchId="0";X(a,d);var e=!1,f=!0;Object.keys(b.context).forEach(function(a){e=
e||b.context[a].propDep});e||(K(a,d,b.context),f=!1);var h=b.framebuffer,g=!1;h?(h.propDep?e=g=!0:h.contextDep&&e&&(g=!0),g||N(a,d,h)):N(a,d,null);b.state.viewport&&b.state.viewport.propDep&&(e=!0);P(a,d,b);ga(a,d,b.state,function(a){return!c(a)});b.profile&&c(b.profile)||U(a,d,b,!1,"a1");b.contextDep=e;b.needsContext=f;b.needsFramebuffer=g;f=b.shader.progVar;if(f.contextDep&&e||f.propDep)T(a,d,b,null);else if(f=f.append(a,d),d(a.shared.gl,".useProgram(",f,".program);"),b.shader.program)T(a,d,b,b.shader.program);
else{d(a.shared.vao,".setVAO(null);");var h=a.global.def("{}"),g=d.def(f,".id"),l=d.def(h,"[",g,"]");d(a.cond(l).then(l,".call(this,a0,a1);")["else"](l,"=",h,"[",g,"]=",a.link(function(c){return ea(T,a,b,c,2)}),"(",f,");",l,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}function la(a,c){function d(b){var h=c.shader[b];h&&e.set(f.shader,"."+b,h.append(a,e))}var e=a.proc("scope",3);a.batchId="a2";var f=a.shared,g=f.current;K(a,e,c.context);c.framebuffer&&c.framebuffer.append(a,
e);Pb(Object.keys(c.state)).forEach(function(b){var d=c.state[b].append(a,e);M(d)?d.forEach(function(c,d){e.set(a.next[b],"["+d+"]",c)}):e.set(f.next,"."+b,d)});U(a,e,c,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(b){var d=c.draw[b];d&&e.set(f.draw,"."+b,""+d.append(a,e))});Object.keys(c.uniforms).forEach(function(d){e.set(f.uniforms,"["+b.id(d)+"]",c.uniforms[d].append(a,e))});Object.keys(c.attributes).forEach(function(b){var d=c.attributes[b].append(a,e),f=a.scopeAttrib(b);
Object.keys(new Y).forEach(function(a){e.set(f,"."+a,d[a])})});c.scopeVAO&&e.set(f.vao,".targetVAO",c.scopeVAO.append(a,e));d("vert");d("frag");0<Object.keys(c.state).length&&(e(g,".dirty=true;"),e.exit(g,".dirty=true;"));e("a1(",a.shared.context,",a0,",a.batchId,");")}function ma(a){if("object"===typeof a&&!M(a)){for(var b=Object.keys(a),c=0;c<b.length;++c)if(xa.isDynamic(a[b[c]]))return!0;return!1}}function ia(a,b,c){function d(a,b){h.forEach(function(c){var d=e[c];xa.isDynamic(d)&&(d=a.invoke(b,
d),b(m,".",c,"=",d,";"))})}var e=b["static"][c];if(e&&ma(e)){var f=a.global,h=Object.keys(e),g=!1,l=!1,k=!1,m=a.global.def("{}");h.forEach(function(b){var c=e[b];if(xa.isDynamic(c))"function"===typeof c&&(c=e[b]=xa.unbox(c)),b=ka(c,null),g=g||b.thisDep,k=k||b.propDep,l=l||b.contextDep;else{f(m,".",b,"=");switch(typeof c){case "number":f(c);break;case "string":f('"',c,'"');break;case "object":Array.isArray(c)&&f("[",c.join(),"]");break;default:f(a.link(c))}f(";")}});b.dynamic[c]=new xa.DynamicVariable(4,
{thisDep:g,contextDep:l,propDep:k,ref:m,append:d});delete b["static"][c]}}var Y=k.Record,da={add:32774,subtract:32778,"reverse subtract":32779};c.ext_blend_minmax&&(da.min=32775,da.max=32776);var Aa=c.angle_instanced_arrays,fa=c.webgl_draw_buffers,Fa={dirty:!0,profile:r.profile},Xa={},Ya=[],Ga={},Ha={};y("dither",3024);y("blend.enable",3042);w("blend.color","blendColor",[0,0,0,0]);w("blend.equation","blendEquationSeparate",[32774,32774]);w("blend.func","blendFuncSeparate",[1,0,1,0]);y("depth.enable",
2929,!0);w("depth.func","depthFunc",513);w("depth.range","depthRange",[0,1]);w("depth.mask","depthMask",!0);w("colorMask","colorMask",[!0,!0,!0,!0]);y("cull.enable",2884);w("cull.face","cullFace",1029);w("frontFace","frontFace",2305);w("lineWidth","lineWidth",1);y("polygonOffset.enable",32823);w("polygonOffset.offset","polygonOffset",[0,0]);y("sample.alpha",32926);y("sample.enable",32928);w("sample.coverage","sampleCoverage",[1,!1]);y("stencil.enable",2960);w("stencil.mask","stencilMask",-1);w("stencil.func",
"stencilFunc",[519,0,-1]);w("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);w("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);y("scissor.enable",3089);w("scissor.box","scissor",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);w("viewport","viewport",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);var pa={gl:a,context:v,strings:b,next:Xa,current:Fa,draw:q,elements:l,buffer:e,shader:t,attributes:k.state,vao:k,uniforms:p,framebuffer:g,extensions:c,timer:u,isBufferArgs:kb},
ja={primTypes:Pa,compareFuncs:Va,blendFuncs:za,blendEquations:da,stencilOps:Ja,glTypes:La,orientationType:tb};f.optional(function(){pa.isArrayLike=M});fa&&(ja.backBuffer=[1029],ja.drawBuffer=oa(d.maxDrawbuffers,function(a){return 0===a?[0]:oa(a,function(a){return 36064+a})}));var Ca=0;return{next:Xa,current:Fa,procs:function(){var a=L(),b=a.proc("poll"),e=a.proc("refresh"),f=a.block();b(f);e(f);var h=a.shared,g=h.gl,l=h.next,k=h.current;f(k,".dirty=false;");N(a,b);N(a,e,null,!0);var m;Aa&&(m=a.link(Aa));
c.oes_vertex_array_object&&e(a.link(c.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var p=0;p<d.maxAttributes;++p){var n=e.def(h.attributes,"[",p,"]"),q=a.cond(n,".buffer");q.then(g,".enableVertexAttribArray(",p,");",g,".bindBuffer(",34962,",",n,".buffer.buffer);",g,".vertexAttribPointer(",p,",",n,".size,",n,".type,",n,".normalized,",n,".stride,",n,".offset);")["else"](g,".disableVertexAttribArray(",p,");",g,".vertexAttrib4f(",p,",",n,".x,",n,".y,",n,".z,",n,".w);",n,".buffer=null;");
e(q);Aa&&e(m,".vertexAttribDivisorANGLE(",p,",",n,".divisor);")}e(a.shared.vao,".currentVAO=null;",a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);");Object.keys(Ga).forEach(function(c){var d=Ga[c],h=f.def(l,".",c),m=a.block();m("if(",h,"){",g,".enable(",d,")}else{",g,".disable(",d,")}",k,".",c,"=",h,";");e(m);b("if(",h,"!==",k,".",c,"){",m,"}")});Object.keys(Ha).forEach(function(c){var d=Ha[c],h=Fa[c],m,p,n=a.block();n(g,".",d,"(");M(h)?(d=h.length,m=a.global.def(l,".",c),p=a.global.def(k,".",
c),n(oa(d,function(a){return m+"["+a+"]"}),");",oa(d,function(a){return p+"["+a+"]="+m+"["+a+"];"}).join("")),b("if(",oa(d,function(a){return m+"["+a+"]!=="+p+"["+a+"]"}).join("||"),"){",n,"}")):(m=f.def(l,".",c),p=f.def(k,".",c),n(m,");",k,".",c,"=",m,";"),b("if(",m,"!==",p,"){",n,"}"));e(n)});return a.compile()}(),compile:function(a,b,c,d,e){var f=L();f.stats=f.link(e);Object.keys(b["static"]).forEach(function(a){ia(f,b,a)});rc.forEach(function(b){ia(f,a,b)});c=O(a,b,c,d,f);ya(f,c);la(f,c);hb(f,
c);return f.compile()}}}function Tb(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var P=function(a){return a instanceof Uint8Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Float32Array||a instanceof Float64Array||a instanceof Uint8ClampedArray},W=function(a,b){for(var c=Object.keys(b),d=0;d<c.length;++d)a[c[d]]=b[c[d]];return a},Ub="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),
aa={};aa[5120]=aa[5121]=1;aa[5122]=aa[5123]=aa[36193]=aa[33635]=aa[32819]=aa[32820]=2;aa[5124]=aa[5125]=aa[5126]=aa[34042]=4;var f=W(e,{optional:function(a){a()},raise:b,commandRaise:E,command:function(a,b,c){a||E(b,c||K())},parameter:function(a,c,d){a in c||b("unknown parameter ("+a+")"+n(d)+". possible values: "+Object.keys(c).join())},commandParameter:function(a,b,c,d){a in b||E("unknown parameter ("+a+")"+n(c)+". possible values: "+Object.keys(b).join(),d||K())},constructor:function(a){Object.keys(a).forEach(function(a){0>
Ub.indexOf(a)&&b('invalid regl constructor argument "'+a+'". must be one of '+Ub)})},type:function(a,c,d){Ca(a,c)||b("invalid parameter type"+n(d)+". expected "+c+", got "+typeof a)},commandType:Y,isTypedArray:function(a,c){P(a)||b("invalid parameter type"+n(c)+". must be a typed array")},nni:function(a,c){0<=a&&(a|0)===a||b("invalid parameter type, ("+a+")"+n(c)+". must be a nonnegative integer")},oneOf:H,shaderError:function(a,b,c,d,f){if(!a.getShaderParameter(b,a.COMPILE_STATUS)){b=a.getShaderInfoLog(b);
a=d===a.FRAGMENT_SHADER?"fragment":"vertex";Y(c,"string",a+" shader source must be a string",f);var l=F(c,f);c=ma(b);C(l,c);Object.keys(l).forEach(function(a){function b(a,c){d.push(a);e.push(c||"")}var c=l[a];if(c.hasErrors){var d=[""],e=[""];b("file number "+a+": "+c.name+"\n","color:red;text-decoration:underline;font-weight:bold");c.lines.forEach(function(a){if(0<a.errors.length){b(B(a.number,4)+"|  ","background-color:yellow; font-weight:bold");b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");
var c=0;a.errors.forEach(function(d){d=d.message;var e=/^\s*'(.*)'\s*:\s*(.*)$/.exec(d);if(e){var f=e[1];d=e[2];switch(f){case "assign":f="="}c=Math.max(a.line.indexOf(f,c),0)}else c=0;b(B("| ",6));b(B("^^^",c+3)+"\n","font-weight:bold");b(B("| ",6));b(d+"\n","font-weight:bold")});b(B("| ",6)+"\n")}else b(B(a.number,4)+"|  "),b(a.line+"\n","color:red")});"undefined"===typeof document||window.chrome?console.log(d.join("")):(e[0]=d.join("%c"),console.log.apply(console,e))}});e.raise("Error compiling "+
a+" shader, "+l[0].name)}},linkError:function(a,b,c,d,f){a.getProgramParameter(b,a.LINK_STATUS)||(a=a.getProgramInfoLog(b),c=F(c,f),d='Error linking program with vertex shader, "'+F(d,f)[0].name+'", and fragment shader "'+c[0].name+'"',"undefined"!==typeof document?console.log("%c"+d+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(d+"\n"+a),e.raise(d))},callSite:la,saveCommandRef:A,saveDrawInfo:function(a,b,c,d){function e(a){return a?d.id(a):0}function f(a,
b){Object.keys(b).forEach(function(b){a[d.id(b)]=!0})}A(a);a._fragId=e(a["static"].frag);a._vertId=e(a["static"].vert);var n=a._uniformSet={};f(n,b["static"]);f(n,b.dynamic);b=a._attributeSet={};f(b,c["static"]);f(b,c.dynamic);a._hasCount="count"in a["static"]||"count"in a.dynamic||"elements"in a["static"]||"elements"in a.dynamic},framebufferFormat:function(a,b,c){a.texture?H(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):H(a.renderbuffer._renderbuffer.format,c,"unsupported renderbuffer format for attachment")},
guessCommand:K,texture2D:function(a,b,c){var d=b.width,f=b.height,l=b.channels;e(0<d&&d<=c.maxTextureSize&&0<f&&f<=c.maxTextureSize,"invalid texture shape");33071===a.wrapS&&33071===a.wrapT||e(!(d&d-1)&&!!d&&!(f&f-1)&&!!f,"incompatible wrap mode for texture, both width and height must be power of 2");1===b.mipmask?1!==d&&1!==f&&e(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(e(!(d&d-1)&&!!d&&!(f&f-1)&&!!f,"texture must be a square power of 2 to support mipmapping"),
e(b.mipmask===(d<<1)-1,"missing or incomplete mipmap data"));5126===b.type&&(0>c.extensions.indexOf("oes_texture_float_linear")&&e(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),e(!a.genMipmaps,"mipmap generation not supported with float textures"));var n=b.images;for(c=0;16>c;++c)if(n[c]){var g=d>>c,p=f>>c;e(b.mipmask&1<<c,"missing mipmap data");var k=n[c];e(k.width===g&&k.height===p,"invalid shape for mip images");e(k.format===b.format&&k.internalformat===
b.internalformat&&k.type===b.type,"incompatible type for mip image");!k.compressed&&k.data&&(g=Math.ceil($a(k.type,l)*g/k.unpackAlignment)*k.unpackAlignment,e(k.data.byteLength===g*p,"invalid data for image, buffer size is inconsistent with image format"))}else a.genMipmaps||e(0===(b.mipmask&1<<c),"extra mipmap data");b.compressed&&e(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,b,c,d){var f=a.width,l=a.height,n=a.channels;e(0<f&&f<=d.maxTextureSize&&
0<l&&l<=d.maxTextureSize,"invalid texture shape");e(f===l,"cube map must be square");e(33071===b.wrapS&&33071===b.wrapT,"wrap mode not supported by cube map");for(d=0;d<c.length;++d){var g=c[d];e(g.width===f&&g.height===l,"inconsistent cube map face shape");b.genMipmaps&&(e(!g.compressed,"can not generate mipmap for compressed textures"),e(1===g.mipmask,"can not specify mipmaps and generate mipmaps"));for(var p=g.images,k=0;16>k;++k){var t=p[k];if(t){var q=f>>k,y=l>>k;e(g.mipmask&1<<k,"missing mipmap data");
e(t.width===q&&t.height===y,"invalid shape for mip images");e(t.format===a.format&&t.internalformat===a.internalformat&&t.type===a.type,"incompatible type for mip image");t.compressed||t.data&&e(t.data.byteLength===q*y*Math.max($a(t.type,n),t.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}}),$b=0,xa={DynamicVariable:Na,define:function(a,b){return new Na(a,ab(b+""))},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof Na},unbox:function(a,
b){return"function"===typeof a?new Na(0,a):a},accessor:ab},ub={next:"function"===typeof requestAnimationFrame?function(a){return requestAnimationFrame(a)}:function(a){return setTimeout(a,16)},cancel:"function"===typeof cancelAnimationFrame?function(a){return cancelAnimationFrame(a)}:clearTimeout},Vb="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},I=yb();I.zero=yb();var sc=function(a,b){var c=1;b.ext_texture_filter_anisotropic&&(c=
a.getParameter(34047));var d=1,e=1;b.webgl_draw_buffers&&(d=a.getParameter(34852),e=a.getParameter(36063));var f=!!b.oes_texture_float;if(f){f=a.createTexture();a.bindTexture(3553,f);a.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var n=a.createFramebuffer();a.bindFramebuffer(36160,n);a.framebufferTexture2D(36160,36064,3553,f,0);a.bindTexture(3553,null);if(36053!==a.checkFramebufferStatus(36160))f=!1;else{a.viewport(0,0,1,1);a.clearColor(1,0,0,1);a.clear(16384);var g=I.allocType(5126,4);a.readPixels(0,
0,1,1,6408,5126,g);a.getError()?f=!1:(a.deleteFramebuffer(n),a.deleteTexture(f),f=1===g[0]);I.freeType(g)}}g=!0;"undefined"!==typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(g=a.createTexture(),n=I.allocType(5121,36),a.activeTexture(33984),a.bindTexture(34067,g),a.texImage2D(34069,0,6408,3,3,0,6408,5121,n),I.freeType(n),a.bindTexture(34067,null),a.deleteTexture(g),g=!a.getError());return{colorBits:[a.getParameter(3410),
a.getParameter(3411),a.getParameter(3412),a.getParameter(3413)],depthBits:a.getParameter(3414),stencilBits:a.getParameter(3415),subpixelBits:a.getParameter(3408),extensions:Object.keys(b).filter(function(a){return!!b[a]}),maxAnisotropic:c,maxDrawbuffers:d,maxColorAttachments:e,pointSizeDims:a.getParameter(33901),lineWidthDims:a.getParameter(33902),maxViewportDims:a.getParameter(3386),maxCombinedTextureUnits:a.getParameter(35661),maxCubeMapSize:a.getParameter(34076),maxRenderbufferSize:a.getParameter(34024),
maxTextureUnits:a.getParameter(34930),maxTextureSize:a.getParameter(3379),maxAttributes:a.getParameter(34921),maxVertexUniforms:a.getParameter(36347),maxVertexTextureUnits:a.getParameter(35660),maxVaryingVectors:a.getParameter(36348),maxFragmentUniforms:a.getParameter(36349),glsl:a.getParameter(35724),renderer:a.getParameter(7937),vendor:a.getParameter(7936),version:a.getParameter(7938),readFloat:f,npotTextureCube:g}},ba=function(a){return Object.keys(a).map(function(b){return a[b]})},gb={shape:function(a){for(var b=
[];a.length;a=a[0])b.push(a.length);return b},flatten:function(a,b,c,d){var e=1;if(b.length)for(var f=0;f<b.length;++f)e*=b[f];else e=0;c=d||I.allocType(c,e);switch(b.length){case 0:break;case 1:d=b[0];for(b=0;b<d;++b)c[b]=a[b];break;case 2:d=b[0];b=b[1];for(f=e=0;f<d;++f)for(var n=a[f],g=0;g<b;++g)c[e++]=n[g];break;case 3:zb(a,b[0],b[1],b[2],c,0);break;default:Ab(a,b,0,c,0)}return c}},cb={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,
"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},La={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126},db={dynamic:35048,stream:35040,"static":35044},lb=gb.flatten,Db=gb.shape,ja=[];ja[5120]=1;ja[5122]=2;ja[5124]=4;ja[5121]=1;ja[5123]=2;ja[5125]=4;ja[5126]=4;var Pa={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,
"triangle fan":6},Fb=new Float32Array(1),dc=new Uint32Array(Fb.buffer),Ob=function(a){return!(a&a-1)&&!!a},gc=[9984,9986,9985,9987],fb=[0,6409,6410,6407,6408],ca={};ca[6409]=ca[6406]=ca[6402]=1;ca[34041]=ca[6410]=2;ca[6407]=ca[35904]=3;ca[6408]=ca[35906]=4;var pb=Qa("HTMLCanvasElement"),qb=Qa("OffscreenCanvas"),Kb=Qa("CanvasRenderingContext2D"),Lb=Qa("ImageBitmap"),Mb=Qa("HTMLImageElement"),Nb=Qa("HTMLVideoElement"),ec=Object.keys(cb).concat([pb,qb,Kb,Lb,Mb,Nb]),Ra=[];Ra[5121]=1;Ra[5126]=4;Ra[36193]=
2;Ra[5123]=2;Ra[5125]=4;var N=[];N[32854]=2;N[32855]=2;N[36194]=2;N[34041]=4;N[33776]=.5;N[33777]=.5;N[33778]=1;N[33779]=1;N[35986]=.5;N[35987]=1;N[34798]=1;N[35840]=.5;N[35841]=.25;N[35842]=.5;N[35843]=.25;N[36196]=.5;var ea=[];ea[32854]=2;ea[32855]=2;ea[36194]=2;ea[33189]=2;ea[36168]=1;ea[34041]=4;ea[35907]=4;ea[34836]=16;ea[34842]=8;ea[34843]=6;var tc=function(a,b,c,d,e){function l(a){this.id=k++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;e.profile&&(this.stats=
{size:0})}function n(b){var c=b.renderbuffer;f(c,"must not double destroy renderbuffer");a.bindRenderbuffer(36161,null);a.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete t[b.id];d.renderbufferCount--}var g={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};b.ext_srgb&&(g.srgba=35907);b.ext_color_buffer_half_float&&(g.rgba16f=34842,g.rgb16f=34843);b.webgl_color_buffer_float&&(g.rgba32f=34836);var p=[];Object.keys(g).forEach(function(a){p[g[a]]=
a});var k=0,t={};l.prototype.decRef=function(){0>=--this.refCount&&n(this)};e.profile&&(d.getTotalRenderbufferSize=function(){var a=0;Object.keys(t).forEach(function(b){a+=t[b].stats.size});return a});return{create:function(b,h){function k(b,d){var h=0,l=0,q=32854;"object"===typeof b&&b?("shape"in b?(l=b.shape,f(Array.isArray(l)&&2<=l.length,"invalid renderbuffer shape"),h=l[0]|0,l=l[1]|0):("radius"in b&&(h=l=b.radius|0),"width"in b&&(h=b.width|0),"height"in b&&(l=b.height|0)),"format"in b&&(f.parameter(b.format,
g,"invalid renderbuffer format"),q=g[b.format])):"number"===typeof b?(h=b|0,l="number"===typeof d?d|0:h):b?f.raise("invalid arguments to renderbuffer constructor"):h=l=1;f(0<h&&0<l&&h<=c.maxRenderbufferSize&&l<=c.maxRenderbufferSize,"invalid renderbuffer size");if(h!==n.width||l!==n.height||q!==n.format)return k.width=n.width=h,k.height=n.height=l,n.format=q,a.bindRenderbuffer(36161,n.renderbuffer),a.renderbufferStorage(36161,q,h,l),f(0===a.getError(),"invalid render buffer format"),e.profile&&(n.stats.size=
ea[n.format]*n.width*n.height),k.format=p[n.format],k}var n=new l(a.createRenderbuffer());t[n.id]=n;d.renderbufferCount++;k(b,h);k.resize=function(b,d){var g=b|0,h=d|0||g;if(g===n.width&&h===n.height)return k;f(0<g&&0<h&&g<=c.maxRenderbufferSize&&h<=c.maxRenderbufferSize,"invalid renderbuffer size");k.width=n.width=g;k.height=n.height=h;a.bindRenderbuffer(36161,n.renderbuffer);a.renderbufferStorage(36161,n.format,g,h);f(0===a.getError(),"invalid render buffer format");e.profile&&(n.stats.size=ea[n.format]*
n.width*n.height);return k};k._reglType="renderbuffer";k._renderbuffer=n;e.profile&&(k.stats=n.stats);k.destroy=function(){n.decRef()};return k},clear:function(){ba(t).forEach(n)},restore:function(){ba(t).forEach(function(b){b.renderbuffer=a.createRenderbuffer();a.bindRenderbuffer(36161,b.renderbuffer);a.renderbufferStorage(36161,b.format,b.width,b.height)});a.bindRenderbuffer(36161,null)}}},jc=[6407,6408],rb=[];rb[6408]=4;rb[6407]=3;var jb=[];jb[5121]=1;jb[5126]=4;jb[36193]=2;var kc=[32854,32855,
36194,35907,34842,34843,34836],ic={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},Wa=["x","y","z","w"],rc="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),za={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,
"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Qb="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
Va={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ja={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Rb={frag:35632,vert:35633},tb={cw:2304,ccw:2305},Sb=new qa(!1,!1,!1,function(){}),uc=function(a,b){function c(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function d(a,b,e){var f=
n.pop()||new c;f.startQueryIndex=a;f.endQueryIndex=b;f.sum=0;f.stats=e;g.push(f)}if(!b.ext_disjoint_timer_query)return null;var e=[],f=[],n=[],g=[],p=[],k=[];return{beginQuery:function(a){var c=e.pop()||b.ext_disjoint_timer_query.createQueryEXT();b.ext_disjoint_timer_query.beginQueryEXT(35007,c);f.push(c);d(f.length-1,f.length,a)},endQuery:function(){b.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:d,update:function(){var a,c;a=f.length;if(0!==a){k.length=Math.max(k.length,a+1);p.length=
Math.max(p.length,a+1);p[0]=0;var d=k[0]=0;for(c=a=0;c<f.length;++c){var u=f[c];b.ext_disjoint_timer_query.getQueryObjectEXT(u,34919)?(d+=b.ext_disjoint_timer_query.getQueryObjectEXT(u,34918),e.push(u)):f[a++]=u;p[c+1]=d;k[c+1]=a}f.length=a;for(c=a=0;c<g.length;++c){var d=g[c],r=d.startQueryIndex,u=d.endQueryIndex;d.sum+=p[u]-p[r];r=k[r];u=k[u];u===r?(d.stats.gpuTime+=d.sum/1E6,n.push(d)):(d.startQueryIndex=r,d.endQueryIndex=u,g[a++]=d)}g.length=a}},getNumPendingQueries:function(){return f.length},
clear:function(){e.push.apply(e,f);for(var a=0;a<e.length;a++)b.ext_disjoint_timer_query.deleteQueryEXT(e[a]);f.length=0;e.length=0},restore:function(){f.length=0;e.length=0}}};return function(a){function b(){if(0===U.length)C&&C.update(),Y=null;else{Y=ub.next(b);t();for(var a=U.length-1;0<=a;--a){var c=U[a];c&&c(E,null,0)}u.flush();C&&C.update()}}function c(){!Y&&0<U.length&&(Y=ub.next(b))}function d(){Y&&(ub.cancel(b),Y=null)}function e(a){a.preventDefault();m=!0;d();ba.forEach(function(a){a()})}
function l(a){u.getError();m=!1;y.restore();Q.restore();G.restore();I.restore();O.restore();M.restore();K.restore();C&&C.restore();P.procs.refresh();c();ca.forEach(function(a){a()})}function n(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];xa.isDynamic(e)?d[b]=xa.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;q.length<a;)q.push(null);return q}f(!!a,"invalid args to regl({...})");f.type(a,"object","invalid args to regl({...})");var d=b(a.context||
{}),e=b(a.uniforms||{}),g=b(a.attributes||{}),h=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=W({},a);delete c.uniforms;delete c.attributes;delete c.context;delete c.vao;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");"vao"in a&&(c.vao=a.vao);return c}(a));a={gpuTime:0,cpuTime:0,count:0};
var d=P.compile(h,g,e,d,a),k=d.draw,l=d.batch,p=d.scope,q=[];return W(function(a,b){var d;m&&f.raise("context lost");if("function"===typeof a)return p.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)p.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)p.call(this,a[d],b,d);else return p.call(this,a,b,0);else if("number"===typeof a){if(0<a)return l.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return l.call(this,a,a.length)}else return k.call(this,
a)},{stats:a})}function g(a,b){var c=0;P.procs.poll();var d=b.color;d&&(u.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in b&&(u.clearDepth(+b.depth),c|=256);"stencil"in b&&(u.clearStencil(b.stencil|0),c|=1024);f(!!c,"called regl.clear with no buffer specified");u.clear(c)}function p(a){f.type(a,"function","regl.frame() callback must be a function");U.push(a);c();return{cancel:function(){function b(){var a=Tb(U,b);U[a]=U[U.length-1];--U.length;0>=U.length&&d()}var c=Tb(U,a);f(0<=
c,"cannot cancel a frame twice");U[c]=b}}}function k(){var a=aa.viewport,b=aa.scissor_box;a[0]=a[1]=b[0]=b[1]=0;E.viewportWidth=E.framebufferWidth=E.drawingBufferWidth=a[2]=b[2]=u.drawingBufferWidth;E.viewportHeight=E.framebufferHeight=E.drawingBufferHeight=a[3]=b[3]=u.drawingBufferHeight}function t(){E.tick+=1;E.time=v();k();P.procs.poll()}function q(){k();P.procs.refresh();C&&C.update()}function v(){return(Vb()-J)/1E3}a=Zb(a);if(!a)return null;var u=a.gl,r=u.getContextAttributes(),m=u.isContextLost(),
y=ac(u,a);if(!y)return null;var w=Wb(),A={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},B=y.extensions,C=uc(u,B),J=Vb(),H=u.drawingBufferWidth,N=u.drawingBufferHeight,E={tick:0,time:0,viewportWidth:H,viewportHeight:N,framebufferWidth:H,framebufferHeight:N,drawingBufferWidth:H,drawingBufferHeight:N,pixelRatio:a.pixelRatio},F=sc(u,B),G=bc(u,A,a,function(a){return K.destroyBuffer(a)}),K=lc(u,B,F,A,G),D=cc(u,
B,G,A),Q=mc(u,w,A,a),I=fc(u,B,F,function(){P.procs.poll()},E,A,a),O=tc(u,B,F,A,a),M=hc(u,B,F,I,O,A),P=pc(u,w,B,F,G,D,I,M,{},K,Q,{elements:null,primitive:4,count:-1,offset:0,instances:-1},E,C,a),w=nc(u,M,P.procs.poll,E,r,B,F),aa=P.next,X=u.canvas,U=[],ba=[],ca=[],ea=[a.onDestroy],Y=null;X&&(X.addEventListener("webglcontextlost",e,!1),X.addEventListener("webglcontextrestored",l,!1));var fa=M.setFBO=n({framebuffer:xa.define.call(null,1,"framebuffer")});q();r=W(n,{clear:function(a){f("object"===typeof a&&
a,"regl.clear() takes an object as input");if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)fa(W({framebuffer:a.framebuffer.faces[b]},a),g);else fa(a,g);else g(null,a)},prop:xa.define.bind(null,1),context:xa.define.bind(null,2),"this":xa.define.bind(null,3),draw:n({}),buffer:function(a){return G.create(a,34962,!1,!1)},elements:function(a){return D.create(a,!1)},texture:I.create2D,cube:I.createCube,renderbuffer:O.create,framebuffer:M.create,framebufferCube:M.createCube,
vao:K.createVAO,attributes:r,frame:p,on:function(a,b){f.type(b,"function","listener callback must be a function");var c;switch(a){case "frame":return p(b);case "lost":c=ba;break;case "restore":c=ca;break;case "destroy":c=ea;break;default:f.raise("invalid event, must be one of frame,lost,restore,destroy")}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:F,hasExtension:function(a){return 0<=F.extensions.indexOf(a.toLowerCase())},
read:w,destroy:function(){U.length=0;d();X&&(X.removeEventListener("webglcontextlost",e),X.removeEventListener("webglcontextrestored",l));Q.clear();M.clear();O.clear();I.clear();D.clear();G.clear();K.clear();C&&C.clear();ea.forEach(function(a){a()})},_gl:u,_refresh:q,poll:function(){t();C&&C.update()},now:v,stats:A});a.onDone(null,r);return r}})},{}]},{},[1]);
