<!DOCTYPE html>
      <html>
        <head>
          <title>example/tile.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(g,n,b){function d(a,h){if(!n[a]){if(!g[a]){var q="function"==typeof require&&require;if(!h&&q)return q(a,!0);if(c)return c(a,!0);q=Error("Cannot find module '"+a+"'");throw q.code="MODULE_NOT_FOUND",q;}q=n[a]={exports:{}};g[a][0].call(q.exports,function(c){var b=g[a][1][c];return d(b?b:c)},q,q.exports,e$$0,g,n,b)}return n[a].exports}for(var c="function"==typeof require&&require,a=0;a<b.length;a++)d(b[a]);return d})({1:[function(e,g,n){g.exports=[[[1,11],[1,11],[1,11],[1,11],[1,11],
[1,11],[1,11],[1,11],[6,6],[7,6],[8,6],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[0,0],[1,0],[1,0],[2,0],[1,11],[1,11],[1,11],[6,6],[7,6],[8,6],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[0,1],[1,1],[1,1],[2,1],[1,11],[1,11],[1,11],[6,6],[8,8],[8,6],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[0,1],[1,1],[0,3],[5,2],[1,11],[13,12],[13,12],[6,6],[7,6],[6,9],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[0,1],[1,1],[2,1],[1,11],[1,11],[13,15],[13,15],[6,6],[7,6],[7,6],[6,9],[1,11],[1,11],[1,11],[1,
11]],[[1,11],[0,2],[1,2],[2,2],[1,11],[1,11],[14,2],[15,2],[6,6],[7,6],[7,6],[7,6],[6,9],[8,5],[1,11],[1,11]],[[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[6,6],[8,8],[7,6],[7,6],[7,6],[8,6],[1,11],[1,11]],[[4,5],[2,5],[0,5],[1,5],[2,5],[1,11],[1,11],[1,11],[6,7],[7,8],[7,6],[7,6],[8,9],[6,9],[8,5],[1,11]],[[2,8],[3,9],[4,9],[4,6],[3,9],[5,0],[1,11],[1,11],[1,11],[6,7],[7,8],[7,6],[7,6],[8,8],[8,6],[1,11]],[[4,7],[4,7],[4,8],[5,8],[2,9],[3,9],[4,5],[2,5],[1,11],[1,11],[6,7],[7,8],[7,6],
[7,6],[6,9],[8,5]],[[1,11],[1,11],[3,7],[4,7],[4,8],[5,9],[5,8],[0,9],[2,5],[1,11],[1,11],[6,7],[7,8],[7,6],[7,6],[6,9]],[[1,11],[1,11],[1,11],[1,11],[0,7],[4,8],[4,6],[4,6],[5,1],[1,11],[1,11],[1,11],[6,7],[7,8],[7,6],[7,6]],[[1,11],[9,0],[10,0],[8,0],[1,11],[3,7],[1,7],[1,7],[5,7],[1,11],[1,11],[1,11],[1,11],[6,7],[7,7],[7,7]],[[1,11],[9,1],[11,3],[11,1],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[9,2],[7,2],[11,2],[1,11],[1,11],[1,11],[2,12],[1,
13],[1,13],[1,13],[1,13],[1,13],[1,13],[0,12],[1,11]],[[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[2,10],[3,10],[3,10],[3,10],[3,10],[3,10],[3,10],[0,10],[1,11]]]},{}],2:[function(e,g,n){var b=e("../regl")(),d=e("mouse-change")(),c=e("./assets/map.json"),a=b({attributes:{position:b.buffer([-1,-1,1,-1,-1,1,1,1,-1,1,1,-1])},uniforms:{view:b.prop("view")},count:6}),F=b({frag:"\n  precision mediump float;\n  uniform sampler2D map, tiles;\n  uniform vec2 mapSize, tileSize;\n  varying vec2 uv;\n  void main() {\n    vec2 tileCoord = floor(255.0 * texture2D(map, floor(uv) / mapSize).ra);\n    gl_FragColor = texture2D(tiles, (tileCoord + fract(uv)) / tileSize);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  uniform vec4 view;\n  varying vec2 uv;\n  void main() {\n    uv = mix(view.xw, view.zy, 0.5 * (1.0 + position));\n    gl_Position = vec4(position, 1, 1);\n  }",depth:{enable:!1},uniforms:{tiles:b.texture("assets/tiles.png"),tileSize:[16,16],map:b.texture(c),mapSize:[c[0].length,c.length]}});b.frame(function(){var h=b.stats,q=h.width,m=h.height,h=c[0].length*d.x/q,e=c.length*d.y/m,q=q/m*10;a({view:[h-.5*q,e-5,h+.5*q,e+5]},function(){F()})})},
{"../regl":36,"./assets/map.json":1,"mouse-change":34}],3:[function(e,g,n){function b(){this.pointer=!1;this.w=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}var d=e("./constants/dtypes.json"),c=e("./util/extend");c(b.prototype,{equals:function(a,c){return this.pointer?a.pointer&&this.buffer===a.buffer&&this.size===c&&this.normalized===a.normalized&&this.type===a.type&&this.offset===a.offset&&this.stride===a.stride&&this.divisor===
a.divisor:!a.pointer&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},set:function(a,c){(this.pointer=a.pointer)?(this.buffer=a.buffer,this.size=c,this.normalized=a.normalized,this.type=a.type,this.offset=a.offset,this.stride=a.stride,this.divisor=a.divisor):(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w)}});g.exports=function(a,e,h,q,m){function g(a){for(var c=Array(16),d=0;16>d;++d)c[d]=new b;this.records=c;this.top=-1;this.name=a}function T(a){for(var c=a.records,d=a.top;c.length-1<=d;)c.push(new b);
return c[++a.top]}var r={};h=h.maxAttributes;for(var f=Array(h),y=0;y<h;++y)f[y]=new b;c(g.prototype,{pushVec:function(a,c,d,b){var f=T(this);f.pointer=!1;f.x=a;f.y=c;f.z=d;f.w=b},pushPtr:function(a,c,d,b,f,m,h){var e=T(this);e.pointer=!0;e.buffer=a;e.size=c;e.offset=d;e.stride=b;e.divisor=f;e.normalized=m;e.type=h},pushDyn:function(a){if("number"===typeof a)this.pushVec(a,0,0,0);else if(Array.isArray(a))this.pushVec(a[0],a[1],a[2],a[3]);else{var c=q.getBuffer(a),b=0,f=0,m=0,h=0,e=!1,F=5126;c?F=c.dtype:
(c=q.getBuffer(a.buffer),b=a.size||0,f=a.stride||0,m=a.offset||0,h=a.divisor||0,e=a.normalized||!1,F=c.dtype,"type"in a&&(F=d[a.type]));this.pushPtr(c,b,m,f,h,e,F)}},pop:function(){--this.top}});return{bindings:f,bind:function(c,d,b,f){b=b.records[b.top];f=b.size||f;if(!d.equals(b,f)){if(b.pointer){d.pointer||a.enableVertexAttribArray(c);d.buffer!==b.buffer&&b.buffer.bind();a.vertexAttribPointer(c,f,b.type,b.normalized,b.stride,b.offset);var m=e.angle_instanced_arrays;m&&m.vertexAttribDivisorANGLE(c,
b.divisor)}else d.pointer&&a.disableVertexAttribArray(c),a.vertexAttrib4f(c,b.x,b.y,b.z,b.w);d.set(b,f)}},def:function(a){var c=m.id(a),b=r[c];b||(b=r[c]=new g(a));return b}}}},{"./constants/dtypes.json":7,"./util/extend":25}],4:[function(e,g,n){function b(a,c){switch(a){case 5121:return new Uint8Array(c);case 5123:return new Uint16Array(c);case 5125:return new Uint32Array(c);case 5120:return new Int8Array(c);case 5122:return new Int16Array(c);case 5124:return new Int32Array(c);case 5126:return new Float32Array(c);
default:return null}}var d=e("./util/is-typed-array"),c=e("./util/is-ndarray"),a=e("./constants/arraytypes.json"),F=e("./constants/dtypes.json"),h=e("./util/values"),q={"static":35044,dynamic:35048,stream:35040};g.exports=function(m){function e(a,c){this.id=f++;this.buffer=a;this.type=c;this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function g(a){m.isBuffer(a.buffer)||(a.buffer=m.createBuffer());a.bind();m.bufferData(a.type,a.data||a.byteLength,a.usage)}function r(a){var c=
a.buffer;m.isBuffer(c)&&m.deleteBuffer(c);a.buffer=null;delete y[a.id]}var f=0,y={};e.prototype.bind=function(){m.bindBuffer(this.type,this.buffer)};return{create:function(f,h,P){function x(f){var k=f||{};if(Array.isArray(k)||d(k)||c(k))k={data:k};else if("number"===typeof k)k={length:k|0};else if(null===k||void 0===k)k={};n.usage="usage"in k?q[k.usage]:35044;f=0;"type"in k&&(f=F[k.type]);var m=k.dimension|0||1,h=0,e=null;if("data"in k)if(e=k.data,null===e)h=k.length|0;else{if(c(e)){var m=e.shape,
h=e.stride,k=e.offset,w=0,y=0,P=0,t=0;1===m.length?(w=m[0],y=1,P=h[0],t=0):2===m.length&&(w=m[0],y=m[1],P=h[0],t=h[1]);f=f||a[Object.prototype.toString.call(e)]|0||5126;for(var m=y,h=b(f,w*y),e=e.data,r=0,ja=0;ja<w;++ja)for(var R=0;R<y;++R)h[r++]=e[P*ja+t*R+k];e=h}else if(Array.isArray(e))if(0<e.length&&Array.isArray(e[0])){m=e[0].length;f=f||5126;k=b(f,e.length*m);h=e;e=m;for(w=t=0;w<h.length;++w)for(P=h[w],y=0;y<e;++y)k[t++]=P[y];e=k}else f=f||5126,e=b(f,e);else f=f||a[Object.prototype.toString.call(e)]|
0;h=e.byteLength}else"length"in k&&(h=k.length|0);n.data=e;n.dtype=f||5121;n.byteLength=h;n.dimension=m;g(n);return x}var D=m.createBuffer(),n=new e(D,h);y[n.id]=n;P||x(f);x._reglType="buffer";x._buffer=n;x.destroy=function(){r(n)};return x},clear:function(){h(y).forEach(r)},refresh:function(){h(y).forEach(g)},getBuffer:function(a){return a&&a._buffer instanceof e?a._buffer:null}}}},{"./constants/arraytypes.json":6,"./constants/dtypes.json":7,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/values":33}],
5:[function(e,g,n){function b(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function d(a,c,b,d){var m,e=",";switch(c){case 5126:m="1f";break;case 35664:m="2fv";break;case 35665:m="3fv";break;case 35666:m="4fv";break;case 35670:case 5124:m="1i";break;case 35671:case 35667:m="2iv";break;case 35672:case 35668:m="3iv";break;case 35673:case 35669:m="4iv";break;case 35674:m="Matrix2fv";e=",false,";
break;case 35675:m="Matrix3fv";e=",false,";break;case 35676:m="Matrix4fv",e=",false,"}return a+".uniform"+m+"("+b+e+d+");"}function c(a){return a+"["+a+".length-1]"}function a(a,c){return"framebuffer"===a||a<c?-1:a>c?1:0}var F=e("./util/codegen"),h=e("./constants/primitives.json"),q=e("./constants/dtypes.json"),m={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,
"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},N={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},T={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};g.exports=function(e,f,y,k,w,g,x,n,K,z,Q,da,U,ea,ha){function O(k,
f,q,w,x){function E(a){var c=C[a];return c?c:c=C[a]=v(L[a])}function Y(a){var c=a.id,p=da[c];if(p)return p;p=a.func?l.def(v(a.data),"(",K,",",Z,",",I,")"):l.def(K,".",a.data);return da[c]=p}function pa(a,c){return a.find(function(a){return a.name===c})}function X(a){return ka&&!(a in f||a in x)}var V=F(),v=V.link,l=V.proc("batch"),H=V.block(),A=l.def,aa=l.arg,p=v(e),M=v(k.program),S=v(Q.bind),I=v(ea),ma=v(n),ia=v(U.count),la=v(U.offset),qa=v(U.instances),ga=v(U.primitive),C={},B=v(g.elements),ia=
A(c(ia)),la=A(c(la)),ga=A(c(ga)),B=A(c(B)),G,J,O=y.angle_instanced_arrays;O&&(G=A(c(qa)),J=v(O));var ka="elements"in f,qa=aa(),aa=aa(),K=A(),Z=A(),da={};l(p,".useProgram(",M,");");k.uniforms.forEach(function(a){if(!(a.name in q)){var c=v(a.location),u=v(z.def(a.name)),u=u+"["+u+".length-1]";a=a.info.type;35678===a||35680===a?(a=A(u+"._texture"),l(d(p,5124,c,a+".bind()")),H(a,".unbind();")):l(d(p,a,c,u))}});k.attributes.forEach(function(a){if(!(w.name in w)){var c=v(Q.def(a.name));l(S,"(",a.location,
",",v(Q.bindings[a.location]),",",c,",",b(a.info.type),");")}});ka||l("if(",B,"){",p,".bindBuffer(",34963,",",B,".buffer.buffer);","}else{",p,".bindBuffer(",34963,",null);","}");l("for(",Z,"=0;",Z,"<",qa,";++",Z,"){",K,"=",aa,"[",Z,"];");Object.keys(f).sort(a).forEach(function(a){function c(a){l("if(",u,"){",p,".enable(",a,");}else{",p,".disable(",a,");}")}var u=Y(f[a]);switch(a){case "framebuffer":a=E("viewport");var b=E("scissor.box");l("if(",ma,".push(",u,"&&",u,"._framebuffer)){",ma,".poll();",
a,".setDirty();",b,".setDirty();","}");break;case "cull.enable":c(2884);break;case "blend.enable":c(3042);break;case "dither":c(3024);break;case "stencil.enable":c(2960);break;case "depth.enable":c(2929);break;case "scissor.enable":c(3089);break;case "polygonOffset.enable":c(32823);break;case "sample.alpha":c(32926);break;case "sample.enable":c(32928);break;case "depth.mask":l(p,".depthMask(",u,");");break;case "depth.func":a=v(N);l(p,".depthFunc(",a,"[",u,"]);");break;case "depth.range":l(p,".depthRange(",
u,"[0],",u,"[1]);");break;case "blend.color":l(p,".blendColor(",u,"[0],",u,"[1],",u,"[2],",u,"[3]);");break;case "blend.equation":a=v(t);l("if(typeof ",u,'==="string"){',p,".blendEquation(",a,"[",u,"]);","}else{",p,".blendEquationSeparate(",a,"[",u,".rgb],",a,"[",u,".alpha]);","}");break;case "blend.func":a=v(m);l(p,".blendFuncSeparate(",a,'["srcRGB" in ',u,"?",u,".srcRGB:",u,".src],",a,'["dstRGB" in ',u,"?",u,".dstRGB:",u,".dst],",a,'["srcAlpha" in ',u,"?",u,".srcAlpha:",u,".src],",a,'["dstAlpha" in ',
u,"?",u,".dstAlpha:",u,".dst]);");break;case "stencil.mask":l(p,".stencilMask(",u,");");break;case "stencil.func":a=v(N);l(p,".stencilFunc(",a,"[",u,'.cmp||"always"],',u,".ref|0,",'"mask" in ',u,"?",u,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":b=v(T);l(p,".stencilOpSeparate(","stencil.opFront"===a?1028:1029,",",b,"[",u,'.fail||"keep"],',b,"[",u,'.zfail||"keep"],',b,"[",u,'.pass||"keep"]);');break;case "polygonOffset.offset":l(p,".polygonOffset(",u,".factor||0,",u,".units||0);");
break;case "cull.face":l(p,".cullFace(",u,'==="front"?',1028,":",1029,");");break;case "lineWidth":l(p,".lineWidth(",u,");");break;case "frontFace":l(p,".frontFace(",u,'==="cw"?',2304,":",2305,");");break;case "colorMask":l(p,".colorMask(",u,"[0],",u,"[1],",u,"[2],",u,"[3]);");break;case "sample.coverage":l(p,".sampleCoverage(",u,".value,",u,".invert);");break;case "scissor.box":case "viewport":a=E(a),l(a,".push(",u,".x||0,",u,".y||0,",u,".w||-1,",u,".h||-1);")}});("viewport"in f||"framebuffer"in
f)&&l(E("viewport"),".poll();");("scissor.box"in f||"framebuffer"in f)&&l(E("scissor.box"),".poll();");"framebuffer"in f&&l(ma,".pop();");var ha=k.uniforms,na=[];Object.keys(q).forEach(function(a){var u=pa(ha,a);if(u){var c=u.info.type,b=v(u.location);a=Y(q[a]);35678===u.info.type||35680===u.info.type?(u=A(a+"._texture"),na.push(u),l(d(p,5124,b,u+".bind()"))):l(d(p,c,b,a))}});na.forEach(function(a){l(a,".unbind();")});var u=k.attributes;Object.keys(w).forEach(function(a){var c=pa(u,a);c&&l(S,"(",
c.location,",",v(a.bindings[c.location]),",",Y(w[a]),",",b(c.info.type),");")});f.count?l(ia,"=",Y(f.count),";"):X("count")||l("if(",ia,"){");f.offset&&l(la,"=",Y(f.offset),";");f.primitive&&(k=v(h),l(ga,"=",k,"[",Y(f.primitive),"];"));ka&&(k=Y(f.elements),l(B,"=",k,"?",k,"._elements:null;"));X("offset")&&l(la,"=0;");l("if(",B,"){");X("count")&&l(ia,"=",B,".vertCount;","if(",ia,">0){");X("primitive")&&l(ga,"=",B,".primType;");ka&&l(p,".bindBuffer(",34963,",",B,".buffer.buffer);");O&&(f.instances&&
l(G,"=",Y(f.instances),";"),l("if(",G,">0){",J,".drawElementsInstancedANGLE(",ga,",",ia,",",B,".type,",la,",",G,");}else{"));l(p,".drawElements(",ga,",",ia,",",B,".type,",la,");");O&&l("}");X("count")&&l("}");l("}else{");X("count")||(X("primitive")&&l(ga,"=",4,";"),O&&l("if(",G,">0){",J,".drawArraysInstancedANGLE(",ga,",",la,",",ia,",",G,");}else{"),l(p,".drawArrays(",ga,",",la,",",ia,");}"),O&&l("}"));l("}}",H);return V.compile().batch}var L=K.contextState,t={add:32774,subtract:32778,"reverse subtract":32779};
y.ext_blend_minmax&&(t.min=32775,t.max=32776);var E=0;return{draw:function(a){var f=F(),k=f.link,m=f.proc("draw"),h=m.def,t=k(e),q=k(a.program),w=k(Q.bind),x=k(U.count),E=k(U.offset),v=k(U.instances),l=k(U.primitive),n=k(g.elements),N=[];m(t,".useProgram(",q,");");a.attributes.forEach(function(a){var c=k(Q.def(a.name));m(w,"(",a.location,",",k(Q.bindings[a.location]),",",c,",",b(a.info.type),");")});a.uniforms.forEach(function(a){var c=k(a.location),b=k(z.def(a.name)),b=b+"["+b+".length-1]";a=a.info.type;
35678===a||35680===a?(a=h(b+"._texture"),N.push(a),m(d(t,5124,c,a+".bind()"))):m(d(t,a,c,b))});N.forEach(function(a){m(a,".unbind();")});a=h(c(l));x=h(c(x));E=h(c(E));n=h(c(n));m("if(",x,"){");(q=y.angle_instanced_arrays)?(v=h(c(v)),q=k(q),m("if(",n,"){",n,".bind();","if(",v,">0){",q,".drawElementsInstancedANGLE(",a,",",x,",",n,".type,",E,",",v,");}else{",t,".drawElements(",a,",",x,",",n,".type,",E,");}","}else if(",v,">0){",q,".drawArraysInstancedANGLE(",a,",",E,",",x,",",v,");}else{",t,".drawArrays(",
a,",",E,",",x,");}}")):m("if(",n,"){",t,".drawElements(",a,",",x,",",n,".type,",E,");}","}else{",t,".drawArrays(",a,",",E,",",x,");}");return f.compile().draw},command:function(c,b,k,d,e,x,y){function r(a){var c=ga[a];return c?c:c=ga[a]=l(L[a])}function X(a,c){var b=r(a);C(b,".push(",c,");");B(b,".pop();")}function V(a){var c=a.id,b=ra[c];if(b)return b;b=a.func?G.def(l(a.data),"(",ka,",0,",sa,")"):G.def(ka,".",a.data);return ra[c]=b}var v=F(),l=v.link,H=v.block,A=v.proc,K=E++,p=l(ha);l(f);var M=l(da),
S=l(n),I={count:l(U.count),offset:l(U.offset),instances:l(U.instances),primitive:l(U.primitive)},ma=l(g.elements),ia=l(h),la=l(N),qa=l(T),ga={},C=H(),B=H();Object.keys(c).sort(a).forEach(function(a){var b=c[a];switch(a){case "frag":case "vert":b=f.id(b);da.shader("frag"===a?35632:35633,b);C(M,".",a,".push(",b,");");B(M,".",a,".pop();");break;case "framebuffer":n.getFramebuffer(b);a=r("viewport");var p=r("scissor.box");C("if(",S,".push(",l(b&&b._framebuffer),")){",a,".setDirty();",p,".setDirty();",
"}");B("if(",S,".pop()){",a,".setDirty();",p,".setDirty();","}");break;case "count":case "offset":case "instances":C(I[a],".push(",b,");");B(I[a],".pop();");break;case "primitive":C(I.primitive,".push(",h[b],");");B(I.primitive,".pop();");break;case "elements":p=g.getElements(b);b=!("primitive"in c);a=!("count"in c);p?(p=l(p),C(ma,".push(",p,");"),b&&C(I.primitive,".push(",p,".primType);"),a&&C(I.count,".push(",p,".vertCount);")):(C(ma,".push(null);"),b&&C(I.primitive,".push(",4,");"),a&&C(I.count,
".push(0);"));b&&B(I.primitive,".pop();");a&&B(I.count,".pop();");"offset"in c||(C(I.offset,".push(0);"),B(I.offset,".pop();"));B(ma,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":X(a,b);break;case "depth.func":X(a,N[b]);break;case "depth.range":a=r(a);C(a,".push(",b[0],",",b[1],");");B(a,".pop();");break;case "blend.func":a=
r(a);C(a,".push(",m["srcRGB"in b?b.srcRGB:b.src],",",m["dstRGB"in b?b.dstRGB:b.dst],",",m["srcAlpha"in b?b.srcAlpha:b.src],",",m["dstAlpha"in b?b.dstAlpha:b.dst],");");B(a,".pop();");break;case "blend.equation":a=r(a);"string"===typeof b?C(a,".push(",t[b],",",t[b],");"):"object"===typeof b&&C(a,".push(",t[b.rgb],",",t[b.alpha],");");B(a,".pop();");break;case "blend.color":a=r(a);C(a,".push(",b[0],",",b[1],",",b[2],",",b[3],");");B(a,".pop();");break;case "stencil.mask":a=r(a);C(a,".push(",b,");");
B(a,".pop();");break;case "stencil.func":var p=b.cmp||"keep",d=b.ref||0,b="mask"in b?b.mask:-1;a=r(a);C(a,".push(",N[p],",",d,",",b,");");B(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":p=b.fail||"keep";d=b.zfail||"keep";b=b.pass||"keep";a=r(a);C(a,".push(",T[p],",",T[d],",",T[b],");");B(a,".pop();");break;case "polygonOffset.offset":p=b.factor||0;b=b.units||0;a=r(a);C(a,".push(",p,",",b,");");B(a,".pop();");break;case "cull.face":p=0;"front"===b?p=1028:"back"===b&&(p=1029);b=r(a);
C(b,".push(",p,");");B(b,".pop();");break;case "lineWidth":X(a,b);break;case "frontFace":p=0;"cw"===b?p=2304:"ccw"===b&&(p=2305);b=r(a);C(b,".push(",p,");");B(b,".pop();");break;case "colorMask":a=r(a);C(a,".push(",b.map(function(a){return!!a}).join(),");");B(a,".pop();");break;case "sample.coverage":p="value"in b?b.value:1;b=!!b.invert;a=r(a);C(a,".push(",p,",",b,");");B(a,".pop();");break;case "viewport":case "scissor.box":var p=b.x||0,d=b.y||0,k=-1,e=-1;"w"in b&&(k=b.w);"h"in b&&(e=b.h);b=r(a);
C(b,".push(",p,",",d,",",k,",",e,");");B(b,".pop();")}});Object.keys(b).forEach(function(a){var c=l(z.def(a));a=b[a];a="function"===typeof a&&a._reglType?l(a):Array.isArray(a)?l(a.slice()):+a;C(c,".push(",a,");");B(c,".pop();")});Object.keys(k).forEach(function(a){var b=l(Q.def(a));a=k[a];if("number"===typeof a)C(b,".pushVec(",+a,",0,0,0);");else if(Array.isArray(a))C(b,".pushVec(",[a[0]||0,a[1]||0,a[2]||0,a[3]||0],");");else{var c=w.getBuffer(a),p=0,d=0,f=0,m=0,e=!1,S=5126;c?S=c.dtype:(c=w.getBuffer(a.buffer),
p=a.size||0,d=a.stride||0,f=a.offset||0,m=a.divisor||0,e=a.normalized||!1,S=c.dtype,"type"in a&&(S=q[a.type]));C(b,".pushPtr(",[l(c),p,f,d,m,e,S].join(),");")}B(b,".pop();")});var G=v.block(),J=v.block(),sa,ka;y&&(sa=l(ea),ka=C.def());var ra={};Object.keys(d).sort(a).forEach(function(a){var b=V(d[a]);switch(a){case "framebuffer":a=r("viewport");var p=r("scissor.box");G("if(",S,".push(",b,"&&",b,"._framebuffer)){",a,".setDirty();",p,".setDirty();","}");J("if(",S,".pop()){",a,".setDirty();",p,".setDirty();",
"}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=r(a);G(a,".push(",b,");");J(a,".pop();");break;case "count":case "offset":case "instances":a=I[a];G(a,".push(",b,");");J(a,".pop();");break;case "primitive":a=I.primitive;G(a,".push(",ia,"[",b,"]);");J(a,".pop();");break;case "depth.func":a=r(a);G(a,".push(",la,"[",b,
"]);");J(a,".pop();");break;case "blend.func":a=r(a);p=l(m);G(a,".push(",p,'["srcRGB" in ',b,"?",b,".srcRGB:",b,".src],",p,'["dstRGB" in ',b,"?",b,".dstRGB:",b,".dst],",p,'["srcAlpha" in ',b,"?",b,".srcAlpha:",b,".src],",p,'["dstAlpha" in ',b,"?",b,".dstAlpha:",b,".dst]);");J(a,".pop();");break;case "blend.equation":a=r(a);p=l(t);G("if(typeof ",b,'==="string"){',a,".push(",p,"[",b,"],",p,"[",b,"]);","}else{",a,".push(",p,"[",b,".rgb],",p,"[",b,".alpha]);","}");J(a,".pop();");break;case "blend.color":a=
r(a);G(a,".push(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");J(a,".pop();");break;case "stencil.mask":a=r(a);G(a,".push(",b,");");J(a,".pop();");break;case "stencil.func":a=r(a);G(a,".push(",la,"[",b,".cmp],",b,".ref|0,",'"mask" in ',b,"?",b,".mask:-1);");J(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=r(a);G(a,".push(",qa,"[",b,'.fail||"keep"],',qa,"[",b,'.zfail||"keep"],',qa,"[",b,'.pass||"keep"]);');J(a,".pop();");break;case "polygonOffset.offset":a=r(a);G(a,".push(",b,".factor||0,",
b,".units||0);");J(a,".pop();");break;case "cull.face":a=r(a);G(a,".push(",b,'==="front"?',1028,":",1029,");");J(a,".pop();");break;case "frontFace":a=r(a);G(a,".push(",b,'==="cw"?',2304,":",2305,");");J(a,".pop();");break;case "colorMask":a=r(a);G(a,".push(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");J(a,".pop();");break;case "sample.coverage":a=r(a);G(a,".push(",b,".value,",b,".invert);");J(a,".pop();");break;case "scissor.box":case "viewport":a=r(a);G(a,".push(",b,".x||0,",b,".y||0,",'"w" in ',b,"?",
b,".w:-1,",'"h" in ',b,"?",b,".h:-1);");J(a,".pop();");break;case "elements":a=!("primitive"in d)&&!("primitive"in c);var p=!("count"in d)&&!("count"in c),k=!("offset"in d)&&!("offset"in c),f=G.def();G("if(",b,"){",f,"=",b,"._elements;",ma,".push(",f,");",a?I.primitive+".push("+f+".primType);":"",p?I.count+".push("+f+".vertCount);":"",k?I.offset+".push("+f+".offset);":"","}else{",ma,".push(null);","}");J(ma,".pop();","if(",b,"){",a?I.primitive+".pop();":"",p?I.count+".pop();":"",k?I.offset+".pop();":
"","}")}});Object.keys(e).forEach(function(a){var b=l(z.def(a));a=V(e[a]);G(b,".push(",a,");");J(b,".pop();")});Object.keys(x).forEach(function(a){var b=l(Q.def(a));a=V(x[a]);G(b,".pushDyn(",a,");");J(b,".pop();")});var Z=A("scope"),oa=Z.arg(),ta=Z.arg();Z(C);y&&Z(ka,"=",oa,";",G);Z(ta,"();",y?J:"",B);Z=H();H=Z.def();c.frag&&c.vert?(oa=c.frag,Z(H,"=",l(da.program(f.id(c.vert),f.id(oa))),";")):Z(H,"=",M,".program","(",M,".vert[",M,".vert.length-1]",",",M,".frag[",M,".frag.length-1]",");");oa=A("draw");
oa(C,Z);y&&oa(ka,"=",oa.arg(),";",G);oa(p,"();","if(",H,")",H,".draw(",y?ka:"",");",y?J:"",B);var na=A("batch");na(C,Z);y=l(function(a,b,p){var k=a.batchCache[K];k||(k=a.batchCache[K]=O(a,d,e,x,c));return k(b,p)});na("if(",H,"){",p,"();",y,"(",H,",",na.arg(),",",na.arg(),");");Object.keys(d).forEach(function(a){(a=ga[a])&&na(a,".setDirty();")});na("}",B);return v.compile()}}}},{"./constants/dtypes.json":7,"./constants/primitives.json":8,"./util/codegen":24}],6:[function(e,g,n){g.exports={"[object Int8Array]":5120,
"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],7:[function(e,g,n){g.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],8:[function(e,g,n){g.exports={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},
{}],9:[function(e,g,n){function b(a,b){function e(){var b=window.innerWidth,d=window.innerHeight;a!==document.body&&(d=a.getBoundingClientRect(),b=d.right-d.left,d=d.top-d.bottom);q.width=g*b;q.height=g*d;c(q.style,{width:b+"px",height:d+"px"})}var q=document.createElement("canvas"),m=d(q,b);c(q.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(q);a===document.body&&(q.style.position="absolute",c(a.style,{margin:0,padding:0}));var g=+m.options.pixelRatio;window.addEventListener("resize",
e,!1);var n=m.options.onDestroy;m.options=c(c({},m.options),{onDestroy:function(){window.removeEventListener("resize",e);a.removeChild(q);n&&n()}});e();return m}function d(a,b){function d(b){try{return a.getContext(b,e)}catch(c){return null}}var e=b.glOptions||{};return{gl:d("webgl")||d("experimental-webgl")||d("webgl-experimental"),options:c({pixelRatio:window.devicePixelRatio},b)}}var c=e("./util/extend");g.exports=function(a){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:a[0],
options:a[1]||{}};var e=document.body,h=a[1]||{};if("string"===typeof a[0])e=document.querySelector(a[0])||document.body;else if("object"===typeof a[0])if(a[0]instanceof HTMLElement)e=a[0];else{if(a[0]instanceof WebGLRenderingContext)return{gl:a[0],options:c({pixelRatio:1},h)};h=a[0]}return e.nodeName&&"CANVAS"===e.nodeName.toUpperCase()?d(e,h):b(e,h)}},{"./util/extend":25}],10:[function(e,g,n){g.exports=function(b){return{primitive:[4],count:[0],offset:[0],instances:[0]}}},{}],11:[function(e,g,n){function b(a,
b){this.id=c++;this.func=a;this.data=b}function d(a,c){switch(typeof a){case "boolean":case "number":case "string":return new b(!1,a);case "function":return new b(!0,a);default:return d}}var c=0;g.exports={define:d,isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof b},unbox:function(a,c){return a instanceof b?a:"function"===typeof a&&a!==d?new b(!0,a):new b(!1,c)}}},{}],12:[function(e,g,n){var b=e("./util/is-typed-array"),d=e("./util/is-ndarray"),c=e("./constants/primitives.json");
g.exports=function(a,e,h){function q(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}q.prototype.bind=function(){this.buffer.bind()};return{create:function(a){function g(a){var m=e.oes_element_index_uint;if(a)if("number"===typeof a)r(a);else{var k=null,h="static",q=0;Array.isArray(a)||b(a)||d(a)?k=a:("data"in a&&(k=a.data),"usage"in a&&(h=a.usage),"length"in a&&(q=a.length));Array.isArray(k)||d(k)&&"array"===k.dtype||"type"in a?r({type:a.type||(m?"uint32":"uint16"),usage:h,data:k,length:q}):
r({usage:h,data:k,length:q});if(Array.isArray(k)||b(k))r.dimension=3}else r();m=n.buffer.byteLength;k=0;switch(n.buffer.dtype){case 5121:case 5120:k=5121;break;case 5123:case 5122:k=5123;m>>=1;break;case 5125:case 5124:k=5125,m>>=2}h=4;q=n.buffer.dimension;1===q&&(h=0);2===q&&(h=1);3===q&&(h=4);"object"===typeof a&&("primitive"in a&&(h=c[a.primitive]),"count"in a&&(m=a.vertCount|0));n.primType=h;n.vertCount=m;n.type=k;return g}var n=new q,r=h.create(null,34963,!0);n.buffer=r._buffer;g(a);g._reglType=
"elements";g._elements=n;g.destroy=function(){r.destroy();n.buffer=null};return g},elements:[null],getElements:function(a){return a&&a._elements instanceof q?a._elements:null}}}},{"./constants/primitives.json":8,"./util/is-ndarray":26,"./util/is-typed-array":27}],13:[function(e,g,n){g.exports=function(b){function d(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{c[a]=
b.getExtension(a)}catch(d){}})}var c={};d();return{extensions:c,refresh:d}}},{}],14:[function(e,g,n){var b=e("./util/values"),d=e("./util/extend"),c=[1029];g.exports=function(a,e,h,q,m){function g(a,b,c,d){this.target=a;this.level=b;this.texture=c;this.renderbuffer=d}function n(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function r(a,b){var c=b.width,d=b.height;if(a.texture)var k=a.texture._texture,e=Math.max(1,k.params.width>>a.level),m=Math.max(1,
k.params.height>>a.level),c=c||e,d=d||m;else k=a.renderbuffer._renderbuffer,c=c||k.width,d=d||k.height;k.refCount+=1;b.width=c;b.height=d}function f(b,c){c?c.texture?a.framebufferTexture2D(36160,b,c.target,c.texture._texture.texture,c.level):a.framebufferRenderbuffer(36160,b,36161,c.renderbuffer._renderbuffer.renderbuffer):a.framebufferTexture2D(36160,b,3553,null,0)}function y(a){var b=3553,c=0,d=null,k=null;"object"===typeof a&&("level"in a&&(c=a.level|0),"target"in a&&(b=a.target|0));var e=a._reglType;
"texture"===e?d=a:"renderbuffer"===e&&(k=a,b=36161,c=0);return new g(b,c,d,k)}function k(a){return a&&(a.texture||a.renderbuffer)}function w(){this.id=ea++;ha[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function P(b){a.isFramebuffer(b.framebuffer)||(b.framebuffer=a.createFramebuffer());L=!0;a.bindFramebuffer(36160,b.framebuffer);for(var c=b.colorAttachments,
d=0;d<c.length;++d)f(36064+d,c[d]);for(d=c.length;d<h.maxColorAttachments;++d)f(36064+d,null);f(36096,b.depthAttachment);f(36128,b.stencilAttachment);f(33306,b.depthStencilAttachment);e.webgl_draw_buffers&&e.webgl_draw_buffers.drawBuffersWEBGL(U[c.length]);a.checkFramebufferStatus(36160)}function x(b){b=b.framebuffer;a.isFramebuffer(b)&&a.deleteFramebuffer(b)}function D(){return O[O.length-1]}var K={rgba:6408},z={rgba4:32854,rgb565:36194,"rgb5 a1":32855};e.ext_srgb&&(z.srgba=35907);e.ext_color_buffer_half_float&&
(z.rgba16f=34842,z.rgb16f=34843);e.webgl_color_buffer_float&&(z.rgba32f=34836);var Q=[],da=[];e.webgl_depth_texture&&(Q.push(6402),da.push(34041));d(d({},K),z);b(K);b(z);z=5121;Q={uint8:5121};e.oes_texture_half_float&&(z=Q["half float"]=36193);e.oes_texture_float&&(z=Q["float"]=5126);Q.best=z;var U=function(){for(var a=Array(h.maxDrawbuffers),b=0;b<=h.maxDrawbuffers;++b)for(var c=a[b]=Array(b),d=0;d<b;++d)c[d]=36064+d;return a}(),ea=0,ha={},O=[null],L=!0;return{top:D,dirty:function(){return L},push:function(a){a=
a||null;L=L||a!==D();O.push(a);return L},pop:function(){var a=D();O.pop();return L=L||a!==D()},getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof w)?a:null},poll:function(){if(L){var b=O[O.length-1],d=e.webgl_draw_buffers;b?(a.bindFramebuffer(36160,b.framebuffer),d&&d.drawBuffersWEBGL(U[b.colorAttachments.length])):(a.bindFramebuffer(36160,null),d&&d.drawBuffersWEBGL(c));L=!1}},create:function(b){function c(b){var e,f=b||{},h=b=0;if("shape"in
f){var x=f.shape;b=x[0];h=x[1]}else"radius"in f&&(b=h=f.radius),"width"in f&&(b=f.width),"height"in f&&(h=f.height);var w=null,x=!1;if("colorBuffers"in f||"colorBuffer"in f){w=f.colorBuffers||f.colorBuffer;Array.isArray(w)||(w=[w]);d.width=b;d.height=h;w=w.map(y);for(e=0;e<w.length;++e)r(w[e],d);b=d.width;h=d.height}else{var z=!0,F="rgba",t="uint8",v=1,x=!0;d.width=b=b||a.drawingBufferWidth;d.height=h=h||a.drawingBufferHeight;"format"in f&&(F=f.format,z=F in K);"type"in f&&(t=f.type);"colorCount"in
f&&(v=f.colorCount|0);if(d.ownsColor)for(w=d.colorAttachments;w.length>v;)n(w.pop());else w=[];for(e=0;e<w.length;++e){var l;a:{l=w[e];var D=z,A=F,Q=b,p=h;if(l.texture){var M=l.texture;if(D){M({format:A,type:t,width:Q,height:p});M._texture.refCount+=1;l=!0;break a}}else if(M=l.renderbuffer,!D){M({format:A,width:Q,height:p});M._renderbuffer.refCount+=1;l=!0;break a}n(l);l=!1}l||(w[e--]=w[w.length-1],w.pop())}for(;w.length<v;)z?w.push(new g(3553,0,q.create({format:F,type:t,width:b,height:h},3553),null)):
w.push(new g(36161,0,null,m.create({format:F,width:b,height:h})))}d.width=b;d.height=h;F=z=e=null;t=!1;"depthBuffer"in f&&(e=y(f.depthBuffer));"stencilBuffer"in f&&(z=y(f.stencilBuffer));"depthStencilBuffer"in f&&(F=y(f.depthStencilBuffer));if(e||z||F)r(e||z||F,d);else if(v=!0,D=l=!1,"depth"in f&&(v=!!f.depth),"stencil"in f&&(l=!!f.stencil),"depthTexture"in f&&(D=!!f.depthTexture),f=d.depthAttachment||d.stencilAttachment||d.depthStencilAttachment,A=null,v||l)t=!0,D?(D=l?"depth stencil":"depth",d.ownsDepthStencil&&
f.texture?(f.texture({format:D,width:b,height:h}),f.texture._texture.refCount+=1,A=f):A=new g(3553,0,q.create({format:D,width:b,height:h},3553),null)):(D=v?l?"depth stencil":"depth":"stencil",d.ownsDepthStencil&&f.renderbuffer?(f.renderbuffer({format:D,width:b,height:h}),f.renderbuffer._renderbuffer.refCount+=1,A=f):A=new g(36161,0,null,m.create({format:D,width:b,height:h}))),v?l?F=A:e=A:z=A;b=d;b.colorAttachments.forEach(n);n(b.depthAttachment);n(b.stencilAttachment);n(b.depthStencilAttachment);
d.colorAttachments=w;d.depthAttachment=e;d.stencilAttachment=z;d.depthStencilAttachment=F;d.ownsColor=x;d.ownsDepthStencil=t;c.color=w.map(k);c.depth=k(e);c.stencil=k(z);c.depthStencil=k(F);P(d);c.width=d.width;c.height=d.height;return c}var d=new w;c(b);c._reglType="framebuffer";c._framebuffer=d;c._destroy=function(){x(d)};return c},clear:function(){b(ha).forEach(x)},refresh:function(){b(ha).forEach(P)}}}},{"./util/extend":25,"./util/values":33}],15:[function(e,g,n){g.exports=function(b,d){var c=
1;d.ext_texture_filter_anisotropic&&(c=b.getParameter(34047));var a=1,e=1;d.webgl_draw_buffers&&(a=b.getParameter(34852),e=b.getParameter(36063));return{colorBits:[b.getParameter(3410),b.getParameter(3411),b.getParameter(3412),b.getParameter(3413)],depthBits:b.getParameter(3414),stencilBits:b.getParameter(3415),subpixelBits:b.getParameter(3408),extensions:Object.keys(d).filter(function(a){return!!d[a]}),maxAnisotropic:c,maxDrawbuffers:a,maxColorAttachments:e,pointSizeDims:b.getParameter(33901),lineWidthDims:b.getParameter(33902),
maxViewportDims:b.getParameter(3386),maxCombinedTextureUnits:b.getParameter(35661),maxCubeMapSize:b.getParameter(34076),maxRenderbufferSize:b.getParameter(34024),maxTextureUnits:b.getParameter(34930),maxTextureSize:b.getParameter(3379),maxAttributes:b.getParameter(34921),maxVertexUniforms:b.getParameter(36347),maxVertexTextureUnits:b.getParameter(35660),maxVaryingVectors:b.getParameter(36348),maxFragmentUniforms:b.getParameter(36349),glsl:b.getParameter(35724),renderer:b.getParameter(7937),vendor:b.getParameter(7936),
version:b.getParameter(7938)}}},{}],16:[function(e,g,n){var b=e("./util/is-typed-array");g.exports=function(d,c,a){return function(e){var h=e||{};b(e)?h={data:h}:2===arguments.length?h={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof e&&(h={});c();var q=h.x||0,m=h.y||0,g=h.width||a.width,n=h.height||a.height,h=h.data||new Uint8Array(g*n*4);d.pixelStorei(3333,4);d.readPixels(q,m,g,n,6408,5121,h);return h}}},{"./util/is-typed-array":27}],17:[function(e,g,n){var b=e("./util/values");g.exports=
function(d,c,a){function e(){this.id=g++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function h(a){d.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=d.createRenderbuffer());d.bindRenderbuffer(36161,a.renderbuffer);d.renderbufferStorage(36161,a.format,a.width,a.height)}function q(a){var b=a.renderbuffer;d.bindRenderbuffer(36161,null);d.isRenderbuffer(b)&&d.deleteRenderbuffer(b);a.renderbuffer=null;a.refCount=0;delete n[a.id]}var m={rgba4:32854,rgb565:36194,"rgb5 a1":32855,
depth:33189,stencil:36168,"depth stencil":34041};c.ext_srgb&&(m.srgba=35907);c.ext_color_buffer_half_float&&(m.rgba16f=34842,m.rgb16f=34843);c.webgl_color_buffer_float&&(m.rgba32f=34836);var g=0,n={};e.prototype.decRef=function(){0===--this.refCount&&q(this)};return{create:function(a){function b(a){a=a||{};var d=0,e=0;"shape"in a?(e=a.shape,d=e[0]|0,e=e[1]|0):("radius"in a&&(d=e=a.radius|0),"width"in a&&(d=a.width|0),"height"in a&&(e=a.height|0));b.width=c.width=Math.max(d,1);b.height=c.height=Math.max(e,
1);c.format=32854;"format"in a&&(c.format=m[a.format]);h(c);return b}var c=new e;n[c.id]=c;b(a);b._reglType="renderbuffer";b._renderbuffer=c;b.destroy=function(){c.decRef()};return b},refresh:function(){b(n).forEach(h)},clear:function(){b(n).forEach(q)}}}},{"./util/values":33}],18:[function(e,g,n){function b(b,a,d,e){this.name=b;this.id=a;this.location=d;this.info=e}var d=e("./util/values");g.exports=function(c,a,e,h,q){function m(a,b){var d=35632===a?r:f,e=d[b];if(!e){var k=q.str(b),e=c.createShader(a);
c.shaderSource(e,k);c.compileShader(e);d[b]=e}return e}function g(a,b){this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];this.draw=function(){};this.batchCache={}}function n(d){var k,f;k=m(35632,d.fragId);f=m(35633,d.vertId);var g=d.program=c.createProgram();c.attachShader(g,k);c.attachShader(g,f);c.linkProgram(g);var y=c.getProgramParameter(g,35718),z=d.uniforms=[];for(k=0;k<y;++k)if(f=c.getActiveUniform(g,k))if(1<f.size)for(var r=0;r<f.size;++r){var N=f.name.replace("[0]",
"["+r+"]");e.def(N);z.push(new b(N,q.id(N),c.getUniformLocation(g,N),f))}else e.def(f.name),z.push(new b(f.name,q.id(f.name),c.getUniformLocation(g,f.name),f));y=c.getProgramParameter(g,35721);z=d.attributes=[];for(k=0;k<y;++k)if(f=c.getActiveAttrib(g,k))a.def(f.name),z.push(new b(f.name,q.id(f.name),c.getAttribLocation(g,f.name),f));d.draw=h(d);d.batchCache={}}var r={},f={},y={},k=[];return{clear:function(){var a=c.deleteShader.bind(c);d(r).forEach(a);r={};d(f).forEach(a);f={};k.forEach(function(a){c.deleteProgram(a.program)});
k.length=0;y={}},refresh:function(){r={};f={};k.forEach(n)},program:function(a,b){var c=y[b];c||(c=y[b]={});var d=c[a];d||(d=new g(b,a),n(d),c[a]=d,k.push(d));return d},shader:m,frag:[-1],vert:[-1]}}},{"./util/values":33}],19:[function(e,g,n){var b=e("./util/stack"),d=e("./util/codegen");g.exports=function(c,a,e){function h(a,d){var e=b([!!d],function(b){b?c.enable(a):c.disable(a)});e.flag=a;return e}var g={dither:h(3024),"blend.enable":h(3042),"blend.color":b([0,0,0,0],function(a,b,d,e){c.blendColor(a,
b,d,e)}),"blend.equation":b([32774,32774],function(a,b){c.blendEquationSeparate(a,b)}),"blend.func":b([1,0,1,0],function(a,b,d,e){c.blendFuncSeparate(a,b,d,e)}),"depth.enable":h(2929,!0),"depth.func":b([513],function(a){c.depthFunc(a)}),"depth.range":b([0,1],function(a,b){c.depthRange(a,b)}),"depth.mask":b([!0],function(a){c.depthMask(a)}),"cull.enable":h(2884),"cull.face":b([1029],function(a){c.cullFace(a)}),frontFace:b([2305],function(a){c.frontFace(a)}),colorMask:b([!0,!0,!0,!0],function(a,b,d,
e){c.colorMask(a,b,d,e)}),lineWidth:b([1],function(a){c.lineWidth(a)}),"polygonOffset.enable":h(32823),"polygonOffset.offset":b([0,0],function(a,b){c.polygonOffset(a,b)}),"sample.alpha":h(32926),"sample.enable":h(32928),"sample.coverage":b([1,!1],function(a,b){c.sampleCoverage(a,b)}),"stencil.enable":h(2960),"stencil.mask":b([-1],function(a){c.stencilMask(a)}),"stencil.func":b([519,0,-1],function(a,b,d){c.stencilFunc(a,b,d)}),"stencil.opFront":b([7680,7680,7680],function(a,b,d){c.stencilOpSeparate(1028,
a,b,d)}),"stencil.opBack":b([7680,7680,7680],function(a,b,d){c.stencilOpSeparate(1029,a,b,d)}),"scissor.enable":h(3089),"scissor.box":b([0,0,-1,-1],function(b,d,e,m){var h=e,g=a.top();0>e&&(h=g?g.width-b:c.drawingBufferWidth-b);e=m;0>m&&(e=g?g.height-d:c.drawingBufferHeight-d);c.scissor(b,d,h,e)}),viewport:b([0,0,-1,-1],function(b,d,k,m){var h=k,g=a.top();0>k&&(h=g?g.width-b:c.drawingBufferWidth-b);k=m;0>m&&(k=g?g.height-d:c.drawingBufferHeight-d);c.viewport(b,d,h,k);e.width=h;e.height=k})},m=d(),
n=m.proc("poll"),T=m.proc("refresh");Object.keys(g).forEach(function(a){a=m.link(g[a]);n(a,".poll();");T(a,".setDirty();")});var r=m.compile();return{contextState:g,viewport:e,poll:r.poll,refresh:r.refresh,notifyViewportChanged:function(){g.viewport.setDirty();g["scissor.box"].setDirty()}}}},{"./util/codegen":24,"./util/stack":31}],20:[function(e,g,n){g.exports=function(){var b={"":0},d=[""];return{id:function(c){var a=b[c];if(a)return a;a=b[c]=d.length;d.push(c);return a},str:function(b){return d[b]}}}},
{}],21:[function(e,g,n){function b(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function d(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,d=1;d<b;++d)if(!Array.isArray(a[d])||a[d].length!==c)return!1;return!0}function c(a){return Object.prototype.toString.call(a)}function a(a){return"[object HTMLCanvasElement]"===c(a)}function F(a){return"[object CanvasRenderingContext2D]"===c(a)}var h=e("./util/extend"),q=e("./util/values"),
m=e("./util/is-typed-array"),N=e("./util/is-ndarray"),T=e("./util/load-texture"),r=e("./util/to-half-float"),f=e("./util/parse-dds"),y=[9984,9986,9985,9987];g.exports=function(e,g,n,x,D){function K(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=this.miplevel=0;this.copy=!1;this.crossOrigin=
this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function z(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function Q(a,b){var c,d,e=0,m=0,h=0,f=0,g=0,k=0,l=!1,q=!1,n=!1;for(c=0;c<b.length;++c)d=b[c],f=f||d.width<<d.miplevel,g=g||d.height<<d.miplevel,e=e||d.type,m=m||d.format,h=h||d.internalformat,
k=k||d.channels,l=l||d.needsPoll,q=q||d.needsListeners,d=d.miplevel,n=n||0<d;a.needsPoll=l;a.needsListeners=q;a.width=f;a.height=g;a.format=m;a.internalformat=h;a.type=e;if(3553!==a.target)for(c=0;6>c;++c);c=0<=y.indexOf(a.minFilter);a.genMipmaps=!n&&(a.genMipmaps||c);n=n||a.genMipmaps;a.minFilter||(a.minFilter=n?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(c=0;c<b.length;++c)d=b[c],d.channels||(d.channels=k),d.format||(d.format=m),d.internalformat||(d.internalformat=h),d.type||(d.type=
e)}function da(a){this.id=v++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new z(a);this.pixels=[]}function U(a,b){function c(a,d){var e=d.mipmap,p;if(Array.isArray(e))for(var h=0;h<e.length;++h)p=new K(a),p.parseFlags(b),p.parseFlags(d),p.parse(e[h],h),m.push(p);else p=new K(a),p.parseFlags(b),p.parse(d,0),m.push(p)}var d;O(a);var e=a.params;z.call(e,a.target);var m=a.pixels;m.length=0;e.parse(b);if(3553===a.target)c(3553,
b);else{var h=b.faces||b;if(Array.isArray(h))for(d=0;6>d;++d)c(34069+d,h[d]);else if("string"!==typeof h)for(d=0;6>d;++d)c(34069+d,{})}Q(e,m);e.needsListeners&&ha(a);e.needsPoll&&(a.pollId=H.length,H.push(a));ea(a)}function ea(a){e.isTexture(a.texture)||(a.texture=e.createTexture());var b=a.target,c=a.unit;0<=c?(e.activeTexture(33984+c),V=c):e.bindTexture(b,a.texture);for(var b=a.pixels,d=a.params,m=0;m<b.length;++m)b[m].upload(d);d.upload();0>c&&((c=aa[V])?e.bindTexture(c.target,c.texture):(a.unit=
V,aa[V]=a))}function ha(a){function b(a,c,d){var p=f(d);p.pixels.forEach(function(b){var d=new K(p.cube?b.target:a);d.channels=p.channels;d.compressed=p.compressed;d.type=p.type;d.internalformat=p.format;d.format=X[p.format];d.width=b.width;d.height=b.height;d.miplevel=b.miplevel||c;d.data=b.data;e.push(d)})}function c(){for(var m=0;m<e.length;++m){var h=e[m],f=h.image,g=h.video,k=h.xhr;f&&f.complete?(h.width=f.naturalWidth,h.height=f.naturalHeight):g&&2<g.readyState?(h.width=g.width,h.height=g.height):
k&&4===k.readyState&&(e[m]=e[e.length-1],e.pop(),k.removeEventListener("readystatechange",ea),b(h.target,h.miplevel,k.response))}Q(d,e);ea(a)}var d=a.params,e=a.pixels;e.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){e.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",
c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function O(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((H[b]=H[H.length-1]).id=b,H.pop(),a.pollId=-1)}function L(a){var b=a.texture,c=a.unit,d=a.target;0<=c&&(e.activeTexture(33984+c),V=c,e.bindTexture(d,null),aa[c]=null);O(a);e.isTexture(b)&&e.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete l[a.id]}var t={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
E={repeat:10497,clamp:33071,mirror:33648},ja={nearest:9728,linear:9729},R=h({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ja),fa={none:0,browser:37444},ba={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},W={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ca={};g.ext_srgb&&(W.srgb=35904,W.srgba=35906);g.oes_texture_float&&(ba["float"]=5126);g.oes_texture_half_float&&
(ba["half float"]=36193);g.webgl_depth_texture&&(h(W,{depth:6402,"depth stencil":34041}),h(ba,{uint16:5123,uint32:5125,"depth stencil":34042}));g.webgl_compressed_texture_s3tc&&h(ca,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});g.webgl_compressed_texture_atc&&h(ca,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});g.webgl_compressed_texture_pvrtc&&h(ca,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});g.webgl_compressed_texture_etc1&&(ca["rgb etc1"]=36196);var Y=Array.prototype.slice.call(e.getParameter(34467));Object.keys(ca).forEach(function(a){var b=ca[a];0<=Y.indexOf(b)&&(W[a]=b)});var pa=Object.keys(W);n.textureFormats=pa;var X=pa.reduce(function(a,b){var c=W[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});h(K.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=fa[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=W[b];b in ba&&(this.type=ba[b]);b in ca&&(this.compressed=!0)}"type"in a&&(this.type=ba[a.type]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=
a.width),"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(e,h){this.miplevel=h;this.width>>=h;this.height>>=h;var f=e;switch(typeof e){case "object":if(!e)return;
this.parseFlags(e);var g=e.data;if("string"===typeof g||g&&(m(g)||b(g)||N(g)||a(g)||F(g)||"[object HTMLImageElement]"===c(g)||"[object HTMLVideoElement]"===c(g)||d(g)))f=e.data;break;case "undefined":return}"string"===typeof f&&(f=T(f,this.crossOrigin));var g=null,k=!1;if(null!==f)if(m(f))this.data=f;else if(b(f))g=f,k=!0;else if(N(f)){Array.isArray(f.data)?(g=f.data,k=!0):this.data=f.data;var l=f.shape;this.width=l[0];this.height=l[1];this.channels=3===l.length?l[2]:1;l=f.stride;this.strideX=f.stride[0];
this.strideY=f.stride[1];this.strideC=3===l.length?f.stride[2]:1;this.offset=f.offset;this.needsTranspose=!0}else if(a(f)||F(f))a(f)?this.canvas=f:this.canvas=f.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===c(f))this.image=f,f.complete?(this.width=f.naturalWidth,this.height=f.naturalHeight):(this.width=this.width||f.naturalWidth,this.height=this.height||f.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===c(f))this.video=f,1<f.readyState?(this.width=f.width,this.height=f.height):(this.width=this.width||f.width,this.height=this.height||f.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===c(f))this.xhr=f,this.needsListeners=!0;else if(d(f)){var k=f[0].length,l=f.length,n=1,q,z,v,t;if(Array.isArray(f[0][0]))for(n=f[0][0].length,g=Array(k*l*n),z=t=0;z<l;++z)for(q=0;q<k;++q)for(v=0;v<n;++v)g[t++]=f[z][q][v];
else for(g=Array(k*l),z=t=0;z<l;++z)for(q=0;q<k;++q)g[t++]=f[z][q];this.width=k;this.height=l;this.channels=n;k=!0}else e.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||D.width)|0,this.height=(this.height||D.height)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=[6409,
6410,6407,6408][(this.channels=this.channels||4)-1]);f=this.internalformat;l=this.format=X[f];if(!this.channels)switch(l){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}l=this.type;5126!==l&&36193!==l&&(l||(l=6402===f?5125:5121));this.type=l;if(k)switch(l){case 5121:this.data=new Uint8Array(g);break;case 5123:this.data=new Uint16Array(g);break;case 5125:this.data=new Uint32Array(g);break;case 5126:this.data=
new Float32Array(g);break;case 36193:this.data=r(g)}if(this.data&&this.needsTranspose){g=this.data;f=this.width;k=this.height;l=this.channels;n=this.strideX;q=this.strideY;z=this.strideC;v=this.offset;t=new g.constructor(f*k*l);for(var x=0,w=0;w<k;++w)for(var y=0;y<f;++y)for(var A=0;A<l;++A)t[x++]=g[q*w+n*y+z*A+v];this.data=t}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){e.pixelStorei(37440,
this.flipY);e.pixelStorei(37441,this.premultiplyAlpha);e.pixelStorei(37443,this.colorSpace);e.pixelStorei(3317,this.unpackAlignment);var b=this.target,c=this.miplevel,d=this.image,f=this.canvas,m=this.video,h=this.data,g=this.internalformat,l=this.format,q=this.type,n=this.width||Math.max(1,a.width>>c);a=this.height||Math.max(1,a.height>>c);m&&2<m.readyState?e.texImage2D(b,c,l,l,q,m):d&&d.complete?e.texImage2D(b,c,l,l,q,d):f?e.texImage2D(b,c,l,l,q,f):this.compressed?e.compressedTexImage2D(b,c,g,n,
a,0,h):this.copy?(x(),e.copyTexImage2D(b,c,l,this.x,this.y,n,a,0)):h?e.texImage2D(b,c,l,n,a,0,l,q,h):e.texImage2D(b,c,l,n||1,a||1,0,l,q,null)}});h(z.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=R[a.min]);"mag"in a&&(this.magFilter=ja[a.mag]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var d=a.wrap;"string"===typeof d?b=c=E[d]:Array.isArray(d)&&(b=E[d[0]],c=E[d[1]])}else"wrapS"in a&&(b=E[a.wrapS]),"wrapT"in a&&(c=E[a.wrapT]);this.wrapS=b;this.wrapT=c;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=t[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;e.texParameteri(a,10241,this.minFilter);e.texParameteri(a,10240,this.magFilter);e.texParameteri(a,10242,this.wrapS);e.texParameteri(a,10243,this.wrapT);g.ext_texture_filter_anisotropic&&e.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(e.hint(33170,this.mipmapHint),e.generateMipmap(a))}});
var V=0,v=0,l={},H=[],A=n.maxTextureUnits,aa=Array(A).map(function(){return null});h(da.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<A;++b){var c=aa[b];if(c){if(0<c.bindCount)continue;c.unit=-1}aa[b]=this;a=b;break}this.unit=a;e.activeTexture(33984+a);e.bindTexture(this.target,this.texture);V=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&L(this)}});return{create:function(a,b){function c(a,e,f,m,h,g){var k=a||{};34067===
b&&6===arguments.length&&(k=[a,e,f,m,h,g]);U(d,k);c.width=d.params.width;c.height=d.params.height;return c}var d=new da(b);l[d.id]=d;c(a);c._reglType="texture";c._texture=d;c.destroy=function(){d.decRef()};return c},refresh:function(){q(l).forEach(ea);for(var a=0;a<A;++a)aa[a]=null;V=0;e.activeTexture(33984)},clear:function(){for(var a=0;a<A;++a)e.activeTexture(33984+a),e.bindTexture(3553,null),aa[a]=null;e.activeTexture(33984);V=0;q(l).forEach(L)},poll:function(){H.forEach(ea)},getTexture:function(a){return null}}}},
{"./util/extend":25,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/load-texture":28,"./util/parse-dds":29,"./util/to-half-float":32,"./util/values":33}],22:[function(e,g,n){g.exports=function(b){var d={};return{def:function(c){c=b.id(c);var a=d[c];a||(a=d[c]=[]);return a},uniforms:d}}},{}],23:[function(e,g,n){g.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],24:[function(e,g,n){var b=e("./extend");g.exports=
function(){function d(){var a=[],d=[];return b(function(){a.push.apply(a,Array.prototype.slice.call(arguments))},{def:function(){var b="v"+c++;d.push(b);0<arguments.length&&(a.push(b,"="),a.push.apply(a,Array.prototype.slice.call(arguments)),a.push(";"));return b},toString:function(){return[0<d.length?"var "+d+";":"",a.join("")].join("")}})}var c=0,a=[],e=[],h={};return{link:function(b){var d="g"+c++;a.push(d);e.push(b);return d},block:d,proc:function(a){var e=[],g=d(),n=g.toString;return h[a]=b(g,
{arg:function(){var a="a"+c++;e.push(a);return a},toString:function(){return["function(",e.join(),"){",n(),"}"].join("")}})},compile:function(){var b=['"use strict";return {'];Object.keys(h).forEach(function(a){b.push('"',a,'":',h[a].toString(),",")});b.push("}");return Function.apply(null,a.concat([b.join("")])).apply(null,e)}}}},{"./extend":25}],25:[function(e,g,n){g.exports=function(b,d){for(var c=Object.keys(d),a=0;a<c.length;++a)b[c[a]]=d[c[a]];return b}},{}],26:[function(e,g,n){var b=e("./is-typed-array");
g.exports=function(d){return"object"===typeof d&&Array.isArray(d.shape)&&Array.isArray(d.stride)&&"number"===typeof d.offset&&d.shape.length===d.stride.length&&(Array.isArray(d.data)||b(d.data))}},{"./is-typed-array":27}],27:[function(e,g,n){var b=e("../constants/arraytypes.json");g.exports=function(d){return Object.prototype.toString.call(d)in b}},{"../constants/arraytypes.json":6}],28:[function(e,g,n){g.exports=function(b,d){if("undefined"!==typeof document){var c;c=(c=/\.(\w+)(\?.*)?$/.exec(b))&&
c[1]?c[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(c))return c=document.createElement("video"),c.autoplay=!0,c.loop=!0,d&&(c.crossOrigin=d),c.src=b,c;if(0<=["dds"].indexOf(c))return c=new XMLHttpRequest,c.responseType="arraybuffer",c.open("GET",b,!0),c.send(),c;c=new Image;d&&(c.crossOrigin=d);c.src=b;return c}return null}},{}],29:[function(e,g,n){g.exports=function(e){function g(a){for(var b=t,c=E,d=0;d<W;++d){var f=Math.max(1,
b+3>>2)*Math.max(1,c+3>>2)*fa;Y.pixels.push({target:a,miplevel:d,width:b,height:c,data:new Uint8Array(e,ca,f)});ca+=f;b>>=1;c>>=1}}var n=new Int32Array(e),L=n[x],t=n[K],E=n[D],ja=m,R=0,fa=0,ba=4;switch(n[da]){case f:fa=8;L&r?(ba=3,R=c):R=a;break;case y:fa=16;R=F;break;case k:fa=16;R=h;break;case w:fa=8,R=q}var W=1;n[Q]&N&&(W=Math.max(1,n[z]));var ca=n[P]+4,Y={width:t,height:E,channels:ba,format:R,type:ja,compressed:!0,cube:!1,pixels:[]};if(n[U]&T)for(Y.cube=!0,n=0;6>n;++n)g(d+n);else g(b);return Y};
var b=3553,d=34069,c=33776,a=33777,F=33778,h=33779,q=36196,m=5121,N=131072,T=512,r=64,f=827611204,y=861165636,k=894720068,w=826496069,P=1,x=2,D=3,K=4,z=7,Q=20,da=21,U=28},{}],30:[function(e,g,n){g.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(b){return requestAnimationFrame(b)},cancel:function(b){return cancelAnimationFrame(b)}}:{next:function(b){setTimeout(b,30)},cancel:clearTimeout}},{}],31:[function(e,g,n){g.exports=function(b,d){var c=
b.length,a=b.slice(),e=b.slice(),h=!1,g=!0;return{push:function(){h=!1;for(var b=0;b<c;++b){var d=arguments[b];h=h||d!==e[b];a.push(d)}},pop:function(){h=!1;a.length-=c;for(var b=0;b<c;++b)h=h||a[a.length-c+b]!==e[b]},poll:function(){var b=a.length-c;if(h||g){switch(c){case 1:d(a[b]);break;case 2:d(a[b],a[b+1]);break;case 3:d(a[b],a[b+1],a[b+2]);break;case 4:d(a[b],a[b+1],a[b+2],a[b+3]);break;case 5:d(a[b],a[b+1],a[b+2],a[b+3],a[b+4]);break;case 6:d(a[b],a[b+1],a[b+2],a[b+3],a[b+4],a[b+5]);break;
default:d.apply(null,a.slice(b,a.length))}for(var n=0;n<c;++n)e[n]=a[b+n];g=h=!1}},setDirty:function(){g=!0}}}},{}],32:[function(e,g,n){g.exports=function(b){for(var d=new Float32Array(b),d=new Uint32Array(d.buffer),c=new Uint16Array(b.length),a=0;a<b.length;++a)if(isNaN(b[a]))c[a]=65535;else if(Infinity===b[a])c[a]=31744;else if(-Infinity===b[a])c[a]=64512;else{var e=d[a],h=e>>>31<<15,g=(e<<1>>>24)-127,e=e>>13&1023;c[a]=-24>g?h:-14>g?h+(e+1024>>-14-g):15<g?h+31744:h+(g+15<<10)+e}return c}},{}],33:[function(e,
g,n){g.exports=function(b){return Object.keys(b).map(function(d){return b[d]})}},{}],34:[function(e,g,n){g.exports=function(d,c){function a(a){var b=!1;"altKey"in a&&(b=b||a.altKey!==x.alt,x.alt=!!a.altKey);"shiftKey"in a&&(b=b||a.shiftKey!==x.shift,x.shift=!!a.shiftKey);"ctrlKey"in a&&(b=b||a.ctrlKey!==x.control,x.control=!!a.ctrlKey);"metaKey"in a&&(b=b||a.metaKey!==x.meta,x.meta=!!a.metaKey);return b}function e(d,f){var g=b.x(f),h=b.y(f);"buttons"in f&&(d=f.buttons|0);if(d!==k||g!==w||h!==P||a(f))k=
d|0,w=g||0,P=h||0,c&&c(k,w,P,x)}function g(a){e(0,a)}function n(){if(k||w||P||x.shift||x.alt||x.meta||x.control)k=w=P=0,x.shift=x.alt=x.control=x.meta=!1,c&&c(0,0,0,x)}function m(b){a(b)&&c&&c(k,w,P,x)}function N(a){0===b.buttons(a)?e(0,a):e(k,a)}function T(a){e(k|b.buttons(a),a)}function r(a){e(k&~b.buttons(a),a)}function f(){D||(D=!0,d.addEventListener("mousemove",N),d.addEventListener("mousedown",T),d.addEventListener("mouseup",r),d.addEventListener("mouseleave",g),d.addEventListener("mouseenter",
g),d.addEventListener("mouseout",g),d.addEventListener("mouseover",g),d.addEventListener("blur",n),d.addEventListener("keyup",m),d.addEventListener("keydown",m),d.addEventListener("keypress",m),d!==window&&(window.addEventListener("blur",n),window.addEventListener("keyup",m),window.addEventListener("keydown",m),window.addEventListener("keypress",m)))}function y(){D&&(D=!1,d.removeEventListener("mousemove",N),d.removeEventListener("mousedown",T),d.removeEventListener("mouseup",r),d.removeEventListener("mouseleave",
g),d.removeEventListener("mouseenter",g),d.removeEventListener("mouseout",g),d.removeEventListener("mouseover",g),d.removeEventListener("blur",n),d.removeEventListener("keyup",m),d.removeEventListener("keydown",m),d.removeEventListener("keypress",m),d!==window&&(window.removeEventListener("blur",n),window.removeEventListener("keyup",m),window.removeEventListener("keydown",m),window.removeEventListener("keypress",m)))}c||(c=d,d=window);var k=0,w=0,P=0,x={shift:!1,alt:!1,control:!1,meta:!1},D=!1;f();
var K={element:d};Object.defineProperties(K,{enabled:{get:function(){return D},set:function(a){a?f():y},enumerable:!0},buttons:{get:function(){return k},enumerable:!0},x:{get:function(){return w},enumerable:!0},y:{get:function(){return P},enumerable:!0},mods:{get:function(){return x},enumerable:!0}});return K};var b=e("mouse-event")},{"mouse-event":35}],35:[function(e,g,n){function b(b){return b.target||b.srcElement||window}n.buttons=function(b){if("object"===typeof b){if("buttons"in b)return b.buttons;
if("which"in b){b=b.which;if(2===b)return 4;if(3===b)return 2;if(0<b)return 1<<b-1}else if("button"in b){b=b.button;if(1===b)return 4;if(2===b)return 2;if(0<=b)return 1<<b}}return 0};n.element=b;n.x=function(d){if("object"===typeof d){if("offsetX"in d)return d.offsetX;var c=b(d).getBoundingClientRect();return d.clientX-c.left}return 0};n.y=function(d){if("object"===typeof d){if("offsetY"in d)return d.offsetY;var c=b(d).getBoundingClientRect();return d.clientY-c.top}return 0}},{}],36:[function(e,g,
n){var b=e("./lib/util/extend"),d=e("./lib/context"),c=e("./lib/strings"),a=e("./lib/extension"),F=e("./lib/limits"),h=e("./lib/buffer"),q=e("./lib/elements"),m=e("./lib/texture"),N=e("./lib/renderbuffer"),T=e("./lib/framebuffer"),r=e("./lib/uniform"),f=e("./lib/attribute"),y=e("./lib/shader"),k=e("./lib/draw"),w=e("./lib/state"),P=e("./lib/compile"),x=e("./lib/read"),D=e("./lib/dynamic"),K=e("./lib/util/raf"),z=e("./lib/util/clock");g.exports=function(){function e(){I=K.next(e);A.count+=1;if(A.width!==
t.drawingBufferWidth||A.height!==t.drawingBufferHeight)A.width=t.drawingBufferWidth,A.height=t.drawingBufferHeight,aa.notifyViewportChanged();var a=z();A.dt=a-A.t;A.t=a;v.poll();for(var b=0;b<S.length;++b)(0,S[b])(A.count,A.t,A.dt);A.renderTime=z()-a}function g(){I&&(K.cancel(e),I=0)}function n(a){g();a.preventDefault();if(E.onContextLost)E.onContextLost()}function ea(a){t.getError();ja.refresh();W.refresh();v.refresh();l.refresh();H.refresh();X.refresh();aa.refresh();if(E.onContextRestored)E.onContextRestored();
e()}function ha(a){function c(a){var b={},e={};Object.keys(a).forEach(function(c){var f=a[c];D.isDynamic(f)?(d=!0,e[c]=D.unbox(f,c)):b[c]=f});return{dynamic:e,"static":b}}var d=!1,e=c(a.uniforms||{}),f=c(a.attributes||{});a=c(function(a){function c(a){if(a in d){var b=d[a];delete d[a];Object.keys(b).forEach(function(c){d[a+"."+c]=b[c]})}}var d=b({},a);delete d.uniforms;delete d.attributes;c("blend");c("depth");c("cull");c("stencil");c("polygonOffset");c("scissor");c("sample");return d}(a));var e=
p.command(a["static"],e["static"],f["static"],a.dynamic,e.dynamic,f.dynamic,d),g=e.draw,h=e.batch,k=e.scope,l=[];return function(a,b){if("function"===typeof a)return k(null,a);if("function"===typeof b)return k(a,b);if("number"===typeof a){for(var c=a|0;l.length<c;)l.push(null);return h(a|0,l)}return Array.isArray(a)?h(a.length,a):g(a)}}function O(){H.poll();aa.poll()}var L=d(Array.prototype.slice.call(arguments)),t=L.gl,E=L.options,L=c(),ja=a(t),R=ja.extensions,fa={width:t.drawingBufferWidth,height:t.drawingBufferHeight},
ba=F(t,R),W=h(t),ca=q(t,R,W),Y=r(L),pa=f(t,R,ba,W,L),X=y(t,pa,Y,function(a){return p.draw(a)},L),V=k(t,R,W),v=m(t,R,ba,O,fa),l=N(t,R,ba),H=T(t,R,ba,v,l),A={count:0,start:z(),dt:0,t:z(),renderTime:0,width:t.drawingBufferWidth,height:t.drawingBufferHeight,pixelRatio:E.pixelRatio},aa=w(t,H,fa),fa=x(t,O,fa),p=P(t,L,R,ba,W,ca,v,H,aa,Y,pa,X,V,A,O),M=t.canvas,S=[],I=0;M&&(M.addEventListener("webglcontextlost",n,!1),M.addEventListener("webglcontextrestored",ea,!1));return b(ha,{clear:function(a){var b=0;
O();var c=a.color;c&&(t.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(t.clearDepth(+a.depth),b|=256);"stencil"in a&&(t.clearStencil(a.stencil|0),b|=1024);t.clear(b)},prop:D.define,draw:ha({}),elements:function(a){return ca.create(a)},buffer:function(a){return W.create(a,34962)},texture:function(a){return v.create(a,3553)},cube:function(a){return 6===arguments.length?v.create(Array.prototype.slice.call(arguments),34067):v.create(a,34067)},renderbuffer:function(a){return l.create(a)},
framebuffer:function(a){return H.create(a)},framebufferCube:function(a){},frame:function(a){S.push(a);!I&&0<S.length&&e();return{cancel:function(){var b=S.find(function(b){return b===a});0>b||(S.splice(b,1),0>=S.length&&g())}}},stats:A,limits:ba,read:fa,destroy:function(){g();M&&(M.removeEventListener("webglcontextlost",n),M.removeEventListener("webglcontextrestored",ea));X.clear();H.clear();l.clear();v.clear();W.clear();if(E.onDestroy)E.onDestroy()}})}},{"./lib/attribute":3,"./lib/buffer":4,"./lib/compile":5,
"./lib/context":9,"./lib/draw":10,"./lib/dynamic":11,"./lib/elements":12,"./lib/extension":13,"./lib/framebuffer":14,"./lib/limits":15,"./lib/read":16,"./lib/renderbuffer":17,"./lib/shader":18,"./lib/state":19,"./lib/strings":20,"./lib/texture":21,"./lib/uniform":22,"./lib/util/clock":23,"./lib/util/extend":25,"./lib/util/raf":30}]},{},[2]);

        </script>
        </body>
      </html>