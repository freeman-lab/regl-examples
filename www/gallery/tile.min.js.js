(function e$$0(p,v,g){function b(f,d){if(!v[f]){if(!p[f]){var c="function"==typeof require&&require;if(!d&&c)return c(f,!0);if(r)return r(f,!0);c=Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}c=v[f]={exports:{}};p[f][0].call(c.exports,function(d){var c=p[f][1][d];return b(c?c:d)},c,c.exports,e$$0,p,v,g)}return v[f].exports}for(var r="function"==typeof require&&require,x=0;x<g.length;x++)b(g[x]);return b})({1:[function(h,p,v){var g=h("../regl")(),b=h("mouse-change")();h("resl")({manifest:{map:{type:"text",
src:"assets/map.json",parser:JSON.parse},tiles:{type:"image",src:"assets/tiles.png",parser:g.texture}},onDone:function(r){var x=r.map,f=g({frag:"\n      precision mediump float;\n      uniform sampler2D map, tiles;\n      uniform vec2 mapSize, tileSize;\n      varying vec2 uv;\n      void main() {\n        vec2 tileCoord = floor(255.0 * texture2D(map, floor(uv) / mapSize).ra);\n        gl_FragColor = texture2D(tiles, (tileCoord + fract(uv)) / tileSize);\n      }",vert:"\n      precision mediump float;\n      attribute vec2 position;\n      uniform vec4 view;\n      varying vec2 uv;\n      void main() {\n        uv = mix(view.xw, view.zy, 0.5 * (1.0 + position));\n        gl_Position = vec4(position, 1, 1);\n      }",
depth:{enable:!1},uniforms:{tiles:r.tiles,tileSize:[16,16],map:g.texture(x),mapSize:[x[0].length,x.length],view:g.prop("view")},attributes:{position:[-1,-1,1,-1,-1,1,1,1,-1,1,1,-1]},count:6});g.frame(function(d){var c=d.viewportWidth,g=d.viewportHeight;d=x[0].length*b.x/c;var r=x.length*b.y/g,c=c/g*10;f({view:[d-.5*c,r-5,d+.5*c,r+5]})})}})},{"../regl":36,"mouse-change":33,resl:35}],2:[function(h,p,v){function g(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=
!1;this.type=5126;this.divisor=this.stride=this.offset=0}p.exports=function(b,r,x,f,d){b=x.maxAttributes;r=Array(b);for(x=0;x<b;++x)r[x]=new g;return{Record:g,scope:{},state:r}}},{}],3:[function(h,p,v){function g(b){return W[Object.prototype.toString.call(b)]|0}function b(b,d){for(var f=0;f<d.length;++f)b[f]=d[f]}function r(b,d,f,c,g,r,t){for(var k=0,a=0;a<f;++a)for(var x=0;x<c;++x)b[k++]=d[g*a+r*x+t]}function x(b,d,f){for(var c=0,g=0;g<d.length;++g)for(var r=d[g],t=0;t<f;++t)b[c++]=r[t]}var f=h("./util/is-typed-array"),
d=h("./util/is-ndarray"),c=h("./util/values"),t=h("./util/pool"),W=h("./constants/arraytypes.json"),E=h("./constants/dtypes.json"),A=h("./constants/usage.json"),u=[];u[5120]=1;u[5122]=2;u[5124]=4;u[5121]=1;u[5123]=2;u[5125]=4;u[5126]=4;p.exports=function(h,B,y){function e(a){this.id=k++;this.buffer=h.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;y.profile&&(this.stats={size:0})}function n(a,b,d){a.byteLength=b.byteLength;h.bufferData(a.type,b,d)}function H(a,
c,k,e,h){a.usage=k;if(Array.isArray(c))a.dtype=e||5126,0<c.length&&(Array.isArray(c[0])?(a.dimension=c[0].length,e=t.allocType(a.dtype,c.length*a.dimension),x(e,c,a.dimension),n(a,e,k),t.freeType(e)):"number"===typeof c[0]?(a.dimension=h,e=t.allocType(a.dtype,c.length),b(e,c),n(a,e,k),t.freeType(e)):f(c[0])&&(a.dimension=c[0].length,a.dtype=e||g(c[0])||5126,e=t.allocType(a.dtype,c.length*a.dimension),x(e,c,a.dimension),n(a,e,k),t.freeType(e)));else if(f(c))a.dtype=e||g(c),a.dimension=h,n(a,c,k);else if(d(c)){var u=
c.shape,y=c.stride;h=c.offset;var w=0,L=0,A=0,F=0;1===u.length?(w=u[0],L=1,A=y[0],F=0):2===u.length&&(w=u[0],L=u[1],A=y[0],F=y[1]);a.dtype=e||g(c.data)||5126;a.dimension=L;e=t.allocType(a.dtype,w*L);r(e,c.data,w,L,A,F,h);n(a,e,k);t.freeType(e)}}function p(b){B.bufferCount--;h.deleteBuffer(b.buffer);b.buffer=null;delete a[b.id]}var k=0,a={};e.prototype.bind=function(){h.bindBuffer(this.type,this.buffer)};e.prototype.destroy=function(){p(this)};var L=[];y.profile&&(B.getTotalBufferSize=function(){var b=
0;Object.keys(a).forEach(function(c){b+=a[c].stats.size});return b});return{create:function(c,k,n){function L(a){var b=35044,c=null,k=0,g=0,e=1;Array.isArray(a)||f(a)||d(a)?c=a:"number"===typeof a?k=a|0:a&&("data"in a&&(c=a.data),"usage"in a&&(b=A[a.usage]),"type"in a&&(g=E[a.type]),"dimension"in a&&(e=a.dimension|0),"length"in a&&(k=a.length|0));C.bind();c?H(C,c,b,g,e):(h.bufferData(C.type,k,b),C.dtype=g||5121,C.usage=b,C.dimension=e,C.byteLength=k);y.profile&&(C.stats.size=C.byteLength*u[C.dtype]);
return L}B.bufferCount++;var C=new e(k);a[C.id]=C;n||L(c);L._reglType="buffer";L._buffer=C;L.subdata=function(a,c){var k=(c||0)|0;C.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var e=t.allocType(C.dtype,a.length);b(e,a);h.bufferSubData(C.type,k,e);t.freeType(e)}else if(Array.isArray(a[0])||f(a[0])){var e=a[0].length,n=t.allocType(C.dtype,a.length*e);x(n,a,e);h.bufferSubData(C.type,k,n);t.freeType(n)}}else if(f(a))h.bufferSubData(C.type,k,a);else if(d(a)){var F=a.shape,u=a.stride,
y=n=e=0,A=0;1===F.length?(e=F[0],n=1,y=u[0],A=0):2===F.length&&(e=F[0],n=F[1],y=u[0],A=u[1]);F=Array.isArray(a.data)?C.dtype:g(a.data);F=t.allocType(F,e*n);r(F,a.data,e,n,y,A,a.offset);h.bufferSubData(C.type,k,F);t.freeType(F)}return L};y.profile&&(L.stats=C.stats);L.destroy=function(){p(C)};return L},createStream:function(a,b){var c=L.pop();c||(c=new e(a));c.bind();H(c,b,35040,0,1);return c},destroyStream:function(a){L.push(a)},clear:function(){c(a).forEach(p);L.forEach(p)},getBuffer:function(a){return a&&
a._buffer instanceof e?a._buffer:null},_initBuffer:H}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],4:[function(h,p,v){p.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,
"[object ArrayBuffer]":5121}},{}],5:[function(h,p,v){p.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(h,p,v){p.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(h,p,v){p.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(h,p,v){function g(b){return Array.isArray(b)||W(b)||E(b)}function b(b){return b.sort(function(a,
b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function r(b,a,c,d){this.thisDep=b;this.contextDep=a;this.propDep=c;this.append=d}function x(b){return b&&!(b.thisDep||b.contextDep||b.propDep)}function f(b){return new r(!1,!1,!1,b)}function d(b,a){var c=b.type;return 0===c?(c=b.data.length,new r(!0,1<=c,2<=c,a)):new r(3===c,2===c,1===c,a)}var c=h("./util/codegen"),t=h("./util/loop"),W=h("./util/is-typed-array"),E=h("./util/is-ndarray"),A=h("./util/is-array-like"),u=h("./constants/primitives.json"),
I=h("./constants/dtypes.json"),B=["x","y","z","w"],y={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},e={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,
"!=":517,"!==":517,gequal:518,">=":518,always:519},n={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},H={cw:2304,ccw:2305},N=new r(!1,!1,!1,function(){});p.exports=function(k,a,h,p,E,W,v,C,fa,G,w,U,va,F,X){function Z(a){return a.replace(".","_")}function R(a,D,b){var c=Z(a);J.push(a);l[c]=aa[c]=!!b;z[c]=D}function O(a,D,b){var c=Z(a);J.push(a);Array.isArray(b)?(aa[c]=b.slice(),l[c]=b.slice()):aa[c]=l[c]=b;pa[c]=D}function P(){var m=
c(),D=m.link,b=m.global;m.id=La++;m.batchId="0";var l=D(Ka),d=m.shared={props:"a0"};Object.keys(Ka).forEach(function(a){d[a]=b.def(l,".",a)});var K=m.next={},f=m.current={};Object.keys(pa).forEach(function(a){Array.isArray(aa[a])&&(K[a]=b.def(d.next,".",a),f[a]=b.def(d.current,".",a))});var q=m.constants={};Object.keys(Ea).forEach(function(a){q[a]=b.def(JSON.stringify(Ea[a]))});m.invoke=function(a,q){switch(q.type){case 0:var b=["this",d.context,d.props,m.batchId];return a.def(D(q.data),".call(",
b.slice(0,Math.max(q.data.length+1,4)),")");case 1:return a.def(d.props,q.data);case 2:return a.def(d.context,q.data);case 3:return a.def("this",q.data)}};m.attribCache={};var Ia={};m.scopeAttrib=function(q){q=a.id(q);if(q in Ia)return Ia[q];var m=G.scope[q];m||(m=G.scope[q]=new ma);return Ia[q]=D(m)};return m}function S(a){var b=a["static"];a=a.dynamic;var l;if("profile"in b){var c=!!b.profile;l=f(function(a,m){return c});l.enable=c}else if("profile"in a){var ba=a.profile;l=d(ba,function(a,m){return a.invoke(m,
ba)})}return l}function ia(a){var b=a["static"];a=a.dynamic;if("framebuffer"in b){var l=b.framebuffer;return l?(l=C.getFramebuffer(l),f(function(a,m){var b=a.link(l),q=a.shared;m.set(q.framebuffer,".next",b);q=q.context;m.set(q,".framebufferWidth",b+".width");m.set(q,".framebufferHeight",b+".height");return b})):f(function(a,m){var b=a.shared;m.set(b.framebuffer,".next","null");b=b.context;m.set(b,".framebufferWidth",b+".drawingBufferWidth");m.set(b,".framebufferHeight",b+".drawingBufferHeight");
return"null"})}if("framebuffer"in a){var c=a.framebuffer;return d(c,function(a,m){var b=a.invoke(m,c),q=a.shared,D=q.framebuffer,b=m.def(D,".getFramebuffer(",b,")");m.set(D,".next",b);q=q.context;m.set(q,".framebufferWidth",b+"?"+b+".width:"+q+".drawingBufferWidth");m.set(q,".framebufferHeight",b+"?"+b+".height:"+q+".drawingBufferHeight");return b})}return null}function qa(a,b){function l(a){if(a in c){var m=c[a];a=!0;var wa=m.x|0,Q=m.y|0,e,K;"width"in m?e=m.width|0:a=!1;"height"in m?K=m.height|0:
a=!1;return new r(!a&&b&&b.thisDep,!a&&b&&b.contextDep,!a&&b&&b.propDep,function(a,q){var b=a.shared.context,l=e;"width"in m||(l=q.def(b,".","framebufferWidth","-",wa));var D=K;"height"in m||(D=q.def(b,".","framebufferHeight","-",Q));return[wa,Q,l,D]})}if(a in f){var g=f[a];a=d(g,function(a,q){var b=a.invoke(q,g),m=a.shared.context,l=q.def(b,".x|0"),D=q.def(b,".y|0"),c=q.def('"width" in ',b,"?",b,".width|0:","(",m,".","framebufferWidth","-",l,")"),b=q.def('"height" in ',b,"?",b,".height|0:","(",m,
".","framebufferHeight","-",D,")");return[l,D,c,b]});b&&(a.thisDep=a.thisDep||b.thisDep,a.contextDep=a.contextDep||b.contextDep,a.propDep=a.propDep||b.propDep);return a}return b?new r(b.thisDep,b.contextDep,b.propDep,function(a,b){var q=a.shared.context;return[0,0,b.def(q,".","framebufferWidth"),b.def(q,".","framebufferHeight")]}):null}var c=a["static"],f=a.dynamic,K=l("viewport");if(K)var e=K,K=new r(K.thisDep,K.contextDep,K.propDep,function(a,b){var m=e.append(a,b),l=a.shared.context;b.set(l,".viewportWidth",
m[2]);b.set(l,".viewportHeight",m[3]);return m});return{viewport:K,scissor_box:l("scissor.box")}}function xa(b){function l(b){if(b in c){var m=a.id(c[b]);b=f(function(){return m});b.id=m;return b}if(b in e){var D=e[b];return d(D,function(a,b){var m=a.invoke(b,D);return b.def(a.shared.strings,".id(",m,")")})}return null}var c=b["static"],e=b.dynamic,ba=l("frag"),K=l("vert"),g=null;x(ba)&&x(K)?(g=w.program(K.id,ba.id),b=f(function(a,b){return a.link(g)})):b=new r(ba&&ba.thisDep||K&&K.thisDep,ba&&ba.contextDep||
K&&K.contextDep,ba&&ba.propDep||K&&K.propDep,function(a,b){var m=a.shared.shader,l;l=ba?ba.append(a,b):b.def(m,".","frag");var D;D=K?K.append(a,b):b.def(m,".","vert");return b.def(m+".program("+D+","+l+")")});return{frag:ba,vert:K,progVar:b,program:g}}function ja(a){function b(a,m){if(a in l){var D=l[a]|0;return f(function(a,b){m&&(a.OFFSET=D);return D})}if(a in c){var wa=c[a];return d(wa,function(a,b){var l=a.invoke(b,wa);m&&(a.OFFSET=l);return l})}return m&&e?f(function(a,b){a.OFFSET="0";return 0}):
null}var l=a["static"],c=a.dynamic,e=function(){if("elements"in l){var a=l.elements;g(a)?a=W.getElements(W.create(a)):a&&(a=W.getElements(a));var b=f(function(b,m){if(a){var q=b.link(a);return b.ELEMENTS=q}return b.ELEMENTS=null});b.value=a;return b}if("elements"in c){var m=c.elements;return d(m,function(a,b){var q=a.shared,l=q.isBufferArgs,q=q.elements,D=a.invoke(b,m),c=b.def("null"),l=b.def(l,"(",D,")"),D=a.cond(l).then(c,"=",q,".createStream(",D,");")["else"](c,"=",q,".getElements(",D,");");b.entry(D);
b.exit(a.cond(l).then(q,".destroyStream(",c,");"));return a.ELEMENTS=c})}return null}(),K=b("offset",!0);return{elements:e,primitive:function(){if("primitive"in l){var a=l.primitive;return f(function(b,m){return u[a]})}if("primitive"in c){var b=c.primitive;return d(b,function(a,m){var l=a.constants.primTypes,D=a.invoke(m,b);return m.def(l,"[",D,"]")})}return e?x(e)?e.value?f(function(a,b){return b.def(a.ELEMENTS,".primType")}):f(function(){return 4}):new r(e.thisDep,e.contextDep,e.propDep,function(a,
b){var m=a.ELEMENTS;return b.def(m,"?",m,".primType:",4)}):null}(),count:function(){if("count"in l){var a=l.count|0;return f(function(){return a})}if("count"in c){var b=c.count;return d(b,function(a,m){return a.invoke(m,b)})}return e?x(e)?e?K?new r(K.thisDep,K.contextDep,K.propDep,function(a,b){return b.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):f(function(a,b){return b.def(a.ELEMENTS,".vertCount")}):f(function(){return-1}):new r(e.thisDep||K.thisDep,e.contextDep||K.contextDep,e.propDep||K.propDep,
function(a,b){var m=a.ELEMENTS;return a.OFFSET?b.def(m,"?",m,".vertCount-",a.OFFSET,":-1"):b.def(m,"?",m,".vertCount:-1")}):null}(),instances:b("instances",!1),offset:K}}function ra(a){var b=a["static"],l=a.dynamic,c={};J.forEach(function(a){function m(q,e){if(a in b){var wa=q(b[a]);c[g]=f(function(){return wa})}else if(a in l){var K=l[a];c[g]=d(K,function(a,b){return e(a,b,a.invoke(b,K))})}}var g=Z(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return m(function(a){return a},
function(a,b,m){return m});case "depth.func":return m(function(a){return e[a]},function(a,b,m){return b.def(a.constants.compareFuncs,"[",m,"]")});case "depth.range":return m(function(a){return a},function(a,b,m){a=b.def("+",m,"[0]");b=b.def("+",m,"[1]");return[a,b]});case "blend.func":return m(function(a){return[y["srcRGB"in a?a.srcRGB:a.src],y["dstRGB"in a?a.dstRGB:a.dst],y["srcAlpha"in a?a.srcAlpha:a.src],y["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,b,m){function l(a,q){var c=b.def('"',a,q,'" in ',
m,"?",m,".",a,q,":",m,".",a);return b.def(D,"[",c,"]")}var D=a.constants.blendFuncs;a=l("src","RGB");var c=l("src","Alpha"),d=l("dst","RGB"),e=l("dst","Alpha");return[a,d,c,e]});case "blend.equation":return m(function(a){if("string"===typeof a)return[na[a],na[a]];if("object"===typeof a)return[na[a.rgb],na[a.alpha]]},function(a,b,m){var l=a.constants.blendEquations,D=b.def(),c=b.def();a=a.cond("typeof ",m,'==="string"');a.then(D,"=",c,"=",l,"[",m,"];");a["else"](D,"=",l,"[",m,".rgb];",c,"=",l,"[",
m,".alpha];");b(a);return[D,c]});case "blend.color":return m(function(a){return t(4,function(b){return+a[b]})},function(a,b,m){return t(4,function(a){return b.def("+",m,"[",a,"]")})});case "stencil.mask":return m(function(a){return a|0},function(a,b,m){return b.def(m,"|0")});case "stencil.func":return m(function(a){return[e[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,b,m){a=b.def('"cmp" in ',m,"?",a.constants.compareFuncs,"[",m,".cmp]",":",7680);var l=b.def(m,".ref|0");b=b.def('"mask" in ',
m,"?",m,".mask|0:-1");return[a,l,b]});case "stencil.opFront":case "stencil.opBack":return m(function(b){return["stencil.opBack"===a?1029:1028,n[b.fail||"keep"],n[b.zfail||"keep"],n[b.pass||"keep"]]},function(b,m,l){function D(a){return m.def('"',a,'" in ',l,"?",c,"[",l,".",a,"]:",7680)}var c=b.constants.stencilOps;return["stencil.opBack"===a?1029:1028,D("fail"),D("zfail"),D("pass")]});case "polygonOffset.offset":return m(function(a){return[a.factor|0,a.units|0]},function(a,b,m){a=b.def(m,".factor|0");
b=b.def(m,".units|0");return[a,b]});case "cull.face":return m(function(a){var b=0;"front"===a?b=1028:"back"===a&&(b=1029);return b},function(a,b,m){return b.def(m,'==="front"?',1028,":",1029)});case "lineWidth":return m(function(a){return a},function(a,b,m){return m});case "frontFace":return m(function(a){return H[a]},function(a,b,m){return b.def(m+'==="cw"?2304:2305')});case "colorMask":return m(function(a){return a.map(function(a){return!!a})},function(a,b,m){return t(4,function(a){return"!!"+m+
"["+a+"]"})});case "sample.coverage":return m(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,b,m){a=b.def('"value" in ',m,"?+",m,".value:1");b=b.def("!!",m,".invert");return[a,b]})}});return c}function ka(a){var b=a["static"],l=a.dynamic,c={};Object.keys(b).forEach(function(a){var m=b[a],l;"number"===typeof m||"boolean"===typeof m?l=f(function(){return m}):"function"!==typeof m||"texture2d"!==m._reglType&&"textureCube"!==m._reglType?A(m)&&(l=f(function(a){return a.global.def("[",
t(m.length,function(a){return m[a]}),"]")})):l=f(function(a){return a.link(m)});l.value=m;c[a]=l});Object.keys(l).forEach(function(a){var b=l[a];c[a]=d(b,function(a,m){return a.invoke(m,b)})});return c}function da(b){var l=b["static"],c=b.dynamic,e={};Object.keys(l).forEach(function(b){var m=l[b],c=a.id(b),q=new ma;if(g(m))q.state=1,q.buffer=E.getBuffer(E.create(m,34962,!1)),q.type=q.buffer.dtype;else{var d=E.getBuffer(m);if(d)q.state=1,q.buffer=d,q.type=d.dtype;else if(m.constant){var Q=m.constant;
q.state=2;"number"===typeof Q?q.x=Q:B.forEach(function(a,b){b<Q.length&&(q[a]=Q[b])})}else{var d=E.getBuffer(m.buffer),n=m.offset|0,k=m.stride|0,z=m.size|0,w=!!m.normalized,J=0;"type"in m&&(J=I[m.type]);m=m.divisor|0;q.buffer=d;q.state=1;q.size=z;q.normalized=w;q.type=J||d.dtype;q.offset=n;q.stride=k;q.divisor=m}}e[b]=f(function(a,b){var m=a.attribCache;if(c in m)return m[c];var l={isStream:!1};Object.keys(q).forEach(function(a){l[a]=q[a]});q.buffer&&(l.buffer=a.link(q.buffer));return m[c]=l})});
Object.keys(c).forEach(function(a){var b=c[a];e[a]=d(b,function(a,m){function l(a){m(f[a],"=",c,".",a,"|0;")}var c=a.invoke(m,b),D=a.shared,d=D.isBufferArgs,e=D.buffer,f={isStream:m.def(!1)},g=new ma;g.state=1;Object.keys(g).forEach(function(a){f[a]=m.def(""+g[a])});var Q=f.buffer,n=f.type;m("if(",d,"(",c,")){",f.isStream,"=true;",Q,"=",e,".createStream(",34962,",",c,");",n,"=",Q,".dtype;","}else{",Q,"=",e,".getBuffer(",c,");","if(",Q,"){",n,"=",Q,".dtype;","}else if(",c,".constant){",f.state,"=",
2,";",B.map(function(a,b){return f[a]+"="+c+".length>="+b+"?"+c+"["+b+"]:0;"}).join(""),"}else{",Q,"=",e,".getBuffer(",c,".buffer);",n,'="type" in ',c,"?",D.glTypes,"[",c,".type]:",Q,".dtype;",f.normalized,"=!!",c,".normalized;");l("size");l("offset");l("stride");l("divisor");m("}}");m.exit("if(",f.isStream,"){",e,".destroyStream(",Q,");","}");return f})});return e}function sa(a){var b=a["static"],l=a.dynamic,c={};Object.keys(b).forEach(function(a){var m=b[a];c[a]=f(function(a,b){return"number"===
typeof m||"boolean"===typeof m?""+m:a.link(m)})});Object.keys(l).forEach(function(a){var b=l[a];c[a]=d(b,function(a,m){return a.invoke(m,b)})});return c}function T(a,b,l){var c=a.shared.context,d=a.scope();Object.keys(l).forEach(function(e){b.save(c,"."+e);d(c,".",e,"=",l[e].append(a,b),";")});b(d)}function M(a,b,l){var c=a.shared,d=c.gl,e=c.framebuffer,f;ta&&(f=b.def(c.extensions,".webgl_draw_buffers"));var q=a.constants,c=q.drawBuffer,q=q.backBuffer;a=l?l.append(a,b):b.def(e,".next");b("if(",e,
".dirty||",a,"!==",e,".cur){","if(",a,"){",d,".bindFramebuffer(",36160,",",a,".framebuffer);");ta&&b(f,".drawBuffersWEBGL(",c,"[",a,".colorAttachments.length]);");b("}else{",d,".bindFramebuffer(",36160,",null);");ta&&b(f,".drawBuffersWEBGL(",q,");");b("}",e,".cur=",a,";",e,".dirty=false;","}")}function ca(a,b,l){var c=a.shared,e=c.gl,d=a.current,f=a.next,q=c.current,g=c.next,n=a.cond(q,".dirty");J.forEach(function(b){b=Z(b);if(!(b in l.state)){var c,D;if(b in f){c=f[b];D=d[b];var k=t(aa[b].length,
function(a){return n.def(c,"[",a,"]")});n(a.cond(k.map(function(a,b){return a+"!=="+D+"["+b+"]"}).join("||")).then(e,".",pa[b],"(",k,");",k.map(function(a,b){return D+"["+b+"]="+a}).join(";"),";"))}else c=n.def(g,".",b),k=a.cond(c,"!==",q,".",b),n(k),b in z?k(a.cond(c).then(e,".enable(",z[b],");")["else"](e,".disable(",z[b],");"),q,".",b,"=",c,";"):k(e,".",pa[b],"(",c,");",q,".",b,"=",c,";")}});0===Object.keys(l.state).length&&n(q,".dirty=false;");b(n)}function Ba(a,l,c,e){var d=a.shared,f=a.current,
g=d.current,q=d.gl;b(Object.keys(c)).forEach(function(b){var d=c[b];if(!e||e(d)){var n=d.append(a,l);if(z[b]){var k=z[b];x(d)?n?l(q,".enable(",k,");"):l(q,".disable(",k,");"):l(a.cond(n).then(q,".enable(",k,");")["else"](q,".disable(",k,");"));l(g,".",b,"=",n,";")}else if(A(n)){var w=f[b];l(q,".",pa[b],"(",n,");",n.map(function(a,b){return w+"["+b+"]="+a}).join(";"),";")}else l(q,".",pa[b],"(",n,");",g,".",b,"=",n,";")}})}function V(a,b){ea&&!a.instancing&&(a.instancing=b.def(a.shared.extensions,
".angle_instanced_arrays"))}function ya(a,b,l,c,e){function d(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function f(a){J=b.def();a(J,"=",d(),";");"string"===typeof e?a(k,".count+=",e,";"):a(k,".count++;");F&&(c?(r=b.def(),a(r,"=",w,".getNumPendingQueries();")):a(w,".beginQuery(",k,");"))}function q(a){a(k,".cpuTime+=",d(),"-",J,";");F&&(c?a(w,".pushScopeStats(",r,",",w,".getNumPendingQueries(),",k,");"):a(w,".endQuery();"))}function g(a){var m=b.def(z,".profile");b(z,
".profile=",a,";");b.exit(z,".profile=",m,";")}var n=a.shared,k=a.stats,z=n.current,w=n.timer;l=l.profile;var J,r;if(l){if(x(l)){l.enable?(f(b),q(b.exit),g("true")):g("false");return}l=l.append(a,b);g(l)}else l=b.def(z,".profile");n=a.block();f(n);b("if(",l,"){",n,"}");a=a.block();q(a);b.exit("if(",l,"){",a,"}")}function za(a,b,l,c,e){function d(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}
function f(l,c,e){function d(){b("if(!",z,".pointer){",n,".enableVertexAttribArray(",k,");",z,".pointer=true;}");var l=e.type,f;f=e.size?b.def(e.size,"||",c):c;b("if(",z,".type!==",l,"||",z,".size!==",f,"||",J.map(function(a){return z+"."+a+"!=="+e[a]}).join("||"),"){",n,".bindBuffer(",34962,",",w,".buffer);",n,".vertexAttribPointer(",[k,f,l,e.normalized,e.stride,e.offset],");",z,".type=",l,";",z,".size=",f,";",J.map(function(a){return z+"."+a+"="+e[a]+";"}).join(""),"}");ea&&(l=e.divisor,b("if(",
z,".divisor!==",l,"){",a.instancing,".vertexAttribDivisorANGLE(",[k,l],");",z,".divisor=",l,";}"))}function g(){b("if(",z,".pointer){",n,".disableVertexAttribArray(",k,");",z,".pointer=false;","}if(",B.map(function(a,b){return z+"."+a+"!=="+Q[b]}).join("||"),"){",n,".vertexAttrib4f(",k,",",Q,");",B.map(function(a,b){return z+"."+a+"="+Q[b]+";"}).join(""),"}")}var n=q.gl,k=b.def(l,".location"),z=b.def(q.attributes,"[",k,"]");l=e.state;var w=e.buffer,Q=[e.x,e.y,e.z,e.w],J=["buffer","normalized","offset",
"stride"];1===l?d():2===l?g():(b("if(",l,"===",1,"){"),d(),b("}else{"),g(),b("}"))}var q=a.shared;c.forEach(function(c){var q=c.name,g=l.attributes[q],n;if(g){if(!e(g))return;n=g.append(a,b)}else{if(!e(N))return;var k=a.scopeAttrib(q);n={};Object.keys(new ma).forEach(function(a){n[a]=b.def(k,".",a)})}f(a.link(c),d(c.info.type),n)})}function Aa(b,l,c,e,d){for(var f=b.shared,g=f.gl,q,n=0;n<e.length;++n){var k=e[n],z=k.name,w=k.info.type,J=c.uniforms[z],k=b.link(k)+".location",r;if(J){if(!d(J))continue;
if(x(J)){z=J.value;if(35678===w||35680===w)w=b.link(z._texture),l(g,".uniform1i(",k,",",w+".bind());"),l.exit(w,".unbind();");else if(35674===w||35675===w||35676===w)z=b.global.def("new Float32Array(["+Array.prototype.slice.call(z)+"])"),J=2,35675===w?J=3:35676===w&&(J=4),l(g,".uniformMatrix",J,"fv(",k,",false,",z,");");else{switch(w){case 5126:q="1f";break;case 35664:q="2f";break;case 35665:q="3f";break;case 35666:q="4f";break;case 35670:q="1i";break;case 5124:q="1i";break;case 35671:q="2i";break;
case 35667:q="2i";break;case 35672:q="3i";break;case 35668:q="3i";break;case 35673:q="4i";break;case 35669:q="4i"}l(g,".uniform",q,"(",k,",",A(z)?Array.prototype.slice.call(z):z,");")}continue}else r=J.append(b,l)}else{if(!d(N))continue;r=l.def(f.uniforms,"[",a.id(z),"]")}z=1;switch(w){case 35678:case 35680:w=l.def(r,"._texture");l(g,".uniform1i(",k,",",w,".bind());");l.exit(w,".unbind();");continue;case 5124:case 35670:q="1i";break;case 35667:case 35671:q="2i";z=2;break;case 35668:case 35672:q="3i";
z=3;break;case 35669:case 35673:q="4i";z=4;break;case 5126:q="1f";break;case 35664:q="2f";z=2;break;case 35665:q="3f";z=3;break;case 35666:q="4f";z=4;break;case 35674:q="Matrix2fv";break;case 35675:q="Matrix3fv";break;case 35676:q="Matrix4fv"}l(g,".uniform",q,"(",k,",");if("M"===q.charAt(0)){var k=Math.pow(w-35674+2,2),F=b.global.def("new Float32Array(",k,")");l("false,(Array.isArray(",r,")||",r," instanceof Float32Array)?",r,":(",t(k,function(a){return F+"["+a+"]="+r+"["+a+"]"}),",",F,")")}else 1<
z?l(t(z,function(a){return r+"["+a+"]"})):l(r);l(");")}}function ga(a,b,l,c){function e(d){var f=k[d];return f?f.contextDep&&c.contextDynamic||f.propDep?f.append(a,l):f.append(a,b):b.def(n,".",d)}function d(){function a(){l(t,".drawElementsInstancedANGLE(",[w,r,h,J+"<<(("+h+"-5121)>>1)",F],");")}function b(){l(t,".drawArraysInstancedANGLE(",[w,J,r,F],");")}z?u?a():(l("if(",z,"){"),a(),l("}else{"),b(),l("}")):b()}function f(){function a(){l(g+".drawElements("+[w,r,h,J+"<<(("+h+"-5121)>>1)"]+");")}
function b(){l(g+".drawArrays("+[w,J,r]+");")}z?u?a():(l("if(",z,"){"),a(),l("}else{"),b(),l("}")):b()}var q=a.shared,g=q.gl,n=q.draw,k=c.draw,z=function(){var e=k.elements,d=b;if(e){if(e.contextDep&&c.contextDynamic||e.propDep)d=l;e=e.append(a,d)}else e=d.def(n,".","elements");e&&d("if("+e+")"+g+".bindBuffer(34963,"+e+".buffer.buffer);");return e}(),w=e("primitive"),J=e("offset"),r=function(){var e=k.count,d=b;if(e){if(e.contextDep&&c.contextDynamic||e.propDep)d=l;e=e.append(a,d)}else e=d.def(n,
".","count");return e}();if("number"===typeof r){if(0===r)return}else l("if(",r,"){"),l.exit("}");var F,t;ea&&(F=e("instances"),t=a.instancing);var h=z+".type",u=k.elements&&x(k.elements);ea&&("number"!==typeof F||0<=F)?"string"===typeof F?(l("if(",F,">0){"),d(),l("}else if(",F,"<0){"),f(),l("}")):d():f()}function ha(a,b,l,c,e){b=P();e=b.proc("body",e);ea&&(b.instancing=e.def(b.shared.extensions,".angle_instanced_arrays"));a(b,e,l,c);return b.compile().body}function la(a,b,l,c){V(a,b);za(a,b,l,c.attributes,
function(){return!0});Aa(a,b,l,c.uniforms,function(){return!0});ga(a,b,b,l)}function Ja(a,b){var l=a.proc("draw",1);V(a,l);T(a,l,b.context);M(a,l,b.framebuffer);ca(a,l,b);Ba(a,l,b.state);ya(a,l,b,!1,!0);var c=b.shader.progVar.append(a,l);l(a.shared.gl,".useProgram(",c,".program);");if(b.shader.program)la(a,l,b,b.shader.program);else{var e=a.global.def("{}"),d=l.def(c,".id"),f=l.def(e,"[",d,"]");l(a.cond(f).then(f,".call(this,a0);")["else"](f,"=",e,"[",d,"]=",a.link(function(l){return ha(la,a,b,l,
1)}),"(",c,");",f,".call(this,a0);"))}0<Object.keys(b.state).length&&l(a.shared.current,".dirty=true;")}function Fa(a,b,l,c){function e(){return!0}a.batchId="a1";V(a,b);za(a,b,l,c.attributes,e);Aa(a,b,l,c.uniforms,e);ga(a,b,b,l)}function Ca(a,b,l,c){function e(a){return a.contextDep&&f||a.propDep}function d(a){return!e(a)}V(a,b);var f=l.contextDep,q=b.def(),g=b.def();a.shared.props=g;a.batchId=q;var k=a.scope(),n=a.scope();b(k.entry,"for(",q,"=0;",q,"<","a1",";++",q,"){",g,"=","a0","[",q,"];",n,"}",
k.exit);l.needsContext&&T(a,n,l.context);l.needsFramebuffer&&M(a,n,l.framebuffer);Ba(a,n,l.state,e);l.profile&&e(l.profile)&&ya(a,n,l,!1,!0);c?(za(a,k,l,c.attributes,d),za(a,n,l,c.attributes,e),Aa(a,k,l,c.uniforms,d),Aa(a,n,l,c.uniforms,e),ga(a,k,n,l)):(b=a.global.def("{}"),c=l.shader.progVar.append(a,n),g=n.def(c,".id"),k=n.def(b,"[",g,"]"),n(a.shared.gl,".useProgram(",c,".program);","if(!",k,"){",k,"=",b,"[",g,"]=",a.link(function(b){return ha(Fa,a,l,b,2)}),"(",c,");}",k,".call(this,a0[",q,"],",
q,");"))}function Ga(a,b){function l(a){return a.contextDep&&e||a.propDep}var c=a.proc("batch",2);a.batchId="0";V(a,c);var e=!1,d=!0;Object.keys(b.context).forEach(function(a){e=e||b.context[a].propDep});e||(T(a,c,b.context),d=!1);var f=b.framebuffer,n=!1;f?(f.propDep?e=n=!0:f.contextDep&&e&&(n=!0),n||M(a,c,f)):M(a,c,null);b.state.viewport&&b.state.viewport.propDep&&(e=!0);ca(a,c,b);Ba(a,c,b.state,function(a){return!l(a)});b.profile&&l(b.profile)||ya(a,c,b,!1,"a1");b.contextDep=e;b.needsContext=d;
b.needsFramebuffer=n;d=b.shader.progVar;if(d.contextDep&&e||d.propDep)Ca(a,c,b,null);else if(d=d.append(a,c),c(a.shared.gl,".useProgram(",d,".program);"),b.shader.program)Ca(a,c,b,b.shader.program);else{var f=a.global.def("{}"),n=c.def(d,".id"),k=c.def(f,"[",n,"]");c(a.cond(k).then(k,".call(this,a0,a1);")["else"](k,"=",f,"[",n,"]=",a.link(function(l){return ha(Ca,a,b,l,2)}),"(",d,");",k,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Ha(l,c){function e(a){var b=
c.shader[a];b&&d.set(f.shader,"."+a,b.append(l,d))}var d=l.proc("scope",3);l.batchId="a2";var f=l.shared,n=f.current;T(l,d,c.context);c.framebuffer&&c.framebuffer.append(l,d);b(Object.keys(c.state)).forEach(function(a){var b=c.state[a].append(l,d);A(b)?b.forEach(function(b,c){d.set(l.next[a],"["+c+"]",b)}):d.set(f.next,"."+a,b)});ya(l,d,c,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(a){var b=c.draw[a];b&&d.set(f.draw,"."+a,""+b.append(l,d))});Object.keys(c.uniforms).forEach(function(b){d.set(f.uniforms,
"["+a.id(b)+"]",c.uniforms[b].append(l,d))});Object.keys(c.attributes).forEach(function(a){var b=c.attributes[a].append(l,d),e=l.scopeAttrib(a);Object.keys(new ma).forEach(function(a){d.set(e,"."+a,b[a])})});e("vert");e("frag");0<Object.keys(c.state).length&&(d(n,".dirty=true;"),d.exit(n,".dirty=true;"));d("a1(",l.shared.context,",a0,",l.batchId,");")}var ma=G.Record,na={add:32774,subtract:32778,"reverse subtract":32779};h.ext_blend_minmax&&(na.min=32775,na.max=32776);var ea=h.angle_instanced_arrays,
ta=h.webgl_draw_buffers,aa={dirty:!0,profile:X.profile},l={},J=[],z={},pa={};R("dither",3024);R("blend.enable",3042);O("blend.color","blendColor",[0,0,0,0]);O("blend.equation","blendEquationSeparate",[32774,32774]);O("blend.func","blendFuncSeparate",[1,0,1,0]);R("depth.enable",2929,!0);O("depth.func","depthFunc",513);O("depth.range","depthRange",[0,1]);O("depth.mask","depthMask",!0);O("colorMask","colorMask",[!0,!0,!0,!0]);R("cull.enable",2884);O("cull.face","cullFace",1029);O("frontFace","frontFace",
2305);O("lineWidth","lineWidth",1);R("polygonOffset.enable",32823);O("polygonOffset.offset","polygonOffset",[0,0]);R("sample.alpha",32926);R("sample.enable",32928);O("sample.coverage","sampleCoverage",[1,!1]);R("stencil.enable",2960);O("stencil.mask","stencilMask",-1);O("stencil.func","stencilFunc",[519,0,-1]);O("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);O("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);R("scissor.enable",3089);O("scissor.box","scissor",[0,0,k.drawingBufferWidth,
k.drawingBufferHeight]);O("viewport","viewport",[0,0,k.drawingBufferWidth,k.drawingBufferHeight]);var Ka={gl:k,context:va,strings:a,next:l,current:aa,draw:U,elements:W,buffer:E,shader:w,attributes:G.state,uniforms:fa,framebuffer:C,extensions:h,timer:F,isBufferArgs:g},Ea={primTypes:u,compareFuncs:e,blendFuncs:y,blendEquations:na,stencilOps:n,glTypes:I,orientationType:H};ta&&(Ea.backBuffer=[1029],Ea.drawBuffer=t(p.maxDrawbuffers,function(a){return 0===a?[0]:t(a,function(a){return 36064+a})}));var La=
0;return{next:l,current:aa,procs:function(){var a=P(),b=a.proc("poll"),l=a.proc("refresh"),c=a.block();b(c);l(c);var e=a.shared,d=e.gl,f=e.next,n=e.current;c(n,".dirty=false;");M(a,b);l(e.framebuffer,".dirty=true;");M(a,l);Object.keys(z).forEach(function(e){var k=z[e],g=c.def(f,".",e),w=a.block();w("if(",g,"){",d,".enable(",k,")}else{",d,".disable(",k,")}",n,".",e,"=",g,";");l(w);b("if(",g,"!==",n,".",e,"){",w,"}")});Object.keys(pa).forEach(function(e){var k=pa[e],g=aa[e],z,w,J=a.block();J(d,".",
k,"(");A(g)?(k=g.length,z=a.global.def(f,".",e),w=a.global.def(n,".",e),J(t(k,function(a){return z+"["+a+"]"}),");",t(k,function(a){return w+"["+a+"]="+z+"["+a+"];"}).join("")),b("if(",t(k,function(a){return z+"["+a+"]!=="+w+"["+a+"]"}).join("||"),"){",J,"}")):(z=c.def(f,".",e),w=c.def(n,".",e),J(z,");",n,".",e,"=",z,";"),b("if(",z,"!==",w,"){",J,"}"));l(J)});return a.compile()}(),compile:function(a,b,l,c,e){var d=P();d.stats=d.link(e);e=ia(a);var f=qa(a,e),n=ja(a),k=ra(a),g=xa(a),z=f.viewport;z&&
(k.viewport=z);z=Z("scissor.box");(f=f[z])&&(k[z]=f);f=0<Object.keys(k).length;e={framebuffer:e,draw:n,shader:g,state:k,dirty:f};e.profile=S(a);e.uniforms=ka(l);e.attributes=da(b);e.context=sa(c);Ja(d,e);Ha(d,e);Ga(d,e);return d.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],9:[function(h,p,v){function g(b,d){this.id=x++;this.type=b;this.data=d}function b(f){if(0===
f.length)return[];var d=f.charAt(0),c=f.charAt(f.length-1);if(1<f.length&&d===c&&('"'===d||"'"===d))return['"'+f.substr(1,f.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(d=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(f))return b(f.substr(0,d.index)).concat(b(d[1])).concat(b(f.substr(d.index+d[0].length)));d=f.split(".");if(1===d.length)return['"'+f.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];f=[];for(c=0;c<d.length;++c)f=f.concat(b(d[c]));return f}function r(f){return"["+b(f).join("][")+
"]"}var x=0;p.exports={define:function(b,d){return new g(b,r(d+""))},isDynamic:function(b){return"function"===typeof b&&!b._reglType||b instanceof g},unbox:function(b,d){return"function"===typeof b?new g(0,b):b},accessor:r}},{}],10:[function(h,p,v){var g=h("./util/is-typed-array"),b=h("./util/is-ndarray"),r=h("./util/values"),x=h("./constants/primitives.json"),f=h("./constants/usage.json");p.exports=function(d,c,h,p){function E(b){this.id=B++;I[this.id]=this;this.buffer=b;this.primType=4;this.type=
this.vertCount=0}function A(e,d,f,k,a,r,u){(r=u)||g(d)&&(!b(d)||g(d.data))||(r=c.oes_element_index_uint?5125:5123);e.buffer.bind();h._initBuffer(e.buffer,d,f,r,3);d=u;if(!u){switch(e.buffer.dtype){case 5121:case 5120:d=5121;break;case 5123:case 5122:d=5123;break;case 5125:case 5124:d=5125}e.buffer.dtype=d}e.type=d;0>a&&(a=e.buffer.byteLength,5123===d?a>>=1:5125===d&&(a>>=2));e.vertCount=a;a=k;0>k&&(a=4,k=e.buffer.dimension,1===k&&(a=0),2===k&&(a=1),3===k&&(a=4));e.primType=a}function u(b){p.elementsCount--;
delete I[b.id];b.buffer.destroy();b.buffer=null}var I={},B=0,y={uint8:5121,uint16:5123};c.oes_element_index_uint&&(y.uint32=5125);E.prototype.bind=function(){this.buffer.bind()};var e=[];return{create:function(c){function e(a){if(a)if("number"===typeof a)r(a),k.primType=4,k.vertCount=a|0,k.type=5121;else{var c=null,n=35044,h=-1,u=-1,t=0,p=0;Array.isArray(a)||g(a)||b(a)?c=a:("data"in a&&(c=a.data),"usage"in a&&(n=f[a.usage]),"primitive"in a&&(h=x[a.primitive]),"count"in a&&(u=a.count|0),"length"in
a&&(t=a.length|0),"type"in a&&(p=y[a.type]));c?A(k,c,n,h,u,t,p):(a=k.buffer,a.bind(),d.bufferData(34963,t,n),a.dtype=p||5121,a.usage=n,a.dimension=3,a.byteLength=t,k.primType=0>h?4:h,k.vertCount=0>u?0:u,k.type=a.dtype)}else r(),k.primType=4,k.vertCount=0,k.type=5121;return e}var r=h.create(null,34963,!0),k=new E(r._buffer);p.elementsCount++;e(c);e._reglType="elements";e._elements=k;e.subdata=function(a,b){r.subdata(a,b);return e};e.destroy=function(){u(k)};return e},createStream:function(b){var c=
e.pop();c||(c=new E(h.create(null,34963,!0)._buffer));A(c,b,35040,-1,-1,0,0);return c},destroyStream:function(b){e.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof E?b._elements:null},clear:function(){r(I).forEach(u)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],11:[function(h,p,v){p.exports=function(g,b){function r(b){b=b.toLowerCase();if(b in h)return!0;var d;try{d=h[b]=g.getExtension(b)}catch(f){}return!!d}
for(var h={},f=0;f<b.extensions.length;++f){var d=b.extensions[f];if(!r(d))return b.onDestroy(),b.onDone('"'+d+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}b.optionalExtensions.forEach(r);return{extensions:h,refresh:function(){b.extensions.forEach(r);b.optionalExtensions.forEach(r)}}}},{}],12:[function(h,p,v){var g=h("./util/values"),b=h("./util/extend"),r=[];r[6408]=4;var x=[];x[5121]=1;x[5126]=4;x[36193]=2;p.exports=function(f,
d,c,h,p,E){function A(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var e=a=0;b?(a=b.width,e=b.height):c&&(a=c.width,e=c.height);this.width=a;this.height=e}function u(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function I(a,b,c){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function B(a,b){b?b.texture?f.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,0):f.framebufferRenderbuffer(36160,
a,36161,b.renderbuffer._renderbuffer.renderbuffer):f.framebufferTexture2D(36160,a,3553,null,0)}function y(a){var b=3553,c=null,e=null,d=a;"object"===typeof a&&(d=a.data,"target"in a&&(b=a.target|0));a=d._reglType;"texture2d"===a?c=d:"textureCube"===a?c=d:"renderbuffer"===a&&(e=d,b=36161);return new A(b,c,e)}function e(a,b,c,e,d){if(c)return a=h.create2D({width:a,height:b,format:e,type:d}),a._texture.refCount=0,new A(3553,a,null);a=p.create({width:a,height:b,format:e});a._renderbuffer.refCount=0;return new A(36161,
null,a)}function n(a){return a&&(a.texture||a.renderbuffer)}function H(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function v(){this.id=fa++;G[this.id]=this;this.framebuffer=f.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function k(a){a.colorAttachments.forEach(u);u(a.depthAttachment);u(a.stencilAttachment);u(a.depthStencilAttachment)}function a(a){f.deleteFramebuffer(a.framebuffer);
a.framebuffer=null;E.framebufferCount--;delete G[a.id]}function L(a){var b;f.bindFramebuffer(36160,a.framebuffer);var e=a.colorAttachments;for(b=0;b<e.length;++b)B(36064+b,e[b]);for(b=e.length;b<c.maxColorAttachments;++b)B(36064+b,null);B(36096,a.depthAttachment);B(36128,a.stencilAttachment);B(33306,a.depthStencilAttachment);f.checkFramebufferStatus(36160);f.bindFramebuffer(36160,Da.next);Da.current=Da.next}function Y(c,f){function g(a,b){var c,f=0,u=0,t=!0,w=!0;c=null;var A=!0,p="rgba",B="uint8",
E=1,C=null,Y=null,W=null,H=!1;if("number"===typeof a)f=a|0,u=b|0||f;else if(a){"shape"in a?(u=a.shape,f=u[0],u=u[1]):("radius"in a&&(f=u=a.radius),"width"in a&&(f=a.width),"height"in a&&(u=a.height));if("color"in a||"colors"in a)c=a.color||a.colors,Array.isArray(c);c||("colorCount"in a&&(E=a.colorCount|0),"colorTexture"in a&&(A=!!a.colorTexture,p="rgba4"),"colorType"in a&&(B=a.colorType,A||("half float"===B?d.ext_color_buffer_half_float&&(p="rgba16f"):"float"===B&&d.webgl_color_buffer_float&&(p="rgba32f"))),
"colorFormat"in a&&(p=a.colorFormat,0<=oa.indexOf(p)?A=!0:0<=ua.indexOf(p)&&(A=!1)));if("depthTexture"in a||"depthStencilTexture"in a)H=!(!a.depthTexture&&!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?t=a.depth:(C=a.depth,w=!1));"stencil"in a&&("boolean"===typeof a.stencil?w=a.stencil:(Y=a.stencil,t=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?t=w=a.depthStencil:(W=a.depthStencil,w=t=!1))}else f=u=1;var v=null,G=null,N=null,V=null;if(Array.isArray(c))v=c.map(y);else if(c)v=
[y(c)];else for(v=Array(E),c=0;c<E;++c)v[c]=e(f,u,A,p,B);f=f||v[0].width;u=u||v[0].height;C?G=y(C):t&&!w&&(G=e(f,u,H,"depth","uint32"));Y?N=y(Y):w&&!t&&(N=e(f,u,!1,"stencil","uint8"));W?V=y(W):!C&&!Y&&w&&t&&(V=e(f,u,H,"depth stencil","depth stencil"));t=null;for(c=0;c<v.length;++c)I(v[c],f,u),v[c]&&v[c].texture&&(w=r[v[c].texture._texture.format]*x[v[c].texture._texture.type],null===t&&(t=w));I(G,f,u);I(N,f,u);I(V,f,u);k(h);h.width=f;h.height=u;h.colorAttachments=v;h.depthAttachment=G;h.stencilAttachment=
N;h.depthStencilAttachment=V;g.color=v.map(n);g.depth=n(G);g.stencil=n(N);g.depthStencil=n(V);g.width=h.width;g.height=h.height;L(h);return g}var h=new v;E.framebufferCount++;g(c,f);return b(g,{resize:function(a,b){var c=a|0,e=b|0||c;if(c===h.width&&e===h.height)return g;for(var d=h.colorAttachments,f=0;f<d.length;++f)H(d[f],c,e);H(h.depthAttachment,c,e);H(h.stencilAttachment,c,e);H(h.depthStencilAttachment,c,e);h.width=g.width=c;h.height=g.height=e;L(h);return g},_reglType:"framebuffer",_framebuffer:h,
destroy:function(){a(h);k(h)}})}var Da={current:null,next:null,dirty:!1},oa=["rgba"],ua=["rgba4","rgb565","rgb5 a1"];d.ext_srgb&&ua.push("srgba");d.ext_color_buffer_half_float&&ua.push("rgba16f","rgb16f");d.webgl_color_buffer_float&&ua.push("rgba32f");var C=["uint8"];d.oes_texture_half_float&&C.push("half float");d.oes_texture_float&&C.push("float");var fa=0,G={};return b(Da,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof v)?a:null},
create:Y,createCube:function(a){function c(a){var d={color:null},f=0,g=null,k="rgba",n="uint8",r=1;if("number"===typeof a)f=a|0;else if(a){"shape"in a?f=a.shape[0]:("radius"in a&&(f=a.radius|0),"width"in a?f=a.width|0:"height"in a&&(f=a.height|0));if("color"in a||"colors"in a)g=a.color||a.colors,Array.isArray(g);g||("colorCount"in a&&(r=a.colorCount|0),"colorType"in a&&(n=a.colorType),"colorFormat"in a&&(k=a.colorFormat));"depth"in a&&(d.depth=a.depth);"stencil"in a&&(d.stencil=a.stencil);"depthStencil"in
a&&(d.depthStencil=a.depthStencil)}else f=1;var u;if(g)if(Array.isArray(g))for(a=0;a<g.length;++a);else u=[g];else for(u=Array(r),g={radius:f,format:k,type:n},a=0;a<r;++a)u[a]=h.createCube(g);d.color=Array(u.length);for(a=0;a<u.length;++a)r=u[a],f=f||r.width,d.color[a]={target:34069,data:u[a]};for(a=0;6>a;++a){for(r=0;r<u.length;++r)d.color[r].target=34069+a;0<a&&(d.depth=e[0].depth,d.stencil=e[0].stencil,d.depthStencil=e[0].depthStencil);if(e[a])e[a](d);else e[a]=Y(d)}return b(c,{width:f,height:f,
color:u})}var e=Array(6);c(a);return b(c,{faces:e,resize:function(a){for(var b=0;6>b;++b)e[b].resize(a);return c},_reglType:"framebufferCube",destroy:function(){e.forEach(function(a){a.destroy()})}})},clear:function(){g(G).forEach(a)}})}},{"./util/extend":23,"./util/values":31}],13:[function(h,p,v){p.exports=function(g,b){var h=1;b.ext_texture_filter_anisotropic&&(h=g.getParameter(34047));var x=1,f=1;b.webgl_draw_buffers&&(x=g.getParameter(34852),f=g.getParameter(36063));return{colorBits:[g.getParameter(3410),
g.getParameter(3411),g.getParameter(3412),g.getParameter(3413)],depthBits:g.getParameter(3414),stencilBits:g.getParameter(3415),subpixelBits:g.getParameter(3408),extensions:Object.keys(b).filter(function(d){return!!b[d]}),maxAnisotropic:h,maxDrawbuffers:x,maxColorAttachments:f,pointSizeDims:g.getParameter(33901),lineWidthDims:g.getParameter(33902),maxViewportDims:g.getParameter(3386),maxCombinedTextureUnits:g.getParameter(35661),maxCubeMapSize:g.getParameter(34076),maxRenderbufferSize:g.getParameter(34024),
maxTextureUnits:g.getParameter(34930),maxTextureSize:g.getParameter(3379),maxAttributes:g.getParameter(34921),maxVertexUniforms:g.getParameter(36347),maxVertexTextureUnits:g.getParameter(35660),maxVaryingVectors:g.getParameter(36348),maxFragmentUniforms:g.getParameter(36349),glsl:g.getParameter(35724),renderer:g.getParameter(7937),vendor:g.getParameter(7936),version:g.getParameter(7938)}}},{}],14:[function(h,p,v){var g=h("./util/is-typed-array");p.exports=function(b,h,x,f,d,c){return function(c){var d;
d=null===h.next?5121:h.next.colorAttachments[0].texture._texture.type;var p=0,A=0,u=f.framebufferWidth,I=f.framebufferHeight,B=null;g(c)?B=c:c&&(p=c.x|0,A=c.y|0,u=(c.width||f.framebufferWidth-p)|0,I=(c.height||f.framebufferHeight-A)|0,B=c.data||null);x();c=u*I*4;B||(5121===d?B=new Uint8Array(c):5126===d&&(B=B||new Float32Array(c)));b.pixelStorei(3333,4);b.readPixels(p,A,u,I,6408,d,B);return B}}},{"./util/is-typed-array":26}],15:[function(h,p,v){var g=h("./util/values"),b=[];b[32854]=2;b[32855]=2;
b[36194]=2;b[33189]=2;b[36168]=1;b[34041]=4;b[35907]=4;b[34836]=16;b[34842]=8;b[34843]=6;p.exports=function(h,x,f,d,c){function t(b){this.id=A++;this.refCount=1;this.renderbuffer=b;this.format=32854;this.height=this.width=0;c.profile&&(this.stats={size:0})}function p(b){var c=b.renderbuffer;h.bindRenderbuffer(36161,null);h.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete u[b.id];d.renderbufferCount--}var E={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};
x.ext_srgb&&(E.srgba=35907);x.ext_color_buffer_half_float&&(E.rgba16f=34842,E.rgb16f=34843);x.webgl_color_buffer_float&&(E.rgba32f=34836);var A=0,u={};t.prototype.decRef=function(){0>=--this.refCount&&p(this)};c.profile&&(d.getTotalRenderbufferSize=function(){var b=0;Object.keys(u).forEach(function(c){b+=u[c].stats.size});return b});return{create:function(f,g){function y(d,f){var g=0,k=0,a=32854;"object"===typeof d&&d?("shape"in d?(k=d.shape,g=k[0]|0,k=k[1]|0):("radius"in d&&(g=k=d.radius|0),"width"in
d&&(g=d.width|0),"height"in d&&(k=d.height|0)),"format"in d&&(a=E[d.format])):"number"===typeof d?(g=d|0,k="number"===typeof f?f|0:g):d||(g=k=1);if(g!==e.width||k!==e.height||a!==e.format)return y.width=e.width=g,y.height=e.height=k,e.format=a,h.bindRenderbuffer(36161,e.renderbuffer),h.renderbufferStorage(36161,a,g,k),c.profile&&(e.stats.size=b[e.format]*e.width*e.height),y}var e=new t(h.createRenderbuffer());u[e.id]=e;d.renderbufferCount++;y(f,g);y.resize=function(d,f){var g=d|0,k=f|0||g;if(g===
e.width&&k===e.height)return y;y.width=e.width=g;y.height=e.height=k;h.bindRenderbuffer(36161,e.renderbuffer);h.renderbufferStorage(36161,e.format,g,k);c.profile&&(e.stats.size=b[e.format]*e.width*e.height);return y};y._reglType="renderbuffer";y._renderbuffer=e;c.profile&&(y.stats=e.stats);y.destroy=function(){e.decRef()};return y},clear:function(){g(u).forEach(p)}}}},{"./util/values":31}],16:[function(h,p,v){var g=h("./util/values");p.exports=function(b,h,x,f){function d(b,c,d,f){this.name=b;this.id=
c;this.location=d;this.info=f}function c(b,c){for(var d=0;d<b.length;++d)if(b[d].id===c.id){b[d].location=c.location;return}b.push(c)}function t(c,e,d){d=35632===c?E:A;var f=d[e];if(!f){var g=h.str(e),f=b.createShader(c);b.shaderSource(f,g);b.compileShader(f);d[e]=f}return f}function p(b,c){this.id=B++;this.fragId=b;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[];f.profile&&(this.stats={uniformsCount:0,attributesCount:0})}var E={},A={},u={},I=[],B=0;f.profile&&(x.getMaxUniformsCount=
function(){var b=0;I.forEach(function(c){c.stats.uniformsCount>b&&(b=c.stats.uniformsCount)});return b},x.getMaxAttributesCount=function(){var b=0;I.forEach(function(c){c.stats.attributesCount>b&&(b=c.stats.attributesCount)});return b});return{clear:function(){var c=b.deleteShader.bind(b);g(E).forEach(c);E={};g(A).forEach(c);A={};I.forEach(function(c){b.deleteProgram(c.program)});I.length=0;u={};x.shaderCount=0},program:function(g,e,n){x.shaderCount++;(n=u[e])||(n=u[e]={});var A=n[g];if(!A){var B=
A=new p(e,g),k,a;k=t(35632,B.fragId);a=t(35633,B.vertId);e=B.program=b.createProgram();b.attachShader(e,k);b.attachShader(e,a);b.linkProgram(e);var L=b.getProgramParameter(e,35718);f.profile&&(B.stats.uniformsCount=L);var E=B.uniforms;for(k=0;k<L;++k)if(a=b.getActiveUniform(e,k))if(1<a.size)for(var v=0;v<a.size;++v){var oa=a.name.replace("[0]","["+v+"]");c(E,new d(oa,h.id(oa),b.getUniformLocation(e,oa),a))}else c(E,new d(a.name,h.id(a.name),b.getUniformLocation(e,a.name),a));L=b.getProgramParameter(e,
35721);f.profile&&(B.stats.attributesCount=L);B=B.attributes;for(k=0;k<L;++k)(a=b.getActiveAttrib(e,k))&&c(B,new d(a.name,h.id(a.name),b.getAttribLocation(e,a.name),a));n[g]=A;I.push(A)}return A},shader:t,frag:null,vert:null}}},{"./util/values":31}],17:[function(h,p,v){p.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(h,p,v){p.exports=function(){var g={"":0},b=[""];return{id:function(h){var x=
g[h];if(x)return x;x=g[h]=b.length;b.push(h);return x},str:function(g){return b[g]}}}},{}],19:[function(h,p,v){function g(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function b(a){return Array.isArray(a)&&0!==a.length&&I(a[0])?!0:!1}function r(a){return Object.prototype.toString.call(a)}function x(a){if(!a)return!1;var c=r(a);return 0<=H.indexOf(c)?!0:g(a)||b(a)||E(a)}function f(a,b){36193===a.type?(a.data=u(b),A.freeType(b)):a.data=b}function d(a,b,c,e,d,f){a="undefined"!==
typeof k[a]?k[a]:n[a]*N[b];f&&(a*=6);if(d){for(e=0;1<=c;)e+=a*c*c,c/=2;return e}return a*c*e}var c=h("./util/extend"),t=h("./util/values"),W=h("./util/is-typed-array"),E=h("./util/is-ndarray"),A=h("./util/pool"),u=h("./util/to-half-float"),I=h("./util/is-array-like");v=h("./constants/arraytypes.json");var B=h("./constants/arraytypes.json"),y=[9984,9986,9985,9987],e=[0,6409,6410,6407,6408],n={};n[6409]=n[6406]=n[6402]=1;n[34041]=n[6410]=2;n[6407]=n[35904]=3;n[6408]=n[35906]=4;var H=Object.keys(v).concat(["[object HTMLCanvasElement]",
"[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),N=[];N[5121]=1;N[5126]=4;N[36193]=2;N[5123]=2;N[5125]=4;var k=[];k[32854]=2;k[32855]=2;k[36194]=2;k[34041]=4;k[33776]=.5;k[33777]=.5;k[33778]=1;k[33779]=1;k[35986]=.5;k[35987]=1;k[34798]=1;k[35840]=.5;k[35841]=.25;k[35842]=.5;k[35843]=.25;k[36196]=.5;p.exports=function(a,k,h,p,v,H,C){function fa(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=
1;this.height=this.width=this.colorSpace=0;this.channels=4}function G(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function w(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=
b.alignment);"colorSpace"in b&&(a.colorSpace=Aa[b.colorSpace]);"type"in b&&(a.type=ga[b.type]);var c=a.width,d=a.height,f=a.channels,g=!1;"shape"in b?(c=b.shape[0],d=b.shape[1],3===b.shape.length&&(f=b.shape[2],g=!0)):("radius"in b&&(c=d=b.radius),"width"in b&&(c=b.width),"height"in b&&(d=b.height),"channels"in b&&(f=b.channels,g=!0));a.width=c|0;a.height=d|0;a.channels=f|0;c=!1;"format"in b&&(c=b.format,d=a.internalformat=ha[c],a.format=Ca[d],c in ga&&!("type"in b)&&(a.type=ga[c]),c in la&&(a.compressed=
!0),c=!0);!g&&c?a.channels=n[a.format]:g&&!c&&a.channels!==e[a.format]&&(a.format=a.internalformat=e[a.channels])}}function U(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function N(){fa.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function F(a,c){var d=null;x(c)?d=c:c&&(w(a,c),"x"in c&&(a.xOffset=c.x|0),"y"in c&&(a.yOffset=c.y|0),x(c.data)&&
(d=c.data));if(c.copy){var k=v.viewportWidth,h=v.viewportHeight;a.width=a.width||k-a.xOffset;a.height=a.height||h-a.yOffset;a.needsCopy=!0}else if(!d)a.width=a.width||1,a.height=a.height||1;else if(W(d))a.data=d,"type"in c||5121!==a.type||(a.type=B[Object.prototype.toString.call(d)]|0);else if(g(d)){k=d;h=a.width*a.height*a.channels;switch(a.type){case 5121:case 5123:case 5125:case 5126:h=A.allocType(a.type,h);h.set(k);a.data=h;break;case 36193:a.data=u(k)}a.alignment=1;a.needsFree=!0}else if(E(d)){k=
d.data;Array.isArray(k)||5121!==a.type||(a.type=B[Object.prototype.toString.call(k)]|0);var h=d.shape,n=d.stride,t,m,p,y;3===h.length?(p=h[2],y=n[2]):y=p=1;t=h[0];m=h[1];h=n[0];n=n[1];a.alignment=1;a.width=t;a.height=m;a.channels=p;a.format=a.internalformat=e[p];a.needsFree=!0;t=y;d=d.offset;p=a.width;y=a.height;m=a.channels;for(var C=A.allocType(36193===a.type?5126:a.type,p*y*m),L=0,G=0;G<y;++G)for(var Y=0;Y<p;++Y)for(var q=0;q<m;++q)C[L++]=k[h*Y+n*G+t*q+d];f(a,C)}else if("[object HTMLCanvasElement]"===
r(d)||"[object CanvasRenderingContext2D]"===r(d))"[object HTMLCanvasElement]"===r(d)?a.element=d:a.element=d.canvas,a.width=a.element.width,a.height=a.element.height;else if("[object HTMLImageElement]"===r(d))a.element=d,a.width=d.naturalWidth,a.height=d.naturalHeight;else if("[object HTMLVideoElement]"===r(d))a.element=d,a.width=d.videoWidth,a.height=d.videoHeight,a.needsPoll=!0;else if(b(d)){k=d[0].length;h=d.length;n=1;if(I(d[0][0])){t=n=d[0][0].length;p=A.allocType(36193===a.type?5126:a.type,
k*h*t);for(m=y=0;m<h;++m)for(C=d[m],L=0;L<k;++L)for(G=C[L],Y=0;Y<t;++Y)p[y++]=G[Y];f(a,p)}else{t=A.allocType(36193===a.type?5126:a.type,k*h);for(y=p=0;y<h;++y)for(m=d[y],C=0;C<k;++C)t[p++]=m[C];f(a,t)}a.alignment=1;a.width=k;a.height=h;a.channels=n;a.format=a.internalformat=e[n];a.needsFree=!0}}function X(b,c,d,e,f){var g=b.element,k=b.data,m=b.internalformat,h=b.format,n=b.type,u=b.width,r=b.height;U(b);g?a.texSubImage2D(c,f,d,e,h,n,g):b.compressed?a.compressedTexSubImage2D(c,f,d,e,m,u,r,k):b.needsCopy?
(p(),a.copyTexSubImage2D(c,f,d,e,b.xOffset,b.yOffset,u,r)):a.texSubImage2D(c,f,d,e,u,r,h,n,k)}function Z(){return Ga.pop()||new N}function R(a){a.needsFree&&A.freeType(a.data);N.call(a);Ga.push(a)}function O(){fa.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function P(a,b,c){var d=a.images[0]=Z();a.mipmask=1;d.width=a.width=b;d.height=a.height=c}function S(a,b){var c=null;if(x(b))c=a.images[0]=Z(),G(c,a),F(c,b),a.mipmask=1;else if(w(a,b),Array.isArray(b.mipmap))for(var d=
b.mipmap,e=0;e<d.length;++e)c=a.images[e]=Z(),G(c,a),c.width>>=e,c.height>>=e,F(c,d[e]),a.mipmask|=1<<e;else c=a.images[0]=Z(),G(c,a),F(c,b),a.mipmask=1;G(a,a.images[0])}function ia(b,c){for(var d=b.images,e=0;e<d.length&&d[e];++e){var f=d[e],g=c,k=e,m=f.element,h=f.data,n=f.internalformat,u=f.format,r=f.type,t=f.width,x=f.height;U(f);m?a.texImage2D(g,k,u,u,r,m):f.compressed?a.compressedTexImage2D(g,k,n,t,x,0,h):f.needsCopy?(p(),a.copyTexImage2D(g,k,u,f.xOffset,f.yOffset,t,x,0)):a.texImage2D(g,k,
u,t,x,0,u,r,h)}}function qa(){var a=Ha.pop()||new O;fa.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function xa(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&R(b[c]),b[c]=null;Ha.push(a)}function ja(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ra(a,b){"min"in b&&(a.minFilter=za[b.min],0<=y.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=ya[b.mag]);var c=a.wrapS,d=a.wrapT;if("wrap"in
b){var e=b.wrap;"string"===typeof e?c=d=V[e]:Array.isArray(e)&&(c=V[e[0]],d=V[e[1]])}else"wrapS"in b&&(c=V[b.wrapS]),"wrapT"in b&&(d=V[b.wrapT]);a.wrapS=c;a.wrapT=d;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=Ba[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function ka(b,c){a.texParameteri(c,10241,b.minFilter);a.texParameteri(c,
10240,b.magFilter);a.texParameteri(c,10242,b.wrapS);a.texParameteri(c,10243,b.wrapT);k.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(c))}function da(){var a=ma.pop()||new ja;ja.call(a);return a}function sa(b){fa.call(this);this.mipmask=0;this.internalformat=6408;this.id=na++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;C.profile&&(this.stats={size:0})}function T(b){a.activeTexture(33984);
a.bindTexture(b.target,b.texture)}function M(){var b=aa[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function ca(b){var c=b.texture,d=b.unit,e=b.target;0<=d&&(a.activeTexture(33984+d),a.bindTexture(e,null),aa[d]=null);a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete ea[b.id];H.textureCount--}var Ba={"don't care":4352,"dont care":4352,nice:4354,fast:4353},V={repeat:10497,clamp:33071,mirror:33648},ya={nearest:9728,linear:9729},za=c({"nearest mipmap nearest":9984,
"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ya),Aa={none:0,browser:37444},ga={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},ha={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},la={};k.ext_srgb&&(ha.srgb=35904,ha.srgba=35906);k.oes_texture_float&&(ga["float"]=5126);k.oes_texture_half_float&&(ga.float16=ga["half float"]=36193);k.webgl_depth_texture&&(c(ha,{depth:6402,"depth stencil":34041}),
c(ga,{uint16:5123,uint32:5125,"depth stencil":34042}));k.webgl_compressed_texture_s3tc&&c(la,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});k.webgl_compressed_texture_atc&&c(la,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});k.webgl_compressed_texture_pvrtc&&c(la,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});k.webgl_compressed_texture_etc1&&(la["rgb etc1"]=
36196);var Ja=Array.prototype.slice.call(a.getParameter(34467));Object.keys(la).forEach(function(a){var b=la[a];0<=Ja.indexOf(b)&&(ha[a]=b)});var Fa=Object.keys(ha);h.textureFormats=Fa;var Ca=Fa.reduce(function(a,b){var c=ha[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),Ga=[],Ha=[],ma=[],na=0,ea={},ta=h.maxTextureUnits,aa=Array(ta).map(function(){return null});c(sa.prototype,{bind:function(){this.bindCount+=
1;var b=this.unit;if(0>b){for(var c=0;c<ta;++c){var d=aa[c];if(d){if(0<d.bindCount)continue;d.unit=-1}aa[c]=this;b=c;break}C.profile&&H.maxTextureUnits<b+1&&(H.maxTextureUnits=b+1);this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&ca(this)}});C.profile&&(H.getTotalTextureSize=function(){var a=0;Object.keys(ea).forEach(function(b){a+=ea[b].stats.size});return a});return{create2D:function(b,
c){function e(a,b){var c=da(),g=qa();"number"===typeof a?"number"===typeof b?P(g,a|0,b|0):P(g,a|0,a|0):a?(ra(c,a),S(g,a)):P(g,1,1);c.genMipmaps&&(g.mipmask=(g.width<<1)-1);f.mipmask=g.mipmask;G(f,g);f.internalformat=g.internalformat;e.width=g.width;e.height=g.height;T(f);ia(g,3553);ka(c,3553);M();ma.push(c);xa(g);C.profile&&(f.stats.size=d(f.internalformat,f.type,g.width,g.height,c.genMipmaps,!1));return e}var f=new sa(3553);ea[f.id]=f;H.textureCount++;e(b,c);e.subimage=function(a,b,c,d){b|=0;c|=
0;d|=0;var g=Z();G(g,f);g.width>>=d;g.height>>=d;g.width-=b;g.height-=c;F(g,a);T(f);X(g,3553,b,c,d);M();R(g);return e};e.resize=function(b,c){var g=b|0,l=c|0||g;if(g===f.width&&l===f.height)return e;e.width=f.width=g;e.height=f.height=l;T(f);for(var k=0;f.mipmask>>k;++k)a.texImage2D(3553,k,f.format,g>>k,l>>k,0,f.format,f.type,null);M();C.profile&&(f.stats.size=d(f.internalformat,f.type,g,l,!1,!1));return e};e._reglType="texture2d";e._texture=f;C.profile&&(e.stats=f.stats);e.destroy=function(){f.decRef()};
return e},createCube:function(b,c,e,f,g,k){function h(a,b,c,e,f,g){var k,l=da();for(k=0;6>k;++k)n[k]=qa();if("number"===typeof a||!a)for(a=a|0||1,k=0;6>k;++k)P(n[k],a,a);else if("object"===typeof a)if(b)S(n[0],a),S(n[1],b),S(n[2],c),S(n[3],e),S(n[4],f),S(n[5],g);else if(ra(l,a),w(m,a),"faces"in a)for(a=a.faces,k=0;6>k;++k)G(n[k],m),S(n[k],a[k]);else for(k=0;6>k;++k)S(n[k],a);G(m,n[0]);m.mipmask=l.genMipmaps?(n[0].width<<1)-1:n[0].mipmask;m.internalformat=n[0].internalformat;h.width=n[0].width;h.height=
n[0].height;T(m);for(k=0;6>k;++k)ia(n[k],34069+k);ka(l,34067);M();C.profile&&(m.stats.size=d(m.internalformat,m.type,h.width,h.height,l.genMipmaps,!0));ma.push(l);for(k=0;6>k;++k)xa(n[k]);return h}var m=new sa(34067);ea[m.id]=m;H.cubeCount++;var n=Array(6);h(b,c,e,f,g,k);h.subimage=function(a,b,c,d,e){c|=0;d|=0;e|=0;var f=Z();G(f,m);f.width>>=e;f.height>>=e;f.width-=c;f.height-=d;F(f,b);T(m);X(f,34069+a,c,d,e);M();R(f);return h};h.resize=function(b){b|=0;if(b!==m.width){h.width=m.width=b;h.height=
m.height=b;T(m);for(var c=0;6>c;++c)for(var e=0;m.mipmask>>e;++e)a.texImage2D(34069+c,c,m.format,b>>c,b>>c,0,m.format,m.type,null);M();C.profile&&(m.stats.size=d(m.internalformat,m.type,h.width,h.height,!1,!0));return h}};h._reglType="textureCube";h._texture=m;C.profile&&(h.stats=m.stats);h.destroy=function(){m.decRef()};return h},clear:function(){for(var b=0;b<ta;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),aa[b]=null;t(ea).forEach(ca);H.cubeCount=0;H.textureCount=0},getTexture:function(a){return null}}}},
{"./constants/arraytypes.json":4,"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/to-half-float":30,"./util/values":31}],20:[function(h,p,v){p.exports=function(g,b){function h(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function p(b,c,d){var f=t.pop()||new h;f.startQueryIndex=b;f.endQueryIndex=c;f.sum=0;f.stats=d;v.push(f)}var f=b.ext_disjoint_timer_query;if(!f)return null;var d=[],c=[],t=[],v=[],E=
[],A=[];return{beginQuery:function(b){var g=d.pop()||f.createQueryEXT();f.beginQueryEXT(35007,g);c.push(g);p(c.length-1,c.length,b)},endQuery:function(){f.endQueryEXT(35007)},pushScopeStats:p,update:function(){var b,g;b=c.length;if(0!==b){A.length=Math.max(A.length,b+1);E.length=Math.max(E.length,b+1);E[0]=0;var h=A[0]=0;for(g=b=0;g<c.length;++g){var r=c[g];f.getQueryObjectEXT(r,34919)?(h+=f.getQueryObjectEXT(r,34918),d.push(r)):c[b++]=r;E[g+1]=h;A[g+1]=b}c.length=b;for(g=b=0;g<v.length;++g){var h=
v[g],e=h.startQueryIndex,r=h.endQueryIndex;h.sum+=E[r]-E[e];e=A[e];r=A[r];r===e?(h.stats.gpuTime+=h.sum/1E6,t.push(h)):(h.startQueryIndex=e,h.endQueryIndex=r,v[b++]=h)}v.length=b}},getNumPendingQueries:function(){return c.length},clear:function(){d.push.apply(d,c);for(var b=0;b<d.length;b++)f.deleteQueryEXT(d[b]);c.length=0;d.length=0}}}},{}],21:[function(h,p,v){p.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(h,
p,v){function g(b){return Array.prototype.slice.call(b)}function b(b){return g(b).join("")}var r=h("./extend");p.exports=function(){function h(){var c=[],f=[];return r(function(){c.push.apply(c,g(arguments))},{def:function(){var b="v"+d++;f.push(b);0<arguments.length&&(c.push(b,"="),c.push.apply(c,g(arguments)),c.push(";"));return b},toString:function(){return b([0<f.length?"var "+f+";":"",b(c)])}})}function f(){function b(e,f){d(e,f,"=",c.def(e,f),";")}var c=h(),d=h(),f=c.toString,t=d.toString;return r(function(){c.apply(c,
g(arguments))},{def:c.def,entry:c,exit:d,save:b,set:function(d,f,g){b(d,f);c(d,f,"=",g,";")},toString:function(){return f()+t()}})}var d=0,c=[],t=[],p=h(),v={};return{global:p,link:function(b){for(var f=0;f<t.length;++f)if(t[f]===b)return c[f];f="g"+d++;c.push(f);t.push(b);return f},block:h,proc:function(c,d){function g(){var b="a"+h.length;h.push(b);return b}var h=[];d=d||0;for(var t=0;t<d;++t)g();var t=f(),e=t.toString;return v[c]=r(t,{arg:g,toString:function(){return b(["function(",h.join(),"){",
e(),"}"])}})},scope:f,cond:function(){var c=b(arguments),d=f(),h=f(),t=d.toString,p=h.toString;return r(d,{then:function(){d.apply(d,g(arguments));return this},"else":function(){h.apply(h,g(arguments));return this},toString:function(){var d=p();d&&(d="else{"+d+"}");return b(["if(",c,"){",t(),"}",d])}})},compile:function(){var d=['"use strict";',p,"return {"];Object.keys(v).forEach(function(b){d.push('"',b,'":',v[b].toString(),",")});d.push("}");var f=b(d).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,
"{\n");return Function.apply(null,c.concat(f)).apply(null,t)}}}},{"./extend":23}],23:[function(h,p,v){p.exports=function(g,b){for(var h=Object.keys(b),p=0;p<h.length;++p)g[h[p]]=b[h[p]];return g}},{}],24:[function(h,p,v){var g=h("./is-typed-array");p.exports=function(b){return Array.isArray(b)||g(b)}},{"./is-typed-array":26}],25:[function(h,p,v){var g=h("./is-typed-array");p.exports=function(b){return!!b&&"object"===typeof b&&Array.isArray(b.shape)&&Array.isArray(b.stride)&&"number"===typeof b.offset&&
b.shape.length===b.stride.length&&(Array.isArray(b.data)||g(b.data))}},{"./is-typed-array":26}],26:[function(h,p,v){var g=h("../constants/arraytypes.json");p.exports=function(b){return Object.prototype.toString.call(b)in g}},{"../constants/arraytypes.json":4}],27:[function(h,p,v){p.exports=function(g,b){for(var h=Array(g),p=0;p<g;++p)h[p]=b(p);return h}},{}],28:[function(h,p,v){function g(b){var d,c;d=(65535<b)<<4;b>>>=d;c=(255<b)<<3;b>>>=c;d|=c;c=(15<b)<<2;b>>>=c;d|=c;c=(3<b)<<1;return d|c|b>>>c>>
1}function b(b){a:{for(var d=16;268435456>=d;d*=16)if(b<=d){b=d;break a}b=0}d=x[g(b)>>2];return 0<d.length?d.pop():new ArrayBuffer(b)}function r(b){x[g(b.byteLength)>>2].push(b)}var x=h("./loop")(8,function(){return[]});p.exports={alloc:b,free:r,allocType:function(f,d){var c=null;switch(f){case 5120:c=new Int8Array(b(d),0,d);break;case 5121:c=new Uint8Array(b(d),0,d);break;case 5122:c=new Int16Array(b(2*d),0,d);break;case 5123:c=new Uint16Array(b(2*d),0,d);break;case 5124:c=new Int32Array(b(4*d),
0,d);break;case 5125:c=new Uint32Array(b(4*d),0,d);break;case 5126:c=new Float32Array(b(4*d),0,d);break;default:return null}return c.length!==d?c.subarray(0,d):c},freeType:function(b){r(b.buffer)}}},{"./loop":27}],29:[function(h,p,v){p.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(g){return requestAnimationFrame(g)},cancel:function(g){return cancelAnimationFrame(g)}}:{next:function(g){return setTimeout(g,16)},cancel:clearTimeout}},{}],30:[function(h,
p,v){var g=h("./pool"),b=new Float32Array(1),r=new Uint32Array(b.buffer);p.exports=function(h){for(var f=g.allocType(5123,h.length),d=0;d<h.length;++d)if(isNaN(h[d]))f[d]=65535;else if(Infinity===h[d])f[d]=31744;else if(-Infinity===h[d])f[d]=64512;else{b[0]=h[d];var c=r[0],p=c>>>31<<15,v=(c<<1>>>24)-127,c=c>>13&1023;f[d]=-24>v?p:-14>v?p+(c+1024>>-14-v):15<v?p+31744:p+(v+15<<10)+c}return f}},{"./pool":28}],31:[function(h,p,v){p.exports=function(g){return Object.keys(g).map(function(b){return g[b]})}},
{}],32:[function(h,p,v){function g(b,c,g){function h(){var c=window.innerWidth,r=window.innerHeight;b!==document.body&&(r=b.getBoundingClientRect(),c=r.right-r.left,r=r.top-r.bottom);p.width=g*c;p.height=g*r;f(p.style,{width:c+"px",height:r+"px"})}var p=document.createElement("canvas");f(p.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(p);b===document.body&&(p.style.position="absolute",f(b.style,{margin:0,padding:0}));window.addEventListener("resize",h,!1);h();return{canvas:p,onDestroy:function(){window.removeEventListener("resize",
h);b.removeChild(p)}}}function b(b,c){function f(g){try{return b.getContext(g,c)}catch(h){return null}}return f("webgl")||f("experimental-webgl")||f("webgl-experimental")}function r(b){return"string"===typeof b?b.split():b}function x(b){return"string"===typeof b?document.querySelector(b):b}var f=h("./util/extend");p.exports=function(d){var c=d||{},f,h,p,v;d={};var u=[],I=[],B="undefined"===typeof window?1:window.devicePixelRatio,y=!1,e=function(b){},n=function(){};"string"===typeof c?f=document.querySelector(c):
"object"===typeof c&&("string"===typeof c.nodeName&&"function"===typeof c.appendChild&&"function"===typeof c.getBoundingClientRect?f=c:"function"===typeof c.drawArrays||"function"===typeof c.drawElements?(v=c,p=v.canvas):("gl"in c?v=c.gl:"canvas"in c?p=x(c.canvas):"container"in c&&(h=x(c.container)),"attributes"in c&&(d=c.attributes),"extensions"in c&&(u=r(c.extensions)),"optionalExtensions"in c&&(I=r(c.optionalExtensions)),"onDone"in c&&(e=c.onDone),"profile"in c&&(y=!!c.profile),"pixelRatio"in c&&
(B=+c.pixelRatio)));f&&("canvas"===f.nodeName.toLowerCase()?p=f:h=f);if(!v){if(!p){f=g(h||document.body,e,B);if(!f)return null;p=f.canvas;n=f.onDestroy}v=b(p,d)}return v?{gl:v,canvas:p,container:h,extensions:u,optionalExtensions:I,pixelRatio:B,profile:y,onDone:e,onDestroy:n}:(n(),e("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/extend":23}],33:[function(h,p,v){p.exports=function(b,h){function p(b){var a=!1;"altKey"in b&&(a=a||b.altKey!==
n.alt,n.alt=!!b.altKey);"shiftKey"in b&&(a=a||b.shiftKey!==n.shift,n.shift=!!b.shiftKey);"ctrlKey"in b&&(a=a||b.ctrlKey!==n.control,n.control=!!b.ctrlKey);"metaKey"in b&&(a=a||b.metaKey!==n.meta,n.meta=!!b.metaKey);return a}function f(b,a){var c=g.x(a),d=g.y(a);"buttons"in a&&(b=a.buttons|0);if(b!==B||c!==y||d!==e||p(a))B=b|0,y=c||0,e=d||0,h&&h(B,y,e,n)}function d(b){f(0,b)}function c(){if(B||y||e||n.shift||n.alt||n.meta||n.control)B=y=e=0,n.shift=n.alt=n.control=n.meta=!1,h&&h(0,0,0,n)}function t(b){p(b)&&
h&&h(B,y,e,n)}function v(b){0===g.buttons(b)?f(0,b):f(B,b)}function E(b){f(B|g.buttons(b),b)}function A(b){f(B&~g.buttons(b),b)}function u(){H||(H=!0,b.addEventListener("mousemove",v),b.addEventListener("mousedown",E),b.addEventListener("mouseup",A),b.addEventListener("mouseleave",d),b.addEventListener("mouseenter",d),b.addEventListener("mouseout",d),b.addEventListener("mouseover",d),b.addEventListener("blur",c),b.addEventListener("keyup",t),b.addEventListener("keydown",t),b.addEventListener("keypress",
t),b!==window&&(window.addEventListener("blur",c),window.addEventListener("keyup",t),window.addEventListener("keydown",t),window.addEventListener("keypress",t)))}function I(){H&&(H=!1,b.removeEventListener("mousemove",v),b.removeEventListener("mousedown",E),b.removeEventListener("mouseup",A),b.removeEventListener("mouseleave",d),b.removeEventListener("mouseenter",d),b.removeEventListener("mouseout",d),b.removeEventListener("mouseover",d),b.removeEventListener("blur",c),b.removeEventListener("keyup",
t),b.removeEventListener("keydown",t),b.removeEventListener("keypress",t),b!==window&&(window.removeEventListener("blur",c),window.removeEventListener("keyup",t),window.removeEventListener("keydown",t),window.removeEventListener("keypress",t)))}h||(h=b,b=window);var B=0,y=0,e=0,n={shift:!1,alt:!1,control:!1,meta:!1},H=!1;u();var N={element:b};Object.defineProperties(N,{enabled:{get:function(){return H},set:function(b){b?u():I},enumerable:!0},buttons:{get:function(){return B},enumerable:!0},x:{get:function(){return y},
enumerable:!0},y:{get:function(){return e},enumerable:!0},mods:{get:function(){return n},enumerable:!0}});return N};var g=h("mouse-event")},{"mouse-event":34}],34:[function(h,p,v){function g(b){return b.target||b.srcElement||window}v.buttons=function(b){if("object"===typeof b){if("buttons"in b)return b.buttons;if("which"in b){b=b.which;if(2===b)return 4;if(3===b)return 2;if(0<b)return 1<<b-1}else if("button"in b){b=b.button;if(1===b)return 4;if(2===b)return 2;if(0<=b)return 1<<b}}return 0};v.element=
g;v.x=function(b){if("object"===typeof b){if("offsetX"in b)return b.offsetX;var h=g(b).getBoundingClientRect();return b.clientX-h.left}return 0};v.y=function(b){if("object"===typeof b){if("offsetY"in b)return b.offsetY;var h=g(b).getBoundingClientRect();return b.clientY-h.top}return 0}},{}],35:[function(h,p,v){function g(b){throw Error("resl: "+b);}function b(b,d,f){Object.keys(b).forEach(function(b){0>d.indexOf(b)&&g('invalid parameter "'+b+'" in '+f)})}function r(b,d){this.state=0;this.ready=!1;
this.progress=0;this.name=b;this.cancel=d}var x=["manifest","onDone","onProgress","onError"],f=["type","src","stream","credentials","parser"],d=["onData","onDone"];p.exports=function(c){function h(a,b){if(a in c){var d=c[a];"function"!==typeof d&&g('invalid callback "'+a+'"');return d}return null}function p(a){function b(){if(!(2>g.readyState||1===k.state||-1===k.state)){if(200!==g.status)return A('error loading resource "'+a.name+'"');if(2<g.readyState&&0===k.state){var d;d="binary"===a.type?g.response:
g.responseText;if(f.data)try{h=f.data(d)}catch(e){return A(e)}else h=d}if(3<g.readyState&&0===k.state){if(f.done)try{h=f.done()}catch(e){return A(e)}k.state=1}n[c]=h;k.progress=.75*k.progress+.25;k.ready=a.stream&&!!h||1===k.state;u()}}var c=a.name,d=a.stream,e="binary"===a.type,f=a.parser,g=new XMLHttpRequest,h=null,k=new r(c,function(){1!==k.state&&-1!==k.state&&(g.onreadystatechange=null,g.abort(),k.state=-1)});g.onreadystatechange=d?b:function(){4===g.readyState&&b()};e&&(g.responseType="arraybuffer");
a.credentials&&(g.withCredentials=!0);g.open("GET",a.src,!0);g.send();return k}function v(a,b){function c(){if(0===p.state)if(k.data)try{t=k.data(b)}catch(a){return A(a)}else t=b}function d(b){c();n[h]=t;p.progress=b.lengthComputable?Math.max(p.progress,b.loaded/b.total):.75*p.progress+.25;p.ready=a.stream;u(h)}function e(){c();if(0===p.state){if(k.done)try{t=k.done()}catch(a){return A(a)}p.state=1}p.progress=1;p.ready=!0;n[h]=t;g();u("finish "+h)}function f(){A('error loading asset "'+h+'"')}function g(){a.stream&&
b.removeEventListener("progress",d);"image"===a.type?b.addEventListener("load",e):b.addEventListener("canplay",e);b.removeEventListener("error",f)}var h=a.name,k=a.parser,p=new r(h,function(){1!==p.state&&-1!==p.state&&(p.state=-1,g(),b.src="")}),t=b;a.stream&&b.addEventListener("progress",d);"image"===a.type?b.addEventListener("load",e):b.addEventListener("canplay",e);b.addEventListener("error",f);b.crossOrigin=a.credentials?"use-credentials":"anonymous";b.src=a.src;return p}function A(a){-1!==H&&
1!==H&&(H=-1,k.forEach(function(a){a.cancel()}),e?"string"===typeof a?e(Error("resl: "+a)):e(a):console.error("resl error:",a))}function u(a){if(-1!==H&&1!==H){var b=0,c=0;k.forEach(function(a){a.ready&&(c+=1);b+=a.progress});c===k.length?(H=1,B(n)):y&&y(b/k.length,a)}}"object"===typeof c&&c||g("invalid or missing configuration");b(c,x,"config");var I=c.manifest;"object"===typeof I&&I||g("missing manifest");var B=h("onDone");B||g("missing onDone() callback");var y=h("onProgress"),e=h("onError"),n=
{},H=0,N={text:p,binary:function(a){return p(a)},image:function(a){return v(a,document.createElement("img"))},video:function(a){return v(a,document.createElement("video"))},audio:function(a){return v(a,document.createElement("audio"))}},k=Object.keys(I).map(function(a){function c(a,b){if(a in e.parser){var d=e.parser[a];"function"!==typeof d&&g("invalid parser callback "+a+' for asset "'+a+'"');return d}return b}var e=I[a];"string"===typeof e?e={src:e}:"object"===typeof e&&e||g('invalid asset definition "'+
a+'"');b(e,f,'asset "'+a+'"');var h={};"parser"in e&&("function"===typeof e.parser?h={data:e.parser}:"object"===typeof e.parser&&e.parser?(b(h,d,'parser for asset "'+a+'"'),"onData"in h||g('missing onData callback for parser in asset "'+a+'"'),h={data:c("onData"),done:c("onDone")}):g('invalid parser for asset "'+a+'"'));return{name:a,type:function(b,c,d){b in e&&(d=e[b]);0>c.indexOf(d)&&g("invalid "+b+' "'+d+'" for asset "'+a+'", possible values: '+c);return d}("type",Object.keys(N),"text"),stream:!!e.stream,
credentials:!!e.credentials,src:function(b,c,d){b in e?d=e[b]:c&&g("missing "+b+' for asset "'+a+'"');"string"!==typeof d&&g("invalid "+b+' for asset "'+a+'", must be a string');return d}("src",!0,""),parser:h}}).map(function(a){return N[a.type](a)})}},{}],36:[function(h,p,v){function g(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var b=h("./lib/util/extend"),r=h("./lib/dynamic"),x=h("./lib/util/raf"),f=h("./lib/util/clock"),d=h("./lib/strings"),c=h("./lib/webgl"),t=h("./lib/extension"),
W=h("./lib/limits"),E=h("./lib/buffer"),A=h("./lib/elements"),u=h("./lib/texture"),I=h("./lib/renderbuffer"),B=h("./lib/framebuffer"),y=h("./lib/attribute"),e=h("./lib/shader"),n=h("./lib/read"),H=h("./lib/core"),N=h("./lib/stats"),k=h("./lib/timer");p.exports=function(a){function h(){if(0===M.length)X&&X.update(),ca=null;else{ca=x.next(h);C();for(var a=M.length-1;0<=a;--a){var b=M[a];b&&b(P,null,0)}w.flush();X&&X.update()}}function p(a){}function v(a){}function oa(a){function c(a){var b={},d={};
Object.keys(a).forEach(function(c){var e=a[c];r.isDynamic(e)?d[c]=r.unbox(e,c):b[c]=e});return{dynamic:d,"static":b}}function d(a){for(;t.length<a;)t.push(null);return t}var e=c(a.context||{}),f=c(a.uniforms||{}),g=c(a.attributes||{}),h=c(function(a){function c(a){if(a in d){var b=d[a];delete d[a];Object.keys(b).forEach(function(c){d[a+"."+c]=b[c]})}}var d=b({},a);delete d.uniforms;delete d.attributes;delete d.context;c("blend");c("depth");c("cull");c("stencil");c("polygonOffset");c("scissor");c("sample");
return d}(a));a={gpuTime:0,cpuTime:0,count:0};var e=da.compile(h,g,f,e,a),k=e.draw,n=e.batch,p=e.scope,t=[];return b(function(a,b){var c;if("function"===typeof a)return p.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(c=0;c<a;++c)p.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)p.call(this,a[c],b,c);else return p.call(this,a,b,0);else if("number"===typeof a){if(0<a)return n.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return n.call(this,
a,a.length)}else return k.call(this,a)},{stats:a})}function ua(){var a=sa.viewport,b=sa.scissor_box;a[0]=a[1]=b[0]=b[1]=0;P.viewportWidth=P.framebufferWidth=P.drawingBufferWidth=a[2]=b[2]=w.drawingBufferWidth;P.viewportHeight=P.framebufferHeight=P.drawingBufferHeight=a[3]=b[3]=w.drawingBufferHeight}function C(){P.tick+=1;P.time=(f()-Z)/1E3;ua();da.procs.poll()}function fa(){ua();da.procs.refresh();X&&X.update()}var G=c(a);if(!G)return null;var w=G.gl;a=w.getContextAttributes();var U=t(w,G);if(!U)return null;
var va=d(),F=N(),U=U.extensions,X=k(w,U),Z=f(),R=w.drawingBufferWidth,O=w.drawingBufferHeight,P={tick:0,time:0,viewportWidth:R,viewportHeight:O,framebufferWidth:R,framebufferHeight:O,drawingBufferWidth:R,drawingBufferHeight:O,pixelRatio:G.pixelRatio},S=W(w,U),ia=E(w,F,G),qa=A(w,U,ia,F),R=y(w,U,S,ia,va),xa=e(w,va,F,G),ja=u(w,U,S,function(){da.procs.poll()},P,F,G),ra=I(w,U,S,F,G),ka=B(w,U,S,ja,ra,F),da=H(w,va,U,S,ia,qa,ja,ka,{},R,xa,{elements:null,primitive:4,count:-1,offset:0,instances:-1},P,X,G),
va=n(w,ka,da.procs.poll,P,a,U),sa=da.next,T=w.canvas,M=[],ca=null;T&&(T.addEventListener("webglcontextlost",p,!1),T.addEventListener("webglcontextrestored",v,!1));fa();a=b(oa,{clear:function(a){var b=0;da.procs.poll();var c=a.color;c&&(w.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(w.clearDepth(+a.depth),b|=256);"stencil"in a&&(w.clearStencil(a.stencil|0),b|=1024);w.clear(b)},prop:r.define.bind(null,1),context:r.define.bind(null,2),"this":r.define.bind(null,3),draw:oa({}),
buffer:function(a){return ia.create(a,34962)},elements:qa.create,texture:ja.create2D,cube:ja.createCube,renderbuffer:ra.create,framebuffer:ka.create,framebufferCube:ka.createCube,attributes:a,frame:function(a){M.push(a);!ca&&0<M.length&&(ca=x.next(h));return{cancel:function(){function b(){var a=g(M,b);M[a]=M[M.length-1];--M.length;0>=M.length&&ca&&(x.cancel(h),ca=null)}var c=g(M,a);M[c]=b}}},limits:S,hasExtension:function(a){return 0<=S.extensions.indexOf(a.toLowerCase())},read:va,destroy:function(){M.length=
0;ca&&(x.cancel(h),ca=null);T&&(T.removeEventListener("webglcontextlost",p),T.removeEventListener("webglcontextrestored",v));xa.clear();ka.clear();ra.clear();ja.clear();qa.clear();ia.clear();X&&X.clear();G.onDestroy()},_gl:w,_refresh:fa,poll:function(){C();X&&X.update()},stats:F});G.onDone(null,a);return a}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,
"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},{},[1]);
