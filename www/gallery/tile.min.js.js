(function e$$0(h,m,e){function b(d,g){if(!m[d]){if(!h[d]){var A="function"==typeof require&&require;if(!g&&A)return A(d,!0);if(a)return a(d,!0);A=Error("Cannot find module '"+d+"'");throw A.code="MODULE_NOT_FOUND",A;}A=m[d]={exports:{}};h[d][0].call(A.exports,function(a){var e=h[d][1][a];return b(e?e:a)},A,A.exports,e$$0,h,m,e)}return m[d].exports}for(var a="function"==typeof require&&require,d=0;d<e.length;d++)b(e[d]);return b})({1:[function(f,h,m){h.exports=[[[1,11],[1,11],[1,11],[1,11],[1,11],
[1,11],[1,11],[1,11],[6,6],[7,6],[8,6],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[0,0],[1,0],[1,0],[2,0],[1,11],[1,11],[1,11],[6,6],[7,6],[8,6],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[0,1],[1,1],[1,1],[2,1],[1,11],[1,11],[1,11],[6,6],[8,8],[8,6],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[0,1],[1,1],[0,3],[5,2],[1,11],[13,12],[13,12],[6,6],[7,6],[6,9],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[0,1],[1,1],[2,1],[1,11],[1,11],[13,15],[13,15],[6,6],[7,6],[7,6],[6,9],[1,11],[1,11],[1,11],[1,
11]],[[1,11],[0,2],[1,2],[2,2],[1,11],[1,11],[14,2],[15,2],[6,6],[7,6],[7,6],[7,6],[6,9],[8,5],[1,11],[1,11]],[[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[6,6],[8,8],[7,6],[7,6],[7,6],[8,6],[1,11],[1,11]],[[4,5],[2,5],[0,5],[1,5],[2,5],[1,11],[1,11],[1,11],[6,7],[7,8],[7,6],[7,6],[8,9],[6,9],[8,5],[1,11]],[[2,8],[3,9],[4,9],[4,6],[3,9],[5,0],[1,11],[1,11],[1,11],[6,7],[7,8],[7,6],[7,6],[8,8],[8,6],[1,11]],[[4,7],[4,7],[4,8],[5,8],[2,9],[3,9],[4,5],[2,5],[1,11],[1,11],[6,7],[7,8],[7,6],
[7,6],[6,9],[8,5]],[[1,11],[1,11],[3,7],[4,7],[4,8],[5,9],[5,8],[0,9],[2,5],[1,11],[1,11],[6,7],[7,8],[7,6],[7,6],[6,9]],[[1,11],[1,11],[1,11],[1,11],[0,7],[4,8],[4,6],[4,6],[5,1],[1,11],[1,11],[1,11],[6,7],[7,8],[7,6],[7,6]],[[1,11],[9,0],[10,0],[8,0],[1,11],[3,7],[1,7],[1,7],[5,7],[1,11],[1,11],[1,11],[1,11],[6,7],[7,7],[7,7]],[[1,11],[9,1],[11,3],[11,1],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[9,2],[7,2],[11,2],[1,11],[1,11],[1,11],[2,12],[1,
13],[1,13],[1,13],[1,13],[1,13],[1,13],[0,12],[1,11]],[[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[2,10],[3,10],[3,10],[3,10],[3,10],[3,10],[3,10],[0,10],[1,11]]]},{}],2:[function(f,h,m){h=f("../regl")();var e=f("mouse-change")(),b=f("./assets/map.json"),a=h({frag:"\n  precision mediump float;\n  uniform sampler2D map, tiles;\n  uniform vec2 mapSize, tileSize;\n  varying vec2 uv;\n  void main() {\n    vec2 tileCoord = floor(255.0 * texture2D(map, floor(uv) / mapSize).ra);\n    gl_FragColor = texture2D(tiles, (tileCoord + fract(uv)) / tileSize);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  uniform vec4 view;\n  varying vec2 uv;\n  void main() {\n    uv = mix(view.xw, view.zy, 0.5 * (1.0 + position));\n    gl_Position = vec4(position, 1, 1);\n  }",depth:{enable:!1},uniforms:{tiles:h.texture("assets/tiles.png"),tileSize:[16,16],map:h.texture(b),mapSize:[b[0].length,b.length],view:h.prop("view")},attributes:{position:h.buffer([-1,-1,1,-1,-1,1,1,1,-1,1,1,-1])},count:6});h.frame(function(d,K){var g=K.viewportWidth,A=K.viewportHeight,
k=b[0].length*e.x/g,f=b.length*e.y/A,g=g/A*10;a({view:[k-.5*g,f-5,k+.5*g,f+5]})})},{"../regl":36,"./assets/map.json":1,"mouse-change":34}],3:[function(f,h,m){var e=f("./constants/dtypes.json");h.exports=function(b,a,d,K,g){function A(){this.pointer=!1;this.w=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}function k(a){this.records=[];this.name=a}function f(e,c,l,d){d=l.size||d;var g;g=c.pointer?l.pointer&&c.buffer===l.buffer&&
c.size===d&&c.normalized===l.normalized&&c.type===(l.type||l.buffer.dtype||5126)&&c.offset===l.offset&&c.stride===l.stride&&c.divisor===l.divisor:!l.pointer&&c.x===l.x&&c.y===l.y&&c.z===l.z&&c.w===l.w;g||(l.pointer?(b.enableVertexAttribArray(e),l.buffer.bind(),b.vertexAttribPointer(e,d,l.type||l.buffer.dtype||5126,l.normalized,l.stride,l.offset),(g=a.angle_instanced_arrays)&&g.vertexAttribDivisorANGLE(e,l.divisor)):(b.disableVertexAttribArray(e),b.vertexAttrib4f(e,l.x,l.y,l.z,l.w)),(c.pointer=l.pointer)?
(c.buffer=l.buffer,c.size=d,c.normalized=l.normalized,c.type=l.type||l.buffer.dtype||5126,c.offset=l.offset,c.stride=l.stride,c.divisor=l.divisor):(c.x=l.x,c.y=l.y,c.z=l.z,c.w=l.w))}var h={};d=d.maxAttributes;for(var z=Array(d),n=0;n<d;++n)z[n]=new A;return{bindings:z,bind:function(a,c,l,b){l=l.records;f(a,c,l[l.length-1],b)},bindRecord:f,def:function(a){var c=g.id(a),b=h[c];b||(b=h[c]=new k(a));return b},box:function(a){var c=[new A];return{alloc:function(a){var b;b=0>=c.length?new A:c.pop();if("number"===
typeof a)b.pointer=!1,b.x=a,b.y=0,b.z=0,b.w=0;else if(Array.isArray(a))b.pointer=!1,b.x=a[0],b.y=a[1],b.z=a[2],b.w=a[3];else{var d=K.getBuffer(a),g=0,n=0,k=0,f=0,h=!1,C=0;d||(d=K.getBuffer(a.buffer),g=a.size||0,n=a.stride||0,k=a.offset||0,f=a.divisor||0,h=a.normalized||!1,C=0,"type"in a&&(C=e[a.type]));b.pointer=!0;b.buffer=d;b.size=g;b.offset=k;b.stride=n;b.divisor=f;b.normalized=h;b.type=C}return b},free:function(b){c.push(b)}}},state:h}}},{"./constants/dtypes.json":7}],4:[function(f,h,m){function e(b,
a){switch(b){case 5121:return new Uint8Array(a);case 5123:return new Uint16Array(a);case 5125:return new Uint32Array(a);case 5120:return new Int8Array(a);case 5122:return new Int16Array(a);case 5124:return new Int32Array(a);case 5126:return new Float32Array(a);default:return null}}var b=f("./util/is-typed-array"),a=f("./util/is-ndarray"),d=f("./constants/arraytypes.json"),K=f("./constants/dtypes.json"),g=f("./util/values"),A={"static":35044,dynamic:35048,stream:35040};h.exports=function(k,f){function h(a,
b){this.id=C++;this.buffer=a;this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function z(a){f(a);k.isBuffer(a.buffer)||(a.buffer=k.createBuffer());a.bind();k.bufferData(a.type,a.data||a.byteLength,a.usage)}function n(a){var b=a.buffer;f(a);k.isBuffer(b)&&k.deleteBuffer(b);a.buffer=null;delete c[a.id]}var C=0,c={};h.prototype.bind=function(){k.bindBuffer(this.type,this.buffer)};return{create:function(l,g,f){function C(c){var g=c||{};if(Array.isArray(g)||
b(g)||a(g))g={data:g};else if("number"===typeof g)g={length:g|0};else if(null===g||void 0===g)g={};r.usage="usage"in g?A[g.usage]:35044;c=0;"type"in g&&(c=K[g.type]);var l=g.dimension|0||1,n=0,k=null;if("data"in g)if(k=g.data,null===k)n=g.length|0;else{if(a(k)){var l=k.shape,n=k.stride,g=k.offset,f=0,h=0,t=0,Q=0;1===l.length?(f=l[0],h=1,t=n[0],Q=0):2===l.length&&(f=l[0],h=l[1],t=n[0],Q=n[1]);c=c||d[Object.prototype.toString.call(k)]|0||5126;for(var l=h,n=e(c,f*h),k=k.data,na=0,T=0;T<f;++T)for(var v=
0;v<h;++v)n[na++]=k[t*T+Q*v+g];k=n}else if(Array.isArray(k))if(0<k.length&&Array.isArray(k[0])){l=k[0].length;c=c||5126;g=e(c,k.length*l);n=k;k=l;for(f=Q=0;f<n.length;++f)for(t=n[f],h=0;h<k;++h)g[Q++]=t[h];k=g}else c=c||5126,k=e(c,k);else c=c||d[Object.prototype.toString.call(k)]|0;n=k.byteLength}else"length"in g&&(n=g.length|0);r.data=k;r.dtype=c||5121;r.byteLength=n;r.dimension=l;z(r);return C}var I=k.createBuffer(),r=new h(I,g);c[r.id]=r;f||C(l);C._reglType="buffer";C._buffer=r;C.destroy=function(){n(r)};
return C},clear:function(){g(c).forEach(n)},refresh:function(){g(c).forEach(z)},getBuffer:function(a){return a&&a._buffer instanceof h?a._buffer:null}}}},{"./constants/arraytypes.json":6,"./constants/dtypes.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":32}],5:[function(f,h,m){function e(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function b(a,b,g,d){var c,e=
",";switch(b){case 5126:c="1f";break;case 35664:c="2fv";break;case 35665:c="3fv";break;case 35666:c="4fv";break;case 35670:case 5124:c="1i";break;case 35671:case 35667:c="2iv";break;case 35672:case 35668:c="3iv";break;case 35673:case 35669:c="4iv";break;case 35674:c="Matrix2fv";e=",false,";break;case 35675:c="Matrix3fv";e=",false,";break;case 35676:c="Matrix4fv",e=",false,"}return a+".uniform"+c+"("+g+e+d+");"}function a(a){return a+"["+a+".length-1]"}function d(a,b){return"framebuffer"===a||a<b?
-1:a>b?1:0}var K=f("./util/codegen"),g=f("./constants/primitives.json"),A={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},k={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,
">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},I={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};h.exports=function(f,h,n,C,c,l,E,v,D,m,r,O,U,ma,V){function ka(c,t,h,C,W){function E(w){var a=ra[w];return a?a:a=ra[w]=F(Z[w])}function z(w){var a=w.id,b=ca[a];if(b)return b;switch(w.type){case 0:b=p.def(F(w.data),".call(this,",P,",",M,")");break;case 1:b=p.def(P,w.data);break;case 2:b=p.def(M,w.data);
break;case 3:b=p.def("this",w.data)}return ca[a]=b}function ia(w,a){for(var b=0;b<w.length;++b)if(w[b].name===a)return w[b];return null}function B(w){return J&&!(w in t||w in W)}var D=K(),F=D.link,p=D.proc("batch"),u=D.block(),G=p.def,ha=p.arg,y=F(f),q=F(c.program),R=F(r.bind),fa=F(r.bindRecord),M=F(ma),Y=F(v),aa=F(U.count),ja=F(U.offset),qa=F(U.instances),S=F(U.primitive),ra={},x=F(l.elements),aa=G(a(aa)),ja=G(a(ja)),S=G(a(S)),x=G(a(x)),H,O,la=n.angle_instanced_arrays;la&&(H=G(a(qa)),O=F(la));var J=
"elements"in t,qa=ha(),ha=ha(),P=G(),V=G(),ca={};p(y,".useProgram(",q,");");c.uniforms.forEach(function(w){if(!(w.name in h)){var a=F(w.location),c=F(m.def(w.name)),c=c+"["+c+".length-1]";w=w.info.type;35678===w||35680===w?(w=G(c+"._texture"),p(b(y,5124,a,w+".bind()")),u(w,".unbind();")):p(b(y,w,a,c))}});c.attributes.forEach(function(w){if(!(w.name in C)){var a=F(r.def(w.name));p(R,"(",w.location,",",F(r.bindings[w.location]),",",a,",",e(w.info.type),");")}});J||p("if(",x,")",y,".bindBuffer(",34963,
",",x,".buffer.buffer);");p("for(",V,"=0;",V,"<",qa,";++",V,"){",P,"=",ha,"[",V,"];",M,".batchId=",V,";");Object.keys(t).sort(d).forEach(function(w){function a(w){p("if(",b,"){",y,".enable(",w,");}else{",y,".disable(",w,");}")}var b=z(t[w]);switch(w){case "framebuffer":w=E("viewport");var c=E("scissor.box");p("if(",Y,".push(",b,"&&",b,"._framebuffer)){",Y,".poll();",w,".setDirty();",c,".setDirty();","}");break;case "cull.enable":a(2884);break;case "blend.enable":a(3042);break;case "dither":a(3024);
break;case "stencil.enable":a(2960);break;case "depth.enable":a(2929);break;case "scissor.enable":a(3089);break;case "polygonOffset.enable":a(32823);break;case "sample.alpha":a(32926);break;case "sample.enable":a(32928);break;case "depth.mask":p(y,".depthMask(",b,");");break;case "depth.func":w=F(k);p(y,".depthFunc(",w,"[",b,"]);");break;case "depth.range":p(y,".depthRange(",b,"[0],",b,"[1]);");break;case "blend.color":p(y,".blendColor(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");break;case "blend.equation":w=
F(L);p("if(typeof ",b,'==="string"){',y,".blendEquation(",w,"[",b,"]);","}else{",y,".blendEquationSeparate(",w,"[",b,".rgb],",w,"[",b,".alpha]);","}");break;case "blend.func":w=F(A);p(y,".blendFuncSeparate(",w,'["srcRGB" in ',b,"?",b,".srcRGB:",b,".src],",w,'["dstRGB" in ',b,"?",b,".dstRGB:",b,".dst],",w,'["srcAlpha" in ',b,"?",b,".srcAlpha:",b,".src],",w,'["dstAlpha" in ',b,"?",b,".dstAlpha:",b,".dst]);");break;case "stencil.mask":p(y,".stencilMask(",b,");");break;case "stencil.func":w=F(k);p(y,
".stencilFunc(",w,"[",b,'.cmp||"always"],',b,".ref|0,",'"mask" in ',b,"?",b,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":c=F(I);p(y,".stencilOpSeparate(","stencil.opFront"===w?1028:1029,",",c,"[",b,'.fail||"keep"],',c,"[",b,'.zfail||"keep"],',c,"[",b,'.pass||"keep"]);');break;case "polygonOffset.offset":p(y,".polygonOffset(",b,".factor||0,",b,".units||0);");break;case "cull.face":p(y,".cullFace(",b,'==="front"?',1028,":",1029,");");break;case "lineWidth":p(y,".lineWidth(",b,");");
break;case "frontFace":p(y,".frontFace(",b,'==="cw"?',2304,":",2305,");");break;case "colorMask":p(y,".colorMask(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");break;case "sample.coverage":p(y,".sampleCoverage(",b,".value,",b,".invert);");break;case "scissor.box":case "viewport":w=E(w),p(w,".push(",b,".x||0,",b,".y||0,",b,".w||-1,",b,".h||-1);")}});("viewport"in t||"framebuffer"in t)&&p(E("viewport"),".poll();");("scissor.box"in t||"framebuffer"in t)&&p(E("scissor.box"),".poll();");"framebuffer"in t&&p(Y,
".pop();");var da=c.uniforms,ta=[];Object.keys(h).forEach(function(w){var a=ia(da,w);if(a){var c=a.info.type,q=F(a.location);w=z(h[w]);35678===a.info.type||35680===a.info.type?(a=G(w+"._texture"),ta.push(a),p(b(y,5124,q,a+".bind()"))):p(b(y,c,q,w))}});ta.forEach(function(b){p(b,".unbind();")});var pa=c.attributes;Object.keys(C).forEach(function(b){var a=ia(pa,b);if(a){var c=F(r.box(b));b=z(C[b]);b=G(c+".alloc("+b+")");p(fa,"(",a.location,",",F(r.bindings[a.location]),",",b,",",e(a.info.type),");");
u(c,".free(",b,");")}});t.count&&p(aa,"=",z(t.count),";");t.offset&&p(ja,"=",z(t.offset),";");t.primitive&&p(S,"=",F(g),"[",z(t.primitive),"];");la&&t.instances&&p(H,"=",z(t.instances),";");J&&(c=z(t.elements),p(x,"=",c,"?",c,"._elements:null;"));B("offset")&&p(ja,"=0;");p("if(",x,"){");B("count")&&p(aa,"=",x,".vertCount;");p("if(",aa,">0){");B("primitive")&&p(S,"=",x,".primType;");J&&p(y,".bindBuffer(",34963,",",x,".buffer.buffer);");la&&p("if(",H,">0){",O,".drawElementsInstancedANGLE(",S,",",aa,
",",x,".type,",ja,",",H,");}else ");p(y,".drawElements(",S,",",aa,",",x,".type,",ja,");");p("}}else if(",aa,">0){");B("count")||(B("primitive")&&p(S,"=",4,";"),la&&p("if(",H,">0){",O,".drawArraysInstancedANGLE(",S,",",ja,",",aa,",",H,");}else{"),p(y,".drawArrays(",S,",",ja,",",aa,");"),la&&p("}"));p("}}",u);return D.compile().batch}var Z=D.contextState,L={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(L.min=32775,L.max=32776);var t=0;return{draw:function(c){var g=K(),d=g.link,
k=g.proc("draw"),t=k.def,h=d(f),A=d(c.program),C=d(r.bind),v=d(U.count),E=d(U.offset),z=d(U.instances),p=d(U.primitive),u=d(l.elements),I=[];k(h,".useProgram(",A,");");c.attributes.forEach(function(b){var a=d(r.def(b.name));k(C,"(",b.location,",",d(r.bindings[b.location]),",",a,",",e(b.info.type),");")});c.uniforms.forEach(function(a){var c=d(a.location),q=d(m.def(a.name)),q=q+"["+q+".length-1]";a=a.info.type;35678===a||35680===a?(a=t(q+"._texture"),I.push(a),k(b(h,5124,c,a+".bind()"))):k(b(h,a,c,
q))});I.forEach(function(b){k(b,".unbind();")});c=t(a(p));v=t(a(v));E=t(a(E));u=t(a(u));k("if(",v,"){");(A=n.angle_instanced_arrays)?(z=t(a(z)),A=d(A),k("if(",u,"){",u,".bind();","if(",z,">0){",A,".drawElementsInstancedANGLE(",c,",",v,",",u,".type,",E,",",z,");}else{",h,".drawElements(",c,",",v,",",u,".type,",E,");}","}else if(",z,">0){",A,".drawArraysInstancedANGLE(",c,",",E,",",v,",",z,");}else{",h,".drawArrays(",c,",",E,",",v,");}}")):k("if(",u,"){",u,".bind();",h,".drawElements(",c,",",v,",",
u,".type,",E,");","}else{",h,".drawArrays(",c,",",E,",",v,");}}");return g.compile().draw},command:function(b,a,c,e,n,f,C,E){function B(b){var a=ra[b];return a?a:a=ra[b]=u(Z[b])}function D(b,a){var c=B(b);x(c,".push(",a,");");H(c,".pop();")}function F(b){var a=b.id,c=ua[a];if(c)return c;switch(b.type){case 0:c=J.def(u(b.data),".call(this,",oa,",",S,")");break;case 1:c=J.def(oa,b.data);break;case 2:c=J.def(S,b.data);break;case 3:c=J.def("this",b.data)}return ua[a]=c}var p=K(),u=p.link,G=p.block,N=
p.proc,y=t++,q=u(V),R=u(O),fa=u(v),M={count:u(U.count),offset:u(U.offset),instances:u(U.instances),primitive:u(U.primitive)},Y=u(l.elements),aa=u(g),ja=u(k),qa=u(I),S=u(ma),ra={},x=G(),H=G(),oa;E&&(oa=x.def());x(S,".batchId=0;");var la=G();Object.keys(C["static"]).forEach(function(b){var a=x.def(S,".",b);la(S,".",b,"=",u(C["static"][b]),";");H(S,".",b,"=",a,";")});Object.keys(C.dynamic).forEach(function(b){var a=x.def(S,".",b),c=x.def(),q=C.dynamic[b];la(S,".",b,"=",c,";");switch(q.type){case 0:x(c,
"=",u(q.data),".call(this,",oa,",",S,");");break;case 1:x(c,"=",oa,q.data,";");break;case 2:x(c,"=",S,q.data,";");break;case 3:x(c,"=","this",q.data,";")}H(S,".",b,"=",a,";")});x(la);Object.keys(b).sort(d).forEach(function(a){var c=b[a];switch(a){case "frag":case "vert":c=h.id(c);O.shader("frag"===a?35632:35633,c);x(R,".",a,".push(",c,");");H(R,".",a,".pop();");break;case "framebuffer":v.getFramebuffer(c);a=B("viewport");var q=B("scissor.box");x("if(",fa,".push(",u(c&&c._framebuffer),")){",a,".setDirty();",
q,".setDirty();","}");H("if(",fa,".pop()){",a,".setDirty();",q,".setDirty();","}");break;case "count":case "offset":case "instances":x(M[a],".push(",c,");");H(M[a],".pop();");break;case "primitive":x(M.primitive,".push(",g[c],");");H(M.primitive,".pop();");break;case "elements":q=l.getElements(c);c=!("primitive"in b);a=!("count"in b);q?(q=u(q),x(Y,".push(",q,");"),c&&x(M.primitive,".push(",q,".primType);"),a&&x(M.count,".push(",q,".vertCount);")):(x(Y,".push(null);"),c&&x(M.primitive,".push(",4,");"),
a&&x(M.count,".push(0);"));c&&H(M.primitive,".pop();");a&&H(M.count,".pop();");"offset"in b||(x(M.offset,".push(0);"),H(M.offset,".pop();"));H(Y,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":D(a,c);break;case "depth.func":D(a,k[c]);break;case "depth.range":a=B(a);x(a,".push(",c[0],",",c[1],");");H(a,".pop();");break;case "blend.func":a=
B(a);x(a,".push(",A["srcRGB"in c?c.srcRGB:c.src],",",A["dstRGB"in c?c.dstRGB:c.dst],",",A["srcAlpha"in c?c.srcAlpha:c.src],",",A["dstAlpha"in c?c.dstAlpha:c.dst],");");H(a,".pop();");break;case "blend.equation":a=B(a);"string"===typeof c?x(a,".push(",L[c],",",L[c],");"):"object"===typeof c&&x(a,".push(",L[c.rgb],",",L[c.alpha],");");H(a,".pop();");break;case "blend.color":a=B(a);x(a,".push(",c[0],",",c[1],",",c[2],",",c[3],");");H(a,".pop();");break;case "stencil.mask":a=B(a);x(a,".push(",c,");");
H(a,".pop();");break;case "stencil.func":var q=c.cmp||"keep",d=c.ref||0,c="mask"in c?c.mask:-1;a=B(a);x(a,".push(",k[q],",",d,",",c,");");H(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":q=c.fail||"keep";d=c.zfail||"keep";c=c.pass||"keep";a=B(a);x(a,".push(",I[q],",",I[d],",",I[c],");");H(a,".pop();");break;case "polygonOffset.offset":q=c.factor||0;c=c.units||0;a=B(a);x(a,".push(",q,",",c,");");H(a,".pop();");break;case "cull.face":q=0;"front"===c?q=1028:"back"===c&&(q=1029);c=B(a);
x(c,".push(",q,");");H(c,".pop();");break;case "lineWidth":D(a,c);break;case "frontFace":q=0;"cw"===c?q=2304:"ccw"===c&&(q=2305);c=B(a);x(c,".push(",q,");");H(c,".pop();");break;case "colorMask":a=B(a);x(a,".push(",c.map(function(a){return!!a}).join(),");");H(a,".pop();");break;case "sample.coverage":q="value"in c?c.value:1;c=!!c.invert;a=B(a);x(a,".push(",q,",",c,");");H(a,".pop();");break;case "viewport":case "scissor.box":var q=c.x||0,d=c.y||0,e=-1,n=-1;"w"in c&&(e=c.w);"h"in c&&(n=c.h);c=B(a);
x(c,".push(",q,",",d,",",e,",",n,");");H(c,".pop();")}});Object.keys(a).forEach(function(c){var b=u(m.def(c));c=a[c];c="function"===typeof c&&c._reglType?u(c):Array.isArray(c)?u(c.slice()):+c;x(b,".push(",c,");");H(b,".pop();")});Object.keys(c).forEach(function(a){var b=c[a],q=u(r.def(a));a=u(r.box(a).alloc(b));x(q,".records.push(",a,");");H(q,".records.pop();")});var J=p.block(),P=p.block(),ua={};Object.keys(e).sort(d).forEach(function(a){var c=F(e[a]);switch(a){case "framebuffer":a=B("viewport");
var q=B("scissor.box");J("if(",fa,".push(",c,"&&",c,"._framebuffer)){",a,".setDirty();",q,".setDirty();","}");P("if(",fa,".pop()){",a,".setDirty();",q,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=B(a);J(a,".push(",c,");");P(a,".pop();");break;case "count":case "offset":case "instances":a=M[a];J(a,
".push(",c,");");P(a,".pop();");break;case "primitive":a=M.primitive;J(a,".push(",aa,"[",c,"]);");P(a,".pop();");break;case "depth.func":a=B(a);J(a,".push(",ja,"[",c,"]);");P(a,".pop();");break;case "blend.func":a=B(a);q=u(A);J(a,".push(",q,'["srcRGB" in ',c,"?",c,".srcRGB:",c,".src],",q,'["dstRGB" in ',c,"?",c,".dstRGB:",c,".dst],",q,'["srcAlpha" in ',c,"?",c,".srcAlpha:",c,".src],",q,'["dstAlpha" in ',c,"?",c,".dstAlpha:",c,".dst]);");P(a,".pop();");break;case "blend.equation":a=B(a);q=u(L);J("if(typeof ",
c,'==="string"){',a,".push(",q,"[",c,"],",q,"[",c,"]);","}else{",a,".push(",q,"[",c,".rgb],",q,"[",c,".alpha]);","}");P(a,".pop();");break;case "blend.color":a=B(a);J(a,".push(",c,"[0],",c,"[1],",c,"[2],",c,"[3]);");P(a,".pop();");break;case "stencil.mask":a=B(a);J(a,".push(",c,");");P(a,".pop();");break;case "stencil.func":a=B(a);J(a,".push(",ja,"[",c,".cmp],",c,".ref|0,",'"mask" in ',c,"?",c,".mask:-1);");P(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=B(a);J(a,".push(",qa,"[",
c,'.fail||"keep"],',qa,"[",c,'.zfail||"keep"],',qa,"[",c,'.pass||"keep"]);');P(a,".pop();");break;case "polygonOffset.offset":a=B(a);J(a,".push(",c,".factor||0,",c,".units||0);");P(a,".pop();");break;case "cull.face":a=B(a);J(a,".push(",c,'==="front"?',1028,":",1029,");");P(a,".pop();");break;case "frontFace":a=B(a);J(a,".push(",c,'==="cw"?',2304,":",2305,");");P(a,".pop();");break;case "colorMask":a=B(a);J(a,".push(",c,"[0],",c,"[1],",c,"[2],",c,"[3]);");P(a,".pop();");break;case "sample.coverage":a=
B(a);J(a,".push(",c,".value,",c,".invert);");P(a,".pop();");break;case "scissor.box":case "viewport":a=B(a);J(a,".push(",c,".x||0,",c,".y||0,",'"w" in ',c,"?",c,".w:-1,",'"h" in ',c,"?",c,".h:-1);");P(a,".pop();");break;case "elements":a=!("primitive"in e)&&!("primitive"in b);var q=!("count"in e)&&!("count"in b),d=!("offset"in e)&&!("offset"in b),g=J.def();J("if(",c,"){",g,"=",c,"._elements;",Y,".push(",g,");",a?M.primitive+".push("+g+".primType);":"",q?M.count+".push("+g+".vertCount);":"",d?M.offset+
".push("+g+".offset);":"","}else{",Y,".push(null);","}");P(Y,".pop();","if(",c,"){",a?M.primitive+".pop();":"",q?M.count+".pop();":"",d?M.offset+".pop();":"","}")}});Object.keys(n).forEach(function(a){var c=u(m.def(a));a=F(n[a]);J(c,".push(",a,");");P(c,".pop();")});Object.keys(f).forEach(function(a){var c=u(r.def(a)),b=F(f[a]);a=u(r.box(a));J(c,".records.push(",a,".alloc(",b,"));");P(a,".free(",c,".records.pop());")});var ca=N("scope"),da=ca.arg(),ta=ca.arg();E&&ca(oa,"=",da,";");ca(x);E&&ca(J);
ca(ta,"(",da,",",S,");",E?P:"",H);ca=G();G=ca.def();b.frag&&b.vert?(da=b.frag,ca(G,"=",u(O.program(h.id(b.vert),h.id(da))),";")):ca(G,"=",R,".program","(",R,".vert[",R,".vert.length-1]",",",R,".frag[",R,".frag.length-1]",");");da=N("draw");E&&da(oa,"=",da.arg(),";");da(x,ca);E&&da(J);da(q,"();","if(",G,")",G,".draw.call(this",E?","+oa:"",");",E?P:"",H);var pa=N("batch"),N=pa.arg(),da=pa.arg();E&&pa(oa,"=",da,"[0];");pa(x,ca);E=u(function(a,c,q){var d=a.batchCache[y];d||(d=a.batchCache[y]=ka(a,e,n,
f,b));return d.call(this,c,q)});pa("if(",G,"){",q,"();",E,".call(this,",G,",",N,",",da,");");Object.keys(e).forEach(function(a){(a=ra[a])&&pa(a,".setDirty();")});pa("}",H);return p.compile()}}}},{"./constants/primitives.json":8,"./util/codegen":23}],6:[function(f,h,m){h.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,
"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],7:[function(f,h,m){h.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],8:[function(f,h,m){h.exports={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],9:[function(f,h,m){h.exports=function(e){return{primitive:[4],count:[-1],offset:[0],instances:[0]}}},{}],10:[function(f,h,m){function e(a,b){this.id=d++;this.type=a;this.data=b}function b(a){if(0===
a.length)return[];var d=a.charAt(0),e=a.charAt(a.length-1);if(1<a.length&&d===e&&('"'===d||"'"===d))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(d=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return b(a.substr(0,d.index)).concat(b(d[1])).concat(b(a.substr(d.index+d[0].length)));d=a.split(".");if(1===d.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(e=0;e<d.length;++e)a=a.concat(b(d[e]));return a}function a(a){return"["+b(a).join("][")+
"]"}var d=0;h.exports={define:function(b,d){switch(typeof d){case "boolean":case "number":case "string":return new e(b,a(d+""));case "undefined":return new e(b|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof e},unbox:function(b,d){if(b instanceof e){if(b.type&128)return new e(b.type&-129,a(d))}else if("function"===typeof b)return new e(0,b);return b},accessor:a}},{}],11:[function(f,h,m){var e=f("./util/is-typed-array"),b=f("./util/is-ndarray"),a=f("./constants/primitives.json");
h.exports=function(d,h,g){function f(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}f.prototype.bind=function(){this.buffer.bind()};return{create:function(d){function I(d){var g=h.oes_element_index_uint;if(d)if("number"===typeof d)z(d);else{var c=null,k="static",f=0;Array.isArray(d)||e(d)||b(d)?c=d:("data"in d&&(c=d.data),"usage"in d&&(k=d.usage),"length"in d&&(f=d.length));Array.isArray(c)||b(c)&&"array"===c.dtype||"type"in d?z({type:d.type||(g?"uint32":"uint16"),usage:k,data:c,length:f}):
z({usage:k,data:c,length:f});if(Array.isArray(c)||e(c))z.dimension=3}else z();g=m.buffer.byteLength;c=0;switch(m.buffer.dtype){case 5121:case 5120:c=5121;break;case 5123:case 5122:c=5123;g>>=1;break;case 5125:case 5124:c=5125,g>>=2}k=4;f=m.buffer.dimension;1===f&&(k=0);2===f&&(k=1);3===f&&(k=4);"object"===typeof d&&("primitive"in d&&(k=a[d.primitive]),"count"in d&&(g=d.vertCount|0));m.primType=k;m.vertCount=g;m.type=c;return I}var m=new f,z=g.create(null,34963,!0);m.buffer=z._buffer;I(d);I._reglType=
"elements";I._elements=m;I.destroy=function(){z.destroy();m.buffer=null};return I},elements:[null],getElements:function(a){return a&&a._elements instanceof f?a._elements:null}}}},{"./constants/primitives.json":8,"./util/is-ndarray":25,"./util/is-typed-array":26}],12:[function(f,h,m){h.exports=function(e){function b(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(b){try{a[b]=
e.getExtension(b)}catch(f){}})}var a={};b();return{extensions:a,refresh:b}}},{}],13:[function(f,h,m){var e=f("./util/values"),b=f("./util/extend"),a=[1029];h.exports=function(d,f,g,h,k){function I(a,c,b,d){this.target=a;this.level=c;this.texture=b;this.renderbuffer=d}function m(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function z(a,c){var b=c.width,d=c.height;if(a.texture)var e=a.texture._texture,g=Math.max(1,e.params.width>>a.level),k=Math.max(1,
e.params.height>>a.level),b=b||g,d=d||k;else e=a.renderbuffer._renderbuffer,b=b||e.width,d=d||e.height;e.refCount+=1;c.width=b;c.height=d}function n(a,c){c?c.texture?d.framebufferTexture2D(36160,a,c.target,c.texture._texture.texture,c.level):d.framebufferRenderbuffer(36160,a,36161,c.renderbuffer._renderbuffer.renderbuffer):d.framebufferTexture2D(36160,a,3553,null,0)}function C(a){var c=3553,b=0,d=null,e=null;"object"===typeof a&&("level"in a&&(b=a.level|0),"target"in a&&(c=a.target|0));var g=a._reglType;
"texture"===g?d=a:"renderbuffer"===g&&(e=a,c=36161,b=0);return new I(c,b,d,e)}function c(a){return a&&(a.texture||a.renderbuffer)}function l(){this.id=V++;ka[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function E(a){d.isFramebuffer(a.framebuffer)||(a.framebuffer=d.createFramebuffer());L=!0;d.bindFramebuffer(36160,a.framebuffer);for(var c=a.colorAttachments,
b=0;b<c.length;++b)n(36064+b,c[b]);for(b=c.length;b<g.maxColorAttachments;++b)n(36064+b,null);n(36096,a.depthAttachment);n(36128,a.stencilAttachment);n(33306,a.depthStencilAttachment);f.webgl_draw_buffers&&f.webgl_draw_buffers.drawBuffersWEBGL(ma[c.length]);d.checkFramebufferStatus(36160)}function v(a){a=a.framebuffer;d.isFramebuffer(a)&&d.deleteFramebuffer(a)}function D(){return Z[Z.length-1]}var ba={rgba:6408},r={rgba4:32854,rgb565:36194,"rgb5 a1":32855};f.ext_srgb&&(r.srgba=35907);f.ext_color_buffer_half_float&&
(r.rgba16f=34842,r.rgb16f=34843);f.webgl_color_buffer_float&&(r.rgba32f=34836);var O=[],U=[];f.webgl_depth_texture&&(O.push(6402),U.push(34041));b(b({},ba),r);e(ba);e(r);r=5121;O={uint8:5121};f.oes_texture_half_float&&(r=O["half float"]=36193);f.oes_texture_float&&(r=O["float"]=5126);O.best=r;var ma=function(){for(var a=Array(g.maxDrawbuffers),c=0;c<=g.maxDrawbuffers;++c)for(var b=a[c]=Array(c),d=0;d<c;++d)b[d]=36064+d;return a}(),V=0,ka={},Z=[null],L=!0;return{top:D,dirty:function(){return L},push:function(a){a=
a||null;L=L||a!==D();Z.push(a);return L},pop:function(){var a=D();Z.pop();return L=L||a!==D()},getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof l)?a:null},poll:function(){if(L){var c=Z[Z.length-1],b=f.webgl_draw_buffers;c?(d.bindFramebuffer(36160,c.framebuffer),b&&b.drawBuffersWEBGL(ma[c.colorAttachments.length])):(d.bindFramebuffer(36160,null),b&&b.drawBuffersWEBGL(a));L=!1}},create:function(a){function b(a){var g,f=a||{},l=a=0;if("shape"in
f){var n=f.shape;a=n[0];l=n[1]}else"radius"in f&&(a=l=f.radius),"width"in f&&(a=f.width),"height"in f&&(l=f.height);var v=null,n=!1;if("colorBuffers"in f||"colorBuffer"in f){v=f.colorBuffers||f.colorBuffer;Array.isArray(v)||(v=[v]);e.width=a;e.height=l;v=v.map(C);for(g=0;g<v.length;++g)z(v[g],e);a=e.width;l=e.height}else{var r=!0,K="rgba",t="uint8",p=1,n=!0;e.width=a=a||d.drawingBufferWidth;e.height=l=l||d.drawingBufferHeight;"format"in f&&(K=f.format,r=K in ba);"type"in f&&(t=f.type);"colorCount"in
f&&(p=f.colorCount|0);if(e.ownsColor)for(v=e.colorAttachments;v.length>p;)m(v.pop());else v=[];for(g=0;g<v.length;++g){var u;a:{u=v[g];var D=r,O=K,y=a,q=l;if(u.texture){var R=u.texture;if(D){R({format:O,type:t,width:y,height:q});R._texture.refCount+=1;u=!0;break a}}else if(R=u.renderbuffer,!D){R({format:O,width:y,height:q});R._renderbuffer.refCount+=1;u=!0;break a}m(u);u=!1}u||(v[g--]=v[v.length-1],v.pop())}for(;v.length<p;)r?v.push(new I(3553,0,h.create({format:K,type:t,width:a,height:l},3553),null)):
v.push(new I(36161,0,null,k.create({format:K,width:a,height:l})))}e.width=a;e.height=l;K=r=g=null;t=!1;"depthBuffer"in f&&(g=C(f.depthBuffer));"stencilBuffer"in f&&(r=C(f.stencilBuffer));"depthStencilBuffer"in f&&(K=C(f.depthStencilBuffer));if(g||r||K)z(g||r||K,e);else if(p=!0,D=u=!1,"depth"in f&&(p=!!f.depth),"stencil"in f&&(u=!!f.stencil),"depthTexture"in f&&(D=!!f.depthTexture),f=e.depthAttachment||e.stencilAttachment||e.depthStencilAttachment,O=null,p||u)t=!0,D?(D=u?"depth stencil":"depth",e.ownsDepthStencil&&
f.texture?(f.texture({format:D,width:a,height:l}),f.texture._texture.refCount+=1,O=f):O=new I(3553,0,h.create({format:D,width:a,height:l},3553),null)):(D=p?u?"depth stencil":"depth":"stencil",e.ownsDepthStencil&&f.renderbuffer?(f.renderbuffer({format:D,width:a,height:l}),f.renderbuffer._renderbuffer.refCount+=1,O=f):O=new I(36161,0,null,k.create({format:D,width:a,height:l}))),p?u?K=O:g=O:r=O;a=e;a.colorAttachments.forEach(m);m(a.depthAttachment);m(a.stencilAttachment);m(a.depthStencilAttachment);
e.colorAttachments=v;e.depthAttachment=g;e.stencilAttachment=r;e.depthStencilAttachment=K;e.ownsColor=n;e.ownsDepthStencil=t;b.color=v.map(c);b.depth=c(g);b.stencil=c(r);b.depthStencil=c(K);E(e);b.width=e.width;b.height=e.height;return b}var e=new l;b(a);b._reglType="framebuffer";b._framebuffer=e;b._destroy=function(){v(e)};return b},clear:function(){e(ka).forEach(v)},refresh:function(){e(ka).forEach(E)}}}},{"./util/extend":24,"./util/values":32}],14:[function(f,h,m){h.exports=function(e,b){var a=
1;b.ext_texture_filter_anisotropic&&(a=e.getParameter(34047));var d=1,f=1;b.webgl_draw_buffers&&(d=e.getParameter(34852),f=e.getParameter(36063));return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(b).filter(function(a){return!!b[a]}),maxAnisotropic:a,maxDrawbuffers:d,maxColorAttachments:f,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),
maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),
version:e.getParameter(7938)}}},{}],15:[function(f,h,m){var e=f("./util/is-typed-array");h.exports=function(b,a,d){return function(f){var g=f||{};e(f)?g={data:g}:2===arguments.length?g={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof f&&(g={});a();var h=g.x||0,k=g.y||0,m=g.width||d.width,N=g.height||d.height,g=g.data||new Uint8Array(m*N*4);b.pixelStorei(3333,4);b.readPixels(h,k,m,N,6408,5121,g);return g}}},{"./util/is-typed-array":26}],16:[function(f,h,m){var e=f("./util/values");h.exports=
function(b,a,d){function f(){this.id=m++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function g(a){b.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=b.createRenderbuffer());b.bindRenderbuffer(36161,a.renderbuffer);b.renderbufferStorage(36161,a.format,a.width,a.height)}function h(a){var d=a.renderbuffer;b.bindRenderbuffer(36161,null);b.isRenderbuffer(d)&&b.deleteRenderbuffer(d);a.renderbuffer=null;a.refCount=0;delete N[a.id]}var k={rgba4:32854,rgb565:36194,"rgb5 a1":32855,
depth:33189,stencil:36168,"depth stencil":34041};a.ext_srgb&&(k.srgba=35907);a.ext_color_buffer_half_float&&(k.rgba16f=34842,k.rgb16f=34843);a.webgl_color_buffer_float&&(k.rgba32f=34836);var m=0,N={};f.prototype.decRef=function(){0===--this.refCount&&h(this)};return{create:function(a){function b(a){a=a||{};var e=0,f=0;"shape"in a?(f=a.shape,e=f[0]|0,f=f[1]|0):("radius"in a&&(e=f=a.radius|0),"width"in a&&(e=a.width|0),"height"in a&&(f=a.height|0));b.width=d.width=Math.max(e,1);b.height=d.height=Math.max(f,
1);d.format=32854;"format"in a&&(d.format=k[a.format]);g(d);return b}var d=new f;N[d.id]=d;b(a);b._reglType="renderbuffer";b._renderbuffer=d;b.destroy=function(){d.decRef()};return b},refresh:function(){e(N).forEach(g)},clear:function(){e(N).forEach(h)}}}},{"./util/values":32}],17:[function(f,h,m){function e(a,b,e,f){this.name=a;this.id=b;this.location=e;this.info=f}var b=f("./util/values");h.exports=function(a,d,f,g,h){function k(c,b){var d=35632===c?z:n,e=d[b];if(!e){var f=h.str(b),e=a.createShader(c);
a.shaderSource(e,f);a.compileShader(e);d[b]=e}return e}function m(a,c){this.fragId=a;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[];this.draw=function(){};this.batchCache={}}function N(c){var b,n;b=k(35632,c.fragId);n=k(35633,c.vertId);var m=c.program=a.createProgram();a.attachShader(m,b);a.attachShader(m,n);a.linkProgram(m);var C=a.getProgramParameter(m,35718),r=c.uniforms=[];for(b=0;b<C;++b)if(n=a.getActiveUniform(m,b))if(1<n.size)for(var z=0;z<n.size;++z){var I=n.name.replace("[0]",
"["+z+"]");f.def(I);r.push(new e(I,h.id(I),a.getUniformLocation(m,I),n))}else f.def(n.name),r.push(new e(n.name,h.id(n.name),a.getUniformLocation(m,n.name),n));C=a.getProgramParameter(m,35721);r=c.attributes=[];for(b=0;b<C;++b)if(n=a.getActiveAttrib(m,b))d.def(n.name),r.push(new e(n.name,h.id(n.name),a.getAttribLocation(m,n.name),n));c.draw=g(c);c.batchCache={}}var z={},n={},C={},c=[];return{clear:function(){var d=a.deleteShader.bind(a);b(z).forEach(d);z={};b(n).forEach(d);n={};c.forEach(function(c){a.deleteProgram(c.program)});
c.length=0;C={}},refresh:function(){z={};n={};c.forEach(N)},program:function(a,b){var d=C[b];d||(d=C[b]={});var e=d[a];e||(e=new m(b,a),N(e),d[a]=e,c.push(e));return e},shader:k,frag:[-1],vert:[-1]}}},{"./util/values":32}],18:[function(f,h,m){var e=f("./util/stack"),b=f("./util/codegen");h.exports=function(a,d,f){function g(b,d){var c=e([!!d],function(c){c?a.enable(b):a.disable(b)});c.flag=b;return c}var h={dither:g(3024),"blend.enable":g(3042),"blend.color":e([0,0,0,0],function(b,d,c,e){a.blendColor(b,
d,c,e)}),"blend.equation":e([32774,32774],function(b,d){a.blendEquationSeparate(b,d)}),"blend.func":e([1,0,1,0],function(b,d,c,e){a.blendFuncSeparate(b,d,c,e)}),"depth.enable":g(2929,!0),"depth.func":e([513],function(b){a.depthFunc(b)}),"depth.range":e([0,1],function(b,d){a.depthRange(b,d)}),"depth.mask":e([!0],function(b){a.depthMask(b)}),"cull.enable":g(2884),"cull.face":e([1029],function(b){a.cullFace(b)}),frontFace:e([2305],function(b){a.frontFace(b)}),colorMask:e([!0,!0,!0,!0],function(b,d,c,
e){a.colorMask(b,d,c,e)}),lineWidth:e([1],function(b){a.lineWidth(b)}),"polygonOffset.enable":g(32823),"polygonOffset.offset":e([0,0],function(b,d){a.polygonOffset(b,d)}),"sample.alpha":g(32926),"sample.enable":g(32928),"sample.coverage":e([1,!1],function(b,d){a.sampleCoverage(b,d)}),"stencil.enable":g(2960),"stencil.mask":e([-1],function(b){a.stencilMask(b)}),"stencil.func":e([519,0,-1],function(b,d,c){a.stencilFunc(b,d,c)}),"stencil.opFront":e([7680,7680,7680],function(b,d,c){a.stencilOpSeparate(1028,
b,d,c)}),"stencil.opBack":e([7680,7680,7680],function(b,d,c){a.stencilOpSeparate(1029,b,d,c)}),"scissor.enable":g(3089),"scissor.box":e([0,0,-1,-1],function(b,e,c,f){var g=c,k=d.top();0>c&&(g=k?k.width-b:a.drawingBufferWidth-b);c=f;0>f&&(c=k?k.height-e:a.drawingBufferHeight-e);a.scissor(b,e,g,c)}),viewport:e([0,0,-1,-1],function(b,e,c,g){var k=c,h=d.top();0>c&&(k=h?h.width-b:a.drawingBufferWidth-b);c=g;0>g&&(c=h?h.height-e:a.drawingBufferHeight-e);a.viewport(b,e,k,c);f.width=k;f.height=c})},k=b(),
m=k.proc("poll"),N=k.proc("refresh");Object.keys(h).forEach(function(a){a=k.link(h[a]);m(a,".poll();");N(a,".setDirty();")});var z=k.compile();return{contextState:h,viewport:f,poll:z.poll,refresh:z.refresh,notifyViewportChanged:function(){h.viewport.setDirty();h["scissor.box"].setDirty()}}}},{"./util/codegen":23,"./util/stack":30}],19:[function(f,h,m){h.exports=function(){var e={"":0},b=[""];return{id:function(a){var d=e[a];if(d)return d;d=e[a]=b.length;b.push(a);return d},str:function(a){return b[a]}}}},
{}],20:[function(f,h,m){function e(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function b(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var d=a[0].length,e=1;e<b;++e)if(!Array.isArray(a[e])||a[e].length!==d)return!1;return!0}function a(a){return Object.prototype.toString.call(a)}function d(b){return"[object HTMLCanvasElement]"===a(b)}function K(b){return"[object CanvasRenderingContext2D]"===a(b)}var g=f("./util/extend"),A=f("./util/values"),
k=f("./util/is-typed-array"),I=f("./util/is-ndarray"),N=f("./util/load-texture"),z=f("./util/to-half-float"),n=f("./util/parse-dds"),C=[9984,9986,9985,9987];h.exports=function(c,f,h,m,D){function ba(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=this.miplevel=0;this.copy=!1;this.crossOrigin=
this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function r(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function O(a,b){var c,d,e=0,f=0,g=0,k=0,h=0,r=0,x=!1,l=!1,n=!1;for(c=0;c<b.length;++c)d=b[c],k=k||d.width<<d.miplevel,h=h||d.height<<d.miplevel,e=e||d.type,f=f||d.format,g=g||d.internalformat,
r=r||d.channels,x=x||d.needsPoll,l=l||d.needsListeners,d=d.miplevel,n=n||0<d;a.needsPoll=x;a.needsListeners=l;a.width=k;a.height=h;a.format=f;a.internalformat=g;a.type=e;if(3553!==a.target)for(c=0;6>c;++c);c=0<=C.indexOf(a.minFilter);a.genMipmaps=!n&&(a.genMipmaps||c);n=n||a.genMipmaps;a.minFilter||(a.minFilter=n?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(c=0;c<b.length;++c)d=b[c],d.channels||(d.channels=r),d.format||(d.format=f),d.internalformat||(d.internalformat=g),d.type||(d.type=
e)}function U(a){this.id=p++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new r(a);this.pixels=[]}function ma(a,b){function c(a,d){var e=d.mipmap,q;if(Array.isArray(e))for(var g=0;g<e.length;++g)q=new ba(a),q.parseFlags(b),q.parseFlags(d),q.parse(e[g],g),f.push(q);else q=new ba(a),q.parseFlags(b),q.parse(d,0),f.push(q)}var d;Z(a);var e=a.params;r.call(e,a.target);var f=a.pixels;f.length=0;e.parse(b);if(3553===a.target)c(3553,
b);else{var g=b.faces||b;if(Array.isArray(g))for(d=0;6>d;++d)c(34069+d,g[d]);else if("string"!==typeof g)for(d=0;6>d;++d)c(34069+d,{})}O(e,f);e.needsListeners&&ka(a);e.needsPoll&&(a.pollId=G.length,G.push(a));V(a)}function V(a){c.isTexture(a.texture)||(a.texture=c.createTexture());var b=a.target,d=a.unit;0<=d?(c.activeTexture(33984+d),F=d):c.bindTexture(b,a.texture);for(var b=a.pixels,e=a.params,f=0;f<b.length;++f)b[f].upload(e);e.upload();0>d&&((d=y[F])?c.bindTexture(d.target,d.texture):(a.unit=
F,y[F]=a))}function ka(a){function b(a,c,d){var f=n(d);f.pixels.forEach(function(b){var d=new ba(f.cube?b.target:a);d.channels=f.channels;d.compressed=f.compressed;d.type=f.type;d.internalformat=f.format;d.format=sa[f.format];d.width=b.width;d.height=b.height;d.miplevel=b.miplevel||c;d.data=b.data;e.push(d)})}function c(){for(var f=0;f<e.length;++f){var g=e[f],k=g.image,h=g.video,fa=g.xhr;k&&k.complete?(g.width=k.naturalWidth,g.height=k.naturalHeight):h&&2<h.readyState?(g.width=h.width,g.height=h.height):
fa&&4===fa.readyState&&(e[f]=e[e.length-1],e.pop(),fa.removeEventListener("readystatechange",V),b(g.target,g.miplevel,fa.response))}O(d,e);V(a)}var d=a.params,e=a.pixels;e.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){e.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",
c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function Z(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((G[b]=G[G.length-1]).id=b,G.pop(),a.pollId=-1)}function L(a){var b=a.texture,d=a.unit,e=a.target;0<=d&&(c.activeTexture(33984+d),F=d,c.bindTexture(e,null),y[d]=null);Z(a);c.isTexture(b)&&c.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete u[a.id]}var t={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
Q={repeat:10497,clamp:33071,mirror:33648},na={nearest:9728,linear:9729},T=g({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},na),ga={none:0,browser:37444},W={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},X={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ea={};f.ext_srgb&&(X.srgb=35904,X.srgba=35906);f.oes_texture_float&&(W["float"]=5126);f.oes_texture_half_float&&
(W["half float"]=36193);f.webgl_depth_texture&&(g(X,{depth:6402,"depth stencil":34041}),g(W,{uint16:5123,uint32:5125,"depth stencil":34042}));f.webgl_compressed_texture_s3tc&&g(ea,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});f.webgl_compressed_texture_atc&&g(ea,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});f.webgl_compressed_texture_pvrtc&&g(ea,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});f.webgl_compressed_texture_etc1&&(ea["rgb etc1"]=36196);var ia=Array.prototype.slice.call(c.getParameter(34467));Object.keys(ea).forEach(function(a){var b=ea[a];0<=ia.indexOf(b)&&(X[a]=b)});var B=Object.keys(X);h.textureFormats=B;var sa=B.reduce(function(a,b){var c=X[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});g(ba.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=ga[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=X[b];b in W&&(this.type=W[b]);b in ea&&(this.compressed=!0)}"type"in a&&(this.type=W[a.type]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),
"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(c,f){this.miplevel=f;this.width>>=f;this.height>>=f;var g=c;switch(typeof c){case "object":if(!c)return;
this.parseFlags(c);var h=c.data;if("string"===typeof h||h&&(k(h)||e(h)||I(h)||d(h)||K(h)||"[object HTMLImageElement]"===a(h)||"[object HTMLVideoElement]"===a(h)||b(h)))g=c.data;break;case "undefined":return}"string"===typeof g&&(g=N(g,this.crossOrigin));var h=null,r=!1;if(null!==g)if(k(g))this.data=g;else if(e(g))h=g,r=!0;else if(I(g)){Array.isArray(g.data)?(h=g.data,r=!0):this.data=g.data;var l=g.shape;this.width=l[0];this.height=l[1];this.channels=3===l.length?l[2]:1;l=g.stride;this.strideX=g.stride[0];
this.strideY=g.stride[1];this.strideC=3===l.length?g.stride[2]:1;this.offset=g.offset;this.needsTranspose=!0}else if(d(g)||K(g))d(g)?this.canvas=g:this.canvas=g.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===a(g))this.image=g,g.complete?(this.width=g.naturalWidth,this.height=g.naturalHeight):(this.width=this.width||g.naturalWidth,this.height=this.height||g.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===a(g))this.video=g,1<g.readyState?(this.width=g.width,this.height=g.height):(this.width=this.width||g.width,this.height=this.height||g.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===a(g))this.xhr=g,this.needsListeners=!0;else if(b(g)){var r=g[0].length,l=g.length,n=1,p,m,A,x;if(Array.isArray(g[0][0]))for(n=g[0][0].length,h=Array(r*l*n),m=x=0;m<l;++m)for(p=0;p<r;++p)for(A=0;A<n;++A)h[x++]=g[m][p][A];
else for(h=Array(r*l),m=x=0;m<l;++m)for(p=0;p<r;++p)h[x++]=g[m][p];this.width=r;this.height=l;this.channels=n;r=!0}else c.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||D.width)|0,this.height=(this.height||D.height)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=[6409,
6410,6407,6408][(this.channels=this.channels||4)-1]);g=this.internalformat;l=this.format=sa[g];if(!this.channels)switch(l){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}l=this.type;5126!==l&&36193!==l&&(l||(l=6402===g?5125:5121));this.type=l;if(r)switch(l){case 5121:this.data=new Uint8Array(h);break;case 5123:this.data=new Uint16Array(h);break;case 5125:this.data=new Uint32Array(h);break;case 5126:this.data=
new Float32Array(h);break;case 36193:this.data=z(h)}if(this.data&&this.needsTranspose){h=this.data;g=this.width;r=this.height;l=this.channels;n=this.strideX;p=this.strideY;m=this.strideC;A=this.offset;x=new h.constructor(g*r*l);for(var t=0,u=0;u<r;++u)for(var v=0;v<g;++v)for(var y=0;y<l;++y)x[t++]=h[p*u+n*v+m*y+A];this.data=x}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){c.pixelStorei(37440,
this.flipY);c.pixelStorei(37441,this.premultiplyAlpha);c.pixelStorei(37443,this.colorSpace);c.pixelStorei(3317,this.unpackAlignment);var b=this.target,d=this.miplevel,e=this.image,g=this.canvas,f=this.video,h=this.data,k=this.internalformat,l=this.format,r=this.type,n=this.width||Math.max(1,a.width>>d);a=this.height||Math.max(1,a.height>>d);f&&2<f.readyState?c.texImage2D(b,d,l,l,r,f):e&&e.complete?c.texImage2D(b,d,l,l,r,e):g?c.texImage2D(b,d,l,l,r,g):this.compressed?c.compressedTexImage2D(b,d,k,n,
a,0,h):this.copy?(m(),c.copyTexImage2D(b,d,l,this.x,this.y,n,a,0)):h?c.texImage2D(b,d,l,n,a,0,l,r,h):c.texImage2D(b,d,l,n||1,a||1,0,l,r,null)}});g(r.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=T[a.min]);"mag"in a&&(this.magFilter=na[a.mag]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var d=a.wrap;"string"===typeof d?b=c=Q[d]:Array.isArray(d)&&(b=Q[d[0]],c=Q[d[1]])}else"wrapS"in a&&(b=Q[a.wrapS]),"wrapT"in a&&(c=Q[a.wrapT]);this.wrapS=b;this.wrapT=c;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=t[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;c.texParameteri(a,10241,this.minFilter);c.texParameteri(a,10240,this.magFilter);c.texParameteri(a,10242,this.wrapS);c.texParameteri(a,10243,this.wrapT);f.ext_texture_filter_anisotropic&&c.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(c.hint(33170,this.mipmapHint),c.generateMipmap(a))}});
var F=0,p=0,u={},G=[],ha=h.maxTextureUnits,y=Array(ha).map(function(){return null});g(U.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<ha;++b){var d=y[b];if(d){if(0<d.bindCount)continue;d.unit=-1}y[b]=this;a=b;break}this.unit=a;c.activeTexture(33984+a);c.bindTexture(this.target,this.texture);F=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&L(this)}});return{create:function(a,b){function c(a,e,g,f,h,k){var l=a||{};34067===
b&&6===arguments.length&&(l=[a,e,g,f,h,k]);ma(d,l);c.width=d.params.width;c.height=d.params.height;return c}var d=new U(b);u[d.id]=d;c(a);c._reglType="texture";c._texture=d;c.destroy=function(){d.decRef()};return c},refresh:function(){A(u).forEach(V);for(var a=0;a<ha;++a)y[a]=null;F=0;c.activeTexture(33984)},clear:function(){for(var a=0;a<ha;++a)c.activeTexture(33984+a),c.bindTexture(3553,null),y[a]=null;c.activeTexture(33984);F=0;A(u).forEach(L)},poll:function(){G.forEach(V)},getTexture:function(a){return null}}}},
{"./util/extend":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/load-texture":27,"./util/parse-dds":28,"./util/to-half-float":31,"./util/values":32}],21:[function(f,h,m){h.exports=function(e){var b={};return{def:function(a){a=e.id(a);var d=b[a];d||(d=b[a]=[]);return d},uniforms:b}}},{}],22:[function(f,h,m){h.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],23:[function(f,h,m){var e=f("./extend");h.exports=
function(){function b(){var b=[],d=[];return e(function(){b.push.apply(b,Array.prototype.slice.call(arguments))},{def:function(){var e="v"+a++;d.push(e);0<arguments.length&&(b.push(e,"="),b.push.apply(b,Array.prototype.slice.call(arguments)),b.push(";"));return e},toString:function(){return[0<d.length?"var "+d+";":"",b.join("")].join("")}})}var a=0,d=[],f=[],g={};return{link:function(b){var e="g"+a++;d.push(e);f.push(b);return e},block:b,proc:function(d){var f=[],h=b(),m=h.toString;return g[d]=e(h,
{arg:function(){var b="a"+a++;f.push(b);return b},toString:function(){return["function(",f.join(),"){",m(),"}"].join("")}})},compile:function(){var a=['"use strict";return {'];Object.keys(g).forEach(function(b){a.push('"',b,'":',g[b].toString(),",")});a.push("}");return Function.apply(null,d.concat([a.join("")])).apply(null,f)}}}},{"./extend":24}],24:[function(f,h,m){h.exports=function(e,b){for(var a=Object.keys(b),d=0;d<a.length;++d)e[a[d]]=b[a[d]];return e}},{}],25:[function(f,h,m){var e=f("./is-typed-array");
h.exports=function(b){return!!b&&"object"===typeof b&&Array.isArray(b.shape)&&Array.isArray(b.stride)&&"number"===typeof b.offset&&b.shape.length===b.stride.length&&(Array.isArray(b.data)||e(b.data))}},{"./is-typed-array":26}],26:[function(f,h,m){var e=f("../constants/arraytypes.json");h.exports=function(b){return Object.prototype.toString.call(b)in e}},{"../constants/arraytypes.json":6}],27:[function(f,h,m){h.exports=function(e,b){if("undefined"!==typeof document){var a;a=(a=/\.(\w+)(\?.*)?$/.exec(e))&&
a[1]?a[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(a))return a=document.createElement("video"),a.autoplay=!0,a.loop=!0,b&&(a.crossOrigin=b),a.src=e,a;if(0<=["dds"].indexOf(a))return a=new XMLHttpRequest,a.responseType="arraybuffer",a.open("GET",e,!0),a.send(),a;a=new Image;b&&(a.crossOrigin=b);a.src=e;return a}return null}},{}],28:[function(f,h,m){h.exports=function(f){function h(a){for(var b=t,c=Q,d=0;d<X;++d){var e=Math.max(1,
b+3>>2)*Math.max(1,c+3>>2)*ga;ia.pixels.push({target:a,miplevel:d,width:b,height:c,data:new Uint8Array(f,ea,e)});ea+=e;b>>=1;c>>=1}}var m=new Int32Array(f),L=m[v],t=m[ba],Q=m[D],na=k,T=0,ga=0,W=4;switch(m[U]){case n:ga=8;L&z?(W=3,T=a):T=d;break;case C:ga=16;T=K;break;case c:ga=16;T=g;break;case l:ga=8,T=A}var X=1;m[O]&I&&(X=Math.max(1,m[r]));var ea=m[E]+4,ia={width:t,height:Q,channels:W,format:T,type:na,compressed:!0,cube:!1,pixels:[]};if(m[ma]&N)for(ia.cube=!0,m=0;6>m;++m)h(b+m);else h(e);return ia};
var e=3553,b=34069,a=33776,d=33777,K=33778,g=33779,A=36196,k=5121,I=131072,N=512,z=64,n=827611204,C=861165636,c=894720068,l=826496069,E=1,v=2,D=3,ba=4,r=7,O=20,U=21,ma=28},{}],29:[function(f,h,m){h.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:{next:function(e){setTimeout(e,30)},cancel:clearTimeout}},{}],30:[function(f,h,m){h.exports=function(e,b){var a=
e.length,d=e.slice(),f=e.slice(),g=!1,h=!0;return{push:function(){g=!1;for(var b=0;b<a;++b){var e=arguments[b];g=g||e!==f[b];d.push(e)}},pop:function(){g=!1;d.length-=a;for(var b=0;b<a;++b)g=g||d[d.length-a+b]!==f[b]},poll:function(){var e=d.length-a;if(g||h){switch(a){case 1:b(d[e]);break;case 2:b(d[e],d[e+1]);break;case 3:b(d[e],d[e+1],d[e+2]);break;case 4:b(d[e],d[e+1],d[e+2],d[e+3]);break;case 5:b(d[e],d[e+1],d[e+2],d[e+3],d[e+4]);break;case 6:b(d[e],d[e+1],d[e+2],d[e+3],d[e+4],d[e+5]);break;
default:b.apply(null,d.slice(e,d.length))}for(var m=0;m<a;++m)f[m]=d[e+m];h=g=!1}},setDirty:function(){h=!0}}}},{}],31:[function(f,h,m){h.exports=function(e){for(var b=new Float32Array(e),b=new Uint32Array(b.buffer),a=new Uint16Array(e.length),d=0;d<e.length;++d)if(isNaN(e[d]))a[d]=65535;else if(Infinity===e[d])a[d]=31744;else if(-Infinity===e[d])a[d]=64512;else{var f=b[d],g=f>>>31<<15,h=(f<<1>>>24)-127,f=f>>13&1023;a[d]=-24>h?g:-14>h?g+(f+1024>>-14-h):15<h?g+31744:g+(h+15<<10)+f}return a}},{}],32:[function(f,
h,m){h.exports=function(e){return Object.keys(e).map(function(b){return e[b]})}},{}],33:[function(f,h,m){function e(d,e){function f(){var b=window.innerWidth,e=window.innerHeight;d!==document.body&&(e=d.getBoundingClientRect(),b=e.right-e.left,e=e.top-e.bottom);h.width=m*b;h.height=m*e;a(h.style,{width:b+"px",height:e+"px"})}var h=document.createElement("canvas"),k=b(h,e);a(h.style,{border:0,margin:0,padding:0,top:0,left:0});d.appendChild(h);d===document.body&&(h.style.position="absolute",a(d.style,
{margin:0,padding:0}));var m=+k.options.pixelRatio;window.addEventListener("resize",f,!1);var N=k.options.onDestroy;k.options=a(a({},k.options),{onDestroy:function(){window.removeEventListener("resize",f);d.removeChild(h);N&&N()}});f();return k}function b(b,e){function f(a){try{return b.getContext(a,h)}catch(e){return null}}var h=e.glOptions||{};return{gl:f("webgl")||f("experimental-webgl")||f("webgl-experimental"),options:a({pixelRatio:window.devicePixelRatio},e)}}var a=f("./util/extend");h.exports=
function(d){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:d[0],options:d[1]||{}};var f=document.body,g=d[1]||{};if("string"===typeof d[0])f=document.querySelector(d[0])||document.body;else if("object"===typeof d[0])if(d[0]instanceof HTMLElement)f=d[0];else{if(d[0]instanceof WebGLRenderingContext)return{gl:d[0],options:a({pixelRatio:1},g)};g=d[0]}return f.nodeName&&"CANVAS"===f.nodeName.toUpperCase()?b(f,g):e(f,g)}},{"./util/extend":24}],34:[function(f,h,m){h.exports=
function(b,a){function d(a){var b=!1;"altKey"in a&&(b=b||a.altKey!==v.alt,v.alt=!!a.altKey);"shiftKey"in a&&(b=b||a.shiftKey!==v.shift,v.shift=!!a.shiftKey);"ctrlKey"in a&&(b=b||a.ctrlKey!==v.control,v.control=!!a.ctrlKey);"metaKey"in a&&(b=b||a.metaKey!==v.meta,v.meta=!!a.metaKey);return b}function f(b,g){var h=e.x(g),k=e.y(g);"buttons"in g&&(b=g.buttons|0);if(b!==c||h!==l||k!==E||d(g))c=b|0,l=h||0,E=k||0,a&&a(c,l,E,v)}function g(a){f(0,a)}function h(){if(c||l||E||v.shift||v.alt||v.meta||v.control)c=
l=E=0,v.shift=v.alt=v.control=v.meta=!1,a&&a(0,0,0,v)}function k(b){d(b)&&a&&a(c,l,E,v)}function m(a){0===e.buttons(a)?f(0,a):f(c,a)}function N(a){f(c|e.buttons(a),a)}function z(a){f(c&~e.buttons(a),a)}function n(){D||(D=!0,b.addEventListener("mousemove",m),b.addEventListener("mousedown",N),b.addEventListener("mouseup",z),b.addEventListener("mouseleave",g),b.addEventListener("mouseenter",g),b.addEventListener("mouseout",g),b.addEventListener("mouseover",g),b.addEventListener("blur",h),b.addEventListener("keyup",
k),b.addEventListener("keydown",k),b.addEventListener("keypress",k),b!==window&&(window.addEventListener("blur",h),window.addEventListener("keyup",k),window.addEventListener("keydown",k),window.addEventListener("keypress",k)))}function C(){D&&(D=!1,b.removeEventListener("mousemove",m),b.removeEventListener("mousedown",N),b.removeEventListener("mouseup",z),b.removeEventListener("mouseleave",g),b.removeEventListener("mouseenter",g),b.removeEventListener("mouseout",g),b.removeEventListener("mouseover",
g),b.removeEventListener("blur",h),b.removeEventListener("keyup",k),b.removeEventListener("keydown",k),b.removeEventListener("keypress",k),b!==window&&(window.removeEventListener("blur",h),window.removeEventListener("keyup",k),window.removeEventListener("keydown",k),window.removeEventListener("keypress",k)))}a||(a=b,b=window);var c=0,l=0,E=0,v={shift:!1,alt:!1,control:!1,meta:!1},D=!1;n();var ba={element:b};Object.defineProperties(ba,{enabled:{get:function(){return D},set:function(a){a?n():C},enumerable:!0},
buttons:{get:function(){return c},enumerable:!0},x:{get:function(){return l},enumerable:!0},y:{get:function(){return E},enumerable:!0},mods:{get:function(){return v},enumerable:!0}});return ba};var e=f("mouse-event")},{"mouse-event":35}],35:[function(f,h,m){function e(b){return b.target||b.srcElement||window}m.buttons=function(b){if("object"===typeof b){if("buttons"in b)return b.buttons;if("which"in b){b=b.which;if(2===b)return 4;if(3===b)return 2;if(0<b)return 1<<b-1}else if("button"in b){b=b.button;
if(1===b)return 4;if(2===b)return 2;if(0<=b)return 1<<b}}return 0};m.element=e;m.x=function(b){if("object"===typeof b){if("offsetX"in b)return b.offsetX;var a=e(b).getBoundingClientRect();return b.clientX-a.left}return 0};m.y=function(b){if("object"===typeof b){if("offsetY"in b)return b.offsetY;var a=e(b).getBoundingClientRect();return b.clientY-a.top}return 0}},{}],36:[function(f,h,m){var e=f("./lib/util/extend"),b=f("./lib/webgl"),a=f("./lib/strings"),d=f("./lib/extension"),K=f("./lib/limits"),
g=f("./lib/buffer"),A=f("./lib/elements"),k=f("./lib/texture"),I=f("./lib/renderbuffer"),N=f("./lib/framebuffer"),z=f("./lib/uniform"),n=f("./lib/attribute"),C=f("./lib/shader"),c=f("./lib/draw"),l=f("./lib/state"),E=f("./lib/compile"),v=f("./lib/read"),D=f("./lib/dynamic"),ba=f("./lib/util/raf"),r=f("./lib/util/clock");h.exports=function(){function f(){aa=ba.next(f);y.count+=1;q.count=y.count;if(y.width!==t.drawingBufferWidth||y.height!==t.drawingBufferHeight)q.viewportWidth=q.drawingBufferWidth=
y.width=t.drawingBufferWidth,q.viewportHeight=q.drawingBufferHeight=y.height=t.drawingBufferHeight,R.notifyViewportChanged();var a=r();y.dt=a-y.t;y.t=a;q.deltaTime=y.dt/1E3;q.time=(a-ha)/1E3;p.poll();for(var b=0;b<Y.length;++b)(0,Y[b])(null,q);y.renderTime=r()-a}function h(){aa&&(ba.cancel(f),aa=0)}function m(a){h();a.preventDefault();if(Q.onContextLost)Q.onContextLost()}function V(a){t.getError();na.refresh();X.refresh();p.refresh();u.refresh();G.refresh();sa.refresh();R.refresh();if(Q.onContextRestored)Q.onContextRestored();
f()}function ka(a){function b(a){var c={},e={};Object.keys(a).forEach(function(b){var f=a[b];D.isDynamic(f)?(d=!0,e[b]=D.unbox(f,b)):c[b]=f});return{dynamic:e,"static":c}}function c(a){for(;n.length<a;)n.push(null);return n}var d=!1,f=b(a.context||{}),g=b(a.uniforms||{}),h=b(a.attributes||{});a=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=e({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");
b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var f=fa.command(a["static"],g["static"],h["static"],a.dynamic,g.dynamic,h.dynamic,f,d),k=f.draw,l=f.batch,m=f.scope,n=[];return function(a,b){return"function"===typeof a?m.call(this,null,a):"function"===typeof b?m.call(this,a,b):"number"===typeof a?l.call(this,a|0,c(a|0)):Array.isArray(a)?l.call(this,a.length,a):k.call(this,a)}}function Z(){G.poll();R.poll()}var L=b(Array.prototype.slice.call(arguments)),t=L.gl,Q=L.options,
L=a(),na=d(t),T=na.extensions,ga={width:t.drawingBufferWidth,height:t.drawingBufferHeight},W=K(t,T),X=g(t,function(a){for(var b=0;b<B.bindings.length;++b){var c=B.bindings[b];c.pointer&&c.buffer===a&&(c.pointer=!1,c.buffer=null,c.x=c.y=c.z=c.w=NaN,t.disableVertexAttribArray(b))}}),ea=A(t,T,X),ia=z(L),B=n(t,T,W,X,L),sa=C(t,B,ia,function(a){return fa.draw(a)},L),F=c(t,T,X),p=k(t,T,W,Z,ga),u=I(t,T,W),G=N(t,T,W,p,u),ha=r(),y={count:0,start:ha,dt:0,t:ha,renderTime:0,width:t.drawingBufferWidth,height:t.drawingBufferHeight,
pixelRatio:Q.pixelRatio},q={count:0,batchId:0,deltaTime:0,time:0,viewportWidth:y.width,viewportHeight:y.height,drawingBufferWidth:y.width,drawingBufferHeight:y.height,pixelRatio:y.pixelRatio},R=l(t,G,ga),ga=v(t,Z,ga),fa=E(t,L,T,W,X,ea,p,G,R,ia,B,sa,F,q,Z),M=t.canvas,Y=[],aa=0;M&&(M.addEventListener("webglcontextlost",m,!1),M.addEventListener("webglcontextrestored",V,!1));return e(ka,{clear:function(a){var b=0;Z();var c=a.color;c&&(t.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in
a&&(t.clearDepth(+a.depth),b|=256);"stencil"in a&&(t.clearStencil(a.stencil|0),b|=1024);t.clear(b)},prop:D.define.bind(null,1),context:D.define.bind(null,2),"this":D.define.bind(null,3),draw:ka({}),elements:function(a){return ea.create(a)},buffer:function(a){return X.create(a,34962)},texture:function(a){return p.create(a,3553)},cube:function(a){return 6===arguments.length?p.create(Array.prototype.slice.call(arguments),34067):p.create(a,34067)},renderbuffer:function(a){return u.create(a)},framebuffer:function(a){return G.create(a)},
framebufferCube:function(a){},frame:function(a){Y.push(a);!aa&&0<Y.length&&f();return{cancel:function(){var b=Y.find(function(b){return b===a});0>b||(Y.splice(b,1),0>=Y.length&&h())}}},stats:y,limits:W,read:ga,destroy:function(){h();M&&(M.removeEventListener("webglcontextlost",m),M.removeEventListener("webglcontextrestored",V));sa.clear();G.clear();u.clear();p.clear();X.clear();if(Q.onDestroy)Q.onDestroy()}})}},{"./lib/attribute":3,"./lib/buffer":4,"./lib/compile":5,"./lib/draw":9,"./lib/dynamic":10,
"./lib/elements":11,"./lib/extension":12,"./lib/framebuffer":13,"./lib/limits":14,"./lib/read":15,"./lib/renderbuffer":16,"./lib/shader":17,"./lib/state":18,"./lib/strings":19,"./lib/texture":20,"./lib/uniform":21,"./lib/util/clock":22,"./lib/util/extend":24,"./lib/util/raf":29,"./lib/webgl":33}]},{},[2]);
