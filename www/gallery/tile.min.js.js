(function e$$0(m,t,d){function a(c,e){if(!t[c]){if(!m[c]){var f="function"==typeof require&&require;if(!e&&f)return f(c,!0);if(k)return k(c,!0);f=Error("Cannot find module '"+c+"'");throw f.code="MODULE_NOT_FOUND",f;}f=t[c]={exports:{}};m[c][0].call(f.exports,function(e){var d=m[c][1][e];return a(d?d:e)},f,f.exports,e$$0,m,t,d)}return t[c].exports}for(var k="function"==typeof require&&require,f=0;f<d.length;f++)a(d[f]);return a})({1:[function(h,m,t){var d=h("../regl")(),a=h("mouse-change")();h("resl")({manifest:{map:{type:"text",
src:"assets/map.json",parser:JSON.parse},tiles:{type:"image",src:"assets/tiles.png",parser:d.texture}},onDone:function(k){var f=k.map,c=d({frag:"\n      precision mediump float;\n      uniform sampler2D map, tiles;\n      uniform vec2 mapSize, tileSize;\n      varying vec2 uv;\n      void main() {\n        vec2 tileCoord = floor(255.0 * texture2D(map, floor(uv) / mapSize).ra);\n        gl_FragColor = texture2D(tiles, (tileCoord + fract(uv)) / tileSize);\n      }",vert:"\n      precision mediump float;\n      attribute vec2 position;\n      uniform vec4 view;\n      varying vec2 uv;\n      void main() {\n        uv = mix(view.xw, view.zy, 0.5 * (1.0 + position));\n        gl_Position = vec4(position, 1, 1);\n      }",
depth:{enable:!1},uniforms:{tiles:k.tiles,tileSize:[16,16],map:d.texture(f),mapSize:[f[0].length,f.length],view:d.prop("view")},attributes:{position:[-1,-1,1,-1,-1,1,1,1,-1,1,1,-1]},count:6});d.frame(function(e){var d=e.viewportWidth,k=e.viewportHeight;e=f[0].length*a.x/d;var h=f.length*a.y/k,d=d/k*10;c({view:[e-.5*d,h-5,e+.5*d,h+5]})})}})},{"../regl":32,"mouse-change":30,resl:33}],2:[function(h,m,t){function d(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=
!1;this.type=5126;this.divisor=this.stride=this.offset=0}m.exports=function(a,k,f,c,e){a=f.maxAttributes;k=Array(a);for(f=0;f<a;++f)k[f]=new d;return{Record:d,scope:{},state:k}}},{}],3:[function(h,m,t){function d(a){return R[Object.prototype.toString.call(a)]|0}function a(a,e){for(var c=0;c<e.length;++c)a[c]=e[c]}function k(a,c,e,d,f,b,k){for(var h=0,B=0;B<e;++B)for(var v=0;v<d;++v)a[h++]=c[f*B+b*v+k]}function f(a,c,e){for(var d=0,f=0;f<c.length;++f)for(var b=c[f],k=0;k<e;++k)a[d++]=b[k]}var c=h("./util/is-typed-array"),
e=h("./util/is-ndarray"),y=h("./util/values"),I=h("./util/pool"),R=h("./constants/arraytypes.json"),A=h("./constants/dtypes.json"),x=h("./constants/usage.json");m.exports=function(q){function h(a){this.id=b++;this.buffer=q.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121}function w(a,c,e){a.byteLength=c.byteLength;q.bufferData(a.type,c,e)}function r(b,v,p,q,h){b.usage=p;if(Array.isArray(v))b.dtype=q||5126,0<v.length&&(Array.isArray(v[0])?(b.dimension=
v[0].length,q=I.allocType(b.dtype,v.length*b.dimension),f(q,v,b.dimension),w(b,q,p),I.freeType(q)):"number"===typeof v[0]?(b.dimension=h,q=I.allocType(b.dtype,v.length),a(q,v),w(b,q,p),I.freeType(q)):c(v[0])&&(b.dimension=v[0].length,b.dtype=q||d(v[0])||5126,q=I.allocType(b.dtype,v.length*b.dimension),f(q,v,b.dimension),w(b,q,p),I.freeType(q)));else if(c(v))b.dtype=q||d(v),b.dimension=h,w(b,v,p);else if(e(v)){var z=v.shape,y=v.stride;h=v.offset;var F=0,r=0,G=0,S=0;1===z.length?(F=z[0],r=1,G=y[0],
S=0):2===z.length&&(F=z[0],r=z[1],G=y[0],S=y[1]);b.dtype=q||d(v.data)||5126;b.dimension=r;q=I.allocType(b.dtype,F*r);k(q,v.data,F,r,G,S,h);w(b,q,p);I.freeType(q)}}function p(a){var b=a.buffer;q.isBuffer(b)&&q.deleteBuffer(b);a.buffer=null;delete G[a.id]}var b=0,G={};h.prototype.bind=function(){q.bindBuffer(this.type,this.buffer)};var m=[];return{create:function(b,v,y){function w(a){var b=35044,d=null,f=0,v=0,k=1;Array.isArray(a)||c(a)||e(a)?d=a:"number"===typeof a?f=a|0:a&&("data"in a&&(d=a.data),
"usage"in a&&(b=x[a.usage]),"type"in a&&(v=A[a.type]),"dimension"in a&&(k=a.dimension|0),"length"in a&&(f=a.length|0));m.bind();d?r(m,d,b,v,k):(q.bufferData(m.type,f,b),m.dtype=v||5121,m.usage=b,m.dimension=k,m.byteLength=f);return w}var m=new h(v);G[m.id]=m;y||w(b);w._reglType="buffer";w._buffer=m;w.subdata=function(b,v){var p=(v||0)|0;m.bind();if(Array.isArray(b)){if(0<b.length)if("number"===typeof b[0]){var h=I.allocType(m.dtype,b.length);a(h,b);q.bufferSubData(m.type,p,h);I.freeType(h)}else if(Array.isArray(b[0])||
c(b[0])){var h=b[0].length,y=I.allocType(m.dtype,b.length*h);f(y,b,h);q.bufferSubData(m.type,p,y);I.freeType(y)}}else if(c(b))q.bufferSubData(m.type,p,b);else if(e(b)){var r=b.shape,B=b.stride,G=y=h=0,L=0;1===r.length?(h=r[0],y=1,G=B[0],L=0):2===r.length&&(h=r[0],y=r[1],G=B[0],L=B[1]);r=Array.isArray(b.data)?m.dtype:d(b.data);r=I.allocType(r,h*y);k(r,b.data,h,y,G,L,b.offset);q.bufferSubData(m.type,p,r);I.freeType(r)}return w};w.destroy=function(){p(m)};return w},createStream:function(a,b){var c=m.pop();
c||(c=new h(a),c.buffer=q.createBuffer());c.bind();r(c,b,35040,0,1);return c},destroyStream:function(a){m.push(a)},clear:function(){y(G).forEach(p)},getBuffer:function(a){return a&&a._buffer instanceof h?a._buffer:null},_initBuffer:r}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/pool":25,"./util/values":28}],4:[function(h,m,t){m.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,
"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(h,m,t){m.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(h,m,t){m.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(h,
m,t){m.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(h,m,t){function d(a){return Array.isArray(a)||R(a)||A(a)}function a(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function k(a,b,c,e){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=e}function f(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function c(a){return new k(!1,!1,!1,a)}function e(a,b){var c=a.type;return 0===c?(c=a.data.length,new k(!0,1<=c,2<=c,b)):new k(3===
c,2===c,1===c,b)}var y=h("./util/codegen"),I=h("./util/loop"),R=h("./util/is-typed-array"),A=h("./util/is-ndarray"),x=h("./constants/primitives.json"),q=h("./constants/dtypes.json"),L=["x","y","z","w"],w={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,
"src alpha saturate":776},r={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},p={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},b={cw:2304,ccw:2305},G=new k(!1,!1,!1,function(){});m.exports=function(h,m,v,P,C,A,z,da,F,aa,V,S,t){function O(n){return n.replace(".","_")}function J(n,a,b){var c=O(n);u.push(n);
D[c]=g[c]=!!b;ia[c]=a}function K(n,a,b){var c=O(n);u.push(n);Array.isArray(b)?(g[c]=b.slice(),D[c]=b.slice()):g[c]=D[c]=b;ja[c]=a}function ea(){var a=y(),b=a.link,c=a.global;a.id=Fa++;a.batchId="0";var e=b(Ea),d=a.shared={props:"a0"};Object.keys(Ea).forEach(function(l){d[l]=c.def(e,".",l)});var E=a.next={},Ga=a.current={};Object.keys(ja).forEach(function(l){Array.isArray(g[l])&&(E[l]=c.def(d.next,".",l),Ga[l]=c.def(d.current,".",l))});var l=a.constants={};Object.keys(ya).forEach(function(a){l[a]=
c.def(JSON.stringify(ya[a]))});a.invoke=function(l,g){switch(g.type){case 0:var c=["this",d.context,d.props,a.batchId];return l.def(b(g.data),".call(",c.slice(0,Math.max(g.data.length+1,4)),")");case 1:return l.def(d.props,g.data);case 2:return l.def(d.context,g.data);case 3:return l.def("this",g.data)}};a.attribCache={};var Ca={};a.scopeAttrib=function(l){l=m.id(l);if(l in Ca)return Ca[l];var a=aa.scope[l];a||(a=aa.scope[l]=new pa);return Ca[l]=b(a)};return a}function ba(a){var g=a["static"];a=a.dynamic;
if("framebuffer"in g){var b=g.framebuffer;return b?(b=da.getFramebuffer(b),c(function(a,g){var n=a.link(b),l=a.shared;g.set(l.framebuffer,".next",n);l=l.context;g.set(l,".framebufferWidth",n+".width");g.set(l,".framebufferHeight",n+".height");return n})):c(function(a,g){var n=a.shared;g.set(n.framebuffer,".next","null");n=n.context;g.set(n,".framebufferWidth",n+".drawingBufferWidth");g.set(n,".framebufferHeight",n+".drawingBufferHeight");return null})}if("framebuffer"in a){var d=a.framebuffer;return e(d,
function(a,g){var n=a.invoke(g,d),l=a.shared,b=l.framebuffer,n=g.def(b,".getFramebuffer(",n,")");g.set(b,".next",n);l=l.context;g.set(l,".framebufferWidth",n+"?"+n+".width:"+l+".drawingBufferWidth");g.set(l,".framebufferHeight",n+"?"+n+".height:"+l+".drawingBufferHeight");return n})}return null}function ka(a,g){function b(l){if(l in c){var a=c[l];l=!0;var n=a.x|0,E=a.y|0,wa,f;"w"in a?wa=a.w|0:l=!1;"h"in a?f=a.h|0:l=!1;return new k(l&&g&&g.thisDep,l&&g&&g.contextDep,l&&g&&g.propDep,function(l,g){var b=
l.shared.context,c=wa;"w"in a||(c=g.def(b,".","framebufferWidth","-",n));var H=f;"h"in a||(H=g.def(b,".","framebufferHeight","-",E));return[n,E,c,H]})}if(l in d){var q=d[l];l=e(q,function(l,a){var g=l.invoke(a,q),n=l.shared.context,b=a.def(g,".x|0"),c=a.def(g,".y|0"),H=a.def('"w" in ',g,"?",g,".w|0:","(",n,".","framebufferWidth","-",b,")"),g=a.def('"h" in ',g,"?",g,".h|0:","(",n,".","framebufferHeight","-",c,")");return[b,c,H,g]});g&&(l.thisDep=l.thisDep||g.thisDep,l.contextDep=l.contextDep||g.contextDep,
l.propDep=l.propDep||g.prpoDep);return l}return g?new k(g.thisDep,g.contextDep,g.propDep,function(l,a){var g=l.shared.context;return[0,0,a.def(g,".","framebufferWidth"),a.def(g,".","framebufferHeight")]}):null}var c=a["static"],d=a.dynamic,E=b("viewport");if(E)var f=E,E=new k(E.thisDep,E.contextDep,E.propDep,function(l,a){var g=f.append(l,a),n=l.shared.context;a.set(n,".viewportWidth",g[2]);a.set(n,".viewportHeight",g[3]);return g});return{viewport:E,scissor_box:b("scissor.box")}}function la(a){function g(l){if(l in
b){var a=m.id(b[l]);l=c(function(){return a});l.id=a;return l}if(l in d){var n=d[l];return e(n,function(l,a){var g=l.invoke(a,n);return a.def(l.shared.strings,".id(",g,")")})}return null}var b=a["static"],d=a.dynamic,M=g("frag"),E=g("vert"),q=null;f(M)&&f(E)?(q=V.program(E.id,M.id),a=c(function(l,a){return l.link(q)})):a=new k(M&&M.thisDep||E&&E.thisDep,M&&M.contextDep||E&&E.contextDep,M&&M.propDep||E&&E.propDep,function(l,a){var g=l.shared.shader,n;n=M?M.append(l,a):a.def(g,".","frag");var b;b=E?
E.append(l,a):a.def(g,".","vert");return a.def(g+".program("+b+","+n+")")});return{frag:M,vert:E,progVar:a,program:q}}function sa(a){function g(a,l){if(a in b){var n=b[a]|0;return c(function(a,g){l&&(a.OFFSET=n);return n})}if(a in q){var H=q[a];return e(H,function(a,g){var n=a.invoke(g,H);l&&(a.OFFSET=n);return n})}return l&&M?c(function(a,l){a.OFFSET="0";return 0}):null}var b=a["static"],q=a.dynamic,M=function(){if("elements"in b){var a=b.elements;d(a)?a=A.getElements(A.create(a)):a&&(a=A.getElements(a));
var l=c(function(l,g){if(a){var n=l.link(a);return l.ELEMENTS=n}return l.ELEMENTS=null});l.value=a;return l}if("elements"in q){var g=q.elements;return e(g,function(a,l){var n=a.shared,b=n.isBufferArgs,n=n.elements,c=a.invoke(l,g),H=l.def("null"),b=l.def(b,"(",c,")"),c=a.cond(b).then(H,"=",n,".createStream(",c,");")["else"](H,"=",n,".getElements(",c,");");l.entry(c);l.exit(a.cond(b).then(n,".destroyStream(",H,");"));return a.ELEMENTS=H})}return null}(),E=g("offset",!0);return{elements:M,primitive:function(){if("primitive"in
b){var a=b.primitive;return c(function(l,g){return x[a]})}if("primitive"in q){var l=q.primitive;return e(l,function(a,g){var n=a.constants.primTypes,b=a.invoke(g,l);return g.def(n,"[",b,"]")})}return M?f(M)?M.value?c(function(a,l){return l.def(a.ELEMENTS,".primType")}):c(function(){return 4}):new k(M.thisDep,M.contextDep,M.propDep,function(a,l){var g=a.ELEMENTS;return l.def(g,"?",g,".primType:",4)}):null}(),count:function(){if("count"in b){var a=b.count|0;return c(function(){return a})}if("count"in
q){var l=q.count;return e(l,function(a,g){return a.invoke(g,l)})}return M?f(M)?M?E?new k(E.thisDep,E.contextDep,E.propDep,function(a,l){return l.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):c(function(a,l){return l.def(a.ELEMENTS,".vertCount")}):c(function(){return-1}):new k(M.thisDep||E.thisDep,M.contextDep||E.contextDep,M.propDep||E.propDep,function(a,l){var g=a.ELEMENTS;return a.OFFSET?l.def(g,"?",g,".vertCount-",a.OFFSET,":-1"):l.def(g,"?",g,".vertCount:-1")}):null}(),instances:g("instances",!1),
offset:E}}function fa(a){var g=a["static"],d=a.dynamic,f={};u.forEach(function(a){function n(l,b){if(a in g){var E=l(g[a]);f[q]=c(function(){return E})}else if(a in d){var k=d[a];f[q]=e(k,function(a,l){return b(a,l,a.invoke(l,k))})}}var q=O(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return n(function(a){return a},function(a,g,
n){return n});case "depth.func":return n(function(a){return r[a]},function(a,g,n){return g.def(a.constants.compareFuncs,"[",n,"]")});case "depth.range":return n(function(a){return a},function(a,g,n){a=g.def("+",n,"[0]");g=g.def("+",n,"[1]");return[a,g]});case "blend.func":return n(function(a){return[w["srcRGB"in a?a.srcRGB:a.src],w["dstRGB"in a?a.dstRGB:a.dst],w["srcAlpha"in a?a.srcAlpha:a.src],w["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,g,n){function b(a,l){var H=g.def('"',a,l,'" in ',n,"?",
n,".",a,l,":",n,".",a);return g.def(c,"[",H,"]")}var c=a.constants.blendFuncs;a=b("src","RGB");var H=b("src","Alpha"),d=b("dst","RGB"),e=b("dst","Alpha");return[a,d,H,e]});case "blend.equation":return n(function(a){if("string"===typeof a)return[W[a],W[a]];if("object"===typeof a)return[W[a.rgb],W[a.alpha]]},function(a,g,n){var b=a.constants.blendEquations,c=g.def(),H=g.def();a=a.cond("typeof ",n,'==="string"');a.then(c,"=",H,"=",b,"[",n,"];");a["else"](c,"=",b,"[",n,".rgb];",H,"=",b,"[",n,".alpha];");
g(a);return[c,H]});case "blend.color":return n(function(a){return I(4,function(g){return+a[g]})},function(a,g,n){return I(4,function(a){return g.def("+",n,"[",a,"]")})});case "stencil.mask":return n(function(a){return a|0},function(a,g,n){return g.def(n,"|0")});case "stencil.func":return n(function(a){return[r[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,g,n){a=g.def('"cmp" in ',n,"?",a.constants.compareFuncs,"[",n,".cmp]",":",7680);var b=g.def(n,".ref|0");g=g.def('"mask" in ',n,"?",
n,".mask|0:-1");return[a,b,g]});case "stencil.opFront":case "stencil.opBack":return n(function(g){return["stencil.opBack"===a?1029:1028,p[g.fail||"keep"],p[g.zfail||"keep"],p[g.pass||"keep"]]},function(g,n,b){function c(a){return n.def('"',a,'" in ',b,"?",H,"[",b,".",a,"]:",7680)}var H=g.constants.stencilOps;return["stencil.opBack"===a?1029:1028,c("fail"),c("zfail"),c("pass")]});case "polygonOffset.offset":return n(function(a){return[a.factor|0,a.units|0]},function(a,g,n){a=g.def(n,".factor|0");g=
g.def(n,".units|0");return[a,g]});case "cull.face":return n(function(a){var g=0;"front"===a?g=1028:"back"===a&&(g=1029);return g},function(a,g,n){return g.def(n,'==="front"?',1028,":",1029)});case "lineWidth":return n(function(a){return a},function(a,g,n){return n});case "frontFace":return n(function(a){return b[a]},function(a,g,n){return g.def(n+'==="cw"?2304:2305')});case "colorMask":return n(function(a){return a.map(function(a){return!!a})},function(a,g,n){return I(4,function(a){return"!!"+n+"["+
a+"]"})});case "sample.coverage":return n(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,g,n){a=g.def('"value" in ',n,"?+",n,".value:1");g=g.def("!!",n,".invert");return[a,g]})}});return f}function ma(a){var g=a["static"],b=a.dynamic,d={};Object.keys(g).forEach(function(a){var n=g[a],b;if("number"===typeof n||"boolean"===typeof n)b=c(function(){return n});else if("function"===typeof n&&("texture2d"===n._reglType||"textureCube"===n._reglTYpe))b=c(function(a){return a.link(n)});else if(Array.isArray(n)||
R(n))b=c(function(a){return a.global.def("[",I(n.length,function(a){return n[a]}),"]")});b.value=n;d[a]=b});Object.keys(b).forEach(function(a){var g=b[a];d[a]=e(g,function(a,n){return a.invoke(n,g)})});return d}function T(a){var g=a["static"],b=a.dynamic,f={};Object.keys(g).forEach(function(a){var n=g[a],b=m.id(a),l=new pa;if(d(n))l.state=1,l.buffer=C.getBuffer(C.create(n,34962,!1)),l.type=l.buffer.dtype;else{var e=C.getBuffer(n);if(e)l.state=1,l.buffer=e,l.type=e.dtype;else if(n.constant){var k=
n.constant;l.state=2;"number"===typeof k?l.x=k:L.forEach(function(a,g){g<k.length&&(l[a]=k[g])})}else{var e=C.getBuffer(n.buffer),p=n.offset|0,u=n.stride|0,D=n.size|0,v=!!n.normalized,wa=0;"type"in n&&(wa=q[n.type]);n=n.divisor|0;l.buffer=e;l.state=1;l.size=D;l.normalized=v;l.type=wa||e.dtype;l.offset=p;l.stride=u;l.divisor=n}}f[a]=c(function(a,g){var n=a.attribCache;if(b in n)return n[b];var c={isStream:!1};Object.keys(l).forEach(function(a){c[a]=l[a]});l.buffer&&(c.buffer=a.link(l.buffer));return n[b]=
c})});Object.keys(b).forEach(function(a){var g=b[a];f[a]=e(g,function(a,n){function b(a){n(f[a],"=",c,".",a,"|0;")}var c=a.invoke(n,g),H=a.shared,d=H.isBufferArgs,e=H.buffer,f={isStream:n.def(!1)},q=new pa;q.state=1;Object.keys(q).forEach(function(a){f[a]=n.def(""+q[a])});var k=f.buffer,p=f.type;n("if(",d,"(",c,")){",f.isStream,"=true;",k,"=",e,".createStream(",34962,",",c,");",p,"=",k,".dtype;","}else{",k,"=",e,".getBuffer(",c,");","if(",k,"){",p,"=",k,".dtype;","}else if(",c,".constant){",f.state,
"=",2,";",L.map(function(a,g){return f[a]+"="+c+".length>="+g+"?"+c+"["+g+"]:0;"}).join(""),"}else{",k,"=",e,".getBuffer(",c,".buffer);",p,'="type" in ',c,"?",H.glTypes,"[",c,".type]:",k,".dtype;",f.normalized,"=!!",c,".normalized;");b("size");b("offset");b("stride");b("divisor");n("}}");return f})});return f}function Q(a){var g=a["static"],b=a.dynamic,d={};Object.keys(g).forEach(function(a){var n=g[a];d[a]=c(function(a,g){return"number"===typeof n||"boolean"===typeof n?""+n:a.link(n)})});Object.keys(b).forEach(function(a){var g=
b[a];d[a]=e(g,function(a,n){return a.invoke(n,g)})});return d}function U(a,g,b){var c=a.shared.context,d=a.scope();Object.keys(b).forEach(function(e){g.save(c,"."+e);d(c,".",e,"=",b[e].append(a,g),";")});g(d)}function qa(a,g,b){var c=a.shared,d=c.gl,e=c.framebuffer,f;ca&&(f=g.def(c.extensions,".webgl_draw_buffers"));var l=a.constants,c=l.drawBuffer,l=l.backBuffer;a=b?b.append(a,g):g.def(e,".next");g("if(",e,".dirty||",a,"!==",e,".cur){","if(",a,"){",d,".bindFramebuffer(",36160,",",a,".framebuffer);");
ca&&g(f,".drawBuffersWEBGL(",c,"[",a,".colorAttachments.length]);");g("}else{",d,".bindFramebuffer(",36160,",null);");ca&&g(f,".drawBuffersWEBGL(",l,");");g("}",e,".cur=",a,";",e,".dirty=false;","}")}function na(a,b,c){var d=a.shared,e=d.gl,f=a.current,q=a.next,l=d.current,k=d.next,p=a.cond(l,".dirty");u.forEach(function(b){b=O(b);if(!(b in c.state)){var d,H;if(b in q){d=q[b];H=f[b];var u=I(g[b].length,function(a){return p.def(d,"[",a,"]")});p(a.cond(u.map(function(a,g){return a+"==="+H+"["+g+"]"}).join("&&")).then(e,
".",ja[b],"(",u,");",u.map(function(a,g){return H+"["+g+"]="+a}).join(";"),";"))}else d=p.def(k,".",b),u=a.cond(d,"!==",l,".",b),p(u),b in ia?u(a.cond(d).then(e,".enable(",ia[b],");")["else"](e,".disable(",ia[b],");"),l,".",b,"=",d,";"):u(e,".",ja[b],"(",d,");",l,".",b,"=",d,";")}});0===Object.keys(c.state).length&&p(l,".dirty=false;");b(p)}function ta(g,b,c,d){var e=g.shared,q=g.current,k=e.current,l=e.gl;a(Object.keys(c)).forEach(function(a){var e=c[a];if(!d||d(e)){var p=e.append(g,b);if(ia[a]){var u=
ia[a];f(e)?p?b(l,".enable(",u,");"):b(l,".disable(",u,");"):b(g.cond(p).then(l,".enable(",u,");")["else"](l,".disable(",u,");"));b(k,".",a,"=",p,";")}else if(Array.isArray(p)){var D=q[a];b(l,".",ja[a],"(",p,");",p.map(function(a,g){return D+"["+g+"]="+a}).join(";"),";")}else b(l,".",ja[a],"(",p,");",k,".",a,"=",p,";")}})}function ra(a,g){ga&&!a.instancing&&(a.instancing=g.def(a.shared.extensions,".angle_instanced_arrays"))}function ua(a,g,b,c,d){function e(a){switch(a){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function f(b,c,d){function e(){g("if(!",u,".pointer){",k,".enableVertexAttribArray(",p,");",u,".pointer=true;}");var b=d.type,l;l=d.size?g.def(d.size,"||",c):c;g("if(",u,".type!==",b,"||",u,".size!==",l,"||",h.map(function(a){return u+"."+a+"!=="+d[a]}).join("||"),"){",k,".bindBuffer(",34962,",",D,".buffer);",k,".vertexAttribPointer(",[p,l,b,d.normalized,d.stride,d.offset],");",u,".type=",b,";",u,
".size=",l,";",h.map(function(a){return u+"."+a+"="+d[a]+";"}).join(""),"}");ga&&(b=d.divisor,g("if(",u,".divisor!==",b,"){",a.instancing,".vertexAttribDivisorANGLE(",[p,b],");",u,".divisor=",b,";}"))}function q(){g("if(",u,".pointer){",k,".disableVertexAttribArray(",p,");",u,".pointer=false;","}if(",L.map(function(a,g){return u+"."+a+"!=="+v[g]}).join("||"),"){",k,".vertexAttrib4f(",p,",",v,");",L.map(function(a,g){return u+"."+a+"="+v[g]+";"}).join(""),"}")}var k=l.gl,p=g.def(b,".location"),u=g.def(l.attributes,
"[",p,"]");b=d.state;var D=d.buffer,v=[d.x,d.y,d.z,d.w],h=["buffer","normalized","offset","stride"];1===b?e():2===b?q():(g("if(",b,"===",1,"){"),e(),g("}else{"),q(),g("}"))}var l=a.shared;c.forEach(function(l){var c=l.name,q=b.attributes[c],k;if(q){if(!d(q))return;k=q.append(a,g)}else{if(!d(G))return;var u=a.scopeAttrib(c);k={};Object.keys(new pa).forEach(function(a){k[a]=g.def(u,".",a)})}f(a.link(l),e(l.info.type),k)})}function X(a,g,b,c,d){for(var e=a.shared,f=e.gl,l,q=0;q<c.length;++q){var k=c[q],
u=k.name,p=k.info.type,D=b.uniforms[u],k=a.link(k)+".location";if(D){if(!d(D))continue;if(D["static"]){u=D.value;if(35678===p||35680===p)p=a.link(u._texture),g(f,".uniform1i(",k,p+".bind());"),g.exit(p,".unbind()");else if(35674===p||35675===p||35676===p)u=a.global.def("["+u+"]"),D=2,35675===p?D=3:35676===p&&(D=4),g(f,".uniformMatrix",D,"fv(",k,",false,",u,");");else{switch(p){case 5126:l="1f";break;case 35664:l="2f";break;case 35665:l="3f";break;case 35666:l="4f";break;case 35670:l="1i";break;case 5124:l=
"1i";break;case 35671:l="2i";break;case 35667:l="2i";break;case 35672:l="3i";break;case 35668:l="3i";break;case 35673:l="4i";break;case 35669:l="4i"}g(f,".uniform",l,"(",k,",",u,");")}continue}else u=D.append(a,g)}else{if(!d(G))continue;u=g.def(e.uniforms,"[",m.id(u),"]")}D=",";switch(p){case 35678:case 35680:p=g.def(u,"._texture");g(f,".uniform1i(",k,",",p,".bind());");g.exit(p,".unbind();");continue;case 5124:case 35670:l="1i";break;case 35667:case 35671:l="2iv";break;case 35668:case 35672:l="3iv";
break;case 35669:case 35673:l="4iv";break;case 5126:l="1f";break;case 35664:l="2fv";break;case 35665:l="3fv";break;case 35666:l="4fv";break;case 35674:l="Matrix2fv";D=",false,";break;case 35675:l="Matrix3fv";D=",false,";break;case 35676:l="Matrix4fv",D=",false,"}g(f,".uniform",l,"(",k,D,u,");")}}function Y(a,g,b,c){function d(l){var c=q[l];return c?c.batchStatic?c.append(a,g):c.append(a,b):g.def(u,".",l)}function e(){function a(){b(y,".drawElementsInstancedANGLE(",[v,z,F,h+"<<(("+F+"-5121)>>1)",r],
");")}function g(){b(y,".drawArraysInstancedANGLE(",[v,h,z,r],");")}D?m?a():(b("if(",D,"){"),a(),b("}else{"),g(),b("}")):g()}function k(){function a(){b(p+".drawElements("+[v,z,F,h+"<<(("+F+"-5121)>>1)"]+");")}function g(){b(p+".drawArrays("+[v,h,z]+");")}D?m?a():(b("if(",D,"){"),a(),b("}else{"),g(),b("}")):g()}var l=a.shared,p=l.gl,u=l.draw,q=c.draw,D=function(){var c=q.elements,l=g;c?(c.batchStatic||(l=b),c=c.append(a,l)):c=l.def(u,".","elements");c&&l("if("+c+")"+p+".bindBuffer(34963,"+c+".buffer.buffer);");
return c}(),v=d("primitive"),h=d("offset"),z=function(){var c=q.count,l=g;c?(c.batchStatic||(l=b),c=c.append(a,l)):c=l.def(u,".","count");return c}();if("number"===typeof z){if(0===z)return}else b("if(",z,"){"),b.exit("}");var r,y;ga&&(r=d("instances"),y=a.instancing);var F=D+".type",m=q.elements&&f(q.elements);ga&&("number"!==typeof r||0<=r)?"string"===typeof r?(b("if(",r,">0){"),e(),b("}else if(",r,"<0){"),k(),b("}")):e():k()}function Z(a,g,b,c,d){g=ea();d=g.proc("body",d);ga&&(g.instancing=d.def(g.shared.extensions,
".angle_instanced_arrays"));a(g,d,b,c);return g.compile().body}function za(a,g,b,c){ra(a,g);ua(a,g,b,c.attributes,function(){return!0});X(a,g,b,c.uniforms,function(){return!0});Y(a,g,g,b)}function Aa(a,g){var b=a.proc("draw",1);ra(a,b);U(a,b,g.context);qa(a,b,g.framebuffer);na(a,b,g);ta(a,b,g.state);var c=g.shader.progVar.append(a,b);b(a.shared.gl,".useProgram(",c,".program);");if(g.shader.program)za(a,b,g,g.shader.program);else{var d=a.global.def("{}"),e=b.def(c,".id"),f=b.def(d,"[",e,"]");b(a.cond(f).then(f,
".call(this,a0);")["else"](f,"=",d,"[",e,"]=",a.link(function(b){return Z(za,a,g,b,1)}),"(",c,");",f,".call(this,a0);"))}0<Object.keys(g.state).length&&b(a.shared.current,".dirty=true;")}function Da(a,g,b,c){function d(){return!0}a.batchId="a1";ra(a,g);ua(a,g,b,c.attributes,d);X(a,g,b,c.uniforms,d);Y(a,g,g,b)}function va(a,g,b,c){function d(a){return a.contextDep&&f||a.propDep}function e(a){return!d(a)}ra(a,g);var f=b.contextDynamic,l=g.def(),p=g.def();a.shared.props=p;a.batchId=l;var u=a.scope(),
k=a.scope();g(u.entry,"for(",l,"=0;",l,"<","a1",";++",l,"){",p,"=","a0","[",l,"];",k,"}",u.exit);b.needsContext&&U(a,k,b.context);b.needsFramebuffer&&qa(a,k,b.framebuffer);ta(a,k,b.state,d);c?(ua(a,u,b,c.attributes,e),ua(a,k,b,c.attributes,d),X(a,u,b,c.uniforms,e),X(a,k,b,c.uniforms,d),Y(a,u,k,b)):(g=a.global.def("{}"),c=b.shader.progVar.append(a,k),p=k.def(c,".id"),u=k.def(g,"[",p,"]"),k(a.shared.gl,".useProgram(",c,".program);","if(!",u,"){",u,"=",g,"[",p,"]=",a.link(function(g){return Z(Da,a,b,
g,2)}),"(",c,");}",u,".call(this,a0[",l,"],",l,");"))}function Ba(a,g){var b=a.proc("batch",2);a.batchId="0";ra(a,b);var c=!1,d=!0;Object.keys(g.context).forEach(function(a){c=c||g.context[a].propDep});c||(U(a,b,g.context),d=!1);var e=g.framebuffer,k=!1;e&&(e.propDep?c=k=!0:e.contextDep&&c&&(k=!0),k||qa(a,b,e));g.state.viewport&&g.state.viewport.propDynamic&&(c=!0);na(a,b,g);ta(a,b,g.state,function(a){return!(a.contextDep&&c||a.propDep)});g.contextDep=c;g.needsContext=d;g.needsFramebuffer=k;d=g.shader.progVar;
if(d.contextDep&&c||d.propDep)va(a,b,g,null);else if(d=d.append(a,b),b(a.shared.gl,".useProgram(",d,".program);"),g.shader.program)va(a,b,g,g.shader.program);else{var e=a.global.def("{}"),k=b.def(d,".id"),l=b.def(e,"[",k,"]");b(a.cond(l).then(l,".call(this,a0,a1);")["else"](l,"=",e,"[",k,"]=",a.link(function(b){return Z(va,a,g,b,2)}),"(",d,");",l,".call(this,a0,a1);"))}0<Object.keys(g.state).length&&b(a.shared.current,".dirty=true;")}function xa(g,b){function c(a){var l=b.shader[a];l&&d.set(e.shader,
"."+a,l.append(g,d))}var d=g.proc("scope",3);g.batchId="a2";var e=g.shared,k=e.current;U(g,d,b.context);b.framebuffer&&b.framebuffer.append(g,d);a(Object.keys(b.state)).forEach(function(a){var c=b.state[a].append(g,d);Array.isArray(c)?c.forEach(function(b,c){d.set(g.next[a],"["+c+"]",b)}):d.set(e.next,"."+a,c)});["elements","offset","count","instances","primitive"].forEach(function(a){var c=b.draw[a];c&&d.set(e.draw,"."+a,""+c.append(g,d))});Object.keys(b.uniforms).forEach(function(a){d.set(e.uniforms,
"["+m.id(a)+"]",b.uniforms[a].append(g,d))});Object.keys(b.attributes).forEach(function(a){var c=b.attributes[a].append(g,d),e=g.scopeAttrib(a);Object.keys(new pa).forEach(function(a){d.set(e,"."+a,c[a])})});c("vert");c("frag");0<Object.keys(b.state).length&&(d(k,".dirty=true;"),d.exit(k,".dirty=true;"));d("a1(",g.shared.context,",a0,0);")}var pa=aa.Record,W={add:32774,subtract:32778,"reverse subtract":32779};v.ext_blend_minmax&&(W.min=32775,W.max=32776);var ga=v.angle_instanced_arrays,ca=v.webgl_draw_buffers,
g={dirty:!0},D={},u=[],ia={},ja={};J("dither",3024);J("blend.enable",3042);K("blend.color","blendColor",[0,0,0,0]);K("blend.equation","blendEquationSeparate",[32774,32774]);K("blend.func","blendFuncSeparate",[1,0,1,0]);J("depth.enable",2929,!0);K("depth.func","depthFunc",513);K("depth.range","depthRange",[0,1]);K("depth.mask","depthMask",!0);K("colorMask","colorMask",[!0,!0,!0,!0]);J("cull.enable",2884);K("cull.face","cullFace",1029);K("frontFace","frontFace",2305);K("lineWidth","lineWidth",1);J("polygonOffset.enable",
32823);K("polygonOffset.offset","polygonOffset",[0,0]);J("sample.alpha",32926);J("sample.enable",32928);K("sample.coverage","sampleCoverage",[1,!1]);J("stencil.enable",2960);K("stencil.mask","stencilMask",-1);K("stencil.func","stencilFunc",[519,0,-1]);K("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);K("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);J("scissor.enable",3089);K("scissor.box","scissor",[0,0,h.drawingBufferWidth,h.drawingBufferHeight]);K("viewport","viewport",
[0,0,h.drawingBufferWidth,h.drawingBufferHeight]);var Ea={gl:h,context:t,strings:m,next:D,current:g,draw:S,elements:A,buffer:C,shader:V,attributes:aa.state,uniforms:F,framebuffer:da,extensions:v,isBufferArgs:d},ya={primTypes:x,compareFuncs:r,blendFuncs:w,blendEquations:W,stencilOps:p,glTypes:q,orientationType:b};ca&&(ya.backBuffer=[1029],ya.drawBuffer=I(P.maxDrawbuffers,function(a){return 0===a?[0]:I(a,function(a){return 36064+a})}));var Fa=0;return{next:D,current:g,procs:function(){var a=ea(),b=
a.proc("poll"),c=a.proc("refresh"),d=a.block();b(d);c(d);var e=a.shared,k=e.gl,u=e.next,l=e.current;d(l,".dirty=false;");qa(a,b);c(e.framebuffer,".dirty=true;");qa(a,c);Object.keys(ia).forEach(function(g){var e=ia[g],f=d.def(u,".",g),p=a.block();p("if(",f,"){",k,".enable(",e,")}else{",k,".disable(",e,")}",l,".",g,"=",f,";");c(p);b("if(",f,"!==",l,".",g,"){",p,"}")});Object.keys(ja).forEach(function(e){var f=ja[e],p=g[e],q,D,v=a.block();v(k,".",f,"(");Array.isArray(p)?(f=p.length,q=a.global.def(u,
".",e),D=a.global.def(l,".",e),v(I(f,function(a){return q+"["+a+"]"}),");",I(f,function(a){return D+"["+a+"]="+q+"["+a+"];"}).join("")),b("if(",I(f,function(a){return q+"["+a+"]!=="+D+"["+a+"]"}).join("||"),"){",v,"}")):(q=d.def(u,".",e),D=d.def(l,".",e),v(q,");",l,".",e,"=",q,";"),b("if(",q,"!==",D,"){",v,"}"));c(v)});return a.compile()}(),compile:function(a,g,b,c){var d=ea(),e;e=ba(a);var k=ka(a,e),l=sa(a),f=fa(a);a=la(a);var u=k.viewport;u&&(f.viewport=u);u=O("scissor.box");(k=k[u])&&(f[u]=k);
k=0<Object.keys(f).length;e={framebuffer:e,draw:l,shader:a,state:f,dirty:k};e.uniforms=ma(b);e.attributes=T(g);e.context=Q(c);Aa(d,e);xa(d,e);Ba(d,e);return d.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":20,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/loop":24}],9:[function(h,m,t){function d(a,d){this.id=f++;this.type=a;this.data=d}function a(c){if(0===c.length)return[];var d=c.charAt(0),k=c.charAt(c.length-1);if(1<c.length&&d===k&&('"'===
d||"'"===d))return['"'+c.substr(1,c.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(d=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(c))return a(c.substr(0,d.index)).concat(a(d[1])).concat(a(c.substr(d.index+d[0].length)));d=c.split(".");if(1===d.length)return['"'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];c=[];for(k=0;k<d.length;++k)c=c.concat(a(d[k]));return c}function k(c){return"["+a(c).join("][")+"]"}var f=0;m.exports={define:function(a,e){switch(typeof e){case "boolean":case "number":case "string":return new d(a,
k(e+""));case "undefined":return new d(a|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof d},unbox:function(a,e){if(a instanceof d){if(a.type&128)return new d(a.type&-129,k(e))}else if("function"===typeof a)return new d(0,a);return a},accessor:k}},{}],10:[function(h,m,t){var d=h("./util/is-typed-array"),a=h("./util/is-ndarray"),k=h("./constants/primitives.json"),f=h("./constants/usage.json");m.exports=function(c,e,h){function m(a){this.buffer=a;this.primType=
4;this.type=this.vertCount=0}function R(c,k,f,r,p,b,m){(b=m)||d(k)&&(!a(k)||d(k.data))||(b=e.oes_element_index_uint?5125:5123);c.buffer.bind();h._initBuffer(c.buffer,k,f,b,3);k=m;if(!m){switch(c.buffer.dtype){case 5121:case 5120:k=5121;break;case 5123:case 5122:k=5123;break;case 5125:case 5124:k=5125}c.buffer.dtype=k}c.type=k;0>p&&(p=c.buffer.byteLength,5123===k?p>>=1:5125===k&&(p>>=2));c.vertCount=p;p=r;0>r&&(p=4,r=c.buffer.dimension,1===r&&(p=0),2===r&&(p=1),3===r&&(p=4));c.primType=p}var A={uint8:5121,
uint16:5123};e.oes_element_index_uint&&(A.uint32=5125);m.prototype.bind=function(){this.buffer.bind()};var x=[];return{create:function(e){function x(e){if(e)if("number"===typeof e)w(e),r.primType=4,r.vertCount=e|0,r.type=5121;else{var b=null,q=35044,h=-1,m=-1,v=0,y=0;Array.isArray(e)||d(e)||a(e)?b=e:("data"in e&&(b=e.data),"usage"in e&&(q=f[e.usage]),"primitive"in e&&(h=k[e.primitive]),"count"in e&&(m=e.count|0),"length"in e&&(v=e.length|0),"type"in e&&(y=A[e.type]));b?R(r,b,q,h,m,v,y):(e=r.buffer,
e.bind(),c.bufferData(34963,v,q),e.dtype=y||5121,e.usage=q,e.dimension=3,e.byteLength=v,r.primType=0>h?4:h,r.vertCount=0>m?0:m,r.type=e.dtype)}else w(),r.primType=4,r.vertCount=0,r.type=5121;return x}var w=h.create(null,34963,!0),r=new m(w._buffer);x(e);x._reglType="elements";x._elements=r;x.subdata=function(a,b){w.subdata(a,b);return x};x.destroy=function(){w.destroy();r.buffer=null};return x},createStream:function(a){var c=x.pop();c||(c=new m(h.create(null,34963,!0)._buffer));R(c,a,35040,-1,-1,
0,0);return c},destroyStream:function(a){x.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof m?a._elements:null}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":22,"./util/is-typed-array":23}],11:[function(h,m,t){m.exports=function(d){function a(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{k[a]=
d.getExtension(a)}catch(c){}})}var k={};a();return{extensions:k,refresh:a}}},{}],12:[function(h,m,t){var d=h("./util/values"),a=h("./util/extend");m.exports=function(k,f,c,e,h){function m(a,b,c,d){this.target=a;this.level=b;this.texture=c;this.renderbuffer=d}function R(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function A(a,b){var c=b.width,d=b.height;if(a.texture)var e=a.texture._texture,k=Math.max(1,e.params.width>>a.level),f=Math.max(1,
e.params.height>>a.level),c=c||k,d=d||f;else e=a.renderbuffer._renderbuffer,c=c||e.width,d=d||e.height;e.refCount+=1;b.width=c;b.height=d}function x(a,b){b?b.texture?k.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):k.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):k.framebufferTexture2D(36160,a,3553,null,0)}function q(a){var b=3553,c=0,d=null,e=null;"object"===typeof a&&("level"in a&&(c=a.level|0),"target"in a&&(b=a.target|0));var k=a._reglType;
"texture"===k?d=a:"renderbuffer"===k&&(e=a,b=36161,c=0);return new m(b,c,d,e)}function L(a){return a&&(a.texture||a.renderbuffer)}function w(){this.id=C++;N[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function r(a){k.isFramebuffer(a.framebuffer)||(a.framebuffer=k.createFramebuffer());b.dirty=!0;k.bindFramebuffer(36160,a.framebuffer);for(var d=
a.colorAttachments,e=0;e<d.length;++e)x(36064+e,d[e]);for(e=d.length;e<c.maxColorAttachments;++e)x(36064+e,null);x(36096,a.depthAttachment);x(36128,a.stencilAttachment);x(33306,a.depthStencilAttachment);f.webgl_draw_buffers&&f.webgl_draw_buffers.drawBuffersWEBGL(P[d.length]);k.checkFramebufferStatus(36160)}function p(a){a=a.framebuffer;k.isFramebuffer(a)&&k.deleteFramebuffer(a)}var b={current:null,next:null,dirty:!1},G={rgba:6408},t={rgba4:32854,rgb565:36194,"rgb5 a1":32855};f.ext_srgb&&(t.srgba=
35907);f.ext_color_buffer_half_float&&(t.rgba16f=34842,t.rgb16f=34843);f.webgl_color_buffer_float&&(t.rgba32f=34836);var B=[],v=[];f.webgl_depth_texture&&(B.push(6402),v.push(34041));a(a({},G),t);d(G);d(t);t=5121;B={uint8:5121};f.oes_texture_half_float&&(t=B["half float"]=36193);f.oes_texture_float&&(t=B["float"]=5126);B.best=t;var P=function(){for(var a=Array(c.maxDrawbuffers),b=0;b<=c.maxDrawbuffers;++b)for(var d=a[b]=Array(b),e=0;e<b;++e)d[e]=36064+e;return a}(),C=0,N={};return a(b,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof w)?a:null},create:function(a){function b(a){var d,f=a||{},p=a=0;if("shape"in f){var v=f.shape;a=v[0];p=v[1]}else"radius"in f&&(a=p=f.radius),"width"in f&&(a=f.width),"height"in f&&(p=f.height);var w=null,v=!1;if("colorBuffers"in f||"colorBuffer"in f){w=f.colorBuffers||f.colorBuffer;Array.isArray(w)||(w=[w]);c.width=a;c.height=p;w=w.map(q);for(d=0;d<w.length;++d)A(w[d],c);a=c.width;p=c.height}else{var x=!0,B="rgba",z="uint8",t=1,
v=!0;c.width=a=a||k.drawingBufferWidth;c.height=p=p||k.drawingBufferHeight;"format"in f&&(B=f.format,x=B in G);"type"in f&&(z=f.type);"colorCount"in f&&(t=f.colorCount|0);if(c.ownsColor)for(w=c.colorAttachments;w.length>t;)R(w.pop());else w=[];for(d=0;d<w.length;++d){var C;a:{C=w[d];var P=x,N=B,ha=a,T=p;if(C.texture){var Q=C.texture;if(P){Q({format:N,type:z,width:ha,height:T});Q._texture.refCount+=1;C=!0;break a}}else if(Q=C.renderbuffer,!P){Q({format:N,width:ha,height:T});Q._renderbuffer.refCount+=
1;C=!0;break a}R(C);C=!1}C||(w[d--]=w[w.length-1],w.pop())}for(;w.length<t;)x?w.push(new m(3553,0,e.create2D({format:B,type:z,width:a,height:p},3553),null)):w.push(new m(36161,0,null,h.create({format:B,width:a,height:p})))}c.width=a;c.height=p;B=x=d=null;z=!1;"depthBuffer"in f&&(d=q(f.depthBuffer));"stencilBuffer"in f&&(x=q(f.stencilBuffer));"depthStencilBuffer"in f&&(B=q(f.depthStencilBuffer));if(d||x||B)A(d||x||B,c);else if(t=!0,P=C=!1,"depth"in f&&(t=!!f.depth),"stencil"in f&&(C=!!f.stencil),"depthTexture"in
f&&(P=!!f.depthTexture),f=c.depthAttachment||c.stencilAttachment||c.depthStencilAttachment,N=null,t||C)z=!0,P?(P=C?"depth stencil":"depth",c.ownsDepthStencil&&f.texture?(f.texture({format:P,width:a,height:p}),f.texture._texture.refCount+=1,N=f):N=new m(3553,0,e.create({format:P,width:a,height:p},3553),null)):(P=t?C?"depth stencil":"depth":"stencil",c.ownsDepthStencil&&f.renderbuffer?(f.renderbuffer({format:P,width:a,height:p}),f.renderbuffer._renderbuffer.refCount+=1,N=f):N=new m(36161,0,null,h.create({format:P,
width:a,height:p}))),t?C?B=N:d=N:x=N;a=c;a.colorAttachments.forEach(R);R(a.depthAttachment);R(a.stencilAttachment);R(a.depthStencilAttachment);c.colorAttachments=w;c.depthAttachment=d;c.stencilAttachment=x;c.depthStencilAttachment=B;c.ownsColor=v;c.ownsDepthStencil=z;b.color=w.map(L);b.depth=L(d);b.stencil=L(x);b.depthStencil=L(B);r(c);b.width=c.width;b.height=c.height;return b}var c=new w;b(a);b._reglType="framebuffer";b._framebuffer=c;b._destroy=function(){p(c)};return b},clear:function(){d(N).forEach(p)},
refresh:function(){d(N).forEach(r)}})}},{"./util/extend":21,"./util/values":28}],13:[function(h,m,t){m.exports=function(d,a){var k=1;a.ext_texture_filter_anisotropic&&(k=d.getParameter(34047));var f=1,c=1;a.webgl_draw_buffers&&(f=d.getParameter(34852),c=d.getParameter(36063));return{colorBits:[d.getParameter(3410),d.getParameter(3411),d.getParameter(3412),d.getParameter(3413)],depthBits:d.getParameter(3414),stencilBits:d.getParameter(3415),subpixelBits:d.getParameter(3408),extensions:Object.keys(a).filter(function(c){return!!a[c]}),
maxAnisotropic:k,maxDrawbuffers:f,maxColorAttachments:c,pointSizeDims:d.getParameter(33901),lineWidthDims:d.getParameter(33902),maxViewportDims:d.getParameter(3386),maxCombinedTextureUnits:d.getParameter(35661),maxCubeMapSize:d.getParameter(34076),maxRenderbufferSize:d.getParameter(34024),maxTextureUnits:d.getParameter(34930),maxTextureSize:d.getParameter(3379),maxAttributes:d.getParameter(34921),maxVertexUniforms:d.getParameter(36347),maxVertexTextureUnits:d.getParameter(35660),maxVaryingVectors:d.getParameter(36348),
maxFragmentUniforms:d.getParameter(36349),glsl:d.getParameter(35724),renderer:d.getParameter(7937),vendor:d.getParameter(7936),version:d.getParameter(7938)}}},{}],14:[function(h,m,t){var d=h("./util/is-typed-array");m.exports=function(a,k,f){return function(c){var e=c||{};d(c)?e={data:e}:2===arguments.length?e={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof c&&(e={});k();var h=e.x||0,m=e.y||0,t=e.width||f.viewportWidth,A=e.height||f.viewportHeight,e=e.data||new Uint8Array(t*A*4);a.pixelStorei(3333,
4);a.readPixels(h,m,t,A,6408,5121,e);return e}}},{"./util/is-typed-array":23}],15:[function(h,m,t){var d=h("./util/values");m.exports=function(a,k,f){function c(){this.id=t++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function e(c){a.isRenderbuffer(c.renderbuffer)||(c.renderbuffer=a.createRenderbuffer());a.bindRenderbuffer(36161,c.renderbuffer);a.renderbufferStorage(36161,c.format,c.width,c.height)}function h(c){var d=c.renderbuffer;a.bindRenderbuffer(36161,
null);a.isRenderbuffer(d)&&a.deleteRenderbuffer(d);c.renderbuffer=null;c.refCount=0;delete A[c.id]}var m={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};k.ext_srgb&&(m.srgba=35907);k.ext_color_buffer_half_float&&(m.rgba16f=34842,m.rgb16f=34843);k.webgl_color_buffer_float&&(m.rgba32f=34836);var t=0,A={};c.prototype.decRef=function(){0===--this.refCount&&h(this)};return{create:function(a){function d(a){a=a||{};var c=0,k=0;"shape"in a?(k=a.shape,c=k[0]|0,k=
k[1]|0):("radius"in a&&(c=k=a.radius|0),"width"in a&&(c=a.width|0),"height"in a&&(k=a.height|0));d.width=f.width=Math.max(c,1);d.height=f.height=Math.max(k,1);f.format=32854;"format"in a&&(f.format=m[a.format]);e(f);return d}var f=new c;A[f.id]=f;d(a);d._reglType="renderbuffer";d._renderbuffer=f;d.destroy=function(){f.decRef()};return d},refresh:function(){d(A).forEach(e)},clear:function(){d(A).forEach(h)}}}},{"./util/values":28}],16:[function(h,m,t){var d=h("./util/values");m.exports=function(a,
k){function f(a,c,d,b){this.name=a;this.id=c;this.location=d;this.info=b}function c(a,c){for(var d=0;d<a.length;++d)if(a[d].id===c.id){a[d].location=c.location;return}a.push(c)}function e(c,d,e){e=35632===c?t:A;var b=e[d];if(!b){var f=k.str(d),b=a.createShader(c);a.shaderSource(b,f);a.compileShader(b);e[d]=b}return b}function h(a,c){this.id=L++;this.fragId=a;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[]}function m(d,q){var p,b;p=e(35632,d.fragId);b=e(35633,d.vertId);var h=d.program=
a.createProgram();a.attachShader(h,p);a.attachShader(h,b);a.linkProgram(h);var y=a.getProgramParameter(h,35718),B=d.uniforms;for(p=0;p<y;++p)if(b=a.getActiveUniform(h,p))if(1<b.size)for(var v=0;v<b.size;++v){var x=b.name.replace("[0]","["+v+"]");c(B,new f(x,k.id(x),a.getUniformLocation(h,x),b))}else c(B,new f(b.name,k.id(b.name),a.getUniformLocation(h,b.name),b));y=a.getProgramParameter(h,35721);B=d.attributes;for(p=0;p<y;++p)(b=a.getActiveAttrib(h,p))&&c(B,new f(b.name,k.id(b.name),a.getAttribLocation(h,
b.name),b))}var t={},A={},x={},q=[],L=0;return{clear:function(){var c=a.deleteShader.bind(a);d(t).forEach(c);t={};d(A).forEach(c);A={};q.forEach(function(c){a.deleteProgram(c.program)});q.length=0;x={}},refresh:function(){t={};A={};q.forEach(m)},program:function(a,c,d){var b=x[c];b||(b=x[c]={});var e=b[a];e||(e=new h(c,a),m(e,d),b[a]=e,q.push(e));return e},shader:e,frag:null,vert:null}}},{"./util/values":28}],17:[function(h,m,t){m.exports=function(){var d={"":0},a=[""];return{id:function(k){var f=
d[k];if(f)return f;f=d[k]=a.length;a.push(k);return f},str:function(d){return a[d]}}}},{}],18:[function(h,m,t){function d(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function a(a){if(!Array.isArray(a))return!1;var c=a.length;if(0===c||!Array.isArray(a[0]))return!1;for(var d=a[0].length,e=1;e<c;++e)if(!Array.isArray(a[e])||a[e].length!==d)return!1;return!0}function k(a){return Object.prototype.toString.call(a)}function f(b){if(!b)return!1;var c=k(b);return 0<=p.indexOf(c)?!0:
d(b)||a(b)||R(b)}function c(a,c){36193===a.type?(a.data=x(c),A.freeType(c)):a.data=c}var e=h("./util/extend"),y=h("./util/values"),I=h("./util/is-typed-array"),R=h("./util/is-ndarray"),A=h("./util/pool"),x=h("./util/to-half-float");t=h("./constants/arraytypes.json");var q=h("./constants/arraytypes.json"),L=[9984,9986,9985,9987],w=[0,6409,6410,6407,6408],r={};r[6409]=r[6406]=r[6402]=1;r[34041]=r[6410]=2;r[6407]=3;r[6408]=4;var p=Object.keys(t).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]",
"[object HTMLImageElement]","[object HTMLVideoElement]"]);m.exports=function(b,h,p,m,v){function t(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function C(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;
a.width=b.width;a.height=b.height;a.channels=b.channels}function N(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=ua[b.colorSpace]);"type"in b&&(a.type=X[b.type]);var c=a.width,d=a.height,e=a.channels,f=!1;"shape"in b?(c=b.shape[0],d=b.shape[1],3===b.shape.length&&(e=b.shape[2],f=!0)):("radius"in b&&(c=d=b.radius),"width"in b&&(c=b.width),
"height"in b&&(d=b.height),"channels"in b&&(e=b.channels,f=!0));a.width=c|0;a.height=d|0;a.channels=e|0;c=!1;"format"in b&&(c=b.format,d=a.internalformat=Y[c],a.format=Da[d],c in X&&!("type"in b)&&(a.type=X[c]),c in Z&&(a.compressed=!0),c=!0);!f&&c?a.channels=r[a.format]:f&&!c&&a.channels!==w[a.format]&&(a.format=a.internalformat=w[a.channels])}}function z(a){b.pixelStorei(37440,a.flipY);b.pixelStorei(37441,a.premultiplyAlpha);b.pixelStorei(37443,a.colorSpace);b.pixelStorei(3317,a.unpackAlignment)}
function da(){t.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function F(b,e){var u=null;f(e)?u=e:e&&(N(b,e),"x"in e&&(b.xOffset=e.x|0),"y"in e&&(b.yOffset=e.y|0),f(e.data)&&(u=e.data));if(e.copy){var h=v.viewportWidth,p=v.viewportHeight;b.width=b.width||h-b.xOffset;b.height=b.height||p-b.yOffset;b.needsCopy=!0}else if(!u)b.width=b.width||1,b.height=b.height||1;else if(I(u))b.data=u,"type"in e||5121!==b.type||(b.type=q[Object.prototype.toString.call(u)]|
0);else if(d(u)){h=u;p=b.width*b.height*b.channels;switch(b.type){case 5121:case 5123:case 5125:case 5126:p=A.allocType(b.type,p);p.set(h);b.data=p;break;case 36193:b.data=x(h)}b.alignment=1;b.needsFree=!0}else if(R(u)){h=u.data;Array.isArray(h)||5121!==b.type||(b.type=q[Object.prototype.toString.call(h)]|0);var p=u.shape,m=u.stride,y,r,n,t;3===p.length?(n=p[2],t=m[2]):t=n=1;y=p[0];r=p[1];p=m[0];m=m[1];b.alignment=1;b.width=y;b.height=r;b.channels=n;b.format=b.internalformat=w[n];b.needsFree=!0;y=
t;u=u.offset;n=b.width;t=b.height;r=b.channels;for(var B=A.allocType(36193===b.type?5126:b.type,n*t*r),C=0,z=0;z<t;++z)for(var F=0;F<n;++F)for(var P=0;P<r;++P)B[C++]=h[p*F+m*z+y*P+u];c(b,B)}else if("[object HTMLCanvasElement]"===k(u)||"[object CanvasRenderingContext2D]"===k(u))"[object HTMLCanvasElement]"===k(u)?b.element=u:b.element=u.canvas,b.width=b.element.width,b.height=b.element.height;else if("[object HTMLImageElement]"===k(u))b.element=u,b.width=u.naturalWidth,b.height=u.naturalHeight;else if("[object HTMLVideoElement]"===
k(u))b.element=u,b.width=u.videoWidth,b.height=u.videoHeight,b.needsPoll=!0;else if(a(u)){h=u[0].length;p=u.length;m=1;if(Array.isArray(u[0][0])){y=m=u[0][0].length;n=A.allocType(36193===b.type?5126:b.type,h*p*y);for(r=t=0;r<p;++r)for(B=u[r],C=0;C<h;++C)for(z=B[C],F=0;F<y;++F)n[t++]=z[F];c(b,n)}else{y=A.allocType(36193===b.type?5126:b.type,h*p);for(t=n=0;t<p;++t)for(r=u[t],B=0;B<h;++B)y[n++]=r[B];c(b,y)}b.alignment=1;b.width=h;b.height=p;b.channels=m;b.format=b.internalformat=w[m];b.needsFree=!0}}
function aa(a,c,d,e,f){var k=a.element,h=a.data,p=a.internalformat,n=a.format,q=a.type,v=a.width,y=a.height;z(a);k?b.texSubImage2D(c,f,d,e,n,q,k):a.compressed?b.compressedTexSubImage2D(c,f,d,e,p,v,y,h):a.needsCopy?(m(),b.copyTexSubImage2D(c,f,d,e,a.xOffset,a.yOffset,v,y)):b.texSubImage2D(c,f,d,e,v,y,n,q,h)}function V(){return va.pop()||new da}function S(a){a.needsFree&&A.freeType(a.data);da.call(a);va.push(a)}function oa(){t.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=
Array(16)}function O(a,b,c){var d=a.images[0]=V();a.mipmask=1;d.width=a.width=b;d.height=a.height=c}function J(a,b){var c=null;if(f(b))c=a.images[0]=V(),F(c,b),a.mipmask=1;else if(N(a,b),Array.isArray(b.mipmap))for(var d=b.mipmap,e=0;e<d.length;++e)c=a.images[e]=V(),C(c,a),c.width>>=e,c.height>>=e,F(c,d[e]),a.mipmask|=1<<e;else c=a.images[0]=V(),C(c,a),F(c,b),a.mipmask=1;C(a,a.images[0])}function K(a,c){for(var d=a.images,e=0;e<d.length&&d[e];++e){var f=d[e],k=c,h=e,p=f.element,n=f.data,q=f.internalformat,
v=f.format,y=f.type,r=f.width,t=f.height;z(f);p?b.texImage2D(k,h,v,v,y,p):f.compressed?b.compressedTexImage2D(k,h,q,r,t,0,n):f.needsCopy?(m(),b.copyTexImage2D(k,h,v,f.xOffset,f.yOffset,r,t,0)):b.texImage2D(k,h,v,r,t,0,v,y,n)}}function ea(){var a=Ba.pop()||new oa;t.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function ba(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&S(b[c]),b[c]=null;Ba.push(a)}function ka(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=
1;this.genMipmaps=!1;this.mipmapHint=4352}function la(a,b){"min"in b&&(a.minFilter=ra[b.min],0<=L.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=ta[b.mag]);var c=a.wrapS,d=a.wrapT;if("wrap"in b){var e=b.wrap;"string"===typeof e?c=d=na[e]:Array.isArray(e)&&(c=na[e[0]],d=na[e[1]])}else"wrapS"in b&&(c=na[b.wrapS]),"wrapT"in b&&(d=na[b.wrapT]);a.wrapS=c;a.wrapT=d;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=
qa[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function sa(a,c){b.texParameteri(c,10241,a.minFilter);b.texParameteri(c,10240,a.magFilter);b.texParameteri(c,10242,a.wrapS);b.texParameteri(c,10243,a.wrapT);h.ext_texture_filter_anisotropic&&b.texParameteri(c,34046,a.anisotropic);a.genMipmaps&&(b.hint(33170,a.mipmapHint),b.generateMipmap(c))}function fa(){var a=xa.pop()||new ka;ka.call(a);return a}
function ma(a){t.call(this);this.mipmask=0;this.id=pa++;this.refCount=1;this.target=a;this.texture=b.createTexture();this.unit=-1;this.bindCount=0}function T(a){b.activeTexture(33984);b.bindTexture(a.target,a.texture)}function Q(){var a=ca[0];a?b.bindTexture(a.target,a.texture):b.bindTexture(3553,null)}function U(a){var c=a.texture,d=a.unit,e=a.target;0<=d&&(b.activeTexture(33984+d),b.bindTexture(e,null),ca[d]=null);b.deleteTexture(c);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete W[a.id]}
var qa={"don't care":4352,"dont care":4352,nice:4354,fast:4353},na={repeat:10497,clamp:33071,mirror:33648},ta={nearest:9728,linear:9729},ra=e({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ta),ua={none:0,browser:37444},X={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Y={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Z={};h.ext_srgb&&(Y.srgb=35904,
Y.srgba=35906);h.oes_texture_float&&(X["float"]=5126);h.oes_texture_half_float&&(X.float16=X["half float"]=36193);h.webgl_depth_texture&&(e(Y,{depth:6402,"depth stencil":34041}),e(X,{uint16:5123,uint32:5125,"depth stencil":34042}));h.webgl_compressed_texture_s3tc&&e(Z,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});h.webgl_compressed_texture_atc&&e(Z,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});h.webgl_compressed_texture_pvrtc&&
e(Z,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});h.webgl_compressed_texture_etc1&&(Z["rgb etc1"]=36196);var za=Array.prototype.slice.call(b.getParameter(34467));Object.keys(Z).forEach(function(a){var b=Z[a];0<=za.indexOf(b)&&(Y[a]=b)});var Aa=Object.keys(Y);p.textureFormats=Aa;var Da=Aa.reduce(function(a,b){var c=Y[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},
{}),va=[],Ba=[],xa=[],pa=0,W={},ga=p.maxTextureUnits,ca=Array(ga).map(function(){return null});e(ma.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var c=0;c<ga;++c){var d=ca[c];if(d){if(0<d.bindCount)continue;d.unit=-1}ca[c]=this;a=c;break}this.unit=a;b.activeTexture(33984+a);b.bindTexture(this.target,this.texture)}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&U(this)}});return{create2D:function(a,b){function c(a,b){var e=fa(),g=ea();
"number"===typeof a?"number"===typeof b?O(g,a|0,b|0):O(g,a|0,a|0):a?(la(e,a),J(g,a)):O(g,1,1);e.genMipmaps&&(g.mipmask=(g.width<<1)-1);d.mipmask=g.mipmask;C(d,g);c.width=g.width;c.height=g.height;T(d);K(g,3553);sa(e,3553);Q();xa.push(e);ba(g);return c}var d=new ma(3553);W[d.id]=d;c(a,b);c.subimage=function(a,b,e,g){b|=0;e|=0;g|=0;var f=V();C(f,d);f.width>>=g;f.height>>=g;f.width-=b;f.height-=e;F(f,a);T(d);aa(f,3553,b,e,g);Q();S(f);return c};c._reglType="texture2d";c._texture=d;c.destroy=function(){d.decRef()};
return c},createCube:function(a,b,c,d,e,f){function k(a,b,c,d,e,g){var f,p=fa();for(f=0;6>f;++f)n[f]=ea();if("number"===typeof a||!a)for(a=a|0||1,f=0;6>f;++f)O(n[f],a,a);else if("object"===typeof a)if(b)J(n[0],a),J(n[1],b),J(n[2],c),J(n[3],d),J(n[4],e),J(n[5],g);else if(la(p,a),N(h,a),"faces"in a)for(a=a.faces,f=0;6>f;++f)C(n[f],h),J(n[f],a[f]);else for(f=0;6>f;++f)J(n[f],a);C(h,n[0]);h.mipmask=p.genMipmaps?(n[0].width<<1)-1:n[0].mipmask;k.width=n[0].width;k.height=n[0].height;T(h);for(f=0;6>f;++f)K(n[f],
34069+f);sa(p,34067);Q();xa.push(p);for(f=0;6>f;++f)ba(n[f]);return k}var h=new ma(34067);W[h.id]=h;var n=Array(6);k(a,b,c,d,e,f);k.subimage=function(a,b,c,d,e){c|=0;d|=0;e|=0;var g=V();C(g,h);g.width>>=e;g.height>>=e;g.width-=c;g.height-=d;F(g,b);T(h);aa(g,34069+a,c,d,e);Q();S(g);return k};k._reglType="textureCube";k._texture=h;k.destroy=function(){h.decRef()};return k},clear:function(){for(var a=0;a<ga;++a)b.activeTexture(33984+a),b.bindTexture(3553,null),ca[a]=null;y(W).forEach(U)},getTexture:function(a){return null}}}},
{"./constants/arraytypes.json":4,"./util/extend":21,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/pool":25,"./util/to-half-float":27,"./util/values":28}],19:[function(h,m,t){m.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],20:[function(h,m,t){function d(a){return Array.prototype.slice.call(a)}function a(a){return d(a).join("")}var k=h("./extend");m.exports=function(){function f(){var c=[],f=[];return k(function(){c.push.apply(c,
d(arguments))},{def:function(){var a="v"+e++;f.push(a);0<arguments.length&&(c.push(a,"="),c.push.apply(c,d(arguments)),c.push(";"));return a},toString:function(){return a([0<f.length?"var "+f+";":"",a(c)])}})}function c(){function a(e,b){d(e,b,"=",c.def(e,b),";")}var c=f(),d=f(),e=c.toString,h=d.toString;return k(c,{entry:c,exit:d,save:a,set:function(d,b,e){a(d,b);c(d,b,"=",e,";")},toString:function(){return e()+h()}})}var e=0,h=[],m=[],t=f(),A={};return{global:t,link:function(a){for(var c=0;c<m.length;++c)if(m[c]===
a)return h[c];c="g"+e++;h.push(c);m.push(a);return c},block:f,proc:function(d,e){function f(){var a="a"+h.length;h.push(a);return a}var h=[];e=e||0;for(var m=0;m<e;++m)f();var m=c(),p=m.toString;return A[d]=k(m,{arg:f,toString:function(){return a(["function(",h.join(),"){",p(),"}"])}})},scope:c,cond:function(){var e=a(arguments),f=c(),h=c(),m=f.toString,y=h.toString;return k(f,{then:function(){f.apply(f,d(arguments));return this},"else":function(){h.apply(h,d(arguments));return this},toString:function(){var c=
y();c&&(c="else{"+c+"}");return a(["if(",e,"){",m(),"}",c])}})},compile:function(){var c=['"use strict";',t,"return {"];Object.keys(A).forEach(function(a){c.push('"',a,'":',A[a].toString(),",")});c.push("}");var d=a(c).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,h.concat(d)).apply(null,m)}}}},{"./extend":21}],21:[function(h,m,t){m.exports=function(d,a){for(var k=Object.keys(a),f=0;f<k.length;++f)d[k[f]]=a[k[f]];return d}},{}],22:[function(h,m,t){var d=h("./is-typed-array");
m.exports=function(a){return!!a&&"object"===typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"===typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||d(a.data))}},{"./is-typed-array":23}],23:[function(h,m,t){var d=h("../constants/arraytypes.json");m.exports=function(a){return Object.prototype.toString.call(a)in d}},{"../constants/arraytypes.json":4}],24:[function(h,m,t){m.exports=function(d,a){for(var k=Array(d),f=0;f<d;++f)k[f]=a(f);return k}},{}],25:[function(h,
m,t){function d(a){var d,f;d=(65535<a)<<4;a>>>=d;f=(255<a)<<3;a>>>=f;d|=f;f=(15<a)<<2;a>>>=f;d|=f;f=(3<a)<<1;return d|f|a>>>f>>1}function a(a){a:{for(var e=16;268435456>=e;e*=16)if(a<=e){a=e;break a}a=0}e=f[d(a)>>2];return 0<e.length?e.pop():new ArrayBuffer(a)}function k(a){f[d(a.byteLength)>>2].push(a)}var f=h("./loop")(8,function(){return[]});m.exports={alloc:a,free:k,allocType:function(c,d){var f=null;switch(c){case 5120:f=new Int8Array(a(d),0,d);break;case 5121:f=new Uint8Array(a(d),0,d);break;
case 5122:f=new Int16Array(a(2*d),0,d);break;case 5123:f=new Uint16Array(a(2*d),0,d);break;case 5124:f=new Int32Array(a(4*d),0,d);break;case 5125:f=new Uint32Array(a(4*d),0,d);break;case 5126:f=new Float32Array(a(4*d),0,d);break;default:return null}return f.length!==d?f.subarray(0,d):f},freeType:function(a){k(a.buffer)}}},{"./loop":24}],26:[function(h,m,t){m.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(d){return requestAnimationFrame(d)},
cancel:function(d){return cancelAnimationFrame(d)}}:{next:function(d){setTimeout(d,30)},cancel:clearTimeout}},{}],27:[function(h,m,t){var d=h("./pool"),a=new Float32Array(1),k=new Uint32Array(a.buffer);m.exports=function(f){for(var c=d.allocType(5123,f.length),e=0;e<f.length;++e)if(isNaN(f[e]))c[e]=65535;else if(Infinity===f[e])c[e]=31744;else if(-Infinity===f[e])c[e]=64512;else{a[0]=f[e];var h=k[0],m=h>>>31<<15,t=(h<<1>>>24)-127,h=h>>13&1023;c[e]=-24>t?m:-14>t?m+(h+1024>>-14-t):15<t?m+31744:m+(t+
15<<10)+h}return c}},{"./pool":25}],28:[function(h,m,t){m.exports=function(d){return Object.keys(d).map(function(a){return d[a]})}},{}],29:[function(h,m,t){function d(d,c){function e(){var a=window.innerWidth,c=window.innerHeight;d!==document.body&&(c=d.getBoundingClientRect(),a=c.right-c.left,c=c.top-c.bottom);h.width=t*a;h.height=t*c;k(h.style,{width:a+"px",height:c+"px"})}var h=document.createElement("canvas"),m=a(h,c);k(h.style,{border:0,margin:0,padding:0,top:0,left:0});d.appendChild(h);d===
document.body&&(h.style.position="absolute",k(d.style,{margin:0,padding:0}));var t=+m.options.pixelRatio;window.addEventListener("resize",e,!1);var A=m.options.onDestroy;m.options=k(k({},m.options),{onDestroy:function(){window.removeEventListener("resize",e);d.removeChild(h);A&&A()}});e();return m}function a(a,c){function d(c){try{return a.getContext(c,h)}catch(e){return null}}var h=c.glOptions||{};return{gl:d("webgl")||d("experimental-webgl")||d("webgl-experimental"),options:k({pixelRatio:window.devicePixelRatio},
c)}}var k=h("./util/extend");m.exports=function(f){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:f[0],options:f[1]||{}};var c=document.body,e=f[1]||{};if("string"===typeof f[0])c=document.querySelector(f[0])||document.body;else if("object"===typeof f[0])if(f[0]instanceof HTMLElement)c=f[0];else{if(f[0]instanceof WebGLRenderingContext)return{gl:f[0],options:k({pixelRatio:1},e)};e=f[0]}return c.nodeName&&"CANVAS"===c.nodeName.toUpperCase()?a(c,e):d(c,e)}},{"./util/extend":21}],
30:[function(h,m,t){m.exports=function(a,k){function f(a){var c=!1;"altKey"in a&&(c=c||a.altKey!==b.alt,b.alt=!!a.altKey);"shiftKey"in a&&(c=c||a.shiftKey!==b.shift,b.shift=!!a.shiftKey);"ctrlKey"in a&&(c=c||a.ctrlKey!==b.control,b.control=!!a.ctrlKey);"metaKey"in a&&(c=c||a.metaKey!==b.meta,b.meta=!!a.metaKey);return c}function c(a,c){var e=d.x(c),h=d.y(c);"buttons"in c&&(a=c.buttons|0);if(a!==w||e!==r||h!==p||f(c))w=a|0,r=e||0,p=h||0,k&&k(w,r,p,b)}function e(a){c(0,a)}function h(){if(w||r||p||b.shift||
b.alt||b.meta||b.control)w=r=p=0,b.shift=b.alt=b.control=b.meta=!1,k&&k(0,0,0,b)}function m(a){f(a)&&k&&k(w,r,p,b)}function t(a){0===d.buttons(a)?c(0,a):c(w,a)}function A(a){c(w|d.buttons(a),a)}function x(a){c(w&~d.buttons(a),a)}function q(){G||(G=!0,a.addEventListener("mousemove",t),a.addEventListener("mousedown",A),a.addEventListener("mouseup",x),a.addEventListener("mouseleave",e),a.addEventListener("mouseenter",e),a.addEventListener("mouseout",e),a.addEventListener("mouseover",e),a.addEventListener("blur",
h),a.addEventListener("keyup",m),a.addEventListener("keydown",m),a.addEventListener("keypress",m),a!==window&&(window.addEventListener("blur",h),window.addEventListener("keyup",m),window.addEventListener("keydown",m),window.addEventListener("keypress",m)))}function L(){G&&(G=!1,a.removeEventListener("mousemove",t),a.removeEventListener("mousedown",A),a.removeEventListener("mouseup",x),a.removeEventListener("mouseleave",e),a.removeEventListener("mouseenter",e),a.removeEventListener("mouseout",e),a.removeEventListener("mouseover",
e),a.removeEventListener("blur",h),a.removeEventListener("keyup",m),a.removeEventListener("keydown",m),a.removeEventListener("keypress",m),a!==window&&(window.removeEventListener("blur",h),window.removeEventListener("keyup",m),window.removeEventListener("keydown",m),window.removeEventListener("keypress",m)))}k||(k=a,a=window);var w=0,r=0,p=0,b={shift:!1,alt:!1,control:!1,meta:!1},G=!1;q();var ha={element:a};Object.defineProperties(ha,{enabled:{get:function(){return G},set:function(a){a?q():L},enumerable:!0},
buttons:{get:function(){return w},enumerable:!0},x:{get:function(){return r},enumerable:!0},y:{get:function(){return p},enumerable:!0},mods:{get:function(){return b},enumerable:!0}});return ha};var d=h("mouse-event")},{"mouse-event":31}],31:[function(h,m,t){function d(a){return a.target||a.srcElement||window}t.buttons=function(a){if("object"===typeof a){if("buttons"in a)return a.buttons;if("which"in a){a=a.which;if(2===a)return 4;if(3===a)return 2;if(0<a)return 1<<a-1}else if("button"in a){a=a.button;
if(1===a)return 4;if(2===a)return 2;if(0<=a)return 1<<a}}return 0};t.element=d;t.x=function(a){if("object"===typeof a){if("offsetX"in a)return a.offsetX;var k=d(a).getBoundingClientRect();return a.clientX-k.left}return 0};t.y=function(a){if("object"===typeof a){if("offsetY"in a)return a.offsetY;var k=d(a).getBoundingClientRect();return a.clientY-k.top}return 0}},{}],32:[function(h,m,t){var d=h("./lib/util/extend"),a=h("./lib/dynamic"),k=h("./lib/util/raf"),f=h("./lib/util/clock"),c=h("./lib/strings"),
e=h("./lib/webgl"),y=h("./lib/extension"),I=h("./lib/limits"),R=h("./lib/buffer"),A=h("./lib/elements"),x=h("./lib/texture"),q=h("./lib/renderbuffer"),L=h("./lib/framebuffer"),w=h("./lib/attribute"),r=h("./lib/shader"),p=h("./lib/read"),b=h("./lib/core");m.exports=function(){function h(){U=k.next(h);O.count+=1;var a=f();O.deltaTime=(a-V)/1E3;O.time=(a-aa)/1E3;V=a;C();for(a=0;a<Q.length;++a)(0,Q[a])(O,null,0)}function m(a){}function t(a){}function v(b){function c(b){var d={},e={};Object.keys(b).forEach(function(c){var f=
b[c];a.isDynamic(f)?e[c]=a.unbox(f,c):d[c]=f});return{dynamic:e,"static":d}}function e(a){for(;q.length<a;)q.push(null);return q}var f=c(b.context||{}),k=c(b.uniforms||{}),h=c(b.attributes||{});b=c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=d({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(b));var f=fa.compile(b,
h,k,f),m=f.draw,p=f.batch,v=f.scope,q=[];return function(a,b){var c;if("function"===typeof a)return v.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(c=0;c<a;++c)v.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)v.call(this,a[c],b,c);else return v.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,e(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return m.call(this,a)}}function P(){fa.procs.poll()}
function C(){var a=ma.viewport,b=ma.scissor_box;a[0]=a[1]=b[0]=b[1]=0;O.viewportWidth=O.frameBufferWidth=O.drawingBufferWidth=a[2]=b[2]=z.drawingBufferWidth;O.viewportHeight=O.frameBufferWidth=O.drawingBufferHeight=a[3]=b[3]=z.drawingBufferHeight;fa.procs.refresh()}var N=e(Array.prototype.slice.call(arguments)),z=N.gl,da=N.options,N=c(),F=y(z).extensions,aa=f(),V=aa,S=z.drawingBufferWidth,oa=z.drawingBufferHeight,O={count:0,deltaTime:0,time:0,viewportWidth:S,viewportHeight:oa,framebufferWidth:S,framebufferHeight:oa,
drawingBufferWidth:S,drawingBufferHeight:oa,pixelRatio:da.pixelRatio},J=I(z,F),K=R(z),S=A(z,F,K),oa=w(z,F,J,K,N),ea=r(z,N),ba=x(z,F,J,P,O),ka=q(z,F,J),la=L(z,F,J,ba,ka),sa=p(z,P,O),fa=b(z,N,F,J,K,S,ba,la,{},oa,ea,{elements:null,primitive:4,count:-1,offset:0,instances:-1},O),ma=fa.next,T=z.canvas,Q=[],U=0;T&&(T.addEventListener("webglcontextlost",m,!1),T.addEventListener("webglcontextrestored",t,!1));C();return d(v,{clear:function(a){var b=0;P();var c=a.color;c&&(z.clearColor(+c[0]||0,+c[1]||0,+c[2]||
0,+c[3]||0),b|=16384);"depth"in a&&(z.clearDepth(+a.depth),b|=256);"stencil"in a&&(z.clearStencil(a.stencil|0),b|=1024);z.clear(b)},prop:a.define.bind(null,1),context:a.define.bind(null,2),"this":a.define.bind(null,3),draw:v({}),buffer:function(a){return K.create(a,34962)},elements:S.create,texture:ba.create2D,cube:ba.createCube,renderbuffer:ka.create,framebuffer:la.create,framebufferCube:function(a){},attributes:z.getContextAttributes(),frame:function(a){Q.push(a);!U&&0<Q.length&&h();return{cancel:function(){var b=
Q.find(function(b){return b===a});0>b||(Q.splice(b,1),0>=Q.length&&U&&(k.cancel(h),U=0))}}},limits:J,hasExtension:function(a){return 0<=J.extensions.indexOf(a.toLowerCase())},read:sa,destroy:function(){U&&(k.cancel(h),U=0);T&&(T.removeEventListener("webglcontextlost",m),T.removeEventListener("webglcontextrestored",t));ea.clear();la.clear();ka.clear();ba.clear();K.clear();if(da.onDestroy)da.onDestroy()},_gl:z,_refresh:C})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,
"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/strings":17,"./lib/texture":18,"./lib/util/clock":19,"./lib/util/extend":21,"./lib/util/raf":26,"./lib/webgl":29}],33:[function(h,m,t){function d(a){throw Error("resl: "+a);}function a(a,c,e){Object.keys(a).forEach(function(a){0>c.indexOf(a)&&d('invalid parameter "'+a+'" in '+e)})}function k(a,c){this.state=0;this.ready=!1;this.progress=0;this.name=a;this.cancel=c}var f=["manifest",
"onDone","onProgress","onError"],c=["type","src","stream","credentials","parser"],e=["onData","onDone"];m.exports=function(h){function m(a,b){if(a in h){var c=h[a];"function"!==typeof c&&d('invalid callback "'+a+'"');return c}return null}function t(a){function c(){if(!(2>m.readyState||1===r.state||-1===r.state)){if(200!==m.status)return x('error loading resource "'+a.name+'"');if(2<m.readyState&&0===r.state){var e;e="binary"===a.type?m.response:m.responseText;if(h.data)try{p=h.data(e)}catch(f){return x(f)}else p=
e}if(3<m.readyState&&0===r.state){if(h.done)try{p=h.done()}catch(f){return x(f)}r.state=1}b[d]=p;r.progress=.75*r.progress+.25;r.ready=a.stream&&!!p||1===r.state;q()}}var d=a.name,e=a.stream,f="binary"===a.type,h=a.parser,m=new XMLHttpRequest,p=null,r=new k(d,function(){1!==r.state&&-1!==r.state&&(m.onreadystatechange=null,m.abort(),r.state=-1)});m.onreadystatechange=e?c:function(){4===m.readyState&&c()};f&&(m.responseType="arraybuffer");a.credentials&&(m.withCredentials=!0);m.open("GET",a.src,!0);
m.send();return r}function A(a,c){function d(){if(0===r.state)if(t.data)try{w=t.data(c)}catch(a){return x(a)}else w=c}function e(c){d();b[p]=w;r.progress=c.lengthComputable?Math.max(r.progress,c.loaded/c.total):.75*r.progress+.25;r.ready=a.stream;q(p)}function f(){d();if(0===r.state){if(t.done)try{w=t.done()}catch(a){return x(a)}r.state=1}r.progress=1;r.ready=!0;b[p]=w;m();q("finish "+p)}function h(){x('error loading asset "'+p+'"')}function m(){a.stream&&c.removeEventListener("progress",e);"image"===
a.type?c.addEventListener("load",f):c.addEventListener("canplay",f);c.removeEventListener("error",h)}var p=a.name,t=a.parser,r=new k(p,function(){1!==r.state&&-1!==r.state&&(r.state=-1,m(),c.src="")}),w=c;a.stream&&c.addEventListener("progress",e);"image"===a.type?c.addEventListener("load",f):c.addEventListener("canplay",f);c.addEventListener("error",h);c.crossOrigin=a.credentials?"use-credentials":"anonymous";c.src=a.src;return r}function x(a){-1!==G&&1!==G&&(G=-1,B.forEach(function(a){a.cancel()}),
p?"string"===typeof a?p(Error("resl: "+a)):p(a):console.error("resl error:",a))}function q(a){if(-1!==G&&1!==G){var c=0,d=0;B.forEach(function(a){a.ready&&(d+=1);c+=a.progress});d===B.length?(G=1,w(b)):r&&r(c/B.length,a)}}"object"===typeof h&&h||d("invalid or missing configuration");a(h,f,"config");var L=h.manifest;"object"===typeof L&&L||d("missing manifest");var w=m("onDone");w||d("missing onDone() callback");var r=m("onProgress"),p=m("onError"),b={},G=0,ha={text:t,binary:function(a){return t(a)},
image:function(a){return A(a,document.createElement("img"))},video:function(a){return A(a,document.createElement("video"))},audio:function(a){return A(a,document.createElement("audio"))}},B=Object.keys(L).map(function(b){function f(a,b){if(a in h.parser){var c=h.parser[a];"function"!==typeof c&&d("invalid parser callback "+a+' for asset "'+a+'"');return c}return b}var h=L[b];"string"===typeof h?h={src:h}:"object"===typeof h&&h||d('invalid asset definition "'+b+'"');a(h,c,'asset "'+b+'"');var k={};
"parser"in h&&("function"===typeof h.parser?k={data:h.parser}:"object"===typeof h.parser&&h.parser?(a(k,e,'parser for asset "'+b+'"'),"onData"in k||d('missing onData callback for parser in asset "'+b+'"'),k={data:f("onData"),done:f("onDone")}):d('invalid parser for asset "'+b+'"'));return{name:b,type:function(a,c,e){a in h&&(e=h[a]);0>c.indexOf(e)&&d("invalid "+a+' "'+e+'" for asset "'+b+'", possible values: '+c);return e}("type",Object.keys(ha),"text"),stream:!!h.stream,credentials:!!h.credentials,
src:function(a,c,e){a in h?e=h[a]:c&&d("missing "+a+' for asset "'+b+'"');"string"!==typeof e&&d("invalid "+a+' for asset "'+b+'", must be a string');return e}("src",!0,""),parser:k}}).map(function(a){return ha[a.type](a)})}},{}]},{},[1]);
