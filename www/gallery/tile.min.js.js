(function e$$0(p,w,g){function b(f,d){if(!w[f]){if(!p[f]){var c="function"==typeof require&&require;if(!d&&c)return c(f,!0);if(u)return u(f,!0);c=Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}c=w[f]={exports:{}};p[f][0].call(c.exports,function(d){var c=p[f][1][d];return b(c?c:d)},c,c.exports,e$$0,p,w,g)}return w[f].exports}for(var u="function"==typeof require&&require,q=0;q<g.length;q++)b(g[q]);return b})({1:[function(h,p,w){var g=h("../regl")(),b=h("mouse-change")();h("resl")({manifest:{map:{type:"text",
src:"assets/map.json",parser:JSON.parse},tiles:{type:"image",src:"assets/tiles.png",parser:g.texture}},onDone:function(u){var q=u.map,f=g({frag:"\n      precision mediump float;\n      uniform sampler2D map, tiles;\n      uniform vec2 mapSize, tileSize;\n      varying vec2 uv;\n      void main() {\n        vec2 tileCoord = floor(255.0 * texture2D(map, floor(uv) / mapSize).ra);\n        gl_FragColor = texture2D(tiles, (tileCoord + fract(uv)) / tileSize);\n      }",vert:"\n      precision mediump float;\n      attribute vec2 position;\n      uniform vec4 view;\n      varying vec2 uv;\n      void main() {\n        uv = mix(view.xw, view.zy, 0.5 * (1.0 + position));\n        gl_Position = vec4(position, 1, 1);\n      }",
depth:{enable:!1},uniforms:{tiles:u.tiles,tileSize:[16,16],map:g.texture(q),mapSize:[q[0].length,q.length],view:g.prop("view")},attributes:{position:[-1,-1,1,-1,-1,1,1,1,-1,1,1,-1]},count:6});g.frame(function(d){var c=d.viewportWidth,g=d.viewportHeight;d=q[0].length*b.x/c;var u=q.length*b.y/g,c=c/g*10;f({view:[d-.5*c,u-5,d+.5*c,u+5]})})}})},{"../regl":36,"mouse-change":33,resl:35}],2:[function(h,p,w){function g(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=
!1;this.type=5126;this.divisor=this.stride=this.offset=0}p.exports=function(b,u,q,f,d){b=q.maxAttributes;u=Array(b);for(q=0;q<b;++q)u[q]=new g;return{Record:g,scope:{},state:u}}},{}],3:[function(h,p,w){function g(b){return V[Object.prototype.toString.call(b)]|0}function b(b,d){for(var f=0;f<d.length;++f)b[f]=d[f]}function u(b,d,f,c,g,u,t){for(var l=0,a=0;a<f;++a)for(var q=0;q<c;++q)b[l++]=d[g*a+u*q+t]}function q(b,d,f){for(var c=0,g=0;g<d.length;++g)for(var u=d[g],q=0;q<f;++q)b[c++]=u[q]}var f=h("./util/is-typed-array"),
d=h("./util/is-ndarray"),c=h("./util/values"),y=h("./util/pool"),V=h("./constants/arraytypes.json"),A=h("./constants/dtypes.json"),x=h("./constants/usage.json"),t=[];t[5120]=1;t[5122]=2;t[5124]=4;t[5121]=1;t[5123]=2;t[5125]=4;t[5126]=4;p.exports=function(h,p,C){function e(a){this.id=l++;this.buffer=h.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;C.profile&&(this.stats={size:0})}function n(a,b,d){a.byteLength=b.byteLength;h.bufferData(a.type,b,d)}function H(a,
c,l,e,t){a.usage=l;if(Array.isArray(c))a.dtype=e||5126,0<c.length&&(Array.isArray(c[0])?(a.dimension=c[0].length,e=y.allocType(a.dtype,c.length*a.dimension),q(e,c,a.dimension),n(a,e,l),y.freeType(e)):"number"===typeof c[0]?(a.dimension=t,e=y.allocType(a.dtype,c.length),b(e,c),n(a,e,l),y.freeType(e)):f(c[0])&&(a.dimension=c[0].length,a.dtype=e||g(c[0])||5126,e=y.allocType(a.dtype,c.length*a.dimension),q(e,c,a.dimension),n(a,e,l),y.freeType(e)));else if(f(c))a.dtype=e||g(c),a.dimension=t,n(a,c,l);else if(d(c)){var h=
c.shape,C=c.stride;t=c.offset;var v=0,L=0,x=0,I=0;1===h.length?(v=h[0],L=1,x=C[0],I=0):2===h.length&&(v=h[0],L=h[1],x=C[0],I=C[1]);a.dtype=e||g(c.data)||5126;a.dimension=L;e=y.allocType(a.dtype,v*L);u(e,c.data,v,L,x,I,t);n(a,e,l);y.freeType(e)}}function D(b){p.bufferCount--;h.deleteBuffer(b.buffer);b.buffer=null;delete a[b.id]}var l=0,a={};e.prototype.bind=function(){h.bindBuffer(this.type,this.buffer)};e.prototype.destroy=function(){D(this)};var L=[];C.profile&&(p.getTotalBufferSize=function(){var b=
0;Object.keys(a).forEach(function(c){b+=a[c].stats.size});return b});return{create:function(c,l,n){function L(a){var b=35044,c=null,l=0,g=0,e=1;Array.isArray(a)||f(a)||d(a)?c=a:"number"===typeof a?l=a|0:a&&("data"in a&&(c=a.data),"usage"in a&&(b=x[a.usage]),"type"in a&&(g=A[a.type]),"dimension"in a&&(e=a.dimension|0),"length"in a&&(l=a.length|0));B.bind();c?H(B,c,b,g,e):(h.bufferData(B.type,l,b),B.dtype=g||5121,B.usage=b,B.dimension=e,B.byteLength=l);C.profile&&(B.stats.size=B.byteLength*t[B.dtype]);
return L}p.bufferCount++;var B=new e(l);a[B.id]=B;n||L(c);L._reglType="buffer";L._buffer=B;L.subdata=function(a,c){var l=(c||0)|0;B.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var e=y.allocType(B.dtype,a.length);b(e,a);h.bufferSubData(B.type,l,e);y.freeType(e)}else if(Array.isArray(a[0])||f(a[0])){var e=a[0].length,n=y.allocType(B.dtype,a.length*e);q(n,a,e);h.bufferSubData(B.type,l,n);y.freeType(n)}}else if(f(a))h.bufferSubData(B.type,l,a);else if(d(a)){var I=a.shape,t=a.stride,
C=n=e=0,x=0;1===I.length?(e=I[0],n=1,C=t[0],x=0):2===I.length&&(e=I[0],n=I[1],C=t[0],x=t[1]);I=Array.isArray(a.data)?B.dtype:g(a.data);I=y.allocType(I,e*n);u(I,a.data,e,n,C,x,a.offset);h.bufferSubData(B.type,l,I);y.freeType(I)}return L};C.profile&&(L.stats=B.stats);L.destroy=function(){D(B)};return L},createStream:function(a,b){var c=L.pop();c||(c=new e(a));c.bind();H(c,b,35040,0,1);return c},destroyStream:function(a){L.push(a)},clear:function(){c(a).forEach(D);L.forEach(D)},getBuffer:function(a){return a&&
a._buffer instanceof e?a._buffer:null},_initBuffer:H}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],4:[function(h,p,w){p.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,
"[object ArrayBuffer]":5121}},{}],5:[function(h,p,w){p.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(h,p,w){p.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(h,p,w){p.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(h,p,w){function g(b){return Array.isArray(b)||V(b)||A(b)}function b(b){return b.sort(function(a,
b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function u(b,a,c,d){this.thisDep=b;this.contextDep=a;this.propDep=c;this.append=d}function q(b){return b&&!(b.thisDep||b.contextDep||b.propDep)}function f(b){return new u(!1,!1,!1,b)}function d(b,a){var c=b.type;return 0===c?(c=b.data.length,new u(!0,1<=c,2<=c,a)):new u(3===c,2===c,1===c,a)}var c=h("./util/codegen"),y=h("./util/loop"),V=h("./util/is-typed-array"),A=h("./util/is-ndarray"),x=h("./util/is-array-like"),t=h("./constants/primitives.json"),
M=h("./constants/dtypes.json"),E=["x","y","z","w"],C={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},e={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,
"!=":517,"!==":517,gequal:518,">=":518,always:519},n={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},H={cw:2304,ccw:2305},D=new u(!1,!1,!1,function(){});p.exports=function(l,a,h,p,A,V,w,B,ya,F,v,W,ha,I,X){function Z(a){return a.replace(".","_")}function R(a,G,b){var c=Z(a);J.push(a);k[c]=aa[c]=!!b;z[c]=G}function O(a,G,b){var c=Z(a);J.push(a);Array.isArray(b)?(aa[c]=b.slice(),k[c]=b.slice()):aa[c]=k[c]=b;pa[c]=G}function P(){var m=
c(),G=m.link,b=m.global;m.id=Ka++;m.batchId="0";var k=G(Ja),d=m.shared={props:"a0"};Object.keys(Ja).forEach(function(a){d[a]=b.def(k,".",a)});var K=m.next={},f=m.current={};Object.keys(pa).forEach(function(a){Array.isArray(aa[a])&&(K[a]=b.def(d.next,".",a),f[a]=b.def(d.current,".",a))});var r=m.constants={};Object.keys(Da).forEach(function(a){r[a]=b.def(JSON.stringify(Da[a]))});m.invoke=function(a,r){switch(r.type){case 0:var b=["this",d.context,d.props,m.batchId];return a.def(G(r.data),".call(",
b.slice(0,Math.max(r.data.length+1,4)),")");case 1:return a.def(d.props,r.data);case 2:return a.def(d.context,r.data);case 3:return a.def("this",r.data)}};m.attribCache={};var Ha={};m.scopeAttrib=function(r){r=a.id(r);if(r in Ha)return Ha[r];var m=F.scope[r];m||(m=F.scope[r]=new ma);return Ha[r]=G(m)};return m}function S(a){var b=a["static"];a=a.dynamic;var k;if("profile"in b){var c=!!b.profile;k=f(function(a,m){return c});k.enable=c}else if("profile"in a){var ba=a.profile;k=d(ba,function(a,m){return a.invoke(m,
ba)})}return k}function ia(a){var b=a["static"];a=a.dynamic;if("framebuffer"in b){var k=b.framebuffer;return k?(k=B.getFramebuffer(k),f(function(a,m){var b=a.link(k),r=a.shared;m.set(r.framebuffer,".next",b);r=r.context;m.set(r,".framebufferWidth",b+".width");m.set(r,".framebufferHeight",b+".height");return b})):f(function(a,m){var b=a.shared;m.set(b.framebuffer,".next","null");b=b.context;m.set(b,".framebufferWidth",b+".drawingBufferWidth");m.set(b,".framebufferHeight",b+".drawingBufferHeight");
return"null"})}if("framebuffer"in a){var c=a.framebuffer;return d(c,function(a,m){var b=a.invoke(m,c),r=a.shared,G=r.framebuffer,b=m.def(G,".getFramebuffer(",b,")");m.set(G,".next",b);r=r.context;m.set(r,".framebufferWidth",b+"?"+b+".width:"+r+".drawingBufferWidth");m.set(r,".framebufferHeight",b+"?"+b+".height:"+r+".drawingBufferHeight");return b})}return null}function qa(a,b){function k(a){if(a in c){var m=c[a];a=!0;var va=m.x|0,Q=m.y|0,e,K;"width"in m?e=m.width|0:a=!1;"height"in m?K=m.height|0:
a=!1;return new u(!a&&b&&b.thisDep,!a&&b&&b.contextDep,!a&&b&&b.propDep,function(a,r){var b=a.shared.context,k=e;"width"in m||(k=r.def(b,".","framebufferWidth","-",va));var c=K;"height"in m||(c=r.def(b,".","framebufferHeight","-",Q));return[va,Q,k,c]})}if(a in f){var g=f[a];a=d(g,function(a,r){var b=a.invoke(r,g),m=a.shared.context,k=r.def(b,".x|0"),c=r.def(b,".y|0"),G=r.def('"width" in ',b,"?",b,".width|0:","(",m,".","framebufferWidth","-",k,")"),b=r.def('"height" in ',b,"?",b,".height|0:","(",m,
".","framebufferHeight","-",c,")");return[k,c,G,b]});b&&(a.thisDep=a.thisDep||b.thisDep,a.contextDep=a.contextDep||b.contextDep,a.propDep=a.propDep||b.propDep);return a}return b?new u(b.thisDep,b.contextDep,b.propDep,function(a,b){var r=a.shared.context;return[0,0,b.def(r,".","framebufferWidth"),b.def(r,".","framebufferHeight")]}):null}var c=a["static"],f=a.dynamic,K=k("viewport");if(K)var e=K,K=new u(K.thisDep,K.contextDep,K.propDep,function(a,b){var m=e.append(a,b),k=a.shared.context;b.set(k,".viewportWidth",
m[2]);b.set(k,".viewportHeight",m[3]);return m});return{viewport:K,scissor_box:k("scissor.box")}}function wa(b){function k(b){if(b in c){var m=a.id(c[b]);b=f(function(){return m});b.id=m;return b}if(b in e){var G=e[b];return d(G,function(a,b){var r=a.invoke(b,G);return b.def(a.shared.strings,".id(",r,")")})}return null}var c=b["static"],e=b.dynamic,ba=k("frag"),K=k("vert"),g=null;q(ba)&&q(K)?(g=v.program(K.id,ba.id),b=f(function(a,b){return a.link(g)})):b=new u(ba&&ba.thisDep||K&&K.thisDep,ba&&ba.contextDep||
K&&K.contextDep,ba&&ba.propDep||K&&K.propDep,function(a,b){var m=a.shared.shader,k;k=ba?ba.append(a,b):b.def(m,".","frag");var c;c=K?K.append(a,b):b.def(m,".","vert");return b.def(m+".program("+c+","+k+")")});return{frag:ba,vert:K,progVar:b,program:g}}function ja(a){function b(a,m){if(a in k){var G=k[a]|0;return f(function(a,b){m&&(a.OFFSET=G);return G})}if(a in c){var va=c[a];return d(va,function(a,b){var k=a.invoke(b,va);m&&(a.OFFSET=k);return k})}return m&&e?f(function(a,b){a.OFFSET="0";return 0}):
null}var k=a["static"],c=a.dynamic,e=function(){if("elements"in k){var a=k.elements;g(a)?a=V.getElements(V.create(a)):a&&(a=V.getElements(a));var b=f(function(b,m){if(a){var r=b.link(a);return b.ELEMENTS=r}return b.ELEMENTS=null});b.value=a;return b}if("elements"in c){var m=c.elements;return d(m,function(a,b){var r=a.shared,k=r.isBufferArgs,r=r.elements,c=a.invoke(b,m),G=b.def("null"),k=b.def(k,"(",c,")"),c=a.cond(k).then(G,"=",r,".createStream(",c,");")["else"](G,"=",r,".getElements(",c,");");b.entry(c);
b.exit(a.cond(k).then(r,".destroyStream(",G,");"));return a.ELEMENTS=G})}return null}(),K=b("offset",!0);return{elements:e,primitive:function(){if("primitive"in k){var a=k.primitive;return f(function(b,m){return t[a]})}if("primitive"in c){var b=c.primitive;return d(b,function(a,m){var k=a.constants.primTypes,c=a.invoke(m,b);return m.def(k,"[",c,"]")})}return e?q(e)?e.value?f(function(a,b){return b.def(a.ELEMENTS,".primType")}):f(function(){return 4}):new u(e.thisDep,e.contextDep,e.propDep,function(a,
b){var m=a.ELEMENTS;return b.def(m,"?",m,".primType:",4)}):null}(),count:function(){if("count"in k){var a=k.count|0;return f(function(){return a})}if("count"in c){var b=c.count;return d(b,function(a,m){return a.invoke(m,b)})}return e?q(e)?e?K?new u(K.thisDep,K.contextDep,K.propDep,function(a,b){return b.def(a.ELEMENTS,".vertCount-",a.OFFSET)}):f(function(a,b){return b.def(a.ELEMENTS,".vertCount")}):f(function(){return-1}):new u(e.thisDep||K.thisDep,e.contextDep||K.contextDep,e.propDep||K.propDep,
function(a,b){var m=a.ELEMENTS;return a.OFFSET?b.def(m,"?",m,".vertCount-",a.OFFSET,":-1"):b.def(m,"?",m,".vertCount:-1")}):null}(),instances:b("instances",!1),offset:K}}function ra(a){var b=a["static"],k=a.dynamic,c={};J.forEach(function(a){function m(r,e){if(a in b){var va=r(b[a]);c[g]=f(function(){return va})}else if(a in k){var K=k[a];c[g]=d(K,function(a,b){return e(a,b,a.invoke(b,K))})}}var g=Z(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return m(function(a){return a},
function(a,b,m){return m});case "depth.func":return m(function(a){return e[a]},function(a,b,m){return b.def(a.constants.compareFuncs,"[",m,"]")});case "depth.range":return m(function(a){return a},function(a,b,m){a=b.def("+",m,"[0]");b=b.def("+",m,"[1]");return[a,b]});case "blend.func":return m(function(a){return[C["srcRGB"in a?a.srcRGB:a.src],C["dstRGB"in a?a.dstRGB:a.dst],C["srcAlpha"in a?a.srcAlpha:a.src],C["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,b,m){function k(a,r){var G=b.def('"',a,r,'" in ',
m,"?",m,".",a,r,":",m,".",a);return b.def(c,"[",G,"]")}var c=a.constants.blendFuncs;a=k("src","RGB");var G=k("src","Alpha"),d=k("dst","RGB"),e=k("dst","Alpha");return[a,d,G,e]});case "blend.equation":return m(function(a){if("string"===typeof a)return[na[a],na[a]];if("object"===typeof a)return[na[a.rgb],na[a.alpha]]},function(a,b,m){var k=a.constants.blendEquations,c=b.def(),G=b.def();a=a.cond("typeof ",m,'==="string"');a.then(c,"=",G,"=",k,"[",m,"];");a["else"](c,"=",k,"[",m,".rgb];",G,"=",k,"[",
m,".alpha];");b(a);return[c,G]});case "blend.color":return m(function(a){return y(4,function(b){return+a[b]})},function(a,b,m){return y(4,function(a){return b.def("+",m,"[",a,"]")})});case "stencil.mask":return m(function(a){return a|0},function(a,b,m){return b.def(m,"|0")});case "stencil.func":return m(function(a){return[e[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,b,m){a=b.def('"cmp" in ',m,"?",a.constants.compareFuncs,"[",m,".cmp]",":",7680);var k=b.def(m,".ref|0");b=b.def('"mask" in ',
m,"?",m,".mask|0:-1");return[a,k,b]});case "stencil.opFront":case "stencil.opBack":return m(function(b){return["stencil.opBack"===a?1029:1028,n[b.fail||"keep"],n[b.zfail||"keep"],n[b.pass||"keep"]]},function(b,m,k){function c(a){return m.def('"',a,'" in ',k,"?",G,"[",k,".",a,"]:",7680)}var G=b.constants.stencilOps;return["stencil.opBack"===a?1029:1028,c("fail"),c("zfail"),c("pass")]});case "polygonOffset.offset":return m(function(a){return[a.factor|0,a.units|0]},function(a,b,m){a=b.def(m,".factor|0");
b=b.def(m,".units|0");return[a,b]});case "cull.face":return m(function(a){var b=0;"front"===a?b=1028:"back"===a&&(b=1029);return b},function(a,b,m){return b.def(m,'==="front"?',1028,":",1029)});case "lineWidth":return m(function(a){return a},function(a,b,m){return m});case "frontFace":return m(function(a){return H[a]},function(a,b,m){return b.def(m+'==="cw"?2304:2305')});case "colorMask":return m(function(a){return a.map(function(a){return!!a})},function(a,b,m){return y(4,function(a){return"!!"+m+
"["+a+"]"})});case "sample.coverage":return m(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,b,m){a=b.def('"value" in ',m,"?+",m,".value:1");b=b.def("!!",m,".invert");return[a,b]})}});return c}function ka(a){var b=a["static"],k=a.dynamic,c={};Object.keys(b).forEach(function(a){var m=b[a],k;"number"===typeof m||"boolean"===typeof m?k=f(function(){return m}):"function"!==typeof m||"texture2d"!==m._reglType&&"textureCube"!==m._reglType?x(m)&&(k=f(function(a){return a.global.def("[",
y(m.length,function(a){return m[a]}),"]")})):k=f(function(a){return a.link(m)});k.value=m;c[a]=k});Object.keys(k).forEach(function(a){var b=k[a];c[a]=d(b,function(a,m){return a.invoke(m,b)})});return c}function da(b){var k=b["static"],c=b.dynamic,e={};Object.keys(k).forEach(function(b){var m=k[b],c=a.id(b),r=new ma;if(g(m))r.state=1,r.buffer=A.getBuffer(A.create(m,34962,!1)),r.type=r.buffer.dtype;else{var d=A.getBuffer(m);if(d)r.state=1,r.buffer=d,r.type=d.dtype;else if(m.constant){var Q=m.constant;
r.state=2;"number"===typeof Q?r.x=Q:E.forEach(function(a,b){b<Q.length&&(r[a]=Q[b])})}else{var d=A.getBuffer(m.buffer),n=m.offset|0,l=m.stride|0,z=m.size|0,v=!!m.normalized,J=0;"type"in m&&(J=M[m.type]);m=m.divisor|0;r.buffer=d;r.state=1;r.size=z;r.normalized=v;r.type=J||d.dtype;r.offset=n;r.stride=l;r.divisor=m}}e[b]=f(function(a,b){var m=a.attribCache;if(c in m)return m[c];var k={isStream:!1};Object.keys(r).forEach(function(a){k[a]=r[a]});r.buffer&&(k.buffer=a.link(r.buffer));return m[c]=k})});
Object.keys(c).forEach(function(a){var b=c[a];e[a]=d(b,function(a,m){function k(a){m(f[a],"=",c,".",a,"|0;")}var c=a.invoke(m,b),G=a.shared,d=G.isBufferArgs,e=G.buffer,f={isStream:m.def(!1)},g=new ma;g.state=1;Object.keys(g).forEach(function(a){f[a]=m.def(""+g[a])});var Q=f.buffer,n=f.type;m("if(",d,"(",c,")){",f.isStream,"=true;",Q,"=",e,".createStream(",34962,",",c,");",n,"=",Q,".dtype;","}else{",Q,"=",e,".getBuffer(",c,");","if(",Q,"){",n,"=",Q,".dtype;","}else if(",c,".constant){",f.state,"=",
2,";",E.map(function(a,b){return f[a]+"="+c+".length>="+b+"?"+c+"["+b+"]:0;"}).join(""),"}else{",Q,"=",e,".getBuffer(",c,".buffer);",n,'="type" in ',c,"?",G.glTypes,"[",c,".type]:",Q,".dtype;",f.normalized,"=!!",c,".normalized;");k("size");k("offset");k("stride");k("divisor");m("}}");m.exit("if(",f.isStream,"){",e,".destroyStream(",Q,");","}");return f})});return e}function sa(a){var b=a["static"],k=a.dynamic,c={};Object.keys(b).forEach(function(a){var m=b[a];c[a]=f(function(a,b){return"number"===
typeof m||"boolean"===typeof m?""+m:a.link(m)})});Object.keys(k).forEach(function(a){var b=k[a];c[a]=d(b,function(a,m){return a.invoke(m,b)})});return c}function T(a,b,k){var c=a.shared.context,d=a.scope();Object.keys(k).forEach(function(e){b.save(c,"."+e);d(c,".",e,"=",k[e].append(a,b),";")});b(d)}function N(a,b,k){var c=a.shared,d=c.gl,e=c.framebuffer,f;ta&&(f=b.def(c.extensions,".webgl_draw_buffers"));var r=a.constants,c=r.drawBuffer,r=r.backBuffer;a=k?k.append(a,b):b.def(e,".next");b("if(",e,
".dirty||",a,"!==",e,".cur){","if(",a,"){",d,".bindFramebuffer(",36160,",",a,".framebuffer);");ta&&b(f,".drawBuffersWEBGL(",c,"[",a,".colorAttachments.length]);");b("}else{",d,".bindFramebuffer(",36160,",null);");ta&&b(f,".drawBuffersWEBGL(",r,");");b("}",e,".cur=",a,";",e,".dirty=false;","}")}function ca(a,b,k){var c=a.shared,e=c.gl,d=a.current,f=a.next,r=c.current,g=c.next,n=a.cond(r,".dirty");J.forEach(function(b){b=Z(b);if(!(b in k.state)){var c,G;if(b in f){c=f[b];G=d[b];var l=y(aa[b].length,
function(a){return n.def(c,"[",a,"]")});n(a.cond(l.map(function(a,b){return a+"!=="+G+"["+b+"]"}).join("||")).then(e,".",pa[b],"(",l,");",l.map(function(a,b){return G+"["+b+"]="+a}).join(";"),";"))}else c=n.def(g,".",b),l=a.cond(c,"!==",r,".",b),n(l),b in z?l(a.cond(c).then(e,".enable(",z[b],");")["else"](e,".disable(",z[b],");"),r,".",b,"=",c,";"):l(e,".",pa[b],"(",c,");",r,".",b,"=",c,";")}});0===Object.keys(k.state).length&&n(r,".dirty=false;");b(n)}function Ba(a,k,c,e){var d=a.shared,f=a.current,
g=d.current,r=d.gl;b(Object.keys(c)).forEach(function(b){var d=c[b];if(!e||e(d)){var n=d.append(a,k);if(z[b]){var l=z[b];q(d)?n?k(r,".enable(",l,");"):k(r,".disable(",l,");"):k(a.cond(n).then(r,".enable(",l,");")["else"](r,".disable(",l,");"));k(g,".",b,"=",n,";")}else if(x(n)){var v=f[b];k(r,".",pa[b],"(",n,");",n.map(function(a,b){return v+"["+b+"]="+a}).join(";"),";")}else k(r,".",pa[b],"(",n,");",g,".",b,"=",n,";")}})}function U(a,b){ea&&!a.instancing&&(a.instancing=b.def(a.shared.extensions,
".angle_instanced_arrays"))}function xa(a,b,k,c,e){function d(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function f(a){J=b.def();a(J,"=",d(),";");"string"===typeof e?a(l,".count+=",e,";"):a(l,".count++;");I&&(c?(t=b.def(),a(t,"=",v,".getNumPendingQueries();")):a(v,".beginQuery(",l,");"))}function r(a){a(l,".cpuTime+=",d(),"-",J,";");I&&(c?a(v,".pushScopeStats(",t,",",v,".getNumPendingQueries(),",l,");"):a(v,".endQuery();"))}function g(a){var m=b.def(z,".profile");b(z,
".profile=",a,";");b.exit(z,".profile=",m,";")}var n=a.shared,l=a.stats,z=n.current,v=n.timer;k=k.profile;var J,t;if(k){if(q(k)){k.enable?(f(b),r(b.exit),g("true")):g("false");return}k=k.append(a,b);g(k)}else k=b.def(z,".profile");n=a.block();f(n);b("if(",k,"){",n,"}");a=a.block();r(a);b.exit("if(",k,"){",a,"}")}function za(a,b,k,c,e){function d(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}
function f(k,c,e){function d(){b("if(!",z,".pointer){",n,".enableVertexAttribArray(",l,");",z,".pointer=true;}");var k=e.type,f;f=e.size?b.def(e.size,"||",c):c;b("if(",z,".type!==",k,"||",z,".size!==",f,"||",J.map(function(a){return z+"."+a+"!=="+e[a]}).join("||"),"){",n,".bindBuffer(",34962,",",v,".buffer);",n,".vertexAttribPointer(",[l,f,k,e.normalized,e.stride,e.offset],");",z,".type=",k,";",z,".size=",f,";",J.map(function(a){return z+"."+a+"="+e[a]+";"}).join(""),"}");ea&&(k=e.divisor,b("if(",
z,".divisor!==",k,"){",a.instancing,".vertexAttribDivisorANGLE(",[l,k],");",z,".divisor=",k,";}"))}function g(){b("if(",z,".pointer){",n,".disableVertexAttribArray(",l,");",z,".pointer=false;","}if(",E.map(function(a,b){return z+"."+a+"!=="+Q[b]}).join("||"),"){",n,".vertexAttrib4f(",l,",",Q,");",E.map(function(a,b){return z+"."+a+"="+Q[b]+";"}).join(""),"}")}var n=r.gl,l=b.def(k,".location"),z=b.def(r.attributes,"[",l,"]");k=e.state;var v=e.buffer,Q=[e.x,e.y,e.z,e.w],J=["buffer","normalized","offset",
"stride"];1===k?d():2===k?g():(b("if(",k,"===",1,"){"),d(),b("}else{"),g(),b("}"))}var r=a.shared;c.forEach(function(c){var r=c.name,g=k.attributes[r],n;if(g){if(!e(g))return;n=g.append(a,b)}else{if(!e(D))return;var l=a.scopeAttrib(r);n={};Object.keys(new ma).forEach(function(a){n[a]=b.def(l,".",a)})}f(a.link(c),d(c.info.type),n)})}function Aa(b,k,c,e,d){for(var f=b.shared,g=f.gl,r,n=0;n<e.length;++n){var l=e[n],z=l.name,v=l.info.type,J=c.uniforms[z],l=b.link(l)+".location",t;if(J){if(!d(J))continue;
if(q(J)){z=J.value;if(35678===v||35680===v)v=b.link(z._texture),k(g,".uniform1i(",l,",",v+".bind());"),k.exit(v,".unbind();");else if(35674===v||35675===v||35676===v)z=b.global.def("new Float32Array(["+Array.prototype.slice.call(z)+"])"),J=2,35675===v?J=3:35676===v&&(J=4),k(g,".uniformMatrix",J,"fv(",l,",false,",z,");");else{switch(v){case 5126:r="1f";break;case 35664:r="2f";break;case 35665:r="3f";break;case 35666:r="4f";break;case 35670:r="1i";break;case 5124:r="1i";break;case 35671:r="2i";break;
case 35667:r="2i";break;case 35672:r="3i";break;case 35668:r="3i";break;case 35673:r="4i";break;case 35669:r="4i"}k(g,".uniform",r,"(",l,",",x(z)?Array.prototype.slice.call(z):z,");")}continue}else t=J.append(b,k)}else{if(!d(D))continue;t=k.def(f.uniforms,"[",a.id(z),"]")}z=1;switch(v){case 35678:case 35680:v=k.def(t,"._texture");k(g,".uniform1i(",l,",",v,".bind());");k.exit(v,".unbind();");continue;case 5124:case 35670:r="1i";break;case 35667:case 35671:r="2i";z=2;break;case 35668:case 35672:r="3i";
z=3;break;case 35669:case 35673:r="4i";z=4;break;case 5126:r="1f";break;case 35664:r="2f";z=2;break;case 35665:r="3f";z=3;break;case 35666:r="4f";z=4;break;case 35674:r="Matrix2fv";break;case 35675:r="Matrix3fv";break;case 35676:r="Matrix4fv"}k(g,".uniform",r,"(",l,",");if("M"===r.charAt(0)){var l=Math.pow(v-35674+2,2),h=b.global.def("new Float32Array(",l,")");k("false,(Array.isArray(",t,")||",t," instanceof Float32Array)?",t,":(",y(l,function(a){return h+"["+a+"]="+t+"["+a+"]"}),",",h,")")}else 1<
z?k(y(z,function(a){return t+"["+a+"]"})):k(t);k(");")}}function fa(a,b,k,c){function e(d){var f=l[d];return f?f.contextDep&&c.contextDynamic||f.propDep?f.append(a,k):f.append(a,b):b.def(n,".",d)}function d(){function a(){k(I,".drawElementsInstancedANGLE(",[v,t,u,J+"<<(("+u+"-5121)>>1)",h],");")}function b(){k(I,".drawArraysInstancedANGLE(",[v,J,t,h],");")}z?C?a():(k("if(",z,"){"),a(),k("}else{"),b(),k("}")):b()}function f(){function a(){k(g+".drawElements("+[v,t,u,J+"<<(("+u+"-5121)>>1)"]+");")}
function b(){k(g+".drawArrays("+[v,J,t]+");")}z?C?a():(k("if(",z,"){"),a(),k("}else{"),b(),k("}")):b()}var r=a.shared,g=r.gl,n=r.draw,l=c.draw,z=function(){var e=l.elements,d=b;if(e){if(e.contextDep&&c.contextDynamic||e.propDep)d=k;e=e.append(a,d)}else e=d.def(n,".","elements");e&&d("if("+e+")"+g+".bindBuffer(34963,"+e+".buffer.buffer);");return e}(),v=e("primitive"),J=e("offset"),t=function(){var e=l.count,d=b;if(e){if(e.contextDep&&c.contextDynamic||e.propDep)d=k;e=e.append(a,d)}else e=d.def(n,
".","count");return e}();if("number"===typeof t){if(0===t)return}else k("if(",t,"){"),k.exit("}");var h,I;ea&&(h=e("instances"),I=a.instancing);var u=z+".type",C=l.elements&&q(l.elements);ea&&("number"!==typeof h||0<=h)?"string"===typeof h?(k("if(",h,">0){"),d(),k("}else if(",h,"<0){"),f(),k("}")):d():f()}function ga(a,b,k,c,e){b=P();e=b.proc("body",e);ea&&(b.instancing=e.def(b.shared.extensions,".angle_instanced_arrays"));a(b,e,k,c);return b.compile().body}function la(a,b,k,c){U(a,b);za(a,b,k,c.attributes,
function(){return!0});Aa(a,b,k,c.uniforms,function(){return!0});fa(a,b,b,k)}function Ia(a,b){var k=a.proc("draw",1);U(a,k);T(a,k,b.context);N(a,k,b.framebuffer);ca(a,k,b);Ba(a,k,b.state);xa(a,k,b,!1,!0);var c=b.shader.progVar.append(a,k);k(a.shared.gl,".useProgram(",c,".program);");if(b.shader.program)la(a,k,b,b.shader.program);else{var e=a.global.def("{}"),d=k.def(c,".id"),f=k.def(e,"[",d,"]");k(a.cond(f).then(f,".call(this,a0);")["else"](f,"=",e,"[",d,"]=",a.link(function(k){return ga(la,a,b,k,
1)}),"(",c,");",f,".call(this,a0);"))}0<Object.keys(b.state).length&&k(a.shared.current,".dirty=true;")}function Ea(a,b,k,c){function e(){return!0}a.batchId="a1";U(a,b);za(a,b,k,c.attributes,e);Aa(a,b,k,c.uniforms,e);fa(a,b,b,k)}function Ca(a,b,k,c){function e(a){return a.contextDep&&f||a.propDep}function d(a){return!e(a)}U(a,b);var f=k.contextDep,r=b.def(),g=b.def();a.shared.props=g;a.batchId=r;var l=a.scope(),n=a.scope();b(l.entry,"for(",r,"=0;",r,"<","a1",";++",r,"){",g,"=","a0","[",r,"];",n,"}",
l.exit);k.needsContext&&T(a,n,k.context);k.needsFramebuffer&&N(a,n,k.framebuffer);Ba(a,n,k.state,e);k.profile&&e(k.profile)&&xa(a,n,k,!1,!0);c?(za(a,l,k,c.attributes,d),za(a,n,k,c.attributes,e),Aa(a,l,k,c.uniforms,d),Aa(a,n,k,c.uniforms,e),fa(a,l,n,k)):(b=a.global.def("{}"),c=k.shader.progVar.append(a,n),g=n.def(c,".id"),l=n.def(b,"[",g,"]"),n(a.shared.gl,".useProgram(",c,".program);","if(!",l,"){",l,"=",b,"[",g,"]=",a.link(function(b){return ga(Ea,a,k,b,2)}),"(",c,");}",l,".call(this,a0[",r,"],",
r,");"))}function Fa(a,b){function k(a){return a.contextDep&&e||a.propDep}var c=a.proc("batch",2);a.batchId="0";U(a,c);var e=!1,d=!0;Object.keys(b.context).forEach(function(a){e=e||b.context[a].propDep});e||(T(a,c,b.context),d=!1);var f=b.framebuffer,n=!1;f?(f.propDep?e=n=!0:f.contextDep&&e&&(n=!0),n||N(a,c,f)):N(a,c,null);b.state.viewport&&b.state.viewport.propDep&&(e=!0);ca(a,c,b);Ba(a,c,b.state,function(a){return!k(a)});b.profile&&k(b.profile)||xa(a,c,b,!1,"a1");b.contextDep=e;b.needsContext=d;
b.needsFramebuffer=n;d=b.shader.progVar;if(d.contextDep&&e||d.propDep)Ca(a,c,b,null);else if(d=d.append(a,c),c(a.shared.gl,".useProgram(",d,".program);"),b.shader.program)Ca(a,c,b,b.shader.program);else{var f=a.global.def("{}"),n=c.def(d,".id"),l=c.def(f,"[",n,"]");c(a.cond(l).then(l,".call(this,a0,a1);")["else"](l,"=",f,"[",n,"]=",a.link(function(k){return ga(Ca,a,b,k,2)}),"(",d,");",l,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Ga(k,c){function e(a){var b=
c.shader[a];b&&d.set(f.shader,"."+a,b.append(k,d))}var d=k.proc("scope",3);k.batchId="a2";var f=k.shared,n=f.current;T(k,d,c.context);c.framebuffer&&c.framebuffer.append(k,d);b(Object.keys(c.state)).forEach(function(a){var b=c.state[a].append(k,d);x(b)?b.forEach(function(b,c){d.set(k.next[a],"["+c+"]",b)}):d.set(f.next,"."+a,b)});xa(k,d,c,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(a){var b=c.draw[a];b&&d.set(f.draw,"."+a,""+b.append(k,d))});Object.keys(c.uniforms).forEach(function(b){d.set(f.uniforms,
"["+a.id(b)+"]",c.uniforms[b].append(k,d))});Object.keys(c.attributes).forEach(function(a){var b=c.attributes[a].append(k,d),e=k.scopeAttrib(a);Object.keys(new ma).forEach(function(a){d.set(e,"."+a,b[a])})});e("vert");e("frag");0<Object.keys(c.state).length&&(d(n,".dirty=true;"),d.exit(n,".dirty=true;"));d("a1(",k.shared.context,",a0,0);")}var ma=F.Record,na={add:32774,subtract:32778,"reverse subtract":32779};h.ext_blend_minmax&&(na.min=32775,na.max=32776);var ea=h.angle_instanced_arrays,ta=h.webgl_draw_buffers,
aa={dirty:!0,profile:X.profile},k={},J=[],z={},pa={};R("dither",3024);R("blend.enable",3042);O("blend.color","blendColor",[0,0,0,0]);O("blend.equation","blendEquationSeparate",[32774,32774]);O("blend.func","blendFuncSeparate",[1,0,1,0]);R("depth.enable",2929,!0);O("depth.func","depthFunc",513);O("depth.range","depthRange",[0,1]);O("depth.mask","depthMask",!0);O("colorMask","colorMask",[!0,!0,!0,!0]);R("cull.enable",2884);O("cull.face","cullFace",1029);O("frontFace","frontFace",2305);O("lineWidth",
"lineWidth",1);R("polygonOffset.enable",32823);O("polygonOffset.offset","polygonOffset",[0,0]);R("sample.alpha",32926);R("sample.enable",32928);O("sample.coverage","sampleCoverage",[1,!1]);R("stencil.enable",2960);O("stencil.mask","stencilMask",-1);O("stencil.func","stencilFunc",[519,0,-1]);O("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);O("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);R("scissor.enable",3089);O("scissor.box","scissor",[0,0,l.drawingBufferWidth,l.drawingBufferHeight]);
O("viewport","viewport",[0,0,l.drawingBufferWidth,l.drawingBufferHeight]);var Ja={gl:l,context:ha,strings:a,next:k,current:aa,draw:W,elements:V,buffer:A,shader:v,attributes:F.state,uniforms:ya,framebuffer:B,extensions:h,timer:I,isBufferArgs:g},Da={primTypes:t,compareFuncs:e,blendFuncs:C,blendEquations:na,stencilOps:n,glTypes:M,orientationType:H};ta&&(Da.backBuffer=[1029],Da.drawBuffer=y(p.maxDrawbuffers,function(a){return 0===a?[0]:y(a,function(a){return 36064+a})}));var Ka=0;return{next:k,current:aa,
procs:function(){var a=P(),b=a.proc("poll"),k=a.proc("refresh"),c=a.block();b(c);k(c);var e=a.shared,d=e.gl,f=e.next,n=e.current;c(n,".dirty=false;");N(a,b);k(e.framebuffer,".dirty=true;");N(a,k);Object.keys(z).forEach(function(e){var l=z[e],g=c.def(f,".",e),v=a.block();v("if(",g,"){",d,".enable(",l,")}else{",d,".disable(",l,")}",n,".",e,"=",g,";");k(v);b("if(",g,"!==",n,".",e,"){",v,"}")});Object.keys(pa).forEach(function(e){var l=pa[e],g=aa[e],z,v,J=a.block();J(d,".",l,"(");x(g)?(l=g.length,z=a.global.def(f,
".",e),v=a.global.def(n,".",e),J(y(l,function(a){return z+"["+a+"]"}),");",y(l,function(a){return v+"["+a+"]="+z+"["+a+"];"}).join("")),b("if(",y(l,function(a){return z+"["+a+"]!=="+v+"["+a+"]"}).join("||"),"){",J,"}")):(z=c.def(f,".",e),v=c.def(n,".",e),J(z,");",n,".",e,"=",z,";"),b("if(",z,"!==",v,"){",J,"}"));k(J)});return a.compile()}(),compile:function(a,b,k,c,e){var d=P();d.stats=d.link(e);e=ia(a);var f=qa(a,e),n=ja(a),l=ra(a),g=wa(a),z=f.viewport;z&&(l.viewport=z);z=Z("scissor.box");(f=f[z])&&
(l[z]=f);f=0<Object.keys(l).length;e={framebuffer:e,draw:n,shader:g,state:l,dirty:f};e.profile=S(a);e.uniforms=ka(k);e.attributes=da(b);e.context=sa(c);Ia(d,e);Ga(d,e);Fa(d,e);return d.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],9:[function(h,p,w){function g(b,d){this.id=q++;this.type=b;this.data=d}function b(f){if(0===f.length)return[];var d=f.charAt(0),
c=f.charAt(f.length-1);if(1<f.length&&d===c&&('"'===d||"'"===d))return['"'+f.substr(1,f.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(d=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(f))return b(f.substr(0,d.index)).concat(b(d[1])).concat(b(f.substr(d.index+d[0].length)));d=f.split(".");if(1===d.length)return['"'+f.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];f=[];for(c=0;c<d.length;++c)f=f.concat(b(d[c]));return f}function u(f){return"["+b(f).join("][")+"]"}var q=0;p.exports={define:function(b,
d){return new g(b,u(d+""))},isDynamic:function(b){return"function"===typeof b&&!b._reglType||b instanceof g},unbox:function(b,d){return"function"===typeof b?new g(0,b):b},accessor:u}},{}],10:[function(h,p,w){var g=h("./util/is-typed-array"),b=h("./util/is-ndarray"),u=h("./util/values"),q=h("./constants/primitives.json"),f=h("./constants/usage.json");p.exports=function(d,c,h,p){function A(b){this.id=E++;M[this.id]=this;this.buffer=b;this.primType=4;this.type=this.vertCount=0}function x(e,d,f,l,a,t,
u){(t=u)||g(d)&&(!b(d)||g(d.data))||(t=c.oes_element_index_uint?5125:5123);e.buffer.bind();h._initBuffer(e.buffer,d,f,t,3);d=u;if(!u){switch(e.buffer.dtype){case 5121:case 5120:d=5121;break;case 5123:case 5122:d=5123;break;case 5125:case 5124:d=5125}e.buffer.dtype=d}e.type=d;0>a&&(a=e.buffer.byteLength,5123===d?a>>=1:5125===d&&(a>>=2));e.vertCount=a;a=l;0>l&&(a=4,l=e.buffer.dimension,1===l&&(a=0),2===l&&(a=1),3===l&&(a=4));e.primType=a}function t(b){p.elementsCount--;delete M[b.id];b.buffer.destroy();
b.buffer=null}var M={},E=0,C={uint8:5121,uint16:5123};c.oes_element_index_uint&&(C.uint32=5125);A.prototype.bind=function(){this.buffer.bind()};var e=[];return{create:function(c){function e(a){if(a)if("number"===typeof a)u(a),l.primType=4,l.vertCount=a|0,l.type=5121;else{var c=null,n=35044,t=-1,h=-1,y=0,p=0;Array.isArray(a)||g(a)||b(a)?c=a:("data"in a&&(c=a.data),"usage"in a&&(n=f[a.usage]),"primitive"in a&&(t=q[a.primitive]),"count"in a&&(h=a.count|0),"length"in a&&(y=a.length|0),"type"in a&&(p=
C[a.type]));c?x(l,c,n,t,h,y,p):(a=l.buffer,a.bind(),d.bufferData(34963,y,n),a.dtype=p||5121,a.usage=n,a.dimension=3,a.byteLength=y,l.primType=0>t?4:t,l.vertCount=0>h?0:h,l.type=a.dtype)}else u(),l.primType=4,l.vertCount=0,l.type=5121;return e}var u=h.create(null,34963,!0),l=new A(u._buffer);p.elementsCount++;e(c);e._reglType="elements";e._elements=l;e.subdata=function(a,b){u.subdata(a,b);return e};e.destroy=function(){t(l)};return e},createStream:function(b){var c=e.pop();c||(c=new A(h.create(null,
34963,!0)._buffer));x(c,b,35040,-1,-1,0,0);return c},destroyStream:function(b){e.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof A?b._elements:null},clear:function(){u(M).forEach(t)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],11:[function(h,p,w){p.exports=function(g,b){function h(b){b=b.toLowerCase();if(b in q)return!0;var d;try{d=q[b]=g.getExtension(b)}catch(f){}return!!d}
for(var q={},f=0;f<b.extensions.length;++f){var d=b.extensions[f];if(!h(d))return b.onDestroy(),b.onDone('"'+d+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}b.optionalExtensions.forEach(h);return{extensions:q,refresh:function(){b.extensions.forEach(h);b.optionalExtensions.forEach(h)}}}},{}],12:[function(h,p,w){var g=h("./util/values"),b=h("./util/extend"),u=[];u[6408]=4;var q=[];q[5121]=1;q[5126]=4;q[36193]=2;p.exports=function(f,
d,c,h,p,A){function x(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var e=a=0;b?(a=b.width,e=b.height):c&&(a=c.width,e=c.height);this.width=a;this.height=e}function t(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function M(a,b,c){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function E(a,b){b?b.texture?f.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,0):f.framebufferRenderbuffer(36160,
a,36161,b.renderbuffer._renderbuffer.renderbuffer):f.framebufferTexture2D(36160,a,3553,null,0)}function C(a){var b=3553,c=null,e=null,d=a;"object"===typeof a&&(d=a.data,"target"in a&&(b=a.target|0));a=d._reglType;"texture2d"===a?c=d:"textureCube"===a?c=d:"renderbuffer"===a&&(e=d,b=36161);return new x(b,c,e)}function e(a,b,c,e,d){if(c)return a=h.create2D({width:a,height:b,format:e,type:d}),a._texture.refCount=0,new x(3553,a,null);a=p.create({width:a,height:b,format:e});a._renderbuffer.refCount=0;return new x(36161,
null,a)}function n(a){return a&&(a.texture||a.renderbuffer)}function H(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function D(){this.id=ya++;F[this.id]=this;this.framebuffer=f.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function l(a){a.colorAttachments.forEach(t);t(a.depthAttachment);t(a.stencilAttachment);t(a.depthStencilAttachment)}function a(a){f.deleteFramebuffer(a.framebuffer);
a.framebuffer=null;A.framebufferCount--;delete F[a.id]}function L(a){var b;f.bindFramebuffer(36160,a.framebuffer);var e=a.colorAttachments;for(b=0;b<e.length;++b)E(36064+b,e[b]);for(b=e.length;b<c.maxColorAttachments;++b)E(36064+b,null);E(36096,a.depthAttachment);E(36128,a.stencilAttachment);E(33306,a.depthStencilAttachment);f.checkFramebufferStatus(36160);f.bindFramebuffer(36160,w.next);w.current=w.next}function Y(c,f){function g(a,b){var c,f=0,h=0,v=!0,y=!0;c=null;var x=!0,p="rgba",A="uint8",B=
1,E=null,Y=null,V=null,w=!1;if("number"===typeof a)f=a|0,h=b|0||f;else if(a){"shape"in a?(h=a.shape,f=h[0],h=h[1]):("radius"in a&&(f=h=a.radius),"width"in a&&(f=a.width),"height"in a&&(h=a.height));if("color"in a||"colors"in a)c=a.color||a.colors,Array.isArray(c);c||("colorCount"in a&&(B=a.colorCount|0),"colorTexture"in a&&(x=!!a.colorTexture,p="rgba4"),"colorType"in a&&(A=a.colorType,x||("half float"===A?d.ext_color_buffer_half_float&&(p="rgba16f"):"float"===A&&d.webgl_color_buffer_float&&(p="rgba32f"))),
"colorFormat"in a&&(p=a.colorFormat,0<=oa.indexOf(p)?x=!0:0<=ua.indexOf(p)&&(x=!1)));if("depthTexture"in a||"depthStencilTexture"in a)w=!(!a.depthTexture&&!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?v=a.depth:(E=a.depth,y=!1));"stencil"in a&&("boolean"===typeof a.stencil?y=a.stencil:(Y=a.stencil,v=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?v=y=a.depthStencil:(V=a.depthStencil,y=v=!1))}else f=h=1;var D=null,H=null,F=null,U=null;if(Array.isArray(c))D=c.map(C);else if(c)D=
[C(c)];else for(D=Array(B),c=0;c<B;++c)D[c]=e(f,h,x,p,A);f=f||D[0].width;h=h||D[0].height;E?H=C(E):v&&!y&&(H=e(f,h,w,"depth","uint32"));Y?F=C(Y):y&&!v&&(F=e(f,h,!1,"stencil","uint8"));V?U=C(V):!E&&!Y&&y&&v&&(U=e(f,h,w,"depth stencil","depth stencil"));v=null;for(c=0;c<D.length;++c)M(D[c],f,h),D[c]&&D[c].texture&&(y=u[D[c].texture._texture.format]*q[D[c].texture._texture.type],null===v&&(v=y));M(H,f,h);M(F,f,h);M(U,f,h);l(t);t.width=f;t.height=h;t.colorAttachments=D;t.depthAttachment=H;t.stencilAttachment=
F;t.depthStencilAttachment=U;g.color=D.map(n);g.depth=n(H);g.stencil=n(F);g.depthStencil=n(U);g.width=t.width;g.height=t.height;L(t);return g}var t=new D;A.framebufferCount++;g(c,f);return b(g,{resize:function(a,b){var c=a|0,e=b|0||c;if(c===t.width&&e===t.height)return g;for(var d=t.colorAttachments,f=0;f<d.length;++f)H(d[f],c,e);H(t.depthAttachment,c,e);H(t.stencilAttachment,c,e);H(t.depthStencilAttachment,c,e);t.width=g.width=c;t.height=g.height=e;L(t);return g},_reglType:"framebuffer",_framebuffer:t,
destroy:function(){a(t);l(t)}})}var w={current:null,next:null,dirty:!1},oa=["rgba"],ua=["rgba4","rgb565","rgb5 a1"];d.ext_srgb&&ua.push("srgba");d.ext_color_buffer_half_float&&ua.push("rgba16f","rgb16f");d.webgl_color_buffer_float&&ua.push("rgba32f");var B=["uint8"];d.oes_texture_half_float&&B.push("half float");d.oes_texture_float&&B.push("float");var ya=0,F={};return b(w,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof D)?a:null},
create:Y,createCube:function(a){function c(a){var d={color:null},f=0,g=null,l="rgba",n="uint8",t=1;if("number"===typeof a)f=a|0;else if(a){"shape"in a?f=a.shape[0]:("radius"in a&&(f=a.radius|0),"width"in a?f=a.width|0:"height"in a&&(f=a.height|0));if("color"in a||"colors"in a)g=a.color||a.colors,Array.isArray(g);g||("colorCount"in a&&(t=a.colorCount|0),"colorType"in a&&(n=a.colorType),"colorFormat"in a&&(l=a.colorFormat));"depth"in a&&(d.depth=a.depth);"stencil"in a&&(d.stencil=a.stencil);"depthStencil"in
a&&(d.depthStencil=a.depthStencil)}else f=1;var u;if(g)if(Array.isArray(g))for(a=0;a<g.length;++a);else u=[g];else for(u=Array(t),g={radius:f,format:l,type:n},a=0;a<t;++a)u[a]=h.createCube(g);d.color=Array(u.length);for(a=0;a<u.length;++a)t=u[a],f=f||t.width,d.color[a]={target:34069,data:u[a]};for(a=0;6>a;++a){for(t=0;t<u.length;++t)d.color[t].target=34069+a;0<a&&(d.depth=e[0].depth,d.stencil=e[0].stencil,d.depthStencil=e[0].depthStencil);if(e[a])e[a](d);else e[a]=Y(d)}return b(c,{width:f,height:f,
color:u})}var e=Array(6);c(a);return b(c,{faces:e,resize:function(a){for(var b=0;6>b;++b)e[b].resize(a);return c},_reglType:"framebufferCube",destroy:function(){e.forEach(function(a){a.destroy()})}})},clear:function(){g(F).forEach(a)}})}},{"./util/extend":23,"./util/values":31}],13:[function(h,p,w){p.exports=function(g,b){var h=1;b.ext_texture_filter_anisotropic&&(h=g.getParameter(34047));var q=1,f=1;b.webgl_draw_buffers&&(q=g.getParameter(34852),f=g.getParameter(36063));return{colorBits:[g.getParameter(3410),
g.getParameter(3411),g.getParameter(3412),g.getParameter(3413)],depthBits:g.getParameter(3414),stencilBits:g.getParameter(3415),subpixelBits:g.getParameter(3408),extensions:Object.keys(b).filter(function(d){return!!b[d]}),maxAnisotropic:h,maxDrawbuffers:q,maxColorAttachments:f,pointSizeDims:g.getParameter(33901),lineWidthDims:g.getParameter(33902),maxViewportDims:g.getParameter(3386),maxCombinedTextureUnits:g.getParameter(35661),maxCubeMapSize:g.getParameter(34076),maxRenderbufferSize:g.getParameter(34024),
maxTextureUnits:g.getParameter(34930),maxTextureSize:g.getParameter(3379),maxAttributes:g.getParameter(34921),maxVertexUniforms:g.getParameter(36347),maxVertexTextureUnits:g.getParameter(35660),maxVaryingVectors:g.getParameter(36348),maxFragmentUniforms:g.getParameter(36349),glsl:g.getParameter(35724),renderer:g.getParameter(7937),vendor:g.getParameter(7936),version:g.getParameter(7938)}}},{}],14:[function(h,p,w){var g=h("./util/is-typed-array");p.exports=function(b,h,q,f,d){return function(c){var d=
0,h=0,u=f.framebufferWidth,x=f.framebufferHeight,t=null;g(c)?t=c:c&&(d=c.x|0,h=c.y|0,u=(c.width||f.framebufferWidth-d)|0,x=(c.height||f.framebufferHeight-h)|0,t=c.data||null);q();t=t||new Uint8Array(u*x*4);b.pixelStorei(3333,4);b.readPixels(d,h,u,x,6408,5121,t);return t}}},{"./util/is-typed-array":26}],15:[function(h,p,w){var g=h("./util/values"),b=[];b[32854]=2;b[32855]=2;b[36194]=2;b[33189]=2;b[36168]=1;b[34041]=4;b[35907]=4;b[34836]=16;b[34842]=8;b[34843]=6;p.exports=function(h,q,f,d,c){function y(b){this.id=
x++;this.refCount=1;this.renderbuffer=b;this.format=32854;this.height=this.width=0;c.profile&&(this.stats={size:0})}function p(b){var c=b.renderbuffer;h.bindRenderbuffer(36161,null);h.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete t[b.id];d.renderbufferCount--}var A={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};q.ext_srgb&&(A.srgba=35907);q.ext_color_buffer_half_float&&(A.rgba16f=34842,A.rgb16f=34843);q.webgl_color_buffer_float&&(A.rgba32f=
34836);var x=0,t={};y.prototype.decRef=function(){0>=--this.refCount&&p(this)};c.profile&&(d.getTotalRenderbufferSize=function(){var b=0;Object.keys(t).forEach(function(c){b+=t[c].stats.size});return b});return{create:function(f,g){function q(d,f){var g=0,l=0,a=32854;"object"===typeof d&&d?("shape"in d?(l=d.shape,g=l[0]|0,l=l[1]|0):("radius"in d&&(g=l=d.radius|0),"width"in d&&(g=d.width|0),"height"in d&&(l=d.height|0)),"format"in d&&(a=A[d.format])):"number"===typeof d?(g=d|0,l="number"===typeof f?
f|0:g):d||(g=l=1);if(g!==e.width||l!==e.height||a!==e.format)return q.width=e.width=g,q.height=e.height=l,e.format=a,h.bindRenderbuffer(36161,e.renderbuffer),h.renderbufferStorage(36161,a,g,l),c.profile&&(e.stats.size=b[e.format]*e.width*e.height),q}var e=new y(h.createRenderbuffer());t[e.id]=e;d.renderbufferCount++;q(f,g);q.resize=function(d,f){var g=d|0,l=f|0||g;if(g===e.width&&l===e.height)return q;q.width=e.width=g;q.height=e.height=l;h.bindRenderbuffer(36161,e.renderbuffer);h.renderbufferStorage(36161,
e.format,g,l);c.profile&&(e.stats.size=b[e.format]*e.width*e.height);return q};q._reglType="renderbuffer";q._renderbuffer=e;c.profile&&(q.stats=e.stats);q.destroy=function(){e.decRef()};return q},clear:function(){g(t).forEach(p)}}}},{"./util/values":31}],16:[function(h,p,w){var g=h("./util/values");p.exports=function(b,h,q,f){function d(b,c,d,f){this.name=b;this.id=c;this.location=d;this.info=f}function c(b,c){for(var d=0;d<b.length;++d)if(b[d].id===c.id){b[d].location=c.location;return}b.push(c)}
function y(c,e,d){d=35632===c?A:x;var f=d[e];if(!f){var g=h.str(e),f=b.createShader(c);b.shaderSource(f,g);b.compileShader(f);d[e]=f}return f}function p(b,c){this.id=E++;this.fragId=b;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[];f.profile&&(this.stats={uniformsCount:0,attributesCount:0})}var A={},x={},t={},M=[],E=0;f.profile&&(q.getMaxUniformsCount=function(){var b=0;M.forEach(function(c){c.stats.uniformsCount>b&&(b=c.stats.uniformsCount)});return b},q.getMaxAttributesCount=
function(){var b=0;M.forEach(function(c){c.stats.attributesCount>b&&(b=c.stats.attributesCount)});return b});return{clear:function(){var c=b.deleteShader.bind(b);g(A).forEach(c);A={};g(x).forEach(c);x={};M.forEach(function(c){b.deleteProgram(c.program)});M.length=0;t={};q.shaderCount=0},program:function(g,e,n){q.shaderCount++;(n=t[e])||(n=t[e]={});var x=n[g];if(!x){var A=x=new p(e,g),l,a;l=y(35632,A.fragId);a=y(35633,A.vertId);e=A.program=b.createProgram();b.attachShader(e,l);b.attachShader(e,a);
b.linkProgram(e);var L=b.getProgramParameter(e,35718);f.profile&&(A.stats.uniformsCount=L);var E=A.uniforms;for(l=0;l<L;++l)if(a=b.getActiveUniform(e,l))if(1<a.size)for(var w=0;w<a.size;++w){var oa=a.name.replace("[0]","["+w+"]");c(E,new d(oa,h.id(oa),b.getUniformLocation(e,oa),a))}else c(E,new d(a.name,h.id(a.name),b.getUniformLocation(e,a.name),a));L=b.getProgramParameter(e,35721);f.profile&&(A.stats.attributesCount=L);A=A.attributes;for(l=0;l<L;++l)(a=b.getActiveAttrib(e,l))&&c(A,new d(a.name,
h.id(a.name),b.getAttribLocation(e,a.name),a));n[g]=x;M.push(x)}return x},shader:y,frag:null,vert:null}}},{"./util/values":31}],17:[function(h,p,w){p.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(h,p,w){p.exports=function(){var g={"":0},b=[""];return{id:function(h){var q=g[h];if(q)return q;q=g[h]=b.length;b.push(h);return q},str:function(g){return b[g]}}}},{}],19:[function(h,
p,w){function g(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function b(a){return Array.isArray(a)&&0!==a.length&&M(a[0])?!0:!1}function u(a){return Object.prototype.toString.call(a)}function q(a){if(!a)return!1;var c=u(a);return 0<=H.indexOf(c)?!0:g(a)||b(a)||A(a)}function f(a,b){36193===a.type?(a.data=t(b),x.freeType(b)):a.data=b}function d(a,b,c,e,d,f){a="undefined"!==typeof l[a]?l[a]:n[a]*D[b];f&&(a*=6);if(d){for(e=0;1<=c;)e+=a*c*c,c/=2;return e}return a*c*e}var c=h("./util/extend"),
y=h("./util/values"),V=h("./util/is-typed-array"),A=h("./util/is-ndarray"),x=h("./util/pool"),t=h("./util/to-half-float"),M=h("./util/is-array-like");w=h("./constants/arraytypes.json");var E=h("./constants/arraytypes.json"),C=[9984,9986,9985,9987],e=[0,6409,6410,6407,6408],n={};n[6409]=n[6406]=n[6402]=1;n[34041]=n[6410]=2;n[6407]=n[35904]=3;n[6408]=n[35906]=4;var H=Object.keys(w).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),
D=[];D[5121]=1;D[5126]=4;D[36193]=2;D[5123]=2;D[5125]=4;var l=[];l[32854]=2;l[32855]=2;l[36194]=2;l[34041]=4;l[33776]=.5;l[33777]=.5;l[33778]=1;l[33779]=1;l[35986]=.5;l[35987]=1;l[34798]=1;l[35840]=.5;l[35841]=.25;l[35842]=.5;l[35843]=.25;l[36196]=.5;p.exports=function(a,l,h,p,w,D,B){function H(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function F(a,b){a.internalformat=
b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function v(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=Aa[b.colorSpace]);"type"in b&&(a.type=
fa[b.type]);var c=a.width,d=a.height,f=a.channels,g=!1;"shape"in b?(c=b.shape[0],d=b.shape[1],3===b.shape.length&&(f=b.shape[2],g=!0)):("radius"in b&&(c=d=b.radius),"width"in b&&(c=b.width),"height"in b&&(d=b.height),"channels"in b&&(f=b.channels,g=!0));a.width=c|0;a.height=d|0;a.channels=f|0;c=!1;"format"in b&&(c=b.format,d=a.internalformat=ga[c],a.format=Ca[d],c in fa&&!("type"in b)&&(a.type=fa[c]),c in la&&(a.compressed=!0),c=!0);!g&&c?a.channels=n[a.format]:g&&!c&&a.channels!==e[a.format]&&(a.format=
a.internalformat=e[a.channels])}}function W(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function ha(){H.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function I(a,c){var d=null;q(c)?d=c:c&&(v(a,c),"x"in c&&(a.xOffset=c.x|0),"y"in c&&(a.yOffset=c.y|0),q(c.data)&&(d=c.data));if(c.copy){var l=w.viewportWidth,h=w.viewportHeight;a.width=a.width||
l-a.xOffset;a.height=a.height||h-a.yOffset;a.needsCopy=!0}else if(!d)a.width=a.width||1,a.height=a.height||1;else if(V(d))a.data=d,"type"in c||5121!==a.type||(a.type=E[Object.prototype.toString.call(d)]|0);else if(g(d)){l=d;h=a.width*a.height*a.channels;switch(a.type){case 5121:case 5123:case 5125:case 5126:h=x.allocType(a.type,h);h.set(l);a.data=h;break;case 36193:a.data=t(l)}a.alignment=1;a.needsFree=!0}else if(A(d)){l=d.data;Array.isArray(l)||5121!==a.type||(a.type=E[Object.prototype.toString.call(l)]|
0);var h=d.shape,n=d.stride,p,m,y,B;3===h.length?(y=h[2],B=n[2]):B=y=1;p=h[0];m=h[1];h=n[0];n=n[1];a.alignment=1;a.width=p;a.height=m;a.channels=y;a.format=a.internalformat=e[y];a.needsFree=!0;p=B;d=d.offset;y=a.width;B=a.height;m=a.channels;for(var C=x.allocType(36193===a.type?5126:a.type,y*B*m),L=0,F=0;F<B;++F)for(var Y=0;Y<y;++Y)for(var r=0;r<m;++r)C[L++]=l[h*Y+n*F+p*r+d];f(a,C)}else if("[object HTMLCanvasElement]"===u(d)||"[object CanvasRenderingContext2D]"===u(d))"[object HTMLCanvasElement]"===
u(d)?a.element=d:a.element=d.canvas,a.width=a.element.width,a.height=a.element.height;else if("[object HTMLImageElement]"===u(d))a.element=d,a.width=d.naturalWidth,a.height=d.naturalHeight;else if("[object HTMLVideoElement]"===u(d))a.element=d,a.width=d.videoWidth,a.height=d.videoHeight,a.needsPoll=!0;else if(b(d)){l=d[0].length;h=d.length;n=1;if(M(d[0][0])){p=n=d[0][0].length;y=x.allocType(36193===a.type?5126:a.type,l*h*p);for(m=B=0;m<h;++m)for(C=d[m],L=0;L<l;++L)for(F=C[L],Y=0;Y<p;++Y)y[B++]=F[Y];
f(a,y)}else{p=x.allocType(36193===a.type?5126:a.type,l*h);for(B=y=0;B<h;++B)for(m=d[B],C=0;C<l;++C)p[y++]=m[C];f(a,p)}a.alignment=1;a.width=l;a.height=h;a.channels=n;a.format=a.internalformat=e[n];a.needsFree=!0}}function X(b,c,d,e,f){var g=b.element,l=b.data,m=b.internalformat,h=b.format,t=b.type,n=b.width,q=b.height;W(b);g?a.texSubImage2D(c,f,d,e,h,t,g):b.compressed?a.compressedTexSubImage2D(c,f,d,e,m,n,q,l):b.needsCopy?(p(),a.copyTexSubImage2D(c,f,d,e,b.xOffset,b.yOffset,n,q)):a.texSubImage2D(c,
f,d,e,n,q,h,t,l)}function Z(){return Fa.pop()||new ha}function R(a){a.needsFree&&x.freeType(a.data);ha.call(a);Fa.push(a)}function O(){H.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function P(a,b,c){var d=a.images[0]=Z();a.mipmask=1;d.width=a.width=b;d.height=a.height=c}function S(a,b){var c=null;if(q(b))c=a.images[0]=Z(),F(c,a),I(c,b),a.mipmask=1;else if(v(a,b),Array.isArray(b.mipmap))for(var d=b.mipmap,e=0;e<d.length;++e)c=a.images[e]=Z(),F(c,a),c.width>>=
e,c.height>>=e,I(c,d[e]),a.mipmask|=1<<e;else c=a.images[0]=Z(),F(c,a),I(c,b),a.mipmask=1;F(a,a.images[0])}function ia(b,c){for(var d=b.images,e=0;e<d.length&&d[e];++e){var f=d[e],g=c,l=e,m=f.element,h=f.data,t=f.internalformat,n=f.format,q=f.type,u=f.width,y=f.height;W(f);m?a.texImage2D(g,l,n,n,q,m):f.compressed?a.compressedTexImage2D(g,l,t,u,y,0,h):f.needsCopy?(p(),a.copyTexImage2D(g,l,n,f.xOffset,f.yOffset,u,y,0)):a.texImage2D(g,l,n,u,y,0,n,q,h)}}function qa(){var a=Ga.pop()||new O;H.call(a);for(var b=
a.mipmask=0;16>b;++b)a.images[b]=null;return a}function wa(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&R(b[c]),b[c]=null;Ga.push(a)}function ja(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ra(a,b){"min"in b&&(a.minFilter=za[b.min],0<=C.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=xa[b.mag]);var c=a.wrapS,d=a.wrapT;if("wrap"in b){var e=b.wrap;"string"===typeof e?c=d=U[e]:Array.isArray(e)&&
(c=U[e[0]],d=U[e[1]])}else"wrapS"in b&&(c=U[b.wrapS]),"wrapT"in b&&(d=U[b.wrapT]);a.wrapS=c;a.wrapT=d;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=Ba[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function ka(b,c){a.texParameteri(c,10241,b.minFilter);a.texParameteri(c,10240,b.magFilter);a.texParameteri(c,10242,b.wrapS);a.texParameteri(c,
10243,b.wrapT);l.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(c))}function da(){var a=ma.pop()||new ja;ja.call(a);return a}function sa(b){H.call(this);this.mipmask=0;this.internalformat=6408;this.id=na++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;B.profile&&(this.stats={size:0})}function T(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function N(){var b=
aa[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function ca(b){var c=b.texture,d=b.unit,e=b.target;0<=d&&(a.activeTexture(33984+d),a.bindTexture(e,null),aa[d]=null);a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete ea[b.id];D.textureCount--}var Ba={"don't care":4352,"dont care":4352,nice:4354,fast:4353},U={repeat:10497,clamp:33071,mirror:33648},xa={nearest:9728,linear:9729},za=c({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,
"linear mipmap linear":9987,mipmap:9987},xa),Aa={none:0,browser:37444},fa={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},ga={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},la={};l.ext_srgb&&(ga.srgb=35904,ga.srgba=35906);l.oes_texture_float&&(fa["float"]=5126);l.oes_texture_half_float&&(fa.float16=fa["half float"]=36193);l.webgl_depth_texture&&(c(ga,{depth:6402,"depth stencil":34041}),c(fa,{uint16:5123,uint32:5125,"depth stencil":34042}));
l.webgl_compressed_texture_s3tc&&c(la,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});l.webgl_compressed_texture_atc&&c(la,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});l.webgl_compressed_texture_pvrtc&&c(la,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});l.webgl_compressed_texture_etc1&&(la["rgb etc1"]=36196);var Ia=Array.prototype.slice.call(a.getParameter(34467));
Object.keys(la).forEach(function(a){var b=la[a];0<=Ia.indexOf(b)&&(ga[a]=b)});var Ea=Object.keys(ga);h.textureFormats=Ea;var Ca=Ea.reduce(function(a,b){var c=ga[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),Fa=[],Ga=[],ma=[],na=0,ea={},ta=h.maxTextureUnits,aa=Array(ta).map(function(){return null});c(sa.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<ta;++c){var d=aa[c];if(d){if(0<
d.bindCount)continue;d.unit=-1}aa[c]=this;b=c;break}B.profile&&D.maxTextureUnits<b+1&&(D.maxTextureUnits=b+1);this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&ca(this)}});B.profile&&(D.getTotalTextureSize=function(){var a=0;Object.keys(ea).forEach(function(b){a+=ea[b].stats.size});return a});return{create2D:function(b,c){function e(a,b){var c=da(),g=qa();"number"===typeof a?"number"===typeof b?
P(g,a|0,b|0):P(g,a|0,a|0):a?(ra(c,a),S(g,a)):P(g,1,1);c.genMipmaps&&(g.mipmask=(g.width<<1)-1);f.mipmask=g.mipmask;F(f,g);f.internalformat=g.internalformat;e.width=g.width;e.height=g.height;T(f);ia(g,3553);ka(c,3553);N();ma.push(c);wa(g);B.profile&&(f.stats.size=d(f.internalformat,f.type,g.width,g.height,c.genMipmaps,!1));return e}var f=new sa(3553);ea[f.id]=f;D.textureCount++;e(b,c);e.subimage=function(a,b,c,d){b|=0;c|=0;d|=0;var g=Z();F(g,f);g.width>>=d;g.height>>=d;g.width-=b;g.height-=c;I(g,a);
T(f);X(g,3553,b,c,d);N();R(g);return e};e.resize=function(b,c){var g=b|0,k=c|0||g;if(g===f.width&&k===f.height)return e;e.width=f.width=g;e.height=f.height=k;T(f);a.texImage2D(3553,0,f.format,g,k,0,f.format,f.type,null);N();B.profile&&(f.stats.size=d(f.internalformat,f.type,g,k,!1,!1));return e};e._reglType="texture2d";e._texture=f;B.profile&&(e.stats=f.stats);e.destroy=function(){f.decRef()};return e},createCube:function(b,c,e,f,g,l){function h(a,b,c,e,f,g){var k,l=da();for(k=0;6>k;++k)n[k]=qa();
if("number"===typeof a||!a)for(a=a|0||1,k=0;6>k;++k)P(n[k],a,a);else if("object"===typeof a)if(b)S(n[0],a),S(n[1],b),S(n[2],c),S(n[3],e),S(n[4],f),S(n[5],g);else if(ra(l,a),v(m,a),"faces"in a)for(a=a.faces,k=0;6>k;++k)F(n[k],m),S(n[k],a[k]);else for(k=0;6>k;++k)S(n[k],a);F(m,n[0]);m.mipmask=l.genMipmaps?(n[0].width<<1)-1:n[0].mipmask;m.internalformat=n[0].internalformat;h.width=n[0].width;h.height=n[0].height;T(m);for(k=0;6>k;++k)ia(n[k],34069+k);ka(l,34067);N();B.profile&&(m.stats.size=d(m.internalformat,
m.type,h.width,h.height,l.genMipmaps,!0));ma.push(l);for(k=0;6>k;++k)wa(n[k]);return h}var m=new sa(34067);ea[m.id]=m;D.cubeCount++;var n=Array(6);h(b,c,e,f,g,l);h.subimage=function(a,b,c,d,e){c|=0;d|=0;e|=0;var f=Z();F(f,m);f.width>>=e;f.height>>=e;f.width-=c;f.height-=d;I(f,b);T(m);X(f,34069+a,c,d,e);N();R(f);return h};h.resize=function(b){b|=0;if(b!==m.width){h.width=m.width=b;h.height=m.height=b;T(m);for(var c=0;6>c;++c)a.texImage2D(34069+c,0,m.format,b,b,0,m.format,m.type,null);N();B.profile&&
(m.stats.size=d(m.internalformat,m.type,h.width,h.height,!1,!0));return h}};h._reglType="textureCube";h._texture=m;B.profile&&(h.stats=m.stats);h.destroy=function(){m.decRef()};return h},clear:function(){for(var b=0;b<ta;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),aa[b]=null;y(ea).forEach(ca);D.cubeCount=0;D.textureCount=0},getTexture:function(a){return null}}}},{"./constants/arraytypes.json":4,"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,
"./util/pool":28,"./util/to-half-float":30,"./util/values":31}],20:[function(h,p,w){p.exports=function(g,b){function h(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function q(b,c,d){var f=y.pop()||new h;f.startQueryIndex=b;f.endQueryIndex=c;f.sum=0;f.stats=d;p.push(f)}var f=b.ext_disjoint_timer_query;if(!f)return null;var d=[],c=[],y=[],p=[],A=[],x=[];return{beginQuery:function(b){var g=d.pop()||f.createQueryEXT();f.beginQueryEXT(35007,g);c.push(g);q(c.length-1,c.length,
b)},endQuery:function(){f.endQueryEXT(35007)},pushScopeStats:q,update:function(){var b,g;b=c.length;if(0!==b){x.length=Math.max(x.length,b+1);A.length=Math.max(A.length,b+1);A[0]=0;var h=x[0]=0;for(g=b=0;g<c.length;++g){var q=c[g];f.getQueryObjectEXT(q,34919)?(h+=f.getQueryObjectEXT(q,34918),d.push(q)):c[b++]=q;A[g+1]=h;x[g+1]=b}c.length=b;for(g=b=0;g<p.length;++g){var h=p[g],e=h.startQueryIndex,q=h.endQueryIndex;h.sum+=A[q]-A[e];e=x[e];q=x[q];q===e?(h.stats.gpuTime+=h.sum/1E6,y.push(h)):(h.startQueryIndex=
e,h.endQueryIndex=q,p[b++]=h)}p.length=b}},getNumPendingQueries:function(){return c.length},clear:function(){d.push.apply(d,c);for(var b=0;b<d.length;b++)f.deleteQueryEXT(d[b]);c.length=0;d.length=0}}}},{}],21:[function(h,p,w){p.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(h,p,w){function g(b){return Array.prototype.slice.call(b)}function b(b){return g(b).join("")}var u=h("./extend");p.exports=function(){function h(){var c=
[],f=[];return u(function(){c.push.apply(c,g(arguments))},{def:function(){var b="v"+d++;f.push(b);0<arguments.length&&(c.push(b,"="),c.push.apply(c,g(arguments)),c.push(";"));return b},toString:function(){return b([0<f.length?"var "+f+";":"",b(c)])}})}function f(){function b(e,f){d(e,f,"=",c.def(e,f),";")}var c=h(),d=h(),f=c.toString,p=d.toString;return u(function(){c.apply(c,g(arguments))},{def:c.def,entry:c,exit:d,save:b,set:function(d,f,g){b(d,f);c(d,f,"=",g,";")},toString:function(){return f()+
p()}})}var d=0,c=[],p=[],w=h(),A={};return{global:w,link:function(b){for(var f=0;f<p.length;++f)if(p[f]===b)return c[f];f="g"+d++;c.push(f);p.push(b);return f},block:h,proc:function(c,d){function g(){var b="a"+h.length;h.push(b);return b}var h=[];d=d||0;for(var q=0;q<d;++q)g();var q=f(),e=q.toString;return A[c]=u(q,{arg:g,toString:function(){return b(["function(",h.join(),"){",e(),"}"])}})},scope:f,cond:function(){var c=b(arguments),d=f(),h=f(),q=d.toString,p=h.toString;return u(d,{then:function(){d.apply(d,
g(arguments));return this},"else":function(){h.apply(h,g(arguments));return this},toString:function(){var d=p();d&&(d="else{"+d+"}");return b(["if(",c,"){",q(),"}",d])}})},compile:function(){var d=['"use strict";',w,"return {"];Object.keys(A).forEach(function(b){d.push('"',b,'":',A[b].toString(),",")});d.push("}");var f=b(d).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,c.concat(f)).apply(null,p)}}}},{"./extend":23}],23:[function(h,p,w){p.exports=function(g,
b){for(var h=Object.keys(b),q=0;q<h.length;++q)g[h[q]]=b[h[q]];return g}},{}],24:[function(h,p,w){var g=h("./is-typed-array");p.exports=function(b){return Array.isArray(b)||g(b)}},{"./is-typed-array":26}],25:[function(h,p,w){var g=h("./is-typed-array");p.exports=function(b){return!!b&&"object"===typeof b&&Array.isArray(b.shape)&&Array.isArray(b.stride)&&"number"===typeof b.offset&&b.shape.length===b.stride.length&&(Array.isArray(b.data)||g(b.data))}},{"./is-typed-array":26}],26:[function(h,p,w){var g=
h("../constants/arraytypes.json");p.exports=function(b){return Object.prototype.toString.call(b)in g}},{"../constants/arraytypes.json":4}],27:[function(h,p,w){p.exports=function(g,b){for(var h=Array(g),q=0;q<g;++q)h[q]=b(q);return h}},{}],28:[function(h,p,w){function g(b){var d,c;d=(65535<b)<<4;b>>>=d;c=(255<b)<<3;b>>>=c;d|=c;c=(15<b)<<2;b>>>=c;d|=c;c=(3<b)<<1;return d|c|b>>>c>>1}function b(b){a:{for(var d=16;268435456>=d;d*=16)if(b<=d){b=d;break a}b=0}d=q[g(b)>>2];return 0<d.length?d.pop():new ArrayBuffer(b)}
function u(b){q[g(b.byteLength)>>2].push(b)}var q=h("./loop")(8,function(){return[]});p.exports={alloc:b,free:u,allocType:function(f,d){var c=null;switch(f){case 5120:c=new Int8Array(b(d),0,d);break;case 5121:c=new Uint8Array(b(d),0,d);break;case 5122:c=new Int16Array(b(2*d),0,d);break;case 5123:c=new Uint16Array(b(2*d),0,d);break;case 5124:c=new Int32Array(b(4*d),0,d);break;case 5125:c=new Uint32Array(b(4*d),0,d);break;case 5126:c=new Float32Array(b(4*d),0,d);break;default:return null}return c.length!==
d?c.subarray(0,d):c},freeType:function(b){u(b.buffer)}}},{"./loop":27}],29:[function(h,p,w){p.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(g){return requestAnimationFrame(g)},cancel:function(g){return cancelAnimationFrame(g)}}:{next:function(g){return setTimeout(g,16)},cancel:clearTimeout}},{}],30:[function(h,p,w){var g=h("./pool"),b=new Float32Array(1),u=new Uint32Array(b.buffer);p.exports=function(h){for(var f=g.allocType(5123,h.length),
d=0;d<h.length;++d)if(isNaN(h[d]))f[d]=65535;else if(Infinity===h[d])f[d]=31744;else if(-Infinity===h[d])f[d]=64512;else{b[0]=h[d];var c=u[0],p=c>>>31<<15,w=(c<<1>>>24)-127,c=c>>13&1023;f[d]=-24>w?p:-14>w?p+(c+1024>>-14-w):15<w?p+31744:p+(w+15<<10)+c}return f}},{"./pool":28}],31:[function(h,p,w){p.exports=function(g){return Object.keys(g).map(function(b){return g[b]})}},{}],32:[function(h,p,w){function g(b,c,g){function h(){var c=window.innerWidth,t=window.innerHeight;b!==document.body&&(t=b.getBoundingClientRect(),
c=t.right-t.left,t=t.top-t.bottom);q.width=g*c;q.height=g*t;f(q.style,{width:c+"px",height:t+"px"})}var q=document.createElement("canvas");f(q.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(q);b===document.body&&(q.style.position="absolute",f(b.style,{margin:0,padding:0}));window.addEventListener("resize",h,!1);h();return{canvas:q,onDestroy:function(){window.removeEventListener("resize",h);b.removeChild(q)}}}function b(b,c){function f(g){try{return b.getContext(g,c)}catch(h){return null}}
return f("webgl")||f("experimental-webgl")||f("webgl-experimental")}function u(b){return"string"===typeof b?b.split():b}function q(b){return"string"===typeof b?document.querySelector(b):b}var f=h("./util/extend");p.exports=function(d){var c=d||{},f,h,p,x;d={};var t=[],w=[],E="undefined"===typeof window?1:window.devicePixelRatio,C=!1,e=function(b){},n=function(){};"string"===typeof c?f=document.querySelector(c):"object"===typeof c&&("string"===typeof c.nodeName&&"function"===typeof c.appendChild&&
"function"===typeof c.getBoundingClientRect?f=c:"function"===typeof c.drawArrays||"function"===typeof c.drawElements?(x=c,p=x.canvas):("gl"in c?x=c.gl:"canvas"in c?p=q(c.canvas):"container"in c&&(h=q(c.container)),"attributes"in c&&(d=c.attributes),"extensions"in c&&(t=u(c.extensions)),"optionalExtensions"in c&&(w=u(c.optionalExtensions)),"onDone"in c&&(e=c.onDone),"profile"in c&&(C=!!c.profile),"pixelRatio"in c&&(E=+c.pixelRatio)));f&&("canvas"===f.nodeName.toLowerCase()?p=f:h=f);if(!x){if(!p){f=
g(h||document.body,e,E);if(!f)return null;p=f.canvas;n=f.onDestroy}x=b(p,d)}return x?{gl:x,canvas:p,container:h,extensions:t,optionalExtensions:w,pixelRatio:E,profile:C,onDone:e,onDestroy:n}:(n(),e("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/extend":23}],33:[function(h,p,w){p.exports=function(b,h){function q(b){var a=!1;"altKey"in b&&(a=a||b.altKey!==n.alt,n.alt=!!b.altKey);"shiftKey"in b&&(a=a||b.shiftKey!==n.shift,n.shift=!!b.shiftKey);
"ctrlKey"in b&&(a=a||b.ctrlKey!==n.control,n.control=!!b.ctrlKey);"metaKey"in b&&(a=a||b.metaKey!==n.meta,n.meta=!!b.metaKey);return a}function f(b,a){var c=g.x(a),d=g.y(a);"buttons"in a&&(b=a.buttons|0);if(b!==E||c!==C||d!==e||q(a))E=b|0,C=c||0,e=d||0,h&&h(E,C,e,n)}function d(b){f(0,b)}function c(){if(E||C||e||n.shift||n.alt||n.meta||n.control)E=C=e=0,n.shift=n.alt=n.control=n.meta=!1,h&&h(0,0,0,n)}function p(b){q(b)&&h&&h(E,C,e,n)}function w(b){0===g.buttons(b)?f(0,b):f(E,b)}function A(b){f(E|g.buttons(b),
b)}function x(b){f(E&~g.buttons(b),b)}function t(){H||(H=!0,b.addEventListener("mousemove",w),b.addEventListener("mousedown",A),b.addEventListener("mouseup",x),b.addEventListener("mouseleave",d),b.addEventListener("mouseenter",d),b.addEventListener("mouseout",d),b.addEventListener("mouseover",d),b.addEventListener("blur",c),b.addEventListener("keyup",p),b.addEventListener("keydown",p),b.addEventListener("keypress",p),b!==window&&(window.addEventListener("blur",c),window.addEventListener("keyup",p),
window.addEventListener("keydown",p),window.addEventListener("keypress",p)))}function M(){H&&(H=!1,b.removeEventListener("mousemove",w),b.removeEventListener("mousedown",A),b.removeEventListener("mouseup",x),b.removeEventListener("mouseleave",d),b.removeEventListener("mouseenter",d),b.removeEventListener("mouseout",d),b.removeEventListener("mouseover",d),b.removeEventListener("blur",c),b.removeEventListener("keyup",p),b.removeEventListener("keydown",p),b.removeEventListener("keypress",p),b!==window&&
(window.removeEventListener("blur",c),window.removeEventListener("keyup",p),window.removeEventListener("keydown",p),window.removeEventListener("keypress",p)))}h||(h=b,b=window);var E=0,C=0,e=0,n={shift:!1,alt:!1,control:!1,meta:!1},H=!1;t();var D={element:b};Object.defineProperties(D,{enabled:{get:function(){return H},set:function(b){b?t():M},enumerable:!0},buttons:{get:function(){return E},enumerable:!0},x:{get:function(){return C},enumerable:!0},y:{get:function(){return e},enumerable:!0},mods:{get:function(){return n},
enumerable:!0}});return D};var g=h("mouse-event")},{"mouse-event":34}],34:[function(h,p,w){function g(b){return b.target||b.srcElement||window}w.buttons=function(b){if("object"===typeof b){if("buttons"in b)return b.buttons;if("which"in b){b=b.which;if(2===b)return 4;if(3===b)return 2;if(0<b)return 1<<b-1}else if("button"in b){b=b.button;if(1===b)return 4;if(2===b)return 2;if(0<=b)return 1<<b}}return 0};w.element=g;w.x=function(b){if("object"===typeof b){if("offsetX"in b)return b.offsetX;var h=g(b).getBoundingClientRect();
return b.clientX-h.left}return 0};w.y=function(b){if("object"===typeof b){if("offsetY"in b)return b.offsetY;var h=g(b).getBoundingClientRect();return b.clientY-h.top}return 0}},{}],35:[function(h,p,w){function g(b){throw Error("resl: "+b);}function b(b,d,f){Object.keys(b).forEach(function(b){0>d.indexOf(b)&&g('invalid parameter "'+b+'" in '+f)})}function u(b,d){this.state=0;this.ready=!1;this.progress=0;this.name=b;this.cancel=d}var q=["manifest","onDone","onProgress","onError"],f=["type","src","stream",
"credentials","parser"],d=["onData","onDone"];p.exports=function(c){function h(a,b){if(a in c){var d=c[a];"function"!==typeof d&&g('invalid callback "'+a+'"');return d}return null}function p(a){function b(){if(!(2>g.readyState||1===l.state||-1===l.state)){if(200!==g.status)return x('error loading resource "'+a.name+'"');if(2<g.readyState&&0===l.state){var d;d="binary"===a.type?g.response:g.responseText;if(f.data)try{h=f.data(d)}catch(e){return x(e)}else h=d}if(3<g.readyState&&0===l.state){if(f.done)try{h=
f.done()}catch(e){return x(e)}l.state=1}n[c]=h;l.progress=.75*l.progress+.25;l.ready=a.stream&&!!h||1===l.state;t()}}var c=a.name,d=a.stream,e="binary"===a.type,f=a.parser,g=new XMLHttpRequest,h=null,l=new u(c,function(){1!==l.state&&-1!==l.state&&(g.onreadystatechange=null,g.abort(),l.state=-1)});g.onreadystatechange=d?b:function(){4===g.readyState&&b()};e&&(g.responseType="arraybuffer");a.credentials&&(g.withCredentials=!0);g.open("GET",a.src,!0);g.send();return l}function w(a,b){function c(){if(0===
p.state)if(l.data)try{q=l.data(b)}catch(a){return x(a)}else q=b}function d(b){c();n[h]=q;p.progress=b.lengthComputable?Math.max(p.progress,b.loaded/b.total):.75*p.progress+.25;p.ready=a.stream;t(h)}function e(){c();if(0===p.state){if(l.done)try{q=l.done()}catch(a){return x(a)}p.state=1}p.progress=1;p.ready=!0;n[h]=q;g();t("finish "+h)}function f(){x('error loading asset "'+h+'"')}function g(){a.stream&&b.removeEventListener("progress",d);"image"===a.type?b.addEventListener("load",e):b.addEventListener("canplay",
e);b.removeEventListener("error",f)}var h=a.name,l=a.parser,p=new u(h,function(){1!==p.state&&-1!==p.state&&(p.state=-1,g(),b.src="")}),q=b;a.stream&&b.addEventListener("progress",d);"image"===a.type?b.addEventListener("load",e):b.addEventListener("canplay",e);b.addEventListener("error",f);b.crossOrigin=a.credentials?"use-credentials":"anonymous";b.src=a.src;return p}function x(a){-1!==H&&1!==H&&(H=-1,l.forEach(function(a){a.cancel()}),e?"string"===typeof a?e(Error("resl: "+a)):e(a):console.error("resl error:",
a))}function t(a){if(-1!==H&&1!==H){var b=0,c=0;l.forEach(function(a){a.ready&&(c+=1);b+=a.progress});c===l.length?(H=1,E(n)):C&&C(b/l.length,a)}}"object"===typeof c&&c||g("invalid or missing configuration");b(c,q,"config");var M=c.manifest;"object"===typeof M&&M||g("missing manifest");var E=h("onDone");E||g("missing onDone() callback");var C=h("onProgress"),e=h("onError"),n={},H=0,D={text:p,binary:function(a){return p(a)},image:function(a){return w(a,document.createElement("img"))},video:function(a){return w(a,
document.createElement("video"))},audio:function(a){return w(a,document.createElement("audio"))}},l=Object.keys(M).map(function(a){function c(a,b){if(a in e.parser){var d=e.parser[a];"function"!==typeof d&&g("invalid parser callback "+a+' for asset "'+a+'"');return d}return b}var e=M[a];"string"===typeof e?e={src:e}:"object"===typeof e&&e||g('invalid asset definition "'+a+'"');b(e,f,'asset "'+a+'"');var h={};"parser"in e&&("function"===typeof e.parser?h={data:e.parser}:"object"===typeof e.parser&&
e.parser?(b(h,d,'parser for asset "'+a+'"'),"onData"in h||g('missing onData callback for parser in asset "'+a+'"'),h={data:c("onData"),done:c("onDone")}):g('invalid parser for asset "'+a+'"'));return{name:a,type:function(b,c,d){b in e&&(d=e[b]);0>c.indexOf(d)&&g("invalid "+b+' "'+d+'" for asset "'+a+'", possible values: '+c);return d}("type",Object.keys(D),"text"),stream:!!e.stream,credentials:!!e.credentials,src:function(b,c,d){b in e?d=e[b]:c&&g("missing "+b+' for asset "'+a+'"');"string"!==typeof d&&
g("invalid "+b+' for asset "'+a+'", must be a string');return d}("src",!0,""),parser:h}}).map(function(a){return D[a.type](a)})}},{}],36:[function(h,p,w){function g(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var b=h("./lib/util/extend"),u=h("./lib/dynamic"),q=h("./lib/util/raf"),f=h("./lib/util/clock"),d=h("./lib/strings"),c=h("./lib/webgl"),y=h("./lib/extension"),V=h("./lib/limits"),A=h("./lib/buffer"),x=h("./lib/elements"),t=h("./lib/texture"),M=h("./lib/renderbuffer"),E=h("./lib/framebuffer"),
C=h("./lib/attribute"),e=h("./lib/shader"),n=h("./lib/read"),H=h("./lib/core"),D=h("./lib/stats"),l=h("./lib/timer");p.exports=function(a){function h(){if(0===N.length)X&&X.update(),ca=null;else{ca=q.next(h);B();for(var a=N.length-1;0<=a;--a){var b=N[a];b&&b(P,null,0)}v.flush();X&&X.update()}}function p(a){}function w(a){}function oa(a){function c(a){var b={},d={};Object.keys(a).forEach(function(c){var e=a[c];u.isDynamic(e)?d[c]=u.unbox(e,c):b[c]=e});return{dynamic:d,"static":b}}function d(a){for(;q.length<
a;)q.push(null);return q}var e=c(a.context||{}),f=c(a.uniforms||{}),g=c(a.attributes||{}),h=c(function(a){function c(a){if(a in d){var b=d[a];delete d[a];Object.keys(b).forEach(function(c){d[a+"."+c]=b[c]})}}var d=b({},a);delete d.uniforms;delete d.attributes;delete d.context;c("blend");c("depth");c("cull");c("stencil");c("polygonOffset");c("scissor");c("sample");return d}(a));a={gpuTime:0,cpuTime:0,count:0};var e=da.compile(h,g,f,e,a),l=e.draw,n=e.batch,p=e.scope,q=[];return b(function(a,b){var c;
if("function"===typeof a)return p.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(c=0;c<a;++c)p.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)p.call(this,a[c],b,c);else return p.call(this,a,b,0);else if("number"===typeof a){if(0<a)return n.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return n.call(this,a,a.length)}else return l.call(this,a)},{stats:a})}function ua(){var a=sa.viewport,b=sa.scissor_box;a[0]=a[1]=b[0]=b[1]=0;P.viewportWidth=
P.framebufferWidth=P.drawingBufferWidth=a[2]=b[2]=v.drawingBufferWidth;P.viewportHeight=P.framebufferHeight=P.drawingBufferHeight=a[3]=b[3]=v.drawingBufferHeight}function B(){P.tick+=1;P.time=(f()-Z)/1E3;ua();da.procs.poll()}function ya(){ua();da.procs.refresh();X&&X.update()}var F=c(a);if(!F)return null;var v=F.gl;a=v.getContextAttributes();var W=y(v,F);if(!W)return null;var ha=d(),I=D(),W=W.extensions,X=l(v,W),Z=f(),R=v.drawingBufferWidth,O=v.drawingBufferHeight,P={tick:0,time:0,viewportWidth:R,
viewportHeight:O,framebufferWidth:R,framebufferHeight:O,drawingBufferWidth:R,drawingBufferHeight:O,pixelRatio:F.pixelRatio},S=V(v,W),ia=A(v,I,F),qa=x(v,W,ia,I),R=C(v,W,S,ia,ha),wa=e(v,ha,I,F),ja=t(v,W,S,function(){da.procs.poll()},P,I,F),ra=M(v,W,S,I,F),ka=E(v,W,S,ja,ra,I),da=H(v,ha,W,S,ia,qa,ja,ka,{},R,wa,{elements:null,primitive:4,count:-1,offset:0,instances:-1},P,X,F),ha=n(v,ka,da.procs.poll,P,a),sa=da.next,T=v.canvas,N=[],ca=null;T&&(T.addEventListener("webglcontextlost",p,!1),T.addEventListener("webglcontextrestored",
w,!1));ya();a=b(oa,{clear:function(a){var b=0;da.procs.poll();var c=a.color;c&&(v.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(v.clearDepth(+a.depth),b|=256);"stencil"in a&&(v.clearStencil(a.stencil|0),b|=1024);v.clear(b)},prop:u.define.bind(null,1),context:u.define.bind(null,2),"this":u.define.bind(null,3),draw:oa({}),buffer:function(a){return ia.create(a,34962)},elements:qa.create,texture:ja.create2D,cube:ja.createCube,renderbuffer:ra.create,framebuffer:ka.create,framebufferCube:ka.createCube,
attributes:a,frame:function(a){N.push(a);!ca&&0<N.length&&(ca=q.next(h));return{cancel:function(){function b(){var a=g(N,b);N[a]=N[N.length-1];--N.length;0>=N.length&&ca&&(q.cancel(h),ca=null)}var c=g(N,a);N[c]=b}}},limits:S,hasExtension:function(a){return 0<=S.extensions.indexOf(a.toLowerCase())},read:ha,destroy:function(){N.length=0;ca&&(q.cancel(h),ca=null);T&&(T.removeEventListener("webglcontextlost",p),T.removeEventListener("webglcontextrestored",w));wa.clear();ka.clear();ra.clear();ja.clear();
qa.clear();ia.clear();X&&X.clear();F.onDestroy()},_gl:v,_refresh:ya,poll:function(){B();X&&X.update()},stats:I});F.onDone(null,a);return a}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},
{},[1]);
