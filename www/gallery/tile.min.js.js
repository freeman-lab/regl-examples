(function e$$0(k,q,m){function a(h,p){if(!q[h]){if(!k[h]){var J="function"==typeof require&&require;if(!p&&J)return J(h,!0);if(b)return b(h,!0);J=Error("Cannot find module '"+h+"'");throw J.code="MODULE_NOT_FOUND",J;}J=q[h]={exports:{}};k[h][0].call(J.exports,function(b){var m=k[h][1][b];return a(m?m:b)},J,J.exports,e$$0,k,q,m)}return q[h].exports}for(var b="function"==typeof require&&require,p=0;p<m.length;p++)a(m[p]);return a})({1:[function(e,k,q){k.exports=[[[1,11],[1,11],[1,11],[1,11],[1,11],
[1,11],[1,11],[1,11],[6,6],[7,6],[8,6],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[0,0],[1,0],[1,0],[2,0],[1,11],[1,11],[1,11],[6,6],[7,6],[8,6],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[0,1],[1,1],[1,1],[2,1],[1,11],[1,11],[1,11],[6,6],[8,8],[8,6],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[0,1],[1,1],[0,3],[5,2],[1,11],[13,12],[13,12],[6,6],[7,6],[6,9],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[0,1],[1,1],[2,1],[1,11],[1,11],[13,15],[13,15],[6,6],[7,6],[7,6],[6,9],[1,11],[1,11],[1,11],[1,
11]],[[1,11],[0,2],[1,2],[2,2],[1,11],[1,11],[14,2],[15,2],[6,6],[7,6],[7,6],[7,6],[6,9],[8,5],[1,11],[1,11]],[[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[6,6],[8,8],[7,6],[7,6],[7,6],[8,6],[1,11],[1,11]],[[4,5],[2,5],[0,5],[1,5],[2,5],[1,11],[1,11],[1,11],[6,7],[7,8],[7,6],[7,6],[8,9],[6,9],[8,5],[1,11]],[[2,8],[3,9],[4,9],[4,6],[3,9],[5,0],[1,11],[1,11],[1,11],[6,7],[7,8],[7,6],[7,6],[8,8],[8,6],[1,11]],[[4,7],[4,7],[4,8],[5,8],[2,9],[3,9],[4,5],[2,5],[1,11],[1,11],[6,7],[7,8],[7,6],
[7,6],[6,9],[8,5]],[[1,11],[1,11],[3,7],[4,7],[4,8],[5,9],[5,8],[0,9],[2,5],[1,11],[1,11],[6,7],[7,8],[7,6],[7,6],[6,9]],[[1,11],[1,11],[1,11],[1,11],[0,7],[4,8],[4,6],[4,6],[5,1],[1,11],[1,11],[1,11],[6,7],[7,8],[7,6],[7,6]],[[1,11],[9,0],[10,0],[8,0],[1,11],[3,7],[1,7],[1,7],[5,7],[1,11],[1,11],[1,11],[1,11],[6,7],[7,7],[7,7]],[[1,11],[9,1],[11,3],[11,1],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11]],[[1,11],[9,2],[7,2],[11,2],[1,11],[1,11],[1,11],[2,12],[1,
13],[1,13],[1,13],[1,13],[1,13],[1,13],[0,12],[1,11]],[[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[1,11],[2,10],[3,10],[3,10],[3,10],[3,10],[3,10],[3,10],[0,10],[1,11]]]},{}],2:[function(e,k,q){k=e("../regl")();var m=e("mouse-change")(),a=e("./assets/map.json"),b=k({frag:"\n  precision mediump float;\n  uniform sampler2D map, tiles;\n  uniform vec2 mapSize, tileSize;\n  varying vec2 uv;\n  void main() {\n    vec2 tileCoord = floor(255.0 * texture2D(map, floor(uv) / mapSize).ra);\n    gl_FragColor = texture2D(tiles, (tileCoord + fract(uv)) / tileSize);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  uniform vec4 view;\n  varying vec2 uv;\n  void main() {\n    uv = mix(view.xw, view.zy, 0.5 * (1.0 + position));\n    gl_Position = vec4(position, 1, 1);\n  }",depth:{enable:!1},uniforms:{tiles:k.texture("assets/tiles.png"),tileSize:[16,16],map:k.texture(a),mapSize:[a[0].length,a.length],view:k.prop("view")},attributes:{position:[-1,-1,1,-1,-1,1,1,1,-1,1,1,-1]},count:6});k.frame(function(p){var h=p.viewportWidth,f=p.viewportHeight;
p=a[0].length*m.x/h;var e=a.length*m.y/f,h=h/f*10;b({view:[p-.5*h,e-5,p+.5*h,e+5]})})},{"../regl":33,"./assets/map.json":1,"mouse-change":31}],3:[function(e,k,q){function m(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}k.exports=function(a,b,p,h,f){a=p.maxAttributes;b=Array(a);for(p=0;p<a;++p)b[p]=new m;return{Record:m,scope:{},state:b}}},{}],4:[function(e,k,q){function m(a,b){switch(a){case 5121:return new Uint8Array(b);
case 5123:return new Uint16Array(b);case 5125:return new Uint32Array(b);case 5120:return new Int8Array(b);case 5122:return new Int16Array(b);case 5124:return new Int32Array(b);case 5126:return new Float32Array(b);default:return null}}var a=e("./util/is-typed-array"),b=e("./util/is-ndarray"),p=e("./constants/arraytypes.json"),h=e("./constants/dtypes.json"),f=e("./util/values"),J={"static":35044,dynamic:35048,stream:35040};k.exports=function(e){function k(a){this.id=A++;this.buffer=null;this.type=a;
this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function B(a){e.isBuffer(a.buffer)||(a.buffer=e.createBuffer());a.bind();e.bufferData(a.type,a.data||a.byteLength,a.usage)}function r(a){var b=a.buffer;e.isBuffer(b)&&e.deleteBuffer(b);a.buffer=null;delete d[a.id]}function u(f,e,n){function u(d){var f=d||{};if(Array.isArray(f)||a(f)||b(f))f={data:f};else if("number"===typeof f)f={length:f|0};else if(null===f||void 0===f)f={};A.usage="usage"in f?J[f.usage]:35044;d=0;
"type"in f&&(d=h[f.type]);var e=f.dimension|0||1,z=0,n=null;if("data"in f)if(n=f.data,null===n)z=f.length|0;else{if(b(n)){var e=n.shape,z=n.stride,f=n.offset,v=0,w=0,k=0,r=0;1===e.length?(v=e[0],w=1,k=z[0],r=0):2===e.length&&(v=e[0],w=e[1],k=z[0],r=z[1]);d=d||p[Object.prototype.toString.call(n.data)]|0||5126;for(var e=w,z=m(d,v*w),n=n.data,y=0,ba=0;ba<v;++ba)for(var U=0;U<w;++U)z[y++]=n[k*ba+r*U+f];n=z}else if(Array.isArray(n))if(0<n.length&&Array.isArray(n[0])){e=n[0].length;d=d||5126;f=m(d,n.length*
e);z=n;n=e;for(v=r=0;v<z.length;++v)for(k=z[v],w=0;w<n;++w)f[r++]=k[w];n=f}else d=d||5126,n=m(d,n);else d=d||p[Object.prototype.toString.call(n)]|0;z=n.byteLength}else"length"in f&&(z=f.length|0);A.data=n;A.dtype=d||5121;A.byteLength=z;A.dimension=e;B(A);return u}var A=new k(e);d[A.id]=A;n||u(f);u._reglType="buffer";u._buffer=A;u.destroy=function(){r(A)};return u}var A=0,d={};k.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)};return{create:u,createStream:function(a){return u({data:a,
usage:"stream"},34962,!1)._buffer},destroyStream:function(a){r(a)},clear:function(){f(d).forEach(r)},refresh:function(){f(d).forEach(B)},getBuffer:function(a){return a&&a._buffer instanceof k?a._buffer:null}}}},{"./constants/arraytypes.json":5,"./constants/dtypes.json":6,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/values":29}],5:[function(e,k,q){k.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,
"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],6:[function(e,k,q){k.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],7:[function(e,k,q){k.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],8:[function(e,k,q){function m(a){return Array.isArray(a)||U(a)||B(a)}function a(a){return a.sort(function(a,
b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function b(a,b,d,f){this.thisDep=a;this.contextDep=b;this.propDep=d;this.append=f}function p(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function h(a){return new b(!1,!1,!1,a)}function f(a,d){var f=a.type;return 0===f?(f=a.data.length,new b(!0,1<=f,2<=f,d)):new b(3===f,2===f,1===f,d)}var J=e("./util/codegen"),y=e("./util/loop"),U=e("./util/is-typed-array"),B=e("./util/is-ndarray"),r=e("./constants/primitives.json"),u=e("./constants/dtypes.json"),
A=["x","y","z","w"],d={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},z={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,
always:519},w={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},n={cw:2304,ccw:2305},X=new b(!1,!1,!1,function(){});k.exports=function(e,k,B,q,Q,K,v,aa,ga,S,Y,ba,L){function O(a){return a.replace(".","_")}function G(a,g,c){var b=O(a);pa.push(a);la[b]=ha[b]=!!c;ia[b]=g}function C(a,g,c){var b=O(a);pa.push(a);Array.isArray(c)?(ha[b]=c.slice(),la[b]=c.slice()):ha[b]=la[b]=c;ja[b]=g}function R(){var a=J(),g=a.link,c=a.global;a.id=
Aa++;a.batchId="0";var b=g(xa),d=a.shared={props:"a0"};Object.keys(xa).forEach(function(l){d[l]=c.def(b,".",l)});var D=a.next={},f=a.current={};Object.keys(ja).forEach(function(l){Array.isArray(ha[l])&&(D[l]=c.def(d.next,".",l),f[l]=c.def(d.current,".",l))});var l=a.constants={};Object.keys(qa).forEach(function(a){l[a]=c.def(JSON.stringify(qa[a]))});a.invoke=function(l,V){switch(V.type){case 0:var c=["this",d.context,d.props,a.batchId];return l.def(g(V.data),".call(",c.slice(0,Math.max(V.data.length+
1,4)),")");case 1:return l.def(d.props,V.data);case 2:return l.def(d.context,V.data);case 3:return l.def("this",V.data)}};a.attribCache={};var V={};a.scopeAttrib=function(l){l=k.id(l);if(l in V)return V[l];var a=S.scope[l];a||(a=S.scope[l]=new ma);return V[l]=g(a)};return a}function ea(a){var g=a["static"];a=a.dynamic;if("framebuffer"in g){var c=g.framebuffer;return c?(c=aa.getFramebuffer(c),h(function(a,g){var x=a.link(c),l=a.shared;g.set(l.framebuffer,".next",x);l=l.context;g.set(l,".framebufferWidth",
x+".width");g.set(l,".framebufferHeight",x+".height");return x})):h(function(a,g){var c=a.shared;g.set(c.framebuffer,".next","null");c=c.context;g.set(c,".framebufferWidth",c+".drawingBufferWidth");g.set(c,".framebufferHeight",c+".drawingBufferHeight");return null})}if("framebuffer"in a){var b=a.framebuffer;return f(b,function(a,g){var c=a.invoke(g,b),l=a.shared,V=l.framebuffer,c=g.def(V,".getFramebuffer(",c,")");g.set(V,".next",c);l=l.context;g.set(l,".framebufferWidth",c+"?"+c+".width:"+l+".drawingBufferWidth");
g.set(l,".framebufferHeight",c+"?"+c+".height:"+l+".drawingBufferHeight");return c})}return null}function ca(a,g){function c(l){if(l in d){var a=d[l];l=!0;var x=a.x|0,ya=a.y|0,D,h;"w"in a?D=a.w|0:l=!1;"h"in a?h=a.h|0:l=!1;return new b(l&&g&&g.thisDep,l&&g&&g.contextDep,l&&g&&g.propDep,function(l,g){var c=l.shared.context,b=D;"w"in a||(b=g.def(c,".","framebufferWidth","-",x));var d=h;"h"in a||(d=g.def(c,".","framebufferHeight","-",ya));return[x,ya,b,d]})}if(l in m){var t=m[l];l=f(t,function(l,a){var g=
l.invoke(a,t),c=l.shared.context,V=a.def(g,".x|0"),x=a.def(g,".y|0"),b=a.def('"w" in ',g,"?",g,".w|0:","(",c,".","framebufferWidth","-",V,")"),g=a.def('"h" in ',g,"?",g,".h|0:","(",c,".","framebufferHeight","-",x,")");return[V,x,b,g]});g&&(l.thisDep=l.thisDep||g.thisDep,l.contextDep=l.contextDep||g.contextDep,l.propDep=l.propDep||g.prpoDep);return l}return g?new b(g.thisDep,g.contextDep,g.propDep,function(l,a){var g=l.shared.context;return[0,0,a.def(g,".","framebufferWidth"),a.def(g,".","framebufferHeight")]}):
null}var d=a["static"],m=a.dynamic,D=c("viewport");if(D)var h=D,D=new b(D.thisDep,D.contextDep,D.propDep,function(l,a){var g=h.append(l,a),c=l.shared.context;a.set(c,".viewportWidth",g[2]);a.set(c,".viewportHeight",g[3]);return g});return{viewport:D,scissor_box:c("scissor.box")}}function I(a){function g(l){if(l in c){var a=k.id(c[l]);l=h(function(){return a});l.id=a;return l}if(l in d){var b=d[l];return f(b,function(l,a){var g=l.invoke(a,b);return a.def(l.shared.strings,".id(",g,")")})}return null}
var c=a["static"],d=a.dynamic,m=g("frag"),D=g("vert"),t=null;p(m)&&p(D)?(t=Y.program(D.id,m.id),a=h(function(l,a){return l.link(t)})):a=new b(m&&m.thisDep||D&&D.thisDep,m&&m.contextDep||D&&D.contextDep,m&&m.propDep||D&&D.propDep,function(l,a){var g=l.shared.shader,c;c=m?m.append(l,a):a.def(g,".","frag");var b;b=D?D.append(l,a):a.def(g,".","vert");return a.def(g+".program("+b+","+c+")")});return{frag:m,vert:D,progVar:a,program:t}}function H(a){function g(a,l){if(a in c){var b=c[a]|0;return h(function(a,
g){l&&(a.OFFSET=b);return b})}if(a in d){var x=d[a];return f(x,function(a,g){var c=a.invoke(g,x);l&&(a.OFFSET=c);return c})}return l&&t?h(function(a,l){a.OFFSET="0";return 0}):null}var c=a["static"],d=a.dynamic,t=function(){if("elements"in c){var a=c.elements;m(a)?a=K.getElements(K.create(a)):a&&(a=K.getElements(a));var l=h(function(l,g){if(a){var c=l.link(a);return l.ELEMENTS=c}return l.ELEMENTS=null});l.value=a;return l}if("elements"in d){var g=d.elements;return f(g,function(a,l){var c=a.shared,
b=c.isBufferArgs,c=c.elements,d=a.invoke(l,g),x=l.def("null"),b=l.def(b,"(",d,")"),d=a.cond(b).then(x,"=",c,".createStream(",d,");")["else"](x,"=",c,".getElements(",d,");");l.entry(d);l.exit(a.cond(b).then(c,".destroyStream(",x,");"));return a.ELEMENTS=x})}return null}(),D=g("offset",!0);return{elements:t,primitive:function(){if("primitive"in c){var a=c.primitive;return h(function(l,g){return r[a]})}if("primitive"in d){var l=d.primitive;return f(l,function(a,g){var c=a.constants.primTypes,b=a.invoke(g,
l);return g.def(c,"[",b,"]")})}return t?p(t)?t.value?h(function(a,l){return l.def(a.ELEMENTS,".primType")}):h(function(){return 4}):new b(t.thisDep,t.contextDep,t.propDep,function(a,l){var g=a.ELEMENTS;return l.def(g,"?",g,".primType:",4)}):null}(),count:function(){if("count"in c){var a=c.count|0;return h(function(){return a})}if("count"in d){var l=d.count;return f(l,function(a,g){return a.invoke(g,l)})}return t?p(t)?t?D?new b(D.thisDep,D.contextDep,D.propDep,function(a,l){return l.def(a.ELEMENTS,
".vertCount-",a.OFFSET)}):h(function(a,l){return l.def(a.ELEMENTS,".vertCount")}):h(function(){return-1}):new b(t.thisDep||D.thisDep,t.contextDep||D.contextDep,t.propDep||D.propDep,function(a,l){var g=a.ELEMENTS;return a.OFFSET?l.def(g,"?",g,".vertCount-",a.OFFSET,":-1"):l.def(g,"?",g,".vertCount:-1")}):null}(),instances:g("instances",!1),offset:D}}function na(a){var g=a["static"],c=a.dynamic,b={};pa.forEach(function(a){function x(l,d){if(a in g){var t=l(g[a]);b[m]=h(function(){return t})}else if(a in
c){var D=c[a];b[m]=f(D,function(a,l){return d(a,l,a.invoke(l,D))})}}var m=O(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return x(function(a){return a},function(a,g,c){return c});case "depth.func":return x(function(a){return z[a]},function(a,g,c){return g.def(a.constants.compareFuncs,"[",c,"]")});case "depth.range":return x(function(a){return a},
function(a,g,c){a=g.def("+",c,"[0]");g=g.def("+",c,"[1]");return[a,g]});case "blend.func":return x(function(a){return[d["srcRGB"in a?a.srcRGB:a.src],d["dstRGB"in a?a.dstRGB:a.dst],d["srcAlpha"in a?a.srcAlpha:a.src],d["dstAlpha"in a?a.dstAlpha:a.dst]]},function(a,g,c){function b(a,l){var d=g.def('"',a,l,'" in ',c,"?",c,".",a,l,":",c,".",a);return g.def(x,"[",d,"]")}var x=a.constants.blendFuncs;a=b("src","RGB");var d=b("src","Alpha"),m=b("dst","RGB"),f=b("dst","Alpha");return[a,m,d,f]});case "blend.equation":return x(function(a){if("string"===
typeof a)return[ka[a],ka[a]];if("object"===typeof a)return[ka[a.rgb],ka[a.alpha]]},function(a,g,c){var b=a.constants.blendEquations,x=g.def(),d=g.def();a=a.cond("typeof ",c,'==="string"');a.then(x,"=",d,"=",b,"[",c,"];");a["else"](x,"=",b,"[",c,".rgb];",d,"=",b,"[",c,".alpha];");g(a);return[x,d]});case "blend.color":return x(function(a){return y(4,function(g){return+a[g]})},function(a,g,c){return y(4,function(a){return g.def("+",c,"[",a,"]")})});case "stencil.mask":return x(function(a){return a|0},
function(a,g,c){return g.def(c,"|0")});case "stencil.func":return x(function(a){return[z[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]},function(a,g,c){a=g.def('"cmp" in ',c,"?",a.constants.compareFuncs,"[",c,".cmp]",":",7680);var b=g.def(c,".ref|0");g=g.def('"mask" in ',c,"?",c,".mask|0:-1");return[a,b,g]});case "stencil.opFront":case "stencil.opBack":return x(function(g){return["stencil.opBack"===a?1029:1028,w[g.fail||"keep"],w[g.zfail||"keep"],w[g.pass||"keep"]]},function(g,c,b){function x(a){return c.def('"',
a,'" in ',b,"?",d,"[",b,".",a,"]:",7680)}var d=g.constants.stencilOps;return["stencil.opBack"===a?1029:1028,x("fail"),x("zfail"),x("pass")]});case "polygonOffset.offset":return x(function(a){return[a.factor|0,a.units|0]},function(a,g,c){a=g.def(c,".factor|0");g=g.def(c,".units|0");return[a,g]});case "cull.face":return x(function(a){var g=0;"front"===a?g=1028:"back"===a&&(g=1029);return g},function(a,g,c){return g.def(c,'==="front"?',1028,":",1029)});case "lineWidth":return x(function(a){return a},
function(a,g,c){return c});case "frontFace":return x(function(a){return n[a]},function(a,g,c){return g.def(c+'==="cw"?2304:2305')});case "colorMask":return x(function(a){return a.map(function(a){return!!a})},function(a,g,c){return y(4,function(a){return"!!"+c+"["+a+"]"})});case "sample.coverage":return x(function(a){return["value"in a?a.value:1,!!a.invert]},function(a,g,c){a=g.def('"value" in ',c,"?+",c,".value:1");g=g.def("!!",c,".invert");return[a,g]})}});return b}function Z(a){var g=a["static"],
c=a.dynamic,b={};Object.keys(g).forEach(function(a){var c=g[a],d;if("number"===typeof c||"boolean"===typeof c)d=h(function(){return c});else if("function"===typeof c&&"texture"===c._reglType)d=h(function(a){return a.link(c)});else if(Array.isArray(c)||U(c))d=h(function(a){return a.global.def("[",y(c.length,function(a){return c[a]}),"]")});d.value=c;b[a]=d});Object.keys(c).forEach(function(a){var g=c[a];b[a]=f(g,function(a,c){return a.invoke(c,g)})});return b}function da(a){var g=a["static"],c=a.dynamic,
b={};Object.keys(g).forEach(function(a){var c=g[a],d=k.id(a),l=new ma;if(m(c))l.state=1,l.buffer=Q.getBuffer(Q.create(c,34962,!1)),l.type=l.buffer.dtype;else{var x=Q.getBuffer(c);if(x)l.state=1,l.buffer=x,l.type=x.dtype;else if(c.constant){var f=c.constant;l.state=2;"number"===typeof f?l.x=f:A.forEach(function(a,g){g<f.length&&(l[a]=f[g])})}else{var x=Q.getBuffer(c.buffer),t=c.offset|0,p=c.stride|0,e=c.size|0,n=!!c.normalized,T=0;"type"in c&&(T=u[c.type]);c=c.divisor|0;l.buffer=x;l.state=1;l.size=
e;l.normalized=n;l.type=T||x.dtype;l.offset=t;l.stride=p;l.divisor=c}}b[a]=h(function(a,g){var c=a.attribCache;if(d in c)return c[d];var b={isStream:!1};Object.keys(l).forEach(function(a){b[a]=l[a]});l.buffer&&(b.buffer=a.link(l.buffer));return c[d]=b})});Object.keys(c).forEach(function(a){var g=c[a];b[a]=f(g,function(a,c){function b(a){c(t[a],"=",d,".",a,"|0;")}var d=a.invoke(c,g),x=a.shared,f=x.isBufferArgs,m=x.buffer,t={isStream:c.def(!1)},h=new ma;h.state=1;Object.keys(h).forEach(function(a){t[a]=
c.def(""+h[a])});var W=t.buffer,p=t.type;c("if(",f,"(",d,")){",t.isStream,"=true;",W,"=",m,".createStream(",d,");",p,"=",W,".dtype;","}else{",W,"=",m,".getBuffer(",d,");","if(",W,"){",p,"=",W,".dtype;","}else if(",d,".constant){",t.state,"=",2,";",A.map(function(a,g){return t[a]+"="+d+".length>="+g+"?"+d+"["+g+"]:0;"}).join(""),"}else{",W,"=",m,".getBuffer(",d,".buffer);",p,'="type" in ',d,"?",x.glTypes,"[",d,".type]:",W,".dtype;",t.normalized,"=!!",d,".normalized;");b("size");b("offset");b("stride");
b("divisor");c("}}");return t})});return b}function M(a){var g=a["static"],c=a.dynamic,b={};Object.keys(g).forEach(function(a){var c=g[a];b[a]=h(function(a,g){return"number"===typeof c||"boolean"===typeof c?""+c:a.link(c)})});Object.keys(c).forEach(function(a){var g=c[a];b[a]=f(g,function(a,c){return a.invoke(c,g)})});return b}function N(a,g,c){var b=a.shared.context,d=a.scope();Object.keys(c).forEach(function(f){g.save(b,"."+f);d(b,".",f,"=",c[f].append(a,g),";")});g(d)}function g(a,g,c){var b=a.shared,
d=b.gl,f=b.framebuffer,t;ra&&(t=g.def(b.extensions,".webgl_draw_buffers"));var l=a.constants,b=l.drawBuffers,l=l.backBuffer;a=c?c.append(a,g):g.def(f,".next");g("if(",f,".dirty||",a,"!==",f,".cur){","if(",a,"){",d,".bindFramebuffer(",36160,",",a,".framebuffer);");ra&&g(t,".drawBuffersWEBGL(",b,"[",a,".colorAttachments.length]);");g("}else{",d,".bindFramebuffer(",36160,",null);");ra&&g(t,".drawBuffersWEBGL(",l,");");g("}",f,".cur=",a,";",f,".dirty=false;","}")}function t(a,g,c){var b=a.shared,d=b.gl,
f=a.current,t=a.next,l=b.current,m=b.next,h=a.cond(l,".dirty");pa.forEach(function(g){g=O(g);if(!(g in c.state)){var b,p;if(g in t){b=t[g];p=f[g];var W=y(ha[g].length,function(a){return h.def(b,"[",a,"]")});h(a.cond(W.map(function(a,g){return a+"==="+p+"["+g+"]"}).join("&&")).then(d,".",ja[g],"(",W,");",W.map(function(a,g){return p+"["+g+"]="+a}).join(";"),";"))}else b=h.def(m,".",g),W=a.cond(b,"!==",l,".",g),h(W),g in ia?W(a.cond(b).then(d,".enable(",ia[g],");")["else"](d,".disable(",ia[g],");"),
l,".",g,"=",b,";"):W(d,".",ja[g],"(",b,");",l,".",g,"=",b,";")}});0===Object.keys(c.state).length&&h(l,".dirty=false;");g(h)}function c(g,c,b,d){var f=g.shared,t=g.current,m=f.current,l=f.gl;a(Object.keys(b)).forEach(function(a){var f=b[a];if(!d||d(f)){var h=f.append(g,c);if(ia[a]){var e=ia[a];p(f)?h?c(l,".enable(",e,");"):c(l,".disable(",e,");"):c(g.cond(h).then(l,".enable(",e,");")["else"](l,".disable(",e,");"));c(m,".",a,"=",h,";")}else if(Array.isArray(h)){var n=t[a];c(l,".",ja[a],"(",h,");",
h.map(function(a,g){return n+"["+g+"]="+a}).join(";"),";")}else c(l,".",ja[a],"(",h,");",m,".",a,"=",h,";")}})}function T(a,g){oa&&!a.instancing&&(a.instancing=g.def(a.shared.extensions,".angle_instanced_arrays"))}function sa(a,g,c,b,d){function f(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function t(c,b,d){function f(){g("if(!",e,".pointer){",h,".enableVertexAttribArray(",p,");",e,".pointer=true;}");
var c=d.type,l;l=d.size?g.def(d.size,"||",b):b;g("if(",e,".type!==",c,"||",e,".size!==",l,"||",z.map(function(a){return e+"."+a+"!=="+d[a]}).join("||"),"){",h,".bindBuffer(",34962,",",n,".buffer);",h,".vertexAttribPointer(",[p,l,c,d.normalized,d.stride,d.offset],");",e,".type=",c,";",e,".size=",l,";",z.map(function(a){return e+"."+a+"="+d[a]+";"}).join(""),"}");oa&&(c=d.divisor,g("if(",e,".divisor!==",c,"){",a.instancing,".vertexAttribDivisorANGLE(",[p,c],");",e,".divisor=",c,";}"))}function m(){g("if(",
e,".pointer){",h,".disableVertexAttribArray(",p,");",e,".pointer=false;","}if(",A.map(function(a,g){return e+"."+a+"!=="+T[g]}).join("||"),"){",h,".vertexAttrib4f(",p,",",T,");",A.map(function(a,g){return e+"."+a+"="+T[g]+";"}).join(""),"}")}var h=l.gl,p=g.def(c,".location"),e=g.def(l.attributes,"[",p,"]");c=d.state;var n=d.buffer,T=[d.x,d.y,d.z,d.w],z=["buffer","normalized","offset","stride"];1===c?f():2===c?m():(g("if(",c,"===",1,"){"),f(),g("}else{"),m(),g("}"))}var l=a.shared;b.forEach(function(b){var l=
b.name,m=c.attributes[l],h;if(m){if(!d(m))return;h=m.append(a,g)}else{if(!d(X))return;var p=a.scopeAttrib(l);h={};Object.keys(new ma).forEach(function(a){h[a]=g.def(p,".",a)})}t(a.link(b),f(b.info.type),h)})}function ta(a,g,c,b,d){for(var f=a.shared,t=f.gl,l,m=0;m<b.length;++m){var h=b[m],p=h.name,e=h.info.type,n=c.uniforms[p],h=a.link(h)+".location";if(n){if(!d(n))continue;if(n["static"]){p=n.value;if(35678===e||35680===e)e=a.link(p._texture),g(t,".uniform1i(",h,e+".bind());"),g.exit(e,".unbind()");
else if(35674===e||35675===e||35676===e)p=a.global.def("["+p+"]"),n=2,35675===e?n=3:35676===e&&(n=4),g(t,".uniformMatrix",n,"fv(",h,",false,",p,");");else{switch(e){case 5126:l="1f";break;case 35664:l="2f";break;case 35665:l="3f";break;case 35666:l="4f";break;case 35670:l="1i";break;case 5124:l="1i";break;case 35671:l="2i";break;case 35667:l="2i";break;case 35672:l="3i";break;case 35668:l="3i";break;case 35673:l="4i";break;case 35669:l="4i"}g(t,".uniform",l,"(",h,",",p,");")}continue}else p=n.append(a,
g)}else{if(!d(X))continue;p=g.def(f.uniforms,"[",k.id(p),"]")}n=",";switch(e){case 35678:case 35680:e=g.def(p,"._texture");g(t,".uniform1i(",h,",",e,".bind());");g.exit(e,".unbind();");continue;case 5124:case 35670:l="1i";break;case 35667:case 35671:l="2iv";break;case 35668:case 35672:l="3iv";break;case 35669:case 35673:l="4iv";break;case 5126:l="1f";break;case 35664:l="2fv";break;case 35665:l="3fv";break;case 35666:l="4fv";break;case 35674:l="Matrix2fv";n=",false,";break;case 35675:l="Matrix3fv";
n=",false,";break;case 35676:l="Matrix4fv",n=",false,"}g(t,".uniform",l,"(",h,n,p,");")}}function ua(a,g,c,b){function d(b){var l=e[b];return l?l.batchStatic?l.append(a,g):l.append(a,c):g.def(m,".",b)}function f(){function a(){c(w,".drawElementsInstancedANGLE(",[T,v,u,z+"<<(("+u+"-5121)>>1)",k],");")}function g(){c(w,".drawArraysInstancedANGLE(",[T,z,v,k],");")}n?r?a():(c("if(",n,"){"),a(),c("}else{"),g(),c("}")):g()}function h(){function a(){c(t+".drawElements("+[T,v,u,z+"<<(("+u+"-5121)>>1)"]+");")}
function g(){c(t+".drawArrays("+[T,z,v]+");")}n?r?a():(c("if(",n,"){"),a(),c("}else{"),g(),c("}")):g()}var l=a.shared,t=l.gl,m=l.draw,e=b.draw,n=function(){var b=e.elements,d=g;b?(b.batchStatic||(d=c),b=b.append(a,d)):b=d.def(m,".","elements");b&&d("if("+b+")"+t+".bindBuffer(34963,"+b+".buffer.buffer);");return b}(),T=d("primitive"),z=d("offset"),v=function(){var b=e.count,d=g;b?(b.batchStatic||(d=c),b=b.append(a,d)):b=d.def(m,".","count");return b}();if("number"===typeof v){if(0===v)return}else c("if(",
v,"){"),c.exit("}");var k,w;oa&&(k=d("instances"),w=a.instancing);var u=n+".type",r=e.elements&&p(e.elements);oa&&("number"!==typeof k||0<=k)?"string"===typeof k?(c("if(",k,">0){"),f(),c("}else if(",k,"<0){"),h(),c("}")):f():h()}function va(a,g,c,b,d){g=R();d=g.proc("body",d);oa&&(g.instancing=d.def(g.shared.extensions,".angle_instanced_arrays"));a(g,d,c,b);return g.compile().body}function za(a,g,c,b){T(a,g);sa(a,g,c,b.attributes,function(){return!0});ta(a,g,c,b.uniforms,function(){return!0});ua(a,
g,g,c)}function Ba(a,b){var d=a.proc("draw",1);T(a,d);N(a,d,b.context);g(a,d,b.framebuffer);t(a,d,b);c(a,d,b.state);var f=b.shader.progVar.append(a,d);d(a.shared.gl,".useProgram(",f,".program);");if(b.shader.program)za(a,d,b,b.shader.program);else{var h=a.global.def("{}"),m=d.def(f,".id"),e=d.def(h,"[",m,"]");d(a.cond(e).then(e,".call(this,a0);")["else"](e,"=",h,"[",m,"]=",a.link(function(g){return va(za,a,b,g,1)}),"(",f,");",e,".call(this,a0);"))}0<Object.keys(b.state).length&&d(a.shared.current,
".dirty=true;")}function Ca(a,g,c,b){function d(){return!0}a.batchId="a1";T(a,g);sa(a,g,c,b.attributes,d);ta(a,g,c,b.uniforms,d);ua(a,g,g,c)}function wa(a,b,d,f){function h(a){return a.contextDep&&m||a.propDep}function t(a){return!h(a)}T(a,b);var m=d.contextDynamic,l=b.def(),e=b.def();a.shared.props=e;a.batchId=l;var p=a.scope(),n=a.scope();b(p.entry,"for(",l,"=0;",l,"<","a1",";++",l,"){",e,"=","a0","[",l,"];",n,"}",p.exit);d.needsContext&&N(a,n,d.context);d.needsFramebuffer&&g(a,n,d.framebuffer);
c(a,n,d.state,h);f?(sa(a,p,d,f.attributes,t),sa(a,n,d,f.attributes,h),ta(a,p,d,f.uniforms,t),ta(a,n,d,f.uniforms,h),ua(a,p,n,d)):(b=a.global.def("{}"),f=d.shader.progVar.append(a,n),e=n.def(f,".id"),p=n.def(b,"[",e,"]"),n(a.shared.gl,".useProgram(",f,".program);","if(!",p,"){",p,"=",b,"[",e,"]=",a.link(function(g){return va(Ca,a,d,g,2)}),"(",f,");}",p,".call(this,a0[",l,"],",l,");"))}function Da(a,b){var d=a.proc("batch",2);a.batchId="0";T(a,d);var f=!1,h=!0;Object.keys(b.context).forEach(function(a){f=
f||b.context[a].propDep});f||(N(a,d,b.context),h=!1);var m=b.framebuffer,e=!1;m&&(m.propDep?f=e=!0:m.contextDep&&f&&(e=!0),e||g(a,d,m));b.state.viewport&&b.state.viewport.propDynamic&&(f=!0);t(a,d,b);c(a,d,b.state,function(a){return!(a.contextDep&&f||a.propDep)});b.contextDep=f;b.needsContext=h;b.needsFramebuffer=e;h=b.shader.progVar;if(h.contextDep&&f||h.propDep)wa(a,d,b,null);else if(h=h.append(a,d),d(a.shared.gl,".useProgram(",h,".program);"),b.shader.program)wa(a,d,b,b.shader.program);else{var m=
a.global.def("{}"),e=d.def(h,".id"),l=d.def(m,"[",e,"]");d(a.cond(l).then(l,".call(this,a0,a1);")["else"](l,"=",m,"[",e,"]=",a.link(function(g){return va(wa,a,b,g,2)}),"(",h,");",l,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}function Ea(g,c){function b(a){var l=c.shader[a];l&&d.set(f.shader,"."+a,l.append(g,d))}var d=g.proc("scope",3);g.batchId="a2";var f=g.shared,h=f.current;N(g,d,c.context);c.framebuffer&&c.framebuffer.append(g,d);a(Object.keys(c.state)).forEach(function(a){var b=
c.state[a].append(g,d);Array.isArray(b)?b.forEach(function(c,b){d.set(g.next[a],"["+b+"]",c)}):d.set(f.next,"."+a,b)});["elements","offset","count","instances","primitive"].forEach(function(a){var b=c.draw[a];b&&d.set(f.draw,"."+a,""+b.append(g,d))});Object.keys(c.uniforms).forEach(function(a){d.set(f.uniforms,"["+k.id(a)+"]",c.uniforms[a].append(g,d))});Object.keys(c.attributes).forEach(function(a){var b=c.attributes[a].append(g,d),f=g.scopeAttrib(a);Object.keys(new ma).forEach(function(a){d.set(f,
"."+a,b[a])})});b("vert");b("frag");0<Object.keys(c.state).length&&(d(h,".dirty=true;"),d.exit(h,".dirty=true;"));d("a1(",g.shared.context,",a0,0);")}var ma=S.Record,ka={add:32774,subtract:32778,"reverse subtract":32779};B.ext_blend_minmax&&(ka.min=32775,ka.max=32776);var oa=B.angle_instanced_arrays,ra=B.webgl_draw_buffers,ha={dirty:!0},la={},pa=[],ia={},ja={};G("dither",3024);G("blend.enable",3042);C("blend.color","blendColor",[0,0,0,0]);C("blend.equation","blendEquationSeparate",[32774,32774]);
C("blend.func","blendFuncSeparate",[1,0,1,0]);G("depth.enable",2929,!0);C("depth.func","depthFunc",513);C("depth.range","depthRange",[0,1]);C("depth.mask","depthMask",!0);C("colorMask","colorMask",[!0,!0,!0,!0]);G("cull.enable",2884);C("cull.face","cullFace",1029);C("frontFace","frontFace",2305);C("lineWidth","lineWidth",1);G("polygonOffset.enable",32823);C("polygonOffset.offset","polygonOffset",[0,0]);G("sample.alpha",32926);G("sample.enable",32928);C("sample.coverage","sampleCoverage",[1,!1]);G("stencil.enable",
2960);C("stencil.mask","stencilMask",-1);C("stencil.func","stencilFunc",[519,0,-1]);C("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);C("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);G("scissor.enable",3089);C("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);C("viewport","viewport",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var xa={gl:e,context:L,strings:k,next:la,current:ha,draw:ba,elements:K,buffer:Q,shader:Y,attributes:S.state,uniforms:ga,
framebuffer:aa,extensions:B,isBufferArgs:m},qa={primTypes:r,compareFuncs:z,blendFuncs:d,blendEquations:ka,stencilOps:w,glTypes:u,orientationType:n};ra&&(qa.backBuffer=[1029],qa.drawBuffer=y(q.maxDrawbuffers,function(a){return y(a,function(a){return 36064+a})}));var Aa=0;return{next:la,current:ha,procs:function(){var a=R(),c=a.proc("poll"),b=a.proc("refresh"),d=a.block();c(d);b(d);var f=a.shared,h=f.gl,m=f.next,l=f.current;d(l,".dirty=false;");g(a,c);b(f.framebuffer,".dirty=true;");g(a,b);Object.keys(ia).forEach(function(g){var f=
ia[g],t=d.def(m,".",g),e=a.block();e("if(",t,"){",h,".enable(",f,")}else{",h,".disable(",f,")}",l,".",g,"=",t,";");b(e);c("if(",t,"!==",l,".",g,"){",e,"}")});Object.keys(ja).forEach(function(g){var f=ja[g],t=ha[g],e,p,n=a.block();n(h,".",f,"(");Array.isArray(t)?(f=t.length,e=a.global.def(m,".",g),p=a.global.def(l,".",g),n(y(f,function(a){return e+"["+a+"]"}),");",y(f,function(a){return p+"["+a+"]="+e+"["+a+"];"}).join("")),c("if(",y(f,function(a){return e+"["+a+"]!=="+p+"["+a+"]"}).join("||"),"){",
n,"}")):(e=d.def(m,".",g),p=d.def(l,".",g),n(e,");",l,".",g,"=",e,";"),c("if(",e,"!==",p,"){",n,"}"));b(n)});return a.compile()}(),compile:function(a,g,c,b){var d=R(),f;f=ea(a);var h=ca(a,f),l=H(a),m=na(a);a=I(a);var t=h.viewport;t&&(m.viewport=t);t=O("scissor.box");(h=h[t])&&(m[t]=h);h=0<Object.keys(m).length;f={framebuffer:f,draw:l,shader:a,state:m,dirty:h};f.uniforms=Z(c);f.attributes=da(g);f.context=M(b);Ba(d,f);Ea(d,f);Da(d,f);return d.compile()}}}},{"./constants/dtypes.json":6,"./constants/primitives.json":7,
"./util/codegen":20,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/loop":25}],9:[function(e,k,q){function m(a,b){this.id=p++;this.type=a;this.data=b}function a(b){if(0===b.length)return[];var f=b.charAt(0),m=b.charAt(b.length-1);if(1<b.length&&f===m&&('"'===f||"'"===f))return['"'+b.substr(1,b.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(f=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return a(b.substr(0,f.index)).concat(a(f[1])).concat(a(b.substr(f.index+f[0].length)));
f=b.split(".");if(1===f.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(m=0;m<f.length;++m)b=b.concat(a(f[m]));return b}function b(b){return"["+a(b).join("][")+"]"}var p=0;k.exports={define:function(a,f){switch(typeof f){case "boolean":case "number":case "string":return new m(a,b(f+""));case "undefined":return new m(a|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof m},unbox:function(a,f){if(a instanceof m){if(a.type&128)return new m(a.type&
-129,b(f))}else if("function"===typeof a)return new m(0,a);return a},accessor:b}},{}],10:[function(e,k,q){var m=e("./util/is-typed-array"),a=e("./util/is-ndarray"),b=e("./constants/primitives.json");k.exports=function(e,h,f){function k(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}function y(e){function p(f){var d=h.oes_element_index_uint;if(f)if("number"===typeof f)u(f);else{var e=null,k="static";Array.isArray(f)||m(f)||a(f)?e=f:("data"in f&&(e=f.data),"usage"in f&&(k=f.usage));Array.isArray(e)||
a(e)&&Array.isArray(e.data)||"type"in f?u({type:f.type||(d?"uint32":"uint16"),usage:k,data:e}):u({usage:k,data:e});if(Array.isArray(e)||m(e))u.dimension=3}else u();d=r.buffer.byteLength;e=0;switch(r.buffer.dtype){case 5121:case 5120:e=5121;break;case 5123:case 5122:e=5123;d>>=1;break;case 5125:case 5124:e=5125,d>>=2}var k=4,n=r.buffer.dimension;1===n&&(k=0);2===n&&(k=1);3===n&&(k=4);"object"===typeof f&&("primitive"in f&&(k=b[f.primitive]),"count"in f&&(d=f.vertCount|0));r.primType=k;r.vertCount=
d;r.type=e;return p}var r=new k,u=f.create(null,34963,!0);r.buffer=u._buffer;p(e);p._reglType="elements";p._elements=r;p.destroy=function(){u.destroy();r.buffer=null};return p}k.prototype.bind=function(){this.buffer.bind()};return{create:y,createStream:function(a){return y({usage:"stream",data:a})._elements},destroyStream:function(a){f.destroyStream(a.buffer)},getElements:function(a){return"function"===typeof a&&a._elements instanceof k?a._elements:null}}}},{"./constants/primitives.json":7,"./util/is-ndarray":22,
"./util/is-typed-array":23}],11:[function(e,k,q){k.exports=function(e){function a(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{b[a]=
e.getExtension(a)}catch(h){}})}var b={};a();return{extensions:b,refresh:a}}},{}],12:[function(e,k,q){var m=e("./util/values"),a=e("./util/extend");k.exports=function(b,e,h,f,k){function y(a,b,d,f){this.target=a;this.level=b;this.texture=d;this.renderbuffer=f}function q(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function B(a,b){var d=b.width,f=b.height;if(a.texture)var e=a.texture._texture,m=Math.max(1,e.params.width>>a.level),h=Math.max(1,
e.params.height>>a.level),d=d||m,f=f||h;else e=a.renderbuffer._renderbuffer,d=d||e.width,f=f||e.height;e.refCount+=1;b.width=d;b.height=f}function r(a,d){d?d.texture?b.framebufferTexture2D(36160,a,d.target,d.texture._texture.texture,d.level):b.framebufferRenderbuffer(36160,a,36161,d.renderbuffer._renderbuffer.renderbuffer):b.framebufferTexture2D(36160,a,3553,null,0)}function u(a){var b=3553,d=0,f=null,e=null;"object"===typeof a&&("level"in a&&(d=a.level|0),"target"in a&&(b=a.target|0));var m=a._reglType;
"texture"===m?f=a:"renderbuffer"===m&&(e=a,b=36161,d=0);return new y(b,d,f,e)}function A(a){return a&&(a.texture||a.renderbuffer)}function d(){this.id=Q++;K[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function z(a){b.isFramebuffer(a.framebuffer)||(a.framebuffer=b.createFramebuffer());n.dirty=!0;b.bindFramebuffer(36160,a.framebuffer);for(var d=
a.colorAttachments,f=0;f<d.length;++f)r(36064+f,d[f]);for(f=d.length;f<h.maxColorAttachments;++f)r(36064+f,null);r(36096,a.depthAttachment);r(36128,a.stencilAttachment);r(33306,a.depthStencilAttachment);e.webgl_draw_buffers&&e.webgl_draw_buffers.drawBuffersWEBGL(fa[d.length]);b.checkFramebufferStatus(36160)}function w(a){a=a.framebuffer;b.isFramebuffer(a)&&b.deleteFramebuffer(a)}var n={current:null,next:null,dirty:!1},X={rgba:6408},F={rgba4:32854,rgb565:36194,"rgb5 a1":32855};e.ext_srgb&&(F.srgba=
35907);e.ext_color_buffer_half_float&&(F.rgba16f=34842,F.rgb16f=34843);e.webgl_color_buffer_float&&(F.rgba32f=34836);var E=[],P=[];e.webgl_depth_texture&&(E.push(6402),P.push(34041));a(a({},X),F);m(X);m(F);F=5121;E={uint8:5121};e.oes_texture_half_float&&(F=E["half float"]=36193);e.oes_texture_float&&(F=E["float"]=5126);E.best=F;var fa=function(){for(var a=Array(h.maxDrawbuffers),b=0;b<=h.maxDrawbuffers;++b)for(var d=a[b]=Array(b),f=0;f<b;++f)d[f]=36064+f;return a}(),Q=0,K={};return a(n,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof d)?a:null},create:function(a){function e(a){var d,h=a||{},p=a=0;if("shape"in h){var n=h.shape;a=n[0];p=n[1]}else"radius"in h&&(a=p=h.radius),"width"in h&&(a=h.width),"height"in h&&(p=h.height);var r=null,n=!1;if("colorBuffers"in h||"colorBuffer"in h){r=h.colorBuffers||h.colorBuffer;Array.isArray(r)||(r=[r]);m.width=a;m.height=p;r=r.map(u);for(d=0;d<r.length;++d)B(r[d],m);a=m.width;p=m.height}else{var w=!0,E="rgba",v="uint8",P=1,
n=!0;m.width=a=a||b.drawingBufferWidth;m.height=p=p||b.drawingBufferHeight;"format"in h&&(E=h.format,w=E in X);"type"in h&&(v=h.type);"colorCount"in h&&(P=h.colorCount|0);if(m.ownsColor)for(r=m.colorAttachments;r.length>P;)q(r.pop());else r=[];for(d=0;d<r.length;++d){var I;a:{I=r[d];var H=w,F=E,K=a,Q=p;if(I.texture){var M=I.texture;if(H){M({format:F,type:v,width:K,height:Q});M._texture.refCount+=1;I=!0;break a}}else if(M=I.renderbuffer,!H){M({format:F,width:K,height:Q});M._renderbuffer.refCount+=
1;I=!0;break a}q(I);I=!1}I||(r[d--]=r[r.length-1],r.pop())}for(;r.length<P;)w?r.push(new y(3553,0,f.create({format:E,type:v,width:a,height:p},3553),null)):r.push(new y(36161,0,null,k.create({format:E,width:a,height:p})))}m.width=a;m.height=p;E=w=d=null;v=!1;"depthBuffer"in h&&(d=u(h.depthBuffer));"stencilBuffer"in h&&(w=u(h.stencilBuffer));"depthStencilBuffer"in h&&(E=u(h.depthStencilBuffer));if(d||w||E)B(d||w||E,m);else if(P=!0,H=I=!1,"depth"in h&&(P=!!h.depth),"stencil"in h&&(I=!!h.stencil),"depthTexture"in
h&&(H=!!h.depthTexture),h=m.depthAttachment||m.stencilAttachment||m.depthStencilAttachment,F=null,P||I)v=!0,H?(H=I?"depth stencil":"depth",m.ownsDepthStencil&&h.texture?(h.texture({format:H,width:a,height:p}),h.texture._texture.refCount+=1,F=h):F=new y(3553,0,f.create({format:H,width:a,height:p},3553),null)):(H=P?I?"depth stencil":"depth":"stencil",m.ownsDepthStencil&&h.renderbuffer?(h.renderbuffer({format:H,width:a,height:p}),h.renderbuffer._renderbuffer.refCount+=1,F=h):F=new y(36161,0,null,k.create({format:H,
width:a,height:p}))),P?I?E=F:d=F:w=F;a=m;a.colorAttachments.forEach(q);q(a.depthAttachment);q(a.stencilAttachment);q(a.depthStencilAttachment);m.colorAttachments=r;m.depthAttachment=d;m.stencilAttachment=w;m.depthStencilAttachment=E;m.ownsColor=n;m.ownsDepthStencil=v;e.color=r.map(A);e.depth=A(d);e.stencil=A(w);e.depthStencil=A(E);z(m);e.width=m.width;e.height=m.height;return e}var m=new d;e(a);e._reglType="framebuffer";e._framebuffer=m;e._destroy=function(){w(m)};return e},clear:function(){m(K).forEach(w)},
refresh:function(){m(K).forEach(z)}})}},{"./util/extend":21,"./util/values":29}],13:[function(e,k,q){k.exports=function(e,a){var b=1;a.ext_texture_filter_anisotropic&&(b=e.getParameter(34047));var p=1,h=1;a.webgl_draw_buffers&&(p=e.getParameter(34852),h=e.getParameter(36063));return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(a).filter(function(b){return!!a[b]}),
maxAnisotropic:b,maxDrawbuffers:p,maxColorAttachments:h,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),
maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}}},{}],14:[function(e,k,q){var m=e("./util/is-typed-array");k.exports=function(a,b,e){return function(h){var f=h||{};m(h)?f={data:f}:2===arguments.length?f={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof h&&(f={});b();var k=f.x||0,y=f.y||0,q=f.width||e.viewportWidth,B=f.height||e.viewportHeight,f=f.data||new Uint8Array(q*B*4);a.pixelStorei(3333,
4);a.readPixels(k,y,q,B,6408,5121,f);return f}}},{"./util/is-typed-array":23}],15:[function(e,k,q){var m=e("./util/values");k.exports=function(a,b,e){function h(){this.id=q++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function f(b){a.isRenderbuffer(b.renderbuffer)||(b.renderbuffer=a.createRenderbuffer());a.bindRenderbuffer(36161,b.renderbuffer);a.renderbufferStorage(36161,b.format,b.width,b.height)}function k(b){var f=b.renderbuffer;a.bindRenderbuffer(36161,
null);a.isRenderbuffer(f)&&a.deleteRenderbuffer(f);b.renderbuffer=null;b.refCount=0;delete B[b.id]}var y={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};b.ext_srgb&&(y.srgba=35907);b.ext_color_buffer_half_float&&(y.rgba16f=34842,y.rgb16f=34843);b.webgl_color_buffer_float&&(y.rgba32f=34836);var q=0,B={};h.prototype.decRef=function(){0===--this.refCount&&k(this)};return{create:function(a){function b(a){a=a||{};var h=0,m=0;"shape"in a?(m=a.shape,h=m[0]|0,m=
m[1]|0):("radius"in a&&(h=m=a.radius|0),"width"in a&&(h=a.width|0),"height"in a&&(m=a.height|0));b.width=e.width=Math.max(h,1);b.height=e.height=Math.max(m,1);e.format=32854;"format"in a&&(e.format=y[a.format]);f(e);return b}var e=new h;B[e.id]=e;b(a);b._reglType="renderbuffer";b._renderbuffer=e;b.destroy=function(){e.decRef()};return b},refresh:function(){m(B).forEach(f)},clear:function(){m(B).forEach(k)}}}},{"./util/values":29}],16:[function(e,k,q){var m=e("./util/values");k.exports=function(a,
b){function e(a,b,f,h){this.name=a;this.id=b;this.location=f;this.info=h}function h(a,b){for(var f=0;f<a.length;++f)if(a[f].id===b.id){a[f].location=b.location;return}a.push(b)}function f(d,f,e){e=35632===d?q:B;var h=e[f];if(!h){var m=b.str(f),h=a.createShader(d);a.shaderSource(h,m);a.compileShader(h);e[f]=h}return h}function k(a,b){this.id=A++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[]}function y(d,m){var k,n;k=f(35632,d.fragId);n=f(35633,d.vertId);var r=d.program=
a.createProgram();a.attachShader(r,k);a.attachShader(r,n);a.linkProgram(r);var u=a.getProgramParameter(r,35718),y=d.uniforms;for(k=0;k<u;++k)if(n=a.getActiveUniform(r,k))if(1<n.size)for(var q=0;q<n.size;++q){var A=n.name.replace("[0]","["+q+"]");h(y,new e(A,b.id(A),a.getUniformLocation(r,A),n))}else h(y,new e(n.name,b.id(n.name),a.getUniformLocation(r,n.name),n));u=a.getProgramParameter(r,35721);y=d.attributes;for(k=0;k<u;++k)(n=a.getActiveAttrib(r,k))&&h(y,new e(n.name,b.id(n.name),a.getAttribLocation(r,
n.name),n))}var q={},B={},r={},u=[],A=0;return{clear:function(){var b=a.deleteShader.bind(a);m(q).forEach(b);q={};m(B).forEach(b);B={};u.forEach(function(b){a.deleteProgram(b.program)});u.length=0;r={}},refresh:function(){q={};B={};u.forEach(y)},program:function(a,b,f){var e=r[b];e||(e=r[b]={});var h=e[a];h||(h=new k(b,a),y(h,f),e[a]=h,u.push(h));return h},shader:f,frag:null,vert:null}}},{"./util/values":29}],17:[function(e,k,q){k.exports=function(){var e={"":0},a=[""];return{id:function(b){var p=
e[b];if(p)return p;p=e[b]=a.length;a.push(b);return p},str:function(b){return a[b]}}}},{}],18:[function(e,k,q){function m(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function a(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var f=a[0].length,e=1;e<b;++e)if(!Array.isArray(a[e])||a[e].length!==f)return!1;return!0}function b(a){return Object.prototype.toString.call(a)}function p(a){return"[object HTMLCanvasElement]"===b(a)}function h(a){return"[object CanvasRenderingContext2D]"===
b(a)}var f=e("./util/extend"),J=e("./util/values"),y=e("./util/is-typed-array"),U=e("./util/is-ndarray"),B=e("./util/load-texture"),r=e("./util/to-half-float"),u=e("./util/parse-dds"),A=[9984,9986,9985,9987];k.exports=function(d,e,k,n,q){function F(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=
this.miplevel=0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function E(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function P(a,b){var c,d,e=0,f=0,h=0,m=0,p=0,n=0,k=!1,r=!1,u=!1;for(c=0;c<b.length;++c)d=b[c],m=m||d.width<<d.miplevel,p=p||d.height<<d.miplevel,
e=e||d.type,f=f||d.format,h=h||d.internalformat,n=n||d.channels,k=k||d.needsPoll,r=r||d.needsListeners,d=d.miplevel,u=u||0<d;a.needsPoll=k;a.needsListeners=r;a.width=m;a.height=p;a.format=f;a.internalformat=h;a.type=e;if(3553!==a.target)for(c=0;6>c;++c);c=0<=A.indexOf(a.minFilter);a.genMipmaps=!u&&(a.genMipmaps||c);u=u||a.genMipmaps;a.minFilter||(a.minFilter=u?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(c=0;c<b.length;++c)d=b[c],d.channels||(d.channels=n),d.format||(d.format=f),d.internalformat||
(d.internalformat=h),d.type||(d.type=e)}function fa(a){this.id=na++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new E(a);this.pixels=[]}function Q(a,b){function c(a,g){var c=g.mipmap,d;if(Array.isArray(c))for(var e=0;e<c.length;++e)d=new F(a),d.parseFlags(b),d.parseFlags(g),d.parse(c[e],e),f.push(d);else d=new F(a),d.parseFlags(b),d.parse(g,0),f.push(d)}var d;aa(a);var e=a.params;E.call(e,a.target);var f=a.pixels;f.length=
0;e.parse(b);if(3553===a.target)c(3553,b);else{var h=b.faces||b;if(Array.isArray(h))for(d=0;6>d;++d)c(34069+d,h[d]);else if("string"!==typeof h)for(d=0;6>d;++d)c(34069+d,{})}P(e,f);e.needsListeners&&v(a);e.needsPoll&&(a.pollId=da.length,da.push(a));K(a)}function K(a){d.isTexture(a.texture)||(a.texture=d.createTexture());var b=a.target,c=a.unit;0<=c?(d.activeTexture(33984+c),H=c):d.bindTexture(b,a.texture);for(var b=a.pixels,e=a.params,f=0;f<b.length;++f)b[f].upload(e);e.upload();0>c&&((c=N[H])?d.bindTexture(c.target,
c.texture):(a.unit=H,N[H]=a))}function v(a){function b(a,g,c){var d=u(c);d.pixels.forEach(function(b){var c=new F(d.cube?b.target:a);c.channels=d.channels;c.compressed=d.compressed;c.type=d.type;c.internalformat=d.format;c.format=I[d.format];c.width=b.width;c.height=b.height;c.miplevel=b.miplevel||g;c.data=b.data;e.push(c)})}function c(){for(var c=0;c<e.length;++c){var f=e[c],h=f.image,m=f.video,p=f.xhr;h&&h.complete?(f.width=h.naturalWidth,f.height=h.naturalHeight):m&&2<m.readyState?(f.width=m.width,
f.height=m.height):p&&4===p.readyState&&(e[c]=e[e.length-1],e.pop(),p.removeEventListener("readystatechange",K),b(f.target,f.miplevel,p.response))}P(d,e);K(a)}var d=a.params,e=a.pixels;e.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){e.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",
c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function aa(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((da[b]=da[da.length-1]).id=b,da.pop(),a.pollId=-1)}function ga(a){var b=a.texture,c=a.unit,e=a.target;0<=c&&(d.activeTexture(33984+c),H=c,d.bindTexture(e,null),N[c]=null);aa(a);d.isTexture(b)&&d.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete Z[a.id]}var S={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
Y={repeat:10497,clamp:33071,mirror:33648},ba={nearest:9728,linear:9729},L=f({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ba),O={none:0,browser:37444},G={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},C={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},R={};e.ext_srgb&&(C.srgb=35904,C.srgba=35906);e.oes_texture_float&&(G["float"]=5126);e.oes_texture_half_float&&
(G["half float"]=36193);e.webgl_depth_texture&&(f(C,{depth:6402,"depth stencil":34041}),f(G,{uint16:5123,uint32:5125,"depth stencil":34042}));e.webgl_compressed_texture_s3tc&&f(R,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});e.webgl_compressed_texture_atc&&f(R,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});e.webgl_compressed_texture_pvrtc&&f(R,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});e.webgl_compressed_texture_etc1&&(R["rgb etc1"]=36196);var ea=Array.prototype.slice.call(d.getParameter(34467));Object.keys(R).forEach(function(a){var b=R[a];0<=ea.indexOf(b)&&(C[a]=b)});var ca=Object.keys(C);k.textureFormats=ca;var I=ca.reduce(function(a,b){var c=C[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});f(F.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=O[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=C[b];b in G&&(this.type=G[b]);b in R&&(this.compressed=!0)}"type"in a&&(this.type=G[a.type]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),
"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(d,e){this.miplevel=e;this.width>>=e;this.height>>=e;var c=d;switch(typeof d){case "object":if(!d)return;
this.parseFlags(d);var f=d.data;if("string"===typeof f||f&&(y(f)||m(f)||U(f)||p(f)||h(f)||"[object HTMLImageElement]"===b(f)||"[object HTMLVideoElement]"===b(f)||a(f)))c=d.data;break;case "undefined":return}"string"===typeof c&&(c=B(c,this.crossOrigin));var f=null,n=!1;if(null!==c)if(y(c))this.data=c;else if(m(c))f=c,n=!0;else if(U(c)){Array.isArray(c.data)?(f=c.data,n=!0):this.data=c.data;var k=c.shape;this.width=k[0];this.height=k[1];this.channels=3===k.length?k[2]:1;k=c.stride;this.strideX=c.stride[0];
this.strideY=c.stride[1];this.strideC=3===k.length?c.stride[2]:1;this.offset=c.offset;this.needsTranspose=!0}else if(p(c)||h(c))p(c)?this.canvas=c:this.canvas=c.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===b(c))this.image=c,c.complete?(this.width=c.naturalWidth,this.height=c.naturalHeight):(this.width=this.width||c.naturalWidth,this.height=this.height||c.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===b(c))this.video=c,1<c.readyState?(this.width=c.width,this.height=c.height):(this.width=this.width||c.width,this.height=this.height||c.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===b(c))this.xhr=c,this.needsListeners=!0;else if(a(c)){var n=c[0].length,k=c.length,u=1,E,w,A,v;if(Array.isArray(c[0][0]))for(u=c[0][0].length,f=Array(n*k*u),w=v=0;w<k;++w)for(E=0;E<n;++E)for(A=0;A<u;++A)f[v++]=c[w][E][A];
else for(f=Array(n*k),w=v=0;w<k;++w)for(E=0;E<n;++E)f[v++]=c[w][E];this.width=n;this.height=k;this.channels=u;n=!0}else d.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||q.viewportWidth)|0,this.height=(this.height||q.viewportHeight)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=
[6409,6410,6407,6408][(this.channels=this.channels||4)-1]);c=this.internalformat;k=this.format=I[c];if(!this.channels)switch(k){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}k=this.type;5126!==k&&36193!==k&&(k||(k=6402===c?5125:5121));this.type=k;if(n)switch(k){case 5121:this.data=new Uint8Array(f);break;case 5123:this.data=new Uint16Array(f);break;case 5125:this.data=new Uint32Array(f);break;
case 5126:this.data=new Float32Array(f);break;case 36193:this.data=r(f)}if(this.data&&this.needsTranspose){f=this.data;c=this.width;n=this.height;k=this.channels;u=this.strideX;E=this.strideY;w=this.strideC;A=this.offset;v=new f.constructor(c*n*k);for(var z=0,J=0;J<n;++J)for(var C=0;C<c;++C)for(var F=0;F<k;++F)v[z++]=f[E*J+u*C+w*F+A];this.data=v}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){d.pixelStorei(37440,
this.flipY);d.pixelStorei(37441,this.premultiplyAlpha);d.pixelStorei(37443,this.colorSpace);d.pixelStorei(3317,this.unpackAlignment);var b=this.target,c=this.miplevel,f=this.image,e=this.canvas,h=this.video,m=this.data,p=this.internalformat,k=this.format,r=this.type,u=this.width||Math.max(1,a.width>>c);a=this.height||Math.max(1,a.height>>c);h&&2<h.readyState?d.texImage2D(b,c,k,k,r,h):f&&f.complete?d.texImage2D(b,c,k,k,r,f):e?d.texImage2D(b,c,k,k,r,e):this.compressed?d.compressedTexImage2D(b,c,p,u,
a,0,m):this.copy?(n(),d.copyTexImage2D(b,c,k,this.x,this.y,u,a,0)):m?d.texImage2D(b,c,k,u,a,0,k,r,m):d.texImage2D(b,c,k,u||1,a||1,0,k,r,null)}});f(E.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=L[a.min]);"mag"in a&&(this.magFilter=ba[a.mag]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var d=a.wrap;"string"===typeof d?b=c=Y[d]:Array.isArray(d)&&(b=Y[d[0]],c=Y[d[1]])}else"wrapS"in a&&(b=Y[a.wrapS]),"wrapT"in a&&(c=Y[a.wrapT]);this.wrapS=b;this.wrapT=c;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=S[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;d.texParameteri(a,10241,this.minFilter);d.texParameteri(a,10240,this.magFilter);d.texParameteri(a,10242,this.wrapS);d.texParameteri(a,10243,this.wrapT);e.ext_texture_filter_anisotropic&&d.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(d.hint(33170,this.mipmapHint),d.generateMipmap(a))}});
var H=0,na=0,Z={},da=[],M=k.maxTextureUnits,N=Array(M).map(function(){return null});f(fa.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<M;++b){var c=N[b];if(c){if(0<c.bindCount)continue;c.unit=-1}N[b]=this;a=b;break}this.unit=a;d.activeTexture(33984+a);d.bindTexture(this.target,this.texture);H=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&ga(this)}});return{create:function(a,b){function c(a,f,e,g,h,m){var p=a||{};34067===
b&&6===arguments.length&&(p=[a,f,e,g,h,m]);Q(d,p);c.width=d.params.width;c.height=d.params.height;return c}var d=new fa(b);Z[d.id]=d;c(a);c._reglType="texture";c._texture=d;c.destroy=function(){d.decRef()};return c},refresh:function(){J(Z).forEach(K);for(var a=0;a<M;++a)N[a]=null;H=0;d.activeTexture(33984)},clear:function(){for(var a=0;a<M;++a)d.activeTexture(33984+a),d.bindTexture(3553,null),N[a]=null;d.activeTexture(33984);H=0;J(Z).forEach(ga)},poll:function(){da.forEach(K)},getTexture:function(a){return null}}}},
{"./util/extend":21,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/load-texture":24,"./util/parse-dds":26,"./util/to-half-float":28,"./util/values":29}],19:[function(e,k,q){k.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],20:[function(e,k,q){function m(a){return Array.prototype.slice.call(a)}function a(a){return m(a).join("")}var b=e("./extend");k.exports=function(){function e(){var h=[],k=[];return b(function(){h.push.apply(h,
m(arguments))},{def:function(){var a="v"+f++;k.push(a);0<arguments.length&&(h.push(a,"="),h.push.apply(h,m(arguments)),h.push(";"));return a},toString:function(){return a([0<k.length?"var "+k+";":"",a(h)])}})}function h(){function a(b,d){h(b,d,"=",f.def(b,d),";")}var f=e(),h=e(),d=f.toString,m=h.toString;return b(f,{entry:f,exit:h,save:a,set:function(b,d,e){a(b,d);f(b,d,"=",e,";")},toString:function(){return d()+m()}})}var f=0,k=[],y=[],q=e(),B={};return{global:q,link:function(a){for(var b=0;b<y.length;++b)if(y[b]===
a)return k[b];b="g"+f++;k.push(b);y.push(a);return b},block:e,proc:function(f,e){function m(){var a="a"+d.length;d.push(a);return a}var d=[];e=e||0;for(var k=0;k<e;++k)m();var k=h(),p=k.toString;return B[f]=b(k,{arg:m,toString:function(){return a(["function(",d.join(),"){",p(),"}"])}})},scope:h,cond:function(){var f=a(arguments),e=h(),k=h(),d=e.toString,p=k.toString;return b(e,{then:function(){e.apply(e,m(arguments));return this},"else":function(){k.apply(k,m(arguments));return this},toString:function(){var b=
p();b&&(b="else{"+b+"}");return a(["if(",f,"){",d(),"}",b])}})},compile:function(){var b=['"use strict";',q,"return {"];Object.keys(B).forEach(function(a){b.push('"',a,'":',B[a].toString(),",")});b.push("}");var e=a(b).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,k.concat(e)).apply(null,y)}}}},{"./extend":21}],21:[function(e,k,q){k.exports=function(e,a){for(var b=Object.keys(a),k=0;k<b.length;++k)e[b[k]]=a[b[k]];return e}},{}],22:[function(e,k,q){var m=e("./is-typed-array");
k.exports=function(a){return!!a&&"object"===typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"===typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||m(a.data))}},{"./is-typed-array":23}],23:[function(e,k,q){var m=e("../constants/arraytypes.json");k.exports=function(a){return Object.prototype.toString.call(a)in m}},{"../constants/arraytypes.json":5}],24:[function(e,k,q){k.exports=function(e,a){if("undefined"!==typeof document){var b;b=(b=/\.(\w+)(\?.*)?$/.exec(e))&&
b[1]?b[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(b))return b=document.createElement("video"),b.autoplay=!0,b.loop=!0,a&&(b.crossOrigin=a),b.src=e,b;if(0<=["dds"].indexOf(b))return b=new XMLHttpRequest,b.responseType="arraybuffer",b.open("GET",e,!0),b.send(),b;b=new Image;a&&(b.crossOrigin=a);b.src=e;return b}return null}},{}],25:[function(e,k,q){k.exports=function(e,a){for(var b=Array(e),k=0;k<e;++k)b[k]=a(k);return b}},
{}],26:[function(e,k,q){k.exports=function(e){function k(a){for(var b=S,d=Y,f=0;f<C;++f){var h=Math.max(1,b+3>>2)*Math.max(1,d+3>>2)*O;ea.pixels.push({target:a,miplevel:f,width:b,height:d,data:new Uint8Array(e,R,h)});R+=h;b>>=1;d>>=1}}var q=new Int32Array(e),ga=q[n],S=q[F],Y=q[X],ba=y,L=0,O=0,G=4;switch(q[fa]){case u:O=8;ga&r?(G=3,L=b):L=p;break;case A:O=16;L=h;break;case d:O=16;L=f;break;case z:O=8,L=J}var C=1;q[P]&U&&(C=Math.max(1,q[E]));var R=q[w]+4,ea={width:S,height:Y,channels:G,format:L,type:ba,
compressed:!0,cube:!1,pixels:[]};if(q[Q]&B)for(ea.cube=!0,q=0;6>q;++q)k(a+q);else k(m);return ea};var m=3553,a=34069,b=33776,p=33777,h=33778,f=33779,J=36196,y=5121,U=131072,B=512,r=64,u=827611204,A=861165636,d=894720068,z=826496069,w=1,n=2,X=3,F=4,E=7,P=20,fa=21,Q=28},{}],27:[function(e,k,q){k.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:{next:function(e){setTimeout(e,
30)},cancel:clearTimeout}},{}],28:[function(e,k,q){k.exports=function(e){for(var a=new Float32Array(e),a=new Uint32Array(a.buffer),b=new Uint16Array(e.length),k=0;k<e.length;++k)if(isNaN(e[k]))b[k]=65535;else if(Infinity===e[k])b[k]=31744;else if(-Infinity===e[k])b[k]=64512;else{var h=a[k],f=h>>>31<<15,q=(h<<1>>>24)-127,h=h>>13&1023;b[k]=-24>q?f:-14>q?f+(h+1024>>-14-q):15<q?f+31744:f+(q+15<<10)+h}return b}},{}],29:[function(e,k,q){k.exports=function(e){return Object.keys(e).map(function(a){return e[a]})}},
{}],30:[function(e,k,q){function m(e,h){function f(){var a=window.innerWidth,f=window.innerHeight;e!==document.body&&(f=e.getBoundingClientRect(),a=f.right-f.left,f=f.top-f.bottom);k.width=q*a;k.height=q*f;b(k.style,{width:a+"px",height:f+"px"})}var k=document.createElement("canvas"),m=a(k,h);b(k.style,{border:0,margin:0,padding:0,top:0,left:0});e.appendChild(k);e===document.body&&(k.style.position="absolute",b(e.style,{margin:0,padding:0}));var q=+m.options.pixelRatio;window.addEventListener("resize",
f,!1);var B=m.options.onDestroy;m.options=b(b({},m.options),{onDestroy:function(){window.removeEventListener("resize",f);e.removeChild(k);B&&B()}});f();return m}function a(a,e){function f(b){try{return a.getContext(b,k)}catch(e){return null}}var k=e.glOptions||{};return{gl:f("webgl")||f("experimental-webgl")||f("webgl-experimental"),options:b({pixelRatio:window.devicePixelRatio},e)}}var b=e("./util/extend");k.exports=function(e){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:e[0],
options:e[1]||{}};var h=document.body,f=e[1]||{};if("string"===typeof e[0])h=document.querySelector(e[0])||document.body;else if("object"===typeof e[0])if(e[0]instanceof HTMLElement)h=e[0];else{if(e[0]instanceof WebGLRenderingContext)return{gl:e[0],options:b({pixelRatio:1},f)};f=e[0]}return h.nodeName&&"CANVAS"===h.nodeName.toUpperCase()?a(h,f):m(h,f)}},{"./util/extend":21}],31:[function(e,k,q){k.exports=function(a,b){function e(a){var b=!1;"altKey"in a&&(b=b||a.altKey!==n.alt,n.alt=!!a.altKey);"shiftKey"in
a&&(b=b||a.shiftKey!==n.shift,n.shift=!!a.shiftKey);"ctrlKey"in a&&(b=b||a.ctrlKey!==n.control,n.control=!!a.ctrlKey);"metaKey"in a&&(b=b||a.metaKey!==n.meta,n.meta=!!a.metaKey);return b}function h(a,f){var h=m.x(f),k=m.y(f);"buttons"in f&&(a=f.buttons|0);if(a!==d||h!==z||k!==w||e(f))d=a|0,z=h||0,w=k||0,b&&b(d,z,w,n)}function f(a){h(0,a)}function k(){if(d||z||w||n.shift||n.alt||n.meta||n.control)d=z=w=0,n.shift=n.alt=n.control=n.meta=!1,b&&b(0,0,0,n)}function q(a){e(a)&&b&&b(d,z,w,n)}function U(a){0===
m.buttons(a)?h(0,a):h(d,a)}function B(a){h(d|m.buttons(a),a)}function r(a){h(d&~m.buttons(a),a)}function u(){X||(X=!0,a.addEventListener("mousemove",U),a.addEventListener("mousedown",B),a.addEventListener("mouseup",r),a.addEventListener("mouseleave",f),a.addEventListener("mouseenter",f),a.addEventListener("mouseout",f),a.addEventListener("mouseover",f),a.addEventListener("blur",k),a.addEventListener("keyup",q),a.addEventListener("keydown",q),a.addEventListener("keypress",q),a!==window&&(window.addEventListener("blur",
k),window.addEventListener("keyup",q),window.addEventListener("keydown",q),window.addEventListener("keypress",q)))}function A(){X&&(X=!1,a.removeEventListener("mousemove",U),a.removeEventListener("mousedown",B),a.removeEventListener("mouseup",r),a.removeEventListener("mouseleave",f),a.removeEventListener("mouseenter",f),a.removeEventListener("mouseout",f),a.removeEventListener("mouseover",f),a.removeEventListener("blur",k),a.removeEventListener("keyup",q),a.removeEventListener("keydown",q),a.removeEventListener("keypress",
q),a!==window&&(window.removeEventListener("blur",k),window.removeEventListener("keyup",q),window.removeEventListener("keydown",q),window.removeEventListener("keypress",q)))}b||(b=a,a=window);var d=0,z=0,w=0,n={shift:!1,alt:!1,control:!1,meta:!1},X=!1;u();var F={element:a};Object.defineProperties(F,{enabled:{get:function(){return X},set:function(a){a?u():A},enumerable:!0},buttons:{get:function(){return d},enumerable:!0},x:{get:function(){return z},enumerable:!0},y:{get:function(){return w},enumerable:!0},
mods:{get:function(){return n},enumerable:!0}});return F};var m=e("mouse-event")},{"mouse-event":32}],32:[function(e,k,q){function m(a){return a.target||a.srcElement||window}q.buttons=function(a){if("object"===typeof a){if("buttons"in a)return a.buttons;if("which"in a){a=a.which;if(2===a)return 4;if(3===a)return 2;if(0<a)return 1<<a-1}else if("button"in a){a=a.button;if(1===a)return 4;if(2===a)return 2;if(0<=a)return 1<<a}}return 0};q.element=m;q.x=function(a){if("object"===typeof a){if("offsetX"in
a)return a.offsetX;var b=m(a).getBoundingClientRect();return a.clientX-b.left}return 0};q.y=function(a){if("object"===typeof a){if("offsetY"in a)return a.offsetY;var b=m(a).getBoundingClientRect();return a.clientY-b.top}return 0}},{}],33:[function(e,k,q){var m=e("./lib/util/extend"),a=e("./lib/dynamic"),b=e("./lib/util/raf"),p=e("./lib/util/clock"),h=e("./lib/strings"),f=e("./lib/webgl"),J=e("./lib/extension"),y=e("./lib/limits"),U=e("./lib/buffer"),B=e("./lib/elements"),r=e("./lib/texture"),u=e("./lib/renderbuffer"),
A=e("./lib/framebuffer"),d=e("./lib/attribute"),z=e("./lib/shader"),w=e("./lib/read"),n=e("./lib/core");k.exports=function(){function e(){g=b.next(e);G.count+=1;var a=da.viewport,c=da.scissor_box;a[0]=a[1]=c[0]=c[1]=0;G.viewportWidth=G.frameBufferWidth=G.drawingBufferWidth=a[2]=c[2]=v.drawingBufferWidth;G.viewportHeight=G.frameBufferWidth=G.drawingBufferHeight=a[3]=c[3]=v.drawingBufferHeight;a=p();G.deltaTime=(a-ba)/1E3;G.time=(a-Y)/1E3;ba=a;Z.procs.refresh();ca.poll();for(a=0;a<N.length;++a)(0,N[a])(G,
null,0)}function k(){g&&(b.cancel(e),g=0)}function q(a){k();a.preventDefault();if(aa.onContextLost)aa.onContextLost()}function P(a){v.getError();ga.refresh();Z.procs.refresh();C.refresh();ca.refresh();I.refresh();H.refresh();ea.refresh();if(aa.onContextRestored)aa.onContextRestored();e()}function fa(b){function c(b){var c={},e={};Object.keys(b).forEach(function(d){var f=b[d];a.isDynamic(f)?e[d]=a.unbox(f,d):c[d]=f});return{dynamic:e,"static":c}}function d(a){for(;p.length<a;)p.push(null);return p}
var e=c(b.context||{}),f=c(b.uniforms||{}),g=c(b.attributes||{});b=c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=m({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(b));var e=Z.compile(b,g,f,e),h=e.draw,k=e.batch,n=e.scope,p=[];return function(a,b){var c;if("function"===typeof a)return n.call(this,null,a,0);if("function"===
typeof b)if("number"===typeof a)for(c=0;c<a;++c)n.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)n.call(this,a[c],b,c);else return n.call(this,a,b,0);else if("number"===typeof a){if(0<a)return k.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return k.call(this,a,a.length)}else return h.call(this,a)}}function Q(){Z.procs.poll()}var K=f(Array.prototype.slice.call(arguments)),v=K.gl,aa=K.options,K=h(),ga=J(v),S=ga.extensions,Y=p(),ba=Y,L=v.drawingBufferWidth,O=v.drawingBufferHeight,
G={count:0,deltaTime:0,time:0,viewportWidth:L,viewportHeight:O,framebufferWidth:L,framebufferHeight:O,drawingBufferWidth:L,drawingBufferHeight:O,pixelRatio:aa.pixelRatio},L=y(v,S),C=U(v),R=B(v,S,C),O=d(v,S,L,C,K),ea=z(v,K),ca=r(v,S,L,Q,G),I=u(v,S,L),H=A(v,S,L,ca,I),na=w(v,Q,G),Z=n(v,K,S,L,C,R,ca,H,{},O,ea,{elements:null,primitive:4,count:-1,offset:0,instances:-1},G),da=Z.next,M=v.canvas,N=[],g=0;M&&(M.addEventListener("webglcontextlost",q,!1),M.addEventListener("webglcontextrestored",P,!1));Z.procs.refresh();
return m(fa,{clear:function(a){var b=0;Q();var d=a.color;d&&(v.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),b|=16384);"depth"in a&&(v.clearDepth(+a.depth),b|=256);"stencil"in a&&(v.clearStencil(a.stencil|0),b|=1024);v.clear(b)},prop:a.define.bind(null,1),context:a.define.bind(null,2),"this":a.define.bind(null,3),draw:fa({}),elements:function(a){return R.create(a)},buffer:function(a){return C.create(a,34962)},texture:function(a){return ca.create(a,3553)},cube:function(a){return 6===arguments.length?
ca.create(Array.prototype.slice.call(arguments),34067):ca.create(a,34067)},renderbuffer:function(a){return I.create(a)},framebuffer:function(a){return H.create(a)},framebufferCube:function(a){},attributes:v.getContextAttributes(),frame:function(a){N.push(a);!g&&0<N.length&&e();return{cancel:function(){var b=N.find(function(b){return b===a});0>b||(N.splice(b,1),0>=N.length&&k())}}},limits:L,read:na,destroy:function(){k();M&&(M.removeEventListener("webglcontextlost",q),M.removeEventListener("webglcontextrestored",
P));ea.clear();H.clear();I.clear();ca.clear();C.clear();if(aa.onDestroy)aa.onDestroy()},_gl:v,_refresh:function(){Z.procs.refresh()}})}},{"./lib/attribute":3,"./lib/buffer":4,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/strings":17,"./lib/texture":18,"./lib/util/clock":19,"./lib/util/extend":21,"./lib/util/raf":27,"./lib/webgl":30}]},{},[2]);
