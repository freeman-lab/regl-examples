<!DOCTYPE html>
      <html>
        <head>
          <title>example/video.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(m,q,e){function f(b,c){if(!q[b]){if(!m[b]){var k="function"==typeof require&&require;if(!c&&k)return k(b,!0);if(t)return t(b,!0);k=Error("Cannot find module '"+b+"'");throw k.code="MODULE_NOT_FOUND",k;}k=q[b]={exports:{}};m[b][0].call(k.exports,function(c){var e=m[b][1][c];return f(e?e:c)},k,k.exports,e$$0,m,q,e)}return q[b].exports}for(var t="function"==typeof require&&require,k=0;k<e.length;k++)f(e[k]);return f})({1:[function(h,m,q){var e=h("../regl")(),f=e({frag:"\n  precision mediump float;\n  uniform sampler2D texture;\n  uniform vec2 screenShape;\n  uniform float time;\n\n  varying vec2 uv;\n\n  vec4 background () {\n    vec2 pos = 0.5 - gl_FragCoord.xy / screenShape;\n    float r = length(pos);\n    float theta = atan(pos.y, pos.x);\n    return vec4(\n      cos(pos.x * time) + sin(pos.y * pos.x * time),\n      cos(100.0 * r * cos(0.3 * time) + theta),\n      sin(time / r + pos.x * cos(10.0 * time + 3.0)),\n      1);\n  }\n\n  void main () {\n    vec4 color = texture2D(texture, uv);\n    float chromakey = step(0.15 + max(color.r, color.b), color.g);\n    gl_FragColor = mix(color, background(), chromakey);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main () {\n    uv = position;\n    gl_Position = vec4(1.0 - 2.0 * position, 0, 1);\n  }",attributes:{position:[-2,0,0,-2,2,2]},uniforms:{texture:e.prop("video"),screenShape:function(e){return[e.viewportWidth,e.viewportHeight]},time:e.context("time")},count:3});h("resl")({manifest:{video:{type:"video",src:"assets/doggie-chromakey.ogv",stream:!0}},onDone:function(t){var k=t.video;k.autoplay=!0;k.loop=!0;k.play();
var b=e.texture(k);e.frame(function(){f({video:b.subimage(k)})})}})},{"../regl":30,resl:31}],2:[function(h,m,q){function e(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}m.exports=function(f,t,k,b,c){f=k.maxAttributes;t=Array(f);for(k=0;k<f;++k)t[k]=new e;return{Record:e,scope:{},state:t}}},{}],3:[function(h,m,q){function e(b){return S[Object.prototype.toString.call(b)]|0}function f(b,c){for(var e=0;e<
c.length;++e)b[e]=c[e]}function t(b,c,e,k,f,a,t){for(var h=0,M=0;M<e;++M)for(var u=0;u<k;++u)b[h++]=c[f*M+a*u+t]}function k(b,c,e){for(var k=0,f=0;f<c.length;++f)for(var a=c[f],t=0;t<e;++t)b[k++]=a[t]}var b=h("./util/is-typed-array"),c=h("./util/is-ndarray"),r=h("./util/values"),D=h("./util/pool"),S=h("./constants/arraytypes.json"),E=h("./constants/dtypes.json"),B=h("./constants/usage.json");m.exports=function(n){function h(b){this.id=a++;this.buffer=n.createBuffer();this.type=b;this.usage=35044;
this.byteLength=0;this.dimension=1;this.dtype=5121}function w(b,c,e){b.byteLength=c.byteLength;n.bufferData(b.type,c,e)}function C(a,u,p,n,h){a.usage=p;if(Array.isArray(u))a.dtype=n||5126,0<u.length&&(Array.isArray(u[0])?(a.dimension=u[0].length,n=D.allocType(a.dtype,u.length*a.dimension),k(n,u,a.dimension),w(a,n,p),D.freeType(n)):"number"===typeof u[0]?(a.dimension=h,n=D.allocType(a.dtype,u.length),f(n,u),w(a,n,p),D.freeType(n)):b(u[0])&&(a.dimension=u[0].length,a.dtype=n||e(u[0])||5126,n=D.allocType(a.dtype,
u.length*a.dimension),k(n,u,a.dimension),w(a,n,p),D.freeType(n)));else if(b(u))a.dtype=n||e(u),a.dimension=h,w(a,u,p);else if(c(u)){var y=u.shape,r=u.stride;h=u.offset;var H=0,T=0,C=0,I=0;1===y.length?(H=y[0],T=1,C=r[0],I=0):2===y.length&&(H=y[0],T=y[1],C=r[0],I=r[1]);a.dtype=n||e(u.data)||5126;a.dimension=T;n=D.allocType(a.dtype,H*T);t(n,u.data,H,T,C,I,h);w(a,n,p);D.freeType(n)}}function p(b){var c=b.buffer;n.isBuffer(c)&&n.deleteBuffer(c);b.buffer=null;delete N[b.id]}var a=0,N={};h.prototype.bind=
function(){n.bindBuffer(this.type,this.buffer)};var m=[];return{create:function(a,u,r){function w(a){var e=35044,k=null,f=0,u=0,p=1;Array.isArray(a)||b(a)||c(a)?k=a:"number"===typeof a?f=a|0:a&&("data"in a&&(k=a.data),"usage"in a&&(e=B[a.usage]),"type"in a&&(u=E[a.type]),"dimension"in a&&(p=a.dimension|0),"length"in a&&(f=a.length|0));m.bind();k?C(m,k,e,u,p):(n.bufferData(m.type,f,e),m.dtype=u||5121,m.usage=e,m.dimension=p,m.byteLength=f);return w}var m=new h(u);N[m.id]=m;r||w(a);w._reglType="buffer";
w._buffer=m;w.subdata=function(a,u){var p=(u||0)|0;m.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var h=D.allocType(m.dtype,a.length);f(h,a);n.bufferSubData(m.type,p,h);D.freeType(h)}else if(Array.isArray(a[0])||b(a[0])){var h=a[0].length,r=D.allocType(m.dtype,a.length*h);k(r,a,h);n.bufferSubData(m.type,p,r);D.freeType(r)}}else if(b(a))n.bufferSubData(m.type,p,a);else if(c(a)){var I=a.shape,C=a.stride,Q=r=h=0,N=0;1===I.length?(h=I[0],r=1,Q=C[0],N=0):2===I.length&&(h=I[0],r=
I[1],Q=C[0],N=C[1]);I=Array.isArray(a.data)?m.dtype:e(a.data);I=D.allocType(I,h*r);t(I,a.data,h,r,Q,N,a.offset);n.bufferSubData(m.type,p,I);D.freeType(I)}return w};w.destroy=function(){p(m)};return w},createStream:function(a,b){var c=m.pop();c||(c=new h(a),c.buffer=n.createBuffer());c.bind();C(c,b,35040,0,1);return c},destroyStream:function(a){m.push(a)},clear:function(){r(N).forEach(p)},getBuffer:function(a){return a&&a._buffer instanceof h?a._buffer:null},_initBuffer:C}}},{"./constants/arraytypes.json":4,
"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/pool":25,"./util/values":28}],4:[function(h,m,q){m.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(h,m,q){m.exports={int8:5120,
int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(h,m,q){m.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(h,m,q){m.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(h,m,q){function e(a){return Array.isArray(a)||S(a)||E(a)}function f(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function t(a,b,
c,e){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=e}function k(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function b(a){return new t(!1,!1,!1,a)}function c(a,b){var c=a.type;return 0===c?(c=a.data.length,new t(!0,1<=c,2<=c,b)):new t(3===c,2===c,1===c,b)}var r=h("./util/codegen"),D=h("./util/loop"),S=h("./util/is-typed-array"),E=h("./util/is-ndarray"),B=h("./constants/primitives.json"),n=h("./constants/dtypes.json"),Q=["x","y","z","w"],w={0:0,1:1,zero:0,one:1,"src color":768,
"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},C={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},p={0:0,zero:0,keep:7680,replace:7681,increment:7682,
decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},a={cw:2304,ccw:2305},N=new t(!1,!1,!1,function(){});m.exports=function(h,m,u,J,F,E,y,ea,H,T,W,I,q){function P(d){return d.replace(".","_")}function K(d,a,b){var c=P(d);v.push(d);A[c]=g[c]=!!b;ia[c]=a}function L(d,a,b){var c=P(d);v.push(d);Array.isArray(b)?(g[c]=b.slice(),A[c]=b.slice()):g[c]=A[c]=b;ja[c]=a}function fa(){var d=r(),a=d.link,b=d.global;d.id=Ga++;d.batchId="0";var c=a(Ea),G=d.shared={props:"a0"};Object.keys(Ea).forEach(function(l){G[l]=
b.def(c,".",l)});var z=d.next={},e=d.current={};Object.keys(ja).forEach(function(l){Array.isArray(g[l])&&(z[l]=b.def(G.next,".",l),e[l]=b.def(G.current,".",l))});var l=d.constants={};Object.keys(za).forEach(function(d){l[d]=b.def(JSON.stringify(za[d]))});d.invoke=function(l,g){switch(g.type){case 0:var xa=["this",G.context,G.props,d.batchId];return l.def(a(g.data),".call(",xa.slice(0,Math.max(g.data.length+1,4)),")");case 1:return l.def(G.props,g.data);case 2:return l.def(G.context,g.data);case 3:return l.def("this",
g.data)}};d.attribCache={};var xa={};d.scopeAttrib=function(l){l=m.id(l);if(l in xa)return xa[l];var d=T.scope[l];d||(d=T.scope[l]=new pa);return xa[l]=a(d)};return d}function ca(d){var g=d["static"];d=d.dynamic;if("framebuffer"in g){var a=g.framebuffer;return a?(a=ea.getFramebuffer(a),b(function(d,g){var x=d.link(a),l=d.shared;g.set(l.framebuffer,".next",x);l=l.context;g.set(l,".framebufferWidth",x+".width");g.set(l,".framebufferHeight",x+".height");return x})):b(function(d,g){var a=d.shared;g.set(a.framebuffer,
".next","null");a=a.context;g.set(a,".framebufferWidth",a+".drawingBufferWidth");g.set(a,".framebufferHeight",a+".drawingBufferHeight");return null})}if("framebuffer"in d){var e=d.framebuffer;return c(e,function(d,g){var a=d.invoke(g,e),l=d.shared,x=l.framebuffer,a=g.def(x,".getFramebuffer(",a,")");g.set(x,".next",a);l=l.context;g.set(l,".framebufferWidth",a+"?"+a+".width:"+l+".drawingBufferWidth");g.set(l,".framebufferHeight",a+"?"+a+".height:"+l+".drawingBufferHeight");return a})}return null}function ka(d,
g){function a(l){if(l in b){var d=b[l];l=!0;var Fa=d.x|0,z=d.y|0,Z,k;"w"in d?Z=d.w|0:l=!1;"h"in d?k=d.h|0:l=!1;return new t(l&&g&&g.thisDep,l&&g&&g.contextDep,l&&g&&g.propDep,function(l,g){var a=l.shared.context,x=Z;"w"in d||(x=g.def(a,".","framebufferWidth","-",Fa));var b=k;"h"in d||(b=g.def(a,".","framebufferHeight","-",z));return[Fa,z,x,b]})}if(l in e){var f=e[l];l=c(f,function(l,d){var g=l.invoke(d,f),a=l.shared.context,x=d.def(g,".x|0"),b=d.def(g,".y|0"),c=d.def('"w" in ',g,"?",g,".w|0:","(",
a,".","framebufferWidth","-",x,")"),g=d.def('"h" in ',g,"?",g,".h|0:","(",a,".","framebufferHeight","-",b,")");return[x,b,c,g]});g&&(l.thisDep=l.thisDep||g.thisDep,l.contextDep=l.contextDep||g.contextDep,l.propDep=l.propDep||g.prpoDep);return l}return g?new t(g.thisDep,g.contextDep,g.propDep,function(l,d){var g=l.shared.context;return[0,0,d.def(g,".","framebufferWidth"),d.def(g,".","framebufferHeight")]}):null}var b=d["static"],e=d.dynamic,z=a("viewport");if(z)var k=z,z=new t(z.thisDep,z.contextDep,
z.propDep,function(l,d){var g=k.append(l,d),a=l.shared.context;d.set(a,".viewportWidth",g[2]);d.set(a,".viewportHeight",g[3]);return g});return{viewport:z,scissor_box:a("scissor.box")}}function la(d){function g(l){if(l in a){var d=m.id(a[l]);l=b(function(){return d});l.id=d;return l}if(l in e){var x=e[l];return c(x,function(l,d){var g=l.invoke(d,x);return d.def(l.shared.strings,".id(",g,")")})}return null}var a=d["static"],e=d.dynamic,G=g("frag"),z=g("vert"),f=null;k(G)&&k(z)?(f=W.program(z.id,G.id),
d=b(function(l,d){return l.link(f)})):d=new t(G&&G.thisDep||z&&z.thisDep,G&&G.contextDep||z&&z.contextDep,G&&G.propDep||z&&z.propDep,function(l,d){var g=l.shared.shader,a;a=G?G.append(l,d):d.def(g,".","frag");var x;x=z?z.append(l,d):d.def(g,".","vert");return d.def(g+".program("+x+","+a+")")});return{frag:G,vert:z,progVar:d,program:f}}function sa(d){function g(d,l){if(d in a){var x=a[d]|0;return b(function(d,g){l&&(d.OFFSET=x);return x})}if(d in f){var z=f[d];return c(z,function(d,g){var a=d.invoke(g,
z);l&&(d.OFFSET=a);return a})}return l&&G?b(function(l,d){l.OFFSET="0";return 0}):null}var a=d["static"],f=d.dynamic,G=function(){if("elements"in a){var d=a.elements;e(d)?d=E.getElements(E.create(d)):d&&(d=E.getElements(d));var l=b(function(l,g){if(d){var a=l.link(d);return l.ELEMENTS=a}return l.ELEMENTS=null});l.value=d;return l}if("elements"in f){var g=f.elements;return c(g,function(l,d){var a=l.shared,x=a.isBufferArgs,a=a.elements,b=l.invoke(d,g),c=d.def("null"),x=d.def(x,"(",b,")"),b=l.cond(x).then(c,
"=",a,".createStream(",b,");")["else"](c,"=",a,".getElements(",b,");");d.entry(b);d.exit(l.cond(x).then(a,".destroyStream(",c,");"));return l.ELEMENTS=c})}return null}(),z=g("offset",!0);return{elements:G,primitive:function(){if("primitive"in a){var d=a.primitive;return b(function(l,g){return B[d]})}if("primitive"in f){var l=f.primitive;return c(l,function(d,g){var a=d.constants.primTypes,x=d.invoke(g,l);return g.def(a,"[",x,"]")})}return G?k(G)?G.value?b(function(l,d){return d.def(l.ELEMENTS,".primType")}):
b(function(){return 4}):new t(G.thisDep,G.contextDep,G.propDep,function(l,d){var g=l.ELEMENTS;return d.def(g,"?",g,".primType:",4)}):null}(),count:function(){if("count"in a){var d=a.count|0;return b(function(){return d})}if("count"in f){var l=f.count;return c(l,function(d,g){return d.invoke(g,l)})}return G?k(G)?G?z?new t(z.thisDep,z.contextDep,z.propDep,function(l,d){return d.def(l.ELEMENTS,".vertCount-",l.OFFSET)}):b(function(l,d){return d.def(l.ELEMENTS,".vertCount")}):b(function(){return-1}):new t(G.thisDep||
z.thisDep,G.contextDep||z.contextDep,G.propDep||z.propDep,function(l,d){var g=l.ELEMENTS;return l.OFFSET?d.def(g,"?",g,".vertCount-",l.OFFSET,":-1"):d.def(g,"?",g,".vertCount:-1")}):null}(),instances:g("instances",!1),offset:z}}function ga(d){var g=d["static"],e=d.dynamic,f={};v.forEach(function(d){function z(l,a){if(d in g){var z=l(g[d]);f[k]=b(function(){return z})}else if(d in e){var v=e[d];f[k]=c(v,function(l,d){return a(l,d,l.invoke(d,v))})}}var k=P(d);switch(d){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return z(function(l){return l},
function(l,d,g){return g});case "depth.func":return z(function(l){return C[l]},function(l,d,g){return d.def(l.constants.compareFuncs,"[",g,"]")});case "depth.range":return z(function(l){return l},function(l,d,g){l=d.def("+",g,"[0]");d=d.def("+",g,"[1]");return[l,d]});case "blend.func":return z(function(d){return[w["srcRGB"in d?d.srcRGB:d.src],w["dstRGB"in d?d.dstRGB:d.dst],w["srcAlpha"in d?d.srcAlpha:d.src],w["dstAlpha"in d?d.dstAlpha:d.dst]]},function(d,g,a){function x(d,l){var c=g.def('"',d,l,'" in ',
a,"?",a,".",d,l,":",a,".",d);return g.def(b,"[",c,"]")}var b=d.constants.blendFuncs;d=x("src","RGB");var c=x("src","Alpha"),z=x("dst","RGB"),e=x("dst","Alpha");return[d,z,c,e]});case "blend.equation":return z(function(d){if("string"===typeof d)return[X[d],X[d]];if("object"===typeof d)return[X[d.rgb],X[d.alpha]]},function(d,g,a){var x=d.constants.blendEquations,b=g.def(),c=g.def();d=d.cond("typeof ",a,'==="string"');d.then(b,"=",c,"=",x,"[",a,"];");d["else"](b,"=",x,"[",a,".rgb];",c,"=",x,"[",a,".alpha];");
g(d);return[b,c]});case "blend.color":return z(function(d){return D(4,function(g){return+d[g]})},function(d,g,a){return D(4,function(d){return g.def("+",a,"[",d,"]")})});case "stencil.mask":return z(function(d){return d|0},function(d,g,a){return g.def(a,"|0")});case "stencil.func":return z(function(d){return[C[d.cmp||"keep"],d.ref||0,"mask"in d?d.mask:-1]},function(d,g,a){d=g.def('"cmp" in ',a,"?",d.constants.compareFuncs,"[",a,".cmp]",":",7680);var x=g.def(a,".ref|0");g=g.def('"mask" in ',a,"?",
a,".mask|0:-1");return[d,x,g]});case "stencil.opFront":case "stencil.opBack":return z(function(g){return["stencil.opBack"===d?1029:1028,p[g.fail||"keep"],p[g.zfail||"keep"],p[g.pass||"keep"]]},function(g,a,x){function b(d){return a.def('"',d,'" in ',x,"?",c,"[",x,".",d,"]:",7680)}var c=g.constants.stencilOps;return["stencil.opBack"===d?1029:1028,b("fail"),b("zfail"),b("pass")]});case "polygonOffset.offset":return z(function(d){return[d.factor|0,d.units|0]},function(d,g,a){d=g.def(a,".factor|0");g=
g.def(a,".units|0");return[d,g]});case "cull.face":return z(function(d){var g=0;"front"===d?g=1028:"back"===d&&(g=1029);return g},function(d,g,a){return g.def(a,'==="front"?',1028,":",1029)});case "lineWidth":return z(function(d){return d},function(d,g,a){return a});case "frontFace":return z(function(d){return a[d]},function(d,g,a){return g.def(a+'==="cw"?2304:2305')});case "colorMask":return z(function(d){return d.map(function(d){return!!d})},function(d,g,a){return D(4,function(d){return"!!"+a+"["+
d+"]"})});case "sample.coverage":return z(function(d){return["value"in d?d.value:1,!!d.invert]},function(d,g,a){d=g.def('"value" in ',a,"?+",a,".value:1");g=g.def("!!",a,".invert");return[d,g]})}});return f}function ma(d){var g=d["static"],a=d.dynamic,e={};Object.keys(g).forEach(function(d){var a=g[d],c;if("number"===typeof a||"boolean"===typeof a)c=b(function(){return a});else if("function"===typeof a&&("texture2d"===a._reglType||"textureCube"===a._reglTYpe))c=b(function(d){return d.link(a)});else if(Array.isArray(a)||
S(a))c=b(function(d){return d.global.def("[",D(a.length,function(d){return a[d]}),"]")});c.value=a;e[d]=c});Object.keys(a).forEach(function(d){var g=a[d];e[d]=c(g,function(d,a){return d.invoke(a,g)})});return e}function U(d){var g=d["static"],a=d.dynamic,f={};Object.keys(g).forEach(function(d){var a=g[d],c=m.id(d),l=new pa;if(e(a))l.state=1,l.buffer=F.getBuffer(F.create(a,34962,!1)),l.type=l.buffer.dtype;else{var k=F.getBuffer(a);if(k)l.state=1,l.buffer=k,l.type=k.dtype;else if(a.constant){var v=
a.constant;l.state=2;"number"===typeof v?l.x=v:Q.forEach(function(d,g){g<v.length&&(l[d]=v[g])})}else{var k=F.getBuffer(a.buffer),A=a.offset|0,Z=a.stride|0,p=a.size|0,h=!!a.normalized,u=0;"type"in a&&(u=n[a.type]);a=a.divisor|0;l.buffer=k;l.state=1;l.size=p;l.normalized=h;l.type=u||k.dtype;l.offset=A;l.stride=Z;l.divisor=a}}f[d]=b(function(d,g){var a=d.attribCache;if(c in a)return a[c];var x={isStream:!1};Object.keys(l).forEach(function(d){x[d]=l[d]});l.buffer&&(x.buffer=d.link(l.buffer));return a[c]=
x})});Object.keys(a).forEach(function(d){var g=a[d];f[d]=c(g,function(d,a){function x(d){a(k[d],"=",b,".",d,"|0;")}var b=d.invoke(a,g),c=d.shared,e=c.isBufferArgs,f=c.buffer,k={isStream:a.def(!1)},v=new pa;v.state=1;Object.keys(v).forEach(function(d){k[d]=a.def(""+v[d])});var A=k.buffer,Z=k.type;a("if(",e,"(",b,")){",k.isStream,"=true;",A,"=",f,".createStream(",34962,",",b,");",Z,"=",A,".dtype;","}else{",A,"=",f,".getBuffer(",b,");","if(",A,"){",Z,"=",A,".dtype;","}else if(",b,".constant){",k.state,
"=",2,";",Q.map(function(d,g){return k[d]+"="+b+".length>="+g+"?"+b+"["+g+"]:0;"}).join(""),"}else{",A,"=",f,".getBuffer(",b,".buffer);",Z,'="type" in ',b,"?",c.glTypes,"[",b,".type]:",A,".dtype;",k.normalized,"=!!",b,".normalized;");x("size");x("offset");x("stride");x("divisor");a("}}");return k})});return f}function R(d){var g=d["static"],a=d.dynamic,e={};Object.keys(g).forEach(function(d){var a=g[d];e[d]=b(function(d,g){return"number"===typeof a||"boolean"===typeof a?""+a:d.link(a)})});Object.keys(a).forEach(function(d){var g=
a[d];e[d]=c(g,function(d,a){return d.invoke(a,g)})});return e}function V(d,g,a){var b=d.shared.context,c=d.scope();Object.keys(a).forEach(function(e){g.save(b,"."+e);c(b,".",e,"=",a[e].append(d,g),";")});g(c)}function qa(d,g,a){var b=d.shared,c=b.gl,e=b.framebuffer,f;da&&(f=g.def(b.extensions,".webgl_draw_buffers"));var l=d.constants,b=l.drawBuffer,l=l.backBuffer;d=a?a.append(d,g):g.def(e,".next");g("if(",e,".dirty||",d,"!==",e,".cur){","if(",d,"){",c,".bindFramebuffer(",36160,",",d,".framebuffer);");
da&&g(f,".drawBuffersWEBGL(",b,"[",d,".colorAttachments.length]);");g("}else{",c,".bindFramebuffer(",36160,",null);");da&&g(f,".drawBuffersWEBGL(",l,");");g("}",e,".cur=",d,";",e,".dirty=false;","}")}function na(d,a,b){var c=d.shared,e=c.gl,f=d.current,k=d.next,l=c.current,A=c.next,n=d.cond(l,".dirty");v.forEach(function(a){a=P(a);if(!(a in b.state)){var c,x;if(a in k){c=k[a];x=f[a];var v=D(g[a].length,function(d){return n.def(c,"[",d,"]")});n(d.cond(v.map(function(d,g){return d+"==="+x+"["+g+"]"}).join("&&")).then(e,
".",ja[a],"(",v,");",v.map(function(d,g){return x+"["+g+"]="+d}).join(";"),";"))}else c=n.def(A,".",a),v=d.cond(c,"!==",l,".",a),n(v),a in ia?v(d.cond(c).then(e,".enable(",ia[a],");")["else"](e,".disable(",ia[a],");"),l,".",a,"=",c,";"):v(e,".",ja[a],"(",c,");",l,".",a,"=",c,";")}});0===Object.keys(b.state).length&&n(l,".dirty=false;");a(n)}function ta(d,g,a,b){var c=d.shared,e=d.current,v=c.current,l=c.gl;f(Object.keys(a)).forEach(function(c){var f=a[c];if(!b||b(f)){var A=f.append(d,g);if(ia[c]){var n=
ia[c];k(f)?A?g(l,".enable(",n,");"):g(l,".disable(",n,");"):g(d.cond(A).then(l,".enable(",n,");")["else"](l,".disable(",n,");"));g(v,".",c,"=",A,";")}else if(Array.isArray(A)){var p=e[c];g(l,".",ja[c],"(",A,");",A.map(function(d,g){return p+"["+g+"]="+d}).join(";"),";")}else g(l,".",ja[c],"(",A,");",v,".",c,"=",A,";")}})}function ra(d,g){ha&&!d.instancing&&(d.instancing=g.def(d.shared.extensions,".angle_instanced_arrays"))}function ua(d,g,a,c,b){function e(d){switch(d){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function f(a,c,b){function e(){g("if(!",n,".pointer){",v,".enableVertexAttribArray(",A,");",n,".pointer=true;}");var a=b.type,l;l=b.size?g.def(b.size,"||",c):c;g("if(",n,".type!==",a,"||",n,".size!==",l,"||",Z.map(function(d){return n+"."+d+"!=="+b[d]}).join("||"),"){",v,".bindBuffer(",34962,",",p,".buffer);",v,".vertexAttribPointer(",[A,l,a,b.normalized,b.stride,b.offset],");",n,".type=",a,";",n,
".size=",l,";",Z.map(function(d){return n+"."+d+"="+b[d]+";"}).join(""),"}");ha&&(a=b.divisor,g("if(",n,".divisor!==",a,"){",d.instancing,".vertexAttribDivisorANGLE(",[A,a],");",n,".divisor=",a,";}"))}function k(){g("if(",n,".pointer){",v,".disableVertexAttribArray(",A,");",n,".pointer=false;","}if(",Q.map(function(d,g){return n+"."+d+"!=="+h[g]}).join("||"),"){",v,".vertexAttrib4f(",A,",",h,");",Q.map(function(d,g){return n+"."+d+"="+h[g]+";"}).join(""),"}")}var v=l.gl,A=g.def(a,".location"),n=g.def(l.attributes,
"[",A,"]");a=b.state;var p=b.buffer,h=[b.x,b.y,b.z,b.w],Z=["buffer","normalized","offset","stride"];1===a?e():2===a?k():(g("if(",a,"===",1,"){"),e(),g("}else{"),k(),g("}"))}var l=d.shared;c.forEach(function(l){var c=l.name,k=a.attributes[c],v;if(k){if(!b(k))return;v=k.append(d,g)}else{if(!b(N))return;var A=d.scopeAttrib(c);v={};Object.keys(new pa).forEach(function(d){v[d]=g.def(A,".",d)})}f(d.link(l),e(l.info.type),v)})}function Y(d,g,a,b,c){for(var e=d.shared,f=e.gl,l,k=0;k<b.length;++k){var v=b[k],
A=v.name,n=v.info.type,p=a.uniforms[A],v=d.link(v)+".location";if(p){if(!c(p))continue;if(p["static"]){A=p.value;if(35678===n||35680===n)n=d.link(A._texture),g(f,".uniform1i(",v,n+".bind());"),g.exit(n,".unbind()");else if(35674===n||35675===n||35676===n)A=d.global.def("["+A+"]"),p=2,35675===n?p=3:35676===n&&(p=4),g(f,".uniformMatrix",p,"fv(",v,",false,",A,");");else{switch(n){case 5126:l="1f";break;case 35664:l="2f";break;case 35665:l="3f";break;case 35666:l="4f";break;case 35670:l="1i";break;case 5124:l=
"1i";break;case 35671:l="2i";break;case 35667:l="2i";break;case 35672:l="3i";break;case 35668:l="3i";break;case 35673:l="4i";break;case 35669:l="4i"}g(f,".uniform",l,"(",v,",",A,");")}continue}else A=p.append(d,g)}else{if(!c(N))continue;A=g.def(e.uniforms,"[",m.id(A),"]")}p=",";switch(n){case 35678:case 35680:n=g.def(A,"._texture");g(f,".uniform1i(",v,",",n,".bind());");g.exit(n,".unbind();");continue;case 5124:case 35670:l="1i";break;case 35667:case 35671:l="2iv";break;case 35668:case 35672:l="3iv";
break;case 35669:case 35673:l="4iv";break;case 5126:l="1f";break;case 35664:l="2fv";break;case 35665:l="3fv";break;case 35666:l="4fv";break;case 35674:l="Matrix2fv";p=",false,";break;case 35675:l="Matrix3fv";p=",false,";break;case 35676:l="Matrix4fv",p=",false,"}g(f,".uniform",l,"(",v,p,A,");")}}function aa(d,g,a,b){function c(l){var b=n[l];return b?b.batchStatic?b.append(d,g):b.append(d,a):g.def(A,".",l)}function e(){function d(){a(H,".drawElementsInstancedANGLE(",[h,t,r,u+"<<(("+r+"-5121)>>1)",
y],");")}function g(){a(H,".drawArraysInstancedANGLE(",[h,u,t,y],");")}p?m?d():(a("if(",p,"){"),d(),a("}else{"),g(),a("}")):g()}function f(){function d(){a(v+".drawElements("+[h,t,r,u+"<<(("+r+"-5121)>>1)"]+");")}function g(){a(v+".drawArrays("+[h,u,t]+");")}p?m?d():(a("if(",p,"){"),d(),a("}else{"),g(),a("}")):g()}var l=d.shared,v=l.gl,A=l.draw,n=b.draw,p=function(){var l=n.elements,b=g;l?(l.batchStatic||(b=a),l=l.append(d,b)):l=b.def(A,".","elements");l&&b("if("+l+")"+v+".bindBuffer(34963,"+l+".buffer.buffer);");
return l}(),h=c("primitive"),u=c("offset"),t=function(){var l=n.count,b=g;l?(l.batchStatic||(b=a),l=l.append(d,b)):l=b.def(A,".","count");return l}();if("number"===typeof t){if(0===t)return}else a("if(",t,"){"),a.exit("}");var y,H;ha&&(y=c("instances"),H=d.instancing);var r=p+".type",m=n.elements&&k(n.elements);ha&&("number"!==typeof y||0<=y)?"string"===typeof y?(a("if(",y,">0){"),e(),a("}else if(",y,"<0){"),f(),a("}")):e():f()}function ba(d,g,a,b,c){g=fa();c=g.proc("body",c);ha&&(g.instancing=c.def(g.shared.extensions,
".angle_instanced_arrays"));d(g,c,a,b);return g.compile().body}function Aa(d,g,a,b){ra(d,g);ua(d,g,a,b.attributes,function(){return!0});Y(d,g,a,b.uniforms,function(){return!0});aa(d,g,g,a)}function Ba(d,g){var a=d.proc("draw",1);ra(d,a);V(d,a,g.context);qa(d,a,g.framebuffer);na(d,a,g);ta(d,a,g.state);var b=g.shader.progVar.append(d,a);a(d.shared.gl,".useProgram(",b,".program);");if(g.shader.program)Aa(d,a,g,g.shader.program);else{var c=d.global.def("{}"),e=a.def(b,".id"),f=a.def(c,"[",e,"]");a(d.cond(f).then(f,
".call(this,a0);")["else"](f,"=",c,"[",e,"]=",d.link(function(a){return ba(Aa,d,g,a,1)}),"(",b,");",f,".call(this,a0);"))}0<Object.keys(g.state).length&&a(d.shared.current,".dirty=true;")}function Da(d,g,a,b){function c(){return!0}d.batchId="a1";ra(d,g);ua(d,g,a,b.attributes,c);Y(d,g,a,b.uniforms,c);aa(d,g,g,a)}function va(d,g,a,b){function c(d){return d.contextDep&&f||d.propDep}function e(d){return!c(d)}ra(d,g);var f=a.contextDynamic,l=g.def(),k=g.def();d.shared.props=k;d.batchId=l;var n=d.scope(),
v=d.scope();g(n.entry,"for(",l,"=0;",l,"<","a1",";++",l,"){",k,"=","a0","[",l,"];",v,"}",n.exit);a.needsContext&&V(d,v,a.context);a.needsFramebuffer&&qa(d,v,a.framebuffer);ta(d,v,a.state,c);b?(ua(d,n,a,b.attributes,e),ua(d,v,a,b.attributes,c),Y(d,n,a,b.uniforms,e),Y(d,v,a,b.uniforms,c),aa(d,n,v,a)):(g=d.global.def("{}"),b=a.shader.progVar.append(d,v),k=v.def(b,".id"),n=v.def(g,"[",k,"]"),v(d.shared.gl,".useProgram(",b,".program);","if(!",n,"){",n,"=",g,"[",k,"]=",d.link(function(g){return ba(Da,d,
a,g,2)}),"(",b,");}",n,".call(this,a0[",l,"],",l,");"))}function Ca(d,g){var a=d.proc("batch",2);d.batchId="0";ra(d,a);var b=!1,c=!0;Object.keys(g.context).forEach(function(d){b=b||g.context[d].propDep});b||(V(d,a,g.context),c=!1);var e=g.framebuffer,f=!1;e&&(e.propDep?b=f=!0:e.contextDep&&b&&(f=!0),f||qa(d,a,e));g.state.viewport&&g.state.viewport.propDynamic&&(b=!0);na(d,a,g);ta(d,a,g.state,function(d){return!(d.contextDep&&b||d.propDep)});g.contextDep=b;g.needsContext=c;g.needsFramebuffer=f;c=g.shader.progVar;
if(c.contextDep&&b||c.propDep)va(d,a,g,null);else if(c=c.append(d,a),a(d.shared.gl,".useProgram(",c,".program);"),g.shader.program)va(d,a,g,g.shader.program);else{var e=d.global.def("{}"),f=a.def(c,".id"),l=a.def(e,"[",f,"]");a(d.cond(l).then(l,".call(this,a0,a1);")["else"](l,"=",e,"[",f,"]=",d.link(function(a){return ba(va,d,g,a,2)}),"(",c,");",l,".call(this,a0,a1);"))}0<Object.keys(g.state).length&&a(d.shared.current,".dirty=true;")}function ya(d,g){function a(e){var l=g.shader[e];l&&b.set(c.shader,
"."+e,l.append(d,b))}var b=d.proc("scope",3);d.batchId="a2";var c=d.shared,e=c.current;V(d,b,g.context);g.framebuffer&&g.framebuffer.append(d,b);f(Object.keys(g.state)).forEach(function(a){var l=g.state[a].append(d,b);Array.isArray(l)?l.forEach(function(g,l){b.set(d.next[a],"["+l+"]",g)}):b.set(c.next,"."+a,l)});["elements","offset","count","instances","primitive"].forEach(function(a){var l=g.draw[a];l&&b.set(c.draw,"."+a,""+l.append(d,b))});Object.keys(g.uniforms).forEach(function(a){b.set(c.uniforms,
"["+m.id(a)+"]",g.uniforms[a].append(d,b))});Object.keys(g.attributes).forEach(function(a){var l=g.attributes[a].append(d,b),c=d.scopeAttrib(a);Object.keys(new pa).forEach(function(d){b.set(c,"."+d,l[d])})});a("vert");a("frag");0<Object.keys(g.state).length&&(b(e,".dirty=true;"),b.exit(e,".dirty=true;"));b("a1(",d.shared.context,",a0,0);")}var pa=T.Record,X={add:32774,subtract:32778,"reverse subtract":32779};u.ext_blend_minmax&&(X.min=32775,X.max=32776);var ha=u.angle_instanced_arrays,da=u.webgl_draw_buffers,
g={dirty:!0},A={},v=[],ia={},ja={};K("dither",3024);K("blend.enable",3042);L("blend.color","blendColor",[0,0,0,0]);L("blend.equation","blendEquationSeparate",[32774,32774]);L("blend.func","blendFuncSeparate",[1,0,1,0]);K("depth.enable",2929,!0);L("depth.func","depthFunc",513);L("depth.range","depthRange",[0,1]);L("depth.mask","depthMask",!0);L("colorMask","colorMask",[!0,!0,!0,!0]);K("cull.enable",2884);L("cull.face","cullFace",1029);L("frontFace","frontFace",2305);L("lineWidth","lineWidth",1);K("polygonOffset.enable",
32823);L("polygonOffset.offset","polygonOffset",[0,0]);K("sample.alpha",32926);K("sample.enable",32928);L("sample.coverage","sampleCoverage",[1,!1]);K("stencil.enable",2960);L("stencil.mask","stencilMask",-1);L("stencil.func","stencilFunc",[519,0,-1]);L("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);L("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);K("scissor.enable",3089);L("scissor.box","scissor",[0,0,h.drawingBufferWidth,h.drawingBufferHeight]);L("viewport","viewport",
[0,0,h.drawingBufferWidth,h.drawingBufferHeight]);var Ea={gl:h,context:q,strings:m,next:A,current:g,draw:I,elements:E,buffer:F,shader:W,attributes:T.state,uniforms:H,framebuffer:ea,extensions:u,isBufferArgs:e},za={primTypes:B,compareFuncs:C,blendFuncs:w,blendEquations:X,stencilOps:p,glTypes:n,orientationType:a};da&&(za.backBuffer=[1029],za.drawBuffer=D(J.maxDrawbuffers,function(d){return 0===d?[0]:D(d,function(d){return 36064+d})}));var Ga=0;return{next:A,current:g,procs:function(){var d=fa(),a=d.proc("poll"),
b=d.proc("refresh"),c=d.block();a(c);b(c);var e=d.shared,f=e.gl,v=e.next,l=e.current;c(l,".dirty=false;");qa(d,a);b(e.framebuffer,".dirty=true;");qa(d,b);Object.keys(ia).forEach(function(g){var e=ia[g],n=c.def(v,".",g),k=d.block();k("if(",n,"){",f,".enable(",e,")}else{",f,".disable(",e,")}",l,".",g,"=",n,";");b(k);a("if(",n,"!==",l,".",g,"){",k,"}")});Object.keys(ja).forEach(function(e){var n=ja[e],k=g[e],A,p,h=d.block();h(f,".",n,"(");Array.isArray(k)?(n=k.length,A=d.global.def(v,".",e),p=d.global.def(l,
".",e),h(D(n,function(d){return A+"["+d+"]"}),");",D(n,function(d){return p+"["+d+"]="+A+"["+d+"];"}).join("")),a("if(",D(n,function(d){return A+"["+d+"]!=="+p+"["+d+"]"}).join("||"),"){",h,"}")):(A=c.def(v,".",e),p=c.def(l,".",e),h(A,");",l,".",e,"=",A,";"),a("if(",A,"!==",p,"){",h,"}"));b(h)});return d.compile()}(),compile:function(d,g,a,b){var c=fa(),e;e=ca(d);var f=ka(d,e),l=sa(d),n=ga(d);d=la(d);var v=f.viewport;v&&(n.viewport=v);v=P("scissor.box");(f=f[v])&&(n[v]=f);f=0<Object.keys(n).length;
e={framebuffer:e,draw:l,shader:d,state:n,dirty:f};e.uniforms=ma(a);e.attributes=U(g);e.context=R(b);Ba(c,e);ya(c,e);Ca(c,e);return c.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":20,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/loop":24}],9:[function(h,m,q){function e(b,c){this.id=k++;this.type=b;this.data=c}function f(b){if(0===b.length)return[];var c=b.charAt(0),e=b.charAt(b.length-1);if(1<b.length&&c===e&&('"'===c||"'"===c))return['"'+b.substr(1,
b.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(c=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return f(b.substr(0,c.index)).concat(f(c[1])).concat(f(b.substr(c.index+c[0].length)));c=b.split(".");if(1===c.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(e=0;e<c.length;++e)b=b.concat(f(c[e]));return b}function t(b){return"["+f(b).join("][")+"]"}var k=0;m.exports={define:function(b,c){switch(typeof c){case "boolean":case "number":case "string":return new e(b,
t(c+""));case "undefined":return new e(b|128,null)}},isDynamic:function(b){return"function"===typeof b&&!b._reglType||b instanceof e},unbox:function(b,c){if(b instanceof e){if(b.type&128)return new e(b.type&-129,t(c))}else if("function"===typeof b)return new e(0,b);return b},accessor:t}},{}],10:[function(h,m,q){var e=h("./util/is-typed-array"),f=h("./util/is-ndarray"),t=h("./constants/primitives.json"),k=h("./constants/usage.json");m.exports=function(b,c,h){function m(b){this.buffer=b;this.primType=
4;this.type=this.vertCount=0}function S(b,k,t,m,p,a,N){(a=N)||e(k)&&(!f(k)||e(k.data))||(a=c.oes_element_index_uint?5125:5123);b.buffer.bind();h._initBuffer(b.buffer,k,t,a,3);k=N;if(!N){switch(b.buffer.dtype){case 5121:case 5120:k=5121;break;case 5123:case 5122:k=5123;break;case 5125:case 5124:k=5125}b.buffer.dtype=k}b.type=k;0>p&&(p=b.buffer.byteLength,5123===k?p>>=1:5125===k&&(p>>=2));b.vertCount=p;p=m;0>m&&(p=4,m=b.buffer.dimension,1===m&&(p=0),2===m&&(p=1),3===m&&(p=4));b.primType=p}var E={uint8:5121,
uint16:5123};c.oes_element_index_uint&&(E.uint32=5125);m.prototype.bind=function(){this.buffer.bind()};var B=[];return{create:function(c){function B(c){if(c)if("number"===typeof c)w(c),C.primType=4,C.vertCount=c|0,C.type=5121;else{var a=null,n=35044,h=-1,m=-1,u=0,r=0;Array.isArray(c)||e(c)||f(c)?a=c:("data"in c&&(a=c.data),"usage"in c&&(n=k[c.usage]),"primitive"in c&&(h=t[c.primitive]),"count"in c&&(m=c.count|0),"length"in c&&(u=c.length|0),"type"in c&&(r=E[c.type]));a?S(C,a,n,h,m,u,r):(c=C.buffer,
c.bind(),b.bufferData(34963,u,n),c.dtype=r||5121,c.usage=n,c.dimension=3,c.byteLength=u,C.primType=0>h?4:h,C.vertCount=0>m?0:m,C.type=c.dtype)}else w(),C.primType=4,C.vertCount=0,C.type=5121;return B}var w=h.create(null,34963,!0),C=new m(w._buffer);B(c);B._reglType="elements";B._elements=C;B.subdata=function(b,a){w.subdata(b,a);return B};B.destroy=function(){w.destroy();C.buffer=null};return B},createStream:function(b){var c=B.pop();c||(c=new m(h.create(null,34963,!0)._buffer));S(c,b,35040,-1,-1,
0,0);return c},destroyStream:function(b){B.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof m?b._elements:null}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":22,"./util/is-typed-array":23}],11:[function(h,m,q){m.exports=function(e){function f(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(f){try{h[f]=
e.getExtension(f)}catch(b){}})}var h={};f();return{extensions:h,refresh:f}}},{}],12:[function(h,m,q){var e=h("./util/values"),f=h("./util/extend");m.exports=function(h,k,b,c,m){function D(a,b,c,e){this.target=a;this.level=b;this.texture=c;this.renderbuffer=e}function S(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function E(a,b){var c=b.width,e=b.height;if(a.texture)var f=a.texture._texture,k=Math.max(1,f.params.width>>a.level),n=Math.max(1,
f.params.height>>a.level),c=c||k,e=e||n;else f=a.renderbuffer._renderbuffer,c=c||f.width,e=e||f.height;f.refCount+=1;b.width=c;b.height=e}function B(a,b){b?b.texture?h.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):h.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):h.framebufferTexture2D(36160,a,3553,null,0)}function n(a){var b=3553,c=0,e=null,f=null;"object"===typeof a&&("level"in a&&(c=a.level|0),"target"in a&&(b=a.target|0));var k=a._reglType;
"texture"===k?e=a:"renderbuffer"===k&&(f=a,b=36161,c=0);return new D(b,c,e,f)}function Q(a){return a&&(a.texture||a.renderbuffer)}function w(){this.id=F++;O[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function C(c){h.isFramebuffer(c.framebuffer)||(c.framebuffer=h.createFramebuffer());a.dirty=!0;h.bindFramebuffer(36160,c.framebuffer);for(var e=
c.colorAttachments,f=0;f<e.length;++f)B(36064+f,e[f]);for(f=e.length;f<b.maxColorAttachments;++f)B(36064+f,null);B(36096,c.depthAttachment);B(36128,c.stencilAttachment);B(33306,c.depthStencilAttachment);k.webgl_draw_buffers&&k.webgl_draw_buffers.drawBuffersWEBGL(J[e.length]);h.checkFramebufferStatus(36160)}function p(a){a=a.framebuffer;h.isFramebuffer(a)&&h.deleteFramebuffer(a)}var a={current:null,next:null,dirty:!1},N={rgba:6408},q={rgba4:32854,rgb565:36194,"rgb5 a1":32855};k.ext_srgb&&(q.srgba=
35907);k.ext_color_buffer_half_float&&(q.rgba16f=34842,q.rgb16f=34843);k.webgl_color_buffer_float&&(q.rgba32f=34836);var M=[],u=[];k.webgl_depth_texture&&(M.push(6402),u.push(34041));f(f({},N),q);e(N);e(q);q=5121;M={uint8:5121};k.oes_texture_half_float&&(q=M["half float"]=36193);k.oes_texture_float&&(q=M["float"]=5126);M.best=q;var J=function(){for(var a=Array(b.maxDrawbuffers),c=0;c<=b.maxDrawbuffers;++c)for(var e=a[c]=Array(c),f=0;f<c;++f)e[f]=36064+f;return a}(),F=0,O={};return f(a,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof w)?a:null},create:function(a){function b(a){var f,k=a||{},p=a=0;if("shape"in k){var u=k.shape;a=u[0];p=u[1]}else"radius"in k&&(a=p=k.radius),"width"in k&&(a=k.width),"height"in k&&(p=k.height);var w=null,u=!1;if("colorBuffers"in k||"colorBuffer"in k){w=k.colorBuffers||k.colorBuffer;Array.isArray(w)||(w=[w]);e.width=a;e.height=p;w=w.map(n);for(f=0;f<w.length;++f)E(w[f],e);a=e.width;p=e.height}else{var B=!0,y="rgba",F="uint8",q=1,
u=!0;e.width=a=a||h.drawingBufferWidth;e.height=p=p||h.drawingBufferHeight;"format"in k&&(y=k.format,B=y in N);"type"in k&&(F=k.type);"colorCount"in k&&(q=k.colorCount|0);if(e.ownsColor)for(w=e.colorAttachments;w.length>q;)S(w.pop());else w=[];for(f=0;f<w.length;++f){var J;a:{J=w[f];var M=B,O=y,wa=a,U=p;if(J.texture){var R=J.texture;if(M){R({format:O,type:F,width:wa,height:U});R._texture.refCount+=1;J=!0;break a}}else if(R=J.renderbuffer,!M){R({format:O,width:wa,height:U});R._renderbuffer.refCount+=
1;J=!0;break a}S(J);J=!1}J||(w[f--]=w[w.length-1],w.pop())}for(;w.length<q;)B?w.push(new D(3553,0,c.create2D({format:y,type:F,width:a,height:p},3553),null)):w.push(new D(36161,0,null,m.create({format:y,width:a,height:p})))}e.width=a;e.height=p;y=B=f=null;F=!1;"depthBuffer"in k&&(f=n(k.depthBuffer));"stencilBuffer"in k&&(B=n(k.stencilBuffer));"depthStencilBuffer"in k&&(y=n(k.depthStencilBuffer));if(f||B||y)E(f||B||y,e);else if(q=!0,M=J=!1,"depth"in k&&(q=!!k.depth),"stencil"in k&&(J=!!k.stencil),"depthTexture"in
k&&(M=!!k.depthTexture),k=e.depthAttachment||e.stencilAttachment||e.depthStencilAttachment,O=null,q||J)F=!0,M?(M=J?"depth stencil":"depth",e.ownsDepthStencil&&k.texture?(k.texture({format:M,width:a,height:p}),k.texture._texture.refCount+=1,O=k):O=new D(3553,0,c.create({format:M,width:a,height:p},3553),null)):(M=q?J?"depth stencil":"depth":"stencil",e.ownsDepthStencil&&k.renderbuffer?(k.renderbuffer({format:M,width:a,height:p}),k.renderbuffer._renderbuffer.refCount+=1,O=k):O=new D(36161,0,null,m.create({format:M,
width:a,height:p}))),q?J?y=O:f=O:B=O;a=e;a.colorAttachments.forEach(S);S(a.depthAttachment);S(a.stencilAttachment);S(a.depthStencilAttachment);e.colorAttachments=w;e.depthAttachment=f;e.stencilAttachment=B;e.depthStencilAttachment=y;e.ownsColor=u;e.ownsDepthStencil=F;b.color=w.map(Q);b.depth=Q(f);b.stencil=Q(B);b.depthStencil=Q(y);C(e);b.width=e.width;b.height=e.height;return b}var e=new w;b(a);b._reglType="framebuffer";b._framebuffer=e;b._destroy=function(){p(e)};return b},clear:function(){e(O).forEach(p)},
refresh:function(){e(O).forEach(C)}})}},{"./util/extend":21,"./util/values":28}],13:[function(h,m,q){m.exports=function(e,f){var h=1;f.ext_texture_filter_anisotropic&&(h=e.getParameter(34047));var k=1,b=1;f.webgl_draw_buffers&&(k=e.getParameter(34852),b=e.getParameter(36063));return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(f).filter(function(b){return!!f[b]}),
maxAnisotropic:h,maxDrawbuffers:k,maxColorAttachments:b,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),
maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}}},{}],14:[function(h,m,q){var e=h("./util/is-typed-array");m.exports=function(f,h,k){return function(b){var c=b||{};e(b)?c={data:c}:2===arguments.length?c={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof b&&(c={});h();var m=c.x||0,D=c.y||0,q=c.width||k.viewportWidth,E=c.height||k.viewportHeight,c=c.data||new Uint8Array(q*E*4);f.pixelStorei(3333,
4);f.readPixels(m,D,q,E,6408,5121,c);return c}}},{"./util/is-typed-array":23}],15:[function(h,m,q){var e=h("./util/values");m.exports=function(f,h,k){function b(){this.id=q++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function c(b){f.isRenderbuffer(b.renderbuffer)||(b.renderbuffer=f.createRenderbuffer());f.bindRenderbuffer(36161,b.renderbuffer);f.renderbufferStorage(36161,b.format,b.width,b.height)}function m(b){var c=b.renderbuffer;f.bindRenderbuffer(36161,
null);f.isRenderbuffer(c)&&f.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete E[b.id]}var D={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};h.ext_srgb&&(D.srgba=35907);h.ext_color_buffer_half_float&&(D.rgba16f=34842,D.rgb16f=34843);h.webgl_color_buffer_float&&(D.rgba32f=34836);var q=0,E={};b.prototype.decRef=function(){0===--this.refCount&&m(this)};return{create:function(e){function f(b){b=b||{};var e=0,h=0;"shape"in b?(h=b.shape,e=h[0]|0,h=
h[1]|0):("radius"in b&&(e=h=b.radius|0),"width"in b&&(e=b.width|0),"height"in b&&(h=b.height|0));f.width=k.width=Math.max(e,1);f.height=k.height=Math.max(h,1);k.format=32854;"format"in b&&(k.format=D[b.format]);c(k);return f}var k=new b;E[k.id]=k;f(e);f._reglType="renderbuffer";f._renderbuffer=k;f.destroy=function(){k.decRef()};return f},refresh:function(){e(E).forEach(c)},clear:function(){e(E).forEach(m)}}}},{"./util/values":28}],16:[function(h,m,q){var e=h("./util/values");m.exports=function(f,
h){function k(b,c,e,a){this.name=b;this.id=c;this.location=e;this.info=a}function b(b,c){for(var e=0;e<b.length;++e)if(b[e].id===c.id){b[e].location=c.location;return}b.push(c)}function c(b,c,e){e=35632===b?q:E;var a=e[c];if(!a){var k=h.str(c),a=f.createShader(b);f.shaderSource(a,k);f.compileShader(a);e[c]=a}return a}function m(b,c){this.id=Q++;this.fragId=b;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[]}function D(e,n){var m,a;m=c(35632,e.fragId);a=c(35633,e.vertId);var r=e.program=
f.createProgram();f.attachShader(r,m);f.attachShader(r,a);f.linkProgram(r);var B=f.getProgramParameter(r,35718),D=e.uniforms;for(m=0;m<B;++m)if(a=f.getActiveUniform(r,m))if(1<a.size)for(var u=0;u<a.size;++u){var q=a.name.replace("[0]","["+u+"]");b(D,new k(q,h.id(q),f.getUniformLocation(r,q),a))}else b(D,new k(a.name,h.id(a.name),f.getUniformLocation(r,a.name),a));B=f.getProgramParameter(r,35721);D=e.attributes;for(m=0;m<B;++m)(a=f.getActiveAttrib(r,m))&&b(D,new k(a.name,h.id(a.name),f.getAttribLocation(r,
a.name),a))}var q={},E={},B={},n=[],Q=0;return{clear:function(){var b=f.deleteShader.bind(f);e(q).forEach(b);q={};e(E).forEach(b);E={};n.forEach(function(b){f.deleteProgram(b.program)});n.length=0;B={}},refresh:function(){q={};E={};n.forEach(D)},program:function(b,c,e){var a=B[c];a||(a=B[c]={});var f=a[b];f||(f=new m(c,b),D(f,e),a[b]=f,n.push(f));return f},shader:c,frag:null,vert:null}}},{"./util/values":28}],17:[function(h,m,q){m.exports=function(){var e={"":0},f=[""];return{id:function(h){var k=
e[h];if(k)return k;k=e[h]=f.length;f.push(h);return k},str:function(e){return f[e]}}}},{}],18:[function(h,m,q){function e(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function f(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,e=1;e<b;++e)if(!Array.isArray(a[e])||a[e].length!==c)return!1;return!0}function t(a){return Object.prototype.toString.call(a)}function k(a){if(!a)return!1;var b=t(a);return 0<=p.indexOf(b)?!0:
e(a)||f(a)||S(a)}function b(a,b){36193===a.type?(a.data=B(b),E.freeType(b)):a.data=b}var c=h("./util/extend"),r=h("./util/values"),D=h("./util/is-typed-array"),S=h("./util/is-ndarray"),E=h("./util/pool"),B=h("./util/to-half-float");q=h("./constants/arraytypes.json");var n=h("./constants/arraytypes.json"),Q=[9984,9986,9985,9987],w=[0,6409,6410,6407,6408],C={};C[6409]=C[6406]=C[6402]=1;C[34041]=C[6410]=2;C[6407]=3;C[6408]=4;var p=Object.keys(q).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]",
"[object HTMLImageElement]","[object HTMLVideoElement]"]);m.exports=function(a,h,m,p,u){function q(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function F(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;
a.width=b.width;a.height=b.height;a.channels=b.channels}function O(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=ua[b.colorSpace]);"type"in b&&(a.type=Y[b.type]);var c=a.width,e=a.height,f=a.channels,k=!1;"shape"in b?(c=b.shape[0],e=b.shape[1],3===b.shape.length&&(f=b.shape[2],k=!0)):("radius"in b&&(c=e=b.radius),"width"in b&&(c=b.width),
"height"in b&&(e=b.height),"channels"in b&&(f=b.channels,k=!0));a.width=c|0;a.height=e|0;a.channels=f|0;c=!1;"format"in b&&(c=b.format,e=a.internalformat=aa[c],a.format=Da[e],c in Y&&!("type"in b)&&(a.type=Y[c]),c in ba&&(a.compressed=!0),c=!0);!k&&c?a.channels=C[a.format]:k&&!c&&a.channels!==w[a.format]&&(a.format=a.internalformat=w[a.channels])}}function y(g){a.pixelStorei(37440,g.flipY);a.pixelStorei(37441,g.premultiplyAlpha);a.pixelStorei(37443,g.colorSpace);a.pixelStorei(3317,g.unpackAlignment)}
function ea(){q.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function H(a,c){var h=null;k(c)?h=c:c&&(O(a,c),"x"in c&&(a.xOffset=c.x|0),"y"in c&&(a.yOffset=c.y|0),k(c.data)&&(h=c.data));if(c.copy){var m=u.viewportWidth,p=u.viewportHeight;a.width=a.width||m-a.xOffset;a.height=a.height||p-a.yOffset;a.needsCopy=!0}else if(!h)a.width=a.width||1,a.height=a.height||1;else if(D(h))a.data=h,"type"in c||5121!==a.type||(a.type=n[Object.prototype.toString.call(h)]|
0);else if(e(h)){m=h;p=a.width*a.height*a.channels;switch(a.type){case 5121:case 5123:case 5125:case 5126:p=E.allocType(a.type,p);p.set(m);a.data=p;break;case 36193:a.data=B(m)}a.alignment=1;a.needsFree=!0}else if(S(h)){m=h.data;Array.isArray(m)||5121!==a.type||(a.type=n[Object.prototype.toString.call(m)]|0);var p=h.shape,r=h.stride,q,y,d,x;3===p.length?(d=p[2],x=r[2]):x=d=1;q=p[0];y=p[1];p=r[0];r=r[1];a.alignment=1;a.width=q;a.height=y;a.channels=d;a.format=a.internalformat=w[d];a.needsFree=!0;q=
x;h=h.offset;d=a.width;x=a.height;y=a.channels;for(var F=E.allocType(36193===a.type?5126:a.type,d*x*y),C=0,H=0;H<x;++H)for(var z=0;z<d;++z)for(var J=0;J<y;++J)F[C++]=m[p*z+r*H+q*J+h];b(a,F)}else if("[object HTMLCanvasElement]"===t(h)||"[object CanvasRenderingContext2D]"===t(h))"[object HTMLCanvasElement]"===t(h)?a.element=h:a.element=h.canvas,a.width=a.element.width,a.height=a.element.height;else if("[object HTMLImageElement]"===t(h))a.element=h,a.width=h.naturalWidth,a.height=h.naturalHeight;else if("[object HTMLVideoElement]"===
t(h))a.element=h,a.width=h.videoWidth,a.height=h.videoHeight,a.needsPoll=!0;else if(f(h)){m=h[0].length;p=h.length;r=1;if(Array.isArray(h[0][0])){q=r=h[0][0].length;d=E.allocType(36193===a.type?5126:a.type,m*p*q);for(y=x=0;y<p;++y)for(F=h[y],C=0;C<m;++C)for(H=F[C],z=0;z<q;++z)d[x++]=H[z];b(a,d)}else{q=E.allocType(36193===a.type?5126:a.type,m*p);for(x=d=0;x<p;++x)for(y=h[x],F=0;F<m;++F)q[d++]=y[F];b(a,q)}a.alignment=1;a.width=m;a.height=p;a.channels=r;a.format=a.internalformat=w[r];a.needsFree=!0}}
function T(b,c,e,f,k){var h=b.element,n=b.data,m=b.internalformat,d=b.format,u=b.type,r=b.width,q=b.height;y(b);h?a.texSubImage2D(c,k,e,f,d,u,h):b.compressed?a.compressedTexSubImage2D(c,k,e,f,m,r,q,n):b.needsCopy?(p(),a.copyTexSubImage2D(c,k,e,f,b.xOffset,b.yOffset,r,q)):a.texSubImage2D(c,k,e,f,r,q,d,u,n)}function W(){return va.pop()||new ea}function I(a){a.needsFree&&E.freeType(a.data);ea.call(a);va.push(a)}function oa(){q.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=
Array(16)}function P(a,b,c){var e=a.images[0]=W();a.mipmask=1;e.width=a.width=b;e.height=a.height=c}function K(a,b){var c=null;if(k(b))c=a.images[0]=W(),H(c,b),a.mipmask=1;else if(O(a,b),Array.isArray(b.mipmap))for(var e=b.mipmap,f=0;f<e.length;++f)c=a.images[f]=W(),F(c,a),c.width>>=f,c.height>>=f,H(c,e[f]),a.mipmask|=1<<f;else c=a.images[0]=W(),F(c,a),H(c,b),a.mipmask=1;F(a,a.images[0])}function L(b,c){for(var e=b.images,f=0;f<e.length&&e[f];++f){var k=e[f],h=c,n=f,m=k.element,d=k.data,u=k.internalformat,
r=k.format,q=k.type,t=k.width,B=k.height;y(k);m?a.texImage2D(h,n,r,r,q,m):k.compressed?a.compressedTexImage2D(h,n,u,t,B,0,d):k.needsCopy?(p(),a.copyTexImage2D(h,n,r,k.xOffset,k.yOffset,t,B,0)):a.texImage2D(h,n,r,t,B,0,r,q,d)}}function fa(){var a=Ca.pop()||new oa;q.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function ca(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&I(b[c]),b[c]=null;Ca.push(a)}function ka(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=
1;this.genMipmaps=!1;this.mipmapHint=4352}function la(a,b){"min"in b&&(a.minFilter=ra[b.min],0<=Q.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=ta[b.mag]);var c=a.wrapS,e=a.wrapT;if("wrap"in b){var f=b.wrap;"string"===typeof f?c=e=na[f]:Array.isArray(f)&&(c=na[f[0]],e=na[f[1]])}else"wrapS"in b&&(c=na[b.wrapS]),"wrapT"in b&&(e=na[b.wrapT]);a.wrapS=c;a.wrapT=e;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=
qa[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function sa(b,c){a.texParameteri(c,10241,b.minFilter);a.texParameteri(c,10240,b.magFilter);a.texParameteri(c,10242,b.wrapS);a.texParameteri(c,10243,b.wrapT);h.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(c))}function ga(){var a=ya.pop()||new ka;ka.call(a);return a}
function ma(b){q.call(this);this.mipmask=0;this.id=pa++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0}function U(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function R(){var b=da[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function V(b){var c=b.texture,e=b.unit,f=b.target;0<=e&&(a.activeTexture(33984+e),a.bindTexture(f,null),da[e]=null);a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete X[b.id]}
var qa={"don't care":4352,"dont care":4352,nice:4354,fast:4353},na={repeat:10497,clamp:33071,mirror:33648},ta={nearest:9728,linear:9729},ra=c({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ta),ua={none:0,browser:37444},Y={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},aa={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ba={};h.ext_srgb&&(aa.srgb=35904,
aa.srgba=35906);h.oes_texture_float&&(Y["float"]=5126);h.oes_texture_half_float&&(Y.float16=Y["half float"]=36193);h.webgl_depth_texture&&(c(aa,{depth:6402,"depth stencil":34041}),c(Y,{uint16:5123,uint32:5125,"depth stencil":34042}));h.webgl_compressed_texture_s3tc&&c(ba,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});h.webgl_compressed_texture_atc&&c(ba,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});h.webgl_compressed_texture_pvrtc&&
c(ba,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});h.webgl_compressed_texture_etc1&&(ba["rgb etc1"]=36196);var Aa=Array.prototype.slice.call(a.getParameter(34467));Object.keys(ba).forEach(function(a){var b=ba[a];0<=Aa.indexOf(b)&&(aa[a]=b)});var Ba=Object.keys(aa);m.textureFormats=Ba;var Da=Ba.reduce(function(a,b){var c=aa[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=
6407;return a},{}),va=[],Ca=[],ya=[],pa=0,X={},ha=m.maxTextureUnits,da=Array(ha).map(function(){return null});c(ma.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<ha;++c){var e=da[c];if(e){if(0<e.bindCount)continue;e.unit=-1}da[c]=this;b=c;break}this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&V(this)}});return{create2D:function(a,b){function c(a,b){var g=
ga(),f=fa();"number"===typeof a?"number"===typeof b?P(f,a|0,b|0):P(f,a|0,a|0):a?(la(g,a),K(f,a)):P(f,1,1);g.genMipmaps&&(f.mipmask=(f.width<<1)-1);e.mipmask=f.mipmask;F(e,f);c.width=f.width;c.height=f.height;U(e);L(f,3553);sa(g,3553);R();ya.push(g);ca(f);return c}var e=new ma(3553);X[e.id]=e;c(a,b);c.subimage=function(a,b,g,f){b|=0;g|=0;f|=0;var d=W();F(d,e);d.width>>=f;d.height>>=f;d.width-=b;d.height-=g;H(d,a);U(e);T(d,3553,b,g,f);R();I(d);return c};c._reglType="texture2d";c._texture=e;c.destroy=
function(){e.decRef()};return c},createCube:function(a,b,c,e,f,k){function h(a,b,c,e,g,f){var l,k=ga();for(l=0;6>l;++l)d[l]=fa();if("number"===typeof a||!a)for(a=a|0||1,l=0;6>l;++l)P(d[l],a,a);else if("object"===typeof a)if(b)K(d[0],a),K(d[1],b),K(d[2],c),K(d[3],e),K(d[4],g),K(d[5],f);else if(la(k,a),O(n,a),"faces"in a)for(a=a.faces,l=0;6>l;++l)F(d[l],n),K(d[l],a[l]);else for(l=0;6>l;++l)K(d[l],a);F(n,d[0]);n.mipmask=k.genMipmaps?(d[0].width<<1)-1:d[0].mipmask;h.width=d[0].width;h.height=d[0].height;
U(n);for(l=0;6>l;++l)L(d[l],34069+l);sa(k,34067);R();ya.push(k);for(l=0;6>l;++l)ca(d[l]);return h}var n=new ma(34067);X[n.id]=n;var d=Array(6);h(a,b,c,e,f,k);h.subimage=function(a,b,d,c,e){d|=0;c|=0;e|=0;var g=W();F(g,n);g.width>>=e;g.height>>=e;g.width-=d;g.height-=c;H(g,b);U(n);T(g,34069+a,d,c,e);R();I(g);return h};h._reglType="textureCube";h._texture=n;h.destroy=function(){n.decRef()};return h},clear:function(){for(var b=0;b<ha;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),da[b]=null;r(X).forEach(V)},
getTexture:function(a){return null}}}},{"./constants/arraytypes.json":4,"./util/extend":21,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/pool":25,"./util/to-half-float":27,"./util/values":28}],19:[function(h,m,q){m.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],20:[function(h,m,q){function e(e){return Array.prototype.slice.call(e)}function f(f){return e(f).join("")}var t=h("./extend");m.exports=function(){function k(){var b=
[],k=[];return t(function(){b.push.apply(b,e(arguments))},{def:function(){var f="v"+c++;k.push(f);0<arguments.length&&(b.push(f,"="),b.push.apply(b,e(arguments)),b.push(";"));return f},toString:function(){return f([0<k.length?"var "+k+";":"",f(b)])}})}function b(){function b(f,a){e(f,a,"=",c.def(f,a),";")}var c=k(),e=k(),f=c.toString,h=e.toString;return t(c,{entry:c,exit:e,save:b,set:function(e,a,f){b(e,a);c(e,a,"=",f,";")},toString:function(){return f()+h()}})}var c=0,h=[],m=[],q=k(),E={};return{global:q,
link:function(b){for(var e=0;e<m.length;++e)if(m[e]===b)return h[e];e="g"+c++;h.push(e);m.push(b);return e},block:k,proc:function(c,e){function k(){var a="a"+h.length;h.push(a);return a}var h=[];e=e||0;for(var m=0;m<e;++m)k();var m=b(),p=m.toString;return E[c]=t(m,{arg:k,toString:function(){return f(["function(",h.join(),"){",p(),"}"])}})},scope:b,cond:function(){var c=f(arguments),k=b(),h=b(),m=k.toString,r=h.toString;return t(k,{then:function(){k.apply(k,e(arguments));return this},"else":function(){h.apply(h,
e(arguments));return this},toString:function(){var b=r();b&&(b="else{"+b+"}");return f(["if(",c,"){",m(),"}",b])}})},compile:function(){var b=['"use strict";',q,"return {"];Object.keys(E).forEach(function(c){b.push('"',c,'":',E[c].toString(),",")});b.push("}");var c=f(b).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,h.concat(c)).apply(null,m)}}}},{"./extend":21}],21:[function(h,m,q){m.exports=function(e,f){for(var h=Object.keys(f),k=0;k<h.length;++k)e[h[k]]=
f[h[k]];return e}},{}],22:[function(h,m,q){var e=h("./is-typed-array");m.exports=function(f){return!!f&&"object"===typeof f&&Array.isArray(f.shape)&&Array.isArray(f.stride)&&"number"===typeof f.offset&&f.shape.length===f.stride.length&&(Array.isArray(f.data)||e(f.data))}},{"./is-typed-array":23}],23:[function(h,m,q){var e=h("../constants/arraytypes.json");m.exports=function(f){return Object.prototype.toString.call(f)in e}},{"../constants/arraytypes.json":4}],24:[function(h,m,q){m.exports=function(e,
f){for(var h=Array(e),k=0;k<e;++k)h[k]=f(k);return h}},{}],25:[function(h,m,q){function e(b){var c,e;c=(65535<b)<<4;b>>>=c;e=(255<b)<<3;b>>>=e;c|=e;e=(15<b)<<2;b>>>=e;c|=e;e=(3<b)<<1;return c|e|b>>>e>>1}function f(b){a:{for(var c=16;268435456>=c;c*=16)if(b<=c){b=c;break a}b=0}c=k[e(b)>>2];return 0<c.length?c.pop():new ArrayBuffer(b)}function t(b){k[e(b.byteLength)>>2].push(b)}var k=h("./loop")(8,function(){return[]});m.exports={alloc:f,free:t,allocType:function(b,c){var e=null;switch(b){case 5120:e=
new Int8Array(f(c),0,c);break;case 5121:e=new Uint8Array(f(c),0,c);break;case 5122:e=new Int16Array(f(2*c),0,c);break;case 5123:e=new Uint16Array(f(2*c),0,c);break;case 5124:e=new Int32Array(f(4*c),0,c);break;case 5125:e=new Uint32Array(f(4*c),0,c);break;case 5126:e=new Float32Array(f(4*c),0,c);break;default:return null}return e.length!==c?e.subarray(0,c):e},freeType:function(b){t(b.buffer)}}},{"./loop":24}],26:[function(h,m,q){m.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?
{next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:{next:function(e){setTimeout(e,30)},cancel:clearTimeout}},{}],27:[function(h,m,q){var e=h("./pool"),f=new Float32Array(1),t=new Uint32Array(f.buffer);m.exports=function(k){for(var b=e.allocType(5123,k.length),c=0;c<k.length;++c)if(isNaN(k[c]))b[c]=65535;else if(Infinity===k[c])b[c]=31744;else if(-Infinity===k[c])b[c]=64512;else{f[0]=k[c];var h=t[0],m=h>>>31<<15,q=(h<<1>>>24)-127,h=h>>13&1023;b[c]=
-24>q?m:-14>q?m+(h+1024>>-14-q):15<q?m+31744:m+(q+15<<10)+h}return b}},{"./pool":25}],28:[function(h,m,q){m.exports=function(e){return Object.keys(e).map(function(f){return e[f]})}},{}],29:[function(h,m,q){function e(e,b){function c(){var b=window.innerWidth,c=window.innerHeight;e!==document.body&&(c=e.getBoundingClientRect(),b=c.right-c.left,c=c.top-c.bottom);h.width=q*b;h.height=q*c;t(h.style,{width:b+"px",height:c+"px"})}var h=document.createElement("canvas"),m=f(h,b);t(h.style,{border:0,margin:0,
padding:0,top:0,left:0});e.appendChild(h);e===document.body&&(h.style.position="absolute",t(e.style,{margin:0,padding:0}));var q=+m.options.pixelRatio;window.addEventListener("resize",c,!1);var E=m.options.onDestroy;m.options=t(t({},m.options),{onDestroy:function(){window.removeEventListener("resize",c);e.removeChild(h);E&&E()}});c();return m}function f(e,b){function c(b){try{return e.getContext(b,f)}catch(c){return null}}var f=b.glOptions||{};return{gl:c("webgl")||c("experimental-webgl")||c("webgl-experimental"),
options:t({pixelRatio:window.devicePixelRatio},b)}}var t=h("./util/extend");m.exports=function(k){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:k[0],options:k[1]||{}};var b=document.body,c=k[1]||{};if("string"===typeof k[0])b=document.querySelector(k[0])||document.body;else if("object"===typeof k[0])if(k[0]instanceof HTMLElement)b=k[0];else{if(k[0]instanceof WebGLRenderingContext)return{gl:k[0],options:t({pixelRatio:1},c)};c=k[0]}return b.nodeName&&"CANVAS"===b.nodeName.toUpperCase()?
f(b,c):e(b,c)}},{"./util/extend":21}],30:[function(h,m,q){var e=h("./lib/util/extend"),f=h("./lib/dynamic"),t=h("./lib/util/raf"),k=h("./lib/util/clock"),b=h("./lib/strings"),c=h("./lib/webgl"),r=h("./lib/extension"),D=h("./lib/limits"),S=h("./lib/buffer"),E=h("./lib/elements"),B=h("./lib/texture"),n=h("./lib/renderbuffer"),Q=h("./lib/framebuffer"),w=h("./lib/attribute"),C=h("./lib/shader"),p=h("./lib/read"),a=h("./lib/core");m.exports=function(){function h(){V=t.next(h);P.count+=1;var a=k();P.deltaTime=
(a-W)/1E3;P.time=(a-T)/1E3;W=a;F();for(a=0;a<R.length;++a)(0,R[a])(P,null,0)}function m(a){}function q(a){}function u(a){function b(a){var c={},e={};Object.keys(a).forEach(function(b){var h=a[b];f.isDynamic(h)?e[b]=f.unbox(h,b):c[b]=h});return{dynamic:e,"static":c}}function c(a){for(;q.length<a;)q.push(null);return q}var h=b(a.context||{}),k=b(a.uniforms||{}),m=b(a.attributes||{});a=b(function(a){function b(a){if(a in c){var e=c[a];delete c[a];Object.keys(e).forEach(function(b){c[a+"."+b]=e[b]})}}
var c=e({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var h=ga.compile(a,m,k,h),n=h.draw,u=h.batch,p=h.scope,q=[];return function(a,b){var e;if("function"===typeof a)return p.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(e=0;e<a;++e)p.call(this,null,b,e);else if(Array.isArray(a))for(e=0;e<a.length;++e)p.call(this,a[e],b,e);else return p.call(this,a,b,0);else if("number"===
typeof a){if(0<a)return u.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return u.call(this,a,a.length)}else return n.call(this,a)}}function J(){ga.procs.poll()}function F(){var a=ma.viewport,b=ma.scissor_box;a[0]=a[1]=b[0]=b[1]=0;P.viewportWidth=P.frameBufferWidth=P.drawingBufferWidth=a[2]=b[2]=y.drawingBufferWidth;P.viewportHeight=P.frameBufferWidth=P.drawingBufferHeight=a[3]=b[3]=y.drawingBufferHeight;ga.procs.refresh()}var O=c(Array.prototype.slice.call(arguments)),y=O.gl,ea=O.options,
O=b(),H=r(y).extensions,T=k(),W=T,I=y.drawingBufferWidth,oa=y.drawingBufferHeight,P={count:0,deltaTime:0,time:0,viewportWidth:I,viewportHeight:oa,framebufferWidth:I,framebufferHeight:oa,drawingBufferWidth:I,drawingBufferHeight:oa,pixelRatio:ea.pixelRatio},K=D(y,H),L=S(y),I=E(y,H,L),oa=w(y,H,K,L,O),fa=C(y,O),ca=B(y,H,K,J,P),ka=n(y,H,K),la=Q(y,H,K,ca,ka),sa=p(y,J,P),ga=a(y,O,H,K,L,I,ca,la,{},oa,fa,{elements:null,primitive:4,count:-1,offset:0,instances:-1},P),ma=ga.next,U=y.canvas,R=[],V=0;U&&(U.addEventListener("webglcontextlost",
m,!1),U.addEventListener("webglcontextrestored",q,!1));F();return e(u,{clear:function(a){var b=0;J();var c=a.color;c&&(y.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(y.clearDepth(+a.depth),b|=256);"stencil"in a&&(y.clearStencil(a.stencil|0),b|=1024);y.clear(b)},prop:f.define.bind(null,1),context:f.define.bind(null,2),"this":f.define.bind(null,3),draw:u({}),buffer:function(a){return L.create(a,34962)},elements:I.create,texture:ca.create2D,cube:ca.createCube,renderbuffer:ka.create,
framebuffer:la.create,framebufferCube:function(a){},attributes:y.getContextAttributes(),frame:function(a){R.push(a);!V&&0<R.length&&h();return{cancel:function(){var b=R.find(function(b){return b===a});0>b||(R.splice(b,1),0>=R.length&&V&&(t.cancel(h),V=0))}}},limits:K,hasExtension:function(a){return 0<=K.extensions.indexOf(a.toLowerCase())},read:sa,destroy:function(){V&&(t.cancel(h),V=0);U&&(U.removeEventListener("webglcontextlost",m),U.removeEventListener("webglcontextrestored",q));fa.clear();la.clear();
ka.clear();ca.clear();L.clear();if(ea.onDestroy)ea.onDestroy()},_gl:y,_refresh:F})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/strings":17,"./lib/texture":18,"./lib/util/clock":19,"./lib/util/extend":21,"./lib/util/raf":26,"./lib/webgl":29}],31:[function(h,m,q){function e(b){throw Error("resl: "+b);}function f(b,c,f){Object.keys(b).forEach(function(b){0>
c.indexOf(b)&&e('invalid parameter "'+b+'" in '+f)})}function t(b,c){this.state=0;this.ready=!1;this.progress=0;this.name=b;this.cancel=c}var k=["manifest","onDone","onProgress","onError"],b=["type","src","stream","credentials","parser"],c=["onData","onDone"];m.exports=function(h){function m(a,b){if(a in h){var c=h[a];"function"!==typeof c&&e('invalid callback "'+a+'"');return c}return null}function q(b){function c(){if(!(2>m.readyState||1===r.state||-1===r.state)){if(200!==m.status)return B('error loading resource "'+
b.name+'"');if(2<m.readyState&&0===r.state){var f;f="binary"===b.type?m.response:m.responseText;if(k.data)try{p=k.data(f)}catch(h){return B(h)}else p=f}if(3<m.readyState&&0===r.state){if(k.done)try{p=k.done()}catch(h){return B(h)}r.state=1}a[e]=p;r.progress=.75*r.progress+.25;r.ready=b.stream&&!!p||1===r.state;n()}}var e=b.name,f=b.stream,h="binary"===b.type,k=b.parser,m=new XMLHttpRequest,p=null,r=new t(e,function(){1!==r.state&&-1!==r.state&&(m.onreadystatechange=null,m.abort(),r.state=-1)});m.onreadystatechange=
f?c:function(){4===m.readyState&&c()};h&&(m.responseType="arraybuffer");b.credentials&&(m.withCredentials=!0);m.open("GET",b.src,!0);m.send();return r}function E(b,c){function e(){if(0===r.state)if(q.data)try{w=q.data(c)}catch(a){return B(a)}else w=c}function f(c){e();a[p]=w;r.progress=c.lengthComputable?Math.max(r.progress,c.loaded/c.total):.75*r.progress+.25;r.ready=b.stream;n(p)}function h(){e();if(0===r.state){if(q.done)try{w=q.done()}catch(b){return B(b)}r.state=1}r.progress=1;r.ready=!0;a[p]=
w;m();n("finish "+p)}function k(){B('error loading asset "'+p+'"')}function m(){b.stream&&c.removeEventListener("progress",f);"image"===b.type?c.addEventListener("load",h):c.addEventListener("canplay",h);c.removeEventListener("error",k)}var p=b.name,q=b.parser,r=new t(p,function(){1!==r.state&&-1!==r.state&&(r.state=-1,m(),c.src="")}),w=c;b.stream&&c.addEventListener("progress",f);"image"===b.type?c.addEventListener("load",h):c.addEventListener("canplay",h);c.addEventListener("error",k);c.crossOrigin=
b.credentials?"use-credentials":"anonymous";c.src=b.src;return r}function B(a){-1!==N&&1!==N&&(N=-1,M.forEach(function(a){a.cancel()}),p?"string"===typeof a?p(Error("resl: "+a)):p(a):console.error("resl error:",a))}function n(b){if(-1!==N&&1!==N){var c=0,e=0;M.forEach(function(a){a.ready&&(e+=1);c+=a.progress});e===M.length?(N=1,w(a)):C&&C(c/M.length,b)}}"object"===typeof h&&h||e("invalid or missing configuration");f(h,k,"config");var Q=h.manifest;"object"===typeof Q&&Q||e("missing manifest");var w=
m("onDone");w||e("missing onDone() callback");var C=m("onProgress"),p=m("onError"),a={},N=0,wa={text:q,binary:function(a){return q(a)},image:function(a){return E(a,document.createElement("img"))},video:function(a){return E(a,document.createElement("video"))},audio:function(a){return E(a,document.createElement("audio"))}},M=Object.keys(Q).map(function(a){function h(a,b){if(a in k.parser){var c=k.parser[a];"function"!==typeof c&&e("invalid parser callback "+a+' for asset "'+a+'"');return c}return b}
var k=Q[a];"string"===typeof k?k={src:k}:"object"===typeof k&&k||e('invalid asset definition "'+a+'"');f(k,b,'asset "'+a+'"');var m={};"parser"in k&&("function"===typeof k.parser?m={data:k.parser}:"object"===typeof k.parser&&k.parser?(f(m,c,'parser for asset "'+a+'"'),"onData"in m||e('missing onData callback for parser in asset "'+a+'"'),m={data:h("onData"),done:h("onDone")}):e('invalid parser for asset "'+a+'"'));return{name:a,type:function(b,c,f){b in k&&(f=k[b]);0>c.indexOf(f)&&e("invalid "+b+
' "'+f+'" for asset "'+a+'", possible values: '+c);return f}("type",Object.keys(wa),"text"),stream:!!k.stream,credentials:!!k.credentials,src:function(b,c,f){b in k?f=k[b]:c&&e("missing "+b+' for asset "'+a+'"');"string"!==typeof f&&e("invalid "+b+' for asset "'+a+'", must be a string');return f}("src",!0,""),parser:m}}).map(function(a){return wa[a.type](a)})}},{}]},{},[1]);

        </script>
        </body>
      </html>