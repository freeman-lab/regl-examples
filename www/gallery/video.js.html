<!DOCTYPE html>
      <html>
        <head>
          <title>example/video.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(m,r,f){function k(a,c){if(!r[a]){if(!m[a]){var b="function"==typeof require&&require;if(!c&&b)return b(a,!0);if(g)return g(a,!0);b=Error("Cannot find module '"+a+"'");throw b.code="MODULE_NOT_FOUND",b;}b=r[a]={exports:{}};m[a][0].call(b.exports,function(c){var g=m[a][1][c];return k(g?g:c)},b,b.exports,e$$0,m,r,f)}return r[a].exports}for(var g="function"==typeof require&&require,b=0;b<f.length;b++)k(f[b]);return k})({1:[function(e,m,r){e=e("../regl")();var f=e({frag:"\n  precision mediump float;\n  uniform sampler2D texture;\n  uniform vec2 screenShape;\n  uniform float time;\n\n  varying vec2 uv;\n\n  vec4 background () {\n    vec2 pos = 0.5 - gl_FragCoord.xy / screenShape;\n    float r = length(pos);\n    float theta = atan(pos.y, pos.x);\n    return vec4(\n      cos(pos.x * time) + sin(pos.y * pos.x * time),\n      cos(100.0 * r * cos(0.3 * time) + theta),\n      sin(time / r + pos.x * cos(10.0 * time + 3.0)),\n      1);\n  }\n\n  void main () {\n    vec4 color = texture2D(texture, uv);\n    float chromakey = step(0.15 + max(color.r, color.b), color.g);\n    gl_FragColor = mix(color, background(), chromakey);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main () {\n    uv = position;\n    gl_Position = vec4(1.0 - 2.0 * position, 0, 1);\n  }",attributes:{position:[-2,0,0,-2,2,2]},uniforms:{texture:e.texture("assets/doggie-chromakey.ogv"),screenShape:function(k){return[k.viewportWidth,k.viewportHeight]},time:e.context("time")},count:3});e.frame(function(){f()})},{"../regl":34}],2:[function(e,m,r){function f(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=
null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}m.exports=function(k,g,b,a,c){k=b.maxAttributes;g=Array(k);for(b=0;b<k;++b)g[b]=new f;return{Record:f,scope:{},state:g}}},{}],3:[function(e,m,r){function f(a,c){for(var g=0;g<c.length;++g)a[g]=c[g]}var k=e("./util/is-typed-array"),g=e("./util/is-ndarray"),b=e("./util/values"),a=e("./util/flatten"),c=e("./util/transpose"),u=e("./util/pool"),H=e("./constants/arraytypes.json"),V=e("./constants/dtypes.json"),y=e("./constants/usage.json");
m.exports=function(e){function q(a){this.id=p++;this.buffer=e.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121}function v(a,c,g){a.byteLength=c.byteLength;e.bufferData(a.type,c,g)}function h(b,h,p,e,q){b.usage=p;if(Array.isArray(h))b.dtype=e||5126,0<h.length&&Array.isArray(h[0])?(b.dimension=h[0].length,e=u.allocType(b.dtype,h.length*b.dimension),a(e,h,b.dimension)):(b.dimension=q,e=u.allocType(b.dtype,h.length),f(e,h)),v(b,e,p),u.freeType(e);else if(k(h))b.dtype=
e||H[Object.prototype.toString.call(h)]|0,b.dimension=q,v(b,h,p);else if(g(h)){var t=h.shape,w=h.stride;q=h.offset;var I=0,W=0,m=0,G=0;1===t.length?(I=t[0],W=1,m=w[0],G=0):2===t.length&&(I=t[0],W=t[1],m=w[0],G=w[1]);b.dtype=e||H[Object.prototype.toString.call(h.data)]|0||5126;b.dimension=W;e=u.allocType(b.dtype,I*W);c(e,h.data,I,W,m,G,q);v(b,e,p);u.freeType(e)}}function w(a){var c=a.buffer;e.isBuffer(c)&&e.deleteBuffer(c);a.buffer=null;delete m[a.id]}var p=0,m={};q.prototype.bind=function(){e.bindBuffer(this.type,
this.buffer)};var O=[];return{create:function(b,p,v){function O(a){var c=35044,b=null,f=0,p=0,q=1;Array.isArray(a)||k(a)||g(a)?b=a:"number"===typeof a?f=a|0:a&&("data"in a&&(b=a.data),"usage"in a&&(c=y[a.usage]),"type"in a&&(p=V[a.type]),"dimension"in a&&(q=a.dimension|0),"length"in a&&(f=a.length|0));r.bind();b?h(r,b,c,p,q):(e.bufferData(r.type,f,c),r.dtype=p||5121,r.usage=c,r.dimension=q,r.byteLength=f);return O}var r=new q(p);m[r.id]=r;v||O(b);O._reglType="buffer";O._buffer=r;O.subdata=function(b,
h){var p=(h||0)|0;r.bind();if(Array.isArray(b))if(0<b.length&&Array.isArray(b[0])){var q=b[0].length,w=u.allocType(r.dtype,b.length*q);a(w,b,q);e.bufferSubData(r.type,p,w);u.freeType(w)}else q=u.allocType(r.dtype,b.length),f(q,b),e.bufferSubData(r.type,p,q),u.freeType(q);else if(k(b))e.bufferSubData(r.type,p,b);else if(g(b)){var m=b.shape,v=b.stride,A=w=q=0,F=0;1===m.length?(q=m[0],w=1,A=v[0],F=0):2===m.length&&(q=m[0],w=m[1],A=v[0],F=v[1]);m=Array.isArray(b.data)?r.dtype:H[Object.prototype.toString.call(b.data)]|
0;m=u.allocType(m,q*w);c(m,b.data,q,w,A,F,b.offset);e.bufferSubData(r.type,p,m);u.freeType(m)}return O};O.destroy=function(){w(r)};return O},createStream:function(a,b){var c=O.pop();c||(c=new q(a),c.buffer=e.createBuffer());c.bind();h(c,b,35040,0,1);return c},destroyStream:function(a){O.push(a)},clear:function(){b(m).forEach(w)},getBuffer:function(a){return a&&a._buffer instanceof q?a._buffer:null},_initBuffer:h}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,
"./util/flatten":22,"./util/is-ndarray":23,"./util/is-typed-array":24,"./util/pool":28,"./util/transpose":31,"./util/values":32}],4:[function(e,m,r){m.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(e,m,r){m.exports={int8:5120,int16:5122,int32:5124,
uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],6:[function(e,m,r){m.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(e,m,r){m.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(e,m,r){function f(a){return Array.isArray(a)||V(a)||y(a)}function k(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function g(a,b,c,g){this.thisDep=a;this.contextDep=
b;this.propDep=c;this.append=g}function b(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function a(a){return new g(!1,!1,!1,a)}function c(a,b){var c=a.type;return 0===c?(c=a.data.length,new g(!0,1<=c,2<=c,b)):new g(3===c,2===c,1===c,b)}var u=e("./util/codegen"),H=e("./util/loop"),V=e("./util/is-typed-array"),y=e("./util/is-ndarray"),z=e("./constants/primitives.json"),q=e("./constants/dtypes.json"),v=["x","y","z","w"],h={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,
"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},w={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},p={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,
"decrement wrap":34056,invert:5386},A={cw:2304,ccw:2305},O=new g(!1,!1,!1,function(){});m.exports=function(e,m,r,y,R,t,ka,I,W,Y,G,Z,J){function Q(a){return a.replace(".","_")}function K(a,d,b){var c=Q(a);oa.push(a);la[c]=fa[c]=!!b;ga[c]=d}function D(a,d,b){var c=Q(a);oa.push(a);Array.isArray(b)?(fa[c]=b.slice(),la[c]=b.slice()):fa[c]=la[c]=b;ha[c]=d}function B(){var a=u(),d=a.link,b=a.global;a.id=Ba++;a.batchId="0";var c=d(xa),n=a.shared={props:"a0"};Object.keys(xa).forEach(function(l){n[l]=b.def(c,
".",l)});var C=a.next={},g=a.current={};Object.keys(ha).forEach(function(l){Array.isArray(fa[l])&&(C[l]=b.def(n.next,".",l),g[l]=b.def(n.current,".",l))});var l=a.constants={};Object.keys(pa).forEach(function(a){l[a]=b.def(JSON.stringify(pa[a]))});a.invoke=function(l,b){switch(b.type){case 0:var aa=["this",n.context,n.props,a.batchId];return l.def(d(b.data),".call(",aa.slice(0,Math.max(b.data.length+1,4)),")");case 1:return l.def(n.props,b.data);case 2:return l.def(n.context,b.data);case 3:return l.def("this",
b.data)}};a.attribCache={};var aa={};a.scopeAttrib=function(l){l=m.id(l);if(l in aa)return aa[l];var a=Y.scope[l];a||(a=Y.scope[l]=new ma);return aa[l]=d(a)};return a}function ba(d){var b=d["static"];d=d.dynamic;if("framebuffer"in b){var n=b.framebuffer;return n?(n=I.getFramebuffer(n),a(function(a,d){var b=a.link(n),l=a.shared;d.set(l.framebuffer,".next",b);l=l.context;d.set(l,".framebufferWidth",b+".width");d.set(l,".framebufferHeight",b+".height");return b})):a(function(a,d){var b=a.shared;d.set(b.framebuffer,
".next","null");b=b.context;d.set(b,".framebufferWidth",b+".drawingBufferWidth");d.set(b,".framebufferHeight",b+".drawingBufferHeight");return null})}if("framebuffer"in d){var g=d.framebuffer;return c(g,function(a,d){var b=a.invoke(d,g),l=a.shared,aa=l.framebuffer,b=d.def(aa,".getFramebuffer(",b,")");d.set(aa,".next",b);l=l.context;d.set(l,".framebufferWidth",b+"?"+b+".width:"+l+".drawingBufferWidth");d.set(l,".framebufferHeight",b+"?"+b+".height:"+l+".drawingBufferHeight");return b})}return null}
function ia(a,d){function b(l){if(l in n){var a=n[l];l=!0;var x=a.x|0,ya=a.y|0,C,k;"w"in a?C=a.w|0:l=!1;"h"in a?k=a.h|0:l=!1;return new g(l&&d&&d.thisDep,l&&d&&d.contextDep,l&&d&&d.propDep,function(l,d){var b=l.shared.context,c=C;"w"in a||(c=d.def(b,".","framebufferWidth","-",x));var n=k;"h"in a||(n=d.def(b,".","framebufferHeight","-",ya));return[x,ya,c,n]})}if(l in h){var f=h[l];l=c(f,function(l,a){var d=l.invoke(a,f),b=l.shared.context,c=a.def(d,".x|0"),aa=a.def(d,".y|0"),x=a.def('"w" in ',d,"?",
d,".w|0:","(",b,".","framebufferWidth","-",c,")"),d=a.def('"h" in ',d,"?",d,".h|0:","(",b,".","framebufferHeight","-",aa,")");return[c,aa,x,d]});d&&(l.thisDep=l.thisDep||d.thisDep,l.contextDep=l.contextDep||d.contextDep,l.propDep=l.propDep||d.prpoDep);return l}return d?new g(d.thisDep,d.contextDep,d.propDep,function(l,a){var d=l.shared.context;return[0,0,a.def(d,".","framebufferWidth"),a.def(d,".","framebufferHeight")]}):null}var n=a["static"],h=a.dynamic,C=b("viewport");if(C)var k=C,C=new g(C.thisDep,
C.contextDep,C.propDep,function(l,a){var d=k.append(l,a),b=l.shared.context;a.set(b,".viewportWidth",d[2]);a.set(b,".viewportHeight",d[3]);return d});return{viewport:C,scissor_box:b("scissor.box")}}function L(d){function n(l){if(l in h){var d=m.id(h[l]);l=a(function(){return d});l.id=d;return l}if(l in k){var b=k[l];return c(b,function(l,a){var d=l.invoke(a,b);return a.def(l.shared.strings,".id(",d,")")})}return null}var h=d["static"],k=d.dynamic,f=n("frag"),C=n("vert"),e=null;b(f)&&b(C)?(e=G.program(C.id,
f.id),d=a(function(l,a){return l.link(e)})):d=new g(f&&f.thisDep||C&&C.thisDep,f&&f.contextDep||C&&C.contextDep,f&&f.propDep||C&&C.propDep,function(l,a){var d=l.shared.shader,b;b=f?f.append(l,a):a.def(d,".","frag");var c;c=C?C.append(l,a):a.def(d,".","vert");return a.def(d+".program("+c+","+b+")")});return{frag:f,vert:C,progVar:d,program:e}}function E(d){function n(d,l){if(d in h){var b=h[d]|0;return a(function(d,a){l&&(d.OFFSET=b);return b})}if(d in k){var x=k[d];return c(x,function(d,a){var b=d.invoke(a,
x);l&&(d.OFFSET=b);return b})}return l&&e?a(function(l,d){l.OFFSET="0";return 0}):null}var h=d["static"],k=d.dynamic,e=function(){if("elements"in h){var d=h.elements;f(d)?d=t.getElements(t.create(d)):d&&(d=t.getElements(d));var l=a(function(l,a){if(d){var b=l.link(d);return l.ELEMENTS=b}return l.ELEMENTS=null});l.value=d;return l}if("elements"in k){var b=k.elements;return c(b,function(l,d){var a=l.shared,c=a.isBufferArgs,a=a.elements,n=l.invoke(d,b),x=d.def("null"),c=d.def(c,"(",n,")"),n=l.cond(c).then(x,
"=",a,".createStream(",n,");")["else"](x,"=",a,".getElements(",n,");");d.entry(n);d.exit(l.cond(c).then(a,".destroyStream(",x,");"));return l.ELEMENTS=x})}return null}(),C=n("offset",!0);return{elements:e,primitive:function(){if("primitive"in h){var d=h.primitive;return a(function(l,a){return z[d]})}if("primitive"in k){var l=k.primitive;return c(l,function(d,a){var b=d.constants.primTypes,c=d.invoke(a,l);return a.def(b,"[",c,"]")})}return e?b(e)?e.value?a(function(l,d){return d.def(l.ELEMENTS,".primType")}):
a(function(){return 4}):new g(e.thisDep,e.contextDep,e.propDep,function(l,d){var a=l.ELEMENTS;return d.def(a,"?",a,".primType:",4)}):null}(),count:function(){if("count"in h){var d=h.count|0;return a(function(){return d})}if("count"in k){var l=k.count;return c(l,function(d,a){return d.invoke(a,l)})}return e?b(e)?e?C?new g(C.thisDep,C.contextDep,C.propDep,function(l,d){return d.def(l.ELEMENTS,".vertCount-",l.OFFSET)}):a(function(l,d){return d.def(l.ELEMENTS,".vertCount")}):a(function(){return-1}):new g(e.thisDep||
C.thisDep,e.contextDep||C.contextDep,e.propDep||C.propDep,function(l,d){var a=l.ELEMENTS;return l.OFFSET?d.def(a,"?",a,".vertCount-",l.OFFSET,":-1"):d.def(a,"?",a,".vertCount:-1")}):null}(),instances:n("instances",!1),offset:C}}function S(d){var b=d["static"],n=d.dynamic,k={};oa.forEach(function(d){function x(l,h){if(d in b){var f=l(b[d]);k[g]=a(function(){return f})}else if(d in n){var e=n[d];k[g]=c(e,function(l,d){return h(l,d,l.invoke(d,e))})}}var g=Q(d);switch(d){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return x(function(l){return l},
function(l,d,a){return a});case "depth.func":return x(function(l){return w[l]},function(l,d,a){return d.def(l.constants.compareFuncs,"[",a,"]")});case "depth.range":return x(function(d){return d},function(d,a,b){d=a.def("+",b,"[0]");a=a.def("+",b,"[1]");return[d,a]});case "blend.func":return x(function(d){return[h["srcRGB"in d?d.srcRGB:d.src],h["dstRGB"in d?d.dstRGB:d.dst],h["srcAlpha"in d?d.srcAlpha:d.src],h["dstAlpha"in d?d.dstAlpha:d.dst]]},function(d,a,b){function c(d,l){var n=a.def('"',d,l,'" in ',
b,"?",b,".",d,l,":",b,".",d);return a.def(x,"[",n,"]")}var x=d.constants.blendFuncs;d=c("src","RGB");var n=c("src","Alpha"),h=c("dst","RGB"),k=c("dst","Alpha");return[d,h,n,k]});case "blend.equation":return x(function(d){if("string"===typeof d)return[ja[d],ja[d]];if("object"===typeof d)return[ja[d.rgb],ja[d.alpha]]},function(d,a,b){var c=d.constants.blendEquations,x=a.def(),n=a.def();d=d.cond("typeof ",b,'==="string"');d.then(x,"=",n,"=",c,"[",b,"];");d["else"](x,"=",c,"[",b,".rgb];",n,"=",c,"[",
b,".alpha];");a(d);return[x,n]});case "blend.color":return x(function(d){return H(4,function(a){return+d[a]})},function(d,a,b){return H(4,function(d){return a.def("+",b,"[",d,"]")})});case "stencil.mask":return x(function(d){return d|0},function(d,a,b){return a.def(b,"|0")});case "stencil.func":return x(function(d){return[w[d.cmp||"keep"],d.ref||0,"mask"in d?d.mask:-1]},function(d,a,b){d=a.def('"cmp" in ',b,"?",d.constants.compareFuncs,"[",b,".cmp]",":",7680);var c=a.def(b,".ref|0");a=a.def('"mask" in ',
b,"?",b,".mask|0:-1");return[d,c,a]});case "stencil.opFront":case "stencil.opBack":return x(function(a){return["stencil.opBack"===d?1029:1028,p[a.fail||"keep"],p[a.zfail||"keep"],p[a.pass||"keep"]]},function(a,b,c){function x(d){return b.def('"',d,'" in ',c,"?",n,"[",c,".",d,"]:",7680)}var n=a.constants.stencilOps;return["stencil.opBack"===d?1029:1028,x("fail"),x("zfail"),x("pass")]});case "polygonOffset.offset":return x(function(d){return[d.factor|0,d.units|0]},function(d,a,b){d=a.def(b,".factor|0");
a=a.def(b,".units|0");return[d,a]});case "cull.face":return x(function(d){var a=0;"front"===d?a=1028:"back"===d&&(a=1029);return a},function(d,a,b){return a.def(b,'==="front"?',1028,":",1029)});case "lineWidth":return x(function(d){return d},function(d,a,b){return b});case "frontFace":return x(function(d){return A[d]},function(d,a,b){return a.def(b+'==="cw"?2304:2305')});case "colorMask":return x(function(d){return d.map(function(d){return!!d})},function(d,a,b){return H(4,function(d){return"!!"+b+
"["+d+"]"})});case "sample.coverage":return x(function(d){return["value"in d?d.value:1,!!d.invert]},function(d,a,b){d=a.def('"value" in ',b,"?+",b,".value:1");a=a.def("!!",b,".invert");return[d,a]})}});return k}function U(d){var b=d["static"],n=d.dynamic,h={};Object.keys(b).forEach(function(d){var c=b[d],x;if("number"===typeof c||"boolean"===typeof c)x=a(function(){return c});else if("function"===typeof c&&"texture"===c._reglType)x=a(function(d){return d.link(c)});else if(Array.isArray(c)||V(c))x=
a(function(d){return d.global.def("[",H(c.length,function(d){return c[d]}),"]")});x.value=c;h[d]=x});Object.keys(n).forEach(function(d){var a=n[d];h[d]=c(a,function(d,b){return d.invoke(b,a)})});return h}function P(d){var b=d["static"],n=d.dynamic,h={};Object.keys(b).forEach(function(d){var c=b[d],x=m.id(d),l=new ma;if(f(c))l.state=1,l.buffer=R.getBuffer(R.create(c,34962,!1)),l.type=l.buffer.dtype;else{var n=R.getBuffer(c);if(n)l.state=1,l.buffer=n,l.type=n.dtype;else if(c.constant){var k=c.constant;
l.state=2;"number"===typeof k?l.x=k:v.forEach(function(d,a){a<k.length&&(l[d]=k[a])})}else{var n=R.getBuffer(c.buffer),g=c.offset|0,e=c.stride|0,p=c.size|0,Aa=!!c.normalized,T=0;"type"in c&&(T=q[c.type]);c=c.divisor|0;l.buffer=n;l.state=1;l.size=p;l.normalized=Aa;l.type=T||n.dtype;l.offset=g;l.stride=e;l.divisor=c}}h[d]=a(function(d,a){var b=d.attribCache;if(x in b)return b[x];var c={isStream:!1};Object.keys(l).forEach(function(d){c[d]=l[d]});l.buffer&&(c.buffer=d.link(l.buffer));return b[x]=c})});
Object.keys(n).forEach(function(d){var a=n[d];h[d]=c(a,function(d,b){function c(d){b(g[d],"=",n,".",d,"|0;")}var n=d.invoke(b,a),x=d.shared,h=x.isBufferArgs,k=x.buffer,g={isStream:b.def(!1)},f=new ma;f.state=1;Object.keys(f).forEach(function(d){g[d]=b.def(""+f[d])});var e=g.buffer,ta=g.type;b("if(",h,"(",n,")){",g.isStream,"=true;",e,"=",k,".createStream(",34962,",",n,");",ta,"=",e,".dtype;","}else{",e,"=",k,".getBuffer(",n,");","if(",e,"){",ta,"=",e,".dtype;","}else if(",n,".constant){",g.state,
"=",2,";",v.map(function(d,a){return g[d]+"="+n+".length>="+a+"?"+n+"["+a+"]:0;"}).join(""),"}else{",e,"=",k,".getBuffer(",n,".buffer);",ta,'="type" in ',n,"?",x.glTypes,"[",n,".type]:",e,".dtype;",g.normalized,"=!!",n,".normalized;");c("size");c("offset");c("stride");c("divisor");b("}}");return g})});return h}function M(d){var b=d["static"],n=d.dynamic,h={};Object.keys(b).forEach(function(d){var c=b[d];h[d]=a(function(d,a){return"number"===typeof c||"boolean"===typeof c?""+c:d.link(c)})});Object.keys(n).forEach(function(d){var a=
n[d];h[d]=c(a,function(d,b){return d.invoke(b,a)})});return h}function X(d,a,b){var c=d.shared.context,n=d.scope();Object.keys(b).forEach(function(h){a.save(c,"."+h);n(c,".",h,"=",b[h].append(d,a),";")});a(n)}function d(d,a,b){var c=d.shared,n=c.gl,h=c.framebuffer,k;qa&&(k=a.def(c.extensions,".webgl_draw_buffers"));var l=d.constants,c=l.drawBuffers,l=l.backBuffer;d=b?b.append(d,a):a.def(h,".next");a("if(",h,".dirty||",d,"!==",h,".cur){","if(",d,"){",n,".bindFramebuffer(",36160,",",d,".framebuffer);");
qa&&a(k,".drawBuffersWEBGL(",c,"[",d,".colorAttachments.length]);");a("}else{",n,".bindFramebuffer(",36160,",null);");qa&&a(k,".drawBuffersWEBGL(",l,");");a("}",h,".cur=",d,";",h,".dirty=false;","}")}function ca(d,a,b){var c=d.shared,n=c.gl,h=d.current,k=d.next,l=c.current,g=c.next,e=d.cond(l,".dirty");oa.forEach(function(a){a=Q(a);if(!(a in b.state)){var c,f;if(a in k){c=k[a];f=h[a];var p=H(fa[a].length,function(d){return e.def(c,"[",d,"]")});e(d.cond(p.map(function(d,a){return d+"==="+f+"["+a+"]"}).join("&&")).then(n,
".",ha[a],"(",p,");",p.map(function(d,a){return f+"["+a+"]="+d}).join(";"),";"))}else c=e.def(g,".",a),p=d.cond(c,"!==",l,".",a),e(p),a in ga?p(d.cond(c).then(n,".enable(",ga[a],");")["else"](n,".disable(",ga[a],");"),l,".",a,"=",c,";"):p(n,".",ha[a],"(",c,");",l,".",a,"=",c,";")}});0===Object.keys(b.state).length&&e(l,".dirty=false;");a(e)}function n(d,a,c,n){var h=d.shared,g=d.current,e=h.current,l=h.gl;k(Object.keys(c)).forEach(function(h){var k=c[h];if(!n||n(k)){var f=k.append(d,a);if(ga[h]){var p=
ga[h];b(k)?f?a(l,".enable(",p,");"):a(l,".disable(",p,");"):a(d.cond(f).then(l,".enable(",p,");")["else"](l,".disable(",p,");"));a(e,".",h,"=",f,";")}else if(Array.isArray(f)){var q=g[h];a(l,".",ha[h],"(",f,");",f.map(function(d,a){return q+"["+a+"]="+d}).join(";"),";")}else a(l,".",ha[h],"(",f,");",e,".",h,"=",f,";")}})}function T(d,a){na&&!d.instancing&&(d.instancing=a.def(d.shared.extensions,".angle_instanced_arrays"))}function ra(d,a,b,c,n){function h(d){switch(d){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function k(b,c,n){function h(){a("if(!",p,".pointer){",e,".enableVertexAttribArray(",f,");",p,".pointer=true;}");var b=n.type,l;l=n.size?a.def(n.size,"||",c):c;a("if(",p,".type!==",b,"||",p,".size!==",l,"||",m.map(function(d){return p+"."+d+"!=="+n[d]}).join("||"),"){",e,".bindBuffer(",34962,",",q,".buffer);",e,".vertexAttribPointer(",[f,l,b,n.normalized,n.stride,n.offset],");",p,".type=",b,";",p,
".size=",l,";",m.map(function(d){return p+"."+d+"="+n[d]+";"}).join(""),"}");na&&(b=n.divisor,a("if(",p,".divisor!==",b,"){",d.instancing,".vertexAttribDivisorANGLE(",[f,b],");",p,".divisor=",b,";}"))}function g(){a("if(",p,".pointer){",e,".disableVertexAttribArray(",f,");",p,".pointer=false;","}if(",v.map(function(d,a){return p+"."+d+"!=="+T[a]}).join("||"),"){",e,".vertexAttrib4f(",f,",",T,");",v.map(function(d,a){return p+"."+d+"="+T[a]+";"}).join(""),"}")}var e=l.gl,f=a.def(b,".location"),p=a.def(l.attributes,
"[",f,"]");b=n.state;var q=n.buffer,T=[n.x,n.y,n.z,n.w],m=["buffer","normalized","offset","stride"];1===b?h():2===b?g():(a("if(",b,"===",1,"){"),h(),a("}else{"),g(),a("}"))}var l=d.shared;c.forEach(function(c){var l=c.name,f=b.attributes[l],e;if(f){if(!n(f))return;e=f.append(d,a)}else{if(!n(O))return;var g=d.scopeAttrib(l);e={};Object.keys(new ma).forEach(function(d){e[d]=a.def(g,".",d)})}k(d.link(c),h(c.info.type),e)})}function sa(d,a,b,c,n){for(var h=d.shared,k=h.gl,l,e=0;e<c.length;++e){var f=
c[e],g=f.name,p=f.info.type,q=b.uniforms[g],f=d.link(f)+".location";if(q){if(!n(q))continue;if(q["static"]){g=q.value;if(35678===p||35680===p)p=d.link(g._texture),a(k,".uniform1i(",f,p+".bind());"),a.exit(p,".unbind()");else if(35674===p||35675===p||35676===p)g=d.global.def("["+g+"]"),q=2,35675===p?q=3:35676===p&&(q=4),a(k,".uniformMatrix",q,"fv(",f,",false,",g,");");else{switch(p){case 5126:l="1f";break;case 35664:l="2f";break;case 35665:l="3f";break;case 35666:l="4f";break;case 35670:l="1i";break;
case 5124:l="1i";break;case 35671:l="2i";break;case 35667:l="2i";break;case 35672:l="3i";break;case 35668:l="3i";break;case 35673:l="4i";break;case 35669:l="4i"}a(k,".uniform",l,"(",f,",",g,");")}continue}else g=q.append(d,a)}else{if(!n(O))continue;g=a.def(h.uniforms,"[",m.id(g),"]")}q=",";switch(p){case 35678:case 35680:p=a.def(g,"._texture");a(k,".uniform1i(",f,",",p,".bind());");a.exit(p,".unbind();");continue;case 5124:case 35670:l="1i";break;case 35667:case 35671:l="2iv";break;case 35668:case 35672:l=
"3iv";break;case 35669:case 35673:l="4iv";break;case 5126:l="1f";break;case 35664:l="2fv";break;case 35665:l="3fv";break;case 35666:l="4fv";break;case 35674:l="Matrix2fv";q=",false,";break;case 35675:l="Matrix3fv";q=",false,";break;case 35676:l="Matrix4fv",q=",false,"}a(k,".uniform",l,"(",f,q,g,");")}}function ua(d,a,c,n){function h(b){var n=p[b];return n?n.batchStatic?n.append(d,a):n.append(d,c):a.def(e,".",b)}function f(){function d(){c(v,".drawElementsInstancedANGLE(",[T,w,u,m+"<<(("+u+"-5121)>>1)",
ca],");")}function a(){c(v,".drawArraysInstancedANGLE(",[T,m,w,ca],");")}q?I?d():(c("if(",q,"){"),d(),c("}else{"),a(),c("}")):a()}function g(){function d(){c(k+".drawElements("+[T,w,u,m+"<<(("+u+"-5121)>>1)"]+");")}function a(){c(k+".drawArrays("+[T,m,w]+");")}q?I?d():(c("if(",q,"){"),d(),c("}else{"),a(),c("}")):a()}var l=d.shared,k=l.gl,e=l.draw,p=n.draw,q=function(){var b=p.elements,n=a;b?(b.batchStatic||(n=c),b=b.append(d,n)):b=n.def(e,".","elements");b&&n("if("+b+")"+k+".bindBuffer(34963,"+b+
".buffer.buffer);");return b}(),T=h("primitive"),m=h("offset"),w=function(){var b=p.count,n=a;b?(b.batchStatic||(n=c),b=b.append(d,n)):b=n.def(e,".","count");return b}();if("number"===typeof w){if(0===w)return}else c("if(",w,"){"),c.exit("}");var ca,v;na&&(ca=h("instances"),v=d.instancing);var u=q+".type",I=p.elements&&b(p.elements);na&&("number"!==typeof ca||0<=ca)?"string"===typeof ca?(c("if(",ca,">0){"),f(),c("}else if(",ca,"<0){"),g(),c("}")):f():g()}function va(d,a,b,c,n){a=B();n=a.proc("body",
n);na&&(a.instancing=n.def(a.shared.extensions,".angle_instanced_arrays"));d(a,n,b,c);return a.compile().body}function za(d,a,b,c){T(d,a);ra(d,a,b,c.attributes,function(){return!0});sa(d,a,b,c.uniforms,function(){return!0});ua(d,a,a,b)}function Ca(a,b){var c=a.proc("draw",1);T(a,c);X(a,c,b.context);d(a,c,b.framebuffer);ca(a,c,b);n(a,c,b.state);var h=b.shader.progVar.append(a,c);c(a.shared.gl,".useProgram(",h,".program);");if(b.shader.program)za(a,c,b,b.shader.program);else{var f=a.global.def("{}"),
k=c.def(h,".id"),g=c.def(f,"[",k,"]");c(a.cond(g).then(g,".call(this,a0);")["else"](g,"=",f,"[",k,"]=",a.link(function(d){return va(za,a,b,d,1)}),"(",h,");",g,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Da(d,a,b,c){function n(){return!0}d.batchId="a1";T(d,a);ra(d,a,b,c.attributes,n);sa(d,a,b,c.uniforms,n);ua(d,a,a,b)}function wa(a,b,c,h){function g(d){return d.contextDep&&k||d.propDep}function f(d){return!g(d)}T(a,b);var k=c.contextDynamic,l=b.def(),
e=b.def();a.shared.props=e;a.batchId=l;var p=a.scope(),q=a.scope();b(p.entry,"for(",l,"=0;",l,"<","a1",";++",l,"){",e,"=","a0","[",l,"];",q,"}",p.exit);c.needsContext&&X(a,q,c.context);c.needsFramebuffer&&d(a,q,c.framebuffer);n(a,q,c.state,g);h?(ra(a,p,c,h.attributes,f),ra(a,q,c,h.attributes,g),sa(a,p,c,h.uniforms,f),sa(a,q,c,h.uniforms,g),ua(a,p,q,c)):(b=a.global.def("{}"),h=c.shader.progVar.append(a,q),e=q.def(h,".id"),p=q.def(b,"[",e,"]"),q(a.shared.gl,".useProgram(",h,".program);","if(!",p,"){",
p,"=",b,"[",e,"]=",a.link(function(d){return va(Da,a,c,d,2)}),"(",h,");}",p,".call(this,a0[",l,"],",l,");"))}function Ea(a,b){var c=a.proc("batch",2);a.batchId="0";T(a,c);var h=!1,g=!0;Object.keys(b.context).forEach(function(d){h=h||b.context[d].propDep});h||(X(a,c,b.context),g=!1);var f=b.framebuffer,k=!1;f&&(f.propDep?h=k=!0:f.contextDep&&h&&(k=!0),k||d(a,c,f));b.state.viewport&&b.state.viewport.propDynamic&&(h=!0);ca(a,c,b);n(a,c,b.state,function(d){return!(d.contextDep&&h||d.propDep)});b.contextDep=
h;b.needsContext=g;b.needsFramebuffer=k;g=b.shader.progVar;if(g.contextDep&&h||g.propDep)wa(a,c,b,null);else if(g=g.append(a,c),c(a.shared.gl,".useProgram(",g,".program);"),b.shader.program)wa(a,c,b,b.shader.program);else{var f=a.global.def("{}"),k=c.def(g,".id"),l=c.def(f,"[",k,"]");c(a.cond(l).then(l,".call(this,a0,a1);")["else"](l,"=",f,"[",k,"]=",a.link(function(d){return va(wa,a,b,d,2)}),"(",g,");",l,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Fa(d,
a){function b(h){var l=a.shader[h];l&&c.set(n.shader,"."+h,l.append(d,c))}var c=d.proc("scope",3);d.batchId="a2";var n=d.shared,h=n.current;X(d,c,a.context);a.framebuffer&&a.framebuffer.append(d,c);k(Object.keys(a.state)).forEach(function(b){var l=a.state[b].append(d,c);Array.isArray(l)?l.forEach(function(a,n){c.set(d.next[b],"["+n+"]",a)}):c.set(n.next,"."+b,l)});["elements","offset","count","instances","primitive"].forEach(function(b){var l=a.draw[b];l&&c.set(n.draw,"."+b,""+l.append(d,c))});Object.keys(a.uniforms).forEach(function(b){c.set(n.uniforms,
"["+m.id(b)+"]",a.uniforms[b].append(d,c))});Object.keys(a.attributes).forEach(function(b){var n=a.attributes[b].append(d,c),h=d.scopeAttrib(b);Object.keys(new ma).forEach(function(d){c.set(h,"."+d,n[d])})});b("vert");b("frag");0<Object.keys(a.state).length&&(c(h,".dirty=true;"),c.exit(h,".dirty=true;"));c("a1(",d.shared.context,",a0,0);")}var ma=Y.Record,ja={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(ja.min=32775,ja.max=32776);var na=r.angle_instanced_arrays,qa=r.webgl_draw_buffers,
fa={dirty:!0},la={},oa=[],ga={},ha={};K("dither",3024);K("blend.enable",3042);D("blend.color","blendColor",[0,0,0,0]);D("blend.equation","blendEquationSeparate",[32774,32774]);D("blend.func","blendFuncSeparate",[1,0,1,0]);K("depth.enable",2929,!0);D("depth.func","depthFunc",513);D("depth.range","depthRange",[0,1]);D("depth.mask","depthMask",!0);D("colorMask","colorMask",[!0,!0,!0,!0]);K("cull.enable",2884);D("cull.face","cullFace",1029);D("frontFace","frontFace",2305);D("lineWidth","lineWidth",1);
K("polygonOffset.enable",32823);D("polygonOffset.offset","polygonOffset",[0,0]);K("sample.alpha",32926);K("sample.enable",32928);D("sample.coverage","sampleCoverage",[1,!1]);K("stencil.enable",2960);D("stencil.mask","stencilMask",-1);D("stencil.func","stencilFunc",[519,0,-1]);D("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);D("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);K("scissor.enable",3089);D("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);
D("viewport","viewport",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var xa={gl:e,context:J,strings:m,next:la,current:fa,draw:Z,elements:t,buffer:R,shader:G,attributes:Y.state,uniforms:W,framebuffer:I,extensions:r,isBufferArgs:f},pa={primTypes:z,compareFuncs:w,blendFuncs:h,blendEquations:ja,stencilOps:p,glTypes:q,orientationType:A};qa&&(pa.backBuffer=[1029],pa.drawBuffer=H(y.maxDrawbuffers,function(d){return H(d,function(d){return 36064+d})}));var Ba=0;return{next:la,current:fa,procs:function(){var a=
B(),b=a.proc("poll"),c=a.proc("refresh"),n=a.block();b(n);c(n);var h=a.shared,g=h.gl,f=h.next,l=h.current;n(l,".dirty=false;");d(a,b);c(h.framebuffer,".dirty=true;");d(a,c);Object.keys(ga).forEach(function(d){var h=ga[d],k=n.def(f,".",d),e=a.block();e("if(",k,"){",g,".enable(",h,")}else{",g,".disable(",h,")}",l,".",d,"=",k,";");c(e);b("if(",k,"!==",l,".",d,"){",e,"}")});Object.keys(ha).forEach(function(d){var h=ha[d],k=fa[d],e,p,q=a.block();q(g,".",h,"(");Array.isArray(k)?(h=k.length,e=a.global.def(f,
".",d),p=a.global.def(l,".",d),q(H(h,function(d){return e+"["+d+"]"}),");",H(h,function(d){return p+"["+d+"]="+e+"["+d+"];"}).join("")),b("if(",H(h,function(d){return e+"["+d+"]!=="+p+"["+d+"]"}).join("||"),"){",q,"}")):(e=n.def(f,".",d),p=n.def(l,".",d),q(e,");",l,".",d,"=",e,";"),b("if(",e,"!==",p,"){",q,"}"));c(q)});return a.compile()}(),compile:function(d,a,b,c){var n=B(),h;h=ba(d);var g=ia(d,h),l=E(d),k=S(d);d=L(d);var f=g.viewport;f&&(k.viewport=f);f=Q("scissor.box");(g=g[f])&&(k[f]=g);g=0<
Object.keys(k).length;h={framebuffer:h,draw:l,shader:d,state:k,dirty:g};h.uniforms=U(b);h.attributes=P(a);h.context=M(c);Ca(n,h);Fa(n,h);Ea(n,h);return n.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":20,"./util/is-ndarray":23,"./util/is-typed-array":24,"./util/loop":26}],9:[function(e,m,r){function f(a,c){this.id=b++;this.type=a;this.data=c}function k(a){if(0===a.length)return[];var b=a.charAt(0),g=a.charAt(a.length-1);if(1<a.length&&b===g&&('"'===b||
"'"===b))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return k(a.substr(0,b.index)).concat(k(b[1])).concat(k(a.substr(b.index+b[0].length)));b=a.split(".");if(1===b.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(g=0;g<b.length;++g)a=a.concat(k(b[g]));return a}function g(a){return"["+k(a).join("][")+"]"}var b=0;m.exports={define:function(a,b){switch(typeof b){case "boolean":case "number":case "string":return new f(a,
g(b+""));case "undefined":return new f(a|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof f},unbox:function(a,b){if(a instanceof f){if(a.type&128)return new f(a.type&-129,g(b))}else if("function"===typeof a)return new f(0,a);return a},accessor:g}},{}],10:[function(e,m,r){var f=e("./util/is-typed-array"),k=e("./util/is-ndarray"),g=e("./constants/primitives.json"),b=e("./constants/usage.json");m.exports=function(a,c,e){function m(a){this.buffer=a;this.primType=
4;this.type=this.vertCount=0}function r(a,b,h,g,p,m,z){(m=z)||f(b)&&(!k(b)||f(b.data))||(m=c.oes_element_index_uint?5125:5123);a.buffer.bind();e._initBuffer(a.buffer,b,h,m,3);b=z;if(!z){switch(a.buffer.dtype){case 5121:case 5120:b=5121;break;case 5123:case 5122:b=5123;break;case 5125:case 5124:b=5125}a.buffer.dtype=b}a.type=b;0>p&&(p=a.buffer.byteLength,5123===b?p>>=1:5125===b&&(p>>=2));a.vertCount=p;p=g;0>g&&(p=4,g=a.buffer.dimension,1===g&&(p=0),2===g&&(p=1),3===g&&(p=4));a.primType=p}var y={uint8:5121,
uint16:5123};c.oes_element_index_uint&&(y.uint32=5125);m.prototype.bind=function(){this.buffer.bind()};var z=[];return{create:function(c){function v(c){if(c)if("number"===typeof c)h(c),w.primType=4,w.vertCount=c|0,w.type=5121;else{var e=null,q=35044,m=-1,u=-1,z=0,H=0;Array.isArray(c)||f(c)||k(c)?e=c:("data"in c&&(e=c.data),"usage"in c&&(q=b[c.usage]),"primitive"in c&&(m=g[c.primitive]),"count"in c&&(u=c.count|0),"length"in c&&(z=c.length|0),"type"in c&&(H=y[c.type]));e?r(w,e,q,m,u,z,H):(c=w.buffer,
c.bind(),a.bufferData(34963,z,q),c.dtype=H||5121,c.usage=q,c.dimension=3,c.byteLength=z,w.primType=0>m?4:m,w.vertCount=0>u?0:u,w.type=c.dtype)}else h(),w.primType=4,w.vertCount=0,w.type=5121;return v}var h=e.create(null,34963,!0),w=new m(h._buffer);v(c);v._reglType="elements";v._elements=w;v.subdata=function(a,b){h.subdata(a,b);return v};v.destroy=function(){h.destroy();w.buffer=null};return v},createStream:function(a){var b=z.pop();b||(b=new m(e.create(null,34963,!0)._buffer));r(b,a,35040,-1,-1,
0,0);return b},destroyStream:function(a){z.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof m?a._elements:null}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":23,"./util/is-typed-array":24}],11:[function(e,m,r){m.exports=function(e){function k(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(b){try{g[b]=
e.getExtension(b)}catch(a){}})}var g={};k();return{extensions:g,refresh:k}}},{}],12:[function(e,m,r){var f=e("./util/values"),k=e("./util/extend");m.exports=function(g,b,a,c,e){function m(a,b,c,h){this.target=a;this.level=b;this.texture=c;this.renderbuffer=h}function r(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function y(a,b){var c=b.width,h=b.height;if(a.texture)var g=a.texture._texture,e=Math.max(1,g.params.width>>a.level),k=Math.max(1,
g.params.height>>a.level),c=c||e,h=h||k;else g=a.renderbuffer._renderbuffer,c=c||g.width,h=h||g.height;g.refCount+=1;b.width=c;b.height=h}function z(a,b){b?b.texture?g.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):g.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):g.framebufferTexture2D(36160,a,3553,null,0)}function q(a){var b=3553,c=0,h=null,g=null;"object"===typeof a&&("level"in a&&(c=a.level|0),"target"in a&&(b=a.target|0));var e=a._reglType;
"texture"===e?h=a:"renderbuffer"===e&&(g=a,b=36161,c=0);return new m(b,c,h,g)}function v(a){return a&&(a.texture||a.renderbuffer)}function h(){this.id=R++;t[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function w(c){g.isFramebuffer(c.framebuffer)||(c.framebuffer=g.createFramebuffer());A.dirty=!0;g.bindFramebuffer(36160,c.framebuffer);for(var h=
c.colorAttachments,e=0;e<h.length;++e)z(36064+e,h[e]);for(e=h.length;e<a.maxColorAttachments;++e)z(36064+e,null);z(36096,c.depthAttachment);z(36128,c.stencilAttachment);z(33306,c.depthStencilAttachment);b.webgl_draw_buffers&&b.webgl_draw_buffers.drawBuffersWEBGL(da[h.length]);g.checkFramebufferStatus(36160)}function p(a){a=a.framebuffer;g.isFramebuffer(a)&&g.deleteFramebuffer(a)}var A={current:null,next:null,dirty:!1},O={rgba:6408},F={rgba4:32854,rgb565:36194,"rgb5 a1":32855};b.ext_srgb&&(F.srgba=
35907);b.ext_color_buffer_half_float&&(F.rgba16f=34842,F.rgb16f=34843);b.webgl_color_buffer_float&&(F.rgba32f=34836);var N=[],ea=[];b.webgl_depth_texture&&(N.push(6402),ea.push(34041));k(k({},O),F);f(O);f(F);F=5121;N={uint8:5121};b.oes_texture_half_float&&(F=N["half float"]=36193);b.oes_texture_float&&(F=N["float"]=5126);N.best=F;var da=function(){for(var b=Array(a.maxDrawbuffers),c=0;c<=a.maxDrawbuffers;++c)for(var h=b[c]=Array(c),g=0;g<c;++g)h[g]=36064+g;return b}(),R=0,t={};return k(A,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof h)?a:null},create:function(a){function b(a){var h,f=a||{},p=a=0;if("shape"in f){var z=f.shape;a=z[0];p=z[1]}else"radius"in f&&(a=p=f.radius),"width"in f&&(a=f.width),"height"in f&&(p=f.height);var A=null,z=!1;if("colorBuffers"in f||"colorBuffer"in f){A=f.colorBuffers||f.colorBuffer;Array.isArray(A)||(A=[A]);k.width=a;k.height=p;A=A.map(q);for(h=0;h<A.length;++h)y(A[h],k);a=k.width;p=k.height}else{var t=!0,B="rgba",F="uint8",N=1,
z=!0;k.width=a=a||g.drawingBufferWidth;k.height=p=p||g.drawingBufferHeight;"format"in f&&(B=f.format,t=B in O);"type"in f&&(F=f.type);"colorCount"in f&&(N=f.colorCount|0);if(k.ownsColor)for(A=k.colorAttachments;A.length>N;)r(A.pop());else A=[];for(h=0;h<A.length;++h){var L;a:{L=A[h];var E=t,S=B,U=a,P=p;if(L.texture){var M=L.texture;if(E){M({format:S,type:F,width:U,height:P});M._texture.refCount+=1;L=!0;break a}}else if(M=L.renderbuffer,!E){M({format:S,width:U,height:P});M._renderbuffer.refCount+=
1;L=!0;break a}r(L);L=!1}L||(A[h--]=A[A.length-1],A.pop())}for(;A.length<N;)t?A.push(new m(3553,0,c.create({format:B,type:F,width:a,height:p},3553),null)):A.push(new m(36161,0,null,e.create({format:B,width:a,height:p})))}k.width=a;k.height=p;B=t=h=null;F=!1;"depthBuffer"in f&&(h=q(f.depthBuffer));"stencilBuffer"in f&&(t=q(f.stencilBuffer));"depthStencilBuffer"in f&&(B=q(f.depthStencilBuffer));if(h||t||B)y(h||t||B,k);else if(N=!0,E=L=!1,"depth"in f&&(N=!!f.depth),"stencil"in f&&(L=!!f.stencil),"depthTexture"in
f&&(E=!!f.depthTexture),f=k.depthAttachment||k.stencilAttachment||k.depthStencilAttachment,S=null,N||L)F=!0,E?(E=L?"depth stencil":"depth",k.ownsDepthStencil&&f.texture?(f.texture({format:E,width:a,height:p}),f.texture._texture.refCount+=1,S=f):S=new m(3553,0,c.create({format:E,width:a,height:p},3553),null)):(E=N?L?"depth stencil":"depth":"stencil",k.ownsDepthStencil&&f.renderbuffer?(f.renderbuffer({format:E,width:a,height:p}),f.renderbuffer._renderbuffer.refCount+=1,S=f):S=new m(36161,0,null,e.create({format:E,
width:a,height:p}))),N?L?B=S:h=S:t=S;a=k;a.colorAttachments.forEach(r);r(a.depthAttachment);r(a.stencilAttachment);r(a.depthStencilAttachment);k.colorAttachments=A;k.depthAttachment=h;k.stencilAttachment=t;k.depthStencilAttachment=B;k.ownsColor=z;k.ownsDepthStencil=F;b.color=A.map(v);b.depth=v(h);b.stencil=v(t);b.depthStencil=v(B);w(k);b.width=k.width;b.height=k.height;return b}var k=new h;b(a);b._reglType="framebuffer";b._framebuffer=k;b._destroy=function(){p(k)};return b},clear:function(){f(t).forEach(p)},
refresh:function(){f(t).forEach(w)}})}},{"./util/extend":21,"./util/values":32}],13:[function(e,m,r){m.exports=function(f,k){var g=1;k.ext_texture_filter_anisotropic&&(g=f.getParameter(34047));var b=1,a=1;k.webgl_draw_buffers&&(b=f.getParameter(34852),a=f.getParameter(36063));return{colorBits:[f.getParameter(3410),f.getParameter(3411),f.getParameter(3412),f.getParameter(3413)],depthBits:f.getParameter(3414),stencilBits:f.getParameter(3415),subpixelBits:f.getParameter(3408),extensions:Object.keys(k).filter(function(a){return!!k[a]}),
maxAnisotropic:g,maxDrawbuffers:b,maxColorAttachments:a,pointSizeDims:f.getParameter(33901),lineWidthDims:f.getParameter(33902),maxViewportDims:f.getParameter(3386),maxCombinedTextureUnits:f.getParameter(35661),maxCubeMapSize:f.getParameter(34076),maxRenderbufferSize:f.getParameter(34024),maxTextureUnits:f.getParameter(34930),maxTextureSize:f.getParameter(3379),maxAttributes:f.getParameter(34921),maxVertexUniforms:f.getParameter(36347),maxVertexTextureUnits:f.getParameter(35660),maxVaryingVectors:f.getParameter(36348),
maxFragmentUniforms:f.getParameter(36349),glsl:f.getParameter(35724),renderer:f.getParameter(7937),vendor:f.getParameter(7936),version:f.getParameter(7938)}}},{}],14:[function(e,m,r){var f=e("./util/is-typed-array");m.exports=function(k,g,b){return function(a){var c=a||{};f(a)?c={data:c}:2===arguments.length?c={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof a&&(c={});g();var e=c.x||0,m=c.y||0,r=c.width||b.viewportWidth,y=c.height||b.viewportHeight,c=c.data||new Uint8Array(r*y*4);k.pixelStorei(3333,
4);k.readPixels(e,m,r,y,6408,5121,c);return c}}},{"./util/is-typed-array":24}],15:[function(e,m,r){var f=e("./util/values");m.exports=function(k,g,b){function a(){this.id=r++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function c(a){k.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=k.createRenderbuffer());k.bindRenderbuffer(36161,a.renderbuffer);k.renderbufferStorage(36161,a.format,a.width,a.height)}function e(a){var b=a.renderbuffer;k.bindRenderbuffer(36161,
null);k.isRenderbuffer(b)&&k.deleteRenderbuffer(b);a.renderbuffer=null;a.refCount=0;delete y[a.id]}var m={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};g.ext_srgb&&(m.srgba=35907);g.ext_color_buffer_half_float&&(m.rgba16f=34842,m.rgb16f=34843);g.webgl_color_buffer_float&&(m.rgba32f=34836);var r=0,y={};a.prototype.decRef=function(){0===--this.refCount&&e(this)};return{create:function(b){function f(a){a=a||{};var b=0,k=0;"shape"in a?(k=a.shape,b=k[0]|0,k=
k[1]|0):("radius"in a&&(b=k=a.radius|0),"width"in a&&(b=a.width|0),"height"in a&&(k=a.height|0));f.width=g.width=Math.max(b,1);f.height=g.height=Math.max(k,1);g.format=32854;"format"in a&&(g.format=m[a.format]);c(g);return f}var g=new a;y[g.id]=g;f(b);f._reglType="renderbuffer";f._renderbuffer=g;f.destroy=function(){g.decRef()};return f},refresh:function(){f(y).forEach(c)},clear:function(){f(y).forEach(e)}}}},{"./util/values":32}],16:[function(e,m,r){var f=e("./util/values");m.exports=function(k,
g){function b(a,b,c,f){this.name=a;this.id=b;this.location=c;this.info=f}function a(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function c(a,b,c){c=35632===a?r:y;var f=c[b];if(!f){var e=g.str(b),f=k.createShader(a);k.shaderSource(f,e);k.compileShader(f);c[b]=f}return f}function e(a,b){this.id=v++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[]}function m(h,f){var e,q;e=c(35632,h.fragId);q=c(35633,h.vertId);var r=h.program=
k.createProgram();k.attachShader(r,e);k.attachShader(r,q);k.linkProgram(r);var u=k.getProgramParameter(r,35718),z=h.uniforms;for(e=0;e<u;++e)if(q=k.getActiveUniform(r,e))if(1<q.size)for(var v=0;v<q.size;++v){var y=q.name.replace("[0]","["+v+"]");a(z,new b(y,g.id(y),k.getUniformLocation(r,y),q))}else a(z,new b(q.name,g.id(q.name),k.getUniformLocation(r,q.name),q));u=k.getProgramParameter(r,35721);z=h.attributes;for(e=0;e<u;++e)(q=k.getActiveAttrib(r,e))&&a(z,new b(q.name,g.id(q.name),k.getAttribLocation(r,
q.name),q))}var r={},y={},z={},q=[],v=0;return{clear:function(){var a=k.deleteShader.bind(k);f(r).forEach(a);r={};f(y).forEach(a);y={};q.forEach(function(a){k.deleteProgram(a.program)});q.length=0;z={}},refresh:function(){r={};y={};q.forEach(m)},program:function(a,b,c){var f=z[b];f||(f=z[b]={});var g=f[a];g||(g=new e(b,a),m(g,c),f[a]=g,q.push(g));return g},shader:c,frag:null,vert:null}}},{"./util/values":32}],17:[function(e,m,r){m.exports=function(){var f={"":0},k=[""];return{id:function(g){var b=
f[g];if(b)return b;b=f[g]=k.length;k.push(g);return b},str:function(f){return k[f]}}}},{}],18:[function(e,m,r){function f(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function k(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,f=1;f<b;++f)if(!Array.isArray(a[f])||a[f].length!==c)return!1;return!0}function g(a){return Object.prototype.toString.call(a)}function b(a){return"[object HTMLCanvasElement]"===g(a)}function a(a){return"[object CanvasRenderingContext2D]"===
g(a)}var c=e("./util/extend"),u=e("./util/values"),H=e("./util/is-typed-array"),V=e("./util/is-ndarray"),y=e("./util/load-texture"),z=e("./util/to-half-float"),q=e("./util/parse-dds"),v=[9984,9986,9985,9987];m.exports=function(h,e,p,m,r){function F(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=
this.miplevel=0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function N(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ea(a,b){var c,f,g=0,e=0,k=0,h=0,q=0,p=0,m=!1,r=!1,u=!1;for(c=0;c<b.length;++c)f=b[c],h=h||f.width<<f.miplevel,q=q||f.height<<f.miplevel,
g=g||f.type,e=e||f.format,k=k||f.internalformat,p=p||f.channels,m=m||f.needsPoll,r=r||f.needsListeners,f=f.miplevel,u=u||0<f;a.needsPoll=m;a.needsListeners=r;a.width=h;a.height=q;a.format=e;a.internalformat=k;a.type=g;if(3553!==a.target)for(c=0;6>c;++c);c=0<=v.indexOf(a.minFilter);a.genMipmaps=!u&&(a.genMipmaps||c);u=u||a.genMipmaps;a.minFilter||(a.minFilter=u?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(c=0;c<b.length;++c)f=b[c],f.channels||(f.channels=p),f.format||(f.format=e),f.internalformat||
(f.internalformat=k),f.type||(f.type=g)}function da(a){this.id=S++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new N(a);this.pixels=[]}function R(a,b){function c(a,d){var f=d.mipmap,n;if(Array.isArray(f))for(var g=0;g<f.length;++g)n=new F(a),n.parseFlags(b),n.parseFlags(d),n.parse(f[g],g),e.push(n);else n=new F(a),n.parseFlags(b),n.parse(d,0),e.push(n)}var f;I(a);var g=a.params;N.call(g,a.target);var e=a.pixels;e.length=
0;g.parse(b);if(3553===a.target)c(3553,b);else{var k=b.faces||b;if(Array.isArray(k))for(f=0;6>f;++f)c(34069+f,k[f]);else if("string"!==typeof k)for(f=0;6>f;++f)c(34069+f,{})}ea(g,e);g.needsListeners&&ka(a);g.needsPoll&&(a.pollId=P.length,P.push(a));t(a)}function t(a){h.isTexture(a.texture)||(a.texture=h.createTexture());var b=a.target,c=a.unit;0<=c?(h.activeTexture(33984+c),E=c):h.bindTexture(b,a.texture);for(var b=a.pixels,f=a.params,g=0;g<b.length;++g)b[g].upload(f);f.upload();0>c&&((c=X[E])?h.bindTexture(c.target,
c.texture):(a.unit=E,X[E]=a))}function ka(a){function b(a,d,c){var f=q(c);f.pixels.forEach(function(b){var c=new F(f.cube?b.target:a);c.channels=f.channels;c.compressed=f.compressed;c.type=f.type;c.internalformat=f.format;c.format=L[f.format];c.width=b.width;c.height=b.height;c.miplevel=b.miplevel||d;c.data=b.data;g.push(c)})}function c(){for(var n=0;n<g.length;++n){var e=g[n],k=e.image,h=e.video,q=e.xhr;k&&k.complete?(e.width=k.naturalWidth,e.height=k.naturalHeight):h&&2<h.readyState?(e.width=h.width,
e.height=h.height):q&&4===q.readyState&&(g[n]=g[g.length-1],g.pop(),q.removeEventListener("readystatechange",t),b(e.target,e.miplevel,q.response))}ea(f,g);t(a)}var f=a.params,g=a.pixels;g.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){g.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",
c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function I(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((P[b]=P[P.length-1]).id=b,P.pop(),a.pollId=-1)}function W(a){var b=a.texture,c=a.unit,f=a.target;0<=c&&(h.activeTexture(33984+c),E=c,h.bindTexture(f,null),X[c]=null);I(a);h.isTexture(b)&&h.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete U[a.id]}var Y={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
G={repeat:10497,clamp:33071,mirror:33648},Z={nearest:9728,linear:9729},J=c({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},Z),Q={none:0,browser:37444},K={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},D={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},B={};e.ext_srgb&&(D.srgb=35904,D.srgba=35906);e.oes_texture_float&&(K["float"]=5126);e.oes_texture_half_float&&
(K["half float"]=36193);e.webgl_depth_texture&&(c(D,{depth:6402,"depth stencil":34041}),c(K,{uint16:5123,uint32:5125,"depth stencil":34042}));e.webgl_compressed_texture_s3tc&&c(B,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});e.webgl_compressed_texture_atc&&c(B,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});e.webgl_compressed_texture_pvrtc&&c(B,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});e.webgl_compressed_texture_etc1&&(B["rgb etc1"]=36196);var ba=Array.prototype.slice.call(h.getParameter(34467));Object.keys(B).forEach(function(a){var b=B[a];0<=ba.indexOf(b)&&(D[a]=b)});var ia=Object.keys(D);p.textureFormats=ia;var L=ia.reduce(function(a,b){var c=D[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});c(F.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=Q[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=D[b];b in K&&(this.type=K[b]);b in B&&(this.compressed=!0)}"type"in a&&(this.type=K[a.type]);var b=this.width,c=this.height,f=this.channels;"shape"in a?(b=a.shape[0],c=a.shape[1],3===a.shape.length&&(f=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),
"height"in a&&(c=a.height),"channels"in a&&(f=a.channels));this.width=b|0;this.height=c|0;this.channels=f|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*f,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(d,c){this.miplevel=c;this.width>>=c;this.height>>=c;var e=d;switch(typeof d){case "object":if(!d)return;
this.parseFlags(d);var h=d.data;if("string"===typeof h||h&&(H(h)||f(h)||V(h)||b(h)||a(h)||"[object HTMLImageElement]"===g(h)||"[object HTMLVideoElement]"===g(h)||k(h)))e=d.data;break;case "undefined":return}"string"===typeof e&&(e=y(e,this.crossOrigin));var h=null,q=!1;if(null!==e)if(H(e))this.data=e;else if(f(e))h=e,q=!0;else if(V(e)){Array.isArray(e.data)?(h=e.data,q=!0):this.data=e.data;var p=e.shape;this.width=p[0];this.height=p[1];this.channels=3===p.length?p[2]:1;p=e.stride;this.strideX=e.stride[0];
this.strideY=e.stride[1];this.strideC=3===p.length?e.stride[2]:1;this.offset=e.offset;this.needsTranspose=!0}else if(b(e)||a(e))b(e)?this.canvas=e:this.canvas=e.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===g(e))this.image=e,e.complete?(this.width=e.naturalWidth,this.height=e.naturalHeight):(this.width=this.width||e.naturalWidth,this.height=this.height||e.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===g(e))this.video=e,1<e.readyState?(this.width=e.width,this.height=e.height):(this.width=this.width||e.width,this.height=this.height||e.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===g(e))this.xhr=e,this.needsListeners=!0;else if(k(e)){var q=e[0].length,p=e.length,m=1,u,v,w,t;if(Array.isArray(e[0][0]))for(m=e[0][0].length,h=Array(q*p*m),v=t=0;v<p;++v)for(u=0;u<q;++u)for(w=0;w<m;++w)h[t++]=e[v][u][w];
else for(h=Array(q*p),v=t=0;v<p;++v)for(u=0;u<q;++u)h[t++]=e[v][u];this.width=q;this.height=p;this.channels=m;q=!0}else d.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||r.viewportWidth)|0,this.height=(this.height||r.viewportHeight)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=
[6409,6410,6407,6408][(this.channels=this.channels||4)-1]);e=this.internalformat;p=this.format=L[e];if(!this.channels)switch(p){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}p=this.type;5126!==p&&36193!==p&&(p||(p=6402===e?5125:5121));this.type=p;if(q)switch(p){case 5121:this.data=new Uint8Array(h);break;case 5123:this.data=new Uint16Array(h);break;case 5125:this.data=new Uint32Array(h);break;
case 5126:this.data=new Float32Array(h);break;case 36193:this.data=z(h)}if(this.data&&this.needsTranspose){h=this.data;e=this.width;q=this.height;p=this.channels;m=this.strideX;u=this.strideY;v=this.strideC;w=this.offset;t=new h.constructor(e*q*p);for(var X=0,A=0;A<q;++A)for(var B=0;B<e;++B)for(var I=0;I<p;++I)t[X++]=h[u*A+m*B+v*I+w];this.data=t}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){h.pixelStorei(37440,
this.flipY);h.pixelStorei(37441,this.premultiplyAlpha);h.pixelStorei(37443,this.colorSpace);h.pixelStorei(3317,this.unpackAlignment);var b=this.target,c=this.miplevel,f=this.image,e=this.canvas,g=this.video,k=this.data,p=this.internalformat,q=this.format,r=this.type,u=this.width||Math.max(1,a.width>>c);a=this.height||Math.max(1,a.height>>c);g&&2<g.readyState?h.texImage2D(b,c,q,q,r,g):f&&f.complete?h.texImage2D(b,c,q,q,r,f):e?h.texImage2D(b,c,q,q,r,e):this.compressed?h.compressedTexImage2D(b,c,p,u,
a,0,k):this.copy?(m(),h.copyTexImage2D(b,c,q,this.x,this.y,u,a,0)):k?h.texImage2D(b,c,q,u,a,0,q,r,k):h.texImage2D(b,c,q,u||1,a||1,0,q,r,null)}});c(N.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=J[a.min]);"mag"in a&&(this.magFilter=Z[a.mag]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var f=a.wrap;"string"===typeof f?b=c=G[f]:Array.isArray(f)&&(b=G[f[0]],c=G[f[1]])}else"wrapS"in a&&(b=G[a.wrapS]),"wrapT"in a&&(c=G[a.wrapT]);this.wrapS=b;this.wrapT=c;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=Y[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;h.texParameteri(a,10241,this.minFilter);h.texParameteri(a,10240,this.magFilter);h.texParameteri(a,10242,this.wrapS);h.texParameteri(a,10243,this.wrapT);e.ext_texture_filter_anisotropic&&h.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(h.hint(33170,this.mipmapHint),h.generateMipmap(a))}});
var E=0,S=0,U={},P=[],M=p.maxTextureUnits,X=Array(M).map(function(){return null});c(da.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<M;++b){var c=X[b];if(c){if(0<c.bindCount)continue;c.unit=-1}X[b]=this;a=b;break}this.unit=a;h.activeTexture(33984+a);h.bindTexture(this.target,this.texture);E=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&W(this)}});return{create:function(a,b){function c(a,d,e,g,h,k){var q=a||{};34067===b&&
6===arguments.length&&(q=[a,d,e,g,h,k]);R(f,q);c.width=f.params.width;c.height=f.params.height;return c}var f=new da(b);U[f.id]=f;c(a);c._reglType="texture";c._texture=f;c.destroy=function(){f.decRef()};return c},refresh:function(){u(U).forEach(t);for(var a=0;a<M;++a)X[a]=null;E=0;h.activeTexture(33984)},clear:function(){for(var a=0;a<M;++a)h.activeTexture(33984+a),h.bindTexture(3553,null),X[a]=null;h.activeTexture(33984);E=0;u(U).forEach(W)},poll:function(){P.forEach(t)},getTexture:function(a){return null}}}},
{"./util/extend":21,"./util/is-ndarray":23,"./util/is-typed-array":24,"./util/load-texture":25,"./util/parse-dds":27,"./util/to-half-float":30,"./util/values":32}],19:[function(e,m,r){m.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],20:[function(e,m,r){function f(b){return Array.prototype.slice.call(b)}function k(b){return f(b).join("")}var g=e("./extend");m.exports=function(){function b(){var a=[],b=[];return g(function(){a.push.apply(a,
f(arguments))},{def:function(){var e="v"+c++;b.push(e);0<arguments.length&&(a.push(e,"="),a.push.apply(a,f(arguments)),a.push(";"));return e},toString:function(){return k([0<b.length?"var "+b+";":"",k(a)])}})}function a(){function a(b,e){f(b,e,"=",c.def(b,e),";")}var c=b(),f=b(),e=c.toString,k=f.toString;return g(c,{entry:c,exit:f,save:a,set:function(b,f,e){a(b,f);c(b,f,"=",e,";")},toString:function(){return e()+k()}})}var c=0,e=[],m=[],r=b(),y={};return{global:r,link:function(a){for(var b=0;b<m.length;++b)if(m[b]===
a)return e[b];b="g"+c++;e.push(b);m.push(a);return b},block:b,proc:function(b,c){function f(){var a="a"+e.length;e.push(a);return a}var e=[];c=c||0;for(var m=0;m<c;++m)f();var m=a(),p=m.toString;return y[b]=g(m,{arg:f,toString:function(){return k(["function(",e.join(),"){",p(),"}"])}})},scope:a,cond:function(){var b=k(arguments),c=a(),e=a(),h=c.toString,m=e.toString;return g(c,{then:function(){c.apply(c,f(arguments));return this},"else":function(){e.apply(e,f(arguments));return this},toString:function(){var a=
m();a&&(a="else{"+a+"}");return k(["if(",b,"){",h(),"}",a])}})},compile:function(){var a=['"use strict";',r,"return {"];Object.keys(y).forEach(function(b){a.push('"',b,'":',y[b].toString(),",")});a.push("}");var b=k(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,e.concat(b)).apply(null,m)}}}},{"./extend":21}],21:[function(e,m,r){m.exports=function(f,e){for(var g=Object.keys(e),b=0;b<g.length;++b)f[g[b]]=e[g[b]];return f}},{}],22:[function(e,m,r){m.exports=
function(f,e,g){for(var b=0,a=0;a<e.length;++a)for(var c=e[a],m=0;m<g;++m)f[b++]=c[m]}},{}],23:[function(e,m,r){var f=e("./is-typed-array");m.exports=function(e){return!!e&&"object"===typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"===typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||f(e.data))}},{"./is-typed-array":24}],24:[function(e,m,r){var f=e("../constants/arraytypes.json");m.exports=function(e){return Object.prototype.toString.call(e)in f}},{"../constants/arraytypes.json":4}],
25:[function(e,m,r){m.exports=function(e,k){if("undefined"!==typeof document){var g;g=(g=/\.(\w+)(\?.*)?$/.exec(e))&&g[1]?g[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(g))return g=document.createElement("video"),g.autoplay=!0,g.loop=!0,k&&(g.crossOrigin=k),g.src=e,g;if(0<=["dds"].indexOf(g))return g=new XMLHttpRequest,g.responseType="arraybuffer",g.open("GET",e,!0),g.send(),g;g=new Image;k&&(g.crossOrigin=k);g.src=e;return g}return null}},
{}],26:[function(e,m,r){m.exports=function(e,k){for(var g=Array(e),b=0;b<e;++b)g[b]=k(b);return g}},{}],27:[function(e,m,r){m.exports=function(e){function m(a){for(var b=Y,c=G,f=0;f<D;++f){var g=Math.max(1,b+3>>2)*Math.max(1,c+3>>2)*Q;ba.pixels.push({target:a,miplevel:f,width:b,height:c,data:new Uint8Array(e,B,g)});B+=g;b>>=1;c>>=1}}var r=new Int32Array(e),W=r[A],Y=r[F],G=r[O],Z=H,J=0,Q=0,K=4;switch(r[da]){case q:Q=8;W&z?(K=3,J=g):J=b;break;case v:Q=16;J=a;break;case h:Q=16;J=c;break;case w:Q=8,J=
u}var D=1;r[ea]&V&&(D=Math.max(1,r[N]));var B=r[p]+4,ba={width:Y,height:G,channels:K,format:J,type:Z,compressed:!0,cube:!1,pixels:[]};if(r[R]&y)for(ba.cube=!0,r=0;6>r;++r)m(k+r);else m(f);return ba};var f=3553,k=34069,g=33776,b=33777,a=33778,c=33779,u=36196,H=5121,V=131072,y=512,z=64,q=827611204,v=861165636,h=894720068,w=826496069,p=1,A=2,O=3,F=4,N=7,ea=20,da=21,R=28},{}],28:[function(e,m,r){function f(a){var b,e;b=(65535<a)<<4;a>>>=b;e=(255<a)<<3;a>>>=e;b|=e;e=(15<a)<<2;a>>>=e;b|=e;e=(3<a)<<1;return b|
e|a>>>e>>1}function k(a){a:{for(var c=16;268435456>=c;c*=16)if(a<=c){a=c;break a}a=0}c=b[f(a)>>2];return 0<c.length?c.pop():new ArrayBuffer(a)}function g(a){b[f(a.byteLength)>>2].push(a)}var b=e("./loop")(8,function(){return[]});m.exports={alloc:k,free:g,allocType:function(a,b){switch(a){case 5120:return new Int8Array(k(b),0,b);case 5121:return new Uint8Array(k(b),0,b);case 5122:return new Int16Array(k(2*b),0,b);case 5123:return new Uint16Array(k(2*b),0,b);case 5124:return new Int32Array(k(4*b),0,
b);case 5125:return new Uint32Array(k(4*b),0,b);case 5126:return new Float32Array(k(4*b),0,b);default:return null}},freeType:function(a){g(a.buffer)}}},{"./loop":26}],29:[function(e,m,r){m.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:{next:function(e){setTimeout(e,30)},cancel:clearTimeout}},{}],30:[function(e,m,r){m.exports=function(e){for(var k=new Float32Array(e),
k=new Uint32Array(k.buffer),g=new Uint16Array(e.length),b=0;b<e.length;++b)if(isNaN(e[b]))g[b]=65535;else if(Infinity===e[b])g[b]=31744;else if(-Infinity===e[b])g[b]=64512;else{var a=k[b],c=a>>>31<<15,m=(a<<1>>>24)-127,a=a>>13&1023;g[b]=-24>m?c:-14>m?c+(a+1024>>-14-m):15<m?c+31744:c+(m+15<<10)+a}return g}},{}],31:[function(e,m,r){m.exports=function(e,k,g,b,a,c,m){for(var r=0,V=0;V<g;++V)for(var y=0;y<b;++y)e[r++]=k[a*V+c*y+m]}},{}],32:[function(e,m,r){m.exports=function(e){return Object.keys(e).map(function(k){return e[k]})}},
{}],33:[function(e,m,r){function f(b,a){function c(){var a=window.innerWidth,c=window.innerHeight;b!==document.body&&(c=b.getBoundingClientRect(),a=c.right-c.left,c=c.top-c.bottom);e.width=m*a;e.height=m*c;g(e.style,{width:a+"px",height:c+"px"})}var e=document.createElement("canvas"),f=k(e,a);g(e.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(e);b===document.body&&(e.style.position="absolute",g(b.style,{margin:0,padding:0}));var m=+f.options.pixelRatio;window.addEventListener("resize",
c,!1);var r=f.options.onDestroy;f.options=g(g({},f.options),{onDestroy:function(){window.removeEventListener("resize",c);b.removeChild(e);r&&r()}});c();return f}function k(b,a){function c(a){try{return b.getContext(a,e)}catch(c){return null}}var e=a.glOptions||{};return{gl:c("webgl")||c("experimental-webgl")||c("webgl-experimental"),options:g({pixelRatio:window.devicePixelRatio},a)}}var g=e("./util/extend");m.exports=function(b){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:b[0],
options:b[1]||{}};var a=document.body,c=b[1]||{};if("string"===typeof b[0])a=document.querySelector(b[0])||document.body;else if("object"===typeof b[0])if(b[0]instanceof HTMLElement)a=b[0];else{if(b[0]instanceof WebGLRenderingContext)return{gl:b[0],options:g({pixelRatio:1},c)};c=b[0]}return a.nodeName&&"CANVAS"===a.nodeName.toUpperCase()?k(a,c):f(a,c)}},{"./util/extend":21}],34:[function(e,m,r){var f=e("./lib/util/extend"),k=e("./lib/dynamic"),g=e("./lib/util/raf"),b=e("./lib/util/clock"),a=e("./lib/strings"),
c=e("./lib/webgl"),u=e("./lib/extension"),H=e("./lib/limits"),V=e("./lib/buffer"),y=e("./lib/elements"),z=e("./lib/texture"),q=e("./lib/renderbuffer"),v=e("./lib/framebuffer"),h=e("./lib/attribute"),w=e("./lib/shader"),p=e("./lib/read"),A=e("./lib/core");m.exports=function(){function e(){M=g.next(e);J.count+=1;var a=S.viewport,c=S.scissor_box;a[0]=a[1]=c[0]=c[1]=0;J.viewportWidth=J.frameBufferWidth=J.drawingBufferWidth=a[2]=c[2]=t.drawingBufferWidth;J.viewportHeight=J.frameBufferWidth=J.drawingBufferHeight=
a[3]=c[3]=t.drawingBufferHeight;a=b();J.deltaTime=(a-Y)/1E3;J.time=(a-W)/1E3;Y=a;E.procs.refresh();B.poll();for(a=0;a<P.length;++a)(0,P[a])(J,null,0)}function m(a){}function r(a){}function ea(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];k.isDynamic(e)?d[b]=k.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;r.length<a;)r.push(null);return r}var e=b(a.context||{}),g=b(a.uniforms||{}),h=b(a.attributes||{});a=b(function(a){function b(a){if(a in c){var d=
c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=f({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var e=E.compile(a,h,g,e),m=e.draw,p=e.batch,q=e.scope,r=[];return function(a,b){var d;if("function"===typeof a)return q.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)q.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<
a.length;++d)q.call(this,a[d],b,d);else return q.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return m.call(this,a)}}function da(){E.procs.poll()}var R=c(Array.prototype.slice.call(arguments)),t=R.gl,ka=R.options,R=a(),I=u(t).extensions,W=b(),Y=W,G=t.drawingBufferWidth,Z=t.drawingBufferHeight,J={count:0,deltaTime:0,time:0,viewportWidth:G,viewportHeight:Z,framebufferWidth:G,framebufferHeight:Z,
drawingBufferWidth:G,drawingBufferHeight:Z,pixelRatio:ka.pixelRatio},G=H(t,I),Q=V(t),K=y(t,I,Q),Z=h(t,I,G,Q,R),D=w(t,R),B=z(t,I,G,da,J),ba=q(t,I,G),ia=v(t,I,G,B,ba),L=p(t,da,J),E=A(t,R,I,G,Q,K,B,ia,{},Z,D,{elements:null,primitive:4,count:-1,offset:0,instances:-1},J),S=E.next,U=t.canvas,P=[],M=0;U&&(U.addEventListener("webglcontextlost",m,!1),U.addEventListener("webglcontextrestored",r,!1));E.procs.refresh();return f(ea,{clear:function(a){var b=0;da();var c=a.color;c&&(t.clearColor(+c[0]||0,+c[1]||
0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(t.clearDepth(+a.depth),b|=256);"stencil"in a&&(t.clearStencil(a.stencil|0),b|=1024);t.clear(b)},prop:k.define.bind(null,1),context:k.define.bind(null,2),"this":k.define.bind(null,3),draw:ea({}),elements:function(a){return K.create(a)},buffer:function(a){return Q.create(a,34962)},texture:function(a){return B.create(a,3553)},cube:function(a){return 6===arguments.length?B.create(Array.prototype.slice.call(arguments),34067):B.create(a,34067)},renderbuffer:function(a){return ba.create(a)},
framebuffer:function(a){return ia.create(a)},framebufferCube:function(a){},attributes:t.getContextAttributes(),frame:function(a){P.push(a);!M&&0<P.length&&e();return{cancel:function(){var b=P.find(function(b){return b===a});0>b||(P.splice(b,1),0>=P.length&&M&&(g.cancel(e),M=0))}}},limits:G,read:L,destroy:function(){M&&(g.cancel(e),M=0);U&&(U.removeEventListener("webglcontextlost",m),U.removeEventListener("webglcontextrestored",r));D.clear();ia.clear();ba.clear();B.clear();Q.clear();if(ka.onDestroy)ka.onDestroy()},
_gl:t,_refresh:function(){E.procs.refresh()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/strings":17,"./lib/texture":18,"./lib/util/clock":19,"./lib/util/extend":21,"./lib/util/raf":29,"./lib/webgl":33}]},{},[1]);

        </script>
        </body>
      </html>