(function e$$0(p,y,h){function m(a,e){if(!y[a]){if(!p[a]){var g="function"==typeof require&&require;if(!e&&g)return g(a,!0);if(q)return q(a,!0);g=Error("Cannot find module '"+a+"'");throw g.code="MODULE_NOT_FOUND",g;}g=y[a]={exports:{}};p[a][0].call(g.exports,function(g){var e=p[a][1][g];return m(e?e:g)},g,g.exports,e$$0,p,y,h)}return y[a].exports}for(var q="function"==typeof require&&require,g=0;g<h.length;g++)m(h[g]);return m})({1:[function(d,p,y){var h=d("../regl")(),m=h({frag:"\n  precision mediump float;\n  uniform sampler2D texture;\n  uniform vec2 screenShape;\n  uniform float time;\n\n  varying vec2 uv;\n\n  vec4 background () {\n    vec2 pos = 0.5 - gl_FragCoord.xy / screenShape;\n    float r = length(pos);\n    float theta = atan(pos.y, pos.x);\n    return vec4(\n      cos(pos.x * time) + sin(pos.y * pos.x * time),\n      cos(100.0 * r * cos(0.3 * time) + theta),\n      sin(time / r + pos.x * cos(10.0 * time + 3.0)),\n      1);\n  }\n\n  void main () {\n    vec4 color = texture2D(texture, uv);\n    float chromakey = step(0.15 + max(color.r, color.b), color.g);\n    gl_FragColor = mix(color, background(), chromakey);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main () {\n    uv = position;\n    gl_Position = vec4(1.0 - 2.0 * position, 0, 1);\n  }",attributes:{position:[-2,0,0,-2,2,2]},uniforms:{texture:h.prop("video"),screenShape:function(h){return[h.viewportWidth,h.viewportHeight]},time:h.context("time")},count:3});d("resl")({manifest:{video:{type:"video",src:"assets/doggie-chromakey.ogv",stream:!0}},onDone:function(q){var g=q.video;g.autoplay=!0;g.loop=!0;g.play();
var a=h.texture(g);h.frame(function(){h.updateTimer();m({video:a.subimage(g)})})}})},{"../regl":34,resl:33}],2:[function(d,p,y){function h(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}p.exports=function(m,q,g,a,e){m=g.maxAttributes;q=Array(m);for(g=0;g<m;++g)q[g]=new h;return{Record:h,scope:{},state:q}}},{}],3:[function(d,p,y){function h(a){return z[Object.prototype.toString.call(a)]|0}function m(a,
g){for(var e=0;e<g.length;++e)a[e]=g[e]}function q(a,g,e,h,m,q,c){for(var d=0,n=0;n<e;++n)for(var f=0;f<h;++f)a[d++]=g[m*n+q*f+c]}function g(a,g,e){for(var h=0,m=0;m<g.length;++m)for(var q=g[m],c=0;c<e;++c)a[h++]=q[c]}var a=d("./util/is-typed-array"),e=d("./util/is-ndarray"),n=d("./util/values"),F=d("./util/pool"),z=d("./constants/arraytypes.json"),t=d("./constants/dtypes.json"),x=d("./constants/usage.json");p.exports=function(d,p){function A(f){this.id=c++;this.buffer=d.createBuffer();this.type=
f;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121}function w(f,a,g){f.byteLength=a.byteLength;d.bufferData(f.type,a,g)}function I(f,c,d,n,v){f.usage=d;if(Array.isArray(c))f.dtype=n||5126,0<c.length&&(Array.isArray(c[0])?(f.dimension=c[0].length,n=F.allocType(f.dtype,c.length*f.dimension),g(n,c,f.dimension),w(f,n,d),F.freeType(n)):"number"===typeof c[0]?(f.dimension=v,n=F.allocType(f.dtype,c.length),m(n,c),w(f,n,d),F.freeType(n)):a(c[0])&&(f.dimension=c[0].length,f.dtype=n||h(c[0])||
5126,n=F.allocType(f.dtype,c.length*f.dimension),g(n,c,f.dimension),w(f,n,d),F.freeType(n)));else if(a(c))f.dtype=n||h(c),f.dimension=v,w(f,c,d);else if(e(c)){var x=c.shape,r=c.stride;v=c.offset;var C=0,R=0,S=0,G=0;1===x.length?(C=x[0],R=1,S=r[0],G=0):2===x.length&&(C=x[0],R=x[1],S=r[0],G=r[1]);f.dtype=n||h(c.data)||5126;f.dimension=R;n=F.allocType(f.dtype,C*R);q(n,c.data,C,R,S,G,v);w(f,n,d);F.freeType(n)}}function v(a){p.bufferCount--;d.deleteBuffer(a.buffer);a.buffer=null;delete O[a.id]}var c=0,
O={};A.prototype.bind=function(){d.bindBuffer(this.type,this.buffer)};A.prototype.destroy=function(){v(this)};var B=[];return{create:function(f,c,n){function w(f){var c=35044,g=null,h=0,m=0,n=1;Array.isArray(f)||a(f)||e(f)?g=f:"number"===typeof f?h=f|0:f&&("data"in f&&(g=f.data),"usage"in f&&(c=x[f.usage]),"type"in f&&(m=t[f.type]),"dimension"in f&&(n=f.dimension|0),"length"in f&&(h=f.length|0));B.bind();g?I(B,g,c,m,n):(d.bufferData(B.type,h,c),B.dtype=m||5121,B.usage=c,B.dimension=n,B.byteLength=
h);return w}p.bufferCount++;var B=new A(c);O[B.id]=B;n||w(f);w._reglType="buffer";w._buffer=B;w.subdata=function(f,c){var n=(c||0)|0;B.bind();if(Array.isArray(f)){if(0<f.length)if("number"===typeof f[0]){var v=F.allocType(B.dtype,f.length);m(v,f);d.bufferSubData(B.type,n,v);F.freeType(v)}else if(Array.isArray(f[0])||a(f[0])){var v=f[0].length,x=F.allocType(B.dtype,f.length*v);g(x,f,v);d.bufferSubData(B.type,n,x);F.freeType(x)}}else if(a(f))d.bufferSubData(B.type,n,f);else if(e(f)){var G=f.shape,A=
f.stride,p=x=v=0,L=0;1===G.length?(v=G[0],x=1,p=A[0],L=0):2===G.length&&(v=G[0],x=G[1],p=A[0],L=A[1]);G=Array.isArray(f.data)?B.dtype:h(f.data);G=F.allocType(G,v*x);q(G,f.data,v,x,p,L,f.offset);d.bufferSubData(B.type,n,G);F.freeType(G)}return w};w.destroy=function(){v(B)};return w},createStream:function(f,a){var c=B.pop();c||(c=new A(f),c.buffer=d.createBuffer());c.bind();I(c,a,35040,0,1);return c},destroyStream:function(f){B.push(f)},clear:function(){n(O).forEach(v)},getBuffer:function(f){return f&&
f._buffer instanceof A?f._buffer:null},_initBuffer:I}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],4:[function(d,p,y){p.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,
"[object ArrayBuffer]":5121}},{}],5:[function(d,p,y){p.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(d,p,y){p.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(d,p,y){p.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(d,p,y){function h(a){return Array.isArray(a)||z(a)||t(a)}function m(a){return a.sort(function(f,
a){return"viewport"===f?-1:"viewport"===a?1:f<a?-1:1})}function q(a,f,c,g){this.thisDep=a;this.contextDep=f;this.propDep=c;this.append=g}function g(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function a(a){return new q(!1,!1,!1,a)}function e(a,f){var c=a.type;return 0===c?(c=a.data.length,new q(!0,1<=c,2<=c,f)):new q(3===c,2===c,1===c,f)}var n=d("./util/codegen"),F=d("./util/loop"),z=d("./util/is-typed-array"),t=d("./util/is-ndarray"),x=d("./util/is-array-like"),K=d("./constants/primitives.json"),
M=d("./constants/dtypes.json"),A=["x","y","z","w"],w={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},I={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,
"!=":517,"!==":517,gequal:518,">=":518,always:519},v={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},c={cw:2304,ccw:2305},O=new q(!1,!1,!1,function(){});p.exports=function(d,f,p,L,t,z,y,r,C,R,S,G,fa,la){function T(l){return l.replace(".","_")}function P(l,b,f){var a=T(l);za.push(l);xa[a]=u[a]=!!f;oa[a]=b}function J(l,b,f){var a=T(l);za.push(l);Array.isArray(f)?(u[a]=f.slice(),xa[a]=f.slice()):u[a]=xa[a]=f;pa[a]=b}function X(){var l=
n(),b=l.link,a=l.global;l.id=Ja++;l.batchId="0";var c=b(Ha),E=l.shared={props:"a0"};Object.keys(Ha).forEach(function(k){E[k]=a.def(c,".",k)});var H=l.next={},g=l.current={};Object.keys(pa).forEach(function(k){Array.isArray(u[k])&&(H[k]=a.def(E.next,".",k),g[k]=a.def(E.current,".",k))});var k=l.constants={};Object.keys(Aa).forEach(function(l){k[l]=a.def(JSON.stringify(Aa[l]))});l.invoke=function(k,a){switch(a.type){case 0:var f=["this",E.context,E.props,l.batchId];return k.def(b(a.data),".call(",f.slice(0,
Math.max(a.data.length+1,4)),")");case 1:return k.def(E.props,a.data);case 2:return k.def(E.context,a.data);case 3:return k.def("this",a.data)}};l.attribCache={};var Fa={};l.scopeAttrib=function(k){k=f.id(k);if(k in Fa)return Fa[k];var l=R.scope[k];l||(l=R.scope[k]=new ma);return Fa[k]=b(l)};return l}function ia(l){var b=l["static"];l=l.dynamic;if("framebuffer"in b){var f=b.framebuffer;return f?(f=r.getFramebuffer(f),a(function(l,b){var a=l.link(f),k=l.shared;b.set(k.framebuffer,".next",a);k=k.context;
b.set(k,".framebufferWidth",a+".width");b.set(k,".framebufferHeight",a+".height");return a})):a(function(l,b){var a=l.shared;b.set(a.framebuffer,".next","null");a=a.context;b.set(a,".framebufferWidth",a+".drawingBufferWidth");b.set(a,".framebufferHeight",a+".drawingBufferHeight");return"null"})}if("framebuffer"in l){var c=l.framebuffer;return e(c,function(l,b){var a=l.invoke(b,c),k=l.shared,f=k.framebuffer,a=b.def(f,".getFramebuffer(",a,")");b.set(f,".next",a);k=k.context;b.set(k,".framebufferWidth",
a+"?"+a+".width:"+k+".drawingBufferWidth");b.set(k,".framebufferHeight",a+"?"+a+".height:"+k+".drawingBufferHeight");return a})}return null}function qa(l,b){function a(k){if(k in f){var l=f[k];k=!0;var Ia=l.x|0,H=l.y|0,g,V;"width"in l?g=l.width|0:k=!1;"height"in l?V=l.height|0:k=!1;return new q(!k&&b&&b.thisDep,!k&&b&&b.contextDep,!k&&b&&b.propDep,function(k,b){var a=k.shared.context,f=g;"width"in l||(f=b.def(a,".","framebufferWidth","-",Ia));var c=V;"height"in l||(c=b.def(a,".","framebufferHeight",
"-",H));return[Ia,H,f,c]})}if(k in c){var h=c[k];k=e(h,function(k,b){var l=k.invoke(b,h),a=k.shared.context,f=b.def(l,".x|0"),c=b.def(l,".y|0"),N=b.def('"width" in ',l,"?",l,".width|0:","(",a,".","framebufferWidth","-",f,")"),l=b.def('"height" in ',l,"?",l,".height|0:","(",a,".","framebufferHeight","-",c,")");return[f,c,N,l]});b&&(k.thisDep=k.thisDep||b.thisDep,k.contextDep=k.contextDep||b.contextDep,k.propDep=k.propDep||b.propDep);return k}return b?new q(b.thisDep,b.contextDep,b.propDep,function(k,
b){var l=k.shared.context;return[0,0,b.def(l,".","framebufferWidth"),b.def(l,".","framebufferHeight")]}):null}var f=l["static"],c=l.dynamic,H=a("viewport");if(H)var g=H,H=new q(H.thisDep,H.contextDep,H.propDep,function(k,b){var l=g.append(k,b),a=k.shared.context;b.set(a,".viewportWidth",l[2]);b.set(a,".viewportHeight",l[3]);return l});return{viewport:H,scissor_box:a("scissor.box")}}function sa(b){function c(k){if(k in V){var b=f.id(V[k]);k=a(function(){return b});k.id=b;return k}if(k in h){var l=
h[k];return e(l,function(k,b){var a=k.invoke(b,l);return b.def(k.shared.strings,".id(",a,")")})}return null}var V=b["static"],h=b.dynamic,E=c("frag"),H=c("vert"),u=null;g(E)&&g(H)?(u=S.program(H.id,E.id),b=a(function(k,b){return k.link(u)})):b=new q(E&&E.thisDep||H&&H.thisDep,E&&E.contextDep||H&&H.contextDep,E&&E.propDep||H&&H.propDep,function(k,b){var l=k.shared.shader,a;a=E?E.append(k,b):b.def(l,".","frag");var f;f=H?H.append(k,b):b.def(l,".","vert");return b.def(l+".program("+f+","+a+")")});return{frag:E,
vert:H,progVar:b,program:u}}function ja(b){function f(b,k){if(b in c){var l=c[b]|0;return a(function(b,a){k&&(b.OFFSET=l);return l})}if(b in u){var N=u[b];return e(N,function(b,l){var a=b.invoke(l,N);k&&(b.OFFSET=a);return a})}return k&&E?a(function(b,k){b.OFFSET="0";return 0}):null}var c=b["static"],u=b.dynamic,E=function(){if("elements"in c){var b=c.elements;h(b)?b=z.getElements(z.create(b)):b&&(b=z.getElements(b));var k=a(function(k,l){if(b){var a=k.link(b);return k.ELEMENTS=a}return k.ELEMENTS=
null});k.value=b;return k}if("elements"in u){var l=u.elements;return e(l,function(b,k){var a=b.shared,f=a.isBufferArgs,a=a.elements,c=b.invoke(k,l),N=k.def("null"),f=k.def(f,"(",c,")"),c=b.cond(f).then(N,"=",a,".createStream(",c,");")["else"](N,"=",a,".getElements(",c,");");k.entry(c);k.exit(b.cond(f).then(a,".destroyStream(",N,");"));return b.ELEMENTS=N})}return null}(),H=f("offset",!0);return{elements:E,primitive:function(){if("primitive"in c){var b=c.primitive;return a(function(k,l){return K[b]})}if("primitive"in
u){var k=u.primitive;return e(k,function(b,l){var a=b.constants.primTypes,f=b.invoke(l,k);return l.def(a,"[",f,"]")})}return E?g(E)?E.value?a(function(b,k){return k.def(b.ELEMENTS,".primType")}):a(function(){return 4}):new q(E.thisDep,E.contextDep,E.propDep,function(b,k){var l=b.ELEMENTS;return k.def(l,"?",l,".primType:",4)}):null}(),count:function(){if("count"in c){var b=c.count|0;return a(function(){return b})}if("count"in u){var k=u.count;return e(k,function(b,l){return b.invoke(l,k)})}return E?
g(E)?E?H?new q(H.thisDep,H.contextDep,H.propDep,function(b,k){return k.def(b.ELEMENTS,".vertCount-",b.OFFSET)}):a(function(b,k){return k.def(b.ELEMENTS,".vertCount")}):a(function(){return-1}):new q(E.thisDep||H.thisDep,E.contextDep||H.contextDep,E.propDep||H.propDep,function(b,k){var l=b.ELEMENTS;return b.OFFSET?k.def(l,"?",l,".vertCount-",b.OFFSET,":-1"):k.def(l,"?",l,".vertCount:-1")}):null}(),instances:f("instances",!1),offset:H}}function ra(b){var f=b["static"],g=b.dynamic,u={};za.forEach(function(b){function l(k,
c){if(b in f){var H=k(f[b]);u[h]=a(function(){return H})}else if(b in g){var m=g[b];u[h]=e(m,function(b,k){return c(b,k,b.invoke(k,m))})}}var h=T(b);switch(b){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return l(function(b){return b},function(b,l,a){return a});case "depth.func":return l(function(b){return I[b]},function(b,l,a){return l.def(b.constants.compareFuncs,
"[",a,"]")});case "depth.range":return l(function(b){return b},function(b,l,a){b=l.def("+",a,"[0]");l=l.def("+",a,"[1]");return[b,l]});case "blend.func":return l(function(b){return[w["srcRGB"in b?b.srcRGB:b.src],w["dstRGB"in b?b.dstRGB:b.dst],w["srcAlpha"in b?b.srcAlpha:b.src],w["dstAlpha"in b?b.dstAlpha:b.dst]]},function(b,l,a){function f(b,k){var N=l.def('"',b,k,'" in ',a,"?",a,".",b,k,":",a,".",b);return l.def(c,"[",N,"]")}var c=b.constants.blendFuncs;b=f("src","RGB");var N=f("src","Alpha"),g=
f("dst","RGB"),H=f("dst","Alpha");return[b,g,N,H]});case "blend.equation":return l(function(b){if("string"===typeof b)return[aa[b],aa[b]];if("object"===typeof b)return[aa[b.rgb],aa[b.alpha]]},function(b,l,a){var f=b.constants.blendEquations,c=l.def(),N=l.def();b=b.cond("typeof ",a,'==="string"');b.then(c,"=",N,"=",f,"[",a,"];");b["else"](c,"=",f,"[",a,".rgb];",N,"=",f,"[",a,".alpha];");l(b);return[c,N]});case "blend.color":return l(function(b){return F(4,function(l){return+b[l]})},function(b,l,a){return F(4,
function(b){return l.def("+",a,"[",b,"]")})});case "stencil.mask":return l(function(b){return b|0},function(b,l,a){return l.def(a,"|0")});case "stencil.func":return l(function(b){return[I[b.cmp||"keep"],b.ref||0,"mask"in b?b.mask:-1]},function(b,l,a){b=l.def('"cmp" in ',a,"?",b.constants.compareFuncs,"[",a,".cmp]",":",7680);var f=l.def(a,".ref|0");l=l.def('"mask" in ',a,"?",a,".mask|0:-1");return[b,f,l]});case "stencil.opFront":case "stencil.opBack":return l(function(l){return["stencil.opBack"===
b?1029:1028,v[l.fail||"keep"],v[l.zfail||"keep"],v[l.pass||"keep"]]},function(l,a,f){function c(b){return a.def('"',b,'" in ',f,"?",N,"[",f,".",b,"]:",7680)}var N=l.constants.stencilOps;return["stencil.opBack"===b?1029:1028,c("fail"),c("zfail"),c("pass")]});case "polygonOffset.offset":return l(function(b){return[b.factor|0,b.units|0]},function(b,l,a){b=l.def(a,".factor|0");l=l.def(a,".units|0");return[b,l]});case "cull.face":return l(function(b){var l=0;"front"===b?l=1028:"back"===b&&(l=1029);return l},
function(b,l,a){return l.def(a,'==="front"?',1028,":",1029)});case "lineWidth":return l(function(b){return b},function(b,l,a){return a});case "frontFace":return l(function(b){return c[b]},function(b,l,a){return l.def(a+'==="cw"?2304:2305')});case "colorMask":return l(function(b){return b.map(function(b){return!!b})},function(b,l,a){return F(4,function(b){return"!!"+a+"["+b+"]"})});case "sample.coverage":return l(function(b){return["value"in b?b.value:1,!!b.invert]},function(b,l,a){b=l.def('"value" in ',
a,"?+",a,".value:1");l=l.def("!!",a,".invert");return[b,l]})}});return u}function na(b){var f=b["static"],c=b.dynamic,g={};Object.keys(f).forEach(function(b){var l=f[b],c;"number"===typeof l||"boolean"===typeof l?c=a(function(){return l}):"function"!==typeof l||"texture2d"!==l._reglType&&"textureCube"!==l._reglType?x(l)&&(c=a(function(b){return b.global.def("[",F(l.length,function(b){return l[b]}),"]")})):c=a(function(b){return b.link(l)});c.value=l;g[b]=c});Object.keys(c).forEach(function(b){var l=
c[b];g[b]=e(l,function(b,a){return b.invoke(a,l)})});return g}function Y(b){var c=b["static"],g=b.dynamic,u={};Object.keys(c).forEach(function(b){var l=c[b],g=f.id(b),k=new ma;if(h(l))k.state=1,k.buffer=t.getBuffer(t.create(l,34962,!1)),k.type=k.buffer.dtype;else{var e=t.getBuffer(l);if(e)k.state=1,k.buffer=e,k.type=e.dtype;else if(l.constant){var m=l.constant;k.state=2;"number"===typeof m?k.x=m:A.forEach(function(b,l){l<m.length&&(k[b]=m[l])})}else{var e=t.getBuffer(l.buffer),V=l.offset|0,D=l.stride|
0,r=l.size|0,n=!!l.normalized,d=0;"type"in l&&(d=M[l.type]);l=l.divisor|0;k.buffer=e;k.state=1;k.size=r;k.normalized=n;k.type=d||e.dtype;k.offset=V;k.stride=D;k.divisor=l}}u[b]=a(function(b,l){var a=b.attribCache;if(g in a)return a[g];var f={isStream:!1};Object.keys(k).forEach(function(b){f[b]=k[b]});k.buffer&&(f.buffer=b.link(k.buffer));return a[g]=f})});Object.keys(g).forEach(function(b){var l=g[b];u[b]=e(l,function(b,a){function f(b){a(e[b],"=",c,".",b,"|0;")}var c=b.invoke(a,l),N=b.shared,g=N.isBufferArgs,
u=N.buffer,e={isStream:a.def(!1)},h=new ma;h.state=1;Object.keys(h).forEach(function(b){e[b]=a.def(""+h[b])});var m=e.buffer,V=e.type;a("if(",g,"(",c,")){",e.isStream,"=true;",m,"=",u,".createStream(",34962,",",c,");",V,"=",m,".dtype;","}else{",m,"=",u,".getBuffer(",c,");","if(",m,"){",V,"=",m,".dtype;","}else if(",c,".constant){",e.state,"=",2,";",A.map(function(b,l){return e[b]+"="+c+".length>="+l+"?"+c+"["+l+"]:0;"}).join(""),"}else{",m,"=",u,".getBuffer(",c,".buffer);",V,'="type" in ',c,"?",N.glTypes,
"[",c,".type]:",m,".dtype;",e.normalized,"=!!",c,".normalized;");f("size");f("offset");f("stride");f("divisor");a("}}");return e})});return u}function ga(b){var f=b["static"],c=b.dynamic,g={};Object.keys(f).forEach(function(b){var l=f[b];g[b]=a(function(b,a){return"number"===typeof l||"boolean"===typeof l?""+l:b.link(l)})});Object.keys(c).forEach(function(b){var l=c[b];g[b]=e(l,function(b,a){return b.invoke(a,l)})});return g}function Z(b,a,f){var c=b.shared.context,g=b.scope();Object.keys(f).forEach(function(e){a.save(c,
"."+e);g(c,".",e,"=",f[e].append(b,a),";")});a(g)}function U(b,a,f){var c=b.shared,g=c.gl,e=c.framebuffer,u;D&&(u=a.def(c.extensions,".webgl_draw_buffers"));var k=b.constants,c=k.drawBuffer,k=k.backBuffer;b=f?f.append(b,a):a.def(e,".next");a("if(",e,".dirty||",b,"!==",e,".cur){","if(",b,"){",g,".bindFramebuffer(",36160,",",b,".framebuffer);");D&&a(u,".drawBuffersWEBGL(",c,"[",b,".colorAttachments.length]);");a("}else{",g,".bindFramebuffer(",36160,",null);");D&&a(u,".drawBuffersWEBGL(",k,");");a("}",
e,".cur=",b,";",e,".dirty=false;","}")}function W(b,a,f){var c=b.shared,g=c.gl,e=b.current,h=b.next,k=c.current,m=c.next,D=b.cond(k,".dirty");za.forEach(function(a){a=T(a);if(!(a in f.state)){var c,N;if(a in h){c=h[a];N=e[a];var r=F(u[a].length,function(b){return D.def(c,"[",b,"]")});D(b.cond(r.map(function(b,l){return b+"!=="+N+"["+l+"]"}).join("||")).then(g,".",pa[a],"(",r,");",r.map(function(b,l){return N+"["+l+"]="+b}).join(";"),";"))}else c=D.def(m,".",a),r=b.cond(c,"!==",k,".",a),D(r),a in oa?
r(b.cond(c).then(g,".enable(",oa[a],");")["else"](g,".disable(",oa[a],");"),k,".",a,"=",c,";"):r(g,".",pa[a],"(",c,");",k,".",a,"=",c,";")}});0===Object.keys(f.state).length&&D(k,".dirty=false;");a(D)}function ba(b,a,f,c){var e=b.shared,u=b.current,h=e.current,k=e.gl;m(Object.keys(f)).forEach(function(e){var m=f[e];if(!c||c(m)){var D=m.append(b,a);if(oa[e]){var r=oa[e];g(m)?D?a(k,".enable(",r,");"):a(k,".disable(",r,");"):a(b.cond(D).then(k,".enable(",r,");")["else"](k,".disable(",r,");"));a(h,".",
e,"=",D,";")}else if(x(D)){var n=u[e];a(k,".",pa[e],"(",D,");",D.map(function(b,l){return n+"["+l+"]="+b}).join(";"),";")}else a(k,".",pa[e],"(",D,");",h,".",e,"=",D,";")}})}function ta(l,a){b&&!l.instancing&&(l.instancing=a.def(l.shared.extensions,".angle_instanced_arrays"))}function Ba(b,a,f){f=b.stats;b=b.shared;la&&a(b.timer,".beginQuery(",f,");")}function ka(b,a,f){b=b.shared;la&&a(b.timer,".endQuery();")}function ca(a,f,c,g,e){function u(b){switch(b){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function h(c,g,e){function u(){f("if(!",n,".pointer){",D,".enableVertexAttribArray(",r,");",n,".pointer=true;}");var c=e.type,k;k=e.size?f.def(e.size,"||",g):g;f("if(",n,".type!==",c,"||",n,".size!==",k,"||",E.map(function(b){return n+"."+b+"!=="+e[b]}).join("||"),"){",D,".bindBuffer(",34962,",",d,".buffer);",D,".vertexAttribPointer(",[r,k,c,e.normalized,e.stride,e.offset],");",n,".type=",c,";",n,
".size=",k,";",E.map(function(b){return n+"."+b+"="+e[b]+";"}).join(""),"}");b&&(c=e.divisor,f("if(",n,".divisor!==",c,"){",a.instancing,".vertexAttribDivisorANGLE(",[r,c],");",n,".divisor=",c,";}"))}function m(){f("if(",n,".pointer){",D,".disableVertexAttribArray(",r,");",n,".pointer=false;","}if(",A.map(function(b,a){return n+"."+b+"!=="+V[a]}).join("||"),"){",D,".vertexAttrib4f(",r,",",V,");",A.map(function(b,a){return n+"."+b+"="+V[a]+";"}).join(""),"}")}var D=k.gl,r=f.def(c,".location"),n=f.def(k.attributes,
"[",r,"]");c=e.state;var d=e.buffer,V=[e.x,e.y,e.z,e.w],E=["buffer","normalized","offset","stride"];1===c?u():2===c?m():(f("if(",c,"===",1,"){"),u(),f("}else{"),m(),f("}"))}var k=a.shared;g.forEach(function(b){var k=b.name,g=c.attributes[k],m;if(g){if(!e(g))return;m=g.append(a,f)}else{if(!e(O))return;var D=a.scopeAttrib(k);m={};Object.keys(new ma).forEach(function(b){m[b]=f.def(D,".",b)})}h(a.link(b),u(b.info.type),m)})}function da(b,a,c,e,u){for(var m=b.shared,h=m.gl,k,D=0;D<e.length;++D){var r=
e[D],n=r.name,d=r.info.type,q=c.uniforms[n],r=b.link(r)+".location",v;if(q){if(!u(q))continue;if(g(q)){n=q.value;if(35678===d||35680===d)d=b.link(n._texture),a(h,".uniform1i(",r,",",d+".bind());"),a.exit(d,".unbind();");else if(35674===d||35675===d||35676===d)n=b.global.def("new Float32Array(["+Array.prototype.slice.call(n)+"])"),q=2,35675===d?q=3:35676===d&&(q=4),a(h,".uniformMatrix",q,"fv(",r,",false,",n,");");else{switch(d){case 5126:k="1f";break;case 35664:k="2f";break;case 35665:k="3f";break;
case 35666:k="4f";break;case 35670:k="1i";break;case 5124:k="1i";break;case 35671:k="2i";break;case 35667:k="2i";break;case 35672:k="3i";break;case 35668:k="3i";break;case 35673:k="4i";break;case 35669:k="4i"}a(h,".uniform",k,"(",r,",",x(n)?Array.prototype.slice.call(n):n,");")}continue}else v=q.append(b,a)}else{if(!u(O))continue;v=a.def(m.uniforms,"[",f.id(n),"]")}n=1;switch(d){case 35678:case 35680:d=a.def(v,"._texture");a(h,".uniform1i(",r,",",d,".bind());");a.exit(d,".unbind();");continue;case 5124:case 35670:k=
"1i";break;case 35667:case 35671:k="2i";n=2;break;case 35668:case 35672:k="3i";n=3;break;case 35669:case 35673:k="4i";n=4;break;case 5126:k="1f";break;case 35664:k="2f";n=2;break;case 35665:k="3f";n=3;break;case 35666:k="4f";n=4;break;case 35674:k="Matrix2fv";break;case 35675:k="Matrix3fv";break;case 35676:k="Matrix4fv"}a(h,".uniform",k,"(",r,",");if("M"===k.charAt(0)){var r=Math.pow(d-35674+2,2),w=b.global.def("new Float32Array(",r,")");a("false,(Array.isArray(",v,")||",v," instanceof Float32Array)?",
v,":(",F(r,function(b){return w+"["+b+"]="+v+"["+b+"]"}),",",w,")")}else 1<n?a(F(n,function(b){return v+"["+b+"]"})):a(v);a(");")}}function ya(a,f,c,e){function u(b){var k=D[b];return k?k.contextDep&&e.contextDynamic||k.propDep?k.append(a,c):k.append(a,f):f.def(r,".",b)}function h(){function b(){c(G,".drawElementsInstancedANGLE(",[q,w,A,v+"<<(("+A+"-5121)>>1)",x],");")}function a(){c(G,".drawArraysInstancedANGLE(",[q,v,w,x],");")}d?p?b():(c("if(",d,"){"),b(),c("}else{"),a(),c("}")):a()}function m(){function b(){c(n+
".drawElements("+[q,w,A,v+"<<(("+A+"-5121)>>1)"]+");")}function a(){c(n+".drawArrays("+[q,v,w]+");")}d?p?b():(c("if(",d,"){"),b(),c("}else{"),a(),c("}")):a()}var k=a.shared,n=k.gl,r=k.draw,D=e.draw,d=function(){var b=D.elements,k=f;if(b){if(b.contextDep&&e.contextDynamic||b.propDep)k=c;b=b.append(a,k)}else b=k.def(r,".","elements");b&&k("if("+b+")"+n+".bindBuffer(34963,"+b+".buffer.buffer);");return b}(),q=u("primitive"),v=u("offset"),w=function(){var b=D.count,k=f;if(b){if(b.contextDep&&e.contextDynamic||
b.propDep)k=c;b=b.append(a,k)}else b=k.def(r,".","count");return b}();if("number"===typeof w){if(0===w)return}else c("if(",w,"){"),c.exit("}");var x,G;b&&(x=u("instances"),G=a.instancing);var A=d+".type",p=D.elements&&g(D.elements);b&&("number"!==typeof x||0<=x)?"string"===typeof x?(c("if(",x,">0){"),h(),c("}else if(",x,"<0){"),m(),c("}")):h():m()}function va(a,c,f,e,g){c=X();g=c.proc("body",g);b&&(c.instancing=g.def(c.shared.extensions,".angle_instanced_arrays"));a(c,g,f,e);return c.compile().body}
function Ca(b,a,c,f){ta(b,a);ca(b,a,c,f.attributes,function(){return!0});da(b,a,c,f.uniforms,function(){return!0});ya(b,a,a,c)}function Da(b,a){var c=b.proc("draw",1);ta(b,c);Z(b,c,a.context);U(b,c,a.framebuffer);W(b,c,a);ba(b,c,a.state);Ba(b,c,a);var f=a.shader.progVar.append(b,c);c(b.shared.gl,".useProgram(",f,".program);");if(a.shader.program)Ca(b,c,a,a.shader.program);else{var e=b.global.def("{}"),g=c.def(f,".id"),u=c.def(e,"[",g,"]");c(b.cond(u).then(u,".call(this,a0);")["else"](u,"=",e,"[",
g,"]=",b.link(function(c){return va(Ca,b,a,c,1)}),"(",f,");",u,".call(this,a0);"))}0<Object.keys(a.state).length&&c(b.shared.current,".dirty=true;");ka(b,c,a)}function Ea(b,a,c,f){function e(){return!0}b.batchId="a1";ta(b,a);ca(b,a,c,f.attributes,e);da(b,a,c,f.uniforms,e);ya(b,a,a,c)}function ua(b,a,c,f){function e(b){return b.contextDep&&u||b.propDep}function g(b){return!e(b)}ta(b,a);var u=c.contextDep,k=a.def(),h=a.def();b.shared.props=h;b.batchId=k;var m=b.scope(),n=b.scope();a(m.entry,"for(",
k,"=0;",k,"<","a1",";++",k,"){",h,"=","a0","[",k,"];",n,"}",m.exit);c.needsContext&&Z(b,n,c.context);c.needsFramebuffer&&U(b,n,c.framebuffer);ba(b,n,c.state,e);f?(ca(b,m,c,f.attributes,g),ca(b,n,c,f.attributes,e),da(b,m,c,f.uniforms,g),da(b,n,c,f.uniforms,e),ya(b,m,n,c)):(a=b.global.def("{}"),f=c.shader.progVar.append(b,n),h=n.def(f,".id"),m=n.def(a,"[",h,"]"),n(b.shared.gl,".useProgram(",f,".program);","if(!",m,"){",m,"=",a,"[",h,"]=",b.link(function(a){return va(Ea,b,c,a,2)}),"(",f,");}",m,".call(this,a0[",
k,"],",k,");"))}function Ga(b,a){var c=b.proc("batch",2);b.batchId="0";ta(b,c);var f=!1,e=!0;Object.keys(a.context).forEach(function(b){f=f||a.context[b].propDep});f||(Z(b,c,a.context),e=!1);var g=a.framebuffer,u=!1;g?(g.propDep?f=u=!0:g.contextDep&&f&&(u=!0),u||U(b,c,g)):U(b,c,null);a.state.viewport&&a.state.viewport.propDep&&(f=!0);W(b,c,a);ba(b,c,a.state,function(b){return!(b.contextDep&&f||b.propDep)});Ba(b,c,a);a.contextDep=f;a.needsContext=e;a.needsFramebuffer=u;e=a.shader.progVar;if(e.contextDep&&
f||e.propDep)ua(b,c,a,null);else if(e=e.append(b,c),c(b.shared.gl,".useProgram(",e,".program);"),a.shader.program)ua(b,c,a,a.shader.program);else{var g=b.global.def("{}"),u=c.def(e,".id"),k=c.def(g,"[",u,"]");c(b.cond(k).then(k,".call(this,a0,a1);")["else"](k,"=",g,"[",u,"]=",b.link(function(c){return va(ua,b,a,c,2)}),"(",e,");",k,".call(this,a0,a1);"))}0<Object.keys(a.state).length&&c(b.shared.current,".dirty=true;");ka(b,c,a)}function wa(b,a){function c(f){var k=a.shader[f];k&&e.set(g.shader,"."+
f,k.append(b,e))}var e=b.proc("scope",3);b.batchId="a2";var g=b.shared,u=g.current,h=g.timer,k;la&&(k=e.def(h,".getNumPendingQueries()"));Z(b,e,a.context);a.framebuffer&&a.framebuffer.append(b,e);m(Object.keys(a.state)).forEach(function(c){var f=a.state[c].append(b,e);x(f)?f.forEach(function(a,f){e.set(b.next[c],"["+f+"]",a)}):e.set(g.next,"."+c,f)});["elements","offset","count","instances","primitive"].forEach(function(c){var f=a.draw[c];f&&e.set(g.draw,"."+c,""+f.append(b,e))});Object.keys(a.uniforms).forEach(function(c){e.set(g.uniforms,
"["+f.id(c)+"]",a.uniforms[c].append(b,e))});Object.keys(a.attributes).forEach(function(c){var f=a.attributes[c].append(b,e),k=b.scopeAttrib(c);Object.keys(new ma).forEach(function(b){e.set(k,"."+b,f[b])})});c("vert");c("frag");0<Object.keys(a.state).length&&(e(u,".dirty=true;"),e.exit(u,".dirty=true;"));e("a1(",b.shared.context,",a0,0);");if(la){var n=b.stats,u=e.def(h,".getNumPendingQueries()-1");e(h,".pushScopeStats(",k,",",u,",",n,");")}}var ma=R.Record,aa={add:32774,subtract:32778,"reverse subtract":32779};
p.ext_blend_minmax&&(aa.min=32775,aa.max=32776);var b=p.angle_instanced_arrays,D=p.webgl_draw_buffers,u={dirty:!0},xa={},za=[],oa={},pa={};P("dither",3024);P("blend.enable",3042);J("blend.color","blendColor",[0,0,0,0]);J("blend.equation","blendEquationSeparate",[32774,32774]);J("blend.func","blendFuncSeparate",[1,0,1,0]);P("depth.enable",2929,!0);J("depth.func","depthFunc",513);J("depth.range","depthRange",[0,1]);J("depth.mask","depthMask",!0);J("colorMask","colorMask",[!0,!0,!0,!0]);P("cull.enable",
2884);J("cull.face","cullFace",1029);J("frontFace","frontFace",2305);J("lineWidth","lineWidth",1);P("polygonOffset.enable",32823);J("polygonOffset.offset","polygonOffset",[0,0]);P("sample.alpha",32926);P("sample.enable",32928);J("sample.coverage","sampleCoverage",[1,!1]);P("stencil.enable",2960);J("stencil.mask","stencilMask",-1);J("stencil.func","stencilFunc",[519,0,-1]);J("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);J("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);P("scissor.enable",
3089);J("scissor.box","scissor",[0,0,d.drawingBufferWidth,d.drawingBufferHeight]);J("viewport","viewport",[0,0,d.drawingBufferWidth,d.drawingBufferHeight]);var Ha={gl:d,context:fa,strings:f,next:xa,current:u,draw:G,elements:z,buffer:t,shader:S,attributes:R.state,uniforms:C,framebuffer:r,extensions:p,timer:la,isBufferArgs:h},Aa={primTypes:K,compareFuncs:I,blendFuncs:w,blendEquations:aa,stencilOps:v,glTypes:M,orientationType:c};D&&(Aa.backBuffer=[1029],Aa.drawBuffer=F(L.maxDrawbuffers,function(b){return 0===
b?[0]:F(b,function(b){return 36064+b})}));var Ja=0;return{next:xa,current:u,procs:function(){var b=X(),a=b.proc("poll"),c=b.proc("refresh"),f=b.block();a(f);c(f);var e=b.shared,g=e.gl,h=e.next,k=e.current;f(k,".dirty=false;");U(b,a);c(e.framebuffer,".dirty=true;");U(b,c);Object.keys(oa).forEach(function(e){var u=oa[e],m=f.def(h,".",e),n=b.block();n("if(",m,"){",g,".enable(",u,")}else{",g,".disable(",u,")}",k,".",e,"=",m,";");c(n);a("if(",m,"!==",k,".",e,"){",n,"}")});Object.keys(pa).forEach(function(e){var m=
pa[e],n=u[e],r,D,d=b.block();d(g,".",m,"(");x(n)?(m=n.length,r=b.global.def(h,".",e),D=b.global.def(k,".",e),d(F(m,function(b){return r+"["+b+"]"}),");",F(m,function(b){return D+"["+b+"]="+r+"["+b+"];"}).join("")),a("if(",F(m,function(b){return r+"["+b+"]!=="+D+"["+b+"]"}).join("||"),"){",d,"}")):(r=f.def(h,".",e),D=f.def(k,".",e),d(r,");",k,".",e,"=",r,";"),a("if(",r,"!==",D,"){",d,"}"));c(d)});return b.compile()}(),compile:function(b,a,c,f,e){var g=X();g.stats=g.link(e);e=ia(b);var u=qa(b,e),k=
ja(b),m=ra(b);b=sa(b);var n=u.viewport;n&&(m.viewport=n);n=T("scissor.box");(u=u[n])&&(m[n]=u);u=0<Object.keys(m).length;e={framebuffer:e,draw:k,shader:b,state:m,dirty:u};e.uniforms=na(c);e.attributes=Y(a);e.context=ga(f);Da(g,e);wa(g,e);Ga(g,e);return g.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],9:[function(d,p,y){function h(a,e){this.id=g++;this.type=
a;this.data=e}function m(a){if(0===a.length)return[];var e=a.charAt(0),g=a.charAt(a.length-1);if(1<a.length&&e===g&&('"'===e||"'"===e))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(e=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return m(a.substr(0,e.index)).concat(m(e[1])).concat(m(a.substr(e.index+e[0].length)));e=a.split(".");if(1===e.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(g=0;g<e.length;++g)a=a.concat(m(e[g]));return a}
function q(a){return"["+m(a).join("][")+"]"}var g=0;p.exports={define:function(a,e){switch(typeof e){case "boolean":case "number":case "string":return new h(a,q(e+""));case "undefined":return new h(a|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof h},unbox:function(a,e){if(a instanceof h){if(a.type&128)return new h(a.type&-129,q(e))}else if("function"===typeof a)return new h(0,a);return a},accessor:q}},{}],10:[function(d,p,y){var h=d("./util/is-typed-array"),
m=d("./util/is-ndarray"),q=d("./util/values"),g=d("./constants/primitives.json"),a=d("./constants/usage.json");p.exports=function(e,n,d,p){function t(a){this.id=A++;M[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function x(a,c,e,g,f,q,x){(q=x)||h(c)&&(!m(c)||h(c.data))||(q=n.oes_element_index_uint?5125:5123);a.buffer.bind();d._initBuffer(a.buffer,c,e,q,3);c=x;if(!x){switch(a.buffer.dtype){case 5121:case 5120:c=5121;break;case 5123:case 5122:c=5123;break;case 5125:case 5124:c=
5125}a.buffer.dtype=c}a.type=c;0>f&&(f=a.buffer.byteLength,5123===c?f>>=1:5125===c&&(f>>=2));a.vertCount=f;f=g;0>g&&(f=4,g=a.buffer.dimension,1===g&&(f=0),2===g&&(f=1),3===g&&(f=4));a.primType=f}function K(a){p.elementsCount--;delete M[a.id];a.buffer.destroy();a.buffer=null}var M={},A=0,w={uint8:5121,uint16:5123};n.oes_element_index_uint&&(w.uint32=5125);t.prototype.bind=function(){this.buffer.bind()};var I=[];return{create:function(n){function c(f){if(f)if("number"===typeof f)q(f),A.primType=4,A.vertCount=
f|0,A.type=5121;else{var n=null,d=35044,v=-1,p=-1,K=0,r=0;Array.isArray(f)||h(f)||m(f)?n=f:("data"in f&&(n=f.data),"usage"in f&&(d=a[f.usage]),"primitive"in f&&(v=g[f.primitive]),"count"in f&&(p=f.count|0),"length"in f&&(K=f.length|0),"type"in f&&(r=w[f.type]));n?x(A,n,d,v,p,K,r):(f=A.buffer,f.bind(),e.bufferData(34963,K,d),f.dtype=r||5121,f.usage=d,f.dimension=3,f.byteLength=K,A.primType=0>v?4:v,A.vertCount=0>p?0:p,A.type=f.dtype)}else q(),A.primType=4,A.vertCount=0,A.type=5121;return c}var q=d.create(null,
34963,!0),A=new t(q._buffer);p.elementsCount++;c(n);c._reglType="elements";c._elements=A;c.subdata=function(a,e){q.subdata(a,e);return c};c.destroy=function(){K(A)};return c},createStream:function(a){var c=I.pop();c||(c=new t(d.create(null,34963,!0)._buffer));x(c,a,35040,-1,-1,0,0);return c},destroyStream:function(a){I.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof t?a._elements:null},clear:function(){q(M).forEach(K)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,
"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],11:[function(d,p,y){p.exports=function(h){function m(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb ext_disjoint_timer_query angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(g){try{d[g]=
h.getExtension(g)}catch(a){}})}var d={};m();return{extensions:d,refresh:m}}},{}],12:[function(d,p,y){var h=d("./util/values"),m=d("./util/extend");p.exports=function(d,g,a,e,n,p){function z(a,c,f){this.target=a;this.texture=c;this.renderbuffer=f;var e=a=0;c?(a=c.width,e=c.height):f&&(a=f.width,e=f.height);this.width=a;this.height=e}function t(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function x(a,c,f){a&&(a.texture?a.texture._texture.refCount+=
1:a.renderbuffer._renderbuffer.refCount+=1)}function K(a,c){c?c.texture?d.framebufferTexture2D(36160,a,c.target,c.texture._texture.texture,0):d.framebufferRenderbuffer(36160,a,36161,c.renderbuffer._renderbuffer.renderbuffer):d.framebufferTexture2D(36160,a,3553,null,0)}function M(a){var c=3553,f=null,e=null,g=a;"object"===typeof a&&(g=a.data);a=g._reglType;"texture2d"===a?f=g:"textureCube"===a?f=g:"renderbuffer"===a&&(e=g,c=36161);return new z(c,f,e)}function A(a,c,f,g,m){if(f)return a=e.create2D({width:a,
height:c,format:g,type:m}),a._texture.refCount=0,new z(3553,a,null);a=n.create({width:a,height:c,format:g});a._renderbuffer.refCount=0;return new z(36161,null,a)}function w(a){return a&&(a.texture||a.renderbuffer)}function I(a,c,f){a&&(a.texture?a.texture.resize(c,f):a.renderbuffer&&a.renderbuffer.resize(c,f))}function v(){this.id=Q++;ha[this.id]=this;this.framebuffer=d.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=
null}function c(a){a.colorAttachments.forEach(t);t(a.depthAttachment);t(a.stencilAttachment);t(a.depthStencilAttachment)}function O(a){d.deleteFramebuffer(a.framebuffer);a.framebuffer=null;p.framebufferCount--;delete ha[a.id]}function B(c){var e;d.bindFramebuffer(36160,c.framebuffer);var g=c.colorAttachments;for(e=0;e<g.length;++e)K(36064+e,g[e]);for(e=g.length;e<a.maxColorAttachments;++e)K(36064+e,null);K(36096,c.depthAttachment);K(36128,c.stencilAttachment);K(33306,c.depthStencilAttachment);d.checkFramebufferStatus(36160);
d.bindFramebuffer(36160,f.next);f.current=f.next}var f={current:null,next:null,dirty:!1},y=["rgba"],L=["rgba4","rgb565","rgb5 a1"];g.ext_srgb&&L.push("srgba");g.ext_color_buffer_half_float&&L.push("rgba16f","rgb16f");g.webgl_color_buffer_float&&L.push("rgba32f");var ea=["uint8"];g.oes_texture_half_float&&ea.push("half float");g.oes_texture_float&&ea.push("float");var Q=0,ha={};return m(f,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof
v)?a:null},create:function(a,f){function e(a,f){var n,h=0,d=0,q=!0,r=!0;n=null;var p=!0,v="rgba",K="uint8",F=1,I=null,t=null,z=null,C=!1;if("number"===typeof a)h=a|0,d=f|0||h;else if(a){"shape"in a?(d=a.shape,h=d[0],d=d[1]):("radius"in a&&(h=d=a.radius),"width"in a&&(h=a.width),"height"in a&&(d=a.height));if("color"in a||"colors"in a)n=a.color||a.colors,Array.isArray(n);n||("colorCount"in a&&(F=a.colorCount|0),"colorTexture"in a&&(p=!!a.colorTexture,v="rgba4"),"colorType"in a&&(K=a.colorType,p||("half float"===
K?g.ext_color_buffer_half_float&&(v="rgba16f"):"float"===K&&g.webgl_color_buffer_float&&(v="rgba32f"))),"colorFormat"in a&&(v=a.colorFormat,0<=y.indexOf(v)?p=!0:0<=L.indexOf(v)&&(p=!1)));if("depthTexture"in a||"depthStencilTexture"in a)C=!(!a.depthTexture&&!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?q=a.depth:(I=a.depth,r=!1));"stencil"in a&&("boolean"===typeof a.stencil?r=a.stencil:(t=a.stencil,q=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?q=r=a.depthStencil:
(z=a.depthStencil,r=q=!1))}else h=d=1;var O=null,Q=null,ea=null,ba=null;if(Array.isArray(n))O=n.map(M);else if(n)O=[M(n)];else for(O=Array(F),n=0;n<F;++n)O[n]=A(h,d,p,v,K);h=h||O[0].width;d=d||O[0].height;I?Q=M(I):q&&!r&&(Q=A(h,d,C,"depth","uint32"));t?ea=M(t):r&&!q&&(ea=A(h,d,!1,"stencil","uint8"));z?ba=M(z):!I&&!t&&r&&q&&(ba=A(h,d,C,"depth stencil","depth stencil"));for(n=0;n<O.length;++n)x(O[n],h,d);x(Q,h,d);x(ea,h,d);x(ba,h,d);c(m);m.width=h;m.height=d;m.colorAttachments=O;m.depthAttachment=Q;
m.stencilAttachment=ea;m.depthStencilAttachment=ba;e.color=O.map(w);e.depth=w(Q);e.stencil=w(ea);e.depthStencil=w(ba);e.width=m.width;e.height=m.height;B(m);return e}var m=new v;p.framebufferCount++;e(a,f);e.resize=function(a,c){var f=a|0,g=c|0||f;if(f===m.width&&g===m.height)return e;for(var n=m.colorAttachments,h=0;h<n.length;++h)I(n[h],f,g);I(m.depthAttachment,f,g);I(m.stencilAttachment,f,g);I(m.depthStencilAttachment,f,g);m.width=e.width=f;m.height=e.height=g;B(m);return e};e._reglType="framebuffer";
e._framebuffer=m;e.destroy=function(){O(m);c(m)};return e},clear:function(){h(ha).forEach(O)}})}},{"./util/extend":23,"./util/values":31}],13:[function(d,p,y){p.exports=function(h,m){var d=1;m.ext_texture_filter_anisotropic&&(d=h.getParameter(34047));var g=1,a=1;m.webgl_draw_buffers&&(g=h.getParameter(34852),a=h.getParameter(36063));return{colorBits:[h.getParameter(3410),h.getParameter(3411),h.getParameter(3412),h.getParameter(3413)],depthBits:h.getParameter(3414),stencilBits:h.getParameter(3415),
subpixelBits:h.getParameter(3408),extensions:Object.keys(m).filter(function(a){return!!m[a]}),maxAnisotropic:d,maxDrawbuffers:g,maxColorAttachments:a,pointSizeDims:h.getParameter(33901),lineWidthDims:h.getParameter(33902),maxViewportDims:h.getParameter(3386),maxCombinedTextureUnits:h.getParameter(35661),maxCubeMapSize:h.getParameter(34076),maxRenderbufferSize:h.getParameter(34024),maxTextureUnits:h.getParameter(34930),maxTextureSize:h.getParameter(3379),maxAttributes:h.getParameter(34921),maxVertexUniforms:h.getParameter(36347),
maxVertexTextureUnits:h.getParameter(35660),maxVaryingVectors:h.getParameter(36348),maxFragmentUniforms:h.getParameter(36349),glsl:h.getParameter(35724),renderer:h.getParameter(7937),vendor:h.getParameter(7936),version:h.getParameter(7938)}}},{}],14:[function(d,p,y){var h=d("./util/is-typed-array");p.exports=function(m,d,g){return function(a){var e=0,n=0,p=g.framebufferWidth,z=g.framebufferHeight,t=null;h(a)?t=a:2===arguments.length?(p=arguments[0]|0,z=arguments[1]|0):a&&(e=a.x|0,n=a.y|0,p=a.width||
g.framebufferWidth,z=a.height||g.framebufferHeight,t=a.data||null);d();t=t||new Uint8Array(p*z*4);m.pixelStorei(3333,4);m.readPixels(e,n,p,z,6408,5121,t);return t}}},{"./util/is-typed-array":26}],15:[function(d,p,y){var h=d("./util/values");p.exports=function(m,d,g,a){function e(a){this.id=z++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0}function n(e){var g=e.renderbuffer;m.bindRenderbuffer(36161,null);m.deleteRenderbuffer(g);e.renderbuffer=null;e.refCount=0;delete t[e.id];
a.renderbufferCount--}var p={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};d.ext_srgb&&(p.srgba=35907);d.ext_color_buffer_half_float&&(p.rgba16f=34842,p.rgb16f=34843);d.webgl_color_buffer_float&&(p.rgba32f=34836);var z=0,t={};e.prototype.decRef=function(){0>=--this.refCount&&n(this)};return{create:function(g,n){function h(a,e){var g=0,c=0,n=32854;"object"===typeof a&&a?("shape"in a?(c=a.shape,g=c[0]|0,c=c[1]|0):("radius"in a&&(g=c=a.radius|0),"width"in a&&
(g=a.width|0),"height"in a&&(c=a.height|0)),"format"in a&&(n=p[a.format])):"number"===typeof a?(g=a|0,c="number"===typeof e?e|0:g):a||(g=c=1);if(g!==d.width||c!==d.height||n!==d.format)return h.width=d.width=g,h.height=d.height=c,d.format=n,m.bindRenderbuffer(36161,d.renderbuffer),m.renderbufferStorage(36161,n,g,c),h}var d=new e(m.createRenderbuffer());t[d.id]=d;a.renderbufferCount++;h(g,n);h.resize=function(a,e){var g=a|0,c=e|0||g;if(g===d.width&&c===d.height)return h;h.width=d.width=g;h.height=
d.height=c;m.bindRenderbuffer(36161,d.renderbuffer);m.renderbufferStorage(36161,d.format,g,c);return h};h._reglType="renderbuffer";h._renderbuffer=d;h.destroy=function(){d.decRef()};return h},clear:function(){h(t).forEach(n)}}}},{"./util/values":31}],16:[function(d,p,y){var h=d("./util/values");p.exports=function(d,q,g){function a(a,e,g,d){this.name=a;this.id=e;this.location=g;this.info=d}function e(a,e){for(var g=0;g<a.length;++g)if(a[g].id===e.id){a[g].location=e.location;return}a.push(e)}function n(a,
e,g){g=35632===a?z:t;var h=g[e];if(!h){var c=q.str(e),h=d.createShader(a);d.shaderSource(h,c);d.compileShader(h);g[e]=h}return h}function p(a,e){this.id=M++;this.fragId=a;this.vertId=e;this.program=null;this.uniforms=[];this.attributes=[]}var z={},t={},x={},K=[],M=0;return{clear:function(){var a=d.deleteShader.bind(d);h(z).forEach(a);z={};h(t).forEach(a);t={};K.forEach(function(a){d.deleteProgram(a.program)});K.length=0;x={};g.shaderCount=0},program:function(h,w,t){g.shaderCount++;(t=x[w])||(t=x[w]=
{});var v=t[h];if(!v){var c=v=new p(w,h),z,B;z=n(35632,c.fragId);B=n(35633,c.vertId);w=c.program=d.createProgram();d.attachShader(w,z);d.attachShader(w,B);d.linkProgram(w);var f=d.getProgramParameter(w,35718),M=c.uniforms;for(z=0;z<f;++z)if(B=d.getActiveUniform(w,z))if(1<B.size)for(var L=0;L<B.size;++L){var y=B.name.replace("[0]","["+L+"]");e(M,new a(y,q.id(y),d.getUniformLocation(w,y),B))}else e(M,new a(B.name,q.id(B.name),d.getUniformLocation(w,B.name),B));f=d.getProgramParameter(w,35721);c=c.attributes;
for(z=0;z<f;++z)(B=d.getActiveAttrib(w,z))&&e(c,new a(B.name,q.id(B.name),d.getAttribLocation(w,B.name),B));t[h]=v;K.push(v)}return v},shader:n,frag:null,vert:null}}},{"./util/values":31}],17:[function(d,p,y){p.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0}}},{}],18:[function(d,p,y){p.exports=function(){var d={"":0},m=[""];return{id:function(q){var g=d[q];if(g)return g;g=d[q]=m.length;m.push(q);return g},str:function(d){return m[d]}}}},
{}],19:[function(d,p,y){function h(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function m(a){return Array.isArray(a)&&0!==a.length&&K(a[0])?!0:!1}function q(a){return Object.prototype.toString.call(a)}function g(a){if(!a)return!1;var e=q(a);return 0<=v.indexOf(e)?!0:h(a)||m(a)||z(a)}function a(a,e){36193===a.type?(a.data=x(e),t.freeType(e)):a.data=e}var e=d("./util/extend"),n=d("./util/values"),F=d("./util/is-typed-array"),z=d("./util/is-ndarray"),t=d("./util/pool"),x=d("./util/to-half-float"),
K=d("./util/is-array-like");y=d("./constants/arraytypes.json");var M=d("./constants/arraytypes.json"),A=[9984,9986,9985,9987],w=[0,6409,6410,6407,6408],I={};I[6409]=I[6406]=I[6402]=1;I[34041]=I[6410]=2;I[6407]=3;I[6408]=4;var v=Object.keys(y).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]);p.exports=function(c,d,p,f,v,L){function y(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=
this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function Q(b,a){b.internalformat=a.internalformat;b.format=a.format;b.type=a.type;b.compressed=a.compressed;b.premultiplyAlpha=a.premultiplyAlpha;b.flipY=a.flipY;b.unpackAlignment=a.unpackAlignment;b.colorSpace=a.colorSpace;b.width=a.width;b.height=a.height;b.channels=a.channels}function ha(b,a){if("object"===typeof a&&a){"premultiplyAlpha"in a&&(b.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(b.flipY=
a.flipY);"alignment"in a&&(b.unpackAlignment=a.alignment);"colorSpace"in a&&(b.colorSpace=Ba[a.colorSpace]);"type"in a&&(b.type=ka[a.type]);var c=b.width,f=b.height,e=b.channels,g=!1;"shape"in a?(c=a.shape[0],f=a.shape[1],3===a.shape.length&&(e=a.shape[2],g=!0)):("radius"in a&&(c=f=a.radius),"width"in a&&(c=a.width),"height"in a&&(f=a.height),"channels"in a&&(e=a.channels,g=!0));b.width=c|0;b.height=f|0;b.channels=e|0;c=!1;"format"in a&&(c=a.format,f=b.internalformat=ca[c],b.format=Ca[f],c in ka&&
!("type"in a)&&(b.type=ka[c]),c in da&&(b.compressed=!0),c=!0);!g&&c?b.channels=I[b.format]:g&&!c&&b.channels!==w[b.format]&&(b.format=b.internalformat=w[b.channels])}}function r(b){c.pixelStorei(37440,b.flipY);c.pixelStorei(37441,b.premultiplyAlpha);c.pixelStorei(37443,b.colorSpace);c.pixelStorei(3317,b.unpackAlignment)}function C(){y.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function R(b,c){var f=null;g(c)?f=c:c&&(ha(b,c),"x"in c&&
(b.xOffset=c.x|0),"y"in c&&(b.yOffset=c.y|0),g(c.data)&&(f=c.data));if(c.copy){var e=v.viewportWidth,d=v.viewportHeight;b.width=b.width||e-b.xOffset;b.height=b.height||d-b.yOffset;b.needsCopy=!0}else if(!f)b.width=b.width||1,b.height=b.height||1;else if(F(f))b.data=f,"type"in c||5121!==b.type||(b.type=M[Object.prototype.toString.call(f)]|0);else if(h(f)){e=f;d=b.width*b.height*b.channels;switch(b.type){case 5121:case 5123:case 5125:case 5126:d=t.allocType(b.type,d);d.set(e);b.data=d;break;case 36193:b.data=
x(e)}b.alignment=1;b.needsFree=!0}else if(z(f)){e=f.data;Array.isArray(e)||5121!==b.type||(b.type=M[Object.prototype.toString.call(e)]|0);var d=f.shape,n=f.stride,p,r,A,L;3===d.length?(A=d[2],L=n[2]):L=A=1;p=d[0];r=d[1];d=n[0];n=n[1];b.alignment=1;b.width=p;b.height=r;b.channels=A;b.format=b.internalformat=w[A];b.needsFree=!0;p=L;f=f.offset;A=b.width;L=b.height;r=b.channels;for(var l=t.allocType(36193===b.type?5126:b.type,A*L*r),y=0,B=0;B<L;++B)for(var C=0;C<A;++C)for(var E=0;E<r;++E)l[y++]=e[d*C+
n*B+p*E+f];a(b,l)}else if("[object HTMLCanvasElement]"===q(f)||"[object CanvasRenderingContext2D]"===q(f))"[object HTMLCanvasElement]"===q(f)?b.element=f:b.element=f.canvas,b.width=b.element.width,b.height=b.element.height;else if("[object HTMLImageElement]"===q(f))b.element=f,b.width=f.naturalWidth,b.height=f.naturalHeight;else if("[object HTMLVideoElement]"===q(f))b.element=f,b.width=f.videoWidth,b.height=f.videoHeight,b.needsPoll=!0;else if(m(f)){e=f[0].length;d=f.length;n=1;if(K(f[0][0])){p=n=
f[0][0].length;A=t.allocType(36193===b.type?5126:b.type,e*d*p);for(r=L=0;r<d;++r)for(l=f[r],y=0;y<e;++y)for(B=l[y],C=0;C<p;++C)A[L++]=B[C];a(b,A)}else{p=t.allocType(36193===b.type?5126:b.type,e*d);for(L=A=0;L<d;++L)for(r=f[L],l=0;l<e;++l)p[A++]=r[l];a(b,p)}b.alignment=1;b.width=e;b.height=d;b.channels=n;b.format=b.internalformat=w[n];b.needsFree=!0}}function S(b,a,e,g,d){var n=b.element,h=b.data,m=b.internalformat,p=b.format,q=b.type,l=b.width,x=b.height;r(b);n?c.texSubImage2D(a,d,e,g,p,q,n):b.compressed?
c.compressedTexSubImage2D(a,d,e,g,m,l,x,h):b.needsCopy?(f(),c.copyTexSubImage2D(a,d,e,g,b.xOffset,b.yOffset,l,x)):c.texSubImage2D(a,d,e,g,l,x,p,q,h)}function G(){return Da.pop()||new C}function fa(b){b.needsFree&&t.freeType(b.data);C.call(b);Da.push(b)}function la(){y.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function T(b,a,c){var f=b.images[0]=G();b.mipmask=1;f.width=b.width=a;f.height=b.height=c}function P(b,a){var c=null;if(g(a))c=b.images[0]=G(),Q(c,
b),R(c,a),b.mipmask=1;else if(ha(b,a),Array.isArray(a.mipmap))for(var f=a.mipmap,e=0;e<f.length;++e)c=b.images[e]=G(),Q(c,b),c.width>>=e,c.height>>=e,R(c,f[e]),b.mipmask|=1<<e;else c=b.images[0]=G(),Q(c,b),R(c,a),b.mipmask=1;Q(b,b.images[0])}function J(b,a){for(var e=b.images,g=0;g<e.length&&e[g];++g){var d=e[g],n=a,h=g,m=d.element,p=d.data,q=d.internalformat,l=d.format,x=d.type,K=d.width,v=d.height;r(d);m?c.texImage2D(n,h,l,l,x,m):d.compressed?c.compressedTexImage2D(n,h,q,K,v,0,p):d.needsCopy?(f(),
c.copyTexImage2D(n,h,l,d.xOffset,d.yOffset,K,v,0)):c.texImage2D(n,h,l,K,v,0,l,x,p)}}function X(){var b=Ea.pop()||new la;y.call(b);for(var a=b.mipmask=0;16>a;++a)b.images[a]=null;return b}function ia(b){for(var a=b.images,c=0;c<a.length;++c)a[c]&&fa(a[c]),a[c]=null;Ea.push(b)}function qa(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function sa(a,c){"min"in c&&(a.minFilter=ta[c.min],0<=A.indexOf(a.minFilter)&&(a.genMipmaps=
!0));"mag"in c&&(a.magFilter=ba[c.mag]);var f=a.wrapS,e=a.wrapT;if("wrap"in c){var g=c.wrap;"string"===typeof g?f=e=W[g]:Array.isArray(g)&&(f=W[g[0]],e=W[g[1]])}else"wrapS"in c&&(f=W[c.wrapS]),"wrapT"in c&&(e=W[c.wrapT]);a.wrapS=f;a.wrapT=e;"anisotropic"in c&&(a.anisotropic=c.anisotropic);if("mipmap"in c){f=!1;switch(typeof c.mipmap){case "string":a.mipmapHint=U[c.mipmap];f=a.genMipmaps=!0;break;case "boolean":f=a.genMipmaps=c.mipmap;break;case "object":a.genMipmaps=!1,f=!0}!f||"min"in c||(a.minFilter=
9984)}}function ja(a,f){c.texParameteri(f,10241,a.minFilter);c.texParameteri(f,10240,a.magFilter);c.texParameteri(f,10242,a.wrapS);c.texParameteri(f,10243,a.wrapT);d.ext_texture_filter_anisotropic&&c.texParameteri(f,34046,a.anisotropic);a.genMipmaps&&(c.hint(33170,a.mipmapHint),c.generateMipmap(f))}function ra(){var a=ua.pop()||new qa;qa.call(a);return a}function na(a){y.call(this);this.mipmask=0;this.internalformat=6408;this.id=Ga++;this.refCount=1;this.target=a;this.texture=c.createTexture();this.unit=
-1;this.bindCount=0}function Y(a){c.activeTexture(33984);c.bindTexture(a.target,a.texture)}function ga(){var a=aa[0];a?c.bindTexture(a.target,a.texture):c.bindTexture(3553,null)}function Z(a){var f=a.texture,e=a.unit,g=a.target;0<=e&&(c.activeTexture(33984+e),c.bindTexture(g,null),aa[e]=null);c.deleteTexture(f);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete wa[a.id];L.textureCount--}var U={"don't care":4352,"dont care":4352,nice:4354,fast:4353},W={repeat:10497,clamp:33071,mirror:33648},
ba={nearest:9728,linear:9729},ta=e({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ba),Ba={none:0,browser:37444},ka={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},ca={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},da={};d.ext_srgb&&(ca.srgb=35904,ca.srgba=35906);d.oes_texture_float&&(ka["float"]=5126);d.oes_texture_half_float&&(ka.float16=ka["half float"]=
36193);d.webgl_depth_texture&&(e(ca,{depth:6402,"depth stencil":34041}),e(ka,{uint16:5123,uint32:5125,"depth stencil":34042}));d.webgl_compressed_texture_s3tc&&e(da,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});d.webgl_compressed_texture_atc&&e(da,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});d.webgl_compressed_texture_pvrtc&&e(da,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});
d.webgl_compressed_texture_etc1&&(da["rgb etc1"]=36196);var ya=Array.prototype.slice.call(c.getParameter(34467));Object.keys(da).forEach(function(a){var c=da[a];0<=ya.indexOf(c)&&(ca[a]=c)});var va=Object.keys(ca);p.textureFormats=va;var Ca=va.reduce(function(a,c){var f=ca[c];6409===f||6406===f||6409===f||6410===f||6402===f||34041===f?a[f]=f:32855===f||0<=c.indexOf("rgba")?a[f]=6408:a[f]=6407;return a},{}),Da=[],Ea=[],ua=[],Ga=0,wa={},ma=p.maxTextureUnits,aa=Array(ma).map(function(){return null});
e(na.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var f=0;f<ma;++f){var e=aa[f];if(e){if(0<e.bindCount)continue;e.unit=-1}aa[f]=this;a=f;break}this.unit=a;c.activeTexture(33984+a);c.bindTexture(this.target,this.texture)}return a},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&Z(this)}});return{create2D:function(a,f){function e(a,b){var c=ra(),f=X();"number"===typeof a?"number"===typeof b?T(f,a|0,b|0):T(f,a|0,a|0):a?(sa(c,a),P(f,a)):T(f,1,1);c.genMipmaps&&
(f.mipmask=(f.width<<1)-1);g.mipmask=f.mipmask;Q(g,f);g.internalformat=f.internalformat;e.width=f.width;e.height=f.height;Y(g);J(f,3553);ja(c,3553);ga();ua.push(c);ia(f);return e}var g=new na(3553);wa[g.id]=g;L.textureCount++;e(a,f);e.subimage=function(a,b,f,c){b|=0;f|=0;c|=0;var d=G();Q(d,g);d.width>>=c;d.height>>=c;d.width-=b;d.height-=f;R(d,a);Y(g);S(d,3553,b,f,c);ga();fa(d);return e};e.resize=function(a,b){var f=a|0,d=b|0||f;if(f===g.width&&d===g.height)return e;e.width=g.width=f;e.height=g.height=
d;Y(g);c.texImage2D(3553,0,g.format,f,d,0,g.format,g.type,null);ga();return e};e._reglType="texture2d";e._texture=g;e.destroy=function(){g.decRef()};return e},createCube:function(a,f,e,g,d,n){function h(a,b,f,c,e,g){var d,n=ra();for(d=0;6>d;++d)p[d]=X();if("number"===typeof a||!a)for(a=a|0||1,d=0;6>d;++d)T(p[d],a,a);else if("object"===typeof a)if(b)P(p[0],a),P(p[1],b),P(p[2],f),P(p[3],c),P(p[4],e),P(p[5],g);else if(sa(n,a),ha(m,a),"faces"in a)for(a=a.faces,d=0;6>d;++d)Q(p[d],m),P(p[d],a[d]);else for(d=
0;6>d;++d)P(p[d],a);Q(m,p[0]);m.mipmask=n.genMipmaps?(p[0].width<<1)-1:p[0].mipmask;m.internalformat=p[0].internalformat;h.width=p[0].width;h.height=p[0].height;Y(m);for(d=0;6>d;++d)J(p[d],34069+d);ja(n,34067);ga();ua.push(n);for(d=0;6>d;++d)ia(p[d]);return h}var m=new na(34067);wa[m.id]=m;L.cubeCount++;var p=Array(6);h(a,f,e,g,d,n);h.subimage=function(a,b,f,c,e){f|=0;c|=0;e|=0;var g=G();Q(g,m);g.width>>=e;g.height>>=e;g.width-=f;g.height-=c;R(g,b);Y(m);S(g,34069+a,f,c,e);ga();fa(g);return h};h.resize=
function(a,b){var f=a|0,e=b|0||f;if(f===m.width&&e===m.height)return h;h.width=m.width=f;h.height=m.height=e;Y(m);for(var g=0;6>g;++g)c.texImage2D(34069+g,0,m.format,f,e,0,m.format,m.type,null);ga();return h};h._reglType="textureCube";h._texture=m;h.destroy=function(){m.decRef()};return h},clear:function(){for(var a=0;a<ma;++a)c.activeTexture(33984+a),c.bindTexture(3553,null),aa[a]=null;n(wa).forEach(Z);L.cubeCount=0;L.textureCount=0},getTexture:function(a){return null}}}},{"./constants/arraytypes.json":4,
"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/to-half-float":30,"./util/values":31}],20:[function(d,p,y){p.exports=function(d,m){function p(){this.endQueryIndex=this.startQueryIndex=-1;this.stats=null}var g=m.ext_disjoint_timer_query;if(!g)return null;var a=[],e=[],n,F,z=[],t=[];return{beginQuery:function(a){n=a;F=z.pop()||g.createQueryEXT();g.beginQueryEXT(g.TIME_ELAPSED_EXT,F)},endQuery:function(){g.endQueryEXT(g.TIME_ELAPSED_EXT);
var d=t.pop()||new p;d.startQueryIndex=a.length;d.endQueryIndex=d.startQueryIndex;d.stats=n;e.push(d);a.push(F)},update:function(){if(0!==a.length){var d=[],h,n;for(h=0;h<a.length;h++)d[h]=1E-6*g.getQueryObjectEXT(a[h],g.QUERY_RESULT_EXT),z.push(a[h]);a=[];for(h=0;h<e.length;h++){var m=e[h];for(n=m.startQueryIndex;n<=m.endQueryIndex;n++)m.stats.gpuTime+=d[n];t.push(m)}e=[]}},getNumPendingQueries:function(){return a.length},pushScopeStats:function(a,g,d){var h=t.pop()||new p;h.startQueryIndex=a;h.endQueryIndex=
g;h.stats=d;e.push(h)},clear:function(){for(var a=0;a<z.length;a++)g.deleteQueryEXT(z[a])}}}},{}],21:[function(d,p,y){p.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(d,p,y){function h(g){return Array.prototype.slice.call(g)}function m(g){return h(g).join("")}var q=d("./extend");p.exports=function(){function g(){var a=[],g=[];return q(function(){a.push.apply(a,h(arguments))},{def:function(){var d="v"+e++;
g.push(d);0<arguments.length&&(a.push(d,"="),a.push.apply(a,h(arguments)),a.push(";"));return d},toString:function(){return m([0<g.length?"var "+g+";":"",m(a)])}})}function a(){function a(g,h){d(g,h,"=",e.def(g,h),";")}var e=g(),d=g(),h=e.toString,n=d.toString;return q(e,{entry:e,exit:d,save:a,set:function(g,d,c){a(g,d);e(g,d,"=",c,";")},toString:function(){return h()+n()}})}var e=0,d=[],p=[],z=g(),t={};return{global:z,link:function(a){for(var g=0;g<p.length;++g)if(p[g]===a)return d[g];g="g"+e++;
d.push(g);p.push(a);return g},block:g,proc:function(e,g){function d(){var a="a"+h.length;h.push(a);return a}var h=[];g=g||0;for(var n=0;n<g;++n)d();var n=a(),p=n.toString;return t[e]=q(n,{arg:d,toString:function(){return m(["function(",h.join(),"){",p(),"}"])}})},scope:a,cond:function(){var e=m(arguments),g=a(),d=a(),n=g.toString,p=d.toString;return q(g,{then:function(){g.apply(g,h(arguments));return this},"else":function(){d.apply(d,h(arguments));return this},toString:function(){var a=p();a&&(a=
"else{"+a+"}");return m(["if(",e,"){",n(),"}",a])}})},compile:function(){var a=['"use strict";',z,"return {"];Object.keys(t).forEach(function(e){a.push('"',e,'":',t[e].toString(),",")});a.push("}");var e=m(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,d.concat(e)).apply(null,p)}}}},{"./extend":23}],23:[function(d,p,y){p.exports=function(d,m){for(var p=Object.keys(m),g=0;g<p.length;++g)d[p[g]]=m[p[g]];return d}},{}],24:[function(d,p,y){var h=d("./is-typed-array");
p.exports=function(d){return Array.isArray(d)||h(d)}},{"./is-typed-array":26}],25:[function(d,p,y){var h=d("./is-typed-array");p.exports=function(d){return!!d&&"object"===typeof d&&Array.isArray(d.shape)&&Array.isArray(d.stride)&&"number"===typeof d.offset&&d.shape.length===d.stride.length&&(Array.isArray(d.data)||h(d.data))}},{"./is-typed-array":26}],26:[function(d,p,y){var h=d("../constants/arraytypes.json");p.exports=function(d){return Object.prototype.toString.call(d)in h}},{"../constants/arraytypes.json":4}],
27:[function(d,p,y){p.exports=function(d,m){for(var p=Array(d),g=0;g<d;++g)p[g]=m(g);return p}},{}],28:[function(d,p,y){function h(a){var e,g;e=(65535<a)<<4;a>>>=e;g=(255<a)<<3;a>>>=g;e|=g;g=(15<a)<<2;a>>>=g;e|=g;g=(3<a)<<1;return e|g|a>>>g>>1}function m(a){a:{for(var e=16;268435456>=e;e*=16)if(a<=e){a=e;break a}a=0}e=g[h(a)>>2];return 0<e.length?e.pop():new ArrayBuffer(a)}function q(a){g[h(a.byteLength)>>2].push(a)}var g=d("./loop")(8,function(){return[]});p.exports={alloc:m,free:q,allocType:function(a,
e){var g=null;switch(a){case 5120:g=new Int8Array(m(e),0,e);break;case 5121:g=new Uint8Array(m(e),0,e);break;case 5122:g=new Int16Array(m(2*e),0,e);break;case 5123:g=new Uint16Array(m(2*e),0,e);break;case 5124:g=new Int32Array(m(4*e),0,e);break;case 5125:g=new Uint32Array(m(4*e),0,e);break;case 5126:g=new Float32Array(m(4*e),0,e);break;default:return null}return g.length!==e?g.subarray(0,e):g},freeType:function(a){q(a.buffer)}}},{"./loop":27}],29:[function(d,p,y){p.exports="function"===typeof requestAnimationFrame&&
"function"===typeof cancelAnimationFrame?{next:function(d){return requestAnimationFrame(d)},cancel:function(d){return cancelAnimationFrame(d)}}:{next:function(d){setTimeout(d,30)},cancel:clearTimeout}},{}],30:[function(d,p,y){var h=d("./pool"),m=new Float32Array(1),q=new Uint32Array(m.buffer);p.exports=function(g){for(var a=h.allocType(5123,g.length),e=0;e<g.length;++e)if(isNaN(g[e]))a[e]=65535;else if(Infinity===g[e])a[e]=31744;else if(-Infinity===g[e])a[e]=64512;else{m[0]=g[e];var d=q[0],p=d>>>
31<<15,z=(d<<1>>>24)-127,d=d>>13&1023;a[e]=-24>z?p:-14>z?p+(d+1024>>-14-z):15<z?p+31744:p+(z+15<<10)+d}return a}},{"./pool":28}],31:[function(d,p,y){p.exports=function(d){return Object.keys(d).map(function(m){return d[m]})}},{}],32:[function(d,p,y){function h(g,a){function e(){var a=window.innerWidth,e=window.innerHeight;g!==document.body&&(e=g.getBoundingClientRect(),a=e.right-e.left,e=e.top-e.bottom);d.width=p*a;d.height=p*e;q(d.style,{width:a+"px",height:e+"px"})}var d=document.createElement("canvas"),
h=m(d,a);q(d.style,{border:0,margin:0,padding:0,top:0,left:0});g.appendChild(d);g===document.body&&(d.style.position="absolute",q(g.style,{margin:0,padding:0}));var p=+h.options.pixelRatio;window.addEventListener("resize",e,!1);var t=h.options.onDestroy;h.options=q(q({},h.options),{onDestroy:function(){window.removeEventListener("resize",e);g.removeChild(d);t&&t()}});e();return h}function m(d,a){function e(a){try{return d.getContext(a,h)}catch(e){return null}}var h=a.glOptions||{};return{gl:e("webgl")||
e("experimental-webgl")||e("webgl-experimental"),options:q({pixelRatio:window.devicePixelRatio},a)}}var q=d("./util/extend");p.exports=function(d){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:d[0],options:d[1]||{}};var a=document.body,e=d[1]||{};if("string"===typeof d[0])a=document.querySelector(d[0])||document.body;else if("object"===typeof d[0])if(d[0]instanceof HTMLElement)a=d[0];else{if(d[0]instanceof WebGLRenderingContext)return{gl:d[0],options:q({pixelRatio:1},
e)};e=d[0]}return a.nodeName&&"CANVAS"===a.nodeName.toUpperCase()?m(a,e):h(a,e)}},{"./util/extend":23}],33:[function(d,p,y){function h(a){throw Error("resl: "+a);}function m(a,e,d){Object.keys(a).forEach(function(a){0>e.indexOf(a)&&h('invalid parameter "'+a+'" in '+d)})}function q(a,e){this.state=0;this.ready=!1;this.progress=0;this.name=a;this.cancel=e}var g=["manifest","onDone","onProgress","onError"],a=["type","src","stream","credentials","parser"],e=["onData","onDone"];p.exports=function(d){function p(a,
c){if(a in d){var e=d[a];"function"!==typeof e&&h('invalid callback "'+a+'"');return e}return null}function z(a){function c(){if(!(2>m.readyState||1===p.state||-1===p.state)){if(200!==m.status)return x('error loading resource "'+a.name+'"');if(2<m.readyState&&0===p.state){var d;d="binary"===a.type?m.response:m.responseText;if(h.data)try{n=h.data(d)}catch(g){return x(g)}else n=d}if(3<m.readyState&&0===p.state){if(h.done)try{n=h.done()}catch(g){return x(g)}p.state=1}v[e]=n;p.progress=.75*p.progress+
.25;p.ready=a.stream&&!!n||1===p.state;y()}}var e=a.name,d=a.stream,g="binary"===a.type,h=a.parser,m=new XMLHttpRequest,n=null,p=new q(e,function(){1!==p.state&&-1!==p.state&&(m.onreadystatechange=null,m.abort(),p.state=-1)});m.onreadystatechange=d?c:function(){4===m.readyState&&c()};g&&(m.responseType="arraybuffer");a.credentials&&(m.withCredentials=!0);m.open("GET",a.src,!0);m.send();return p}function t(a,c){function e(){if(0===t.state)if(p.data)try{w=p.data(c)}catch(a){return x(a)}else w=c}function d(c){e();
v[n]=w;t.progress=c.lengthComputable?Math.max(t.progress,c.loaded/c.total):.75*t.progress+.25;t.ready=a.stream;y(n)}function g(){e();if(0===t.state){if(p.done)try{w=p.done()}catch(a){return x(a)}t.state=1}t.progress=1;t.ready=!0;v[n]=w;m();y("finish "+n)}function h(){x('error loading asset "'+n+'"')}function m(){a.stream&&c.removeEventListener("progress",d);"image"===a.type?c.addEventListener("load",g):c.addEventListener("canplay",g);c.removeEventListener("error",h)}var n=a.name,p=a.parser,t=new q(n,
function(){1!==t.state&&-1!==t.state&&(t.state=-1,m(),c.src="")}),w=c;a.stream&&c.addEventListener("progress",d);"image"===a.type?c.addEventListener("load",g):c.addEventListener("canplay",g);c.addEventListener("error",h);c.crossOrigin=a.credentials?"use-credentials":"anonymous";c.src=a.src;return t}function x(a){-1!==c&&1!==c&&(c=-1,B.forEach(function(a){a.cancel()}),I?"string"===typeof a?I(Error("resl: "+a)):I(a):console.error("resl error:",a))}function y(a){if(-1!==c&&1!==c){var e=0,d=0;B.forEach(function(a){a.ready&&
(d+=1);e+=a.progress});d===B.length?(c=1,A(v)):w&&w(e/B.length,a)}}"object"===typeof d&&d||h("invalid or missing configuration");m(d,g,"config");var M=d.manifest;"object"===typeof M&&M||h("missing manifest");var A=p("onDone");A||h("missing onDone() callback");var w=p("onProgress"),I=p("onError"),v={},c=0,O={text:z,binary:function(a){return z(a)},image:function(a){return t(a,document.createElement("img"))},video:function(a){return t(a,document.createElement("video"))},audio:function(a){return t(a,
document.createElement("audio"))}},B=Object.keys(M).map(function(c){function d(a,c){if(a in g.parser){var e=g.parser[a];"function"!==typeof e&&h("invalid parser callback "+a+' for asset "'+a+'"');return e}return c}var g=M[c];"string"===typeof g?g={src:g}:"object"===typeof g&&g||h('invalid asset definition "'+c+'"');m(g,a,'asset "'+c+'"');var n={};"parser"in g&&("function"===typeof g.parser?n={data:g.parser}:"object"===typeof g.parser&&g.parser?(m(n,e,'parser for asset "'+c+'"'),"onData"in n||h('missing onData callback for parser in asset "'+
c+'"'),n={data:d("onData"),done:d("onDone")}):h('invalid parser for asset "'+c+'"'));return{name:c,type:function(a,e,d){a in g&&(d=g[a]);0>e.indexOf(d)&&h("invalid "+a+' "'+d+'" for asset "'+c+'", possible values: '+e);return d}("type",Object.keys(O),"text"),stream:!!g.stream,credentials:!!g.credentials,src:function(a,e,d){a in g?d=g[a]:e&&h("missing "+a+' for asset "'+c+'"');"string"!==typeof d&&h("invalid "+a+' for asset "'+c+'", must be a string');return d}("src",!0,""),parser:n}}).map(function(a){return O[a.type](a)})}},
{}],34:[function(d,p,y){var h=d("./lib/util/extend"),m=d("./lib/dynamic"),q=d("./lib/util/raf"),g=d("./lib/util/clock"),a=d("./lib/strings"),e=d("./lib/webgl"),n=d("./lib/extension"),F=d("./lib/limits"),z=d("./lib/buffer"),t=d("./lib/elements"),x=d("./lib/texture"),K=d("./lib/renderbuffer"),M=d("./lib/framebuffer"),A=d("./lib/attribute"),w=d("./lib/shader"),I=d("./lib/read"),v=d("./lib/core"),c=d("./lib/stats"),O=d("./lib/timer");p.exports=function(){function d(){W=q.next(d);J.tick+=1;J.time=(g()-
la)/1E3;Q();for(var a=0;a<U.length;++a)(0,U[a])(J,null,0);C.flush()}function f(a){}function p(a){}function y(a){function c(a){var e={},d={};Object.keys(a).forEach(function(c){var f=a[c];m.isDynamic(f)?d[c]=m.unbox(f,c):e[c]=f});return{dynamic:d,"static":e}}function e(a){for(;t.length<a;)t.push(null);return t}var d=c(a.context||{}),f=c(a.uniforms||{}),g=c(a.attributes||{}),n=c(function(a){function c(a){if(a in e){var d=e[a];delete e[a];Object.keys(d).forEach(function(b){e[a+"."+b]=d[b]})}}var e=h({},
a);delete e.uniforms;delete e.attributes;delete e.context;c("blend");c("depth");c("cull");c("stencil");c("polygonOffset");c("scissor");c("sample");return e}(a));a={gpuTime:0};var d=Y.compile(n,g,f,d,a),p=d.draw,q=d.batch,r=d.scope,t=[];return h(function(a,c){var d;if("function"===typeof a)return r.call(this,null,a,0);if("function"===typeof c)if("number"===typeof a)for(d=0;d<a;++d)r.call(this,null,c,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)r.call(this,a[d],c,d);else return r.call(this,a,
c,0);else if("number"===typeof a){if(0<a)return q.call(this,e(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return q.call(this,a,a.length)}else return p.call(this,a)},{stats:a})}function ea(){var a=ga.viewport,c=ga.scissor_box;a[0]=a[1]=c[0]=c[1]=0;J.viewportWidth=J.framebufferWidth=J.drawingBufferWidth=a[2]=c[2]=C.drawingBufferWidth;J.viewportHeight=J.framebufferHeight=J.drawingBufferHeight=a[3]=c[3]=C.drawingBufferHeight}function Q(){ea();Y.procs.poll()}function ha(){ea();Y.procs.refresh()}var r=
e(Array.prototype.slice.call(arguments)),C=r.gl,R=r.options,r=a(),S=c(),G=n(C).extensions,fa=O(C,G),la=g(),T=C.drawingBufferWidth,P=C.drawingBufferHeight,J={tick:0,time:0,viewportWidth:T,viewportHeight:P,framebufferWidth:T,framebufferHeight:P,drawingBufferWidth:T,drawingBufferHeight:P,pixelRatio:R.pixelRatio},X=F(C,G),ia=z(C,S),qa=t(C,G,ia,S),T=A(C,G,X,ia,r),sa=w(C,r,S),ja=x(C,G,X,Q,J,S),ra=K(C,G,X,S),na=M(C,G,X,ja,ra,S),P=I(C,Q,J),Y=v(C,r,G,X,ia,qa,ja,na,{},T,sa,{elements:null,primitive:4,count:-1,
offset:0,instances:-1},J,fa),ga=Y.next,Z=C.canvas,U=[],W=0;Z&&(Z.addEventListener("webglcontextlost",f,!1),Z.addEventListener("webglcontextrestored",p,!1));ha();return h(y,{clear:function(a){var c=0;Y.procs.poll();var d=a.color;d&&(C.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in a&&(C.clearDepth(+a.depth),c|=256);"stencil"in a&&(C.clearStencil(a.stencil|0),c|=1024);C.clear(c)},prop:m.define.bind(null,1),context:m.define.bind(null,2),"this":m.define.bind(null,3),draw:y({}),buffer:function(a){return ia.create(a,
34962)},elements:qa.create,texture:ja.create2D,cube:ja.createCube,renderbuffer:ra.create,framebuffer:na.create,framebufferCube:function(a){},attributes:C.getContextAttributes(),frame:function(a){U.push(a);!W&&0<U.length&&d();return{cancel:function(){var c=U.find(function(c){return c===a});0>c||(U.splice(c,1),0>=U.length&&W&&(q.cancel(d),W=0))}}},limits:X,hasExtension:function(a){return 0<=X.extensions.indexOf(a.toLowerCase())},read:P,destroy:function(){W&&(q.cancel(d),W=0);Z&&(Z.removeEventListener("webglcontextlost",
f),Z.removeEventListener("webglcontextrestored",p));sa.clear();na.clear();ra.clear();ja.clear();qa.clear();ia.clear();fa&&fa.clear();if(R.onDestroy)R.onDestroy()},_gl:C,_refresh:ha,stats:S,updateTimer:function(){fa&&fa.update()}})}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,
"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},{},[1]);
